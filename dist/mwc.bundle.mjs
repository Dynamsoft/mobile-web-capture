/*!
* Dynamsoft Mobile Web Capture JavaScript Library
* @product Dynamsoft Mobile Web Capture JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2025, Dynamsoft Corporation
* @author Dynamsoft
* @version 3.0.1
* @fileoverview Mobile Web Capture (MWC) is an SDK for scanning multi-page documents, enhancing Dynamsoft Document Scanner (DDS) with multi-document management, annotation, and uploading.
* More info on MWC JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/
*/
const t=t=>t&&"object"==typeof t&&"function"==typeof t.then,e=(async()=>{})().constructor;class i extends e{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(i){let n;this._task=i,t(i)?n=i:"function"==typeof i&&(n=new e(i)),n&&(async()=>{try{const t=await n;i===this._task&&this.resolve(t)}catch(t){i===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let i,n;super(((t,e)=>{i=t,n=e})),this._s="pending",this.resolve=e=>{this.isPending&&(t(e)?this.task=e:(this._s="fulfilled",i(e)))},this.reject=t=>{this.isPending&&(this._s="rejected",n(t))},this.task=e}}function n(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function s(t,e,i,n,s){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}var o,r,a;"function"==typeof SuppressedError&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(o||(o={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(r||(r={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12",t[t.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(a||(a={}));const l="undefined"==typeof self,h="function"==typeof importScripts,c=(()=>{if(!h){if(!l&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),d=t=>{if(null==t&&(t="./"),l||h);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},u=t=>Object.prototype.toString.call(t),p=t=>Array.isArray?Array.isArray(t):"[object Array]"===u(t),g=t=>"[object Boolean]"===u(t),f=t=>"number"==typeof t&&!Number.isNaN(t),m=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),v=t=>!(!m(t)||!f(t.x)||!f(t.y)||!f(t.radius)||t.radius<0||!f(t.startAngle)||!f(t.endAngle)),y=t=>!!m(t)&&!!p(t.points)&&0!=t.points.length&&!t.points.some((t=>!T(t))),x=t=>!(!m(t)||!f(t.width)||t.width<=0||!f(t.height)||t.height<=0||!f(t.stride)||t.stride<=0||!("format"in t)||"tag"in t&&!S(t.tag)),w=t=>!(!x(t)||!f(t.bytes.length)&&!f(t.bytes.ptr)),b=t=>!!x(t)&&t.bytes instanceof Uint8Array,C=t=>!(!m(t)||!f(t.left)||t.left<0||!f(t.top)||t.top<0||!f(t.right)||t.right<0||!f(t.bottom)||t.bottom<0||t.left>=t.right||t.top>=t.bottom||!g(t.isMeasuredInPercentage)),S=t=>null===t||!!m(t)&&!!f(t.imageId)&&"type"in t,_=t=>!(!m(t)||!T(t.startPoint)||!T(t.endPoint)||t.startPoint.x==t.endPoint.x&&t.startPoint.y==t.endPoint.y),T=t=>!!m(t)&&!!f(t.x)&&!!f(t.y),E=t=>!!m(t)&&!!p(t.points)&&0!=t.points.length&&!t.points.some((t=>!T(t))),P=t=>!!m(t)&&!!p(t.points)&&0!=t.points.length&&4==t.points.length&&!t.points.some((t=>!T(t))),A=t=>!(!m(t)||!f(t.x)||!f(t.y)||!f(t.width)||t.width<0||!f(t.height)||t.height<0||"isMeasuredInPercentage"in t&&!g(t.isMeasuredInPercentage)),I=async(t,e)=>await new Promise(((i,n)=>{let s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType=e,s.send(),s.onloadend=async()=>{s.status<200||s.status>=300?n(new Error(t+" "+s.status)):i(s.response)},s.onerror=()=>{n(new Error("Network Error: "+s.statusText))}})),D=t=>/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(t),k=(t,e)=>{let i=t.split("."),n=e.split(".");for(let t=0;t<i.length&&t<n.length;++t){let e=i[t],s=n[t];if(e===s)continue;let o=parseInt(i[t]),r=parseInt(n[t]);return o===r||Number.isNaN(o)&&Number.isNaN(r)?e<s?-1:1:o<r||Number.isNaN(o)&&Number.isInteger(r)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},R=t=>{const e={},i={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer",ddv:"dynamsoft-document-viewer"};for(let n in t){if("rootDirectory"===n)continue;let s=n,o=t[s],r=o&&"object"==typeof o&&o.path?o.path:o,a=t.rootDirectory;if(a&&!a.endsWith("/")&&(a+="/"),"object"==typeof o&&o.isInternal)a&&(r=t[s].version?`${a}${i[s]}@${t[s].version}/dist/${"ddv"===s?"engine":""}`:`${a}${i[s]}/dist/${"ddv"===s?"engine":""}`);else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof r&&(r=r.replace(i,a||"")),"object"==typeof r&&"dwt"===s){const n=t[s].resourcesPath,o=t[s].serviceInstallerLocation;e[s]={resourcesPath:n.replace(i,a||""),serviceInstallerLocation:o.replace(i,a||"")};continue}}e[s]=d(r)}return e},M=async(t,e,i)=>await new Promise((async(n,s)=>{try{const s=e.split(".");let o=s[s.length-1];const r=await B(`image/${o}`,t);s.length<=1&&(o="png");const a=new File([r],e,{type:`image/${o}`});if(i){const t=URL.createObjectURL(a),i=document.createElement("a");i.href=t,i.download=e,i.click()}return n(a)}catch(t){return s()}})),L=t=>{b(t)&&(t=F(t));const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d",{willReadFrequently:!0}).putImageData(t,0,0),e},O=(t,e)=>{b(e)&&(e=F(e));const i=L(e);let n=new Image,s=i.toDataURL(t);return n.src=s,n},B=async(t,e)=>{b(e)&&(e=F(e));const i=L(e);return new Promise(((e,n)=>{i.toBlob((t=>e(t)),t)}))},F=t=>{let e,i=t.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(t.format)===a.IPF_BGR_888){const t=i.length/3;e=new Uint8ClampedArray(4*t);for(let n=0;n<t;++n)e[4*n]=i[3*n],e[4*n+1]=i[3*n+1],e[4*n+2]=i[3*n+2],e[4*n+3]=255}else if(Number(t.format)===a.IPF_RGB_888){const t=i.length/3;e=new Uint8ClampedArray(4*t);for(let n=0;n<t;++n)e[4*n]=i[3*n+2],e[4*n+1]=i[3*n+1],e[4*n+2]=i[3*n],e[4*n+3]=255}else if(Number(t.format)===a.IPF_GRAYSCALED){const t=i.length;e=new Uint8ClampedArray(4*t);for(let n=0;n<t;n++)e[4*n]=e[4*n+1]=e[4*n+2]=i[n],e[4*n+3]=255}else if(Number(t.format)===a.IPF_BINARY_8){const n=i.length,s=t.width,o=t.height,r=t.stride;e=new Uint8ClampedArray(s*o*4);for(let t=0;t<n;t++){let n=i[t],o=t%r,a=Math.floor(t/r);for(let t=0;t<8;t++){let i=o+t,r=4*(a*s+i);if(i>=s)break;e[r]=e[r+1]=e[r+2]=(128&n)/128*255,e[r+3]=255,n<<=1}}}else if(Number(t.format)===a.IPF_ABGR_8888){const t=i.length/4;e=new Uint8ClampedArray(i.length);for(let n=0;n<t;++n)e[4*n]=i[4*n],e[4*n+1]=i[4*n+1],e[4*n+2]=i[4*n+2],e[4*n+3]=i[4*n+3]}else if(Number(t.format)===a.IPF_ARGB_8888){const t=i.length/4;e=new Uint8ClampedArray(i.length);for(let n=0;n<t;++n)e[4*n]=i[4*n+2],e[4*n+1]=i[4*n+1],e[4*n+2]=i[4*n],e[4*n+3]=i[4*n+3]}else if(Number(t.format)===a.IPF_BINARY_8_INVERTED){const n=i.length,s=t.width,o=t.height,r=t.stride;e=new Uint8ClampedArray(s*o*4);for(let t=0;t<n;t++){let n=i[t],o=t%r,a=Math.floor(t/r);for(let t=0;t<8;t++){let i=o+t,r=4*(a*s+i);if(i>=s)break;e[r]=e[r+1]=e[r+2]=128&n?0:255,e[r+3]=255,n<<=1}}}return new ImageData(e,t.width,t.height)};var N,U,V,W,H,j,z,G;let Y,$,X,q,Z,J=class t{get _isFetchingStarted(){return n(this,H,"f")}constructor(){N.add(this),U.set(this,[]),V.set(this,1),W.set(this,o.BOPM_BLOCK),H.set(this,!1),j.set(this,void 0),z.set(this,r.CCUT_AUTO)}setErrorListener(t){}addImageToBuffer(t){var e;if(!b(t))throw new TypeError("Invalid 'image'.");if((null===(e=t.tag)||void 0===e?void 0:e.hasOwnProperty("imageId"))&&"number"==typeof t.tag.imageId&&this.hasImage(t.tag.imageId))throw new Error("Existed imageId.");if(n(this,U,"f").length>=n(this,V,"f"))switch(n(this,W,"f")){case o.BOPM_BLOCK:break;case o.BOPM_UPDATE:if(n(this,U,"f").push(t),m(n(this,j,"f"))&&f(n(this,j,"f").imageId)&&1==n(this,j,"f").keepInBuffer)for(;n(this,U,"f").length>n(this,V,"f");){const t=n(this,U,"f").findIndex((t=>{var e;return(null===(e=t.tag)||void 0===e?void 0:e.imageId)!==n(this,j,"f").imageId}));n(this,U,"f").splice(t,1)}else n(this,U,"f").splice(0,n(this,U,"f").length-n(this,V,"f"))}else n(this,U,"f").push(t)}getImage(){if(0===n(this,U,"f").length)return null;let e;if(n(this,j,"f")&&f(n(this,j,"f").imageId)){const t=n(this,N,"m",G).call(this,n(this,j,"f").imageId);if(t<0)throw new Error(`Image with id ${n(this,j,"f").imageId} doesn't exist.`);e=n(this,U,"f").slice(t,t+1)[0]}else e=n(this,U,"f").pop();if([a.IPF_RGB_565,a.IPF_RGB_555,a.IPF_RGB_888,a.IPF_ARGB_8888,a.IPF_RGB_161616,a.IPF_ARGB_16161616,a.IPF_ABGR_8888,a.IPF_ABGR_16161616,a.IPF_BGR_888].includes(e.format)){if(n(this,z,"f")===r.CCUT_RGB_R_CHANNEL_ONLY){t._onLog&&t._onLog("only get R channel data.");const i=new Uint8Array(e.width*e.height);for(let t=0;t<i.length;t++)switch(e.format){case a.IPF_RGB_565:case a.IPF_RGB_555:case a.IPF_RGB_888:case a.IPF_RGB_161616:i[t]=e.bytes[3*t+2];break;case a.IPF_ARGB_8888:case a.IPF_ARGB_16161616:i[t]=e.bytes[4*t+2];break;case a.IPF_BGR_888:i[t]=e.bytes[3*t];break;case a.IPF_ABGR_8888:case a.IPF_ABGR_16161616:i[t]=e.bytes[4*t]}e.bytes=i,e.stride=e.width,e.format=a.IPF_GRAYSCALED}else if(n(this,z,"f")===r.CCUT_RGB_G_CHANNEL_ONLY){t._onLog&&t._onLog("only get G channel data.");const i=new Uint8Array(e.width*e.height);for(let t=0;t<i.length;t++)switch(e.format){case a.IPF_RGB_565:case a.IPF_RGB_555:case a.IPF_RGB_888:case a.IPF_RGB_161616:case a.IPF_BGR_888:i[t]=e.bytes[3*t+1];break;case a.IPF_ARGB_8888:case a.IPF_ARGB_16161616:case a.IPF_ABGR_8888:case a.IPF_ABGR_16161616:i[t]=e.bytes[4*t+1]}e.bytes=i,e.stride=e.width,e.format=a.IPF_GRAYSCALED}else if(n(this,z,"f")===r.CCUT_RGB_B_CHANNEL_ONLY){t._onLog&&t._onLog("only get B channel data.");const i=new Uint8Array(e.width*e.height);for(let t=0;t<i.length;t++)switch(e.format){case a.IPF_RGB_565:case a.IPF_RGB_555:case a.IPF_RGB_888:case a.IPF_RGB_161616:i[t]=e.bytes[3*t];break;case a.IPF_ARGB_8888:case a.IPF_ARGB_16161616:i[t]=e.bytes[4*t];break;case a.IPF_BGR_888:i[t]=e.bytes[3*t+2];break;case a.IPF_ABGR_8888:case a.IPF_ABGR_16161616:i[t]=e.bytes[4*t+2]}e.bytes=i,e.stride=e.width,e.format=a.IPF_GRAYSCALED}}else[a.IPF_NV21,a.IPF_NV12].includes(e.format)&&t._onLog&&t._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(t,e){if(!((...t)=>0!==t.length&&t.every((t=>f(t))))(t))throw new TypeError("Invalid 'imageId'.");if(void 0!==e&&!g(e))throw new TypeError("Invalid 'keepInBuffer'.");s(this,j,{imageId:t,keepInBuffer:e})}_resetNextReturnedImage(){s(this,j,null)}hasImage(t){return n(this,N,"m",G).call(this,t)>=0}startFetching(){s(this,H,!0)}stopFetching(){s(this,H,!1)}setMaxImageCount(t){if("number"!=typeof t)throw new TypeError("Invalid 'count'.");if(t<1||Math.round(t)!==t)throw new Error("Invalid 'count'.");for(s(this,V,t);n(this,U,"f")&&n(this,U,"f").length>t;)n(this,U,"f").shift()}getMaxImageCount(){return n(this,V,"f")}getImageCount(){return n(this,U,"f").length}clearBuffer(){n(this,U,"f").length=0}isBufferEmpty(){return 0===n(this,U,"f").length}setBufferOverflowProtectionMode(t){s(this,W,t)}getBufferOverflowProtectionMode(){return n(this,W,"f")}setColourChannelUsageType(t){s(this,z,t)}getColourChannelUsageType(){return n(this,z,"f")}};U=new WeakMap,V=new WeakMap,W=new WeakMap,H=new WeakMap,j=new WeakMap,z=new WeakMap,N=new WeakSet,G=function(t){if("number"!=typeof t)throw new TypeError("Invalid 'imageId'.");return n(this,U,"f").findIndex((e=>{var i;return(null===(i=e.tag)||void 0===i?void 0:i.imageId)===t}))},"undefined"!=typeof navigator&&(Y=navigator,$=Y.userAgent,X=Y.platform,q=Y.mediaDevices),function(){if(!l){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Y.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:X,search:"Win"},Mac:{str:X},Linux:{str:X}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||$,r=s.search||e,a=s.verStr||$,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||$,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=$.indexOf("Windows NT")&&(s="HarmonyOS"),Z={browser:i,version:n,OS:s}}l&&(Z={browser:"ssr",version:0,OS:"ssr"})}();const K="undefined"!=typeof WebAssembly&&$&&!(/Safari/.test($)&&!/Chrome/.test($)&&/\(.+\s11_2_([2-6]).*\)/.test($)),Q=!("undefined"==typeof Worker),tt=!(!q||!q.getUserMedia),et=async()=>{let t=!1;if(tt)try{(await q.getUserMedia({video:!0})).getTracks().forEach((t=>{t.stop()})),t=!0}catch(t){}return t};"Chrome"===Z.browser&&Z.version>66||"Safari"===Z.browser&&Z.version>13||"OPR"===Z.browser&&Z.version>43||"Edge"===Z.browser&&Z.version;const it={},nt=async t=>{let e="string"==typeof t?[t]:t,n=[];for(let t of e)n.push(it[t]=it[t]||new i);await Promise.all(n)},st=async(t,e)=>{let n,s="string"==typeof t?[t]:t,o=[];for(let t of s){let s;o.push(s=it[t]=it[t]||new i(n=n||e())),s.isEmpty&&(s.task=n=n||e())}await Promise.all(o)};let ot,rt=0;const at=()=>rt++,lt={};let ht;const ct=t=>{ht=t,ot&&ot.postMessage({type:"setBLog",body:{value:!!t}})};let dt=!1;const ut=t=>{dt=t,ot&&ot.postMessage({type:"setBDebug",body:{value:!!t}})},pt={},gt={},ft={dip:{wasm:!0}},mt={std:{version:"1.4.21",path:d(c+"../../dynamsoft-capture-vision-std@1.4.21/dist/"),isInternal:!0},core:{version:"3.4.31",path:c,isInternal:!0}},vt=async t=>{let e;t instanceof Array||(t=t?[t]:[]);let n=it.core;e=!n||n.isEmpty;let s=new Map;const o=t=>{if("std"==(t=t.toLowerCase())||"core"==t)return;if(!ft[t])throw Error("The '"+t+"' module cannot be found.");let e=ft[t].deps;if(null==e?void 0:e.length)for(let t of e)o(t);let i=it[t];s.has(t)||s.set(t,!i||i.isEmpty)};for(let e of t)o(e);let r=[];e&&r.push("core"),r.push(...s.keys());const a=[...s.entries()].filter((t=>!t[1])).map((t=>t[0]));await st(r,(async()=>{const t=[...s.entries()].filter((t=>t[1])).map((t=>t[0]));await nt(a);const n=R(mt),o={};for(let e of t)o[e]=ft[e];const r={engineResourcePaths:n,autoResources:o,names:t};let l=new i;if(e){r.needLoadCore=!0;let t=n.core+yt._workerName;t.startsWith(location.origin)||(t=await fetch(t).then((t=>t.blob())).then((t=>URL.createObjectURL(t)))),ot=new Worker(t),ot.onerror=t=>{let e=new Error(t.message);l.reject(e)},ot.addEventListener("message",(t=>{let e=t.data?t.data:t,i=e.type,n=e.id,s=e.body;switch(i){case"log":ht&&ht(e.message);break;case"task":try{lt[n](s),delete lt[n]}catch(t){throw delete lt[n],t}break;case"event":try{lt[n](s)}catch(t){throw t}break;default:console.log(t)}})),r.bLog=!!ht,r.bd=dt,r.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await nt("core");let h=rt++;lt[h]=t=>{if(t.success)Object.assign(pt,t.versions),"{}"!==JSON.stringify(t.versions)&&(yt._versions=t.versions),l.resolve(void 0);else{const e=Error(t.message);t.stack&&(e.stack=t.stack),l.reject(e)}},ot.postMessage({type:"loadWasm",body:r,id:h}),await l}))};class yt{static get engineResourcePaths(){return mt}static set engineResourcePaths(t){Object.assign(mt,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ht}static set _onLog(t){ct(t)}static get _bDebug(){return dt}static set _bDebug(t){ut(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!it[t]&&it[t].isFulfilled}static async loadWasm(t){return await vt(t)}static async detectEnvironment(){return await(async()=>({wasm:K,worker:Q,getUserMedia:tt,camera:await et(),browser:Z.browser,version:Z.version,OS:Z.OS}))()}static async getModuleVersion(){return await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success)return t(i.versions);{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"getModuleVersion",id:i})}))}static getVersion(){return`3.4.31(Worker: ${pt.core&&pt.core.worker||"Not Loaded"}, Wasm: ${pt.core&&pt.core.wasm||"Not Loaded"})`}static enableLogging(){J._onLog=console.log,yt._onLog=console.log}static disableLogging(){J._onLog=null,yt._onLog=null}static async cfd(t){return await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cfd",id:n,body:{count:t}})}))}}var xt,wt,bt,Ct,St,_t,Tt,Et,Pt;yt._bSupportDce4Module=-1,yt._bSupportIRTModule=-1,yt._versions=null,yt._workerName="core.worker.js",yt.browserInfo=Z,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(xt||(xt={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(wt||(wt={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",t[t.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",t[t.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",t[t.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",t[t.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",t[t.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",t[t.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",t[t.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",t[t.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",t[t.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",t[t.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",t[t.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",t[t.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(bt||(bt={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(Ct||(Ct={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(St||(St={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(_t||(_t={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(Tt||(Tt={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Et||(Et={})),function(t){t[t.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",t[t.CVS_PASSED=1]="CVS_PASSED",t[t.CVS_FAILED=2]="CVS_FAILED"}(Pt||(Pt={}));const At={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_DOWN_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_UP_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_NORMALIZED_IMAGES:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var It,Dt;!function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(It||(It={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Dt||(Dt={}));const kt="undefined"==typeof self,Rt=kt?{}:self,Mt="function"==typeof importScripts,Lt=(()=>{if(!Mt){if(!kt&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),Ot=t=>t&&"object"==typeof t&&"function"==typeof t.then,Bt=(async()=>{})().constructor;let Ft=class extends Bt{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){let e;this._task=t,Ot(t)?e=t:"function"==typeof t&&(e=new Bt(t)),e&&(async()=>{try{const i=await e;t===this._task&&this.resolve(i)}catch(e){t===this._task&&this.reject(e)}})()}get isEmpty(){return null==this._task}constructor(t){let e,i;super(((t,n)=>{e=t,i=n})),this._s="pending",this.resolve=t=>{this.isPending&&(Ot(t)?this.task=t:(this._s="fulfilled",e(t)))},this.reject=t=>{this.isPending&&(this._s="rejected",i(t))},this.task=t}};const Nt=" is not allowed to change after `createInstance` or `loadWasm` is called.",Ut=!kt&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Vt=(t,e)=>{const i=t;if(i._license!==e){if(!i._pLoad.isEmpty)throw new Error("`license`"+Nt);i._license=e}};!kt&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Wt=t=>{if(null==t)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!kt){let i=document.createElement("a");i.href=t[e],t[e]=i.href}t[e].endsWith("/")||(t[e]+="/")}}return t},Ht=(t,e)=>{e=Wt(e);const i=t;if(i._licenseServer!==e){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+Nt);i._licenseServer=e}},jt=(t,e)=>{e=e||"";const i=t;if(i._deviceFriendlyName!==e){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Nt);i._deviceFriendlyName=e}};let zt,Gt,Yt,$t,Xt;"undefined"!=typeof navigator&&(zt=navigator,Gt=zt.userAgent,Yt=zt.platform,$t=zt.mediaDevices),function(){if(!kt){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:zt.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Yt,search:"Win"},Mac:{str:Yt},Linux:{str:Yt}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||Gt,r=s.search||e,a=s.verStr||Gt,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||Gt,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=Gt.indexOf("Windows NT")&&(s="HarmonyOS"),Xt={browser:i,version:n,OS:s}}kt&&(Xt={browser:"ssr",version:0,OS:"ssr"})}(),$t&&$t.getUserMedia,"Chrome"===Xt.browser&&Xt.version>66||"Safari"===Xt.browser&&Xt.version>13||"OPR"===Xt.browser&&Xt.version>43||"Edge"===Xt.browser&&Xt.version;const qt=()=>(vt("license"),st("dynamsoft_inited",(async()=>{let{lt:t,l:e,ls:i,sp:n,rmk:s,cv:o}=((t,e=!1)=>{const i=Jt;if(i._pLoad.isEmpty){let n,s,o,r=i._license||"",a=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,h=0;if(r.startsWith("t")||r.startsWith("f"))h=0;else if(0===r.length||r.startsWith("P")||r.startsWith("L")||r.startsWith("Y")||r.startsWith("A"))h=1;else{h=2;const e=r.indexOf(":");-1!=e&&(r=r.substring(e+1));const i=r.indexOf("?");if(-1!=i&&(s=r.substring(i+1),r=r.substring(0,i)),r.startsWith("DLC2"))h=0;else{if(r.startsWith("DLS2")){let e;try{let t=r.substring(4);t=atob(t),e=JSON.parse(t)}catch(t){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(r=e.handshakeCode?e.handshakeCode:e.organizationID?e.organizationID:"","number"==typeof r&&(r=JSON.stringify(r)),0===a.length){let t=[];e.mainServerURL&&(t[0]=e.mainServerURL),e.standbyServerURL&&(t[1]=e.standbyServerURL),a=Wt(t)}!l&&e.sessionPassword&&(l=e.sessionPassword),n=e.remark}r&&"200001"!==r&&!r.startsWith("200001-")||(h=1)}}if(h&&(e||(Rt.crypto||(o="Please upgrade your browser to support online key."),Rt.crypto.subtle||(o="Require https to use online key in this browser."))),o)throw new Error(o);return 1===h&&(r="",console.warn("Applying for a public trial license ...")),{lt:h,l:r,ls:a,sp:l,rmk:n,cv:s}}throw new Error("Can't preprocess license again"+Nt)})(),r=new Ft;Jt._pLoad.task=r,(async()=>{try{await Jt._pLoad}catch(t){}})();let a=at();lt[a]=e=>{if(e.message&&Jt._onAuthMessage){let t=Jt._onAuthMessage(e.message);null!=t&&(e.message=t)}let i,n=!1;if(1===t&&(n=!0),e.success?(ht&&ht("init license success"),e.message&&console.warn(e.message),yt._bSupportIRTModule=e.bSupportIRTModule,yt._bSupportDce4Module=e.bSupportDce4Module,Jt.bPassValidation=!0,[0,-10076].includes(e.initLicenseInfo.errorCode)?[-10076].includes(e.initLicenseInfo.errorCode)&&console.warn(e.initLicenseInfo.errorString):r.reject(new Error(e.initLicenseInfo.errorString))):(i=Error(e.message),e.stack&&(i.stack=e.stack),e.ltsErrorCode&&(i.ltsErrorCode=e.ltsErrorCode),n||111==e.ltsErrorCode&&-1!=e.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const t=R(yt.engineResourcePaths);(async(t,e,i)=>{if(!t._bNeverShowDialog)try{let n=await fetch(t.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=s;let r=[];for(let t=0;t<o.childElementCount;++t){let e=o.children[t];e instanceof HTMLStyleElement&&(r.push(e),document.head.append(e))}let a=1==o.childElementCount?o.children[0]:o;a.remove();let l,h,c,d,u,p=[a],g=a.children;for(let t of g)p.push(t);for(let t=0;t<p.length;++t)for(let e of p[t].children)p.push(e);for(let t of p)if(!l&&t.classList.contains("dls-license-mask"))l=t,t.addEventListener("click",(e=>{if(t==e.target){a.remove();for(let t of r)t.remove()}}));else if(!h&&t.classList.contains("dls-license-icon-close"))h=t,t.addEventListener("click",(()=>{a.remove();for(let t of r)t.remove()}));else if(!c&&t.classList.contains("dls-license-icon-error"))c=t,"error"!=e&&t.remove();else if(!d&&t.classList.contains("dls-license-icon-warn"))d=t,"warn"!=e&&t.remove();else if(!u&&t.classList.contains("dls-license-msg-content")){u=t;let e=i;for(;e;){let i=e.indexOf("["),n=e.indexOf("]",i),s=e.indexOf("(",n),o=e.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==o){t.appendChild(new Text(e));break}i>0&&t.appendChild(new Text(e.substring(0,i)));let r=document.createElement("a"),a=e.substring(i+1,n);r.innerText=a;let l=e.substring(s+1,o);r.setAttribute("href",l),r.setAttribute("target","_blank"),t.appendChild(r),e=e.substring(o+1)}}document.body.appendChild(a)}catch(e){t._onLog&&t._onLog(e.message||e)}})({_bNeverShowDialog:Jt._bNeverShowDialog,engineResourcePath:t.license,_onLog:ht},e.success?"warn":"error",e.message)}e.success?r.resolve(void 0):r.reject(i)},await nt("core"),ot.postMessage({type:"license_dynamsoft",body:{v:"3.4.31",brtk:!!t,bptk:1===t,l:e,os:Xt,fn:Jt.deviceFriendlyName,ls:i,sp:n,rmk:s,cv:o},id:a}),Jt.bCallInitLicense=!0,await r})));let Zt;gt.license={},gt.license.dynamsoft=qt,gt.license.getAR=async()=>{{let t=it.dynamsoft_inited;t&&t.isRejected&&await t}return ot?new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success){delete i.success;{let t=Jt.license;t&&(t.startsWith("t")||t.startsWith("f"))&&(i.pk=t)}if(Object.keys(i).length){if(i.lem){let t=Error(i.lem);t.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=t}t(i)}else t(null)}else{let t=Error(i.message);i.stack&&(t.stack=i.stack),e(t)}},ot.postMessage({type:"license_getAR",id:i})})):null};let Jt=class t{static setLicenseServer(e){Ht(t,e)}static get license(){return this._license}static set license(e){Vt(t,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){Ht(t,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){jt(t,e)}static initLicense(e,i){if(Vt(t,e),t.bCallInitLicense=!0,"boolean"==typeof i&&i||"object"==typeof i&&i.executeNow)return qt()}static setDeviceFriendlyName(e){jt(t,e)}static getDeviceFriendlyName(){return t._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await st("dynamsoft_uuid",(async()=>{await vt();let t=new Ft,e=at();lt[e]=e=>{if(e.success)t.resolve(e.uuid);else{const i=Error(e.message);e.stack&&(i.stack=e.stack),t.reject(i)}},ot.postMessage({type:"license_getDeviceUUID",id:e}),Zt=await t})),Zt))()}};Jt._pLoad=new Ft,Jt.bPassValidation=!1,Jt.bCallInitLicense=!1,Jt._license=Ut,Jt._licenseServer=[],Jt._deviceFriendlyName="",yt.engineResourcePaths.license={version:"3.4.31",path:Lt,isInternal:!0},ft.license={wasm:!0,js:!0},gt.license.LicenseManager=Jt;const Kt="1.4.21";"string"!=typeof yt.engineResourcePaths.std&&k(yt.engineResourcePaths.std.version,Kt)<0&&(yt.engineResourcePaths.std={version:Kt,path:(t=>{if(null==t&&(t="./"),kt||Mt);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t})(Lt+`../../dynamsoft-capture-vision-std@${Kt}/dist/`),isInternal:!0});let Qt=class{static getVersion(){return`3.4.31(Worker: ${pt.license&&pt.license.worker||"Not Loaded"}, Wasm: ${pt.license&&pt.license.wasm||"Not Loaded"})`}};function te(t,e,i,n){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function ee(t,e,i,n,s){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError;const ie=t=>t&&"object"==typeof t&&"function"==typeof t.then,ne=(async()=>{})().constructor;class se extends ne{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){let e;this._task=t,ie(t)?e=t:"function"==typeof t&&(e=new ne(t)),e&&(async()=>{try{const i=await e;t===this._task&&this.resolve(i)}catch(e){t===this._task&&this.reject(e)}})()}get isEmpty(){return null==this._task}constructor(t){let e,i;super(((t,n)=>{e=t,i=n})),this._s="pending",this.resolve=t=>{this.isPending&&(ie(t)?this.task=t:(this._s="fulfilled",e(t)))},this.reject=t=>{this.isPending&&(this._s="rejected",i(t))},this.task=t}}class oe{constructor(t){this._cvr=t}async getMaxBufferedItems(){return await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success)return t(i.count);{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})}))}async setMaxBufferedItems(t){return await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:t}})}))}async getBufferedCharacterItemSet(){return await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success)return t(i.itemSet);{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})}))}}var re={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesReceived:!1};const ae=t=>{for(let e in t._irrRegistryState)t._irrRegistryState[e]=!1;for(let e of t._intermediateResultReceiverSet)if(e.isDce||e.isFilter)t._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in e)t._irrRegistryState[i]||(t._irrRegistryState[i]=!!e[i])};class le{constructor(t){this._irrRegistryState=re,this._intermediateResultReceiverSet=new Set,this._cvr=t}async addResultReceiver(t){if("object"!=typeof t)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(t),ae(this);let e=-1,i={};if(!t.isDce&&!t.isFilter){if(!t._observedResultUnitTypes||!t._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");e=t._observedResultUnitTypes,t._observedTaskMap.forEach(((t,e)=>{i[e]=t})),t._observedTaskMap.clear()}return await new Promise(((t,n)=>{let s=at();lt[s]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},ot.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:e.toString(),observedTaskMap:i}})}))}async removeResultReceiver(t){return this._intermediateResultReceiverSet.delete(t),ae(this),await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success)return t();{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})}))}getOriginalImage(){return this._cvr._dsImage}}const he="undefined"==typeof self,ce="function"==typeof importScripts,de=(()=>{if(!ce){if(!he&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),ue=t=>{if(null==t&&(t="./"),he||ce);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};var pe;yt.engineResourcePaths.cvr={version:"2.4.33",path:de,isInternal:!0},ft.cvr={js:!0,wasm:!0,deps:["license","dip"]},gt.cvr={};const ge="1.4.21";"string"!=typeof yt.engineResourcePaths.std&&k(yt.engineResourcePaths.std.version,ge)<0&&(yt.engineResourcePaths.std={version:ge,path:ue(de+`../../dynamsoft-capture-vision-std@${ge}/dist/`),isInternal:!0});const fe="2.4.31";(!yt.engineResourcePaths.dip||"string"!=typeof yt.engineResourcePaths.dip&&k(yt.engineResourcePaths.dip.version,fe)<0)&&(yt.engineResourcePaths.dip={version:fe,path:ue(de+`../../dynamsoft-image-processing@${fe}/dist/`),isInternal:!0});class me{static getVersion(){return this._version}}me._version=`2.4.33(Worker: ${null===(pe=pt.cvr)||void 0===pe?void 0:pe.worker}, Wasm: loading...`;const ve={barcodeResultItems:{type:xt.CRIT_BARCODE,reveiver:"onDecodedBarcodesReceived",isNeedFilter:!0},textLineResultItems:{type:xt.CRIT_TEXT_LINE,reveiver:"onRecognizedTextLinesReceived",isNeedFilter:!0},detectedQuadResultItems:{type:xt.CRIT_DETECTED_QUAD,reveiver:"onDetectedQuadsReceived",isNeedFilter:!1},normalizedImageResultItems:{type:xt.CRIT_NORMALIZED_IMAGE,reveiver:"onNormalizedImagesReceived",isNeedFilter:!1},parsedResultItems:{type:xt.CRIT_PARSED_RESULT,reveiver:"onParsedResultsReceived",isNeedFilter:!1}};var ye,xe,we,be,Ce,Se,_e,Te,Ee,Pe,Ae,Ie,De;function ke(t,e){if(t&&t.location){const i=t.location.points;for(let t of i)t.x=t.x/e,t.y=t.y/e;ke(t.referencedItem,e)}}function Re(t){if(t.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}!function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(ye||(ye={}));const Me={onTaskResultsReceived:()=>{},isFilter:!0};class Le{constructor(){this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(yt.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,xe.set(this,null),we.set(this,null),be.set(this,null),Ce.set(this,null),Se.set(this,null),_e.set(this,new Set),Te.set(this,new Set),Ee.set(this,new Set),Pe.set(this,0),Ae.set(this,!1),Ie.set(this,!1),De.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return te(this,De,"f")}static async createInstance(){if(!gt.license)throw Error("Module `license` is not existed.");await gt.license.dynamsoft(),await vt(["cvr"]);const t=new Le,e=new se;let i=at();return lt[i]=async i=>{var n;if(i.success)t._instanceID=i.instanceID,t._currentSettings=JSON.parse(JSON.parse(i.outputSettings).data),me._version=`2.4.33(Worker: ${null===(n=pt.cvr)||void 0===n?void 0:n.worker}, Wasm: ${i.version})`,ee(t,Ie,!0),ee(t,Ce,t.getIntermediateResultManager()),ee(t,Ie,!1),e.resolve(t);else{const t=Error(i.message);i.stack&&(t.stack=i.stack),e.reject(t)}},ot.postMessage({type:"cvr_createInstance",id:i}),e}async _singleFrameModeCallback(t){for(let e of te(this,_e,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived({imageData:t});const e={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(e,this._templateName);i.originalImageTag=t.tag;const n={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let t of te(this,_e,"f"))if(t.isDce)t.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});else{for(let e in ve){const s=e,o=ve[s];t[o.reveiver]&&i[s]&&t[o.reveiver](Object.assign(Object.assign({},n),{[s]:i[s]}))}t.onCapturedResultReceived&&t.onCapturedResultReceived(i)}}setInput(t){if(Re(this),t){if(ee(this,xe,t),t.isCameraEnhancer){te(this,Ce,"f")&&(te(this,xe,"f")._intermediateResultReceiver.isDce=!0,te(this,Ce,"f").addResultReceiver(te(this,xe,"f")._intermediateResultReceiver));const t=te(this,xe,"f").getCameraView();if(t){const e=t._capturedResultReceiver;e.isDce=!0,te(this,_e,"f").add(e)}}}else ee(this,xe,null)}getInput(){return te(this,xe,"f")}addImageSourceStateListener(t){if(Re(this),"object"!=typeof t)return console.warn("Invalid ISA state listener.");t&&Object.keys(t)&&te(this,Te,"f").add(t)}removeImageSourceStateListener(t){return Re(this),te(this,Te,"f").delete(t)}addResultReceiver(t){if(Re(this),"object"!=typeof t)throw new Error("Invalid receiver.");t&&Object.keys(t).length&&(te(this,_e,"f").add(t),this._setCrrRegistry())}removeResultReceiver(t){Re(this),te(this,_e,"f").delete(t),this._setCrrRegistry()}async _setCrrRegistry(){const t={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let e of te(this,_e,"f"))e.isDce||(t.onCapturedResultReceived=!!e.onCapturedResultReceived,t.onDecodedBarcodesReceived=!!e.onDecodedBarcodesReceived,t.onRecognizedTextLinesReceived=!!e.onRecognizedTextLinesReceived,t.onDetectedQuadsReceived=!!e.onDetectedQuadsReceived,t.onNormalizedImagesReceived=!!e.onNormalizedImagesReceived,t.onParsedResultsReceived=!!e.onParsedResultsReceived);const e=new se;let i=at();return lt[i]=async t=>{if(t.success)e.resolve();else{let i=new Error(t.message);i.stack=t.stack+"\n"+i.stack,e.reject()}},ot.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(t)}}),e}async addResultFilter(t){if(Re(this),!t||"object"!=typeof t||!Object.keys(t).length)return console.warn("Invalid filter.");te(this,Ee,"f").add(t),t._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(t){Re(this),te(this,Ee,"f").delete(t),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(te(this,Ce,"f").removeResultReceiver(Me),0===te(this,Ee,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const t={[xt.CRIT_BARCODE]:!1,[xt.CRIT_TEXT_LINE]:!1,[xt.CRIT_DETECTED_QUAD]:!1,[xt.CRIT_NORMALIZED_IMAGE]:!1},e={[xt.CRIT_BARCODE]:!1,[xt.CRIT_TEXT_LINE]:!1,[xt.CRIT_DETECTED_QUAD]:!1,[xt.CRIT_NORMALIZED_IMAGE]:!1};return await Oe(this,t),void await Be(this,e)}for(let t of te(this,Ee,"f")){if(this._isOpenBarcodeVerify=t.isResultCrossVerificationEnabled(xt.CRIT_BARCODE),this._isOpenLabelVerify=t.isResultCrossVerificationEnabled(xt.CRIT_TEXT_LINE),this._isOpenDetectVerify=t.isResultCrossVerificationEnabled(xt.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=t.isResultCrossVerificationEnabled(xt.CRIT_NORMALIZED_IMAGE),t.isLatestOverlappingEnabled(xt.CRIT_BARCODE)){[...te(this,Ce,"f")._intermediateResultReceiverSet.values()].find((t=>t.isFilter))||te(this,Ce,"f").addResultReceiver(Me)}await Oe(this,t.verificationEnabled),await Be(this,t.duplicateFilterEnabled),await Fe(this,t.duplicateForgetTime)}}async startCapturing(t){var e,i;if(Re(this),!this._isPauseScan)return;if(!te(this,xe,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");t||(t=Le._defaultTemplate);const n=await this.containsTask(t);await vt(n);for(let t of te(this,Ee,"f"))await this.addResultFilter(t);if(n.includes("dlr")&&!(null===(e=gt.dlr)||void 0===e?void 0:e.bLoadConfusableCharsData)){const t=R(yt.engineResourcePaths);await(null===(i=gt.dlr)||void 0===i?void 0:i.loadRecognitionData("ConfusableChars",t.dlr))}if(te(this,xe,"f").isCameraEnhancer&&(n.includes("ddn")?te(this,xe,"f").setPixelFormat(a.IPF_ABGR_8888):te(this,xe,"f").setPixelFormat(a.IPF_GRAYSCALED)),void 0!==te(this,xe,"f").singleFrameMode&&"disabled"!==te(this,xe,"f").singleFrameMode)return this._templateName=t,void te(this,xe,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return te(this,xe,"f").getColourChannelUsageType()===r.CCUT_AUTO&&te(this,xe,"f").setColourChannelUsageType(n.includes("ddn")?r.CCUT_FULL_CHANNEL:r.CCUT_Y_CHANNEL_ONLY),te(this,be,"f")&&te(this,be,"f").isPending?te(this,be,"f"):(ee(this,be,new se(((e,i)=>{if(this.disposed)return;let n=at();lt[n]=async n=>{if(te(this,be,"f")&&!te(this,be,"f").isFulfilled){if(!n.success){let t=new Error(n.message);return t.stack=n.stack+"\n"+t.stack,i(t)}this._isPauseScan=!1,this._isOutputOriginalImage=n.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((async()=>{-1!==this._minImageCaptureInterval&&te(this,xe,"f").startFetching(),this._loopReadVideo(t),e()}),0)}},ot.postMessage({type:"cvr_startCapturing",id:n,instanceID:this._instanceID,body:{templateName:t}})}))),await te(this,be,"f"))}stopCapturing(){Re(this),te(this,xe,"f")&&(te(this,xe,"f").isCameraEnhancer&&void 0!==te(this,xe,"f").singleFrameMode&&"disabled"!==te(this,xe,"f").singleFrameMode?te(this,xe,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind):(!async function(t){let e=at();const i=new se;lt[e]=async t=>{if(t.success)return i.resolve();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i.reject(e)}},ot.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:t._instanceID})}(this),te(this,xe,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,ee(this,be,null),te(this,xe,"f").setColourChannelUsageType(r.CCUT_AUTO)))}async containsTask(t){return Re(this),await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success)return e(JSON.parse(t.tasks));{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:t}})}))}async _loopReadVideo(t){if(this.disposed||this._isPauseScan)return;if(ee(this,Ae,!0),te(this,xe,"f").isBufferEmpty())if(te(this,xe,"f").hasNextImageToFetch())for(let t of te(this,Te,"f"))t.onImageSourceStateReceived&&t.onImageSourceStateReceived(ye.ISS_BUFFER_EMPTY);else if(!te(this,xe,"f").hasNextImageToFetch())for(let t of te(this,Te,"f"))t.onImageSourceStateReceived&&t.onImageSourceStateReceived(ye.ISS_EXHAUSTED);if(-1===this._minImageCaptureInterval||te(this,xe,"f").isBufferEmpty())try{te(this,xe,"f").isBufferEmpty()&&Le._onLog&&Le._onLog("buffer is empty so fetch image"),Le._onLog&&Le._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=te(this,xe,"f").fetchImage(),Le._onLog&&Le._onLog(`DCE: finish fetching a frame: ${Date.now()}`),te(this,xe,"f").setImageFetchInterval(this._averageTime)}catch(e){return void this._reRunCurrnetFunc(t)}else if(te(this,xe,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=te(this,xe,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(t);if(!this._dsImage)return void this._reRunCurrnetFunc(t);for(let t of te(this,_e,"f"))this._isOutputOriginalImage&&t.onOriginalImageResultReceived&&t.onOriginalImageResultReceived({imageData:this._dsImage});const e=Date.now();this._captureDsimage(this._dsImage,t).then((async i=>{if(Le._onLog&&Le._onLog("no js handle time: "+(Date.now()-e)),this._isPauseScan)return void this._reRunCurrnetFunc(t);i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;const n={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let t of te(this,_e,"f"))if(t.isDce){const e=Date.now();if(t.onCapturedResultReceived(i,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),Le._onLog){const t=Date.now()-e;t>10&&Le._onLog(`draw result time: ${t}`)}}else{for(let e in ve){const s=e,o=ve[s];t[o.reveiver],t[o.reveiver]&&i[s]&&t[o.reveiver](Object.assign(Object.assign({},n),{[s]:i[s].filter((t=>!o.isNeedFilter||!t.isFilter))})),i[s]&&(i[s]=i[s].filter((t=>!o.isNeedFilter||!t.isFilter)))}t.onCapturedResultReceived&&(i.items=i.items.filter((t=>[xt.CRIT_DETECTED_QUAD,xt.CRIT_NORMALIZED_IMAGE].includes(t.type)||!t.isFilter)),t.onCapturedResultReceived(i))}const s=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-e),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Le._onLog&&(Le._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Le._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Le._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Le._onLog(`averageTime: ${this._averageTime}`))),Le._onLog){const t=Date.now()-s;t>10&&Le._onLog(`fetch image calculate time: ${t}`)}Le._onLog&&Le._onLog(`time finish decode: ${Date.now()}`),Le._onLog&&Le._onLog("main time: "+(Date.now()-e)),Le._onLog&&Le._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(t)}),this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(t)}),Math.max(this._minImageCaptureInterval,0))})).catch((e=>{te(this,xe,"f").stopFetching(),e.errorCode&&0===e.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{te(this,xe,"f").startFetching(),this._loopReadVideo(t)}),Math.max(this._minImageCaptureInterval,1e3))),"platform error"!==e.message&&setTimeout((()=>{throw e}),0)}))}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(t)}),0)}async capture(t,e){var i,n;Re(this),e||(e=Le._defaultTemplate);const s=await this.containsTask(e);if(await vt(s),s.includes("dlr")&&!(null===(i=gt.dlr)||void 0===i?void 0:i.bLoadConfusableCharsData)){const t=R(yt.engineResourcePaths);await(null===(n=gt.dlr)||void 0===n?void 0:n.loadRecognitionData("ConfusableChars",t.dlr))}let o;if(ee(this,Ae,!1),b(t))o=await this._captureDsimage(t,e);else if("string"==typeof t)o="data:image/"==t.substring(0,11)?await this._captureBase64(t,e):await this._captureUrl(t,e);else if(t instanceof Blob)o=await this._captureBlob(t,e);else if(t instanceof HTMLImageElement)o=await this._captureImage(t,e);else if(t instanceof HTMLCanvasElement)o=await this._captureCanvas(t,e);else{if(!(t instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");o=await this._captureVideo(t,e)}return o}async _captureDsimage(t,e){return await this._captureInWorker(t,e)}async _captureUrl(t,e){let i=await I(t,"blob");return await this._captureBlob(i,e)}async _captureBase64(t,e){t=t.substring(t.indexOf(",")+1);let i=atob(t),n=i.length,s=new Uint8Array(n);for(;n--;)s[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([s]),e)}async _captureBlob(t,e){let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(t)}catch(t){}i||(n=await async function(t){return await new Promise(((e,i)=>{let n=URL.createObjectURL(t),s=new Image;s.src=n,s.onload=()=>{URL.revokeObjectURL(s.dbrObjUrl),e(s)},s.onerror=t=>{i(new Error("Can't convert blob to image : "+(t instanceof Event?t.type:t)))}}))}(t));let s=await this._captureImage(i||n,e);return i&&i.close(),s}async _captureImage(t,e){let i,n,s=t instanceof HTMLImageElement?t.naturalWidth:t.width,o=t instanceof HTMLImageElement?t.naturalHeight:t.height,r=Math.max(s,o);r>this.maxImageSideLength?(ee(this,Pe,this.maxImageSideLength/r),i=Math.round(s*te(this,Pe,"f")),n=Math.round(o*te(this,Pe,"f"))):(i=s,n=o),te(this,we,"f")||ee(this,we,document.createElement("canvas"));const a=te(this,we,"f");a.width===i&&a.height===n||(a.width=i,a.height=n),a.ctx2d||(a.ctx2d=a.getContext("2d",{willReadFrequently:!0}));return a.ctx2d.drawImage(t,0,0,s,o,0,0,i,n),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),await this._captureCanvas(a,e)}async _captureCanvas(t,e){if(t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:4*t.width,format:10};return await this._captureInWorker(n,e)}async _captureVideo(t,e){if(t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";let i,n,s=t.videoWidth,o=t.videoHeight,r=Math.max(s,o);r>this.maxImageSideLength?(ee(this,Pe,this.maxImageSideLength/r),i=Math.round(s*te(this,Pe,"f")),n=Math.round(o*te(this,Pe,"f"))):(i=s,n=o),te(this,we,"f")||ee(this,we,document.createElement("canvas"));const a=te(this,we,"f");a.width===i&&a.height===n||(a.width=i,a.height=n),a.ctx2d||(a.ctx2d=a.getContext("2d",{willReadFrequently:!0}));return a.ctx2d.drawImage(t,0,0,s,o,0,0,i,n),await this._captureCanvas(a,e)}async _captureInWorker(t,e){const{bytes:i,width:n,height:s,stride:o,format:r}=t;let a=at();const l=new se;return lt[a]=async e=>{var i,n;if(!e.success){let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,l.reject(t)}{const s=Date.now();Le._onLog&&(Le._onLog(`get result time from worker: ${s}`),Le._onLog("worker to main time consume: "+(s-e.workerReturnMsgTime)));try{const s=e.captureResult;if(0!==s.errorCode){let t=new Error(s.errorString);return t.errorCode=s.errorCode,l.reject(t)}t.bytes=e.bytes;for(let e of s.items)0!==te(this,Pe,"f")&&ke(e,te(this,Pe,"f")),e.type===xt.CRIT_ORIGINAL_IMAGE?e.imageData=t:e.type===xt.CRIT_NORMALIZED_IMAGE?null===(i=gt.ddn)||void 0===i||i.handleNormalizedImageResultItem(e):e.type===xt.CRIT_PARSED_RESULT&&(null===(n=gt.dcp)||void 0===n||n.handleParsedResultItem(e));if(te(this,Ae,"f"))for(let t of te(this,Ee,"f"))t.onDecodedBarcodesReceived(s),t.onRecognizedTextLinesReceived(s),t.onDetectedQuadsReceived(s),t.onNormalizedImagesReceived(s);for(let t in ve){const e=t,i=s.items.filter((t=>t.type===ve[e].type));i.length&&(s[t]=i)}if(!this._isPauseScan||!te(this,Ae,"f")){const e=s.intermediateResult;if(e){let i=0;for(let n of te(this,Ce,"f")._intermediateResultReceiverSet){i++;for(let s of e){if("onTaskResultsReceived"===s.info.callbackName){for(let e of s.intermediateResultUnits)e.originalImageTag=t.tag?t.tag:null;n[s.info.callbackName]&&n[s.info.callbackName]({intermediateResultUnits:s.intermediateResultUnits},s.info)}else n[s.info.callbackName]&&n[s.info.callbackName](s.result,s.info);i===te(this,Ce,"f")._intermediateResultReceiverSet.size&&delete s.info.callbackName}}}}return s&&s.hasOwnProperty("intermediateResult")&&delete s.intermediateResult,ee(this,Pe,0),l.resolve(s)}catch(t){return l.reject(t)}}},Le._onLog&&Le._onLog(`send buffer to worker: ${Date.now()}`),ot.postMessage({type:"cvr_capture",id:a,instanceID:this._instanceID,body:{bytes:i,width:n,height:s,stride:o,format:r,templateName:e||"",isScanner:te(this,Ae,"f")}},[i.buffer]),l}async initSettings(t){return Re(this),t&&["string","object"].includes(typeof t)?("string"==typeof t?t.trimStart().startsWith("{")||(t=await I(t,"text")):"object"==typeof t&&(t=JSON.stringify(t)),await new Promise(((e,i)=>{let n=at();lt[n]=async n=>{if(n.success){const s=JSON.parse(n.response);if(0!==s.errorCode){let t=new Error(s.errorString?s.errorString:"Init Settings Failed.");return t.errorCode=s.errorCode,i(t)}const o=JSON.parse(t);this._currentSettings=o;let r=[],a=o.CaptureVisionTemplates;for(let t=0;t<a.length;t++){let e=await this.containsTask(a[t].Name);r=r.concat(e)}return await vt([...new Set(r)]),this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,Le._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,e(s)}{let t=new Error(n.message);return t.stack=n.stack+"\n"+t.stack,i(t)}},ot.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:t}})}))):console.error("Invalid template.")}async outputSettings(t){return Re(this),await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success){const n=JSON.parse(t.response);if(0!==n.errorCode){let t=new Error(n.errorString);return t.errorCode=n.errorCode,i(t)}return e(JSON.parse(n.data))}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cvr_outputSettings",id:n,instanceID:this._instanceID,body:{templateName:t||"*"}})}))}async outputSettingsToFile(t,e,i){const n=await this.outputSettings(t),s=new Blob([JSON.stringify(n,null,2,(function(t,e){return e instanceof Array?JSON.stringify(e):e}),2)],{type:"application/json"});if(i){const t=document.createElement("a");t.href=URL.createObjectURL(s),e.endsWith(".json")&&(e=e.replace(".json","")),t.download=`${e}.json`,t.onclick=()=>{setTimeout((()=>{URL.revokeObjectURL(t.href)}),500)},t.click()}return s}async getTemplateNames(){return Re(this),await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success){const n=JSON.parse(i.response);if(0!==n.errorCode){let t=new Error(n.errorString);return t.errorCode=n.errorCode,e(t)}return t(JSON.parse(n.data))}{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})}))}async getSimplifiedSettings(t){Re(this),t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const e=await this.containsTask(t);return await vt(e),await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success){const n=JSON.parse(t.response);if(0!==n.errorCode){let t=new Error(n.errorString);return t.errorCode=n.errorCode,i(t)}const s=JSON.parse(n.data,((t,e)=>"barcodeFormatIds"===t?BigInt(e):e));return s.minImageCaptureInterval=this._minImageCaptureInterval,e(s)}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:t}})}))}async updateSettings(t,e){Re(this);const i=await this.containsTask(t);return await vt(i),await new Promise(((i,n)=>{let s=at();lt[s]=async t=>{if(t.success){const s=JSON.parse(t.response);if(e.minImageCaptureInterval&&e.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=e.minImageCaptureInterval),this._isOutputOriginalImage=t.isOutputOriginalImage,0!==s.errorCode){let t=new Error(s.errorString?s.errorString:"Update Settings Failed.");return t.errorCode=s.errorCode,n(t)}return this._currentSettings=await this.outputSettings("*"),i(s)}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},ot.postMessage({type:"cvr_updateSettings",id:s,instanceID:this._instanceID,body:{settings:e,templateName:t}})}))}async resetSettings(){return Re(this),await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success){const n=JSON.parse(i.response);if(0!==n.errorCode){let t=new Error(n.errorString?n.errorString:"Reset Settings Failed.");return t.errorCode=n.errorCode,e(t)}return this._currentSettings=await this.outputSettings("*"),t(n)}{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})}))}getBufferedItemsManager(){return te(this,Se,"f")||ee(this,Se,new oe(this)),te(this,Se,"f")}getIntermediateResultManager(){if(Re(this),!te(this,Ie,"f")&&0!==yt.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return te(this,Ce,"f")||ee(this,Ce,new le(this)),te(this,Ce,"f")}async parseRequiredResources(t){return Re(this),await new Promise(((e,i)=>{let n=at();lt[n]=async t=>{if(t.success)return e(JSON.parse(t.resources));{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}},ot.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:t}})}))}async dispose(){Re(this),te(this,be,"f")&&this.stopCapturing(),ee(this,xe,null),te(this,_e,"f").clear(),te(this,Te,"f").clear(),te(this,Ee,"f").clear(),te(this,Ce,"f")._intermediateResultReceiverSet.clear(),ee(this,De,!0);let t=at();lt[t]=t=>{if(!t.success){let e=new Error(t.message);throw e.stack=t.stack+"\n"+e.stack,e}},ot.postMessage({type:"cvr_dispose",id:t,instanceID:this._instanceID})}_getInternalData(){return{isa:te(this,xe,"f"),promiseStartScan:te(this,be,"f"),intermediateResultManager:te(this,Ce,"f"),bufferdItemsManager:te(this,Se,"f"),resultReceiverSet:te(this,_e,"f"),isaStateListenerSet:te(this,Te,"f"),resultFilterSet:te(this,Ee,"f"),compressRate:te(this,Pe,"f"),canvas:te(this,we,"f"),isScanner:te(this,Ae,"f"),innerUseTag:te(this,Ie,"f"),isDestroyed:te(this,De,"f")}}async _getWasmFilterState(){return await new Promise(((t,e)=>{let i=at();lt[i]=async i=>{if(i.success){const e=JSON.parse(i.response);return t(e)}{let t=new Error(i.message);return t.stack=i.stack+"\n"+t.stack,e(t)}},ot.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})}))}}async function Oe(t,e){return Re(t),await new Promise(((i,n)=>{let s=at();lt[s]=async t=>{if(t.success)return i(t.result);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},ot.postMessage({type:"cvr_enableResultCrossVerification",id:s,instanceID:t._instanceID,body:{verificationEnabled:e}})}))}async function Be(t,e){return Re(t),await new Promise(((i,n)=>{let s=at();lt[s]=async t=>{if(t.success)return i(t.result);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},ot.postMessage({type:"cvr_enableResultDeduplication",id:s,instanceID:t._instanceID,body:{duplicateFilterEnabled:e}})}))}async function Fe(t,e){return Re(t),await new Promise(((i,n)=>{let s=at();lt[s]=async t=>{if(t.success)return i(t.result);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},ot.postMessage({type:"cvr_setDuplicateForgetTime",id:s,instanceID:t._instanceID,body:{duplicateForgetTime:e}})}))}xe=new WeakMap,we=new WeakMap,be=new WeakMap,Ce=new WeakMap,Se=new WeakMap,_e=new WeakMap,Te=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,De=new WeakMap,Le._defaultTemplate="Default";class Ne{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}class Ue{constructor(){this._observedResultUnitTypes=At.IRUT_ALL,this._observedTaskMap=new Map,this._parameters={setObservedResultUnitTypes:t=>{this._observedResultUnitTypes=t},getObservedResultUnitTypes:()=>this._observedResultUnitTypes,isResultUnitTypeObserved:t=>!!(t&this._observedResultUnitTypes),addObservedTask:t=>{this._observedTaskMap.set(t,!0)},removeObservedTask:t=>{this._observedTaskMap.set(t,!1)},isTaskObserved:t=>0===this._observedTaskMap.size||!!this._observedTaskMap.get(t)},this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledDownColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null,this.onShortLinesUnitReceived=null}getObservationParameters(){return this._parameters}}var Ve;!function(t){t.PT_DEFAULT="Default",t.PT_READ_BARCODES="ReadBarcodes_Default",t.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",t.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",t.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",t.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",t.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",t.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",t.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",t.PT_READ_SINGLE_BARCODE="ReadBarcodes_Balanced",t.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",t.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",t.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",t.PT_RECOGNIZE_LETTERS="RecognizeLetters",t.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",t.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",t.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(Ve||(Ve={}));const We="undefined"==typeof self,He="function"==typeof importScripts,je=(()=>{if(!He){if(!We&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})();yt.engineResourcePaths.dce={version:"4.1.1",path:je,isInternal:!0},ft.dce={wasm:!1,js:!1},gt.dce={};let ze,Ge,Ye,$e,Xe,qe=class{static getVersion(){return"4.1.1"}};function Ze(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function Je(t,e,i,n,s){if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s?s.value=i:e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(ze=navigator,Ge=ze.userAgent,Ye=ze.platform,$e=ze.mediaDevices),function(){if(!We){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:ze.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ye,search:"Win"},Mac:{str:Ye},Linux:{str:Ye}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||Ge,r=s.search||e,a=s.verStr||Ge,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||Ge,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=Ge.indexOf("Windows NT")&&(s="HarmonyOS"),Xe={browser:i,version:n,OS:s}}We&&(Xe={browser:"ssr",version:0,OS:"ssr"})}();const Ke="undefined"!=typeof WebAssembly&&Ge&&!(/Safari/.test(Ge)&&!/Chrome/.test(Ge)&&/\(.+\s11_2_([2-6]).*\)/.test(Ge)),Qe=!("undefined"==typeof Worker),ti=!(!$e||!$e.getUserMedia),ei=async()=>{let t=!1;if(ti)try{(await $e.getUserMedia({video:!0})).getTracks().forEach((t=>{t.stop()})),t=!0}catch(t){}return t};"Chrome"===Xe.browser&&Xe.version>66||"Safari"===Xe.browser&&Xe.version>13||"OPR"===Xe.browser&&Xe.version>43||"Edge"===Xe.browser&&Xe.version;var ii={653:(t,e,i)=>{var n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w,b,C,S,_=_||{version:"5.2.1"};if(e.fabric=_,"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?_.document=document:_.document=document.implementation.createHTMLDocument(""),_.window=window;else{var T=new(i(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;_.document=T.document,_.jsdomImplForWrapper=i(898).implForWrapper,_.nodeCanvas=i(245).Canvas,_.window=T,DOMParser=_.window.DOMParser}function E(t,e){var i=t.canvas,n=e.targetCanvas,s=n.getContext("2d");s.translate(0,n.height),s.scale(1,-1);var o=i.height-n.height;s.drawImage(i,0,o,n.width,n.height,0,0,n.width,n.height)}function P(t,e){var i=e.targetCanvas.getContext("2d"),n=e.destinationWidth,s=e.destinationHeight,o=n*s*4,r=new Uint8Array(this.imageBuffer,0,o),a=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,n,s,t.RGBA,t.UNSIGNED_BYTE,r);var l=new ImageData(a,n,s);i.putImageData(l,0,0)}_.isTouchSupported="ontouchstart"in _.window||"ontouchstart"in _.document||_.window&&_.window.navigator&&_.window.navigator.maxTouchPoints>0,_.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,_.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],_.DPI=96,_.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",_.commaWsp="(?:\\s+,?\\s*|,\\s*)",_.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,_.reNonWord=/[ \n\.,;!\?\-]/,_.fontPaths={},_.iMatrix=[1,0,0,1,0,0],_.svgNS="http://www.w3.org/2000/svg",_.perfLimitSizeTotal=2097152,_.maxCacheSideLimit=4096,_.minCacheSideLimit=256,_.charWidthsCache={},_.textureSize=2048,_.disableStyleCopyPaste=!1,_.enableGLFiltering=!0,_.devicePixelRatio=_.window.devicePixelRatio||_.window.webkitDevicePixelRatio||_.window.mozDevicePixelRatio||1,_.browserShadowBlurConstant=1,_.arcToSegmentsCache={},_.boundsOfCurveCache={},_.cachesBoundsOfCurve=!0,_.forceGLPutImageData=!1,_.initFilterBackend=function(){return _.enableGLFiltering&&_.isWebglSupported&&_.isWebglSupported(_.textureSize)?(console.log("max texture size: "+_.maxTextureSize),new _.WebglFilterBackend({tileSize:_.textureSize})):_.Canvas2dFilterBackend?new _.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=_),function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:_.util.array.fill(i,!1)}}function e(t,e){var i=function(){e.apply(this,arguments),this.off(t,i)}.bind(this);this.on(t,i)}_.Observable={fire:function(t,e){if(!this.__eventListeners)return this;var i=this.__eventListeners[t];if(!i)return this;for(var n=0,s=i.length;n<s;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter((function(t){return!1!==t})),this},on:function(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this},once:function(t,i){if(1===arguments.length)for(var n in t)e.call(this,n,t[n]);else e.call(this,t,i);return this},off:function(e,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}}(),_.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var n=this._objects;return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this._objects,i=!1,n=0,s=arguments.length;n<s;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,s=i.length;n<s;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects.concat():this._objects.filter((function(e){return e.type===t}))},item:function(t){return this._objects[t]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(t,e){return this._objects.indexOf(t)>-1||!!e&&this._objects.some((function(e){return"function"==typeof e.contains&&e.contains(t,!0)}))},complexity:function(){return this._objects.reduce((function(t,e){return t+(e.complexity?e.complexity():0)}),0)}},_.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof _.Gradient||this.set(e,new _.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof _.Pattern?i&&i():this.set(e,new _.Pattern(t,i))},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},n=e,s=Math.sqrt,o=Math.atan2,r=Math.pow,a=Math.PI/180,l=Math.PI/2,_.util={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/l){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/l){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*a},radiansToDegrees:function(t){return t/a},rotatePoint:function(t,e,i){var n=new _.Point(t.x-e.x,t.y-e.y),s=_.util.rotateVector(n,i);return new _.Point(s.x,s.y).addEquals(e)},rotateVector:function(t,e){var i=_.util.sin(e),n=_.util.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},createVector:function(t,e){return new _.Point(e.x-t.x,e.y-t.y)},calcAngleBetweenVectors:function(t,e){return Math.acos((t.x*e.x+t.y*e.y)/(Math.hypot(t.x,t.y)*Math.hypot(e.x,e.y)))},getHatVector:function(t){return new _.Point(t.x,t.y).multiply(1/Math.hypot(t.x,t.y))},getBisector:function(t,e,i){var n=_.util.createVector(t,e),s=_.util.createVector(t,i),o=_.util.calcAngleBetweenVectors(n,s),r=o*(0===_.util.calcAngleBetweenVectors(_.util.rotateVector(n,o),s)?1:-1)/2;return{vector:_.util.getHatVector(_.util.rotateVector(n,r)),angle:o}},projectStrokeOnPoints:function(t,e,i){var n=[],s=e.strokeWidth/2,o=e.strokeUniform?new _.Point(1/e.scaleX,1/e.scaleY):new _.Point(1,1),r=function(t){var e=s/Math.hypot(t.x,t.y);return new _.Point(t.x*e*o.x,t.y*e*o.y)};return t.length<=1||t.forEach((function(a,l){var h,c,d=new _.Point(a.x,a.y);0===l?(c=t[l+1],h=i?r(_.util.createVector(c,d)).addEquals(d):t[t.length-1]):l===t.length-1?(h=t[l-1],c=i?r(_.util.createVector(h,d)).addEquals(d):t[0]):(h=t[l-1],c=t[l+1]);var u,p,g=_.util.getBisector(d,h,c),f=g.vector,m=g.angle;if("miter"===e.strokeLineJoin&&(u=-s/Math.sin(m/2),p=new _.Point(f.x*u*o.x,f.y*u*o.y),Math.hypot(p.x,p.y)/s<=e.strokeMiterLimit))return n.push(d.add(p)),void n.push(d.subtract(p));u=-s*Math.SQRT2,p=new _.Point(f.x*u*o.x,f.y*u*o.y),n.push(d.add(p)),n.push(d.subtract(p))})),n},transformPoint:function(t,e,i){return i?new _.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new _.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t,e){if(e)for(var i=0;i<t.length;i++)t[i]=_.util.transformPoint(t[i],e);var n=[t[0].x,t[1].x,t[2].x,t[3].x],s=_.util.array.min(n),o=_.util.array.max(n)-s,r=[t[0].y,t[1].y,t[2].y,t[3].y],a=_.util.array.min(r);return{left:s,top:a,width:o,height:_.util.array.max(r)-a}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=_.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=_.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*_.DPI/25.4;case"cm":return n*_.DPI/2.54;case"in":return n*_.DPI;case"pt":return n*_.DPI/72;case"pc":return n*_.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=_.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),_.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(t){if(!t)return _;var e,i=t.split("."),s=i.length,o=n||_.window;for(e=0;e<s;++e)o=o[i[e]];return o},loadImage:function(t,e,i,n){if(t){var s=_.util.createImage(),o=function(){e&&e.call(i,s,!1),s=s.onload=s.onerror=null};s.onload=o,s.onerror=function(){_.log("Error loading "+s.src),e&&e.call(i,null,!0),s=s.onload=s.onerror=null},0!==t.indexOf("data")&&null!=n&&(s.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(s.onload=null,_.util.loadImageInDom(s,o)),s.src=t}else e&&e.call(i,t)},loadImageInDom:function(t,e){var i=_.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),_.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){var s=[],o=0,r=(t=t||[]).length;function a(){++o===r&&e&&e(s.filter((function(t){return t})))}r?t.forEach((function(t,e){t&&t.type?_.util.getKlass(t.type,i).fromObject(t,(function(i,o){o||(s[e]=i),n&&n(t,i,o),a()})):a()})):e&&e(s)},enlivenObjectEnlivables:function(t,e,i){var n=_.Object.ENLIVEN_PROPS.filter((function(e){return!!t[e]}));_.util.enlivenObjects(n.map((function(e){return t[e]})),(function(t){var s={};n.forEach((function(i,n){s[i]=t[n],e&&(e[i]=t[n])})),i&&i(s)}))},enlivenPatterns:function(t,e){function i(){++s===o&&e&&e(n)}var n=[],s=0,o=(t=t||[]).length;o?t.forEach((function(t,e){t&&t.source?new _.Pattern(t,(function(t){n[e]=t,i()})):(n[e]=t,i())})):e&&e(n)},groupSVGElements:function(t,e,i){var n;return t&&1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new _.Group(t,e),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&Array.isArray(i))for(var n=0,s=i.length;n<s;n++)i[n]in t&&(e[i[n]]=t[i[n]])},createCanvasElement:function(){return _.document.createElement("canvas")},copyCanvasElement:function(t){var e=_.util.createCanvasElement();return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},toDataURL:function(t,e,i){return t.toDataURL("image/"+e,i)},createImage:function(){return _.document.createElement("img")},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=o(t[1],t[0]),i=r(t[0],2)+r(t[1],2),n=s(i),l=(t[0]*t[3]-t[2]*t[1])/n,h=o(t[0]*t[2]+t[1]*t[3],i);return{angle:e/a,scaleX:n,scaleY:l,skewX:h/a,skewY:0,translateX:t[4],translateY:t[5]}},calcRotateMatrix:function(t){if(!t.angle)return _.iMatrix.concat();var e=_.util.degreesToRadians(t.angle),i=_.util.cos(e),n=_.util.sin(e);return[i,n,-n,i,0,0]},calcDimensionsMatrix:function(t){var e=void 0===t.scaleX?1:t.scaleX,i=void 0===t.scaleY?1:t.scaleY,n=[t.flipX?-e:e,0,0,t.flipY?-i:i,0,0],s=_.util.multiplyTransformMatrices,o=_.util.degreesToRadians;return t.skewX&&(n=s(n,[1,0,Math.tan(o(t.skewX)),1],!0)),t.skewY&&(n=s(n,[1,Math.tan(o(t.skewY)),0,1],!0)),n},composeMatrix:function(t){var e=[1,0,0,1,t.translateX||0,t.translateY||0],i=_.util.multiplyTransformMatrices;return t.angle&&(e=i(e,_.util.calcRotateMatrix(t))),(1!==t.scaleX||1!==t.scaleY||t.skewX||t.skewY||t.flipX||t.flipY)&&(e=i(e,_.util.calcDimensionsMatrix(t))),e},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},saveObjectTransform:function(t){return{scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var s,o=!0,r=t.getImageData(e,i,2*n||1,2*n||1),a=r.data.length;for(s=3;s<a&&0!=(o=r.data[s]<=0);s+=4);return r=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?_.charWidthsCache[t]&&delete _.charWidthsCache[t]:_.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)},matrixToSVG:function(t){return"matrix("+t.map((function(t){return _.util.toFixed(t,_.Object.NUM_FRACTION_DIGITS)})).join(" ")+")"},removeTransformFromObject:function(t,e){var i=_.util.invertTransform(e),n=_.util.multiplyTransformMatrices(i,t.calcOwnMatrix());_.util.applyTransformToObject(t,n)},addTransformToObject:function(t,e){_.util.applyTransformToObject(t,_.util.multiplyTransformMatrices(e,t.calcOwnMatrix()))},applyTransformToObject:function(t,e){var i=_.util.qrDecompose(e),n=new _.Point(i.translateX,i.translateY);t.flipX=!1,t.flipY=!1,t.set("scaleX",i.scaleX),t.set("scaleY",i.scaleY),t.skewX=i.skewX,t.skewY=i.skewY,t.angle=i.angle,t.setPositionByOrigin(n,"center","center")},sizeAfterTransform:function(t,e,i){var n=t/2,s=e/2,o=[{x:-n,y:-s},{x:n,y:-s},{x:-n,y:s},{x:n,y:s}],r=_.util.calcDimensionsMatrix(i),a=_.util.makeBoundingBoxFromPoints(o,r);return{x:a.width,y:a.height}},mergeClipPaths:function(t,e){var i=t,n=e;i.inverted&&!n.inverted&&(i=e,n=t),_.util.applyTransformToObject(n,_.util.multiplyTransformMatrices(_.util.invertTransform(i.calcTransformMatrix()),n.calcTransformMatrix()));var s=i.inverted&&n.inverted;return s&&(i.inverted=n.inverted=!1),new _.Group([i],{clipPath:n,inverted:s})}},function(){var t=Array.prototype.join,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};function n(t,e,i,n,s,o,r,a,l,h,c){var d=_.util.cos(t),u=_.util.sin(t),p=_.util.cos(e),g=_.util.sin(e),f=i*s*p-n*o*g+r,m=n*s*p+i*o*g+a;return["C",h+l*(-i*s*u-n*o*d),c+l*(-n*s*u+i*o*d),f+l*(i*s*g+n*o*p),m+l*(n*s*g-i*o*p),f,m]}function s(t,e,i,n){var s=Math.atan2(e,t),o=Math.atan2(n,i);return o>=s?o-s:2*Math.PI-(s-o)}function o(t,e,i){for(var o=i[1],r=i[2],a=i[3],l=i[4],h=i[5],c=function(t,e,i,o,r,a,l){var h=Math.PI,c=l*h/180,d=_.util.sin(c),u=_.util.cos(c),p=0,g=0,f=-u*t*.5-d*e*.5,m=-u*e*.5+d*t*.5,v=(i=Math.abs(i))*i,y=(o=Math.abs(o))*o,x=m*m,w=f*f,b=v*y-v*x-y*w,C=0;if(b<0){var S=Math.sqrt(1-b/(v*y));i*=S,o*=S}else C=(r===a?-1:1)*Math.sqrt(b/(v*x+y*w));var T=C*i*m/o,E=-C*o*f/i,P=u*T-d*E+.5*t,A=d*T+u*E+.5*e,I=s(1,0,(f-T)/i,(m-E)/o),D=s((f-T)/i,(m-E)/o,(-f-T)/i,(-m-E)/o);0===a&&D>0?D-=2*h:1===a&&D<0&&(D+=2*h);for(var k=Math.ceil(Math.abs(D/h*2)),R=[],M=D/k,L=8/3*Math.sin(M/4)*Math.sin(M/4)/Math.sin(M/2),O=I+M,B=0;B<k;B++)R[B]=n(I,O,u,d,i,o,P,A,L,p,g),p=R[B][5],g=R[B][6],I=O,O+=M;return R}(i[6]-t,i[7]-e,o,r,l,h,a),d=0,u=c.length;d<u;d++)c[d][1]+=t,c[d][2]+=e,c[d][3]+=t,c[d][4]+=e,c[d][5]+=t,c[d][6]+=e;return c}function r(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))}function a(t,e,i,n,s,o,r,a){return function(l){var h,c=(h=l)*h*h,d=function(t){return 3*t*t*(1-t)}(l),u=function(t){return 3*t*(1-t)*(1-t)}(l),p=function(t){return(1-t)*(1-t)*(1-t)}(l);return{x:r*c+s*d+i*u+t*p,y:a*c+o*d+n*u+e*p}}}function l(t,e,i,n,s,o,r,a){return function(l){var h=1-l,c=3*h*h*(i-t)+6*h*l*(s-i)+3*l*l*(r-s),d=3*h*h*(n-e)+6*h*l*(o-n)+3*l*l*(a-o);return Math.atan2(d,c)}}function h(t,e,i,n,s,o){return function(r){var a,l=(a=r)*a,h=function(t){return 2*t*(1-t)}(r),c=function(t){return(1-t)*(1-t)}(r);return{x:s*l+i*h+t*c,y:o*l+n*h+e*c}}}function c(t,e,i,n,s,o){return function(r){var a=1-r,l=2*a*(i-t)+2*r*(s-i),h=2*a*(n-e)+2*r*(o-n);return Math.atan2(h,l)}}function d(t,e,i){var n,s,o={x:e,y:i},a=0;for(s=1;s<=100;s+=1)n=t(s/100),a+=r(o.x,o.y,n.x,n.y),o=n;return a}function u(t){for(var e,i,n,s,o=0,u=t.length,p=0,g=0,f=0,m=0,v=[],y=0;y<u;y++){switch(n={x:p,y:g,command:(e=t[y])[0]},e[0]){case"M":n.length=0,f=p=e[1],m=g=e[2];break;case"L":n.length=r(p,g,e[1],e[2]),p=e[1],g=e[2];break;case"C":i=a(p,g,e[1],e[2],e[3],e[4],e[5],e[6]),s=l(p,g,e[1],e[2],e[3],e[4],e[5],e[6]),n.iterator=i,n.angleFinder=s,n.length=d(i,p,g),p=e[5],g=e[6];break;case"Q":i=h(p,g,e[1],e[2],e[3],e[4]),s=c(p,g,e[1],e[2],e[3],e[4]),n.iterator=i,n.angleFinder=s,n.length=d(i,p,g),p=e[3],g=e[4];break;case"Z":case"z":n.destX=f,n.destY=m,n.length=r(p,g,f,m),p=f,g=m}o+=n.length,v.push(n)}return v.push({length:o,x:p,y:g}),v}_.util.joinPath=function(t){return t.map((function(t){return t.join(" ")})).join(" ")},_.util.parsePath=function(t){var n,s,o,r,a,l=[],h=[],c=_.rePathCommand,d="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",u="("+d+")"+_.commaWsp,p="([01])"+_.commaWsp+"?",g=new RegExp(u+"?"+u+"?"+u+p+p+u+"?("+d+")","g");if(!t||!t.match)return l;for(var f,m=0,v=(a=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;m<v;m++){r=(n=a[m]).slice(1).trim(),h.length=0;var y=n.charAt(0);if(f=[y],"a"===y.toLowerCase())for(var x;x=g.exec(r);)for(var w=1;w<x.length;w++)h.push(x[w]);else for(;o=c.exec(r);)h.push(o[0]);w=0;for(var b=h.length;w<b;w++)s=parseFloat(h[w]),isNaN(s)||f.push(s);var C=e[y.toLowerCase()],S=i[y]||y;if(f.length-1>C)for(var T=1,E=f.length;T<E;T+=C)l.push([y].concat(f.slice(T,T+C))),y=S;else l.push(f)}return l},_.util.makePathSimpler=function(t){var e,i,n,s,r,a,l=0,h=0,c=t.length,d=0,u=0,p=[];for(i=0;i<c;++i){switch(n=!1,(e=t[i].slice(0))[0]){case"l":e[0]="L",e[1]+=l,e[2]+=h;case"L":l=e[1],h=e[2];break;case"h":e[1]+=l;case"H":e[0]="L",e[2]=h,l=e[1];break;case"v":e[1]+=h;case"V":e[0]="L",h=e[1],e[1]=l,e[2]=h;break;case"m":e[0]="M",e[1]+=l,e[2]+=h;case"M":l=e[1],h=e[2],d=e[1],u=e[2];break;case"c":e[0]="C",e[1]+=l,e[2]+=h,e[3]+=l,e[4]+=h,e[5]+=l,e[6]+=h;case"C":r=e[3],a=e[4],l=e[5],h=e[6];break;case"s":e[0]="S",e[1]+=l,e[2]+=h,e[3]+=l,e[4]+=h;case"S":"C"===s?(r=2*l-r,a=2*h-a):(r=l,a=h),l=e[3],h=e[4],e[0]="C",e[5]=e[3],e[6]=e[4],e[3]=e[1],e[4]=e[2],e[1]=r,e[2]=a,r=e[3],a=e[4];break;case"q":e[0]="Q",e[1]+=l,e[2]+=h,e[3]+=l,e[4]+=h;case"Q":r=e[1],a=e[2],l=e[3],h=e[4];break;case"t":e[0]="T",e[1]+=l,e[2]+=h;case"T":"Q"===s?(r=2*l-r,a=2*h-a):(r=l,a=h),e[0]="Q",l=e[1],h=e[2],e[1]=r,e[2]=a,e[3]=l,e[4]=h;break;case"a":e[0]="A",e[6]+=l,e[7]+=h;case"A":n=!0,p=p.concat(o(l,h,e)),l=e[6],h=e[7];break;case"z":case"Z":l=d,h=u}n||p.push(e),s=e[0]}return p},_.util.getSmoothPathFromPoints=function(t,e){var i,n=[],s=new _.Point(t[0].x,t[0].y),o=new _.Point(t[1].x,t[1].y),r=t.length,a=1,l=0,h=r>2;for(e=e||0,h&&(a=t[2].x<o.x?-1:t[2].x===o.x?0:1,l=t[2].y<o.y?-1:t[2].y===o.y?0:1),n.push(["M",s.x-a*e,s.y-l*e]),i=1;i<r;i++){if(!s.eq(o)){var c=s.midPointFrom(o);n.push(["Q",s.x,s.y,c.x,c.y])}s=t[i],i+1<t.length&&(o=t[i+1])}return h&&(a=s.x>t[i-2].x?1:s.x===t[i-2].x?0:-1,l=s.y>t[i-2].y?1:s.y===t[i-2].y?0:-1),n.push(["L",s.x+a*e,s.y+l*e]),n},_.util.getPathSegmentsInfo=u,_.util.getBoundsOfCurve=function(e,i,n,s,o,r,a,l){var h;if(_.cachesBoundsOfCurve&&(h=t.call(arguments),_.boundsOfCurveCache[h]))return _.boundsOfCurveCache[h];var c,d,u,p,g,f,m,v,y=Math.sqrt,x=Math.min,w=Math.max,b=Math.abs,C=[],S=[[],[]];d=6*e-12*n+6*o,c=-3*e+9*n-9*o+3*a,u=3*n-3*e;for(var T=0;T<2;++T)if(T>0&&(d=6*i-12*s+6*r,c=-3*i+9*s-9*r+3*l,u=3*s-3*i),b(c)<1e-12){if(b(d)<1e-12)continue;0<(p=-u/d)&&p<1&&C.push(p)}else(m=d*d-4*u*c)<0||(0<(g=(-d+(v=y(m)))/(2*c))&&g<1&&C.push(g),0<(f=(-d-v)/(2*c))&&f<1&&C.push(f));for(var E,P,A,I=C.length,D=I;I--;)E=(A=1-(p=C[I]))*A*A*e+3*A*A*p*n+3*A*p*p*o+p*p*p*a,S[0][I]=E,P=A*A*A*i+3*A*A*p*s+3*A*p*p*r+p*p*p*l,S[1][I]=P;S[0][D]=e,S[1][D]=i,S[0][D+1]=a,S[1][D+1]=l;var k=[{x:x.apply(null,S[0]),y:x.apply(null,S[1])},{x:w.apply(null,S[0]),y:w.apply(null,S[1])}];return _.cachesBoundsOfCurve&&(_.boundsOfCurveCache[h]=k),k},_.util.getPointOnPath=function(t,e,i){i||(i=u(t));for(var n=0;e-i[n].length>0&&n<i.length-2;)e-=i[n].length,n++;var s,o=i[n],a=e/o.length,l=o.command,h=t[n];switch(l){case"M":return{x:o.x,y:o.y,angle:0};case"Z":case"z":return(s=new _.Point(o.x,o.y).lerp(new _.Point(o.destX,o.destY),a)).angle=Math.atan2(o.destY-o.y,o.destX-o.x),s;case"L":return(s=new _.Point(o.x,o.y).lerp(new _.Point(h[1],h[2]),a)).angle=Math.atan2(h[2]-o.y,h[1]-o.x),s;case"C":case"Q":return function(t,e){for(var i,n,s,o=0,a=0,l=t.iterator,h={x:t.x,y:t.y},c=.01,d=t.angleFinder;a<e&&c>1e-4;)i=l(o),s=o,(n=r(h.x,h.y,i.x,i.y))+a>e?(o-=c,c/=2):(h=i,o+=c,a+=n);return i.angle=d(s),i}(o,e)}},_.util.transformPath=function(t,e,i){return i&&(e=_.util.multiplyTransformMatrices(e,[1,0,0,1,-i.x,-i.y])),t.map((function(t){for(var i=t.slice(0),n={},s=1;s<t.length-1;s+=2)n.x=t[s],n.y=t[s+1],n=_.util.transformPoint(n,e),i[s]=n.x,i[s+1]=n.y;return i}))}}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,s=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],s)&&(s=t[n][e]);else for(;n--;)i(t[n],s)&&(s=t[n]);return s}}_.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),s=[],o=0,r=e.length;o<r;o++)s[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o]);return s},min:function(t,i){return e(t,i,(function(t,e){return t<e}))},max:function(t,i){return e(t,i,(function(t,e){return t>=e}))}}}(),function(){function t(e,i,n){if(n)if(!_.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var s=0,o=i.length;s<o;s++)e[s]=t({},i[s],n)}else if(i&&"object"==typeof i)for(var r in i)"canvas"===r||"group"===r?e[r]=null:i.hasOwnProperty(r)&&(e[r]=t({},i[r],n));else e=i;else for(var r in i)e[r]=i[r];return e}_.util.object={extend:t,clone:function(e,i){return t({},e,i)}},_.util.object.extend(_.util,_.Observable)}(),function(){function t(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||i>57343)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(e+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var s=t.charCodeAt(e-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}_.util.string={camelize:function(t){return t.replace(/-+(.)?/g,(function(t,e){return e?e.toUpperCase():""}))},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(e){var i,n=0,s=[];for(n=0;n<e.length;n++)!1!==(i=t(e,n))&&s.push(i);return s}}}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var s in e)s in t.prototype&&"function"==typeof t.prototype[s]&&(e[s]+"").indexOf("callSuper")>-1?t.prototype[s]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var s=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return s}}(s):t.prototype[s]=e[s],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function s(){}function o(e){for(var i=null,n=this;n.constructor.superclass;){var s=n.constructor.superclass.prototype[e];if(n[e]!==s){i=s;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}_.util.createClass=function(){var i=null,r=t.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof r[0]&&(i=r.shift()),a.superclass=i,a.subclasses=[],i&&(s.prototype=i.prototype,a.prototype=new s,i.subclasses.push(a));for(var l=0,h=r.length;l<h;l++)n(a,r[l],i);return a.prototype.initialize||(a.prototype.initialize=e),a.prototype.constructor=a,a.prototype.callSuper=o,a}}(),h=!!_.document.createElement("div").attachEvent,c=["touchstart","touchmove","touchend"],_.util.addListener=function(t,e,i,n){t&&t.addEventListener(e,i,!h&&n)},_.util.removeListener=function(t,e,i,n){t&&t.removeEventListener(e,i,!h&&n)},_.util.getPointer=function(t){var e=t.target,i=_.util.getScrollLeftTop(e),n=function(t){var e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return{x:n.clientX+i.left,y:n.clientY+i.top}},_.util.isTouchEvent=function(t){return c.indexOf(t.type)>-1||"touch"===t.pointerType},u="string"==typeof(d=_.document.createElement("div")).style.opacity,p="string"==typeof d.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(t){return t},u?f=function(t,e){return t.style.opacity=e,t}:p&&(f=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),g.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(g,e)):i.filter+=" alpha(opacity="+100*e+")",t}),_.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?f(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?f(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t},function(){var t,e,i,n,s=Array.prototype.slice,o=function(t){return s.call(t,0)};try{t=o(_.document.childNodes)instanceof Array}catch(t){}function r(t,e){var i=_.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function a(t){for(var e=0,i=0,n=_.document.documentElement,s=_.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===_.document?(e=s.scrollLeft||n.scrollLeft||0,i=s.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:i}}t||(o=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),e=_.document.defaultView&&_.document.defaultView.getComputedStyle?function(t,e){var i=_.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},i=_.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",_.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=_.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},_.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},_.util.setImageSmoothing=function(t,e){t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=e},_.util.getById=function(t){return"string"==typeof t?_.document.getElementById(t):t},_.util.toArray=o,_.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},_.util.makeElement=r,_.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=r(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},_.util.getScrollLeftTop=a,_.util.getElementOffset=function(t){var i,n,s=t&&t.ownerDocument,o={left:0,top:0},r={left:0,top:0},l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!s)return r;for(var h in l)r[l[h]]+=parseInt(e(t,h),10)||0;return i=s.documentElement,void 0!==t.getBoundingClientRect&&(o=t.getBoundingClientRect()),n=a(t),{left:o.left+n.left-(i.clientLeft||0)+r.left,top:o.top+n.top-(i.clientTop||0)+r.top}},_.util.getNodeCanvas=function(t){var e=_.jsdomImplForWrapper(t);return e._canvas||e._image},_.util.cleanUpJsdomNode=function(t){if(_.isLikelyNode){var e=_.jsdomImplForWrapper(t);e&&(e._image=null,e._canvas=null,e._currentSrc=null,e._attributes=null,e._classList=null)}}}(),function(){function t(){}_.util.request=function(e,i){i||(i={});var n=i.method?i.method.toUpperCase():"GET",s=i.onComplete||function(){},o=new _.window.XMLHttpRequest,r=i.body||i.parameters;return o.onreadystatechange=function(){4===o.readyState&&(s(o),o.onreadystatechange=t)},"GET"===n&&(r=null,"string"==typeof i.parameters&&(e=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(e,i.parameters))),o.open(n,e,!0),"POST"!==n&&"PUT"!==n||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(r),o}}(),_.log=console.log,_.warn=console.warn,function(){var t=_.util.object.extend,e=_.util.object.clone,i=[];function n(){return!1}function s(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e}_.util.object.extend(i,{cancelAll:function(){var t=this.splice(0);return t.forEach((function(t){t.cancel()})),t},cancelByCanvas:function(t){if(!t)return[];var e=this.filter((function(e){return"object"==typeof e.target&&e.target.canvas===t}));return e.forEach((function(t){t.cancel()})),e},cancelByTarget:function(t){var e=this.findAnimationsByTarget(t);return e.forEach((function(t){t.cancel()})),e},findAnimationIndex:function(t){return this.indexOf(this.findAnimation(t))},findAnimation:function(t){return this.find((function(e){return e.cancel===t}))},findAnimationsByTarget:function(t){return t?this.filter((function(e){return e.target===t})):[]}});var o=_.window.requestAnimationFrame||_.window.webkitRequestAnimationFrame||_.window.mozRequestAnimationFrame||_.window.oRequestAnimationFrame||_.window.msRequestAnimationFrame||function(t){return _.window.setTimeout(t,1e3/60)},r=_.window.cancelAnimationFrame||_.window.clearTimeout;function a(){return o.apply(_.window,arguments)}_.util.animate=function(i){i||(i={});var o,r=!1,l=function(){var t=_.runningAnimations.indexOf(o);return t>-1&&_.runningAnimations.splice(t,1)[0]};return o=t(e(i),{cancel:function(){return r=!0,l()},currentValue:"startValue"in i?i.startValue:0,completionRate:0,durationRate:0}),_.runningAnimations.push(o),a((function(t){var e,h=t||+new Date,c=i.duration||500,d=h+c,u=i.onChange||n,p=i.abort||n,g=i.onComplete||n,f=i.easing||s,m="startValue"in i&&i.startValue.length>0,v="startValue"in i?i.startValue:0,y="endValue"in i?i.endValue:100,x=i.byValue||(m?v.map((function(t,e){return y[e]-v[e]})):y-v);i.onStart&&i.onStart(),function t(i){var n=(e=i||+new Date)>d?c:e-h,s=n/c,w=m?v.map((function(t,e){return f(n,v[e],x[e],c)})):f(n,v,x,c),b=m?Math.abs((w[0]-v[0])/x[0]):Math.abs((w-v)/x);if(o.currentValue=m?w.slice():w,o.completionRate=b,o.durationRate=s,!r){if(!p(w,b,s))return e>d?(o.currentValue=m?y.slice():y,o.completionRate=1,o.durationRate=1,u(m?y.slice():y,1,1),g(y,1,1),void l()):(u(w,b,s),void a(t));l()}}(h)})),o.cancel},_.util.requestAnimFrame=a,_.util.cancelAnimFrame=function(){return r.apply(_.window,arguments)},_.runningAnimations=i}(),function(){function t(t,e,i){var n="rgba("+parseInt(t[0]+i*(e[0]-t[0]),10)+","+parseInt(t[1]+i*(e[1]-t[1]),10)+","+parseInt(t[2]+i*(e[2]-t[2]),10);return(n+=","+(t&&e?parseFloat(t[3]+i*(e[3]-t[3])):1))+")"}_.util.animateColor=function(e,i,n,s){var o=new _.Color(e).getSource(),r=new _.Color(i).getSource(),a=s.onComplete,l=s.onChange;return s=s||{},_.util.animate(_.util.object.extend(s,{duration:n||500,startValue:o,endValue:r,byValue:r,easing:function(e,i,n,o){return t(i,n,s.colorEasing?s.colorEasing(e,o):1-Math.cos(e/o*(Math.PI/2)))},onComplete:function(e,i,n){if(a)return a(t(r,r,0),i,n)},onChange:function(e,i,n){if(l){if(Array.isArray(e))return l(t(e,e,0),i,n);l(e,i,n)}}}))}}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,s){return i-n(s-t,0,i,s)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}_.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,s,o){var r=0;return 0===i?n:1==(i/=o)?n+s:(r||(r=.3*o),-e(t(s,s,r,1.70158),i,o)+n)},easeOutElastic:function(e,i,n,s){var o=0;if(0===e)return i;if(1==(e/=s))return i+n;o||(o=.3*s);var r=t(n,n,o,1.70158);return r.a*Math.pow(2,-10*e)*Math.sin((e*s-r.s)*(2*Math.PI)/r.p)+r.c+i},easeInOutElastic:function(i,n,s,o){var r=0;if(0===i)return n;if(2==(i/=o/2))return n+s;r||(r=o*(.3*1.5));var a=t(s,s,r,1.70158);return i<1?-.5*e(a,i,o)+n:a.a*Math.pow(2,-10*(i-=1))*Math.sin((i*o-a.s)*(2*Math.PI)/a.p)*.5+a.c+n},easeInBack:function(t,e,i,n,s){return void 0===s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},easeOutBack:function(t,e,i,n,s){return void 0===s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},easeInOutBack:function(t,e,i,n,s){return void 0===s&&(s=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,s,o){return t<o/2?.5*i(2*t,0,s,o)+e:.5*n(2*t-o,0,s,o)+.5*s+e}}}(),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,s=e.util.toFixed,o=e.util.parseUnit,r=e.util.multiplyTransformMatrices,a={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},l={stroke:"strokeOpacity",fill:"fillOpacity"},h="font-size",c="clip-path";function d(t){return t in a?a[t]:t}function u(t,i,n,s){var a,l=Array.isArray(i);if("fill"!==t&&"stroke"!==t||"none"!==i){if("strokeUniform"===t)return"non-scaling-stroke"===i;if("strokeDashArray"===t)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)i=n&&n.transformMatrix?r(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i);else if("visible"===t)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===t)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===t)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===t)a=o(i,s)/s*1e3;else if("paintFirst"===t){var h=i.indexOf("fill"),c=i.indexOf("stroke");i="fill",(h>-1&&c>-1&&c<h||-1===h&&c>-1)&&(i="stroke")}else{if("href"===t||"xlink:href"===t||"font"===t)return i;if("imageSmoothing"===t)return"optimizeQuality"===i;a=l?i.map(o):o(i,s)}}else i="";return!l&&isNaN(a)?i:a}function p(t){return new RegExp("^("+t.join("|")+")\\b","i")}function g(t,e){var i,n,s,o,r=[];for(s=0,o=e.length;s<o;s++)i=e[s],n=t.getElementsByTagName(i),r=r.concat(Array.prototype.slice.call(n));return r}function f(t,e){var i,n=!0;return(i=m(t,e.pop()))&&e.length&&(n=function(t,e){for(var i,n=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),n=m(t=t.parentNode,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function m(t,e){var i,n,s=t.nodeName,o=t.getAttribute("class"),r=t.getAttribute("id");if(i=new RegExp("^"+s,"i"),e=e.replace(i,""),r&&e.length&&(i=new RegExp("#"+r+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),o&&e.length)for(n=(o=o.split(" ")).length;n--;)i=new RegExp("\\."+o[n]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function v(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,s,o,r=t.getElementsByTagName("*");for(s=0,o=r.length;s<o;s++)if(e===(n=r[s]).getAttribute("id"))return n}e.svgValidTagNamesRegEx=p(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),e.svgViewBoxElementsRegEx=p(["symbol","image","marker","pattern","view","svg"]),e.svgInvalidAncestorsRegEx=p(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),e.svgValidParentsRegEx=p(["symbol","g","a","svg","clipPath","defs"]),e.cssRules={},e.gradientDefs={},e.clipPaths={},e.parseTransformAttribute=function(){function t(t,i,n){t[n]=Math.tan(e.util.degreesToRadians(i[0]))}var i=e.iMatrix,n=e.reNum,s=e.commaWsp,o="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+s+"("+n+")"+s+"("+n+")"+s+"("+n+")"+s+"("+n+")"+s+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+s+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+s+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+s+"("+n+")"+s+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",r=new RegExp("^\\s*(?:(?:"+o+"(?:"+s+"*"+o+")*)?)\\s*$"),a=new RegExp(o,"g");return function(n){var s=i.concat(),l=[];if(!n||n&&!r.test(n))return s;n.replace(a,(function(n){var r=new RegExp(o).exec(n).filter((function(t){return!!t})),a=r[1],h=r.slice(2).map(parseFloat);switch(a){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(s,h);break;case"rotate":h[0]=e.util.degreesToRadians(h[0]),function(t,i){var n=e.util.cos(i[0]),s=e.util.sin(i[0]),o=0,r=0;3===i.length&&(o=i[1],r=i[2]),t[0]=n,t[1]=s,t[2]=-s,t[3]=n,t[4]=o-(n*o-s*r),t[5]=r-(s*o+n*r)}(s,h);break;case"scale":!function(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}(s,h);break;case"skewX":t(s,h,2);break;case"skewY":t(s,h,1);break;case"matrix":s=h}l.push(s.concat()),s=i.concat()}));for(var h=l[0];l.length>1;)l.shift(),h=e.util.multiplyTransformMatrices(h,l[0]);return h}}();var y=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function x(t){if(!e.svgViewBoxElementsRegEx.test(t.nodeName))return{};var i,n,s,r,a,l,h=t.getAttribute("viewBox"),c=1,d=1,u=t.getAttribute("width"),p=t.getAttribute("height"),g=t.getAttribute("x")||0,f=t.getAttribute("y")||0,m=t.getAttribute("preserveAspectRatio")||"",v=!h||!(h=h.match(y)),x=!u||!p||"100%"===u||"100%"===p,w=v&&x,b={},C="",S=0,_=0;if(b.width=0,b.height=0,b.toBeParsed=w,v&&(g||f)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(C=" translate("+o(g)+" "+o(f)+") ",a=(t.getAttribute("transform")||"")+C,t.setAttribute("transform",a),t.removeAttribute("x"),t.removeAttribute("y")),w)return b;if(v)return b.width=o(u),b.height=o(p),b;if(i=-parseFloat(h[1]),n=-parseFloat(h[2]),s=parseFloat(h[3]),r=parseFloat(h[4]),b.minX=i,b.minY=n,b.viewBoxWidth=s,b.viewBoxHeight=r,x?(b.width=s,b.height=r):(b.width=o(u),b.height=o(p),c=b.width/s,d=b.height/r),"none"!==(m=e.util.parsePreserveAspectRatioAttribute(m)).alignX&&("meet"===m.meetOrSlice&&(d=c=c>d?d:c),"slice"===m.meetOrSlice&&(d=c=c>d?c:d),S=b.width-s*c,_=b.height-r*c,"Mid"===m.alignX&&(S/=2),"Mid"===m.alignY&&(_/=2),"Min"===m.alignX&&(S=0),"Min"===m.alignY&&(_=0)),1===c&&1===d&&0===i&&0===n&&0===g&&0===f)return b;if((g||f)&&"#document"!==t.parentNode.nodeName&&(C=" translate("+o(g)+" "+o(f)+") "),a=C+" matrix("+c+" 0 0 "+d+" "+(i*c+S)+" "+(n*d+_)+") ","svg"===t.nodeName){for(l=t.ownerDocument.createElementNS(e.svgNS,"g");t.firstChild;)l.appendChild(t.firstChild);t.appendChild(l)}else(l=t).removeAttribute("x"),l.removeAttribute("y"),a=l.getAttribute("transform")+a;return l.setAttribute("transform",a),b}function w(t,e){var i="xlink:href",n=v(t,e.getAttribute(i).slice(1));if(n&&n.getAttribute(i)&&w(t,n),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach((function(t){n&&!e.hasAttribute(t)&&n.hasAttribute(t)&&e.setAttribute(t,n.getAttribute(t))})),!e.children.length)for(var s=n.cloneNode(!0);s.firstChild;)e.appendChild(s.firstChild);e.removeAttribute(i)}e.parseSVGDocument=function(t,i,s,o){if(t){!function(t){for(var i=g(t,["use","svg:use"]),n=0;i.length&&n<i.length;){var s=i[n],o=s.getAttribute("xlink:href")||s.getAttribute("href");if(null===o)return;var r,a,l,h,c=o.slice(1),d=s.getAttribute("x")||0,u=s.getAttribute("y")||0,p=v(t,c).cloneNode(!0),f=(p.getAttribute("transform")||"")+" translate("+d+", "+u+")",m=i.length,y=e.svgNS;if(x(p),/^svg$/i.test(p.nodeName)){var w=p.ownerDocument.createElementNS(y,"g");for(a=0,h=(l=p.attributes).length;a<h;a++)r=l.item(a),w.setAttributeNS(y,r.nodeName,r.nodeValue);for(;p.firstChild;)w.appendChild(p.firstChild);p=w}for(a=0,h=(l=s.attributes).length;a<h;a++)"x"!==(r=l.item(a)).nodeName&&"y"!==r.nodeName&&"xlink:href"!==r.nodeName&&"href"!==r.nodeName&&("transform"===r.nodeName?f=r.nodeValue+" "+f:p.setAttribute(r.nodeName,r.nodeValue));p.setAttribute("transform",f),p.setAttribute("instantiated_by_use","1"),p.removeAttribute("id"),s.parentNode.replaceChild(p,s),i.length===m&&n++}}(t);var r,a,l=e.Object.__uid++,h=x(t),c=e.util.toArray(t.getElementsByTagName("*"));if(h.crossOrigin=o&&o.crossOrigin,h.svgUid=l,0===c.length&&e.isLikelyNode){var d=[];for(r=0,a=(c=t.selectNodes('//*[name(.)!="svg"]')).length;r<a;r++)d[r]=c[r];c=d}var u=c.filter((function(t){return x(t),e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,e.svgInvalidAncestorsRegEx)}));if(!u||u&&!u.length)i&&i([],{});else{var p={};c.filter((function(t){return"clipPath"===t.nodeName.replace("svg:","")})).forEach((function(t){var i=t.getAttribute("id");p[i]=e.util.toArray(t.getElementsByTagName("*")).filter((function(t){return e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))}))})),e.gradientDefs[l]=e.getGradientDefs(t),e.cssRules[l]=e.getCSSRules(t),e.clipPaths[l]=p,e.parseElements(u,(function(t,n){i&&(i(t,h,n,c),delete e.gradientDefs[l],delete e.cssRules[l],delete e.clipPaths[l])}),n(h),s,o)}}};var b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(b);if(i){var n=i[1],s=i[3],r=i[4],a=i[5],l=i[6];n&&(e.fontStyle=n),s&&(e.fontWeight=isNaN(parseFloat(s))?s:parseFloat(s)),r&&(e.fontSize=o(r)),l&&(e.fontFamily=l),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i=g(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,s={};for(n=i.length;n--;)(e=i[n]).getAttribute("xlink:href")&&w(t,e),s[e.getAttribute("id")]=e;return s},parseAttributes:function(t,n,r){if(t){var a,p,g,m={};void 0===r&&(r=t.getAttribute("svgUid")),t.parentNode&&e.svgValidParentsRegEx.test(t.parentNode.nodeName)&&(m=e.parseAttributes(t.parentNode,n,r));var v=n.reduce((function(e,i){return(a=t.getAttribute(i))&&(e[i]=a),e}),{}),y=i(function(t,i){var n={};for(var s in e.cssRules[i])if(f(t,s.split(" ")))for(var o in e.cssRules[i][s])n[o]=e.cssRules[i][s][o];return n}(t,r),e.parseStyleAttribute(t));v=i(v,y),y[c]&&t.setAttribute(c,y[c]),p=g=m.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,v[h]&&(v[h]=p=o(v[h],g));var x,w,b={};for(var C in v)w=u(x=d(C),v[C],m,p),b[x]=w;b&&b.font&&e.parseFontDeclaration(b.font,b);var S=i(m,b);return e.svgValidParentsRegEx.test(t.nodeName)?S:function(t){for(var i in l)if(void 0!==t[l[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(s(n.getAlpha()*t[l[i]],2)).toRgba()}}return t}(S)}},parseElements:function(t,i,n,s,o){new e.ElementsParser(t,i,n,s,o).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?function(t,e){var i,n;t.replace(/;\s*$/,"").split(";").forEach((function(t){var s=t.split(":");i=s[0].trim().toLowerCase(),n=s[1].trim(),e[i]=n}))}(i,e):function(t,e){var i,n;for(var s in t)void 0!==t[s]&&(i=s.toLowerCase(),n=t[s],e[i]=n)}(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){var i,n,s=t.getElementsByTagName("style"),o={};for(i=0,n=s.length;i<n;i++){var r=s[i].textContent;""!==(r=r.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&r.split("}").filter((function(t){return t.trim()})).forEach((function(t){var s=t.split("{"),r={},a=s[1].trim().split(";").filter((function(t){return t.trim()}));for(i=0,n=a.length;i<n;i++){var l=a[i].split(":"),h=l[0].trim(),c=l[1].trim();r[h]=c}(t=s[0].trim()).split(",").forEach((function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(o[t]?e.util.object.extend(o[t],r):o[t]=e.util.object.clone(r))}))}))}return o},loadSVGFromURL:function(t,i,n,s){t=t.replace(/^\n\s*/,"").trim(),new e.util.request(t,{method:"get",onComplete:function(t){var o=t.responseXML;if(!o||!o.documentElement)return i&&i(null),!1;e.parseSVGDocument(o.documentElement,(function(t,e,n,s){i&&i(t,e,n,s)}),n,s)}})},loadSVGFromString:function(t,i,n,s){var o=(new e.window.DOMParser).parseFromString(t.trim(),"text/xml");e.parseSVGDocument(o.documentElement,(function(t,e,n,s){i(t,e,n,s)}),n,s)}})}(e),_.ElementsParser=function(t,e,i,n,s,o){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=s,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},(m=_.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},m.createObjects=function(){var t=this;this.elements.forEach((function(e,i){e.setAttribute("svgUid",t.svgUid),t.createObject(e,i)}))},m.findTag=function(t){return _[_.util.string.capitalize(t.tagName.replace("svg:",""))]},m.createObject=function(t,e){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(e,t),this.options)}catch(t){_.log(t)}else this.checkIfDone()},m.createCallback=function(t,e){var i=this;return function(n){var s;i.resolveGradient(n,e,"fill"),i.resolveGradient(n,e,"stroke"),n instanceof _.Image&&n._originalElement&&(s=n.parsePreserveAspectRatioAttribute(e)),n._removeTransformMatrix(s),i.resolveClipPath(n,e),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},m.extractPropertyDefinition=function(t,e,i){var n=t[e],s=this.regexUrl;if(s.test(n)){s.lastIndex=0;var o=s.exec(n)[1];return s.lastIndex=0,_[i][this.svgUid][o]}},m.resolveGradient=function(t,e,i){var n=this.extractPropertyDefinition(t,i,"gradientDefs");if(n){var s=e.getAttribute(i+"-opacity"),o=_.Gradient.fromElement(n,t,s,this.options);t.set(i,o)}},m.createClipPathCallback=function(t,e){return function(t){t._removeTransformMatrix(),t.fillRule=t.clipRule,e.push(t)}},m.resolveClipPath=function(t,e){var i,n,s,o,r=this.extractPropertyDefinition(t,"clipPath","clipPaths");if(r){s=[],n=_.util.invertTransform(t.calcTransformMatrix());for(var a=r[0].parentNode,l=e;l.parentNode&&l.getAttribute("clip-path")!==t.clipPath;)l=l.parentNode;l.parentNode.appendChild(a);for(var h=0;h<r.length;h++)i=r[h],this.findTag(i).fromElement(i,this.createClipPathCallback(t,s),this.options);r=1===s.length?s[0]:new _.Group(s),o=_.util.multiplyTransformMatrices(n,r.calcTransformMatrix()),r.clipPath&&this.resolveClipPath(r,l);var c=_.util.qrDecompose(o);r.flipX=!1,r.flipY=!1,r.set("scaleX",c.scaleX),r.set("scaleY",c.scaleY),r.angle=c.angle,r.skewX=c.skewX,r.skewY=0,r.setPositionByOrigin({x:c.translateX,y:c.translateY},"center","center"),t.clipPath=r}else delete t.clipPath},m.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter((function(t){return null!=t})),this.callback(this.instances,this.elements))},function(t){var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}(e),function(t){var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,s,o){var r,a=(o.x-s.x)*(t.y-s.y)-(o.y-s.y)*(t.x-s.x),l=(n.x-t.x)*(t.y-s.y)-(n.y-t.y)*(t.x-s.x),h=(o.y-s.y)*(n.x-t.x)-(o.x-s.x)*(n.y-t.y);if(0!==h){var c=a/h,d=l/h;0<=c&&c<=1&&0<=d&&d<=1?(r=new i("Intersection")).appendPoint(new e.Point(t.x+c*(n.x-t.x),t.y+c*(n.y-t.y))):r=new i}else r=new i(0===a||0===l?"Coincident":"Parallel");return r},e.Intersection.intersectLinePolygon=function(t,e,n){var s,o,r,a,l=new i,h=n.length;for(a=0;a<h;a++)s=n[a],o=n[(a+1)%h],r=i.intersectLineLine(t,e,s,o),l.appendPoints(r.points);return l.points.length>0&&(l.status="Intersection"),l},e.Intersection.intersectPolygonPolygon=function(t,e){var n,s=new i,o=t.length;for(n=0;n<o;n++){var r=t[n],a=t[(n+1)%o],l=i.intersectLinePolygon(r,a,e);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},e.Intersection.intersectPolygonRectangle=function(t,n,s){var o=n.min(s),r=n.max(s),a=new e.Point(r.x,o.y),l=new e.Point(o.x,r.y),h=i.intersectLinePolygon(o,a,t),c=i.intersectLinePolygon(a,r,t),d=i.intersectLinePolygon(r,l,t),u=i.intersectLinePolygon(l,o,t),p=new i;return p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(d.points),p.appendPoints(u.points),p.points.length>0&&(p.status="Intersection"),p})}(e),function(t){var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var s,o,r,a=e.util.array.max([t,i,n]),l=e.util.array.min([t,i,n]);if(r=(a+l)/2,a===l)s=o=0;else{var h=a-l;switch(o=r>.5?h/(2-a-l):h/(a+l),a){case t:s=(i-n)/h+(i<n?6:0);break;case i:s=(n-t)/h+2;break;case n:s=(t-i)/h+4}s/=6}return[Math.round(360*s),Math.round(100*o),Math.round(100*r)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t,e=this.getSource();return t=1===(t=(t=Math.round(255*e[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));var e,n=[],s=this.getAlpha(),o=this.getSource(),r=t.getSource();for(e=0;e<3;e++)n.push(Math.round(.5*o[e]+.5*r[e]));return n[3]=s,this.setSource(n),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),s=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(s,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var s,o,r,a=(parseFloat(e[1])%360+360)%360/360,l=parseFloat(e[2])/(/%$/.test(e[2])?100:1),h=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===l)s=o=r=h;else{var c=h<=.5?h*(l+1):h+l-h*l,d=2*h-c;s=n(d,c,a+1/3),o=n(d,c,a),r=n(d,c,a-1/3)}return[Math.round(255*s),Math.round(255*o),Math.round(255*r),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,s=8===e.length||4===e.length,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),r=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),l=s?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(r,16),parseInt(a,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}(e),function(t){var e=t.fabric||(t.fabric={}),i=["e","se","s","sw","w","nw","n","ne","e"],n=["ns","nesw","ew","nwse"],s={},o="left",r="top",a="right",l="bottom",h="center",c={top:l,bottom:r,left:a,right:o,center:h},d=e.util.radiansToDegrees,u=Math.sign||function(t){return(t>0)-(t<0)||+t};function p(t,e){var i=t.angle+d(Math.atan2(e.y,e.x))+360;return Math.round(i%360/45)}function g(t,i){var n=i.transform.target,s=n.canvas,o=e.util.object.clone(i);o.target=n,s&&s.fire("object:"+t,o),n.fire(t,i)}function f(t,e){var i=e.canvas,n=t[i.uniScaleKey];return i.uniformScaling&&!n||!i.uniformScaling&&n}function m(t){return t.originX===h&&t.originY===h}function v(t,e,i){var n=t.lockScalingX,s=t.lockScalingY;return!((!n||!s)&&(e||!n&&!s||!i)&&(!n||"x"!==e)&&(!s||"y"!==e))}function y(t,e,i,n){return{e:t,transform:e,pointer:{x:i,y:n}}}function x(t){return function(e,i,n,s){var o=i.target,r=o.getCenterPoint(),a=o.translateToOriginPoint(r,i.originX,i.originY),l=t(e,i,n,s);return o.setPositionByOrigin(a,i.originX,i.originY),l}}function w(t,e){return function(i,n,s,o){var r=e(i,n,s,o);return r&&g(t,y(i,n,s,o)),r}}function b(t,i,n,s,o){var r=t.target,a=r.controls[t.corner],l=r.canvas.getZoom(),h=r.padding/l,c=r.toLocalPoint(new e.Point(s,o),i,n);return c.x>=h&&(c.x-=h),c.x<=-h&&(c.x+=h),c.y>=h&&(c.y-=h),c.y<=h&&(c.y+=h),c.x-=a.offsetX,c.y-=a.offsetY,c}function C(t){return t.flipX!==t.flipY}function S(t,e,i,n,s){if(0!==t[e]){var o=s/t._getTransformedDimensions()[n]*t[i];t.set(i,o)}}function _(t,e,i,n){var s,h=e.target,c=h._getTransformedDimensions(0,h.skewY),u=b(e,e.originX,e.originY,i,n),p=Math.abs(2*u.x)-c.x,g=h.skewX;p<2?s=0:(s=d(Math.atan2(p/h.scaleX,c.y/h.scaleY)),e.originX===o&&e.originY===l&&(s=-s),e.originX===a&&e.originY===r&&(s=-s),C(h)&&(s=-s));var f=g!==s;if(f){var m=h._getTransformedDimensions().y;h.set("skewX",s),S(h,"skewY","scaleY","y",m)}return f}function T(t,e,i,n){var s,h=e.target,c=h._getTransformedDimensions(h.skewX,0),u=b(e,e.originX,e.originY,i,n),p=Math.abs(2*u.y)-c.y,g=h.skewY;p<2?s=0:(s=d(Math.atan2(p/h.scaleY,c.x/h.scaleX)),e.originX===o&&e.originY===l&&(s=-s),e.originX===a&&e.originY===r&&(s=-s),C(h)&&(s=-s));var f=g!==s;if(f){var m=h._getTransformedDimensions().x;h.set("skewY",s),S(h,"skewX","scaleX","x",m)}return f}function E(t,e,i,n,s){s=s||{};var o,r,a,l,h,d,p=e.target,g=p.lockScalingX,y=p.lockScalingY,x=s.by,w=f(t,p),C=v(p,x,w),S=e.gestureScale;if(C)return!1;if(S)r=e.scaleX*S,a=e.scaleY*S;else{if(o=b(e,e.originX,e.originY,i,n),h="y"!==x?u(o.x):1,d="x"!==x?u(o.y):1,e.signX||(e.signX=h),e.signY||(e.signY=d),p.lockScalingFlip&&(e.signX!==h||e.signY!==d))return!1;if(l=p._getTransformedDimensions(),w&&!x){var _=Math.abs(o.x)+Math.abs(o.y),T=e.original,E=_/(Math.abs(l.x*T.scaleX/p.scaleX)+Math.abs(l.y*T.scaleY/p.scaleY));r=T.scaleX*E,a=T.scaleY*E}else r=Math.abs(o.x*p.scaleX/l.x),a=Math.abs(o.y*p.scaleY/l.y);m(e)&&(r*=2,a*=2),e.signX!==h&&"y"!==x&&(e.originX=c[e.originX],r*=-1,e.signX=h),e.signY!==d&&"x"!==x&&(e.originY=c[e.originY],a*=-1,e.signY=d)}var P=p.scaleX,A=p.scaleY;return x?("x"===x&&p.set("scaleX",r),"y"===x&&p.set("scaleY",a)):(!g&&p.set("scaleX",r),!y&&p.set("scaleY",a)),P!==p.scaleX||A!==p.scaleY}s.scaleCursorStyleHandler=function(t,e,n){var s=f(t,n),o="";if(0!==e.x&&0===e.y?o="x":0===e.x&&0!==e.y&&(o="y"),v(n,o,s))return"not-allowed";var r=p(n,e);return i[r]+"-resize"},s.skewCursorStyleHandler=function(t,e,i){var s="not-allowed";if(0!==e.x&&i.lockSkewingY)return s;if(0!==e.y&&i.lockSkewingX)return s;var o=p(i,e)%4;return n[o]+"-resize"},s.scaleSkewCursorStyleHandler=function(t,e,i){return t[i.canvas.altActionKey]?s.skewCursorStyleHandler(t,e,i):s.scaleCursorStyleHandler(t,e,i)},s.rotationWithSnapping=w("rotating",x((function(t,e,i,n){var s=e,o=s.target,r=o.translateToOriginPoint(o.getCenterPoint(),s.originX,s.originY);if(o.lockRotation)return!1;var a,l=Math.atan2(s.ey-r.y,s.ex-r.x),h=Math.atan2(n-r.y,i-r.x),c=d(h-l+s.theta);if(o.snapAngle>0){var u=o.snapAngle,p=o.snapThreshold||u,g=Math.ceil(c/u)*u,f=Math.floor(c/u)*u;Math.abs(c-f)<p?c=f:Math.abs(c-g)<p&&(c=g)}return c<0&&(c=360+c),c%=360,a=o.angle!==c,o.angle=c,a}))),s.scalingEqually=w("scaling",x((function(t,e,i,n){return E(t,e,i,n)}))),s.scalingX=w("scaling",x((function(t,e,i,n){return E(t,e,i,n,{by:"x"})}))),s.scalingY=w("scaling",x((function(t,e,i,n){return E(t,e,i,n,{by:"y"})}))),s.scalingYOrSkewingX=function(t,e,i,n){return t[e.target.canvas.altActionKey]?s.skewHandlerX(t,e,i,n):s.scalingY(t,e,i,n)},s.scalingXOrSkewingY=function(t,e,i,n){return t[e.target.canvas.altActionKey]?s.skewHandlerY(t,e,i,n):s.scalingX(t,e,i,n)},s.changeWidth=w("resizing",x((function(t,e,i,n){var s=e.target,o=b(e,e.originX,e.originY,i,n),r=s.strokeWidth/(s.strokeUniform?s.scaleX:1),a=m(e)?2:1,l=s.width,h=Math.abs(o.x*a/s.scaleX)-r;return s.set("width",Math.max(h,0)),l!==h}))),s.skewHandlerX=function(t,e,i,n){var s,l=e.target,c=l.skewX,d=e.originY;return!l.lockSkewingX&&(0===c?s=b(e,h,h,i,n).x>0?o:a:(c>0&&(s=d===r?o:a),c<0&&(s=d===r?a:o),C(l)&&(s=s===o?a:o)),e.originX=s,w("skewing",x(_))(t,e,i,n))},s.skewHandlerY=function(t,e,i,n){var s,a=e.target,c=a.skewY,d=e.originX;return!a.lockSkewingY&&(0===c?s=b(e,h,h,i,n).y>0?r:l:(c>0&&(s=d===o?r:l),c<0&&(s=d===o?l:r),C(a)&&(s=s===r?l:r)),e.originY=s,w("skewing",x(T))(t,e,i,n))},s.dragHandler=function(t,e,i,n){var s=e.target,o=i-e.offsetX,r=n-e.offsetY,a=!s.get("lockMovementX")&&s.left!==o,l=!s.get("lockMovementY")&&s.top!==r;return a&&s.set("left",o),l&&s.set("top",r),(a||l)&&g("moving",y(t,e,i,n)),a||l},s.scaleOrSkewActionName=function(t,e,i){var n=t[i.canvas.altActionKey];return 0===e.x?n?"skewX":"scaleY":0===e.y?n?"skewY":"scaleX":void 0},s.rotationStyleHandler=function(t,e,i){return i.lockRotation?"not-allowed":e.cursorStyle},s.fireEvent=g,s.wrapWithFixedAnchor=x,s.wrapWithFireEvent=w,s.getLocalPoint=b,e.controlsUtils=s}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.degreesToRadians,n=e.controlsUtils;n.renderCircleControl=function(t,e,i,n,s){n=n||{};var o,r=this.sizeX||n.cornerSize||s.cornerSize,a=this.sizeY||n.cornerSize||s.cornerSize,l=void 0!==n.transparentCorners?n.transparentCorners:s.transparentCorners,h=l?"stroke":"fill",c=!l&&(n.cornerStrokeColor||s.cornerStrokeColor),d=e,u=i;t.save(),t.fillStyle=n.cornerColor||s.cornerColor,t.strokeStyle=n.cornerStrokeColor||s.cornerStrokeColor,r>a?(o=r,t.scale(1,a/r),u=i*r/a):a>r?(o=a,t.scale(r/a,1),d=e*a/r):o=r,t.lineWidth=1,t.beginPath(),t.arc(d,u,o/2,0,2*Math.PI,!1),t[h](),c&&t.stroke(),t.restore()},n.renderSquareControl=function(t,e,n,s,o){s=s||{};var r=this.sizeX||s.cornerSize||o.cornerSize,a=this.sizeY||s.cornerSize||o.cornerSize,l=void 0!==s.transparentCorners?s.transparentCorners:o.transparentCorners,h=l?"stroke":"fill",c=!l&&(s.cornerStrokeColor||o.cornerStrokeColor),d=r/2,u=a/2;t.save(),t.fillStyle=s.cornerColor||o.cornerColor,t.strokeStyle=s.cornerStrokeColor||o.cornerStrokeColor,t.lineWidth=1,t.translate(e,n),t.rotate(i(o.angle)),t[h+"Rect"](-d,-u,r,a),c&&t.strokeRect(-d,-u,r,a),t.restore()}}(e),function(t){var e=t.fabric||(t.fabric={});e.Control=function(t){for(var e in t)this[e]=t[e]},e.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(t,e){return e.cursorStyle},getActionName:function(t,e){return e.actionName},getVisibility:function(t,e){var i=t._controlsVisibility;return i&&void 0!==i[e]?i[e]:this.visible},setVisibility:function(t){this.visible=t},positionHandler:function(t,i){return e.util.transformPoint({x:this.x*t.x+this.offsetX,y:this.y*t.y+this.offsetY},i)},calcCornerCoords:function(t,i,n,s,o){var r,a,l,h,c=o?this.touchSizeX:this.sizeX,d=o?this.touchSizeY:this.sizeY;if(c&&d&&c!==d){var u=Math.atan2(d,c),p=Math.sqrt(c*c+d*d)/2,g=u-e.util.degreesToRadians(t),f=Math.PI/2-u-e.util.degreesToRadians(t);r=p*e.util.cos(g),a=p*e.util.sin(g),l=p*e.util.cos(f),h=p*e.util.sin(f)}else p=.7071067812*(c&&d?c:i),g=e.util.degreesToRadians(45-t),r=l=p*e.util.cos(g),a=h=p*e.util.sin(g);return{tl:{x:n-h,y:s-l},tr:{x:n+r,y:s-a},bl:{x:n-r,y:s+a},br:{x:n+h,y:s+l}}},render:function(t,i,n,s,o){"circle"===((s=s||{}).cornerStyle||o.cornerStyle)?e.controlsUtils.renderCircleControl.call(this,t,i,n,s,o):e.controlsUtils.renderSquareControl.call(this,t,i,n,s,o)}}}(e),function(){function t(t,e){var i,n,s,o,r=t.getAttribute("style"),a=t.getAttribute("offset")||0;if(a=(a=parseFloat(a)/(/%$/.test(a)?100:1))<0?0:a>1?1:a,r){var l=r.split(/\s*;\s*/);for(""===l[l.length-1]&&l.pop(),o=l.length;o--;){var h=l[o].split(/\s*:\s*/),c=h[0].trim(),d=h[1].trim();"stop-color"===c?i=d:"stop-opacity"===c&&(s=d)}}return i||(i=t.getAttribute("stop-color")||"rgb(0,0,0)"),s||(s=t.getAttribute("stop-opacity")),n=(i=new _.Color(i)).getAlpha(),s=isNaN(parseFloat(s))?1:parseFloat(s),s*=n*e,{offset:a,color:i.toRgb(),opacity:s}}var e=_.util.object.clone;_.Gradient=_.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(t){t||(t={}),t.coords||(t.coords={});var e,i=this;Object.keys(t).forEach((function(e){i[e]=t[e]})),this.id?this.id+="_"+_.Object.__uid++:this.id=_.Object.__uid++,e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice()},addColorStop:function(t){for(var e in t){var i=new _.Color(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return _.util.populateWithProperties(this,e,t),e},toSVG:function(t,i){var n,s,o,r,a=e(this.coords,!0),l=(i=i||{},e(this.colorStops,!0)),h=a.r1>a.r2,c=this.gradientTransform?this.gradientTransform.concat():_.iMatrix.concat(),d=-this.offsetX,u=-this.offsetY,p=!!i.additionalTransform,g="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(l.sort((function(t,e){return t.offset-e.offset})),"objectBoundingBox"===g?(d/=t.width,u/=t.height):(d+=t.width/2,u+=t.height/2),"path"===t.type&&"percentage"!==this.gradientUnits&&(d-=t.pathOffset.x,u-=t.pathOffset.y),c[4]-=d,c[5]-=u,r='id="SVGID_'+this.id+'" gradientUnits="'+g+'"',r+=' gradientTransform="'+(p?i.additionalTransform+" ":"")+_.util.matrixToSVG(c)+'" ',"linear"===this.type?o=["<linearGradient ",r,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'">\n']:"radial"===this.type&&(o=["<radialGradient ",r,' cx="',h?a.x1:a.x2,'" cy="',h?a.y1:a.y2,'" r="',h?a.r1:a.r2,'" fx="',h?a.x2:a.x1,'" fy="',h?a.y2:a.y1,'">\n']),"radial"===this.type){if(h)for((l=l.concat()).reverse(),n=0,s=l.length;n<s;n++)l[n].offset=1-l[n].offset;var f=Math.min(a.r1,a.r2);if(f>0){var m=f/Math.max(a.r1,a.r2);for(n=0,s=l.length;n<s;n++)l[n].offset+=m*(1-l[n].offset)}}for(n=0,s=l.length;n<s;n++){var v=l[n];o.push("<stop ",'offset="',100*v.offset+"%",'" style="stop-color:',v.color,void 0!==v.opacity?";stop-opacity: "+v.opacity:";",'"/>\n')}return o.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),o.join("")},toLive:function(t){var e,i,n,s=_.util.object.clone(this.coords);if(this.type){for("linear"===this.type?e=t.createLinearGradient(s.x1,s.y1,s.x2,s.y2):"radial"===this.type&&(e=t.createRadialGradient(s.x1,s.y1,s.r1,s.x2,s.y2,s.r2)),i=0,n=this.colorStops.length;i<n;i++){var o=this.colorStops[i].color,r=this.colorStops[i].opacity,a=this.colorStops[i].offset;void 0!==r&&(o=new _.Color(o).setAlpha(r).toRgba()),e.addColorStop(a,o)}return e}}}),_.util.object.extend(_.Gradient,{fromElement:function(e,i,n,s){var o=parseFloat(n)/(/%$/.test(n)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var r,a,l,h,c=e.getElementsByTagName("stop"),d="userSpaceOnUse"===e.getAttribute("gradientUnits")?"pixels":"percentage",u=e.getAttribute("gradientTransform")||"",p=[],g=0,f=0;for("linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?(r="linear",a=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(e)):(r="radial",a=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(e)),l=c.length;l--;)p.push(t(c[l],o));return h=_.parseTransformAttribute(u),function(t,e,i,n){var s,o;Object.keys(e).forEach((function(t){"Infinity"===(s=e[t])?o=1:"-Infinity"===s?o=0:(o=parseFloat(e[t],10),"string"==typeof s&&/^(\d+\.\d+)%|(\d+)%$/.test(s)&&(o*=.01,"pixels"===n&&("x1"!==t&&"x2"!==t&&"r2"!==t||(o*=i.viewBoxWidth||i.width),"y1"!==t&&"y2"!==t||(o*=i.viewBoxHeight||i.height)))),e[t]=o}))}(0,a,s,d),"pixels"===d&&(g=-i.left,f=-i.top),new _.Gradient({id:e.getAttribute("id"),type:r,coords:a,colorStops:p,gradientUnits:d,gradientTransform:h,offsetX:g,offsetY:f})}})}(),v=_.util.toFixed,_.Pattern=_.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,e){if(t||(t={}),this.id=_.Object.__uid++,this.setOptions(t),!t.source||t.source&&"string"!=typeof t.source)e&&e(this);else{var i=this;this.source=_.util.createImage(),_.util.loadImage(t.source,(function(t,n){i.source=t,e&&e(i,n)}),null,this.crossOrigin)}},toObject:function(t){var e,i,n=_.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?e=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL()),i={type:"pattern",source:e,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:v(this.offsetX,n),offsetY:v(this.offsetY,n),patternTransform:this.patternTransform?this.patternTransform.concat():null},_.util.populateWithProperties(this,i,t),i},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.width,n=e.height/t.height,s=this.offsetX/t.width,o=this.offsetY/t.height,r="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,o&&(n+=Math.abs(o))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,s&&(i+=Math.abs(s))),e.src?r=e.src:e.toDataURL&&(r=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+s+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+r+'"></image>\n</pattern>\n'},setOptions:function(t){for(var e in t)this[e]=t[e]},toLive:function(t){var e=this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,s=40,o=e.Object.NUM_FRACTION_DIGITS,r=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle)),a=new e.Color(this.color);return t.width&&t.height&&(n=100*i((Math.abs(r.x)+this.blur)/t.width,o)+20,s=100*i((Math.abs(r.y)+this.blur)/t.height,o)+20),t.flipX&&(r.x*=-1),t.flipY&&(r.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(r.x,o)+'" dy="'+i(r.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+a.toRgb()+'" flood-opacity="'+a.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach((function(e){this[e]!==i[e]&&(t[e]=this[e])}),this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(_.StaticCanvas)_.warn("fabric.StaticCanvas is already defined.");else{var t=_.util.object.extend,e=_.util.getElementOffset,i=_.util.removeFromArray,n=_.util.toFixed,s=_.util.transformPoint,o=_.util.invertTransform,r=_.util.getNodeCanvas,a=_.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");_.StaticCanvas=_.util.createClass(_.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:_.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return _.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,_.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var t=_.devicePixelRatio;this.__initRetinaScaling(t,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(t,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(t,e,i){e.setAttribute("width",this.width*t),e.setAttribute("height",this.height*t),i.scale(t,t)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?_.util.loadImage(e,(function(e,s){if(e){var o=new _.Image(e,n);this[t]=o,o.canvas=this}i&&i(e,s)}),this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,e&&(e.canvas=this),i&&i(e,!1)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=a();if(!t)throw l;if(t.style||(t.style={}),void 0===t.getContext)throw l;return t},_initOptions:function(t){var e=this.lowerCanvasEl;this._setOptions(t),this.width=this.width||parseInt(e.width,10)||0,this.height=this.height||parseInt(e.height,10)||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=_.util.getById(t)||this._createCanvasElement(),_.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,n,s=this._activeObject,o=this.backgroundImage,r=this.overlayImage;for(this.viewportTransform=t,i=0,n=this._objects.length;i<n;i++)(e=this._objects[i]).group||e.setCoords(!0);return s&&s.setCoords(),o&&o.setCoords(!0),r&&r.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=s(t,o(this.viewportTransform)),n[0]=e,n[3]=e;var r=s(t,n);return n[4]+=i.x-r.x,n[5]+=i.y-r.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new _.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new _.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=_.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,n=o(this.viewportTransform);return t.tl=s({x:0,y:0},n),t.br=s({x:e,y:i},n),t.tr=new _.Point(t.br.x,t.tl.y),t.bl=new _.Point(t.tl.x,t.br.y),this.vptCoords=t,t},cancelRequestedRender:function(){this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(t,e){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(t),_.util.setImageSmoothing(t,this.imageSmoothingEnabled),this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render",{ctx:t})},drawClipPathOnCanvas:function(t){var e=this.viewportTransform,i=this.clipPath;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.globalCompositeOperation="destination-in",i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},_renderObjects:function(t,e){var i,n;for(i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"],n=this[e+"Image"],s=this.viewportTransform,o=this[e+"Vpt"];if(i||n){if(i){t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=i.toLive?i.toLive(t,this):i,o&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),t.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var r=i.gradientTransform||i.patternTransform;r&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),t.fill(),t.restore()}n&&(t.save(),o&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),n.render(t),t.restore())}},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new _.Point(this.width/2,this.height/2)},centerObjectH:function(t){return this._centerObject(t,new _.Point(this.getCenterPoint().x,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new _.Point(t.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(t){var e=this.getCenterPoint();return this._centerObject(t,e)},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new _.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new _.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenterPoint(),e=o(this.viewportTransform);return s(t,e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n=this.clipPath,s={version:_.version,objects:this._toObjects(e,i)};return n&&!n.excludeFromExport&&(s.clipPath=this._toObject(this.clipPath,e,i)),t(s,this.__serializeBgOverlay(e,i)),_.util.populateWithProperties(this,s,i),s},_toObjects:function(t,e){return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){return this._toObject(i,t,e)}),this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var s=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),s},__serializeBgOverlay:function(t,e){var i={},n=this.backgroundImage,s=this.overlayImage,o=this.backgroundColor,r=this.overlayColor;return o&&o.toObject?o.excludeFromExport||(i.background=o.toObject(e)):o&&(i.background=o),r&&r.toObject?r.excludeFromExport||(i.overlay=r.toObject(e)):r&&(i.overlay=r),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,t,e)),s&&!s.excludeFromExport&&(i.overlayImage=this._toObject(s,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={}),t.reviver=e;var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,s=e.width||this.width,o=e.height||this.height,r='viewBox="0 0 '+this.width+" "+this.height+'" ',a=_.Object.NUM_FRACTION_DIGITS;e.viewBox?r='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,r='viewBox="'+n(-i[4]/i[0],a)+" "+n(-i[5]/i[3],a)+" "+n(this.width/i[0],a)+" "+n(this.height/i[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',o,'" ',r,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",_.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")},createSVGClipPathMarkup:function(t){var e=this.clipPath;return e?(e.clipPathId="CLIPPATH_"+_.Object.__uid++,'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var t=this;return["background","overlay"].map((function(e){var i=t[e+"Color"];if(i&&i.toLive){var n=t[e+"Vpt"],s=t.viewportTransform,o={width:t.width/(n?s[0]:1),height:t.height/(n?s[3]:1)};return i.toSVG(o,{additionalTransform:n?_.util.matrixToSVG(s):""})}})).join("")},createSVGFontFacesMarkup:function(){var t,e,i,n,s,o,r,a,l="",h={},c=_.fontPaths,d=[];for(this._objects.forEach((function t(e){d.push(e),e._objects&&e._objects.forEach(t)})),r=0,a=d.length;r<a;r++)if(e=(t=d[r]).fontFamily,-1!==t.type.indexOf("text")&&!h[e]&&c[e]&&(h[e]=!0,t.styles))for(s in i=t.styles)for(o in n=i[s])!h[e=n[o].fontFamily]&&c[e]&&(h[e]=!0);for(var u in h)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",u,"';\n","\t\t\tsrc: url('",c[u],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},_setSVGObjects:function(t,e){var i,n,s,o=this._objects;for(n=0,s=o.length;n<s;n++)(i=o[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&!this[e].excludeFromExport&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){var i=this[e+"Color"],n=this.viewportTransform,s=this.width,o=this.height;if(i)if(i.toLive){var r=i.repeat,a=_.util.invertTransform(n),l=this[e+"Vpt"]?_.util.matrixToSVG(a):"";t.push('<rect transform="'+l+" translate(",s/2,",",o/2,')"',' x="',i.offsetX-s/2,'" y="',i.offsetY-o/2,'" ','width="',"repeat-y"===r||"no-repeat"===r?i.source.width:s,'" height="',"repeat-x"===r||"no-repeat"===r?i.source.height:o,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,s,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(e=(s=o._objects).length;e--;)n=s[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,n,s,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(s=o._objects,e=0;e<s.length;e++)n=s[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var n,s,o,r,a,l=this._activeObject,h=0;if(t===l&&"activeSelection"===t.type)for(a=l._objects,n=0;n<a.length;n++)s=a[n],(o=this._objects.indexOf(s))>0+h&&(r=o-1,i(this._objects,s),this._objects.splice(r,0,s)),h++;else 0!==(o=this._objects.indexOf(t))&&(r=this._findNewLowerIndex(t,o,e),i(this._objects,t),this._objects.splice(r,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var n,s;if(i){for(n=e,s=e-1;s>=0;--s)if(t.intersectsWithObject(this._objects[s])||t.isContainedWithinObject(this._objects[s])||this._objects[s].isContainedWithinObject(t)){n=s;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,s,o,r,a,l=this._activeObject,h=0;if(t===l&&"activeSelection"===t.type)for(n=(a=l._objects).length;n--;)s=a[n],(o=this._objects.indexOf(s))<this._objects.length-1-h&&(r=o+1,i(this._objects,s),this._objects.splice(r,0,s)),h++;else(o=this._objects.indexOf(t))!==this._objects.length-1&&(r=this._findNewUpperIndex(t,o,e),i(this._objects,t),this._objects.splice(r,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var n,s,o;if(i){for(n=e,s=e+1,o=this._objects.length;s<o;++s)if(t.intersectsWithObject(this._objects[s])||t.isContainedWithinObject(this._objects[s])||this._objects[s].isContainedWithinObject(t)){n=s;break}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(t){t.dispose&&t.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),_.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),_.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),t(_.StaticCanvas.prototype,_.Observable),t(_.StaticCanvas.prototype,_.Collection),t(_.StaticCanvas.prototype,_.DataURLExporter),t(_.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=a();if(!e||!e.getContext)return null;var i=e.getContext("2d");return i&&"setLineDash"===t?void 0!==i.setLineDash:null}}),_.StaticCanvas.prototype.toJSON=_.StaticCanvas.prototype.toObject,_.isLikelyNode&&(_.StaticCanvas.prototype.createPNGStream=function(){var t=r(this.lowerCanvasEl);return t&&t.createPNGStream()},_.StaticCanvas.prototype.createJPEGStream=function(t){var e=r(this.lowerCanvasEl);return e&&e.createJPEGStream(t)})}}(),_.BaseBrush=_.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(t){t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var t=this.canvas,e=this.shadow,i=t.contextTop,n=t.getZoom();t&&t._isRetinaScaling()&&(n*=_.devicePixelRatio),i.shadowColor=e.color,i.shadowBlur=e.blur*n,i.shadowOffsetX=e.offsetX*n,i.shadowOffsetY=e.offsetY*n}},needsFullRender:function(){return new _.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_isOutSideCanvas:function(t){return t.x<0||t.x>this.canvas.getWidth()||t.y<0||t.y>this.canvas.getHeight()}}),_.PencilBrush=_.util.createClass(_.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(t){this.canvas=t,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(t,e,i){var n=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,n.x,n.y),n},onMouseDown:function(t,e){this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],this._prepareForDrawing(t),this._captureDrawingPath(t),this._render())},onMouseMove:function(t,e){if(this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(t))&&this._captureDrawingPath(t)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,n=i.length,s=this.canvas.contextTop;this._saveAndTransform(s),this.oldEnd&&(s.beginPath(),s.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(s,i[n-2],i[n-1],!0),s.stroke(),s.restore()}},onMouseUp:function(t){return!this.canvas._isMainEvent(t.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(t){var e=new _.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(t),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(t){var e=new _.Point(t.x,t.y);return this._addPoint(e)},_render:function(t){var e,i,n=this._points[0],s=this._points[1];if(t=t||this.canvas.contextTop,this._saveAndTransform(t),t.beginPath(),2===this._points.length&&n.x===s.x&&n.y===s.y){var o=this.width/1e3;n=new _.Point(n.x,n.y),s=new _.Point(s.x,s.y),n.x-=o,s.x+=o}for(t.moveTo(n.x,n.y),e=1,i=this._points.length;e<i;e++)this._drawSegment(t,n,s),n=this._points[e],s=this._points[e+1];t.lineTo(n.x,n.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=this.width/1e3;return _.util.getSmoothPathFromPoints(t,e)},_isEmptySVGPath:function(t){return"M 0 0 Q 0 0 0 0 L 0 0"===_.util.joinPath(t)},createPath:function(t){var e=new _.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new _.Shadow(this.shadow)),e},decimatePoints:function(t,e){if(t.length<=2)return t;var i,n=this.canvas.getZoom(),s=Math.pow(e/n,2),o=t.length-1,r=t[0],a=[r];for(i=1;i<o-1;i++)Math.pow(r.x-t[i].x,2)+Math.pow(r.y-t[i].y,2)>=s&&(r=t[i],a.push(r));return a.push(t[o]),a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(t))this.canvas.requestRenderAll();else{var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.requestRenderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}}}),_.CircleBrush=_.util.createClass(_.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,e),i.restore()},dot:function(t,e){t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i=this.canvas.contextTop,n=this.points;for(this._saveAndTransform(i),t=0,e=n.length;t<e;t++)this.dot(i,n[t]);i.restore()},onMouseMove:function(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t))},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;t<e;t++){var s=this.points[t],o=new _.Circle({radius:s.radius,left:s.x,top:s.y,originX:"center",originY:"center",fill:s.fill});this.shadow&&(o.shadow=new _.Shadow(this.shadow)),n.push(o)}var r=new _.Group(n);r.canvas=this.canvas,this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.fire("path:created",{path:r}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new _.Point(t.x,t.y),i=_.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new _.Color(this.color).setAlpha(_.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),_.SprayBrush=_.util.createClass(_.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.addSprayChunk(t),this.render(this.sprayChunkPoints))},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var s=this.sprayChunks[i],o=0,r=s.length;o<r;o++){var a=new _.Rect({width:s[o].width,height:s[o].width,left:s[o].x+1,top:s[o].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var l=new _.Group(e);this.shadow&&l.set("shadow",new _.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,s={};for(i=0,n=t.length;i<n;i++)s[e=t[i].left+""+t[i].top]||(s[e]=t[i]);var o=[];for(e in s)o.push(s[e]);return o},render:function(t){var e,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),e=0,i=t.length;e<i;e++){var s=t[e];void 0!==s.opacity&&(n.globalAlpha=s.opacity),n.fillRect(s.x,s.y,s.width,s.width)}n.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;t<e;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,s,o=this.width/2;for(s=0;s<this.density;s++){e=_.util.getRandomInt(t.x-o,t.x+o),i=_.util.getRandomInt(t.y-o,t.y+o),n=this.dotWidthVariance?_.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var r=new _.Point(e,i);r.width=n,this.randomOpacity&&(r.opacity=_.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(r)}this.sprayChunks.push(this.sprayChunkPoints)}}),_.PatternBrush=_.util.createClass(_.PencilBrush,{getPatternSrc:function(){var t=_.util.createCanvasElement(),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(t){return t.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(t){this.callSuper("_setBrushStyles",t),t.strokeStyle=this.getPattern(t)},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new _.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=_.util.getPointer,e=_.util.degreesToRadians,i=_.util.isTouchEvent;for(var n in _.Canvas=_.util.createClass(_.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=_.PencilBrush&&new _.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){e=[],i=[];for(var s=0,o=this._objects.length;s<o;s++)t=this._objects[s],-1===n.indexOf(t)?e.push(t):i.push(t);n.length>1&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=_.util.invertTransform(i),s=this.restorePointerVpt(e);return _.util.transformPoint(s,n)},isTargetTransparent:function(t,e,i){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var n=this._normalizePointer(t,{x:e,y:i}),s=Math.max(t.cacheTranslationX+n.x*t.zoomX,0),o=Math.max(t.cacheTranslationY+n.y*t.zoomY,0);return _.util.isTransparent(t._cacheContext,Math.round(s),Math.round(o),this.targetFindTolerance)}var r=this.contextCache,a=t.selectionBackgroundColor,l=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(r),r.save(),r.transform(l[0],l[1],l[2],l[3],l[4],l[5]),t.render(r),r.restore(),t.selectionBackgroundColor=a,_.util.isTransparent(r,e,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return Array.isArray(this.selectionKey)?!!this.selectionKey.find((function(e){return!0===t[e]})):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),n=this._activeObject;return!e||e&&n&&i.length>1&&-1===i.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t,e,i){var n;if(t)return"scale"===e||"scaleX"===e||"scaleY"===e||"resizing"===e?n=this.centeredScaling||t.centeredScaling:"rotate"===e&&(n=this.centeredRotation||t.centeredRotation),n?!i:i},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i,n){if(!e||!t)return"drag";var s=n.controls[e];return s.getActionName(i,s,n)},_setupCurrentTransform:function(t,i,n){if(i){var s=this.getPointer(t),o=i.__corner,r=i.controls[o],a=n&&o?r.getActionHandler(t,i,r):_.controlsUtils.dragHandler,l=this._getActionFromCorner(n,o,t,i),h=this._getOriginFromCorner(i,o),c=t[this.centeredKey],d={target:i,action:l,actionHandler:a,corner:o,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:s.x-i.left,offsetY:s.y-i.top,originX:h.x,originY:h.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:e(i.angle),width:i.width*i.scaleX,shiftKey:t.shiftKey,altKey:c,original:_.util.saveObjectTransform(i)};this._shouldCenterTransform(i,l,c)&&(d.originX="center",d.originY="center"),d.original.originX=h.x,d.original.originY=h.y,this._currentTransform=d,this._beforeTransform(t)}},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_drawSelection:function(t){var e=this._groupSelector,i=new _.Point(e.ex,e.ey),n=_.util.transformPoint(i,this.viewportTransform),s=new _.Point(e.ex+e.left,e.ey+e.top),o=_.util.transformPoint(s,this.viewportTransform),r=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x,o.x),h=Math.max(n.y,o.y),c=this.selectionLineWidth/2;this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(r,a,l-r,h-a)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,r+=c,a+=c,l-=c,h-=c,_.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(r,a,l-r,h-a))},findTarget:function(t,e){if(!this.skipTargetFind){var n,s,o=this.getPointer(t,!0),r=this._activeObject,a=this.getActiveObjects(),l=i(t),h=a.length>1&&!e||1===a.length;if(this.targets=[],h&&r._findTargetCorner(o,l))return r;if(a.length>1&&!e&&r===this._searchPossibleTargets([r],o))return r;if(1===a.length&&r===this._searchPossibleTargets([r],o)){if(!this.preserveObjectStacking)return r;n=r,s=this.targets,this.targets=[]}var c=this._searchPossibleTargets(this._objects,o);return t[this.altSelectionKey]&&c&&n&&c!==n&&(c=n,this.targets=s),c}},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&e.containsPoint(t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,i.x,i.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,s=t.length;s--;){var o=t[s],r=o.group?this._normalizePointer(o.group,e):e;if(this._checkTarget(r,o,e)){(i=t[s]).subTargetCheck&&i instanceof _.Group&&(n=this._searchPossibleTargets(i._objects,e))&&this.targets.push(n);break}}return i},restorePointerVpt:function(t){return _.util.transformPoint(t,_.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,s=t(e),o=this.upperCanvasEl,r=o.getBoundingClientRect(),a=r.width||0,l=r.height||0;a&&l||("top"in r&&"bottom"in r&&(l=Math.abs(r.top-r.bottom)),"right"in r&&"left"in r&&(a=Math.abs(r.right-r.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,i||(s=this.restorePointerVpt(s));var h=this.getRetinaScaling();return 1!==h&&(s.x/=h,s.y/=h),n=0===a||0===l?{width:1,height:1}:{width:o.width/a,height:o.height/l},{x:s.x*n.width,y:s.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),e=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),_.util.addClass(i,"upper-canvas "+t),this.wrapperEl.appendChild(i),this._copyCanvasStyle(e,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=_.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),_.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),_.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;_.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=i,_.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),t===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,n=this.getActiveObjects(),s=[],o=[];t.forEach((function(t){-1===n.indexOf(t)&&(i=!0,t.fire("deselected",{e,target:t}),o.push(t))})),n.forEach((function(n){-1===t.indexOf(n)&&(i=!0,n.fire("selected",{e,target:n}),s.push(n))})),t.length>0&&n.length>0?i&&this.fire("selection:updated",{e,selected:s,deselected:o}):n.length>0?this.fire("selection:created",{e,selected:s}):t.length>0&&this.fire("selection:cleared",{e,deselected:o})},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return this._activeObject!==t&&!!this._discardActiveObject(e,t)&&!t.onSelect({e})&&(this._activeObject=t,!0)},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects(),i=this.getActiveObject();return e.length&&this.fire("before:selection:cleared",{target:i,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(t){_.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,_.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),s=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),s},_realizeGroupTransformOnObject:function(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach((function(i){e[i]=t[i]})),_.util.addTransformToObject(t,this._activeObject.calcOwnMatrix()),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),_.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),_.StaticCanvas)"prototype"!==n&&(_.Canvas[n]=_.StaticCanvas[n])}(),function(){var t=_.util.addListener,e=_.util.removeListener,i={passive:!1};function n(t,e){return t.button&&t.button===e-1}_.util.object.extend(_.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(t,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(t,e){var n=this.upperCanvasEl,s=this._getEventPrefix();t(_.window,"resize",this._onResize),t(n,s+"down",this._onMouseDown),t(n,s+"move",this._onMouseMove,i),t(n,s+"out",this._onMouseOut),t(n,s+"enter",this._onMouseEnter),t(n,"wheel",this._onMouseWheel),t(n,"contextmenu",this._onContextMenu),t(n,"dblclick",this._onDoubleClick),t(n,"dragover",this._onDragOver),t(n,"dragenter",this._onDragEnter),t(n,"dragleave",this._onDragLeave),t(n,"drop",this._onDrop),this.enablePointerEvents||t(n,"touchstart",this._onTouchStart,i),"undefined"!=typeof eventjs&&e in eventjs&&(eventjs[e](n,"gesture",this._onGesture),eventjs[e](n,"drag",this._onDrag),eventjs[e](n,"orientation",this._onOrientationChange),eventjs[e](n,"shake",this._onShake),eventjs[e](n,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(e,"remove");var t=this._getEventPrefix();e(_.document,t+"up",this._onMouseUp),e(_.document,"touchend",this._onTouchEnd,i),e(_.document,t+"move",this._onMouseMove,i),e(_.document,"touchmove",this._onMouseMove,i)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t});var i=this;this._hoveredTargets.forEach((function(n){i.fire("mouse:out",{target:e,e:t}),n&&e.fire("mouseout",{e:t})})),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach((function(t){t.isEditing&&t.hiddenTextarea.focus()}))},_onMouseEnter:function(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onDrop:function(t){return this._simpleEventHandler("drop:before",t),this._simpleEventHandler("drop",t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId:function(t){var e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1},_isMainEvent:function(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(n){n.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(n)),this.__onMouseDown(n),this._resetTransformEventData();var s=this.upperCanvasEl,o=this._getEventPrefix();t(_.document,"touchend",this._onTouchEnd,i),t(_.document,"touchmove",this._onMouseMove,i),e(s,o+"down",this._onMouseDown)},_onMouseDown:function(n){this.__onMouseDown(n),this._resetTransformEventData();var s=this.upperCanvasEl,o=this._getEventPrefix();e(s,o+"move",this._onMouseMove,i),t(_.document,o+"up",this._onMouseUp),t(_.document,o+"move",this._onMouseMove,i)},_onTouchEnd:function(n){if(!(n.touches.length>0)){this.__onMouseUp(n),this._resetTransformEventData(),this.mainTouchId=null;var s=this._getEventPrefix();e(_.document,"touchend",this._onTouchEnd,i),e(_.document,"touchmove",this._onMouseMove,i);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((function(){t(o.upperCanvasEl,s+"down",o._onMouseDown),o._willAddMouseDown=0}),400)}},_onMouseUp:function(n){this.__onMouseUp(n),this._resetTransformEventData();var s=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(n)&&(e(_.document,o+"up",this._onMouseUp),e(_.document,o+"move",this._onMouseMove,i),t(s,o+"move",this._onMouseMove,i))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t){var e=this._activeObject;return!!(!!e!=!!t||e&&t&&e!==t)||(e&&e.isEditing,!1)},__onMouseUp:function(t){var e,i=this._currentTransform,s=this._groupSelector,o=!1,r=!s||0===s.left&&0===s.top;if(this._cacheTransformEventData(t),e=this._target,this._handleEvent(t,"up:before"),n(t,3))this.fireRightClick&&this._handleEvent(t,"up",3,r);else{if(n(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,r),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else if(this._isMainEvent(t)){if(i&&(this._finalizeCurrentTransform(t),o=i.actionPerformed),!r){var a=e===this._activeObject;this._maybeGroupObjects(t),o||(o=this._shouldRender(e)||!a&&e===this._activeObject)}var l,h;if(e){if(l=e._findTargetCorner(this.getPointer(t,!0),_.util.isTouchEvent(t)),e.selectable&&e!==this._activeObject&&"up"===e.activeOn)this.setActiveObject(e,t),o=!0;else{var c=e.controls[l],d=c&&c.getMouseUpHandler(t,e,c);d&&d(t,i,(h=this.getPointer(t)).x,h.y)}e.isMoving=!1}if(i&&(i.target!==e||i.corner!==l)){var u=i.target&&i.target.controls[i.corner],p=u&&u.getMouseUpHandler(t,e,c);h=h||this.getPointer(t),p&&p(t,i,h.x,h.y)}this._setCursorFromEvent(t,e),this._handleEvent(t,"up",1,r),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=0),o?this.requestRenderAll():r||this.renderTop()}}},_simpleEventHandler:function(t,e){var i=this.findTarget(e),n=this.targets,s={e,target:i,subTargets:n};if(this.fire(t,s),i&&i.fire(t,s),!n)return i;for(var o=0;o<n.length;o++)n[o].fire(t,s);return i},_handleEvent:function(t,e,i,n){var s=this._target,o=this.targets||[],r={e:t,target:s,subTargets:o,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===e&&(r.currentTarget=this.findTarget(t),r.currentSubTargets=this.targets),this.fire("mouse:"+e,r),s&&s.fire("mouse"+e,r);for(var a=0;a<o.length;a++)o[a].fire("mouse"+e,r)},_finalizeCurrentTransform:function(t){var e=this._currentTransform,i=e.target,n={e:t,target:i,transform:e,action:e.action};i._scaling&&(i._scaling=!1),i.setCoords(),(e.actionPerformed||this.stateful&&i.hasStateChanged())&&this._fire("modified",n)},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll();var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){var e=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:e}),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(n(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(n(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(this._isMainEvent(t)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var s=this._shouldRender(e),o=this._shouldGroup(t,e);if(this._shouldClearSelection(t,e)?this.discardActiveObject(t):o&&(this._handleGrouping(t,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),e){var r=e===this._activeObject;e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);var a=e._findTargetCorner(this.getPointer(t,!0),_.util.isTouchEvent(t));if(e.__corner=a,e===this._activeObject&&(a||!o)){this._setupCurrentTransform(t,e,r);var l=e.controls[a],h=(i=this.getPointer(t),l&&l.getMouseDownHandler(t,e,l));h&&h(t,this._currentTransform,i.x,i.y)}}this._handleEvent(t,"down"),(s||o)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e})},__onMouseMove:function(t){var e,i;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(this._isMainEvent(t)){var n=this._groupSelector;n?(i=this._absolutePointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,e){var i=this._hoveredTarget,n=this._hoveredTargets,s=this.targets,o=Math.max(n.length,s.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var r=0;r<o;r++)this.fireSyntheticInOutEvents(s[r],e,{oldTarget:n[r],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(t,e){var i=this._draggedoverTarget,n=this._hoveredTargets,s=this.targets,o=Math.max(n.length,s.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var r=0;r<o;r++)this.fireSyntheticInOutEvents(s[r],e,{oldTarget:n[r],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents:function(t,e,i){var n,s,o,r=i.oldTarget,a=r!==t,l=i.canvasEvtIn,h=i.canvasEvtOut;a&&(n={e,target:t,previousTarget:r},s={e,target:r,nextTarget:t}),o=t&&a,r&&a&&(h&&this.fire(h,s),r.fire(i.evtOut,s)),o&&(l&&this.fire(l,n),t.fire(i.evtIn,n))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var n=i.x,s=i.y,o=e.action,r=!1,a=e.actionHandler;a&&(r=a(t,e,n,s)),"drag"===o&&r&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||r},_fire:_.controlsUtils.fireEvent,_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,s=(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));s?this.setCursor(this.getCornerCursor(s,e,t)):(e.subTargetCheck&&this.targets.concat().reverse().map((function(t){i=t.hoverCursor||i})),this.setCursor(i))},getCornerCursor:function(t,e,i){var n=e.controls[t];return n.cursorStyleHandler(i,n,e)}})}(),y=Math.min,x=Math.max,_.util.object.extend(_.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)&&!e.onSelect({e:t})},_handleGrouping:function(t,e){var i=this._activeObject;i.__corner||(e!==i||(e=this.findTarget(t,!0))&&e.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,n=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),n=this._createGroup(t);this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this._objects,i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new _.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects(t);1===i.length?this.setActiveObject(i[0],t):i.length>1&&(e=new _.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(t){for(var e,i=[],n=this._groupSelector.ex,s=this._groupSelector.ey,o=n+this._groupSelector.left,r=s+this._groupSelector.top,a=new _.Point(y(n,o),y(s,r)),l=new _.Point(x(n,o),x(s,r)),h=!this.selectionFullyContained,c=n===o&&s===r,d=this._objects.length;d--&&!((e=this._objects[d])&&e.selectable&&e.visible&&(h&&e.intersectsWithRect(a,l,!0)||e.isContainedWithinRect(a,l,!0)||h&&e.containsPoint(a,null,!0)||h&&e.containsPoint(l,null,!0))&&(i.push(e),c)););return i.length>1&&(i=i.filter((function(e){return!e.onSelect({e:t})}))),i},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}}),_.util.object.extend(_.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=(t.multiplier||1)*(t.enableRetinaScaling?this.getRetinaScaling():1),s=this.toCanvasElement(n,t);return _.util.toDataURL(s,e,i)},toCanvasElement:function(t,e){t=t||1;var i=((e=e||{}).width||this.width)*t,n=(e.height||this.height)*t,s=this.getZoom(),o=this.width,r=this.height,a=s*t,l=this.viewportTransform,h=(l[4]-(e.left||0))*t,c=(l[5]-(e.top||0))*t,d=this.interactive,u=[a,0,0,a,h,c],p=this.enableRetinaScaling,g=_.util.createCanvasElement(),f=this.contextTop;return g.width=i,g.height=n,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=u,this.width=i,this.height=n,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),this._objects),this.viewportTransform=l,this.width=o,this.height=r,this.calcViewportBoundaries(),this.interactive=d,this.enableRetinaScaling=p,this.contextTop=f,g}}),_.util.object.extend(_.StaticCanvas.prototype,{loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):_.util.object.clone(t),s=this,o=n.clipPath,r=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete n.clipPath,this._enlivenObjects(n.objects,(function(t){s.clear(),s._setBgOverlay(n,(function(){o?s._enlivenObjects([o],(function(i){s.clipPath=i[0],s.__setupCanvas.call(s,n,t,r,e)})):s.__setupCanvas.call(s,n,t,r,e)}))}),i),this}},__setupCanvas:function(t,e,i,n){var s=this;e.forEach((function(t,e){s.insertAt(t,e)})),this.renderOnAddRemove=i,delete t.objects,delete t.backgroundImage,delete t.overlayImage,delete t.background,delete t.overlay,this._setOptions(t),this.renderAll(),n&&n()},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,n),this.__setBgOverlay("overlayImage",t.overlayImage,i,n),this.__setBgOverlay("backgroundColor",t.background,i,n),this.__setBgOverlay("overlayColor",t.overlay,i,n)}else e&&e()},__setBgOverlay:function(t,e,i,n){var s=this;if(!e)return i[t]=!0,void(n&&n());"backgroundImage"===t||"overlayImage"===t?_.util.enlivenObjects([e],(function(e){s[t]=e[0],i[t]=!0,n&&n()})):this["set"+_.util.string.capitalize(t,!0)](e,(function(){i[t]=!0,n&&n()}))},_enlivenObjects:function(t,e,i){t&&0!==t.length?_.util.enlivenObjects(t,(function(t){e&&e(t)}),null,i):e&&e([])},_toDataURL:function(t,e){this.clone((function(i){e(i.toDataURL(t))}))},_toDataURLWithMultiplier:function(t,e,i){this.clone((function(n){i(n.toDataURLWithMultiplier(t,e))}))},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData((function(e){e.loadFromJSON(i,(function(){t&&t(e)}))}))},cloneWithoutData:function(t){var e=_.util.createCanvasElement();e.width=this.width,e.height=this.height;var i=new _.Canvas(e);this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,(function(){i.renderAll(),t&&t(i)})),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,s=e.util.toFixed,o=e.util.string.capitalize,r=e.util.degreesToRadians,a=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(t){var i=e.perfLimitSizeTotal,n=t.width,s=t.height,o=e.maxCacheSideLimit,r=e.minCacheSideLimit;if(n<=o&&s<=o&&n*s<=i)return n<r&&(t.width=r),s<r&&(t.height=r),t;var a=n/s,l=e.util.limitDimsByArea(a,i),h=e.util.capValue,c=h(r,l.x,o),d=h(r,l.y,o);return n>c&&(t.zoomX/=n/c,t.width=c,t.capped=!0),s>d&&(t.zoomY/=s/d,t.height=d,t.capped=!0),t},_getCacheCanvasDimensions:function(){var t=this.getTotalObjectScaling(),e=this._getTransformedDimensions(0,0),i=e.x*t.scaleX/this.scaleX,n=e.y*t.scaleY/this.scaleY;return{width:i+2,height:n+2,zoomX:t.scaleX,zoomY:t.scaleY,x:i,y:n}},_updateCacheCanvas:function(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var i=t._currentTransform.target,n=t._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var s,o,r=this._cacheCanvas,a=this._limitCacheSize(this._getCacheCanvasDimensions()),l=e.minCacheSideLimit,h=a.width,c=a.height,d=a.zoomX,u=a.zoomY,p=h!==this.cacheWidth||c!==this.cacheHeight,g=this.zoomX!==d||this.zoomY!==u,f=p||g,m=0,v=0,y=!1;if(p){var x=this._cacheCanvas.width,w=this._cacheCanvas.height,b=h>x||c>w;y=b||(h<.9*x||c<.9*w)&&x>l&&w>l,b&&!a.capped&&(h>l||c>l)&&(m=.1*h,v=.1*c)}return this instanceof e.Text&&this.path&&(f=!0,y=!0,m+=this.getHeightOfLine(0)*this.zoomX,v+=this.getHeightOfLine(0)*this.zoomY),!!f&&(y?(r.width=Math.ceil(h+m),r.height=Math.ceil(c+v)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,r.width,r.height)),s=a.x/2,o=a.y/2,this.cacheTranslationX=Math.round(r.width/2-s)+s,this.cacheTranslationY=Math.round(r.height/2-o)+o,this.cacheWidth=h,this.cacheHeight=c,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(d,u),this.zoomX=d,this.zoomY=u,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t){var e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,i=this.calcTransformMatrix(!e);t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:s(this.left,i),top:s(this.top,i),width:s(this.width,i),height:s(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:s(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:s(this.strokeMiterLimit,i),scaleX:s(this.scaleX,i),scaleY:s(this.scaleY,i),angle:s(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:s(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:s(this.skewX,i),skewY:s(this.skewY,i)};return this.clipPath&&!this.clipPath.excludeFromExport&&(n.clipPath=this.clipPath.toObject(t),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach((function(e){"left"!==e&&"top"!==e&&(t[e]===i[e]&&delete t[e],Array.isArray(t[e])&&Array.isArray(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e])})),t},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var t=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(t.scaleX),scaleY:Math.abs(t.scaleY)}},getTotalObjectScaling:function(){var t=this.getObjectScaling(),e=t.scaleX,i=t.scaleY;if(this.canvas){var n=this.canvas.getZoom(),s=this.canvas.getRetinaScaling();e*=n*s,i*=n*s}return{scaleX:e,scaleY:i}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,i){var n="scaleX"===t||"scaleY"===t,s=this[t]!==i,o=!1;return n&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",i):i=new e.Shadow(i),this[t]=i,s&&(o=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,o&&this.group.set("dirty",!0)):o&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),t.restore())},renderCache:function(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(t,i){if(t.save(),i.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",i.absolutePositioned){var n=e.util.invertTransform(this.calcTransformMatrix());t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},drawObject:function(t,e){var i=this.fill,n=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=i,this.stroke=n},_drawClipPath:function(t,e){e&&(e.canvas=this.canvas,e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){var i=e.stroke;i&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(t,i):(t.strokeStyle=i.toLive(t,this),this._applyPatternGradientTransform(t,i)):t.strokeStyle=e.stroke)},_setFillStyles:function(t,e){var i=e.fill;i&&(i.toLive?(t.fillStyle=i.toLive(t,this),this._applyPatternGradientTransform(t,e.fill)):t.fillStyle=i)},_setClippingProperties:function(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"},_setLineDash:function(t,e){e&&0!==e.length&&(1&e.length&&e.push.apply(e,e),t.setLineDash(e))},_renderControls:function(t,i){var n,s,o,a=this.getViewportTransform(),l=this.calcTransformMatrix();s=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,o=void 0!==i.hasControls?i.hasControls:this.hasControls,l=e.util.multiplyTransformMatrices(a,l),n=e.util.qrDecompose(l),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(n.angle-=180),t.rotate(r(this.group?n.angle:this.angle)),i.forActiveSelection||this.group?s&&this.drawBordersInGroup(t,n,i):s&&this.drawBorders(t,i),o&&this.drawControls(t,i),t.restore()},_setShadow:function(t){if(this.shadow){var i,n=this.shadow,s=this.canvas,o=s&&s.viewportTransform[0]||1,r=s&&s.viewportTransform[3]||1;i=n.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),s&&s._isRetinaScaling()&&(o*=e.devicePixelRatio,r*=e.devicePixelRatio),t.shadowColor=n.color,t.shadowBlur=n.blur*e.browserShadowBlurConstant*(o+r)*(i.scaleX+i.scaleY)/4,t.shadowOffsetX=n.offsetX*o*i.scaleX,t.shadowOffsetY=n.offsetY*r*i.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,n,s):t.transform(1,0,0,1,n,s),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:s}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_render:function(){},_renderFill:function(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform&&this.group){var e=this.getObjectScaling();t.scale(1/e.scaleX,1/e.scaleY)}else this.strokeUniform&&t.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}},_applyPatternForTransformedGradient:function(t,i){var n,s=this._limitCacheSize(this._getCacheCanvasDimensions()),o=e.util.createCanvasElement(),r=this.canvas.getRetinaScaling(),a=s.x/this.scaleX/r,l=s.y/this.scaleY/r;o.width=a,o.height=l,(n=o.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(a,0),n.lineTo(a,l),n.lineTo(0,l),n.closePath(),n.translate(a/2,l/2),n.scale(s.zoomX/this.scaleX/r,s.zoomY/this.scaleY/r),this._applyPatternGradientTransform(n,i),n.fillStyle=i.toLive(t),n.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(r*this.scaleX/s.zoomX,r*this.scaleY/s.zoomY),t.strokeStyle=n.createPattern(o,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(t){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=e.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,i.x+=t.offsetLeft,i.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(i,"center","center")},clone:function(t,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,t):e.Object._fromObject("Object",n,t)},cloneAsImage:function(t,i){var n=this.toCanvasElement(i);return t&&t(new e.Image(n)),this},toCanvasElement:function(t){t||(t={});var i=e.util,n=i.saveObjectTransform(this),s=this.group,o=this.shadow,r=Math.abs,a=(t.multiplier||1)*(t.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,t.withoutTransform&&i.resetObjectTransform(this),t.withoutShadow&&(this.shadow=null);var l,h,c,d,u=e.util.createCanvasElement(),p=this.getBoundingRect(!0,!0),g=this.shadow,f={x:0,y:0};g&&(h=g.blur,l=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),f.x=2*Math.round(r(g.offsetX)+h)*r(l.scaleX),f.y=2*Math.round(r(g.offsetY)+h)*r(l.scaleY)),c=p.width+f.x,d=p.height+f.y,u.width=Math.ceil(c),u.height=Math.ceil(d);var m=new e.StaticCanvas(u,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(m.width/2,m.height/2),"center","center");var v=this.canvas;m.add(this);var y=m.toCanvasElement(a||1,t);return this.shadow=o,this.set("canvas",v),s&&(this.group=s),this.set(n).setCoords(),m._objects=[],m.dispose(),m=null,y},toDataURL:function(t){return t||(t={}),e.util.toDataURL(this.toCanvasElement(t),t.format||"png",t.quality||1)},isType:function(t){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),s=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,s,r(-this.angle))),{x:n.x-s.x,y:n.y-s.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){e.runningAnimations&&e.runningAnimations.cancelByTarget(this)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.ENLIVEN_PROPS=["clipPath"],e.Object._fromObject=function(t,i,s,o){var r=e[t];i=n(i,!0),e.util.enlivenPatterns([i.fill,i.stroke],(function(t){void 0!==t[0]&&(i.fill=t[0]),void 0!==t[1]&&(i.stroke=t[1]),e.util.enlivenObjectEnlivables(i,i,(function(){var t=o?new r(i[o],i):new r(i);s&&s(t)}))}))},e.Object.__uid=0)}(e),w=_.util.degreesToRadians,b={left:-.5,center:0,right:.5},C={top:-.5,center:0,bottom:.5},_.util.object.extend(_.Object.prototype,{translateToGivenOrigin:function(t,e,i,n,s){var o,r,a,l=t.x,h=t.y;return"string"==typeof e?e=b[e]:e-=.5,"string"==typeof n?n=b[n]:n-=.5,"string"==typeof i?i=C[i]:i-=.5,"string"==typeof s?s=C[s]:s-=.5,r=s-i,((o=n-e)||r)&&(a=this._getTransformedDimensions(),l=t.x+o*a.x,h=t.y+r*a.y),new _.Point(l,h)},translateToCenterPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,e,i,"center","center");return this.angle?_.util.rotatePoint(n,t,w(this.angle)):n},translateToOriginPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,"center","center",e,i);return this.angle?_.util.rotatePoint(n,t,w(this.angle)):n},getCenterPoint:function(){var t=new _.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(t,e,i){var n,s,o=this.getCenterPoint();return n=void 0!==e&&void 0!==i?this.translateToGivenOrigin(o,"center","center",e,i):new _.Point(this.left,this.top),s=new _.Point(t.x,t.y),this.angle&&(s=_.util.rotatePoint(s,o,-w(this.angle))),s.subtractEquals(n)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),s=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",s.x),this.set("top",s.y)},adjustPosition:function(t){var e,i,n=w(this.angle),s=this.getScaledWidth(),o=_.util.cos(n)*s,r=_.util.sin(n)*s;e="string"==typeof this.originX?b[this.originX]:this.originX-.5,i="string"==typeof t?b[t]:t-.5,this.left+=o*(i-e),this.top+=r*(i-e),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var t=_.util,e=t.degreesToRadians,i=t.multiplyTransformMatrices,n=t.transformPoint;t.object.extend(_.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(t,e){return e?t?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),t?this.aCoords:this.lineCoords)},getCoords:function(t,e){return i=this._getCoords(t,e),[new _.Point(i.tl.x,i.tl.y),new _.Point(i.tr.x,i.tr.y),new _.Point(i.br.x,i.br.y),new _.Point(i.bl.x,i.bl.y)];var i},intersectsWithRect:function(t,e,i,n){var s=this.getCoords(i,n);return"Intersection"===_.Intersection.intersectPolygonRectangle(s,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===_.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var n=this.getCoords(e,i),s=e?t.aCoords:t.lineCoords,o=0,r=t._getImageLines(s);o<4;o++)if(!t.containsPoint(n[o],r))return!1;return!0},isContainedWithinRect:function(t,e,i,n){var s=this.getBoundingRect(i,n);return s.left>=t.x&&s.left+s.width<=e.x&&s.top>=t.y&&s.top+s.height<=e.y},containsPoint:function(t,e,i,n){var s=this._getCoords(i,n),o=(e=e||this._getImageLines(s),this._findCrossPoints(t,e));return 0!==o&&o%2==1},isOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.getCoords(!0,t).some((function(t){return t.x<=i.x&&t.x>=e.x&&t.y<=i.y&&t.y>=e.y}))||!!this.intersectsWithRect(e,i,!0,t)||this._containsCenterOfCanvas(e,i,t)},_containsCenterOfCanvas:function(t,e,i){var n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,i,!0,t)||this.getCoords(!0,t).every((function(t){return(t.x>=i.x||t.x<=e.x)&&(t.y>=i.y||t.y<=e.y)}))&&this._containsCenterOfCanvas(e,i,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,s,o=0;for(var r in e)if(!((s=e[r]).o.y<t.y&&s.d.y<t.y||s.o.y>=t.y&&s.d.y>=t.y||(s.o.x===s.d.x&&s.o.x>=t.x?n=s.o.x:(i=(s.d.y-s.o.y)/(s.d.x-s.o.x),n=-(t.y-0*t.x-(s.o.y-i*s.o.x))/(0-i)),n>=t.x&&(o+=1),2!==o)))break;return o},getBoundingRect:function(e,i){var n=this.getCoords(e,i);return t.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcLineCoords:function(){var i=this.getViewportTransform(),s=this.padding,o=e(this.angle),r=t.cos(o)*s,a=t.sin(o)*s,l=r+a,h=r-a,c=this.calcACoords(),d={tl:n(c.tl,i),tr:n(c.tr,i),bl:n(c.bl,i),br:n(c.br,i)};return s&&(d.tl.x-=h,d.tl.y-=l,d.tr.x+=l,d.tr.y-=h,d.bl.x-=l,d.bl.y+=h,d.br.x+=h,d.br.y+=l),d},calcOCoords:function(){var t=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),n=this.getViewportTransform(),s=i(n,e),o=i(s,t),r=(o=i(o,[1/n[0],0,0,1/n[3],0,0]),this._calculateCurrentDimensions()),a={};return this.forEachControl((function(t,e,i){a[e]=t.positionHandler(r,o,i)})),a},calcACoords:function(){var t=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),s=i(e,t),o=this._getTransformedDimensions(),r=o.x/2,a=o.y/2;return{tl:n({x:-r,y:-a},s),tr:n({x:r,y:-a},s),bl:n({x:-r,y:a},s),br:n({x:r,y:a},s)}},setCoords:function(t){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),t||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return t.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var e="_",i="";return!t&&this.group&&(i=this.group.transformMatrixKey(t)+e),i+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){var e=this.calcOwnMatrix();if(t||!this.group)return e;var n=this.transformMatrixKey(t),s=this.matrixCache||(this.matrixCache={});return s.key===n?s.value:(this.group&&(e=i(this.group.calcTransformMatrix(!1),e)),s.key=n,s.value=e,e)},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===e)return i.value;var n=this._calcTranslateMatrix(),s={angle:this.angle,translateX:n[4],translateY:n[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=e,i.value=t.composeMatrix(s),i.value},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(e,i){void 0===e&&(e=this.skewX),void 0===i&&(i=this.skewY);var n,s,o,r=0===e&&0===i;if(this.strokeUniform?(s=this.width,o=this.height):(s=(n=this._getNonTransformedDimensions()).x,o=n.y),r)return this._finalizeDimensions(s*this.scaleX,o*this.scaleY);var a=t.sizeAfterTransform(s,o,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:e,skewY:i});return this._finalizeDimensions(a.x,a.y)},_finalizeDimensions:function(t,e){return this.strokeUniform?{x:t+this.strokeWidth,y:e+this.strokeWidth}:{x:t,y:e}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return n(e,t,!0).scalarAdd(2*this.padding)}})}(),_.util.object.extend(_.Object.prototype,{sendToBack:function(){return this.group?_.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?_.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?_.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas&&this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?_.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas&&this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&"activeSelection"!==this.group.type?_.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas&&this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new _.Color(e),n=t+": "+i.toRgb()+"; ",s=i.getAlpha();return 1!==s&&(n+=t+"-opacity: "+s.toString()+"; "),n}return t+": none; "}var e=_.util.toFixed;_.util.object.extend(_.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",d=e?"":this.getSvgFilter(),u=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",l,"; ",u,"fill-rule: ",i,"; ","opacity: ",h,";",d,c].join("")},getSvgSpanStyles:function(e,i){var n="; ",s=e.fontFamily?"font-family: "+(-1===e.fontFamily.indexOf("'")&&-1===e.fontFamily.indexOf('"')?"'"+e.fontFamily+"'":e.fontFamily)+n:"",o=e.strokeWidth?"stroke-width: "+e.strokeWidth+n:"",r=e.fontSize?"font-size: "+e.fontSize+"px"+n:"",a=e.fontStyle?"font-style: "+e.fontStyle+n:"",l=e.fontWeight?"font-weight: "+e.fontWeight+n:"",h=e.fill?t("fill",e.fill):"",c=e.stroke?t("stroke",e.stroke):"",d=this.getSvgTextDecoration(e);return d&&(d="text-decoration: "+d+n),[c,o,s,r,a,l,d,h,e.deltaY?"baseline-shift: "+-e.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(t){return["overline","underline","line-through"].filter((function(e){return t[e.replace("-","")]})).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(t,e){var i=t?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+_.util.matrixToSVG(i)+(e||"")+'" '},_setSVGBg:function(t){if(this.backgroundColor){var i=_.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,i),'" y="',e(-this.height/2,i),'" width="',e(this.width,i),'" height="',e(this.height,i),'"></rect>\n')}},toSVG:function(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})},toClipPathSVG:function(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})},_createBaseClipPathSVGMarkup:function(t,e){var i=(e=e||{}).reviver,n=e.additionalTransform||"",s=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),o=t.indexOf("COMMON_PARTS");return t[o]=s,i?i(t.join("")):t.join("")},_createBaseSVGMarkup:function(t,e){var i,n,s=(e=e||{}).noStyle,o=e.reviver,r=s?"":'style="'+this.getSvgStyles()+'" ',a=e.withShadow?'style="'+this.getSvgFilter()+'" ':"",l=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=l&&l.absolutePositioned,d=this.stroke,u=this.fill,p=this.shadow,g=[],f=t.indexOf("COMMON_PARTS"),m=e.additionalTransform;return l&&(l.clipPathId="CLIPPATH_"+_.Object.__uid++,n='<clipPath id="'+l.clipPathId+'" >\n'+l.toClipPathSVG(o)+"</clipPath>\n"),c&&g.push("<g ",a,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":a+this.getSvgCommons()," >\n"),i=[r,h,s?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':""].join(""),t[f]=i,u&&u.toLive&&g.push(u.toSVG(this)),d&&d.toLive&&g.push(d.toSVG(this)),p&&g.push(p.toSVG(this)),l&&g.push(n),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),o?o(g.join("")):g.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var t=_.util.object.extend,e="stateProperties";function i(e,i,n){var s={};n.forEach((function(t){s[t]=e[t]})),t(e[i],s,!0)}function n(t,e,i){if(t===e)return!0;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var s=0,o=t.length;s<o;s++)if(!n(t[s],e[s]))return!1;return!0}if(t&&"object"==typeof t){var r,a=Object.keys(t);if(!e||"object"!=typeof e||!i&&a.length!==Object.keys(e).length)return!1;for(s=0,o=a.length;s<o;s++)if("canvas"!==(r=a[s])&&"group"!==r&&!n(t[r],e[r]))return!1;return!0}}_.util.object.extend(_.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||e);return Object.keys(this[i]).length<this[t].length||!n(this[i],this,!0)},saveState:function(t){var n=t&&t.propertySet||e,s="_"+n;return this[s]?(i(this,s,this[n]),t&&t.stateProperties&&i(this,s,t.stateProperties),this):this.setupState(t)},setupState:function(t){var i=(t=t||{}).propertySet||e;return t.propertySet=i,this["_"+i]={},this.saveState(t),this}})}(),function(){var t=_.util.degreesToRadians;_.util.object.extend(_.Object.prototype,{_findTargetCorner:function(t,e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i,n,s,o=t.x,r=t.y,a=Object.keys(this.oCoords),l=a.length-1;for(this.__corner=0;l>=0;l--)if(s=a[l],this.isControlVisible(s)&&(n=this._getImageLines(e?this.oCoords[s].touchCorner:this.oCoords[s].corner),0!==(i=this._findCrossPoints({x:o,y:r},n))&&i%2==1))return this.__corner=s,s;return!1},forEachControl:function(t){for(var e in this.controls)t(this.controls[e],e,this)},_setCornerCoords:function(){var t=this.oCoords;for(var e in t){var i=this.controls[e];t[e].corner=i.calcCornerCoords(this.angle,this.cornerSize,t[e].x,t[e].y,!1),t[e].touchCorner=i.calcCornerCoords(this.angle,this.touchCornerSize,t[e].x,t[e].y,!0)}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),s=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/s[0],1/s[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,s=i.x+n,o=i.y+n,r=void 0!==e.hasControls?e.hasControls:this.hasControls,a=!1;return t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray),t.strokeRect(-s/2,-o/2,s,o),r&&(t.beginPath(),this.forEachControl((function(e,i,n){e.withConnection&&e.getVisibility(n,i)&&(a=!0,t.moveTo(e.x*s,e.y*o),t.lineTo(e.x*s+e.offsetX,e.y*o+e.offsetY))})),a&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n=_.util.sizeAfterTransform(this.width,this.height,e),s=this.strokeWidth,o=this.strokeUniform,r=this.borderScaleFactor,a=n.x+s*(o?this.canvas.getZoom():e.scaleX)+r,l=n.y+s*(o?this.canvas.getZoom():e.scaleY)+r;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-a/2,-l/2,a,l),t.restore(),this},drawControls:function(t,e){e=e||{},t.save();var i,n,s=this.canvas.getRetinaScaling();return t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl((function(s,o,r){n=r.oCoords[o],s.getVisibility(r,o)&&(i&&(n=_.util.transformPoint(n,i)),s.render(t,n.x,n.y,e,r))})),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,e){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},onDeselect:function(){},onSelect:function(){}})}(),_.util.object.extend(_.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,s=e.onChange||i,o=this;return _.util.animate({target:this,startValue:t.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.requestRenderAll(),s()},onComplete:function(){t.setCoords(),n()}})},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,s=e.onChange||i,o=this;return _.util.animate({target:this,startValue:t.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.requestRenderAll(),s()},onComplete:function(){t.setCoords(),n()}})},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,s=e.onChange||i,o=this;return _.util.animate({target:this,startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),o.requestRenderAll(),s()},onComplete:function(){o.remove(t),n()}})}}),_.util.object.extend(_.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[],n=[];for(t in arguments[0])i.push(t);for(var s=0,o=i.length;s<o;s++)t=i[s],e=s!==o-1,n.push(this._animate(t,arguments[0][t],arguments[1],e));return n}return this._animate.apply(this,arguments)},_animate:function(t,e,i,n){var s,o=this;e=e.toString(),i=i?_.util.object.clone(i):{},~t.indexOf(".")&&(s=t.split("."));var r=o.colorProperties.indexOf(t)>-1||s&&o.colorProperties.indexOf(s[1])>-1,a=s?this.get(s[0])[s[1]]:this.get(t);"from"in i||(i.from=a),r||(e=~e.indexOf("=")?a+parseFloat(e.replace("=","")):parseFloat(e));var l={target:this,startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(t,e,n){return i.abort.call(o,t,e,n)},onChange:function(e,r,a){s?o[s[0]][s[1]]=e:o.set(t,e),n||i.onChange&&i.onChange(e,r,a)},onComplete:function(t,e,s){n||(o.setCoords(),i.onComplete&&i.onComplete(t,e,s))}};return r?_.util.animateColor(l.startValue,l.endValue,l.duration,l):_.util.animate(l)}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,s={x1:1,x2:1,y1:1,y2:1};function o(t,e){var i=t.origin,n=t.axis1,s=t.axis2,o=t.dimension,r=e.nearest,a=e.center,l=e.farthest;return function(){switch(this.get(i)){case r:return Math.min(this.get(n),this.get(s));case a:return Math.min(this.get(n),this.get(s))+.5*this.get(o);case l:return Math.max(this.get(n),this.get(s))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==s[t]&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){t.beginPath();var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},_toSVG:function(){var t=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'" />\n']}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n,s){s=s||{};var o=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),r=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];n(new e.Line(r,i(o,s)))},e.Line.fromObject=function(t,i){var s=n(t,!0);s.points=[t.x1,t.y1,t.x2,t.y2],e.Object._fromObject("Line",s,(function(t){delete t.points,i&&i(t)}),"points")})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.degreesToRadians;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,n=(this.endAngle-this.startAngle)%360;if(0===n)t=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var s=i(this.startAngle),o=i(this.endAngle),r=this.radius;t=['<path d="M '+e.util.cos(s)*r+" "+e.util.sin(s)*r," A "+r+" "+r," 0 ",+(n>180?"1":"0")+" 1"," "+e.util.cos(o)*r+" "+e.util.sin(o)*r,'" ',"COMMON_PARTS"," />\n"]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,i(this.startAngle),i(this.endAngle),!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){var n,s=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=s)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");s.left=(s.left||0)-s.radius,s.top=(s.top||0)-s.radius,i(new e.Circle(s))},e.Circle.fromObject=function(t,i){e.Object._fromObject("Circle",t,i)})}(e),function(t){var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)},_toSVG:function(){var t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-t+" "+e,"0 "+-e,t+" "+e].join(","),'" />']}}),e.Triangle.fromObject=function(t,i){return e.Object._fromObject("Triangle",t,i)})}(e),function(t){var e=t.fabric||(t.fabric={}),i=2*Math.PI;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,i,!1),t.restore(),this._renderPaintInOrder(t)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new e.Ellipse(n))},e.Ellipse.fromObject=function(t,i){e.Object._fromObject("Ellipse",t,i)})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Rect?e.warn("fabric.Rect is already defined"):(e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,s=this.height,o=-this.width/2,r=-this.height/2,a=0!==e||0!==i,l=.4477152502;t.beginPath(),t.moveTo(o+e,r),t.lineTo(o+n-e,r),a&&t.bezierCurveTo(o+n-l*e,r,o+n,r+l*i,o+n,r+i),t.lineTo(o+n,r+s-i),a&&t.bezierCurveTo(o+n,r+s-l*i,o+n-l*e,r+s,o+n-e,r+s),t.lineTo(o+e,r+s),a&&t.bezierCurveTo(o+l*e,r+s,o,r+s-l*i,o,r+s-i),t.lineTo(o,r+i),a&&t.bezierCurveTo(o,r+l*i,o+l*e,r,o+e,r),t.closePath(),this._renderPaintInOrder(t)},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n,s){if(!t)return n(null);s=s||{};var o=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0,o.height=o.height||0,o.width=o.width||0;var r=new e.Rect(i(s?e.util.object.clone(s):{},o));r.visible=r.visible&&r.width>0&&r.height>0,n(r)},e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,s=e.util.array.max,o=e.util.toFixed,r=e.util.projectStrokeOnPoints;e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._setPositionDimensions(e)},_projectStrokeOnPoints:function(){return r(this.points,this,!0)},_setPositionDimensions:function(t){var e,i=this._calcDimensions(t),n=this.exactBoundingBox?this.strokeWidth:0;this.width=i.width-n,this.height=i.height-n,t.fromSVG||(e=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2+n/2,y:i.top-this.strokeWidth/2+n/2},"left","top",this.originX,this.originY)),void 0===t.left&&(this.left=t.fromSVG?i.left:e.x),void 0===t.top&&(this.top=t.fromSVG?i.top:e.y),this.pathOffset={x:i.left+this.width/2+n/2,y:i.top+this.height/2+n/2}},_calcDimensions:function(){var t=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,e=n(t,"x")||0,i=n(t,"y")||0;return{left:e,top:i,width:(s(t,"x")||0)-e,height:(s(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},_toSVG:function(){for(var t=[],i=this.pathOffset.x,n=this.pathOffset.y,s=e.Object.NUM_FRACTION_DIGITS,r=0,a=this.points.length;r<a;r++)t.push(o(this.points[r].x-i,s),",",o(this.points[r].y-n,s)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',t.join(""),'" />\n']},commonRender:function(t){var e,i=this.points.length,n=this.pathOffset.x,s=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-s);for(var o=0;o<i;o++)e=this.points[o],t.lineTo(e.x-n,e.y-s);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(t){return function(n,s,o){if(!n)return s(null);o||(o={});var r=e.parsePointsAttribute(n.getAttribute("points")),a=e.parseAttributes(n,e[t].ATTRIBUTE_NAMES);a.fromSVG=!0,s(new e[t](r,i(a,o)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.projectStrokeOnPoints;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return i(this.points,this)},_render:function(t){this.commonRender(t)&&(t.closePath(),this._renderPaintInOrder(t))}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(t,i){e.Object._fromObject("Polygon",t,i,"points")})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,s=e.util.object.extend,o=e.util.object.clone,r=e.util.toFixed;e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(t,e){delete(e=o(e||{})).path,this.callSuper("initialize",e),this._setPath(t||[],e)},_setPath:function(t,i){this.path=e.util.makePathSimpler(Array.isArray(t)?t:e.util.parsePath(t)),e.Polyline.prototype._setPositionDimensions.call(this,i||{})},_renderPathCommands:function(t){var e,i=0,n=0,s=0,o=0,r=0,a=0,l=-this.pathOffset.x,h=-this.pathOffset.y;t.beginPath();for(var c=0,d=this.path.length;c<d;++c)switch((e=this.path[c])[0]){case"L":s=e[1],o=e[2],t.lineTo(s+l,o+h);break;case"M":i=s=e[1],n=o=e[2],t.moveTo(s+l,o+h);break;case"C":s=e[5],o=e[6],r=e[3],a=e[4],t.bezierCurveTo(e[1]+l,e[2]+h,r+l,a+h,s+l,o+h);break;case"Q":t.quadraticCurveTo(e[1]+l,e[2]+h,e[3]+l,e[4]+h),s=e[3],o=e[4],r=e[1],a=e[2];break;case"z":case"Z":s=i,o=n,t.closePath()}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return s(this.callSuper("toObject",t),{path:this.path.map((function(t){return t.slice()}))})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',e.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var t=e.Object.NUM_FRACTION_DIGITS;return" translate("+r(-this.pathOffset.x,t)+", "+r(-this.pathOffset.y,t)+")"},toClipPathSVG:function(t){var e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})},toSVG:function(t){var e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var t,s,o=[],r=[],a=0,l=0,h=0,c=0,d=0,u=this.path.length;d<u;++d){switch((t=this.path[d])[0]){case"L":h=t[1],c=t[2],s=[];break;case"M":a=h=t[1],l=c=t[2],s=[];break;case"C":s=e.util.getBoundsOfCurve(h,c,t[1],t[2],t[3],t[4],t[5],t[6]),h=t[5],c=t[6];break;case"Q":s=e.util.getBoundsOfCurve(h,c,t[1],t[2],t[1],t[2],t[3],t[4]),h=t[3],c=t[4];break;case"z":case"Z":h=a,c=l}s.forEach((function(t){o.push(t.x),r.push(t.y)})),o.push(h),r.push(c)}var p=i(o)||0,g=i(r)||0;return{left:p,top:g,width:(n(o)||0)-p,height:(n(r)||0)-g}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var n=t.sourcePath;e.loadSVGFromURL(n,(function(e){var n=e[0];n.setOptions(t),i&&i(n)}))}else e.Object._fromObject("Path",t,i,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var o=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);o.fromSVG=!0,i(new e.Path(o.d,s(o,n)))})}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var s=e&&e.centerPoint;void 0!==e.originX&&(this.originX=e.originX),void 0!==e.originY&&(this.originY=e.originY),s||this._calcBounds(),this._updateObjectsCoords(s),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0)},_updateObjectsCoords:function(t){t=t||this.getCenterPoint();for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){var i=!!this.group;return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(i&&e.util.removeTransformFromObject(t,this.group.calcTransformMatrix()),this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);if("canvas"===t)for(;n--;)this._objects[n]._set(t,i);e.Object.prototype._set.call(this,t,i)},toObject:function(t){var i=this.includeDefaultValues,n=this._objects.filter((function(t){return!t.excludeFromExport})).map((function(e){var n=e.includeDefaultValues;e.includeDefaultValues=i;var s=e.toObject(t);return e.includeDefaultValues=n,s})),s=e.Object.prototype.toObject.call(this,t);return s.objects=n,s},toDatalessObject:function(t){var i,n=this.sourcePath;if(n)i=n;else{var s=this.includeDefaultValues;i=this._objects.map((function(e){var i=e.includeDefaultValues;e.includeDefaultValues=s;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n}))}var o=e.Object.prototype.toDatalessObject.call(this,t);return o.objects=i,o},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=e.Object.prototype.shouldCache.call(this);if(t)for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1;return t},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._objects[e].render(t);this._drawClipPath(t,this.clipPath)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,s=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-s/2,n,s)}return!0}return!1},_restoreObjectsState:function(){var t=this.calcOwnMatrix();return this._objects.forEach((function(i){e.util.addTransformToObject(i,t),delete i.group,i.setCoords()})),this},destroy:function(){return this._objects.forEach((function(t){t.set("dirty",!0)})),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject((function(t){t.dispose&&t.dispose()})),this._objects=[]},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var s=new e.ActiveSelection([]);return s.set(n),s.type="activeSelection",i.remove(this),t.forEach((function(t){t.group=s,t.dirty=!0,i.add(t)})),s.canvas=i,s._objects=t,i._activeObject=s,s.setCoords(),s}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject((function(t){t.setCoords(!0)})),this},_calcBounds:function(t){for(var e,i,n,s,o=[],r=[],a=["tr","br","bl","tl"],l=0,h=this._objects.length,c=a.length;l<h;++l){for(n=(e=this._objects[l]).calcACoords(),s=0;s<c;s++)i=a[s],o.push(n[i].x),r.push(n[i].y);e.aCoords=n}this._getBounds(o,r,t)},_getBounds:function(t,s,o){var r=new e.Point(i(t),i(s)),a=new e.Point(n(t),n(s)),l=r.y||0,h=r.x||0,c=a.x-r.x||0,d=a.y-r.y||0;this.width=c,this.height=d,o||this.setPositionByOrigin({x:h,y:l},"left","top")},_toSVG:function(t){for(var e=["<g ","COMMON_PARTS"," >\n"],i=0,n=this._objects.length;i<n;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e},getSvgStyles:function(){var t=void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")},toClipPathSVG:function(t){for(var e=[],i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}}),e.Group.fromObject=function(t,i){var n=t.objects,s=e.util.object.clone(t,!0);delete s.objects,"string"!=typeof n?e.util.enlivenObjects(n,(function(n){var s=e.util.object.clone(t,!0);delete s.objects,e.util.enlivenObjectEnlivables(t,s,(function(){i&&i(new e.Group(n,s,!0))}))})):e.loadSVGFromURL(n,(function(o){var r=e.util.groupSVGElements(o,t,n);r.set(s),i&&i(r)}))})}(e),function(t){var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects.concat();this._objects=[];var i=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete i.type,n.set(i),t.forEach((function(t){t.canvas.remove(t),t.group=n})),n._objects=t,!this.canvas)return n;var s=this.canvas;return s.add(n),s._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,s=this._objects.length;n<s;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,(function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))}))})}(e),function(t){var e=_.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?_.warn("fabric.Image is already defined."):(_.Image=_.util.createClass(_.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:_.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:_.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(t,e){e||(e={}),this.filters=[],this.cacheKey="texture"+_.Object.__uid++,this.callSuper("initialize",e),this._initElement(t,e)},getElement:function(){return this._element||{}},setElement:function(t,e){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=t,this._originalElement=t,this._initConfig(e),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(t){var e=_.filterBackend;e&&e.evictCachesForKey&&e.evictCachesForKey(t)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(t){_.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var t=this.getElement();return{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},toObject:function(t){var i=[];this.filters.forEach((function(t){t&&i.push(t.toObject())}));var n=e(this.callSuper("toObject",["cropX","cropY"].concat(t)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var t,e=[],i=[],n=this._element,s=-this.width/2,o=-this.height/2,r="",a="";if(!n)return[];if(this.hasCrop()){var l=_.Object.__uid++;e.push('<clipPath id="imageCrop_'+l+'">\n','\t<rect x="'+s+'" y="'+o+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),r=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(a='" image-rendering="optimizeSpeed'),i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',o-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,a,'"',r,"></image>\n"),this.stroke||this.strokeDashArray){var h=this.fill;this.fill=null,t=["\t<rect ",'x="',s,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=h}return"fill"!==this.paintFirst?e.concat(t,i):e.concat(i,t)},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""},setSrc:function(t,e,i){return _.util.loadImage(t,(function(t,n){this.setElement(t,i),this._setWidthHeight(),e&&e(this,n)}),this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,s=i.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||n>e&&s>e)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=s);_.filterBackend||(_.filterBackend=_.initFilterBackend());var r=_.util.createCanvasElement(),a=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=o.width,h=o.height;r.width=l,r.height=h,this._element=r,this._lastScaleX=t.scaleX=n,this._lastScaleY=t.scaleY=s,_.filterBackend.applyFilters([t],o,l,h,this._element,a),this._filterScalingX=r.width/this._originalElement.width,this._filterScalingY=r.height/this._originalElement.height},applyFilters:function(t){if(t=(t=t||this.filters||[]).filter((function(t){return t&&!t.isNeutralState()})),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){var s=_.util.createCanvasElement();s.width=i,s.height=n,this._element=s,this._filteredEl=s}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return _.filterBackend||(_.filterBackend=_.initFilterBackend()),_.filterBackend.applyFilters(t,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(t){_.util.setImageSmoothing(t,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)},drawCacheOnCanvas:function(t){_.util.setImageSmoothing(t,this.imageSmoothing),_.Object.prototype.drawCacheOnCanvas.call(this,t)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(t){var e=this._element;if(e){var i=this._filterScalingX,n=this._filterScalingY,s=this.width,o=this.height,r=Math.min,a=Math.max,l=a(this.cropX,0),h=a(this.cropY,0),c=e.naturalWidth||e.width,d=e.naturalHeight||e.height,u=l*i,p=h*n,g=r(s*i,c-u),f=r(o*n,d-p),m=-s/2,v=-o/2,y=r(s,c/i-l),x=r(o,d/n-h);e&&t.drawImage(e,u,p,g,f,m,v,y,x)}},_needsResize:function(){var t=this.getTotalObjectScaling();return t.scaleX!==this._lastScaleX||t.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(t,e){this.setElement(_.util.getById(t),e),_.util.addClass(this.getElement(),_.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t)},_initFilters:function(t,e){t&&t.length?_.util.enlivenObjects(t,(function(t){e&&e(t)}),"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){t||(t={});var e=this.getElement();this.width=t.width||e.naturalWidth||e.width||0,this.height=t.height||e.naturalHeight||e.height||0},parsePreserveAspectRatioAttribute:function(){var t,e=_.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,s=1,o=1,r=0,a=0,l=0,h=0,c=this.width,d=this.height,u={width:c,height:d};return!e||"none"===e.alignX&&"none"===e.alignY?(s=c/i,o=d/n):("meet"===e.meetOrSlice&&(t=(c-i*(s=o=_.util.findScaleToFit(this._element,u)))/2,"Min"===e.alignX&&(r=-t),"Max"===e.alignX&&(r=t),t=(d-n*o)/2,"Min"===e.alignY&&(a=-t),"Max"===e.alignY&&(a=t)),"slice"===e.meetOrSlice&&(t=i-c/(s=o=_.util.findScaleToCover(this._element,u)),"Mid"===e.alignX&&(l=t/2),"Max"===e.alignX&&(l=t),t=n-d/o,"Mid"===e.alignY&&(h=t/2),"Max"===e.alignY&&(h=t),i=c/s,n=d/o)),{width:i,height:n,scaleX:s,scaleY:o,offsetLeft:r,offsetTop:a,cropX:l,cropY:h}}}),_.Image.CSS_CANVAS="canvas-img",_.Image.prototype.getSvgSrc=_.Image.prototype.getSrc,_.Image.fromObject=function(t,e){var i=_.util.object.clone(t);_.util.loadImage(i.src,(function(t,n){n?e&&e(null,!0):_.Image.prototype._initFilters.call(i,i.filters,(function(n){i.filters=n||[],_.Image.prototype._initFilters.call(i,[i.resizeFilter],(function(n){i.resizeFilter=n[0],_.util.enlivenObjectEnlivables(i,i,(function(){var n=new _.Image(t,i);e(n,!1)}))}))}))}),null,i.crossOrigin)},_.Image.fromURL=function(t,e,i){_.util.loadImage(t,(function(t,n){e&&e(new _.Image(t,i),n)}),null,i&&i.crossOrigin)},_.Image.ATTRIBUTE_NAMES=_.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),_.Image.fromElement=function(t,i,n){var s=_.parseAttributes(t,_.Image.ATTRIBUTE_NAMES);_.Image.fromURL(s["xlink:href"],i,e(n?_.util.object.clone(n):{},s))})}(e),_.util.object.extend(_.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,s=this;return _.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){s.rotate(t),n()},onComplete:function(){s.setCoords(),i()}})}}),_.util.object.extend(_.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function t(t,e){var i="precision "+e+" float;\nvoid main(){}",n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(n,i),t.compileShader(n),!!t.getShaderParameter(n,t.COMPILE_STATUS)}function e(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}_.isWebglSupported=function(e){if(_.isLikelyNode)return!1;e=e||_.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),s=!1;if(n){_.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),s=_.maxTextureSize>=e;for(var o=["highp","mediump","lowp"],r=0;r<3;r++)if(t(n,o[r])){_.webGlPrecision=o[r];break}}return this.isSupported=s,s},_.WebglFilterBackend=e,e.prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(t){i=!1}var s="undefined"!=typeof ArrayBuffer,o="undefined"!=typeof Uint8ClampedArray;if(n&&i&&s&&o){var r=_.util.createCanvasElement(),a=new ArrayBuffer(t*e*4);if(_.forceGLPutImageData)return this.imageBuffer=a,void(this.copyGLTo2D=P);var l,h,c={imageBuffer:a,destinationWidth:t,destinationHeight:e,targetCanvas:r};r.width=t,r.height=e,l=window.performance.now(),E.call(c,this.gl,c),h=window.performance.now()-l,l=window.performance.now(),P.call(c,this.gl,c),h>window.performance.now()-l?(this.imageBuffer=a,this.copyGLTo2D=P):this.copyGLTo2D=E}},createWebGLCanvas:function(t,e){var i=_.util.createCanvasElement();i.width=t,i.height=e;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},s=i.getContext("webgl",n);s||(s=i.getContext("experimental-webgl",n)),s&&(s.clearColor(0,0,0,0),this.canvas=i,this.gl=s)},applyFilters:function(t,e,i,n,s,o){var r,a=this.gl;o&&(r=this.getCachedTexture(o,e));var l={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:a,sourceTexture:this.createTexture(a,i,n,!r&&e),targetTexture:this.createTexture(a,i,n),originalTexture:r||this.createTexture(a,i,n,!r&&e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},h=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,h),t.forEach((function(t){t&&t.applyTo(l)})),function(t){var e=t.targetCanvas,i=e.width,n=e.height,s=t.destinationWidth,o=t.destinationHeight;i===s&&n===o||(e.width=s,e.height=o)}(l),this.copyGLTo2D(a,l),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(l.sourceTexture),a.deleteTexture(l.targetTexture),a.deleteFramebuffer(h),s.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,n){var s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),s},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i,i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:E,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e={renderer:"",vendor:""};if(!t)return e;var i=t.getExtension("WEBGL_debug_renderer_info");if(i){var n=t.getParameter(i.UNMASKED_RENDERER_WEBGL),s=t.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(e.renderer=n.toLowerCase()),s&&(e.vendor=s.toLowerCase())}return this.gpuInfo=e,e}}}(),function(){var t=function(){};function e(){}_.Canvas2dFilterBackend=e,e.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(t,e,i,n,s){var o=s.getContext("2d");o.drawImage(e,0,0,i,n);var r={sourceWidth:i,sourceHeight:n,imageData:o.getImageData(0,0,i,n),originalEl:e,originalImageData:o.getImageData(0,0,i,n),canvasEl:s,ctx:o,filterBackend:this};return t.forEach((function(t){t.applyTo(r)})),r.imageData.width===i&&r.imageData.height===n||(s.width=r.imageData.width,s.height=r.imageData.height),o.putImageData(r.imageData,0,0),r}}}(),_.Image=_.Image||{},_.Image.filters=_.Image.filters||{},_.Image.filters.BaseFilter=_.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){e=e||this.fragmentSource,i=i||this.vertexSource,"highp"!==_.webGlPrecision&&(e=e.replace(/precision highp float/g,"precision "+_.webGlPrecision+" float"));var n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(n));var s=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(s));var o=t.createProgram();if(t.attachShader(o,n),t.attachShader(o,s),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(o));var r=this.getAttributeLocations(t,o),a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:r,uniformLocations:a}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,e,i){var n=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var e,i,n=t.context;t.passes>1?(e=t.destinationWidth,i=t.destinationHeight,t.sourceWidth===e&&t.sourceHeight===i||(n.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(n,e,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){var t=this.mainParameter,e=_.Image.filters[this.type].prototype;if(t){if(Array.isArray(e[t])){for(var i=e[t].length;i--;)if(this[t][i]!==e[t][i])return!1;return!0}return e[t]===this[t]}return!1},applyTo:function(t){t.webgl?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),_.Image.filters.BaseFilter.fromObject=function(t,e){var i=new _.Image.filters[t.type](t);return e&&e(i),i},function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var e,i,n,s,o,r=t.imageData.data,a=r.length,l=this.matrix,h=this.colorsOnly;for(o=0;o<a;o+=4)e=r[o],i=r[o+1],n=r[o+2],h?(r[o]=e*l[0]+i*l[1]+n*l[2]+255*l[4],r[o+1]=e*l[5]+i*l[6]+n*l[7]+255*l[9],r[o+2]=e*l[10]+i*l[11]+n*l[12]+255*l[14]):(s=r[o+3],r[o]=e*l[0]+i*l[1]+n*l[2]+s*l[3]+255*l[4],r[o+1]=e*l[5]+i*l[6]+n*l[7]+s*l[8]+255*l[9],r[o+2]=e*l[10]+i*l[11]+n*l[12]+s*l[13]+255*l[14],r[o+3]=e*l[15]+i*l[16]+n*l[17]+s*l[18]+255*l[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],s=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,s)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,n=i.length,s=Math.round(255*this.brightness);for(e=0;e<n;e+=4)i[e]=i[e]+s,i[e+1]=i[e+1]+s,i[e+2]=i[e+2]+s}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,s=e.util.createClass;n.Convolute=s(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,n)),t.programCache[i]},applyTo2d:function(t){var e,i,n,s,o,r,a,l,h,c,d,u,p,g=t.imageData,f=g.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),y=Math.floor(v/2),x=g.width,w=g.height,b=t.ctx.createImageData(x,w),C=b.data,S=this.opaque?1:0;for(d=0;d<w;d++)for(c=0;c<x;c++){for(o=4*(d*x+c),e=0,i=0,n=0,s=0,p=0;p<v;p++)for(u=0;u<v;u++)r=c+u-y,(a=d+p-y)<0||a>=w||r<0||r>=x||(l=4*(a*x+r),h=m[p*v+u],e+=f[l]*h,i+=f[l+1]*h,n+=f[l+2]*h,S||(s+=f[l+3]*h));C[o]=e,C[o+1]=i,C[o+2]=n,C[o+3]=S?f[o+3]:s}t.imageData=b},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,n=t.imageData.data,s=n.length,o=this.mode;for(e=0;e<s;e+=4)"average"===o?i=(n[e]+n[e+1]+n[e+2])/3:"lightness"===o?i=(Math.min(n[e],n[e+1],n[e+2])+Math.max(n[e],n[e+1],n[e+2]))/2:"luminosity"===o&&(i=.21*n[e]+.72*n[e+1]+.07*n[e+2]),n[e]=i,n[e+1]=i,n[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(e)){var i=this.fragmentSource[this.mode];t.programCache[e]=this.createProgram(t.context,i)}return t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){var e,i=t.imageData.data,n=i.length;for(e=0;e<n;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,s=e.util.createClass;n.Noise=s(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,n=t.imageData.data,s=n.length,o=this.noise;for(e=0,s=n.length;e<s;e+=4)i=(.5-Math.random())*o,n[e]+=i,n[e+1]+=i,n[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){var e,i,n,s,o,r,a,l,h,c,d,u=t.imageData,p=u.data,g=u.height,f=u.width;for(i=0;i<g;i+=this.blocksize)for(n=0;n<f;n+=this.blocksize)for(s=p[e=4*i*f+4*n],o=p[e+1],r=p[e+2],a=p[e+3],c=Math.min(i+this.blocksize,g),d=Math.min(n+this.blocksize,f),l=i;l<c;l++)for(h=n;h<d;h++)p[e=4*l*f+4*h]=s,p[e+1]=o,p[e+2]=r,p[e+3]=a},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,s=e.util.createClass;n.RemoveColor=s(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var i,n,s,o,r=t.imageData.data,a=255*this.distance,l=new e.Color(this.color).getSource(),h=[l[0]-a,l[1]-a,l[2]-a],c=[l[0]+a,l[1]+a,l[2]+a];for(i=0;i<r.length;i+=4)n=r[i],s=r[i+1],o=r[i+2],n>h[0]&&s>h[1]&&o>h[2]&&n<c[0]&&s<c[1]&&o<c[2]&&(r[i+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource(),s=parseFloat(this.distance),o=[0+n[0]/255-s,0+n[1]/255-s,0+n[2]/255-s,1],r=[n[0]/255+s,n[1]/255+s,n[2]/255+s,1];t.uniform4fv(i.uLow,o),t.uniform4fv(i.uHigh,r)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass,s={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in s)i[o]=n(i.ColorMatrix,{type:o,matrix:s[o],mainParameter:!1,colorsOnly:!0}),e.Image.filters[o].fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(t){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[t]+"}\n}"},retrieveShader:function(t){var e,i=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(i)||(e=this.buildSource(this.mode),t.programCache[i]=this.createProgram(t.context,e)),t.programCache[i]},applyTo2d:function(t){var i,n,s,o,r,a,l,h=t.imageData.data,c=h.length,d=1-this.alpha;i=(l=new e.Color(this.color).getSource())[0]*this.alpha,n=l[1]*this.alpha,s=l[2]*this.alpha;for(var u=0;u<c;u+=4)switch(o=h[u],r=h[u+1],a=h[u+2],this.mode){case"multiply":h[u]=o*i/255,h[u+1]=r*n/255,h[u+2]=a*s/255;break;case"screen":h[u]=255-(255-o)*(255-i)/255,h[u+1]=255-(255-r)*(255-n)/255,h[u+2]=255-(255-a)*(255-s)/255;break;case"add":h[u]=o+i,h[u+1]=r+n,h[u+2]=a+s;break;case"diff":case"difference":h[u]=Math.abs(o-i),h[u+1]=Math.abs(r-n),h[u+2]=Math.abs(a-s);break;case"subtract":h[u]=o-i,h[u+1]=r-n,h[u+2]=a-s;break;case"darken":h[u]=Math.min(o,i),h[u+1]=Math.min(r,n),h[u+2]=Math.min(a,s);break;case"lighten":h[u]=Math.max(o,i),h[u+1]=Math.max(r,n),h[u+2]=Math.max(a,s);break;case"overlay":h[u]=i<128?2*o*i/255:255-2*(255-o)*(255-i)/255,h[u+1]=n<128?2*r*n/255:255-2*(255-r)*(255-n)/255,h[u+2]=s<128?2*a*s/255:255-2*(255-a)*(255-s)/255;break;case"exclusion":h[u]=i+o-2*i*o/255,h[u+1]=n+r-2*n*r/255,h[u+2]=s+a-2*s*a/255;break;case"tint":h[u]=i+o*d,h[u+1]=n+r*d,h[u+2]=s+a*d}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyToWebGL:function(t){var e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(e,e.TEXTURE1)},createTexture:function(t,e){return t.getCachedTexture(e.cacheKey,e._element)},calculateMatrix:function(){var t=this.image,e=t._element.width,i=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]},applyTo2d:function(t){var i,n,s,o,r,a,l,h,c,d,u,p=t.imageData,g=t.filterBackend.resources,f=p.data,m=f.length,v=p.width,y=p.height,x=this.image;g.blendImage||(g.blendImage=e.util.createCanvasElement()),d=(c=g.blendImage).getContext("2d"),c.width!==v||c.height!==y?(c.width=v,c.height=y):d.clearRect(0,0,v,y),d.setTransform(x.scaleX,0,0,x.scaleY,x.left,x.top),d.drawImage(x._element,0,0,v,y),u=d.getImageData(0,0,v,y).data;for(var w=0;w<m;w+=4)switch(r=f[w],a=f[w+1],l=f[w+2],h=f[w+3],i=u[w],n=u[w+1],s=u[w+2],o=u[w+3],this.mode){case"multiply":f[w]=r*i/255,f[w+1]=a*n/255,f[w+2]=l*s/255,f[w+3]=h*o/255;break;case"mask":f[w+3]=o}},getUniformLocations:function(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}},sendUniformData:function(t,e){var i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,i){e.Image.fromObject(t.image,(function(n){var s=e.util.object.clone(t);s.image=n,i(new e.Image.filters.BlendImage(s))}))}}(e),function(t){var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,s=Math.sqrt,o=Math.abs,r=Math.round,a=Math.sin,l=Math.ceil,h=e.Image.filters,c=e.util.createClass;h.Resize=c(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}},sendUniformData:function(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)},retrieveShader:function(t){var e=this.getFilterWindow(),i=this.type+"_"+e;if(!t.programCache.hasOwnProperty(i)){var n=this.generateShader(e);t.programCache[i]=this.createProgram(t.context,n)}return t.programCache[i]},getFilterWindow:function(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)},getTaps:function(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),n=new Array(i),s=1;s<=i;s++)n[s-1]=t(s*e);return n},generateShader:function(t){for(var e=new Array(t),i=this.fragmentSourceTOP,n=1;n<=t;n++)e[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+t+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",e.forEach((function(t,e){i+="  color += texture2D(uTexture, vTexCoord + "+t+") * uTaps["+e+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+t+") * uTaps["+e+"];\n",i+="  sum += 2.0 * uTaps["+e+"];\n"})),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(t){t.webgl?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(t){return function(e){if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;var i=(e*=Math.PI)/t;return a(e)/e*a(i)/i}},applyTo2d:function(t){var e=t.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var s,o=e.width,a=e.height,l=r(o*i),h=r(a*n);"sliceHack"===this.resizeType?s=this.sliceByTwo(t,o,a,l,h):"hermite"===this.resizeType?s=this.hermiteFastResize(t,o,a,l,h):"bilinear"===this.resizeType?s=this.bilinearFiltering(t,o,a,l,h):"lanczos"===this.resizeType&&(s=this.lanczosResize(t,o,a,l,h)),t.imageData=s},sliceByTwo:function(t,i,s,o,r){var a,l,h=t.imageData,c=.5,d=!1,u=!1,p=i*c,g=s*c,f=e.filterBackend.resources,m=0,v=0,y=i,x=0;for(f.sliceByTwo||(f.sliceByTwo=document.createElement("canvas")),((a=f.sliceByTwo).width<1.5*i||a.height<s)&&(a.width=1.5*i,a.height=s),(l=a.getContext("2d")).clearRect(0,0,1.5*i,s),l.putImageData(h,0,0),o=n(o),r=n(r);!d||!u;)i=p,s=g,o<n(p*c)?p=n(p*c):(p=o,d=!0),r<n(g*c)?g=n(g*c):(g=r,u=!0),l.drawImage(a,m,v,i,s,y,x,p,g),m=y,v=x,x+=g;return l.getImageData(m,v,o,r)},lanczosResize:function(t,e,r,a,h){var c=t.imageData.data,d=t.ctx.createImageData(a,h),u=d.data,p=this.lanczosCreate(this.lanczosLobes),g=this.rcpScaleX,f=this.rcpScaleY,m=2/this.rcpScaleX,v=2/this.rcpScaleY,y=l(g*this.lanczosLobes/2),x=l(f*this.lanczosLobes/2),w={},b={},C={};return function t(l){var S,_,T,E,P,A,I,D,k,R,M;for(b.x=(l+.5)*g,C.x=n(b.x),S=0;S<h;S++){for(b.y=(S+.5)*f,C.y=n(b.y),P=0,A=0,I=0,D=0,k=0,_=C.x-y;_<=C.x+y;_++)if(!(_<0||_>=e)){R=n(1e3*o(_-b.x)),w[R]||(w[R]={});for(var L=C.y-x;L<=C.y+x;L++)L<0||L>=r||(M=n(1e3*o(L-b.y)),w[R][M]||(w[R][M]=p(s(i(R*m,2)+i(M*v,2))/1e3)),(T=w[R][M])>0&&(P+=T,A+=T*c[E=4*(L*e+_)],I+=T*c[E+1],D+=T*c[E+2],k+=T*c[E+3]))}u[E=4*(S*a+l)]=A/P,u[E+1]=I/P,u[E+2]=D/P,u[E+3]=k/P}return++l<a?t(l):d}(0)},bilinearFiltering:function(t,e,i,s,o){var r,a,l,h,c,d,u,p,g,f=0,m=this.rcpScaleX,v=this.rcpScaleY,y=4*(e-1),x=t.imageData.data,w=t.ctx.createImageData(s,o),b=w.data;for(l=0;l<o;l++)for(h=0;h<s;h++)for(c=m*h-(r=n(m*h)),d=v*l-(a=n(v*l)),g=4*(a*e+r),u=0;u<4;u++)p=x[g+u]*(1-c)*(1-d)+x[g+4+u]*c*(1-d)+x[g+y+u]*d*(1-c)+x[g+y+4+u]*c*d,b[f++]=p;return w},hermiteFastResize:function(t,e,i,r,a){for(var h=this.rcpScaleX,c=this.rcpScaleY,d=l(h/2),u=l(c/2),p=t.imageData.data,g=t.ctx.createImageData(r,a),f=g.data,m=0;m<a;m++)for(var v=0;v<r;v++){for(var y=4*(v+m*r),x=0,w=0,b=0,C=0,S=0,_=0,T=0,E=(m+.5)*c,P=n(m*c);P<(m+1)*c;P++)for(var A=o(E-(P+.5))/u,I=(v+.5)*h,D=A*A,k=n(v*h);k<(v+1)*h;k++){var R=o(I-(k+.5))/d,M=s(D+R*R);M>1&&M<-1||(x=2*M*M*M-3*M*M+1)>0&&(T+=x*p[3+(R=4*(k+P*e))],b+=x,p[R+3]<255&&(x=x*p[R+3]/250),C+=x*p[R],S+=x*p[R+1],_+=x*p[R+2],w+=x)}f[y]=C/w,f[y+1]=S/w,f[y+2]=_/w,f[y+3]=T/b}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i=t.imageData.data,n=i.length,s=Math.floor(255*this.contrast),o=259*(s+255)/(255*(259-s));for(e=0;e<n;e+=4)i[e]=o*(i[e]-128)+128,i[e+1]=o*(i[e+1]-128)+128,i[e+2]=o*(i[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,n=t.imageData.data,s=n.length,o=-this.saturation;for(e=0;e<s;e+=4)i=Math.max(n[e],n[e+1],n[e+2]),n[e]+=i!==n[e]?(i-n[e])*o:0,n[e+1]+=i!==n[e+1]?(i-n[e+1])*o:0,n[e+2]+=i!==n[e+2]?(i-n[e+2])*o:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Vibrance=n(i.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(t){if(0!==this.vibrance){var e,i,n,s,o=t.imageData.data,r=o.length,a=-this.vibrance;for(e=0;e<r;e+=4)i=Math.max(o[e],o[e+1],o[e+2]),n=(o[e]+o[e+1]+o[e+2])/3,s=2*Math.abs(i-n)/255*a,o[e]+=i!==o[e]?(i-o[e])*s:0,o[e+1]+=i!==o[e+1]?(i-o[e+1])*s:0,o[e+2]+=i!==o[e+2]?(i-o[e+2])*s:0}},getUniformLocations:function(t,e){return{uVibrance:t.getUniformLocation(e,"uVibrance")}},sendUniformData:function(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}}),e.Image.filters.Vibrance.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var i,n,s=t.filterBackend.resources,o=t.imageData.width,r=t.imageData.height;s.blurLayer1||(s.blurLayer1=e.util.createCanvasElement(),s.blurLayer2=e.util.createCanvasElement()),i=s.blurLayer1,n=s.blurLayer2,i.width===o&&i.height===r||(n.width=i.width=o,n.height=i.height=r);var a,l,h,c,d=i.getContext("2d"),u=n.getContext("2d"),p=.06*this.blur*.5;for(d.putImageData(t.imageData,0,0),u.clearRect(0,0,o,r),c=-15;c<=15;c++)h=p*(l=c/15)*o+(a=(Math.random()-.5)/4),u.globalAlpha=1-Math.abs(l),u.drawImage(i,h,a),d.drawImage(n,0,0),u.globalAlpha=1,u.clearRect(0,0,n.width,n.height);for(c=-15;c<=15;c++)h=p*(l=c/15)*r+(a=(Math.random()-.5)/4),u.globalAlpha=1-Math.abs(l),u.drawImage(i,a,h),d.drawImage(n,0,0),u.globalAlpha=1,u.clearRect(0,0,n.width,n.height);t.ctx.drawImage(i,0,0);var g=t.ctx.getImageData(0,0,i.width,i.height);return d.globalAlpha=1,d.clearRect(0,0,i.width,i.height),g},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),i.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var e,i=t.imageData.data,n=this.gamma,s=i.length,o=1/n[0],r=1/n[1],a=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,s=256;e<s;e++)this.rVals[e]=255*Math.pow(e/255,o),this.gVals[e]=255*Math.pow(e/255,r),this.bVals[e]=255*Math.pow(e/255,a);for(e=0,s=i.length;e<s;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach((function(e){e.applyTo(t)}))},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map((function(t){return t.toObject()}))})},isNeutralState:function(){return!this.subFilters.some((function(t){return!t.isNeutralState()}))}}),e.Image.filters.Composed.fromObject=function(t,i){var n=(t.subFilters||[]).map((function(t){return new e.Image.filters[t.type](t)})),s=new e.Image.filters.Composed({subFilters:n});return i&&i(s),s}}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,i=e.util.cos(t),n=e.util.sin(t),s=1/3,o=Math.sqrt(s)*n,r=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+r/3,this.matrix[1]=s*r-o,this.matrix[2]=s*r+o,this.matrix[5]=s*r+o,this.matrix[6]=i+s*r,this.matrix[7]=s*r-o,this.matrix[10]=s*r-o,this.matrix[11]=s*r+o,this.matrix[12]=i+s*r},isNeutralState:function(t){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.clone;if(e.Text)e.warn("fabric.Text is already defined");else{var n="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat(n),cacheProperties:e.Object.prototype.cacheProperties.concat(n),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,e){this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var t=this.path;t&&(t.segmentsInfo=e.util.getPathSegmentsInfo(t.path))},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,n,s,o,r,a=0,l=this._textLines.length;a<l;a++)if(("justify"===this.textAlign||a!==l-1&&!this.isEndOfWrapping(a))&&(n=0,s=this._textLines[a],(e=this.getLineWidth(a))<this.width&&(r=this.textLines[a].match(this._reSpacesAndTabs)))){i=r.length,t=(this.width-e)/i;for(var h=0,c=s.length;h<=c;h++)o=this.__charBounds[a][h],this._reSpaceAndTab.test(s[h])?(o.width+=t,o.kernedWidth+=t,o.left+=n,n+=t):o.left+=n}},isEndOfWrapping:function(t){return t===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){var e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){if(t.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":t.textBaseline="middle";break;case"ascender":t.textBaseline="top";break;case"descender":t.textBaseline="bottom"}t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;e<i;e++){var n=this.getLineWidth(e);n>t&&(t=n)}return t},_renderTextLine:function(t,e,i,n,s,o){this._renderChars(t,e,i,n,s,o)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,n,s,o,r,a,l=t.fillStyle,h=this._getLeftOffset(),c=this._getTopOffset(),d=0,u=0,p=this.path,g=0,f=this._textLines.length;g<f;g++)if(e=this.getHeightOfLine(g),this.textBackgroundColor||this.styleHas("textBackgroundColor",g)){n=this._textLines[g],i=this._getLineLeftOffset(g),u=0,d=0,s=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var m=0,v=n.length;m<v;m++)o=this.__charBounds[g][m],r=this.getValueOfPropertyAt(g,m,"textBackgroundColor"),p?(t.save(),t.translate(o.renderLeft,o.renderTop),t.rotate(o.angle),t.fillStyle=r,r&&t.fillRect(-o.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),o.width,e/this.lineHeight),t.restore()):r!==s?(a=h+i+d,"rtl"===this.direction&&(a=this.width-a-u),t.fillStyle=s,s&&t.fillRect(a,c,u,e/this.lineHeight),d=o.left,u=o.width,s=r):u+=o.kernedWidth;r&&!p&&(a=h+i+d,"rtl"===this.direction&&(a=this.width-a-u),t.fillStyle=r,t.fillRect(a,c,u,e/this.lineHeight)),c+=e}else c+=e;t.fillStyle=l,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var n=e.charWidthsCache[i],s=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return n[s]||(n[s]={}),n[s]},_measureChar:function(t,e,i,n){var s,o,r,a,l=this.getFontCache(e),h=i+t,c=this._getFontDeclaration(e)===this._getFontDeclaration(n),d=e.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(r=l[i]),void 0!==l[t]&&(a=s=l[t]),c&&void 0!==l[h]&&(a=(o=l[h])-r),void 0===s||void 0===r||void 0===o){var u=this.getMeasuringContext();this._setTextStyles(u,e,!0)}return void 0===s&&(a=s=u.measureText(t).width,l[t]=s),void 0===r&&c&&i&&(r=u.measureText(i).width,l[i]=r),c&&void 0===o&&(o=u.measureText(h).width,l[h]=o,a=o-r),{width:s*d,kernedWidth:a*d}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var i,n,s,o,r,a,l=0,h=this._textLines[t],c=new Array(h.length),d=0,u=this.path,p="right"===this.pathSide;for(this.__charBounds[t]=c,i=0;i<h.length;i++)n=h[i],o=this._getGraphemeBox(n,t,i,s),c[i]=o,l+=o.kernedWidth,s=n;if(c[i]={left:o?o.left+o.width:0,width:0,kernedWidth:0,height:this.fontSize},u){switch(a=u.segmentsInfo[u.segmentsInfo.length-1].length,(r=e.util.getPointOnPath(u.path,0,u.segmentsInfo)).x+=u.pathOffset.x,r.y+=u.pathOffset.y,this.textAlign){case"left":d=p?a-l:0;break;case"center":d=(a-l)/2;break;case"right":d=p?0:a-l}for(d+=this.pathStartOffset*(p?-1:1),i=p?h.length-1:0;p?i>=0:i<h.length;p?i--:i++)o=c[i],d>a?d%=a:d<0&&(d+=a),this._setGraphemeOnPath(d,o,r),d+=o.kernedWidth}return{width:l,numOfSpaces:0}},_setGraphemeOnPath:function(t,i,n){var s=t+i.kernedWidth/2,o=this.path,r=e.util.getPointOnPath(o.path,s,o.segmentsInfo);i.renderLeft=r.x-n.x,i.renderTop=r.y-n.y,i.angle=r.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(t,e,i,n,s){var o,r=this.getCompleteStyleDeclaration(e,i),a=n?this.getCompleteStyleDeclaration(e,i-1):{},l=this._measureChar(t,r,n,a),h=l.kernedWidth,c=l.width;0!==this.charSpacing&&(c+=o=this._getWidthOfCharSpacing(),h+=o);var d={width:c,left:0,height:r.fontSize,kernedWidth:h,deltaY:r.deltaY};if(i>0&&!s){var u=this.__charBounds[e][i-1];d.left=u.left+u.width+l.kernedWidth-l.width}return d},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),n=1,s=e.length;n<s;n++)i=Math.max(this.getHeightOfChar(t,n),i);return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,e=0,i=0,n=this._textLines.length;i<n;i++)t=this.getHeightOfLine(i),e+=i===n-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,e){t.save();for(var i=0,n=this._getLeftOffset(),s=this._getTopOffset(),o=0,r=this._textLines.length;o<r;o++){var a=this.getHeightOfLine(o),l=a/this.lineHeight,h=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],n+h,s+i+l,o),i+=a}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,e,i,n,s,o){var r,a,l,h,c,d=this.getHeightOfLine(o),u=-1!==this.textAlign.indexOf("justify"),p="",g=0,f=this.path,m=!u&&0===this.charSpacing&&this.isEmptyStyles(o)&&!f,v="ltr"===this.direction,y="ltr"===this.direction?1:-1,x=e.canvas.getAttribute("dir");if(e.save(),x!==this.direction&&(e.canvas.setAttribute("dir",v?"ltr":"rtl"),e.direction=v?"ltr":"rtl",e.textAlign=v?"left":"right"),s-=d*this._fontSizeFraction/this.lineHeight,m)return this._renderChar(t,e,o,0,i.join(""),n,s,d),void e.restore();for(var w=0,b=i.length-1;w<=b;w++)h=w===b||this.charSpacing||f,p+=i[w],l=this.__charBounds[o][w],0===g?(n+=y*(l.kernedWidth-l.width),g+=l.width):g+=l.kernedWidth,u&&!h&&this._reSpaceAndTab.test(i[w])&&(h=!0),h||(r=r||this.getCompleteStyleDeclaration(o,w),a=this.getCompleteStyleDeclaration(o,w+1),h=this._hasStyleChanged(r,a)),h&&(f?(e.save(),e.translate(l.renderLeft,l.renderTop),e.rotate(l.angle),this._renderChar(t,e,o,w,p,-g/2,0,d),e.restore()):(c=n,this._renderChar(t,e,o,w,p,c,s,d)),p="",r=a,n+=y*g,g=0);e.restore()},_applyPatternGradientTransformText:function(t){var i,n=e.util.createCanvasElement(),s=this.width+this.strokeWidth,o=this.height+this.strokeWidth;return n.width=s,n.height=o,(i=n.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(s,0),i.lineTo(s,o),i.lineTo(0,o),i.closePath(),i.translate(s/2,o/2),i.fillStyle=t.toLive(i),this._applyPatternGradientTransform(i,t),i.fill(),i.createPattern(n,"no-repeat")},handleFiller:function(t,e,i){var n,s;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(n=-this.width/2,s=-this.height/2,t.translate(n,s),t[e]=this._applyPatternGradientTransformText(i),{offsetX:n,offsetY:s}):(t[e]=i.toLive(t,this),this._applyPatternGradientTransform(t,i)):(t[e]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(t,e){return t.lineWidth=e.strokeWidth,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",e.stroke)},_setFillStyles:function(t,e){return this.handleFiller(t,"fillStyle",e.fill)},_renderChar:function(t,e,i,n,s,o,r){var a,l,h=this._getStyleDeclaration(i,n),c=this.getCompleteStyleDeclaration(i,n),d="fillText"===t&&c.fill,u="strokeText"===t&&c.stroke&&c.strokeWidth;(u||d)&&(e.save(),d&&(a=this._setFillStyles(e,c)),u&&(l=this._setStrokeStyles(e,c)),e.font=this._getFontDeclaration(c),h&&h.textBackgroundColor&&this._removeShadow(e),h&&h.deltaY&&(r+=h.deltaY),d&&e.fillText(s,o-a.offsetX,r-a.offsetY),u&&e.strokeText(s,o-l.offsetX,r-l.offsetY),e.restore())},setSuperscript:function(t,e){return this._setScript(t,e,this.superscript)},setSubscript:function(t,e){return this._setScript(t,e,this.subscript)},_setScript:function(t,e,i){var n=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),o=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),r={fontSize:s*i.size,deltaY:o+s*i.baseline};return this.setSelectionStyles(r,t,e),this},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY},_hasStyleChangedForSvg:function(t,e){return this._hasStyleChanged(t,e)||t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough},_getLineLeftOffset:function(t){var e=this.getLineWidth(t),i=this.width-e,n=this.textAlign,s=this.direction,o=0,r=this.isEndOfWrapping(t);return"justify"===n||"justify-center"===n&&!r||"justify-right"===n&&!r||"justify-left"===n&&!r?0:("center"===n&&(o=i/2),"right"===n&&(o=i),"justify-center"===n&&(o=i/2),"justify-right"===n&&(o=i),"rtl"===s&&(o-=i),o)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];var e=this.measureLine(t).width;return this.__lineWidths[t]=e,e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var n=this._getStyleDeclaration(t,e);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y=this._getLeftOffset(),x=this._getTopOffset(),w=this.path,b=this._getWidthOfCharSpacing(),C=this.offsets[e],S=0,_=this._textLines.length;S<_;S++)if(i=this.getHeightOfLine(S),this[e]||this.styleHas(e,S)){l=this._textLines[S],f=i/this.lineHeight,o=this._getLineLeftOffset(S),d=0,u=0,h=this.getValueOfPropertyAt(S,0,e),v=this.getValueOfPropertyAt(S,0,"fill"),c=x+f*(1-this._fontSizeFraction),n=this.getHeightOfChar(S,0),r=this.getValueOfPropertyAt(S,0,"deltaY");for(var T=0,E=l.length;T<E;T++)if(p=this.__charBounds[S][T],g=this.getValueOfPropertyAt(S,T,e),m=this.getValueOfPropertyAt(S,T,"fill"),s=this.getHeightOfChar(S,T),a=this.getValueOfPropertyAt(S,T,"deltaY"),w&&g&&m)t.save(),t.fillStyle=v,t.translate(p.renderLeft,p.renderTop),t.rotate(p.angle),t.fillRect(-p.kernedWidth/2,C*s+a,p.kernedWidth,this.fontSize/15),t.restore();else if((g!==h||m!==v||s!==n||a!==r)&&u>0){var P=y+o+d;"rtl"===this.direction&&(P=this.width-P-u),h&&v&&(t.fillStyle=v,t.fillRect(P,c+C*n+r,u,this.fontSize/15)),d=p.left,u=p.width,h=g,v=m,n=s,r=a}else u+=p.kernedWidth;P=y+o+d,"rtl"===this.direction&&(P=this.width-P-u),t.fillStyle=m,g&&m&&t.fillRect(P,c+C*n+r,u-b,this.fontSize/15),x+=i}else x+=i;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var n=t||this,s=this.fontFamily,o=e.Text.genericFonts.indexOf(s.toLowerCase())>-1,r=void 0===s||s.indexOf("'")>-1||s.indexOf(",")>-1||s.indexOf('"')>-1||o?n.fontFamily:'"'+n.fontFamily+'"';return[e.isLikelyNode?n.fontWeight:n.fontStyle,e.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",r].join(" ")},render:function(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t)))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),n=new Array(i.length),s=["\n"],o=[],r=0;r<i.length;r++)n[r]=e.util.string.graphemeSplit(i[r]),o=o.concat(n[r],s);return o.pop(),{_unwrappedLines:n,lines:i,graphemeText:o,graphemeLines:n}},toObject:function(t){var e=n.concat(t),s=this.callSuper("toObject",e);return s.styles=i(this.styles,!0),s.path&&(s.path=this.path.toObject()),s},set:function(t,e){this.callSuper("set",t,e);var i=!1,n=!1;if("object"==typeof t)for(var s in t)"path"===s&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(s),n=n||"path"===s;else i=-1!==this._dimensionAffectingProps.indexOf(t),n="path"===t;return n&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,n,s){if(!t)return n(null);var o=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES),r=o.textAnchor||"left";if((s=e.util.object.extend(s?i(s):{},o)).top=s.top||0,s.left=s.left||0,o.textDecoration){var a=o.textDecoration;-1!==a.indexOf("underline")&&(s.underline=!0),-1!==a.indexOf("overline")&&(s.overline=!0),-1!==a.indexOf("line-through")&&(s.linethrough=!0),delete s.textDecoration}"dx"in o&&(s.left+=o.dx),"dy"in o&&(s.top+=o.dy),"fontSize"in s||(s.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in t?l=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(l=t.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var h=s.strokeWidth;s.strokeWidth=0;var c=new e.Text(l,s),d=c.getScaledHeight()/c.height,u=((c.height+c.strokeWidth)*c.lineHeight-c.height)*d,p=c.getScaledHeight()+u,g=0;"center"===r&&(g=c.getScaledWidth()/2),"right"===r&&(g=c.getScaledWidth()),c.set({left:c.left-g,top:c.top-(p-c.fontSize*(.07+c._fontSizeFraction))/c.lineHeight,strokeWidth:void 0!==h?h:1}),n(c)},e.Text.fromObject=function(t,n){var s=i(t),o=t.path;return delete s.path,e.Object._fromObject("Text",s,(function(t){o?e.Object._fromObject("Path",o,(function(e){t.set("path",e),n(t)}),"path"):n(t)}),"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}}(e),_.util.object.extend(_.Text.prototype,{isEmptyStyles:function(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var n in e[i])for(var s in e[i][n])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t)return!1;if(void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{0:this.styles[e]};for(var n in i)for(var s in i[n])if(void 0!==i[n][s][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,n=this.styles,s=0,o=!0,r=0;for(var a in n){for(var l in e=0,n[a]){var h;s++,(h=n[a][l]).hasOwnProperty(t)?(i?h[t]!==i&&(o=!1):i=h[t],h[t]===this[t]&&delete h[t]):o=!1,0!==Object.keys(h).length?e++:delete n[a][l]}0===e&&delete n[a]}for(var c=0;c<this._textLines.length;c++)r+=this._textLines[c].length;o&&s===r&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,n,s=this.styles;for(i in s){for(n in e=s[i])delete e[n][t],0===Object.keys(e[n]).length&&delete e[n];0===Object.keys(e).length&&delete s[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),_.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,n=i.length,s=0;s<n;s++){if(t<=i[s].length)return{lineIndex:s,charIndex:t};t-=i[s].length+this.missingNewlineOffset(s)}return{lineIndex:s-1,charIndex:i[s-1].length<t?i[s-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var n=[],s=t;s<e;s++)n.push(this.getStyleAtPosition(s,i));return n},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var n=e;n<i;n++)this._extendStyles(n,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,n=this._getStyleDeclaration(t,e)||{},s={},o=0;o<this._styleProperties.length;o++)s[i=this._styleProperties[o]]=void 0===n[i]?this[i]:n[i];return s},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return!!this.styles[t]},_setLineStyle:function(t){this.styles[t]={}},_deleteLineStyle:function(t){delete this.styles[t]}}),function(){function t(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}_.IText=_.util.createClass(_.Text,_.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,e){this.callSuper("initialize",t,e),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this.canvas.contextTop,i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e),this._clearTextArea(e),t||e.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this._getCursorBoundaries(),e=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},_getCursorBoundaries:function(t){void 0===t&&(t=this.selectionStart);var e=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:e,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e,i,n,s,o=0,r=0,a=this.get2DCursorLocation(t);n=a.charIndex,i=a.lineIndex;for(var l=0;l<i;l++)o+=this.getHeightOfLine(l);e=this._getLineLeftOffset(i);var h=this.__charBounds[i][n];return h&&(r=h.left),0!==this.charSpacing&&n===this._textLines[i].length&&(r-=this._getWidthOfCharSpacing()),s={top:o,left:e+(r>0?r:0)},"rtl"===this.direction&&(s.left*=-1),this.cursorOffsetCache=s,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,s=i.charIndex>0?i.charIndex-1:0,o=this.getValueOfPropertyAt(n,s,"fontSize"),r=this.scaleX*this.canvas.getZoom(),a=this.cursorWidth/r,l=t.topOffset,h=this.getValueOfPropertyAt(n,s,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,e),e.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,s,"fill"),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+t.leftOffset-a/2,l+t.top+h,a,o)},renderSelection:function(t,e){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=-1!==this.textAlign.indexOf("justify"),o=this.get2DCursorLocation(i),r=this.get2DCursorLocation(n),a=o.lineIndex,l=r.lineIndex,h=o.charIndex<0?0:o.charIndex,c=r.charIndex<0?0:r.charIndex,d=a;d<=l;d++){var u,p=this._getLineLeftOffset(d)||0,g=this.getHeightOfLine(d),f=0,m=0;if(d===a&&(f=this.__charBounds[a][h].left),d>=a&&d<l)m=s&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===l)if(0===c)m=this.__charBounds[l][c].left;else{var v=this._getWidthOfCharSpacing();m=this.__charBounds[l][c-1].left+this.__charBounds[l][c-1].width-v}u=g,(this.lineHeight<1||d===l&&this.lineHeight>1)&&(g/=this.lineHeight);var y=t.left+p+f,x=m-f,w=g,b=0;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",w=1,b=g):e.fillStyle=this.selectionColor,"rtl"===this.direction&&(y=this.width-y-x),e.fillRect(y,t.top+t.topOffset+b,x,w),t.topOffset+=u}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}}),_.IText.fromObject=function(e,i){if(t(e),e.styles)for(var n in e.styles)for(var s in e.styles[n])t(e.styles[n][s]);_.Object._fromObject("IText",e,i,"text")}}(),S=_.util.object.clone,_.util.object.extend(_.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",(function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))}))},initRemovedHandler:function(){var t=this;this.on("removed",(function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],_.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))}))},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach((function(t){t.__isMousedown=!1}))},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var s;return s={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){s.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return s.isAborted}}),s},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout((function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")}),100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout((function(){e._tick()}),i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,e=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&e&&e.clearContext(e.contextTop||e.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e},searchWordBoundary:function(t,e){for(var i=this._text,n=this._reSpace.test(i[t])?t-1:t,s=i[n],o=_.reNonWord;!o.test(s)&&n>0&&n<i.length;)s=i[n+=e];return o.test(s)&&(n+=1===e?0:1),n},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach((function(t){t.selected=!1,t.isEditing&&t.exitEditing()}))},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;(e===this.__selectionStartOnMouseDown&&i!==n||i!==e&&n!==e)&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,e,i){var n=i.slice(0,t),s=_.util.string.graphemeSplit(n).length;if(t===e)return{selectionStart:s,selectionEnd:s};var o=i.slice(t,e);return{selectionStart:s,selectionEnd:s+_.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(t,e,i){var n=i.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(t,e).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,s=i.charIndex,o=this.getValueOfPropertyAt(n,s,"fontSize")*this.lineHeight,r=e.leftOffset,a=this.calcTransformMatrix(),l={x:e.left+r,y:e.top+e.topOffset+o},h=this.canvas.getRetinaScaling(),c=this.canvas.upperCanvasEl,d=c.width/h,u=c.height/h,p=d-o,g=u-o,f=c.clientWidth/d,m=c.clientHeight/u;return l=_.util.transformPoint(l,a),(l=_.util.transformPoint(l,this.canvas.viewportTransform)).x*=f,l.y*=m,l.x<0&&(l.x=0),l.x>p&&(l.x=p),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text,e=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,e){var i,n,s=this.get2DCursorLocation(t,!0),o=this.get2DCursorLocation(e,!0),r=s.lineIndex,a=s.charIndex,l=o.lineIndex,h=o.charIndex;if(r!==l){if(this.styles[r])for(i=a;i<this._unwrappedTextLines[r].length;i++)delete this.styles[r][i];if(this.styles[l])for(i=h;i<this._unwrappedTextLines[l].length;i++)(n=this.styles[l][i])&&(this.styles[r]||(this.styles[r]={}),this.styles[r][a+i-h]=n);for(i=r+1;i<=l;i++)delete this.styles[i];this.shiftLineStyles(l,r-l)}else if(this.styles[r]){n=this.styles[r];var c,d,u=h-a;for(i=a;i<h;i++)delete n[i];for(d in this.styles[r])(c=parseInt(d,10))>=h&&(n[c-u]=n[d],delete n[d])}},shiftLineStyles:function(t,e){var i=S(this.styles);for(var n in this.styles){var s=parseInt(n,10);s>t&&(this.styles[s+e]=i[s],i[s-e]||delete this.styles[s])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(t,e,i,n){var s,o={},r=!1,a=this._unwrappedTextLines[t].length===e;for(var l in i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(s=this.styles[t][0===e?e:e-1]),this.styles[t]){var h=parseInt(l,10);h>=e&&(r=!0,o[h-e]=this.styles[t][l],a&&0===e||delete this.styles[t][l])}var c=!1;for(r&&!a&&(this.styles[t+i]=o,c=!0),c&&i--;i>0;)n&&n[i-1]?this.styles[t+i]={0:S(n[i-1])}:s?this.styles[t+i]={0:S(s)}:delete this.styles[t+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(t,e,i,n){this.styles||(this.styles={});var s=this.styles[t],o=s?S(s):{};for(var r in i||(i=1),o){var a=parseInt(r,10);a>=e&&(s[a+i]=o[a],o[a-i]||delete s[a])}if(this._forceClearCache=!0,n)for(;i--;)Object.keys(n[i]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+i]=S(n[i]));else if(s)for(var l=s[e?e-1:1];l&&i--;)this.styles[t][e+i]=S(l)},insertNewStyleBlock:function(t,e,i){for(var n=this.get2DCursorLocation(e,!0),s=[0],o=0,r=0;r<t.length;r++)"\n"===t[r]?s[++o]=0:s[o]++;for(s[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,s[0],i),i=i&&i.slice(s[0]+1)),o&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+s[0],o),r=1;r<o;r++)s[r]>0?this.insertCharStyleObject(n.lineIndex+r,0,s[r],i):i&&this.styles[n.lineIndex+r]&&i[0]&&(this.styles[n.lineIndex+r][0]=i[0]),i=i&&i.slice(s[r]+1);s[r]>0&&this.insertCharStyleObject(n.lineIndex+r,0,s[r],i)},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}}),_.util.object.extend(_.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(t){if(this.canvas){this.__newClickTime=+new Date;var e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))},tripleClickHandler:function(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(t.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){if(this.__isMousedown=!1,!(!this.editable||this.group||t.transform&&t.transform.actionPerformed||t.e.button&&1!==t.e.button)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),n=0,s=0,o=0,r=0,a=0,l=0,h=this._textLines.length;l<h&&o<=i.y;l++)o+=this.getHeightOfLine(l)*this.scaleY,a=l,l>0&&(r+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));s=this._getLineLeftOffset(a)*this.scaleX,e=this._textLines[a],"rtl"===this.direction&&(i.x=this.width*this.scaleX-i.x+s);for(var c=0,d=e.length;c<d&&(n=s,(s+=this.__charBounds[a][c].kernedWidth*this.scaleX)<=i.x);c++)r++;return this._getNewSelectionStartFromOffset(i,n,s,r,d)},_getNewSelectionStartFromOffset:function(t,e,i,n,s){var o=t.x-e,r=i-t.x,a=n+(r>o||r<0?0:1);return this.flipX&&(a=s-a),a>this._text.length&&(a=this._text.length),a}}),_.util.object.extend(_.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=_.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+t.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):_.document.body.appendChild(this.hiddenTextarea),_.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),_.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),_.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),_.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(_.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){var e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),this.isEditing){var i,n,s,o,r,a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,h=a.length,c=h-l,d=this.selectionStart,u=this.selectionEnd,p=d!==u;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),f=d>g.selectionStart;p?(i=this._text.slice(d,u),c+=u-d):h<l&&(i=f?this._text.slice(u+c,u):this._text.slice(d,d-c)),n=a.slice(g.selectionEnd-c,g.selectionEnd),i&&i.length&&(n.length&&(s=this.getSelectionStyles(d,d+1,!1),s=n.map((function(){return s[0]}))),p?(o=d,r=u):f?(o=u-i.length,r=u):(o=u,r=u+i.length),this.removeStyleFromTo(o,r)),n.length&&(e&&n.join("")===_.copiedText&&!_.disableStyleCopyPaste&&(s=_.copiedTextStyle),this.insertNewStyleBlock(n,d,s)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(_.copiedText=this.getSelectedText(),_.disableStyleCopyPaste?_.copiedTextStyle=null:_.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||_.window.clipboardData},_getWidthBeforeCursor:function(t,e){var i,n=this._getLineLeftOffset(t);return e>0&&(n+=(i=this.__charBounds[t][e-1]).left+i.width),n},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),s=n.lineIndex;if(s===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-i;var o=n.charIndex,r=this._getWidthBeforeCursor(s,o),a=this._getIndexOnLine(s+1,r);return this._textLines[s].slice(o).length+a+1+this.missingNewlineOffset(s)},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),s=n.lineIndex;if(0===s||t.metaKey||33===t.keyCode)return-i;var o=n.charIndex,r=this._getWidthBeforeCursor(s,o),a=this._getIndexOnLine(s-1,r),l=this._textLines[s].slice(0,o),h=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+a-l.length+(1-h)},_getIndexOnLine:function(t,e){for(var i,n,s=this._textLines[t],o=this._getLineLeftOffset(t),r=0,a=0,l=s.length;a<l;a++)if((o+=i=this.__charBounds[t][a].width)>e){n=!0;var h=o-i,c=o,d=Math.abs(h-e);r=Math.abs(c-e)<d?a:a-1;break}return n||(r=s.length-1),r},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t,e){void 0===e&&(e=t+1),this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(t,e,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var s=_.util.string.graphemeSplit(t);this.insertNewStyleBlock(s,i,e),this._text=[].concat(this._text.slice(0,i),s,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var t=_.util.toFixed,e=/  +/g;_.util.object.extend(_.Text.prototype,{_toSVG:function(){var t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)},toSVG:function(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(t){var e=this.getSvgTextDecoration(this);return[t.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",e?'text-decoration="'+e+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(t,e){var i,n=[],s=[],o=t;this._setSVGBg(s);for(var r=0,a=this._textLines.length;r<a;r++)i=this._getLineLeftOffset(r),(this.textBackgroundColor||this.styleHas("textBackgroundColor",r))&&this._setSVGTextLineBg(s,r,e+i,o),this._setSVGTextLineText(n,r,e+i,o),o+=this.getHeightOfLine(r);return{textSpans:n,textBgRects:s}},_createTextCharSpan:function(i,n,s,o){var r=i!==i.trim()||i.match(e),a=this.getSvgSpanStyles(n,r),l=a?'style="'+a+'"':"",h=n.deltaY,c="",d=_.Object.NUM_FRACTION_DIGITS;return h&&(c=' dy="'+t(h,d)+'" '),['<tspan x="',t(s,d),'" y="',t(o,d),'" ',c,l,">",_.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(t,e,i,n){var s,o,r,a,l,h=this.getHeightOfLine(e),c=-1!==this.textAlign.indexOf("justify"),d="",u=0,p=this._textLines[e];n+=h*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,f=p.length-1;g<=f;g++)l=g===f||this.charSpacing,d+=p[g],r=this.__charBounds[e][g],0===u?(i+=r.kernedWidth-r.width,u+=r.width):u+=r.kernedWidth,c&&!l&&this._reSpaceAndTab.test(p[g])&&(l=!0),l||(s=s||this.getCompleteStyleDeclaration(e,g),o=this.getCompleteStyleDeclaration(e,g+1),l=this._hasStyleChangedForSvg(s,o)),l&&(a=this._getStyleDeclaration(e,g)||{},t.push(this._createTextCharSpan(d,a,i,n)),d="",s=o,i+=u,u=0)},_pushTextBgRect:function(e,i,n,s,o,r){var a=_.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(i),' x="',t(n,a),'" y="',t(s,a),'" width="',t(o,a),'" height="',t(r,a),'"></rect>\n')},_setSVGTextLineBg:function(t,e,i,n){for(var s,o,r=this._textLines[e],a=this.getHeightOfLine(e)/this.lineHeight,l=0,h=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),d=0,u=r.length;d<u;d++)s=this.__charBounds[e][d],(o=this.getValueOfPropertyAt(e,d,"textBackgroundColor"))!==c?(c&&this._pushTextBgRect(t,c,i+h,n,l,a),h=s.left,l=s.width,c=o):l+=s.kernedWidth;o&&this._pushTextBgRect(t,o,i+h,n,l,a)},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new _.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this.getHeightOfLine(n);return e=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(t){return _.Object.prototype.getSvgStyles.call(this,t)+" white-space: pre;"}})}(),function(t){var e=t.fabric||(t.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(t){for(var e=0,i=0,n=0,s={},o=0;o<t.graphemeLines.length;o++)"\n"===t.graphemeText[n]&&o>0?(i=0,n++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[n])&&o>0&&(i++,n++),s[o]={line:e,offset:i},n+=t.graphemeLines[o].length,i+=t.graphemeLines[o].length;return s},styleHas:function(t,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return e.Text.prototype.styleHas.call(this,t,i)},isEmptyStyles:function(t){if(!this.styles)return!0;var e,i,n=0,s=!1,o=this._styleMap[t],r=this._styleMap[t+1];for(var a in o&&(t=o.line,n=o.offset),r&&(s=r.line===t,e=r.offset),i=void 0===t?this.styles:{line:this.styles[t]})for(var l in i[a])if(l>=n&&(!s||l<e))for(var h in i[a][l])return!1;return!0},_getStyleDeclaration:function(t,e){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[t];if(!i)return null;t=i.line,e=i.offset+e}return this.callSuper("_getStyleDeclaration",t,e)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return!!this.styles[e.line]},_setLineStyle:function(t){var e=this._styleMap[t];this.styles[e.line]={}},_wrapText:function(t,e){var i,n=[];for(this.isWrapping=!0,i=0;i<t.length;i++)n=n.concat(this._wrapLine(t[i],i,e));return this.isWrapping=!1,n},_measureWord:function(t,e,i){var n,s=0;i=i||0;for(var o=0,r=t.length;o<r;o++)s+=this._getGraphemeBox(t[o],e,o+i,n,!0).kernedWidth,n=t[o];return s},_wrapLine:function(t,i,n,s){var o=0,r=this.splitByGrapheme,a=[],l=[],h=r?e.util.string.graphemeSplit(t):t.split(this._wordJoiners),c="",d=0,u=r?"":" ",p=0,g=0,f=0,m=!0,v=this._getWidthOfCharSpacing();s=s||0,0===h.length&&h.push([]),n-=s;for(var y=0;y<h.length;y++)c=r?h[y]:e.util.string.graphemeSplit(h[y]),p=this._measureWord(c,i,d),d+=c.length,(o+=g+p-v)>n&&!m?(a.push(l),l=[],o=p,m=!0):o+=v,m||r||l.push(u),l=l.concat(c),g=r?0:this._measureWord([u],i,d),d++,m=!1,p>f&&(f=p);return y&&a.push(l),f+s>this.dynamicMinWidth&&(this.dynamicMinWidth=f-v+s),a},isEndOfWrapping:function(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line},missingNewlineOffset:function(t){return this.splitByGrapheme?this.isEndOfWrapping(t)?1:0:1},_splitTextIntoLines:function(t){for(var i=e.Text.prototype._splitTextIntoLines.call(this,t),n=this._wrapText(i.lines,this.width),s=new Array(n.length),o=0;o<n.length;o++)s[o]=n[o].join("");return i.lines=s,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var t={};for(var e in this._styleMap)this._textLines[e]&&(t[this._styleMap[e].line]=1);for(var e in this.styles)t[e]||delete this.styles[e]},toObject:function(t){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(t))}}),e.Textbox.fromObject=function(t,i){return e.Object._fromObject("Textbox",t,i,"text")}}(e),function(){var t=_.controlsUtils,e=t.scaleSkewCursorStyleHandler,i=t.scaleCursorStyleHandler,n=t.scalingEqually,s=t.scalingYOrSkewingX,o=t.scalingXOrSkewingY,r=t.scaleOrSkewActionName,a=_.Object.prototype.controls;if(a.ml=new _.Control({x:-.5,y:0,cursorStyleHandler:e,actionHandler:o,getActionName:r}),a.mr=new _.Control({x:.5,y:0,cursorStyleHandler:e,actionHandler:o,getActionName:r}),a.mb=new _.Control({x:0,y:.5,cursorStyleHandler:e,actionHandler:s,getActionName:r}),a.mt=new _.Control({x:0,y:-.5,cursorStyleHandler:e,actionHandler:s,getActionName:r}),a.tl=new _.Control({x:-.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),a.tr=new _.Control({x:.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),a.bl=new _.Control({x:-.5,y:.5,cursorStyleHandler:i,actionHandler:n}),a.br=new _.Control({x:.5,y:.5,cursorStyleHandler:i,actionHandler:n}),a.mtr=new _.Control({x:0,y:-.5,actionHandler:t.rotationWithSnapping,cursorStyleHandler:t.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),_.Textbox){var l=_.Textbox.prototype.controls={};l.mtr=a.mtr,l.tr=a.tr,l.br=a.br,l.tl=a.tl,l.bl=a.bl,l.mt=a.mt,l.mb=a.mb,l.mr=new _.Control({x:.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:e,actionName:"resizing"}),l.ml=new _.Control({x:-.5,y:0,actionHandler:t.changeWidth,cursorStyleHandler:e,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},ni={};function si(t){var e=ni[t];if(void 0!==e)return e.exports;var i=ni[t]={exports:{}};return ii[t](i,i.exports,si),i.exports}si.d=(t,e)=>{for(var i in e)si.o(e,i)&&!si.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},si.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var oi={};(()=>{let t;si.d(oi,{R:()=>t}),t="undefined"!=typeof document&&"undefined"!=typeof window?si(653).fabric:{version:"5.2.1"}})();var ri,ai,li,hi,ci=oi.R;!function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"}(ri||(ri={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(ai||(ai={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(li||(li={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(hi||(hi={}));const di=t=>"number"==typeof t&&!Number.isNaN(t),ui=t=>"string"==typeof t;var pi,gi,fi,mi,vi,yi,xi,wi,bi,Ci,Si;!function(t){t[t.ARC=0]="ARC",t[t.IMAGE=1]="IMAGE",t[t.LINE=2]="LINE",t[t.POLYGON=3]="POLYGON",t[t.QUAD=4]="QUAD",t[t.RECT=5]="RECT",t[t.TEXT=6]="TEXT",t[t.GROUP=7]="GROUP"}(vi||(vi={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED"}(yi||(yi={}));let _i=class{get mediaType(){return new Map([["rect",ri.DIMT_RECTANGLE],["quad",ri.DIMT_QUADRILATERAL],["text",ri.DIMT_TEXT],["arc",ri.DIMT_ARC],["image",ri.DIMT_IMAGE],["polygon",ri.DIMT_POLYGON],["line",ri.DIMT_LINE],["group",ri.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(Ze(this,gi,"f")){case ai.DIS_DEFAULT:return"default";case ai.DIS_SELECTED:return"selected"}}set drawingStyleId(t){this.styleId=t}get drawingStyleId(){return this.styleId}set coordinateBase(t){if(!["view","image"].includes(t))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===Ze(this,fi,"f")&&"view"===t?this.updateCoordinateBaseFromImageToView():"view"===Ze(this,fi,"f")&&"image"===t&&this.updateCoordinateBaseFromViewToImage()),Je(this,fi,t)}get coordinateBase(){return Ze(this,fi,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(t,e){if(pi.add(this),gi.set(this,void 0),fi.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=e&&!di(e))throw new TypeError("Invalid 'drawingStyleId'.");t&&this._setFabricObject(t),this.setState(ai.DIS_DEFAULT),this.styleId=e}_setFabricObject(t){this._fabricObject=t,this._fabricObject.on("selected",(()=>{this.setState(ai.DIS_SELECTED)})),this._fabricObject.on("deselected",(()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(ai.DIS_SELECTED):this.setState(ai.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)})),t.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(t){Je(this,gi,t)}getState(){return Ze(this,gi,"f")}_on(t,e){if(!e)return;const i=t.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error(`Event '${t}' does not exist.`);let s=n.get(e);s||(s=t=>{const i=t.e;if(!i)return void(e&&e.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const n={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let t,e,s,o;const r=i.target.getBoundingClientRect();t=r.left,e=r.top,s=t+window.scrollX,o=e+window.scrollY;const{width:a,height:l}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),h=this._drawingLayer.width,c=this._drawingLayer.height,d=a/l,u=h/c,p=this._drawingLayer._getObjectFit();let g,f,m,v,y=1;if("contain"===p)d<u?(y=a/h,g=t+this.get("x")*y,f=e+this.get("y")*y+(l-c*y)/2,m=s+this.get("x")*y,v=o+this.get("y")*y+(l-c*y)/2):(y=l/c,g=t+this.get("x")*y+(a-h*y)/2,f=e+this.get("y")*y,m=s+this.get("x")*y+(a-h*y)/2,v=o+this.get("y")*y);else if("cover"===p)if(d<u){y=l/c;let i=this.get("x")*y-(h*y-a)/2;i=Math.max(i,0),i=Math.min(i,a),g=t+i,f=e+this.get("y")*y,m=s+i,v=o+this.get("y")*y}else{y=a/h;let i=this.get("y")*y-(c*y-l)/2;i=Math.max(i,0),i=Math.min(i,l),g=t+this.get("x")*y,f=e+i,m=s+this.get("x")*y,v=o+i}n.itemClientX=Math.round(g),n.itemClientY=Math.round(f),n.itemPageX=Math.round(m),n.itemPageY=Math.round(v)}for(let t of Object.getOwnPropertyNames(n))Object.defineProperty(i,t,{value:n[t],writable:!0});e&&e.apply(this,[i])},n.set(e,s),this._fabricObject.on("dblclick"===i?"mousedblclick":i,s))}on(t,e){this._on(t,e)}_off(t,e){const i=t.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error(`Event '${t}' does not exist.`);let s=n.get(e);s&&(n.delete(e),this._fabricObject.off("dblclick"===i?"mousedblclick":i,s))}off(t,e){this._off(t,e)}_setEditable(t){const e=this._fabricObject;t?(e.selectable=!0,e.hasControls=!0,e.hoverCursor=null):(e.selectable=!1,e.hasControls=!1,e.hoverCursor="default")}hasNote(t){return this.mapNoteName_Content.has(t)}addNote(t,e){if(this.hasNote(t.name)&&!e)throw new Error("A note with the same name already exists, please use a different name.");const i=t.content?JSON.parse(JSON.stringify(t.content)):t.content;this.mapNoteName_Content.set(t.name,[i])}getNote(t){const e=this.mapNoteName_Content.get(t);return e?1===e.length?{name:t,content:e[0]?JSON.parse(JSON.stringify(e[0])):e[0]}:{name:t,content:JSON.parse(JSON.stringify(e))}:null}getNotes(){const t=[];for(let e of this.mapNoteName_Content){let i=1===e[1].length?e[1][0]:e[1];i=i?JSON.parse(JSON.stringify(i)):i,t.push({name:e[0],content:i})}return t}updateNote(t,e,i){const n=this.mapNoteName_Content.get(t);if(!n)throw new Error("The note name does not exist.");i||(n.length=0),e=e?JSON.parse(JSON.stringify(e)):e,n.push(e)}deleteNote(t){this.mapNoteName_Content.delete(t)}clearNotes(){this.mapNoteName_Content.clear()}set(t,e){if(!this.extendSet(t,e))if("x"===t){const t=this._fabricObject.group;t?(this._fabricObject.set("left",e-t.left-t.width/2),t.addWithUpdate()):this._fabricObject.set("left",e)}else if("y"===t){const t=this._fabricObject.group;t?(this._fabricObject.set("top",e-t.top-t.height/2),t.addWithUpdate()):this._fabricObject.set("top",e)}else"styleId"===t?this.styleId=e:this._fabricObject.set(t,e);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(t)&&this._fabricObject.setCoords()}get(t){let e=this.extendGet(t);if(void 0===e)if("x"===t){const t=this._fabricObject.group;e=t?this._fabricObject.get("left")+t.left+t.width/2:this._fabricObject.get("left")}else if("y"===t){const t=this._fabricObject.group;e=t?this._fabricObject.get("top")+t.top+t.height/2:this._fabricObject.get("top")}else e="scaledWidth"===t?this._fabricObject.getScaledWidth():"scaledHeight"===t?this._fabricObject.getScaledHeight():["type","mediaType"].includes(t)?this.mediaType:"state"===t?this.getState():"styleId"===t?this.styleId:"drawingLayerId"===t?this.drawingLayerId:this._fabricObject.get(t);return e}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(t){if("number"!=typeof t)throw new TypeError("Invalid value.");return t*Ze(this,pi,"m",mi).call(this)}convertPropFromViewToImage(t){if("number"!=typeof t)throw new TypeError("Invalid value.");return t/Ze(this,pi,"m",mi).call(this)}_setLineWidth(t){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(t));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",t)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(t){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(t));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",t)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}};gi=new WeakMap,fi=new WeakMap,pi=new WeakSet,mi=function(){const t=this._drawingLayer;if(!t)return 1;const e=t.width,i=t.height,{width:n,height:s}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(n<=0||s<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const o=n/e,r=s/i,a=t._getObjectFit();let l=1;return"contain"===a?l=o<r?n/e:s/i:"cover"===a&&(l=o<r?s/i:n/e),l},_i.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],_i.mapItemType=new Map([[vi.ARC,"arc"],[vi.IMAGE,"image"],[vi.LINE,"line"],[vi.POLYGON,"polygon"],[vi.QUAD,"quad"],[vi.RECT,"rect"],[vi.TEXT,"text"],[vi.GROUP,"group"]]),_i.arrStyleSelectors=["default","selected"],_i.mapItemState=new Map([[yi.DEFAULT,"default"],[yi.SELECTED,"selected"]]);let Ti=class extends _i{constructor(t,e){if(super(null,e),xi.set(this,void 0),!A(t))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ci.Rect({left:t.x,top:t.y,width:t.width,height:t.height})),Je(this,xi,JSON.parse(JSON.stringify(t))),this._mediaType="rect"}extendSet(t,e){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(t){this.setRect(t)}getPosition(){return this.getRect()}updatePosition(){Ze(this,xi,"f")&&this.setRect(Ze(this,xi,"f"))}setRect(t){if(!A(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width)),this.set("height",this.convertPropFromViewToImage(t.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width),this.set("height",t.height)}this._drawingLayer.renderAll()}else Je(this,xi,JSON.parse(JSON.stringify(t)))}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,xi,"f")?JSON.parse(JSON.stringify(Ze(this,xi,"f"))):null}};function Ei(t,e,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,s=i.points[this.pointIndex].y-i.pathOffset.y;return ci.util.transformPoint({x:n,y:s},i.calcTransformMatrix())}function Pi(t){let e=new ci.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new ci.Point(t.width+e.x,t.height+e.y)}function Ai(t,e,i,n){let s=e.target,o=s.controls[s.__corner],r=s.toLocalPoint(new ci.Point(i,n),"center","center"),a=Pi(s),l=s._getTransformedDimensions(0,0),h={x:r.x*a.x/l.x+s.pathOffset.x,y:r.y*a.y/l.y+s.pathOffset.y};return s.points[o.pointIndex]=h,ci.controlsUtils.fireEvent("scaling",{e:t,transform:e,pointer:{x:i,y:n}}),!0}function Ii(t,e){return function(i,n,s,o){let r=n.target,a=ci.util.transformPoint({x:r.points[t].x-r.pathOffset.x,y:r.points[t].y-r.pathOffset.y},r.calcTransformMatrix()),l=e(i,n,s,o);r._setPositionDimensions({});let h=Pi(r),c=(r.points[t].x-r.pathOffset.x)/h.x,d=(r.points[t].y-r.pathOffset.y)/h.y;return r.setPositionByOrigin(a,c+.5,d+.5),l}}xi=new WeakMap;let Di=class extends _i{constructor(t,e){if(super(null,e),wi.set(this,void 0),!E(t))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new ci.Polygon(t.points,{objectCaching:!1}));const i=this._fabricObject;let n=i.points.length-1;i.controls=i.points.reduce((function(t,e,i){return t["p"+i]=new ci.Control({positionHandler:Ei,actionHandler:Ii(i>0?i-1:n,Ai),actionName:"modifyPolygon",pointIndex:i}),t}),{}),Je(this,wi,JSON.parse(JSON.stringify(t))),this._mediaType="polygon"}extendSet(t,e){if("vertices"===t){const t=this._fabricObject;if(t.group){const i=t.group;t.points=e.map((t=>({x:t.x-i.left-i.width/2,y:t.y-i.top-i.height/2}))),i.addWithUpdate()}else t.points=e;const i=t.points.length-1;return t.controls=t.points.reduce((function(t,e,n){return t["p"+n]=new ci.Control({positionHandler:Ei,actionHandler:Ii(n>0?n-1:i,Ai),actionName:"modifyPolygon",pointIndex:n}),t}),{}),t._setPositionDimensions({}),!0}}extendGet(t){if("vertices"===t){const t=[],e=this._fabricObject;if(e.selectable&&!e.group)for(let i in e.oCoords)t.push({x:e.oCoords[i].x,y:e.oCoords[i].y});else for(let i of e.points){let n=i.x-e.pathOffset.x,s=i.y-e.pathOffset.y;const o=ci.util.transformPoint({x:n,y:s},e.calcTransformMatrix());t.push({x:o.x,y:o.y})}return t}}updateCoordinateBaseFromImageToView(){const t=this.get("vertices").map((t=>({x:this.convertPropFromViewToImage(t.x),y:this.convertPropFromViewToImage(t.y)})));this.set("vertices",t)}updateCoordinateBaseFromViewToImage(){const t=this.get("vertices").map((t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)})));this.set("vertices",t)}setPosition(t){this.setPolygon(t)}getPosition(){return this.getPolygon()}updatePosition(){Ze(this,wi,"f")&&this.setPolygon(Ze(this,wi,"f"))}setPolygon(t){if(!E(t))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const e=t.points.map((t=>({x:this.convertPropFromViewToImage(t.x),y:this.convertPropFromViewToImage(t.y)})));this.set("vertices",e)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else Je(this,wi,JSON.parse(JSON.stringify(t)))}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,wi,"f")?JSON.parse(JSON.stringify(Ze(this,wi,"f"))):null}};wi=new WeakMap;let ki=class extends _i{set maintainAspectRatio(t){t&&this.set("scaleY",this.get("scaleX"))}get maintainAspectRatio(){return Ze(this,Ci,"f")}constructor(t,e,i,n){if(super(null,n),bi.set(this,void 0),Ci.set(this,void 0),!A(e))throw new TypeError("Invalid 'rect'.");if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)this._setFabricObject(new ci.Image(t,{left:e.x,top:e.y}));else{if(!b(t))throw new TypeError("Invalid 'image'.");{const i=document.createElement("canvas");let n;if(i.width=t.width,i.height=t.height,t.format===a.IPF_GRAYSCALED){n=new Uint8ClampedArray(t.width*t.height*4);for(let e=0;e<n.length;e+=4)n[e]=t.bytes[e/4],n[e+1]=t.bytes[e/4],n[e+2]=t.bytes[e/4],n[e+3]=255}else n=new Uint8ClampedArray(t.bytes.buffer);i.getContext("2d").putImageData(new ImageData(n,t.width,t.height),0,0),this._setFabricObject(new ci.Image(i,{left:e.x,top:e.y}))}}if(i){const t=e.width/this.get("width");this.set("scaleX",t),this.set("scaleY",t)}else this.set("scaleX",e.width/this.get("width")),this.set("scaleY",e.height/this.get("height"));this.image=t,Je(this,bi,JSON.parse(JSON.stringify(e))),Je(this,Ci,i),this._mediaType="image"}extendSet(t,e){if("image"===t){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const t=new Image;return t.src=e.toDataURL(),this._fabricObject.setElement(t),this.image=e,!0}throw new Error("Unsupported value.")}}extendGet(t){if("image"===t)return this.image}updateCoordinateBaseFromImageToView(){if(this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),Ze(this,Ci,"f")){const t=this.convertPropFromViewToImage(this.get("width"))/this.get("width");this.set("scaleX",t),this.set("scaleY",t)}else this.set("scaleX",this.convertPropFromViewToImage(this.get("width"))/this.get("width")),this.set("scaleY",this.convertPropFromViewToImage(this.get("height"))/this.get("height"))}updateCoordinateBaseFromViewToImage(){if(this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),Ze(this,Ci,"f")){const t=this.convertPropFromImageToView(this.get("width"))/this.get("width");this.set("scaleX",t),this.set("scaleY",t)}else this.set("scaleX",this.convertPropFromImageToView(this.get("width"))/this.get("width")),this.set("scaleY",this.convertPropFromImageToView(this.get("height"))/this.get("height"))}setPosition(t){this.setImageRect(t)}getPosition(){return this.getImageRect()}updatePosition(){Ze(this,bi,"f")&&this.setImageRect(Ze(this,bi,"f"))}setImage(t){const e=this.getImageRect();if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)this.set("image",t);else{if(!b(t))throw new TypeError("Invalid 'image'.");{const e=document.createElement("canvas");let i;if(e.width=t.width,e.height=t.height,t.format===a.IPF_GRAYSCALED){i=new Uint8ClampedArray(t.width*t.height*4);for(let e=0;e<i.length;e+=4)i[e]=t.bytes[e/4],i[e+1]=t.bytes[e/4],i[e+2]=t.bytes[e/4],i[e+3]=255}else i=new Uint8ClampedArray(t.bytes.buffer);e.getContext("2d").putImageData(new ImageData(i,t.width,t.height),0,0),this.set("image",e)}}if(Ze(this,Ci,"f")){const t=e.width/this.get("width");this.set("scaleX",t),this.set("scaleY",t)}else this.set("scaleX",e.width/this.get("width")),this.set("scaleY",e.height/this.get("height"))}getImage(){return this.image}setImageRect(t){if(!A(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)if(this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),Ze(this,Ci,"f")){const e=this.convertPropFromViewToImage(t.width)/this.get("width");this.set("scaleX",e),this.set("scaleY",e)}else this.set("scaleX",this.convertPropFromViewToImage(t.width)/this.get("width")),this.set("scaleY",this.convertPropFromViewToImage(t.height)/this.get("height"));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");if(this.set("left",t.x),this.set("top",t.y),Ze(this,Ci,"f")){const e=t.width/this.get("width");this.set("scaleX",e),this.set("scaleY",e)}else this.set("scaleX",t.width/this.get("width")),this.set("scaleY",t.height/this.get("height"))}this._drawingLayer.renderAll()}else Je(this,bi,JSON.parse(JSON.stringify(t)))}getImageRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,bi,"f")?JSON.parse(JSON.stringify(Ze(this,bi,"f"))):null}};bi=new WeakMap,Ci=new WeakMap;const Ri=t=>{let e=(t=>t.split("\n").map((t=>t.split("\t"))))(t);return(t=>{for(let e=0;;e++){let i=-1;for(let n=0;n<t.length;n++){let s=t[n][e];void 0!==s&&s.length>i&&(i=s.length)}if(-1===i)break;for(let n=0;n<t.length;n++){if(e>=t[n].length-1)continue;let s=" ".repeat(i+2-t[n][e].length);t[n][e]=t[n][e].concat(s)}}})(e),(t=>{let e="";for(let i=0;i<t.length;i++)e=e.concat(...t[i],i===t.length-1?"":"\n");return e})(e)};let Mi=class extends _i{constructor(t,e,i){if(super(null,i),Si.set(this,void 0),!ui(t))throw new TypeError("Invalid 'text'.");if(!A(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ci.Textbox(Ri(t),{left:e.x,top:e.y,width:e.width})),this._text=t,Je(this,Si,JSON.parse(JSON.stringify(e))),this._mediaType="text"}extendSet(t,e){if("text"===t)return this._text=e,this._fabricObject.set("text",Ri(e)),!0}extendGet(t){if("text"===t)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(t){this.setTextRect(t)}getPosition(){return this.getTextRect()}updatePosition(){Ze(this,Si,"f")&&this.setTextRect(Ze(this,Si,"f"))}setText(t){if(!ui(t))throw new TypeError("Invalid 'text'.");this.set("text",t)}getText(){return this.get("text")}setTextRect(t){if(!A(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width)}this._drawingLayer.renderAll()}else Je(this,Si,JSON.parse(JSON.stringify(t)))}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,Si,"f")?JSON.parse(JSON.stringify(Ze(this,Si,"f"))):null}};var Li,Oi;Si=new WeakMap;let Bi=class extends Di{constructor(t,e){if(super({points:[null==t?void 0:t.startPoint,null==t?void 0:t.endPoint]},e),Li.set(this,void 0),!_(t))throw new TypeError("Invalid 'line'.");Je(this,Li,JSON.parse(JSON.stringify(t))),this._mediaType="line"}extendSet(t,e){if("startPoint"===t||"endPoint"===t){e="startPoint"===t?[e,this.get("endPoint")]:[this.get("startPoint"),e];const i=this._fabricObject;if(i.group){const t=i.group;i.points=e.map((e=>({x:e.x-t.left-t.width/2,y:e.y-t.top-t.height/2}))),t.addWithUpdate()}else i.points=e;const n=i.points.length-1;return i.controls=i.points.reduce((function(t,e,i){return t["p"+i]=new ci.Control({positionHandler:Ei,actionHandler:Ii(i>0?i-1:n,Ai),actionName:"modifyPolygon",pointIndex:i}),t}),{}),i._setPositionDimensions({}),!0}}extendGet(t){if("startPoint"===t||"endPoint"===t){const e=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let t in i.oCoords)e.push({x:i.oCoords[t].x,y:i.oCoords[t].y});else for(let t of i.points){let n=t.x-i.pathOffset.x,s=t.y-i.pathOffset.y;const o=ci.util.transformPoint({x:n,y:s},i.calcTransformMatrix());e.push({x:o.x,y:o.y})}return"startPoint"===t?e[0]:e[1]}}updateCoordinateBaseFromImageToView(){const t=this.get("startPoint"),e=this.get("endPoint");this.set("startPoint",{x:this.convertPropFromViewToImage(t.x),y:this.convertPropFromViewToImage(t.y)}),this.set("endPoint",{x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})}updateCoordinateBaseFromViewToImage(){const t=this.get("startPoint"),e=this.get("endPoint");this.set("startPoint",{x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)}),this.set("endPoint",{x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})}setPosition(t){this.setLine(t)}getPosition(){return this.getLine()}updatePosition(){Ze(this,Li,"f")&&this.setLine(Ze(this,Li,"f"))}setPolygon(){}getPolygon(){return null}setLine(t){if(!_(t))throw new TypeError("Invalid 'line'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("startPoint",{x:this.convertPropFromViewToImage(t.startPoint.x),y:this.convertPropFromViewToImage(t.startPoint.y)}),this.set("endPoint",{x:this.convertPropFromViewToImage(t.endPoint.x),y:this.convertPropFromViewToImage(t.endPoint.y)});else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("startPoint",t.startPoint),this.set("endPoint",t.endPoint)}this._drawingLayer.renderAll()}else Je(this,Li,JSON.parse(JSON.stringify(t)))}getLine(){if(this._drawingLayer){if("view"===this.coordinateBase)return{startPoint:{x:this.convertPropFromImageToView(this.get("startPoint").x),y:this.convertPropFromImageToView(this.get("startPoint").y)},endPoint:{x:this.convertPropFromImageToView(this.get("endPoint").x),y:this.convertPropFromImageToView(this.get("endPoint").y)}};if("image"===this.coordinateBase)return{startPoint:this.get("startPoint"),endPoint:this.get("endPoint")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,Li,"f")?JSON.parse(JSON.stringify(Ze(this,Li,"f"))):null}};Li=new WeakMap;let Fi=class extends Di{constructor(t,e){if(super({points:null==t?void 0:t.points},e),Oi.set(this,void 0),!P(t))throw new TypeError("Invalid 'quad'.");Je(this,Oi,JSON.parse(JSON.stringify(t))),this._mediaType="quad"}setPosition(t){this.setQuad(t)}getPosition(){return this.getQuad()}updatePosition(){Ze(this,Oi,"f")&&this.setQuad(Ze(this,Oi,"f"))}setPolygon(){}getPolygon(){return null}setQuad(t){if(!P(t))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const e=t.points.map((t=>({x:this.convertPropFromViewToImage(t.x),y:this.convertPropFromViewToImage(t.y)})));this.set("vertices",e)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else Je(this,Oi,JSON.parse(JSON.stringify(t)))}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Ze(this,Oi,"f")?JSON.parse(JSON.stringify(Ze(this,Oi,"f"))):null}};Oi=new WeakMap;let Ni=class extends _i{constructor(t){super(new ci.Group(t.map((t=>t._getFabricObject())))),this._fabricObject.on("selected",(()=>{this.setState(ai.DIS_SELECTED);const t=this._fabricObject._objects;for(let e of t)setTimeout((()=>{e&&e.fire("selected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._fabricObject.on("deselected",(()=>{this.setState(ai.DIS_DEFAULT);const t=this._fabricObject._objects;for(let e of t)setTimeout((()=>{e&&e.fire("deselected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._mediaType="group"}extendSet(t,e){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map((t=>t.getDrawingItem()))}setChildDrawingItems(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}};const Ui=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),Vi=t=>!!ui(t)&&""!==t,Wi=t=>!(!Ui(t)||"id"in t&&!di(t.id)||"lineWidth"in t&&!di(t.lineWidth)||"fillStyle"in t&&!Vi(t.fillStyle)||"strokeStyle"in t&&!Vi(t.strokeStyle)||"paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode)||"fontFamily"in t&&!Vi(t.fontFamily)||"fontSize"in t&&!di(t.fontSize));let Hi=class{static convert(t,e,i){const n={x:0,y:0,width:e,height:i};if(!t)return n;if(A(t))t.isMeasuredInPercentage?(n.x=t.x/100*e,n.y=t.y/100*i,n.width=t.width/100*e,n.height=t.height/100*i):(n.x=t.x,n.y=t.y,n.width=t.width,n.height=t.height);else{if(!C(t))throw TypeError("Invalid region.");t.isMeasuredInPercentage?(n.x=t.left/100*e,n.y=t.top/100*i,n.width=(t.right-t.left)/100*e,n.height=(t.bottom-t.top)/100*i):(n.x=t.left,n.y=t.top,n.width=t.right-t.left,n.height=t.bottom-t.top)}return n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=Math.round(n.width),n.height=Math.round(n.height),n}};var ji,zi;let Gi=class{constructor(){ji.set(this,new Map),zi.set(this,!1)}get disposed(){return Ze(this,zi,"f")}on(t,e){t=t.toLowerCase();const i=Ze(this,ji,"f").get(t);if(i){if(i.includes(e))return;i.push(e)}else Ze(this,ji,"f").set(t,[e])}off(t,e){t=t.toLowerCase();const i=Ze(this,ji,"f").get(t);if(!i)return;const n=i.indexOf(e);-1!==n&&i.splice(n,1)}offAll(t){t=t.toLowerCase();const e=Ze(this,ji,"f").get(t);e&&(e.length=0)}fire(t,e=[],i={async:!1,copy:!0}){e||(e=[]),t=t.toLowerCase();const n=Ze(this,ji,"f").get(t);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let s of n){if(!s)continue;let o=[];if(i.copy)for(let i of e){try{i=JSON.parse(JSON.stringify(i))}catch(t){}o.push(i)}else o=e;let r=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(s)&&s.apply(i.target,o)}),0);else try{r=s.apply(i.target,o)}catch(t){}if(!0===r)break}}}dispose(){Je(this,zi,!0)}};function Yi(t,e,i){return(i.x-t.x)*(e.y-t.y)==(e.x-t.x)*(i.y-t.y)&&Math.min(t.x,e.x)<=i.x&&i.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=i.y&&i.y<=Math.max(t.y,e.y)}function $i(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Xi(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((s^o)>=0&&0!==s&&0!==o||(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),o=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),(s^o)>=0&&0!==s&&0!==o))}ji=new WeakMap,zi=new WeakMap;const qi=async t=>{if("string"!=typeof t)throw new TypeError("Invalid url.");const e=await fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);const i=await e.text();if(!i.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const n=document.createElement("div");if(n.insertAdjacentHTML("beforeend",i),1===n.childElementCount&&n.firstChild instanceof HTMLTemplateElement)return n.firstChild.content;const s=new DocumentFragment;for(let t of n.children)s.append(t);return s};var Zi,Ji,Ki,Qi,tn,en,nn,sn,on,rn,an,ln,hn,cn,dn,un,pn,gn,fn,mn,vn,yn,xn,wn,bn,Cn,Sn,_n,Tn,En,Pn,An,In,Dn;let kn=class t{static createDrawingStyle(e){if(!Wi(e))throw new Error("Invalid style definition.");let i,n=t.USER_START_STYLE_ID;for(;Ze(t,Zi,"f",Ji).has(n);)n++;i=n;const s=JSON.parse(JSON.stringify(e));s.id=i;for(let e in Ze(t,Zi,"f",Ki))s.hasOwnProperty(e)||(s[e]=Ze(t,Zi,"f",Ki)[e]);return Ze(t,Zi,"f",Ji).set(i,s),s.id}static _getDrawingStyle(e,i){if("number"!=typeof e)throw new Error("Invalid style id.");const n=Ze(t,Zi,"f",Ji).get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}static getDrawingStyle(t){return this._getDrawingStyle(t,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(Ze(t,Zi,"f",Ji).values())))}static _updateDrawingStyle(e,i){if(!Wi(i))throw new Error("Invalid style definition.");const n=Ze(t,Zi,"f",Ji).get(e);if(n)for(let t in i)n.hasOwnProperty(t)&&(n[t]=i[t])}static updateDrawingStyle(t,e){this._updateDrawingStyle(t,e)}};Zi=kn,kn.STYLE_BLUE_STROKE=1,kn.STYLE_GREEN_STROKE=2,kn.STYLE_ORANGE_STROKE=3,kn.STYLE_YELLOW_STROKE=4,kn.STYLE_BLUE_STROKE_FILL=5,kn.STYLE_GREEN_STROKE_FILL=6,kn.STYLE_ORANGE_STROKE_FILL=7,kn.STYLE_YELLOW_STROKE_FILL=8,kn.STYLE_BLUE_STROKE_TRANSPARENT=9,kn.STYLE_GREEN_STROKE_TRANSPARENT=10,kn.STYLE_ORANGE_STROKE_TRANSPARENT=11,kn.USER_START_STYLE_ID=1024,Ji={value:new Map([[kn.STYLE_BLUE_STROKE,{id:kn.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[kn.STYLE_GREEN_STROKE,{id:kn.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_ORANGE_STROKE,{id:kn.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_YELLOW_STROKE,{id:kn.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[kn.STYLE_BLUE_STROKE_FILL,{id:kn.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_GREEN_STROKE_FILL,{id:kn.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_ORANGE_STROKE_FILL,{id:kn.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_YELLOW_STROKE_FILL,{id:kn.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_BLUE_STROKE_TRANSPARENT,{id:kn.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_GREEN_STROKE_TRANSPARENT,{id:kn.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[kn.STYLE_ORANGE_STROKE_TRANSPARENT,{id:kn.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},Ki={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(ci.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(ci.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(t){t.dispose&&t.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ci.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},ci.Object.prototype.transparentCorners=!1,ci.Object.prototype.cornerSize=20,ci.Object.prototype.touchCornerSize=100,ci.Object.prototype.cornerColor="rgb(254,142,20)",ci.Object.prototype.cornerStyle="circle",ci.Object.prototype.strokeUniform=!0,ci.Object.prototype.hasBorders=!1,ci.Canvas.prototype.containerClass="",ci.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var i,n=this.upperCanvasEl,s=ci.util.getPointer(t,n),o=n.getBoundingClientRect(),r=o.width||0,a=o.height||0;r&&a||("top"in o&&"bottom"in o&&(a=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(r=Math.abs(o.right-o.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=this.restorePointerVpt(s));var l=this.getRetinaScaling();if(1!==l&&(s.x/=l,s.y/=l),0!==r&&0!==a){var h=window.getComputedStyle(n).objectFit,c=n.width,d=n.height,u=r,p=a;i={width:c/u,height:d/p};var g,f,m=c/d,v=u/p;return"contain"===h?m>v?(g=u,f=u/m,{x:s.x*i.width,y:(s.y-(p-f)/2)*i.width}):(g=p*m,f=p,{x:(s.x-(u-g)/2)*i.height,y:s.y*i.height}):"cover"===h?m>v?{x:(c-i.height*u)/2+s.x*i.height,y:s.y*i.height}:{x:s.x*i.width,y:(d-i.width*p)/2+s.y*i.width}:{x:s.x*i.width,y:s.y*i.height}}return i={width:1,height:1},{x:s.x*i.width,y:s.y*i.height}},ci.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();ci.util.addListener(ci.document,"touchend",this._onTouchEnd,{passive:!1}),ci.util.addListener(ci.document,"touchmove",this._onMouseMove,{passive:!1}),ci.util.removeListener(i,n+"down",this._onMouseDown)},ci.Textbox.prototype._wrapLine=function(t,e,i,n){const s=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),o=!(!s||!s.length);var r=0,a=this.splitByGrapheme||o,l=[],h=[],c=a?ci.util.string.graphemeSplit(t):t.split(this._wordJoiners),d="",u=0,p=a?"":" ",g=0,f=0,m=0,v=!0,y=this._getWidthOfCharSpacing();n=n||0,0===c.length&&c.push([]),i-=n;for(var x=0;x<c.length;x++)d=a?c[x]:ci.util.string.graphemeSplit(c[x]),g=this._measureWord(d,e,u),u+=d.length,(r+=f+g-y)>i&&!v?(l.push(h),h=[],r=g,v=!0):r+=y,v||a||h.push(p),h=h.concat(d),f=a?0:this._measureWord([p],e,u),u++,v=!1,g>m&&(m=g);return x&&l.push(h),m+n>this.dynamicMinWidth&&(this.dynamicMinWidth=m-y+n),l});let Rn=class t{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(t){this.fabricCanvas.selection=t,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,i,n){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let t=this.fabricCanvas=new ci.Canvas(e,Object.assign(n,{allowTouchScrolling:!0,selection:!1}));t.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),t.lowerCanvasEl.className="",t.upperCanvasEl.className="",t.on("selection:created",(function(t){const e=t.selected,i=[];for(let t of e){const e=t.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let t of i){const i=[];for(let n of e){const e=n.getDrawingItem();e._drawingLayer===t&&i.push(e)}setTimeout((()=>{t.onSelectionChanged&&t.onSelectionChanged(i,[])}),0)}})),t.on("before:selection:cleared",(function(t){const e=this.getActiveObjects(),i=[];for(let t of e){const e=t.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let t of i){const i=[];for(let n of e){const e=n.getDrawingItem();e._drawingLayer===t&&i.push(e)}setTimeout((()=>{const e=[];for(let n of i)t.hasDrawingItem(n)&&e.push(n);e.length>0&&t.onSelectionChanged&&t.onSelectionChanged([],e)}),0)}})),t.on("selection:updated",(function(t){const e=t.selected,i=t.deselected,n=[];for(let t of e){const e=t.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let t of i){const e=t.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let t of n){const n=[],s=[];for(let i of e){const e=i.getDrawingItem();e._drawingLayer===t&&n.push(e)}for(let e of i){const i=e.getDrawingItem();i._drawingLayer===t&&s.push(i)}setTimeout((()=>{t.onSelectionChanged&&t.onSelectionChanged(n,s)}),0)}})),t.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let s,o;switch(this.id=i,i){case t.DDN_LAYER_ID:s=kn.getDrawingStyle(kn.STYLE_BLUE_STROKE),o=kn.getDrawingStyle(kn.STYLE_BLUE_STROKE_FILL);break;case t.DBR_LAYER_ID:s=kn.getDrawingStyle(kn.STYLE_ORANGE_STROKE),o=kn.getDrawingStyle(kn.STYLE_ORANGE_STROKE_FILL);break;case t.DLR_LAYER_ID:s=kn.getDrawingStyle(kn.STYLE_GREEN_STROKE),o=kn.getDrawingStyle(kn.STYLE_GREEN_STROKE_FILL);break;default:s=kn.getDrawingStyle(kn.STYLE_YELLOW_STROKE),o=kn.getDrawingStyle(kn.STYLE_YELLOW_STROKE_FILL)}for(let t of _i.arrMediaTypes)this.mapType_StateAndStyleId.set(t,{default:s.id,selected:o.id})}getId(){return this.id}setVisible(t){if(t){for(let t of this._arrFabricObject)t.visible=!0,t.hasControls=!0;this._visible=!0}else{for(let t of this._arrFabricObject)t.visible=!1,t.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(t){if(t.styleId)return kn.getDrawingStyle(t.styleId);return kn.getDrawingStyle(t._mapState_StyleId.get(t.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(t,e,i,n){const s=this.getDrawingItems((e=>e._mediaType===t));for(let t of s)t.styleSelector===e&&this._changeItemStyle(t,i,!0);n||this.fabricCanvas.renderAll()}_changeItemStyle(t,e,i){if(!t||!e)return;const n=t._getFabricObject();"number"==typeof t.styleId&&(e=kn.getDrawingStyle(t.styleId)),n.strokeWidth=e.lineWidth,"fill"===e.paintMode?(n.fill=e.fillStyle,n.stroke=e.fillStyle):"stroke"===e.paintMode?(n.fill="transparent",n.stroke=e.strokeStyle):"strokeAndFill"===e.paintMode&&(n.fill=e.fillStyle,n.stroke=e.strokeStyle),n.fontFamily&&(n.fontFamily=e.fontFamily),n.fontSize&&(n.fontSize=e.fontSize),n.group||(n.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(t,e,i){if(!t||!e)return;const n=t.getChildDrawingItems();if("add"===i){if(n.includes(e))return;const i=e._getFabricObject();if(this.fabricCanvas.getObjects().includes(i)){if(!this._arrFabricObject.includes(i))throw new Error("Existed in other drawing layers.");e._zIndex=null}else{let i;if(e.styleId)i=kn.getDrawingStyle(e.styleId);else{const n=this.mapType_StateAndStyleId.get(e._mediaType);i=kn.getDrawingStyle(n[t.styleSelector]);const s=()=>{this._changeItemStyle(e,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected),!0)},o=()=>{this._changeItemStyle(e,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default),!0)};e._on("selected",s),e._on("deselected",o),e._funcChangeStyleToSelected=s,e._funcChangeStyleToDefault=o}e._drawingLayer=this,e._drawingLayerId=this.id,this._changeItemStyle(e,i,!0)}t._fabricObject.addWithUpdate(e._getFabricObject())}else{if("remove"!==i)return;if(!n.includes(e))return;e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,t._fabricObject.removeWithUpdate(e._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(t,e){if(!(t instanceof _i))throw new TypeError("Invalid 'drawingItem'.");if(t._drawingLayer){if(t._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let i=t._getFabricObject();const n=this.fabricCanvas.getObjects();let s,o;if(n.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if("group"===t._mediaType){s=t.getChildDrawingItems();for(let t of s)if(t._drawingLayer&&t._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(e&&"object"==typeof e&&!Array.isArray(e))for(let t in e)i.set(t,e[t]);if(s){for(let t of s){const e=this.mapType_StateAndStyleId.get(t._mediaType);for(let i of _i.arrStyleSelectors)t._mapState_StyleId.set(i,e[i]);if(t.styleId)o=kn.getDrawingStyle(t.styleId);else{o=kn.getDrawingStyle(e.default);const i=()=>{this._changeItemStyle(t,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected),!0)},n=()=>{this._changeItemStyle(t,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default),!0)};t._on("selected",i),t._on("deselected",n),t._funcChangeStyleToSelected=i,t._funcChangeStyleToDefault=n}t._drawingLayer=this,t._drawingLayerId=this.id,this._changeItemStyle(t,o,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{const e=this.mapType_StateAndStyleId.get(t._mediaType);for(let i of _i.arrStyleSelectors)t._mapState_StyleId.set(i,e[i]);if(t.styleId)o=kn.getDrawingStyle(t.styleId);else{o=kn.getDrawingStyle(e.default);const i=()=>{this._changeItemStyle(t,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected))},n=()=>{this._changeItemStyle(t,kn.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default))};t._on("selected",i),t._on("deselected",n),t._funcChangeStyleToSelected=i,t._funcChangeStyleToDefault=n}this._changeItemStyle(t,o)}t._zIndex=this.id,t._drawingLayer=this,t._drawingLayerId=this.id;const r=this._arrFabricObject.length;let a=n.length;if(r)a=n.indexOf(this._arrFabricObject[r-1])+1;else for(let e=0;e<n.length;e++)if(t._zIndex<n[e].getDrawingItem()._zIndex){a=e;break}this._arrDrwaingItem.push(t),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,a,!1)}addDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)t._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");t._setEditable(!0)}this._addDrawingItem(t),t.updatePosition()}addDrawingItems(t){for(let e of t)this.addDrawingItem(e)}removeDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(t))return;if(t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,"group"===t._mediaType){const e=t.getChildDrawingItems();for(let t of e)t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,t._mapState_StyleId.clear()}else t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,t._mapState_StyleId.clear();const e=t._getFabricObject();"selected"===t.styleSelector&&(e.group?e.group.removeWithUpdate(e):this.fabricCanvas._activeObject=null,t.setState(ai.DIS_DEFAULT)),this.fabricCanvas.remove(e),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(t),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(e),1)}removeDrawingItems(t){for(let e of t)this.removeDrawingItem(e)}setDrawingItems(t){this.clearDrawingItems(),this.addDrawingItems(t)}getDrawingItems(t){return t&&"function"==typeof t?this._arrDrwaingItem.filter(t):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const t=this.fabricCanvas.getActiveObjects(),e=[];for(let i of t)this._arrFabricObject.includes(i)&&e.push(i.getDrawingItem());return e}hasDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(t)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(t,e,i){e?e.forEach((t=>t.toLowerCase())):e=_i.arrMediaTypes,i?i.forEach((t=>t.toLowerCase())):i=_i.arrStyleSelectors;const n=kn.getDrawingStyle(t);if(!n)throw new Error(`The 'drawingStyle' with id '${t}' doesn't exist.`);let s;for(let o of e)if(s=this.mapType_StateAndStyleId.get(o),s)for(let e of i){this._changeMediaTypeCurStyleInStyleSelector(o,e,n,!0),s[e]=t;for(let i of this._arrDrwaingItem)i._mediaType===o&&i._mapState_StyleId.set(e,t)}this.fabricCanvas.renderAll()}setDefaultStyle(t,e,i){const n=[];i&ri.DIMT_RECTANGLE&&n.push("rect"),i&ri.DIMT_QUADRILATERAL&&n.push("quad"),i&ri.DIMT_TEXT&&n.push("text"),i&ri.DIMT_ARC&&n.push("arc"),i&ri.DIMT_IMAGE&&n.push("image"),i&ri.DIMT_POLYGON&&n.push("polygon"),i&ri.DIMT_LINE&&n.push("line");const s=[];e&ai.DIS_DEFAULT&&s.push("default"),e&ai.DIS_SELECTED&&s.push("selected"),this._setDefaultStyle(t,n.length?n:null,s.length?s:null)}setMode(t){if("viewer"===(t=t.toLowerCase())){for(let t of this._arrDrwaingItem)t._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==t)throw new RangeError("Invalid value.");for(let t of this._arrDrwaingItem)t._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(t,e){this.fabricCanvas.setDimensions(t,e)}_setObjectFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=t,this.fabricCanvas.upperCanvasEl.style.objectFit=t}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let t of this._arrDrwaingItem){const e=this._getItemCurrentStyle(t);this._changeItemStyle(t,e,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}};Rn.DDN_LAYER_ID=1,Rn.DBR_LAYER_ID=2,Rn.DLR_LAYER_ID=3,Rn.USER_DEFINED_LAYER_BASE_ID=100,Rn.TIP_LAYER_ID=999;let Mn=class{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(t,e){if(this.getDrawingLayer(e))throw new Error("Existed drawing layer id.");const i=new Rn(t,e,{enableRetinaScaling:!1});return i._manager=this,this._arrDrawingLayer.push(i),this._switchPointerEvent(),i}deleteDrawingLayer(t){const e=this.getDrawingLayer(t);if(!e)return;const i=this._arrDrawingLayer;e.dispose(),i.splice(i.indexOf(e),1),this._switchPointerEvent()}clearDrawingLayers(){for(let t of this._arrDrawingLayer)t.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(t){for(let e of this._arrDrawingLayer)if(e.getId()===t)return e;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const t=this._getFabricCanvas().getActiveObjects(),e=[];for(let i of t)e.push(i.getDrawingItem());return e}setDimensions(t,e){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(t,e)}setObjectFit(t){for(let e of this._arrDrawingLayer)e&&e._setObjectFit(t)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(t){if(!this._arrDrawingLayer.length)return;this._getFabricCanvas().wrapperEl.style.display=t?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let t of this._arrDrawingLayer)t.getMode()}},Ln=class extends Mi{constructor(t,e,i,n,s){super(t,{x:e,y:i,width:n,height:0},s),Qi.set(this,void 0),tn.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var t=0,e=0,i=this._textLines.length;e<i;e++)t+=this.getHeightOfLine(e);return t+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(t){Je(this,Qi,t),Ze(this,tn,"f")&&clearTimeout(Ze(this,tn,"f")),Ze(this,Qi,"f")>=0&&Je(this,tn,setTimeout((()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()}),Ze(this,Qi,"f")))}getDuration(){return Ze(this,Qi,"f")}};Qi=new WeakMap,tn=new WeakMap;let On=class{constructor(){en.add(this),nn.set(this,void 0),sn.set(this,void 0),on.set(this,void 0),rn.set(this,!0),this._drawingLayerManager=new Mn}createDrawingLayerBaseCvs(t,e,i="contain"){if("number"!=typeof t||t<=1)throw new Error("Invalid 'width'.");if("number"!=typeof e||e<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");const n=document.createElement("canvas");return n.width==t&&n.height==e||(n.width=t,n.height=e),n.style.objectFit=i,n}_createDrawingLayer(t,e,i,n){if(!this._layerBaseCvs){let s;try{s=this.getContentDimensions()}catch(t){if("Invalid content dimensions."!==(t.message||t))throw t}e||(e=(null==s?void 0:s.width)||1280),i||(i=(null==s?void 0:s.height)||720),n||(n=(null==s?void 0:s.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(e,i,n)}const s=this._layerBaseCvs,o=this._drawingLayerManager.createDrawingLayer(s,t);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",s.parentElement),o}createDrawingLayer(){let t;for(let e=Rn.USER_DEFINED_LAYER_BASE_ID;;e++)if(!this._drawingLayerManager.getDrawingLayer(e)&&e!==Rn.TIP_LAYER_ID){t=e;break}return this._createDrawingLayer(t)}deleteDrawingLayer(t){var e;this._drawingLayerManager.deleteDrawingLayer(t),this._drawingLayerManager.getAllDrawingLayers().length||(null===(e=this._innerComponent)||void 0===e||e.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(t){if("number"!=typeof t)throw new TypeError("Invalid id.");if(t<Rn.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${t} is not defined by users.`);this.deleteDrawingLayer(t)}_clearDrawingLayers(){const t=this.getAllDrawingLayers();for(let e of t)this.deleteDrawingLayer(e.getId())}clearUserDefinedDrawingLayers(){const t=this.getAllDrawingLayers();for(let e of t){const t=e.getId();t<Rn.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(t)}}getDrawingLayer(t){if(t==Rn.TIP_LAYER_ID)return null;return this._drawingLayerManager.getDrawingLayer(t)||([Rn.DDN_LAYER_ID,Rn.DBR_LAYER_ID,Rn.DLR_LAYER_ID].includes(t)?this._createDrawingLayer(t):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter((t=>t.getId()>=0&&t.getId()!==Rn.TIP_LAYER_ID))}updateDrawingLayers(t){((t,e,i)=>{if(!(t<=1||e<=1)){if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:t,height:e},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(i)}})(t.width,t.height,t.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(t){if(!(Ui(e=t)&&T(e.topLeftPoint)&&di(e.width))||e.width<=0||!di(e.duration)||"coordinateBase"in e&&!["view","image"].includes(e.coordinateBase))throw new Error("Invalid tip config.");var e;Je(this,nn,JSON.parse(JSON.stringify(t))),Ze(this,nn,"f").coordinateBase||(Ze(this,nn,"f").coordinateBase="view"),Je(this,on,t.duration),Ze(this,en,"m",cn).call(this)}getTipConfig(){return Ze(this,nn,"f")?Ze(this,nn,"f"):null}setTipVisible(t){if("boolean"!=typeof t)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",t),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Je(this,rn,t)}isTipVisible(){return Ze(this,rn,"f")}updateTipMessage(t){if(!Ze(this,nn,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=kn.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Rn.TIP_LAYER_ID)||this._createDrawingLayer(Rn.TIP_LAYER_ID)),this._tip?this._tip.set("text",t):this._tip=Ze(this,en,"m",an).call(this,t,Ze(this,nn,"f").topLeftPoint.x,Ze(this,nn,"f").topLeftPoint.y,Ze(this,nn,"f").width,Ze(this,nn,"f").coordinateBase,this._tipStyleId),Ze(this,en,"m",ln).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",Ze(this,rn,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),Ze(this,sn,"f")&&clearTimeout(Ze(this,sn,"f")),Ze(this,on,"f")>=0&&Je(this,sn,setTimeout((()=>{Ze(this,en,"m",hn).call(this)}),Ze(this,on,"f")))}};nn=new WeakMap,sn=new WeakMap,on=new WeakMap,rn=new WeakMap,en=new WeakSet,an=function(t,e,i,n,s,o){const r=new Ln(t,e,i,n,o);return r.coordinateBase=s,r},ln=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},hn=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},cn=function(){if(!this._tip)return;const t=Ze(this,nn,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};let Bn=class extends HTMLElement{constructor(){super(),dn.set(this,void 0);const t=new DocumentFragment,e=document.createElement("div");e.setAttribute("class","wrapper"),t.appendChild(e),Je(this,dn,e);const i=document.createElement("slot");i.setAttribute("name","single-frame-input-container"),e.append(i);const n=document.createElement("slot");n.setAttribute("name","content"),e.append(n);const s=document.createElement("slot");s.setAttribute("name","drawing-layer"),e.append(s);const o=document.createElement("style");o.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',t.appendChild(o),this.attachShadow({mode:"open"}).appendChild(t)}getWrapper(){return Ze(this,dn,"f")}setElement(t,e){if(!(e instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");this.removeElement(t),e.setAttribute("slot",t),this.appendChild(e)}getElement(t){if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${t}"]`)}removeElement(t){var e;if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");null===(e=this.querySelectorAll(`[slot="${t}"]`))||void 0===e||e.forEach((t=>t.remove()))}};dn=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",Bn);let Fn=class t extends On{static get engineResourcePath(){return R(yt.engineResourcePaths).dce}static set defaultUIElementURL(e){t._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=t._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",t.engineResourcePath)}static async createInstance(e){const i=new t;return"string"==typeof e&&(e=e.replace("@engineResourcePath/",t.engineResourcePath)),await i.setUIElement(e||t.defaultUIElementURL),i}static _transformCoordinates(t,e,i,n,s,o,r){const a=o/n,l=r/s;t.x=Math.round(t.x/a+e),t.y=Math.round(t.y/l+i)}set _singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(t!==Ze(this,bn,"f")){if(Je(this,bn,t),Ze(this,un,"m",_n).call(this))Je(this,mn,null),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!Ze(this,mn,"f")){const t=document.createElement("video");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.objectFit=this.getVideoFit(),t.setAttribute("autoplay","true"),t.setAttribute("playsinline","true"),t.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Xe.OS)&&t.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Je(this,mn,t);const e=document.createElement("div");e.append(t),e.style.overflow="hidden",this._videoContainer=e,this._innerComponent.setElement("content",e)}Ze(this,un,"m",_n).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return Ze(this,bn,"f")}get disposed(){return Ze(this,Sn,"f")}constructor(){super(),un.add(this),pn.set(this,void 0),gn.set(this,void 0),fn.set(this,void 0),this.containerClassName="dce-video-container",mn.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,vn.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,yn.set(this,!1),xn.set(this,!1),wn.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{Ze(this,un,"m",In).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout((()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&Ze(this,un,"m",An).call(this))}),this._updateLayersTimeout)},this._windowResizeListener=()=>{t._onLog&&t._onLog("window resize event triggered."),Ze(this,wn,"f").width===document.documentElement.clientWidth&&Ze(this,wn,"f").height===document.documentElement.clientHeight||(Ze(this,wn,"f").width=document.documentElement.clientWidth,Ze(this,wn,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},bn.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!Ze(this,un,"m",_n).call(this))return;let t;if(this._singleFrameInputContainer)t=this._singleFrameInputContainer.firstElementChild;else{t=document.createElement("input"),t.setAttribute("type","file"),"camera"===this._singleFrameMode?(t.setAttribute("capture",""),t.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(t.removeAttribute("capture"),t.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),t.addEventListener("change",(async()=>{const e=t.files[0];t.value="";{const t=async t=>{let e=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(e=await createImageBitmap(t),e)return e}catch(t){}var n;return e||(i=await(n=t,new Promise(((t,e)=>{let i=URL.createObjectURL(n),s=new Image;s.src=i,s.onload=()=>{URL.revokeObjectURL(s.src),t(s)},s.onerror=t=>{e(new Error("Can't convert blob to image : "+(t instanceof Event?t.type:t)))}})))),i},i=(t,e,i,n)=>{t.width==i&&t.height==n||(t.width=i,t.height=n);const s=t.getContext("2d");s.clearRect(0,0,t.width,t.height),s.drawImage(e,0,0)},n=await t(e),s=n instanceof HTMLImageElement?n.naturalWidth:n.width,o=n instanceof HTMLImageElement?n.naturalHeight:n.height;let r=this._cvsSingleFrameMode;const a=null==r?void 0:r.width,l=null==r?void 0:r.height;r||(r=document.createElement("canvas"),this._cvsSingleFrameMode=r),i(r,n,s,o),this._innerComponent.setElement("content",r),a===r.width&&l===r.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout((()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)}),0)})),t.style.position="absolute",t.style.top="-9999px",t.style.backgroundColor="transparent",t.style.color="transparent";const e=document.createElement("div");e.append(t),this._innerComponent.setElement("single-frame-input-container",e),this._singleFrameInputContainer=e}null==t||t.click()},Cn.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,i)=>{var n,s,o,r;if(this.disposed)return;if(this.clearAllInnerDrawingItems(),!e)return;const a=e.originalImageTag;if(!a)return;const l=e.items;if(!(null==l?void 0:l.length))return;const h=(null===(n=a.cropRegion)||void 0===n?void 0:n.left)||0,c=(null===(s=a.cropRegion)||void 0===s?void 0:s.top)||0,d=(null===(o=a.cropRegion)||void 0===o?void 0:o.right)?a.cropRegion.right-h:a.originalWidth,u=(null===(r=a.cropRegion)||void 0===r?void 0:r.bottom)?a.cropRegion.bottom-c:a.originalHeight,p=a.currentWidth,g=a.currentHeight,f=(e,i,n,s,o,r,a,l,h=[],c)=>{i.forEach((e=>t._transformCoordinates(e,n,s,o,r,a,l)));const d=new Fi({points:[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:i[2].x,y:i[2].y},{x:i[3].x,y:i[3].y}]},c);for(let t of h)d.addNote(t);e.addDrawingItems([d]),Ze(this,Cn,"f").push(d)};let m,v;for(let t of l)switch(t.type){case xt.CRIT_ORIGINAL_IMAGE:break;case xt.CRIT_BARCODE:m=this.getDrawingLayer(Rn.DBR_LAYER_ID),v=[{name:"format",content:t.formatString},{name:"text",content:t.text}],(null==i?void 0:i.isBarcodeVerifyOpen)?t.verified?f(m,t.location.points,h,c,d,u,p,g,v):f(m,t.location.points,h,c,d,u,p,g,v,kn.STYLE_ORANGE_STROKE_TRANSPARENT):f(m,t.location.points,h,c,d,u,p,g,v);break;case xt.CRIT_TEXT_LINE:m=this.getDrawingLayer(Rn.DLR_LAYER_ID),v=[{name:"text",content:t.text}],i.isLabelVerifyOpen?t.verified?f(m,t.location.points,h,c,d,u,p,g,v):f(m,t.location.points,h,c,d,u,p,g,v,kn.STYLE_GREEN_STROKE_TRANSPARENT):f(m,t.location.points,h,c,d,u,p,g,v);break;case xt.CRIT_DETECTED_QUAD:m=this.getDrawingLayer(Rn.DDN_LAYER_ID),(null==i?void 0:i.isDetectVerifyOpen)?t.crossVerificationStatus===Pt.CVS_PASSED?f(m,t.location.points,h,c,d,u,p,g,[]):f(m,t.location.points,h,c,d,u,p,g,[],kn.STYLE_BLUE_STROKE_TRANSPARENT):f(m,t.location.points,h,c,d,u,p,g,[]);break;case xt.CRIT_NORMALIZED_IMAGE:m=this.getDrawingLayer(Rn.DDN_LAYER_ID),(null==i?void 0:i.isNormalizeVerifyOpen)?t.crossVerificationStatus===Pt.CVS_PASSED?f(m,t.location.points,h,c,d,u,p,g,[]):f(m,t.location.points,h,c,d,u,p,g,[],kn.STYLE_BLUE_STROKE_TRANSPARENT):f(m,t.location.points,h,c,d,u,p,g,[]);break;case xt.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},Sn.set(this,!1),this.eventHandler=new Gi,this.eventHandler.on("content:updated",(()=>{Ze(this,pn,"f")&&clearTimeout(Ze(this,pn,"f")),Je(this,pn,setTimeout((()=>{if(this.disposed)return;let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}this.updateDrawingLayers(t),this.updateConvertedRegion(t)}),0))})),this.eventHandler.on("videoEl:resized",(()=>{Ze(this,gn,"f")&&clearTimeout(Ze(this,gn,"f")),Je(this,gn,setTimeout((()=>{this.disposed||this._updateVideoContainer()}),0))}))}_setUIElement(t){this.UIElement=t,this._unbindUI(),this._bindUI()}async setUIElement(t){let e;if("string"==typeof t){let i=await qi(t);e=document.createElement("div"),Object.assign(e.style,{width:"100%",height:"100%"}),e.attachShadow({mode:"open"}).appendChild(i.cloneNode(!0))}else e=t;this._setUIElement(e)}getUIElement(){return this.UIElement}_bindUI(){var e,i;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let n=this.UIElement;n=n.shadowRoot||n;let s=(null===(e=n.classList)||void 0===e?void 0:e.contains(this.containerClassName))?n:n.querySelector(`.${this.containerClassName}`);if(!s)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=document.createElement("dce-component"),s.appendChild(this._innerComponent),Ze(this,un,"m",_n).call(this));else{const t=document.createElement("video");Object.assign(t.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",objectFit:this.getVideoFit()}),t.setAttribute("autoplay","true"),t.setAttribute("playsinline","true"),t.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Xe.OS)&&t.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Je(this,mn,t);const e=document.createElement("div");e.append(t),e.style.overflow="hidden",this._videoContainer=e,this._innerComponent.setElement("content",e)}if(this._selRsl=n.querySelector(".dce-sel-resolution"),this._selMinLtr=n.querySelector(".dlr-sel-minletter"),this._divScanArea=n.querySelector(".dce-scanarea"),this._divScanLight=n.querySelector(".dce-scanlight"),this._bgLoading=n.querySelector(".dce-bg-loading"),this._bgCamera=n.querySelector(".dce-bg-camera"),this._selCam=n.querySelector(".dce-sel-camera"),this._optGotRsl=n.querySelector(".dce-opt-gotResolution"),this._btnClose=n.querySelector(".dce-btn-close"),this._optGotMinLtr=n.querySelector(".dlr-opt-gotMinLtr"),this._selRsl&&(this._hideDefaultSelection||Ze(this,un,"m",_n).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||Ze(this,un,"m",_n).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||Ze(this,un,"m",In).call(this),Ze(this,un,"m",_n).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),Ze(this,un,"m",_n).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver((e=>{var i;t._onLog&&t._onLog("resize observer triggered.");for(let t of e)t.target===(null===(i=this._innerComponent)||void 0===i?void 0:i.getWrapper())&&this._videoResizeListener()})));const e=null===(i=this._innerComponent)||void 0===i?void 0:i.getWrapper();e&&this._resizeObserver.observe(e)}Ze(this,wn,"f").width=document.documentElement.clientWidth,Ze(this,wn,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var t,e,i,n;Ze(this,un,"m",_n).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),Ze(this,un,"m",In).call(this),null===(t=this._drawingLayerManager)||void 0===t||t.clearDrawingLayers(),null===(e=this._innerComponent)||void 0===e||e.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(i=this._innerComponent)||void 0===i||i.remove(),this._innerComponent=null,Je(this,mn,null),null===(n=this._videoContainer)||void 0===n||n.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(t,e){if(this._selCam){let i;this._selCam.textContent="";for(let n of e){const e=document.createElement("option");e.value=n.deviceId,e.innerText=n.label,this._selCam.append(e),n.deviceId&&t&&t.deviceId==n.deviceId&&(i=e)}this._selCam.value=i?i.value:""}let i=this.UIElement;if(i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")){let t=i.querySelector(".dce-mn-cameras");if(t){t.textContent="";for(let i of e){const e=document.createElement("div");e.classList.add("dce-mn-camera-option"),e.setAttribute("data-davice-id",i.deviceId),e.textContent=i.label,t.append(e)}}}}_renderResolutionInfo(t){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",t.width),this._optGotRsl.setAttribute("data-height",t.height),this._optGotRsl.innerText="got "+t.width+"x"+t.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"));{let e=this.UIElement;e=(null==e?void 0:e.shadowRoot)||e;let i=null==e?void 0:e.querySelector(".dce-mn-resolution-box");if(i){let e="";if(t&&t.width&&t.height){let i=Math.max(t.width,t.height),n=Math.min(t.width,t.height);e=n<=1080?n+"P":i<3e3?"2K":Math.round(i/1e3)+"K"}i.textContent=e}}}getVideoElement(){return Ze(this,mn,"f")}isVideoLoaded(){return!(!Ze(this,mn,"f")||!this.cameraEnhancer)&&this.cameraEnhancer.isOpen()}setVideoFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);if(this.videoFit=t,!Ze(this,mn,"f"))return;if(Ze(this,mn,"f").style.objectFit=t,Ze(this,un,"m",_n).call(this))return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}Ze(this,un,"m",Dn).call(this,e,this.getConvertedRegion()),this.updateDrawingLayers(e)}getVideoFit(){return this.videoFit}getContentDimensions(){var t,e,i,n;let s,o,r;if(Ze(this,un,"m",_n).call(this)?(s=null===(i=this._cvsSingleFrameMode)||void 0===i?void 0:i.width,o=null===(n=this._cvsSingleFrameMode)||void 0===n?void 0:n.height,r="contain"):(s=null===(t=Ze(this,mn,"f"))||void 0===t?void 0:t.videoWidth,o=null===(e=Ze(this,mn,"f"))||void 0===e?void 0:e.videoHeight,r=this.getVideoFit()),!s||!o)throw new Error("Invalid content dimensions.");return{width:s,height:o,objectFit:r}}updateConvertedRegion(t){const e=Hi.convert(this.scanRegion,t.width,t.height);Je(this,vn,e),Ze(this,fn,"f")&&clearTimeout(Ze(this,fn,"f")),Je(this,fn,setTimeout((()=>{let t;try{t=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}Ze(this,un,"m",Tn).call(this,t,e),Ze(this,un,"m",Dn).call(this,t,e)}),0))}getConvertedRegion(){return Ze(this,vn,"f")}setScanRegion(t){if(null!=t&&!C(t)&&!A(t))throw TypeError("Invalid 'region'.");let e;this.scanRegion=t?JSON.parse(JSON.stringify(t)):null;try{e=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}this.updateConvertedRegion(e)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(t){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const e=Ze(this,mn,"f").videoWidth,i=Ze(this,mn,"f").videoHeight,n=this.getVideoFit(),{width:s,height:o}=this._innerComponent.getBoundingClientRect();if(s<=0||o<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let r;const a={x:0,y:0,width:e,height:i,isMeasuredInPercentage:!1};if("cover"===n&&(s/o<e/i?(r=o/i,a.x=Math.floor((e-s/r)/2),a.y=0,a.width=Math.ceil(s/r),a.height=i):(r=s/e,a.x=0,a.y=Math.floor((i-o/r)/2),a.width=e,a.height=Math.ceil(o/r))),null==t?void 0:t.inPixels)return a;const l=a;return l.x=Math.ceil(l.x/i*100),l.y=Math.ceil(l.y/e*100),l.width=Math.floor(l.width/e*100),l.height=Math.floor(l.height/i*100),l.isMeasuredInPercentage=!0,a}setScanRegionMask(t,e,i,n){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||Ze(this,un,"m",Pn).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=kn.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=kn.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const s=this._drawingLayerOfMask.width,o=this._drawingLayerOfMask.height,r=new Ti({x:0,y:0,width:s,height:o},this._maskBackRectStyleId),a=new Ti({x:-s/2,y:-o/2+e,width:t,height:n}),l=new Ti({x:-s/2+t+i,y:-o/2+e,width:s-t-i<0?0:s-t-i,height:n}),h=new Ti({x:-s/2,y:-o/2,width:s,height:e}),c=new Ti({x:-s/2,y:-o/2+e+n,width:s,height:o-e-n<0?0:o-e-n});a.set("strokeWidth",0),l.set("strokeWidth",0),h.set("strokeWidth",0),c.set("strokeWidth",0);const d=new Ni([a,l,h,c])._getFabricObject();r.set("clipPath",d);const u=new Ti({x:t,y:e,width:i,height:n},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([r,u])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(t){Je(this,yn,t),t?Ze(this,un,"m",En).call(this):Ze(this,un,"m",Pn).call(this)}setScanRegionMaskVisible(t){this._setScanRegionMaskVisible(t),this._userSetMaskVisible=t}isScanRegionMaskVisible(){return Ze(this,yn,"f")}setScanRegionMaskStyle(t){if(!t)return;let e;t.fillStyle&&(this.regionMaskFillStyle=t.fillStyle),t.strokeStyle&&(this.regionMaskStrokeStyle=t.strokeStyle),t.lineWidth&&(this.regionMaskLineWidth=t.lineWidth),this._maskBackRectStyleId&&kn.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&kn.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{e=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}Ze(this,un,"m",Tn).call(this,e,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(t){Je(this,xn,t),t?Ze(this,un,"m",An).call(this):Ze(this,un,"m",In).call(this)}setScanLaserVisible(t){this._setScanLaserVisible(t),this._userSetLaserVisible=t}isScanLaserVisible(){return Ze(this,xn,"f")}_updateVideoContainer(){if(!Ze(this,mn,"f"))return;if(Ze(this,un,"m",_n).call(this))return;let t=1;const e=Ze(this,mn,"f").style.transform.match(/scale\((.+)\)/);e&&(t=parseFloat(e[1]));const i=this._videoContainer;if("contain"===this.videoFit&&t>1){const t=Ze(this,mn,"f").videoWidth,e=Ze(this,mn,"f").videoHeight,{width:n,height:s}=this._innerComponent.getBoundingClientRect(),o=t/e;if(n/s<o){let t=n/o;i.style.left="0",i.style.top=(s-t)/2/s*100+"%",i.style.width="100%",i.style.height=t/s*100+"%"}else{let t=s*o;i.style.left=(n-t)/2/n*100+"%",i.style.top="0",i.style.width=t/n*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}updateLayers(){let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}const e=this.getConvertedRegion();Ze(this,un,"m",Dn).call(this,t,e),this.updateDrawingLayers(t),Ze(this,un,"m",Tn).call(this,t,e)}clearAllInnerDrawingItems(){Ze(this,Cn,"f").forEach((t=>t.remove())),Ze(this,Cn,"f").length=0}dispose(){this._unbindUI(),Je(this,Sn,!0)}};function Nn(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function Un(t,e,i,n,s){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}pn=new WeakMap,gn=new WeakMap,fn=new WeakMap,mn=new WeakMap,vn=new WeakMap,yn=new WeakMap,xn=new WeakMap,wn=new WeakMap,bn=new WeakMap,Cn=new WeakMap,Sn=new WeakMap,un=new WeakSet,_n=function(){return"disabled"!==this._singleFrameMode},Tn=function(t,e){!e||0===e.x&&0===e.y&&e.width===t.width&&e.height===t.height?this.clearScanRegionMask():this.setScanRegionMask(e.x,e.y,e.width,e.height)},En=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Pn=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},An=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},In=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Dn=function(t,e){if(!this._divScanArea)return;if(!this._innerComponent.getElement("content"))return;const{width:i,height:n,objectFit:s}=t;e||(e={x:0,y:0,width:i,height:n});const{width:o,height:r}=this._innerComponent.getBoundingClientRect();if(o<=0||r<=0)return;const a=o/r,l=i/n;let h,c,d,u,p=1;if("contain"===s)a<l?(p=o/i,h=0,c=(r-n*p)/2):(p=r/n,h=(o-i*p)/2,c=0),h+=e.x*p,c+=e.y*p,d=e.width*p,u=e.height*p;else if("cover"===s)if(a<l){p=r/n,h=e.x*p-(i*p-o)/2,h=Math.max(h,0),h=Math.min(h,o),c=e.y*p;let t=(e.x+e.width)*p-(i*p-o)/2;t=Math.max(t,0),t=Math.min(t,o),d=t-h,u=e.height*p}else{p=o/i,h=e.x*p,c=e.y*p-(n*p-r)/2,c=Math.max(c,0),c=Math.min(c,r);let t=(e.y+e.height)*p-(n*p-r)/2;t=Math.max(t,0),t=Math.min(t,r),d=e.width*p,u=t-c}else h=0,c=0,d=0,u=0;this._divScanArea.style.left=h+"px",this._divScanArea.style.top=c+"px",this._divScanArea.style.width=d+"px",this._divScanArea.style.height=u+"px"},Fn._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const Vn="undefined"==typeof self;let Wn,Hn,jn,zn,Gn;function Yn(t,e,i,n){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function $n(t,e,i,n,s){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}"undefined"!=typeof navigator&&(Wn=navigator,Hn=Wn.userAgent,jn=Wn.platform,zn=Wn.mediaDevices),function(){if(!Vn){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Wn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:jn,search:"Win"},Mac:{str:jn},Linux:{str:jn}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||Hn,r=s.search||e,a=s.verStr||Hn,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||Hn,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=Hn.indexOf("Windows NT")&&(s="HarmonyOS"),Gn={browser:i,version:n,OS:s}}Vn&&(Gn={browser:"ssr",version:0,OS:"ssr"})}(),zn&&zn.getUserMedia,"Chrome"===Gn.browser&&Gn.version>66||"Safari"===Gn.browser&&Gn.version>13||"OPR"===Gn.browser&&Gn.version>43||"Edge"===Gn.browser&&Gn.version,"function"==typeof SuppressedError&&SuppressedError;let Xn=class t{static multiply(t,e){const i=[];for(let n=0;n<3;n++){const s=e.slice(3*n,3*n+3);for(let e=0;e<3;e++){const n=[t[e],t[e+3],t[e+6]].reduce(((t,e,i)=>t+e*s[i]),0);i.push(n)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,i,n){return t.multiply(e,[1,0,0,0,1,0,i,n,1])}static rotate(e,i){var n=Math.cos(i),s=Math.sin(i);return t.multiply(e,[n,-s,0,s,n,0,0,0,1])}static scale(e,i,n){return t.multiply(e,[i,0,0,0,n,0,0,0,1])}};var qn,Zn,Jn,Kn,Qn,ts,es;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(qn||(qn={}));let is=class t{static get version(){return"1.1.3"}static get webGLSupported(){return void 0===t._webGLSupported&&(t._webGLSupported=!!document.createElement("canvas").getContext("webgl")),t._webGLSupported}get disposed(){return Yn(this,es,"f")}constructor(){Zn.set(this,qn.RGBA),Jn.set(this,null),Kn.set(this,null),Qn.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,ts.set(this,null),es.set(this,!1)}drawImage(e,i,n,s,o,r){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!n||!s)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if((null==r?void 0:r.bUseWebGL)&&!t.webGLSupported)throw new Error("Your browser or machine may not support WebGL.");if(i instanceof HTMLVideoElement&&4!==i.readyState||i instanceof HTMLImageElement&&!i.complete)throw new Error("The source is not loaded.");let a;t._onLog&&(a=Date.now(),t._onLog("drawImage(), START: "+a));let l=0,h=0,c=n,d=s,u=0,p=0,g=n,f=s;o&&(o.sx&&(l=Math.round(o.sx)),o.sy&&(h=Math.round(o.sy)),o.sWidth&&(c=Math.round(o.sWidth)),o.sHeight&&(d=Math.round(o.sHeight)),o.dx&&(u=Math.round(o.dx)),o.dy&&(p=Math.round(o.dy)),o.dWidth&&(g=Math.round(o.dWidth)),o.dHeight&&(f=Math.round(o.dHeight)));let m,v=qn.RGBA;if((null==r?void 0:r.pixelFormat)&&(v=r.pixelFormat),(null==r?void 0:r.bufferContainer)&&(m=r.bufferContainer,m.length<4*g*f))throw new Error("Unexpected size of the 'bufferContainer'.");const y=e;if(!t.webGLSupported||!(this.useWebGLByDefault&&null==(null==r?void 0:r.bUseWebGL)||(null==r?void 0:r.bUseWebGL))){t._onLog&&t._onLog("drawImage() in context2d."),y.ctx2d||(y.ctx2d=y.getContext("2d",{willReadFrequently:!0}));const e=y.ctx2d;if(!e)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(y.width<u+g||y.height<p+f)&&(y.width=u+g,y.height=p+f),e.drawImage(i,l,h,c,d,u,p,g,f),t._onLog&&t._onLog("drawImage() in context2d end. Costs: "+(Date.now()-a)),{context:e,pixelFormat:qn.RGBA,bUseWebGL:!1}}t._onLog&&t._onLog("drawImage() in WebGL.");try{(y.width<u+g||y.height<p+f)&&(y.width=u+g,y.height=p+f,y.ctxWebGL&&y.ctxWebGL.viewport(0,0,u+g,p+f));const e=y.ctxWebGL||y.getContext("webgl",{antialias:!1})||y.getContext("experimental-webgl",{antialias:!1});if(!e){t._onLog&&t._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const e=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw e.name="WebGLError",e}if(!y.ctxWebGL||v!==Yn(this,Zn,"f")){y.ctxWebGL=e;const t=t=>{const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW),{positions:e,texCoords:i}},i=t=>{const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},n=(t,e)=>{const i=t.createProgram();if(e.forEach((e=>t.attachShader(i,e))),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=new Error(`An error occured linking the program: ${t.getProgramInfoLog(i)}.`);throw e.name="WebGLError",e}return t.useProgram(i),i},s=(t,e,i)=>{const n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=new Error(`An error occured compiling the shader: ${t.getShaderInfoLog(n)}.`);throw e.name="WebGLError",e}return n},o="\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat3 u_matrix;\nuniform mat3 u_textureMatrix;\n\nvarying vec2 v_texCoord;\nvoid main(void) {\ngl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\nv_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n}";let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(v)&&(r=v.slice(0,3));const a=`\nprecision mediump float;\nvarying vec2 v_texCoord;\nuniform sampler2D u_image;\nuniform float uColorFactor;\n\nvoid main() {\nvec4 sample = texture2D(u_image, v_texCoord);\nfloat grey = 0.3 * sample.r + 0.59 * sample.g + 0.11 * sample.b;\ngl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n}`,l=n(e,[s(e,e.VERTEX_SHADER,o),s(e,e.FRAGMENT_SHADER,a)]);$n(this,Kn,{program:l,attribLocations:{vertexPosition:e.getAttribLocation(l,"a_position"),texPosition:e.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:e.getUniformLocation(l,"u_image"),uColorFactor:e.getUniformLocation(l,"uColorFactor"),uMatrix:e.getUniformLocation(l,"u_matrix"),uTextureMatrix:e.getUniformLocation(l,"u_textureMatrix")}}),$n(this,Qn,t(e)),$n(this,Jn,i(e)),$n(this,Zn,v)}const o=(t,e,i)=>{t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0)},r=(t,e,i)=>{const n=t.RGBA,s=t.RGBA,o=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n,s,o,i)},x=(t,e,i,r)=>{t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),o(t,i.positions,e.attribLocations.vertexPosition),o(t,i.texCoords,e.attribLocations.texPosition),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.uniform1i(e.uniformLocations.uSampler,0),t.uniform1f(e.uniformLocations.uColorFactor,[qn.GREY,qn.GREY32].includes(v)?1:0);let a,m,y=Xn.translate(Xn.identity(),-1,-1);y=Xn.scale(y,2,2),y=Xn.scale(y,1/t.canvas.width,1/t.canvas.height),a=Xn.translate(y,u,p),a=Xn.scale(a,g,f),t.uniformMatrix3fv(e.uniformLocations.uMatrix,!1,a),m=Xn.translate(Xn.identity(),l/n,h/s),m=Xn.scale(m,c/n,d/s),t.uniformMatrix3fv(e.uniformLocations.uTextureMatrix,!1,m),t.drawArrays(t.TRIANGLES,0,6)};r(e,Yn(this,Jn,"f"),i),x(e,Yn(this,Kn,"f"),Yn(this,Qn,"f"),Yn(this,Jn,"f"));const w=m||new Uint8Array(4*g*f);if(e.readPixels(u,p,g,f,e.RGBA,e.UNSIGNED_BYTE,w),255!==w[3]){t._onLog&&t._onLog("Incorrect WebGL drawing .");const e=new Error("WebGL error: incorrect drawing.");throw e.name="WebGLError",e}return t._onLog&&t._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-a)),{context:e,pixelFormat:v===qn.GREY?qn.GREY32:v,bUseWebGL:!0}}catch(a){if(this.forceLoseContext(),null==(null==r?void 0:r.bUseWebGL))return t._onLog&&t._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,i,n,s,o,Object.assign({},r,{bUseWebGL:!1}));throw a.name="WebGLError",a}}readCvsData(t,e,i){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let n,s=0,o=0,r=t.canvas.width,a=t.canvas.height;if(e&&(e.x&&(s=e.x),e.y&&(o=e.y),e.width&&(r=e.width),e.height&&(a=e.height)),(null==i?void 0:i.length)<4*r*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const e=t;i?(e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,4*r*a)):(n=new Uint8Array(4*r*a),e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,n))}else if(t instanceof CanvasRenderingContext2D){let e;e=t.getImageData(s,o,r,a),n=new Uint8Array(e.data.buffer),null==i||i.set(n)}return n}transformPixelFormat(e,i,n,s){let o,r;if(t._onLog&&(o=Date.now(),t._onLog("transformPixelFormat(), START: "+o)),i===n)return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-o)),s?new Uint8Array(e):e;const a=[qn.RGBA,qn.RBGA,qn.GRBA,qn.GBRA,qn.BRGA,qn.BGRA];if(a.includes(i))if(n===qn.GREY){r=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4){const i=.3*e[t]+.59*e[t+1]+.11*e[t+2];r[t/4]=i}}else if(n===qn.GREY32){r=s?new Uint8Array(e):e;for(let t=0;t<e.length;t+=4){const i=.3*e[t]+.59*e[t+1]+.11*e[t+2];r[t]=i,r[t+1]=i,r[t+2]=i}}else{if(!a.includes(n))throw new Error("Unable to transform.");if(s){r=new Uint8Array(e);const t=i.indexOf("r"),s=i.indexOf("g"),o=i.indexOf("b"),a=n.indexOf("r"),l=n.indexOf("g"),h=n.indexOf("b");for(let i=0;i<e.length;i+=4)r[i+a]=e[i+t],r[i+l]=e[i+s],r[i+h]=e[i+o]}else{r=e;const t=i.indexOf("r"),s=i.indexOf("g"),o=i.indexOf("b"),a=n.indexOf("r"),l=n.indexOf("g"),h=n.indexOf("b");for(let i=0;i<e.length;i+=4){let n=[e[i],e[i+1],e[i+2]];r[i+a]=n[t],r[i+l]=n[s],r[i+h]=n[o]}}}else if(i===qn.GREY){if(n!==qn.GREY32)throw new Error("Unable to transform.");r=new Uint8Array(4*e.length);for(let t=0;t<e.length;t++)r[4*t]=e[t],r[4*t+1]=e[t],r[4*t+2]=e[t],r[4*t+3]=255}else{if(i!==qn.GREY32)throw new Error("Unable to transform.");if(n!==qn.GREY)throw new Error("Unable to transform.");r=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4)r[t/4]=e[t]}return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-o)),r}getImageData(e,i,n){var s,o,r,a,l;if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let h,c;if(e instanceof HTMLImageElement)h=e.naturalWidth,c=e.naturalHeight;else if(e instanceof HTMLCanvasElement)h=e.width,c=e.height;else if(e instanceof HTMLVideoElement)h=e.videoWidth,c=e.videoHeight;else{if(!(e instanceof ImageBitmap))throw Error("The type of 'source' is not supported.");h=e.width,c=e.height}let d,u=t.webGLSupported&&this.useWebGLByDefault;if(i.sx<0||i.sy<0||i.sx+i.sWidth>h||i.sy+i.sHeight>c)throw new Error("Invalid position.");null===(s=t._onLog)||void 0===s||s.call(t,"getImageData(), START: "+(d=Date.now()));const p=Math.round(i.sx),g=Math.round(i.sy),f=Math.round(i.sWidth),m=Math.round(i.sHeight),v=Math.round(i.dWidth),y=Math.round(i.dHeight);let x,w=(null==n?void 0:n.pixelFormat)||qn.RGBA,b=null==n?void 0:n.bufferContainer;if(b&&(qn.GREY===w&&b.length<v*y||qn.RGBA===w&&b.length<v*y*4))throw new Error("Unexpected size of the 'bufferContainer'.");if(u){null===(o=t._onLog)||void 0===o||o.call(t,"getImageData() in WebGL.");let a,l=this._reusedWebGLCvs=this._reusedWebGLCvs||document.createElement("canvas");try{if(b)if(w===qn.GREY){if(x=new Uint8Array(4*v*y),a=this.drawImage(l,e,h,c,{sx:p,sy:g,sWidth:f,sHeight:m,dWidth:v,dHeight:y},{pixelFormat:w,bUseWebGL:!0,bufferContainer:x}),x=this.transformPixelFormat(x,a.pixelFormat,w),b){if(b.length<x.length)throw new Error("Unexpected size of the 'bufferContainer'.");b.set(x)}}else a=this.drawImage(l,e,h,c,{sx:p,sy:g,sWidth:f,sHeight:m,dWidth:v,dHeight:y},{pixelFormat:w,bUseWebGL:!0,bufferContainer:b}),x=new Uint8Array(b.buffer,0,4*v*y),x=this.transformPixelFormat(x,a.pixelFormat,w);else w===qn.GREY?((!Yn(this,ts,"f")||Yn(this,ts,"f").length<4*v*y)&&$n(this,ts,new Uint8Array(4*v*y)),x=new Uint8Array(Yn(this,ts,"f").buffer,0,4*v*y)):x=new Uint8Array(4*v*y),a=this.drawImage(l,e,h,c,{sx:p,sy:g,sWidth:f,sHeight:m,dWidth:v,dHeight:y},{pixelFormat:w,bUseWebGL:!0,bufferContainer:x}),x=this.transformPixelFormat(x,a.pixelFormat,w)}catch(s){if("WebGLError"===s.name)return this.forceLoseContext(),console.warn("WebGLError: "+(null==s?void 0:s.message)),null===(r=t._onLog)||void 0===r||r.call(t,"getImageData() in WebGL failed, try again in context2d."),t._webGLSupported=!1,this.getImageData(e,i,n);throw s}}else{null===(a=t._onLog)||void 0===a||a.call(t,"getImageData() in context2d.");let i=this._reusedCvs=this._reusedCvs||document.createElement("canvas");i.width!=v&&(i.width=v),i.height!=y&&(i.height=y);let n=i.getContext("2d");if(n.drawImage(e,p,g,f,f,0,0,v,y),x=new Uint8Array(n.getImageData(0,0,v,y).data.buffer),qn.GREY===w){let t=b||new Uint8Array(v*y);for(let e=0;e<x.length;e+=4)t[e/4]=Math.round((x[e]+x[e+1]+x[e+2])/3);x=t}else null==b||b.set(x)}return null===(l=t._onLog)||void 0===l||l.call(t,"getImageData() end. Costs: "+(Date.now()-d)),{data:x,pixelFormat:w,width:v,height:y,bUseWebGL:u}}convertDataToCvs(t,e,i,n){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof e||e<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const s=document.createElement("canvas");let o;if(s.width=e,s.height=i,n===qn.GREY){o=new Uint8ClampedArray(4*e*i);for(let e=0;e<o.length;e+=4)o[e]=t[e/4],o[e+1]=t[e/4],o[e+2]=t[e/4],o[e+3]=255}else o=new Uint8ClampedArray(t.buffer);const r=new ImageData(o,e,i);return s.getContext("2d").putImageData(r,0,0),s}forceLoseContext(){var t;if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&(null===(t=e.getExtension("WEBGL_lose_context"))||void 0===t||t.loseContext()),$n(this,Jn,null),$n(this,Kn,null),$n(this,Qn,null),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),$n(this,es,!0)}};var ns,ss,os,rs,as,ls,hs,cs,ds,us,ps,gs,fs,ms,vs,ys,xs,ws,bs,Cs,Ss,_s,Ts,Es,Ps,As,Is,Ds,ks,Rs,Ms,Ls,Os,Bs,Fs,Ns,Us,Vs,Ws,Hs,js,zs,Gs;Zn=new WeakMap,Jn=new WeakMap,Kn=new WeakMap,Qn=new WeakMap,ts=new WeakMap,es=new WeakMap;let Ys=class{constructor(){ns.set(this,new Map),ss.set(this,!1)}get disposed(){return Nn(this,ss,"f")}on(t,e){t=t.toLowerCase();const i=Nn(this,ns,"f").get(t);if(i){if(i.includes(e))return;i.push(e)}else Nn(this,ns,"f").set(t,[e])}off(t,e){t=t.toLowerCase();const i=Nn(this,ns,"f").get(t);if(!i)return;const n=i.indexOf(e);-1!==n&&i.splice(n,1)}offAll(t){t=t.toLowerCase();const e=Nn(this,ns,"f").get(t);e&&(e.length=0)}fire(t,e=[],i={async:!1,copy:!0}){e||(e=[]),t=t.toLowerCase();const n=Nn(this,ns,"f").get(t);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let s of n){if(!s)continue;let o=[];if(i.copy)for(let i of e){try{i=JSON.parse(JSON.stringify(i))}catch(t){}o.push(i)}else o=e;let r=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(s)&&s.apply(i.target,o)}),0);else try{r=s.apply(i.target,o)}catch(t){}if(!0===r)break}}}dispose(){Un(this,ss,!0)}};ns=new WeakMap,ss=new WeakMap;const $s=(t,e,i,n)=>{if(!i)return t;let s=e+Math.round((t-e)/i)*i;return n&&(s=Math.min(s,n)),s};let Xs=class t{static get version(){return"2.0.18"}static isStorageAvailable(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}static findBestRearCameraInIOS(t,e){if(!t||!t.length)return null;let i=!1;if((null==e?void 0:e.getMainCamera)&&(i=!0),i){const e=[" ","","","",""," "," "," ","   "," "," "," "," ","zadn fotoapart","zadn kamera","tylny aparat","takakamera","stranja kamera","rckkamera","kamera p baksidan","kamera belakang","kamera bak","hts kamera","fotocamera (posteriore)","cmera traseira","cmara traseira","cmara trasera","cmera posterior","camra arrire","camer spate","camera mt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=t.find((t=>e.includes(t.label.toLowerCase())));return null==i?void 0:i.deviceId}{const e=["","","","","","","","","","","","","zadn","zadn","tylny","trasera","traseira","taka","stranja","spate","sau","rck","posteriore","posterior","hts","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"],i=["","","","","","","","","","","","","","l","trjobiektywowy","trostruka","trojn","trojit","trippelt","trippel","tripl","triple","tripla","tiga","kolmois","ba camera"],n=[" ","","","",""," "," "," ","  "," "," "," "," ","ift geni","laajakulmainen kaksois","kp rng mt sau","ketts, szles ltszg","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka iroka","duln irokohl","dulna irokouhl","dupla grande-angular","dubl","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],s=t.filter((t=>{const i=t.label.toLowerCase();return e.some((t=>i.includes(t)))}));if(!s.length)return null;const o=s.find((t=>{const e=t.label.toLowerCase();return i.some((t=>e.includes(t)))}));if(o)return o.deviceId;const r=s.find((t=>{const e=t.label.toLowerCase();return n.some((t=>e.includes(t)))}));return r?r.deviceId:s[0].deviceId}}static findBestRearCamera(e,i){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(Gn.OS))return t.findBestRearCameraInIOS(e,{getMainCamera:null==i?void 0:i.getMainCameraInIOS});const n=["","","","","","","","","","","","","","","","","","zadn","zadn","tylny","trs","trasera","traseira","taka","stranja","spate","sau","rck","rear","posteriore","posterior","hts","darrere","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"];for(let t of e){const e=t.label.toLowerCase();if(e&&n.some((t=>e.includes(t)))&&/\b0(\b)?/.test(e))return t.deviceId}return["Android","HarmonyOS"].includes(Gn.OS)?e[e.length-1].deviceId:null}static findBestCamera(t,e,i){return t&&t.length?"environment"===e?this.findBestRearCamera(t,i):"user"===e?null:e?void 0:null:null}static async playVideo(t,e,i){if(!t)throw new Error("Invalid 'videoEl'.");if(!e)throw new Error("Invalid 'source'.");return new Promise((async(n,s)=>{let o;const r=()=>{t.removeEventListener("loadstart",c),t.removeEventListener("abort",d),t.removeEventListener("play",u),t.removeEventListener("error",p),t.removeEventListener("loadedmetadata",m)};let a=!1;const l=()=>{a=!0,o&&clearTimeout(o),r(),n(t)},h=t=>{o&&clearTimeout(o),r(),s(t)},c=()=>{t.addEventListener("abort",d,{once:!0})},d=()=>{const t=new Error("Video playing was interrupted.");t.name="AbortError",h(t)},u=()=>{l()},p=()=>{h(new Error(`Video error ${t.error.code}: ${t.error.message}.`))};let g;const f=new Promise((t=>{g=t})),m=()=>{g()};if(t.addEventListener("loadstart",c,{once:!0}),t.addEventListener("play",u,{once:!0}),t.addEventListener("error",p,{once:!0}),t.addEventListener("loadedmetadata",m,{once:!0}),"string"==typeof e||e instanceof String?t.src=e:t.srcObject=e,t.autoplay&&await new Promise((t=>{setTimeout(t,1e3)})),!a){i&&(o=setTimeout((()=>{r(),s(new Error("Failed to play video. Timeout."))}),i)),await f;try{await t.play(),l()}catch(t){console.warn("1st play error: "+((null==t?void 0:t.message)||t))}if(!a)try{await t.play(),l()}catch(t){console.warn("2rd play error: "+((null==t?void 0:t.message)||t)),h(t)}}}))}static async testCameraAccess(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let n;try{n=t?await navigator.mediaDevices.getUserMedia(t):await navigator.mediaDevices.getUserMedia({video:!0})}catch(t){return{ok:!1,errorName:t.name,errorMessage:t.message}}finally{null==n||n.getTracks().forEach((t=>{t.stop()}))}return{ok:!0}}get state(){if(!Nn(this,ys,"f"))return"closed";if("pending"===Nn(this,ys,"f"))return"opening";if("fulfilled"===Nn(this,ys,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?t.isStorageAvailable("localStorage")?Un(this,gs,!0):(Un(this,gs,!1),console.warn("Local storage is unavailable")):Un(this,gs,!1)}get ifSaveLastUsedCamera(){return Nn(this,gs,"f")}get isVideoPlaying(){return!(!Nn(this,as,"f")||Nn(this,as,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(t){var e,i,n;if(!(t instanceof HTMLElement)&&null!=t)throw new TypeError("Invalid 'element'.");null===(e=Nn(this,_s,"f"))||void 0===e||e.removeEventListener("click",Nn(this,Ss,"f")),null===(i=Nn(this,_s,"f"))||void 0===i||i.removeEventListener("touchend",Nn(this,Ss,"f")),null===(n=Nn(this,_s,"f"))||void 0===n||n.removeEventListener("touchmove",Nn(this,Cs,"f")),Un(this,_s,t),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)?(t.addEventListener("touchend",Nn(this,Ss,"f")),t.addEventListener("touchmove",Nn(this,Cs,"f"))):t.addEventListener("click",Nn(this,Ss,"f")))}get tapFocusEventBoundEl(){return Nn(this,_s,"f")}get disposed(){return Nn(this,Ms,"f")}constructor(e){var i,n;rs.add(this),as.set(this,null),ls.set(this,void 0),hs.set(this,(()=>{"opened"===this.state&&Nn(this,As,"f").fire("resumed",null,{target:this,async:!1})})),cs.set(this,(()=>{Nn(this,As,"f").fire("paused",null,{target:this,async:!1})})),ds.set(this,void 0),us.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],ps.set(this,void 0),gs.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,fs.set(this,void 0),ms.set(this,!0),vs.set(this,void 0),ys.set(this,void 0),xs.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},ws.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(t,e)=>{let i,n;const s=window.getComputedStyle(Nn(this,as,"f")).objectFit,o=this.getResolution(),r=Nn(this,as,"f").getBoundingClientRect(),a=r.left,l=r.top,{width:h,height:c}=Nn(this,as,"f").getBoundingClientRect();if(h<=0||c<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const d=h/c,u=o.width/o.height;let p=1;if("contain"===s)u>d?(p=h/o.width,i=(t-a)/p,n=(e-l-(c-h/u)/2)/p):(p=c/o.height,n=(e-l)/p,i=(t-a-(h-c*u)/2)/p);else{if("cover"!==s)throw new Error("Unsupported object-fit.");u>d?(p=c/o.height,n=(e-l)/p,i=(t-a+(c*u-h)/2)/p):(p=h/o.width,i=(t-a)/p,n=(e-l+(h/u-c)/2)/p)}return{x:i,y:n}},bs.set(this,!1),Cs.set(this,(()=>{Un(this,bs,!0)})),Ss.set(this,(async e=>{var i;if(Nn(this,bs,"f"))return void Un(this,bs,!1);if(!Nn(this,ws,"f"))return;if(!this.isVideoPlaying)return;if(!Nn(this,ls,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let n,s;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)n=e.clientX,s=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;n=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY}const o=this.getResolution(),r=2*Math.round(Math.min(o.width,o.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let a;try{a=this.calculateCoordInVideo(n,s)}catch(e){}if(a.x<0||a.x>o.width||a.y<0||a.y>o.height)return;const l={x:a.x+"px",y:a.y+"px"},h=r+"px",c=h;let d;t._onLog&&(d=Date.now());try{await Nn(this,rs,"m",js).call(this,l,h,c,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(e){if(t._onLog)throw t._onLog(e),e}t._onLog&&t._onLog(`Tap focus costs: ${Date.now()-d} ms`),this._focusParameters.taskBackToContinous=setTimeout((()=>{var e;t._onLog&&t._onLog("Back to continuous focus."),null===(e=Nn(this,ls,"f"))||void 0===e||e.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}))}),this._focusParameters.focusBackToContinousTime),Nn(this,As,"f").fire("tapfocus",null,{target:this,async:!1})})),_s.set(this,null),Ts.set(this,1),Es.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!Nn(this,as,"f"))return;const t=Nn(this,Ts,"f");if(t<1)throw new RangeError("Invalid scale value.");if(1===t)Nn(this,as,"f").style.transform="";else{const e=window.getComputedStyle(Nn(this,as,"f")).objectFit,i=Nn(this,as,"f").videoWidth,n=Nn(this,as,"f").videoHeight,{width:s,height:o}=Nn(this,as,"f").getBoundingClientRect();if(s<=0||o<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const r=s/o,a=i/n;let l=1;"contain"===e?l=r<a?s/(i/t):o/(n/t):"cover"===e&&(l=a>r?o/(i/t):s/(n/t));const h=l*(1-1/t)*(i/2-Nn(this,Es,"f").x),c=l*(1-1/t)*(n/2-Nn(this,Es,"f").y);Nn(this,as,"f").style.transform=`translate(${h}px, ${c}px) scale(${t})`}},Ps.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const t=document.createElement("canvas");let e;if(t.width=this.width,t.height=this.height,this.pixelFormat===qn.GREY){e=new Uint8ClampedArray(this.width*this.height*4);for(let t=0;t<e.length;t+=4)e[t]=this.data[t/4],e[t+1]=this.data[t/4],e[t+2]=this.data[t/4],e[t+3]=255}else e=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(e,this.width,this.height);return t.getContext("2d").putImageData(i,0,0),t})),As.set(this,void 0),Is.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Ds.set(this,new Map),ks.set(this,!1),Rs.set(this,(async()=>{var e,i;if("visible"===document.visibilityState){if(t._onLog&&t._onLog("document visible. video paused: "+(null===(e=Nn(this,as,"f"))||void 0===e?void 0:e.paused)),"opening"==this.state||"opened"==this.state){let i=!1;if(!this.isVideoPlaying){t._onLog&&t._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),i=!0}catch(e){t._onLog&&t._onLog("document visible. 1st resume video failed, try open instead.")}i||await Nn(this,rs,"m",Ns).call(this)}if(await new Promise((t=>setTimeout(t,300))),!this.isVideoPlaying){t._onLog&&t._onLog("document visible. 1st open failed. 2rd resume start."),i=!1;try{await this.resume(),i=!0}catch(e){t._onLog&&t._onLog("document visible. 2rd resume video failed, try open instead.")}i||await Nn(this,rs,"m",Ns).call(this)}}}else"hidden"===document.visibilityState&&(t._onLog&&t._onLog("document hidden. video paused: "+(null===(i=Nn(this,as,"f"))||void 0===i?void 0:i.paused)),"opening"==this.state||"opened"==this.state&&this.isVideoPlaying&&this.pause())})),Ms.set(this,!1),(null===(n=null===(i=null===window||void 0===window?void 0:window.navigator)||void 0===i?void 0:i.mediaDevices)||void 0===n?void 0:n.getUserMedia)||setTimeout((()=>{t.onWarning&&t.onWarning("The browser is too old or the page is loaded from an insecure origin.")}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Un(this,As,new Ys),this.imageDataGetter=new is,document.addEventListener("visibilitychange",Nn(this,Rs,"f"))}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",Nn(this,hs,"f")),t.addEventListener("pause",Nn(this,cs,"f")),Un(this,as,t)}getVideoEl(){return Nn(this,as,"f")}releaseVideoEl(){var t,e;null===(t=Nn(this,as,"f"))||void 0===t||t.removeEventListener("play",Nn(this,hs,"f")),null===(e=Nn(this,as,"f"))||void 0===e||e.removeEventListener("pause",Nn(this,cs,"f")),Un(this,as,null)}isVideoLoaded(){return!!Nn(this,as,"f")&&4==Nn(this,as,"f").readyState}async open(){if(Nn(this,vs,"f")&&!Nn(this,ms,"f")){if("pending"===Nn(this,ys,"f"))return Nn(this,vs,"f");if("fulfilled"===Nn(this,ys,"f"))return}Nn(this,As,"f").fire("before:open",null,{target:this}),await Nn(this,rs,"m",Ns).call(this),Nn(this,As,"f").fire("played",null,{target:this,async:!1}),Nn(this,As,"f").fire("opened",null,{target:this,async:!1})}async close(){if("closed"===this.state)return;Nn(this,As,"f").fire("before:close",null,{target:this});const t=Nn(this,vs,"f");if(Nn(this,rs,"m",Vs).call(this),t&&"pending"===Nn(this,ys,"f")){try{await t}catch(t){}if(!1===Nn(this,ms,"f")){const t=new Error("'close()' was interrupted.");throw t.name="AbortError",t}}Un(this,vs,null),Un(this,ys,null),Nn(this,As,"f").fire("closed",null,{target:this,async:!1})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");Nn(this,as,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await Nn(this,as,"f").play()}async setCamera(t){if("string"!=typeof t)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof Nn(this,ds,"f").video&&(Nn(this,ds,"f").video={}),delete Nn(this,ds,"f").video.facingMode,Nn(this,ds,"f").video.deviceId={exact:t},!("closed"===this.state||this.videoSrc||"opening"===this.state&&Nn(this,ms,"f"))){Nn(this,As,"f").fire("before:camera:change",[],{target:this,async:!1}),await Nn(this,rs,"m",Us).call(this);try{this.resetSoftwareScale()}catch(t){}return Nn(this,us,"f")}}async switchToFrontCamera(t){if("object"!=typeof Nn(this,ds,"f").video&&(Nn(this,ds,"f").video={}),(null==t?void 0:t.resolution)&&(Nn(this,ds,"f").video.width={ideal:t.resolution.width},Nn(this,ds,"f").video.height={ideal:t.resolution.height}),delete Nn(this,ds,"f").video.deviceId,Nn(this,ds,"f").video.facingMode={exact:"user"},Un(this,ps,null),!("closed"===this.state||this.videoSrc||"opening"===this.state&&Nn(this,ms,"f"))){Nn(this,As,"f").fire("before:camera:change",[],{target:this,async:!1}),Nn(this,rs,"m",Us).call(this);try{this.resetSoftwareScale()}catch(t){}return Nn(this,us,"f")}}getCamera(){var t;if(Nn(this,us,"f"))return Nn(this,us,"f");{let e=(null===(t=Nn(this,ds,"f").video)||void 0===t?void 0:t.deviceId)||"";if(e){e=e.exact||e.ideal||e;for(let t of this._arrCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var i,n;if(!(null===(n=null===(i=null===window||void 0===window?void 0:window.navigator)||void 0===i?void 0:i.mediaDevices)||void 0===n?void 0:n.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;if(e){let t=await navigator.mediaDevices.getUserMedia({video:!0});s=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind)),t.getTracks().forEach((t=>{t.stop()}))}else s=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));const o=[],r=[];if(this._arrCameras)for(let t of this._arrCameras)t._checked&&r.push(t);for(let t=0;t<s.length;t++){let e,i=s[t];for(let t of r)if(i.deviceId==t.deviceId){e=t;break}e||(e={deviceId:i.deviceId,label:i.label?i.label:"camera "+t,_checked:!1}),e.deviceId&&o.push(e)}return this._arrCameras=o,t._onLog&&t._onLog(JSON.stringify(this._arrCameras)),o}async getCameras(){var t,e;if(!(null===(e=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===e?void 0:e.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(t,e,i){if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof Nn(this,ds,"f").video&&(Nn(this,ds,"f").video={}),i?(Nn(this,ds,"f").video.width={exact:t},Nn(this,ds,"f").video.height={exact:e}):(Nn(this,ds,"f").video.width={ideal:t},Nn(this,ds,"f").video.height={ideal:e}),"closed"===this.state||this.videoSrc||"opening"===this.state&&Nn(this,ms,"f"))return null;Nn(this,As,"f").fire("before:resolution:change",[],{target:this,async:!1}),await Nn(this,rs,"m",Us).call(this);try{this.resetSoftwareScale()}catch(t){}const n=this.getResolution();return{width:n.width,height:n.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&Nn(this,as,"f"))return{width:Nn(this,as,"f").videoWidth,height:Nn(this,as,"f").videoHeight};if(Nn(this,ls,"f")){const t=Nn(this,ls,"f").getSettings();return{width:t.width,height:t.height}}if(this.isVideoLoaded())return{width:Nn(this,as,"f").videoWidth,height:Nn(this,as,"f").videoHeight};{const t={width:0,height:0};let e=Nn(this,ds,"f").video.width||0,i=Nn(this,ds,"f").video.height||0;return e&&(t.width=e.exact||e.ideal||e),i&&(t.height=i.exact||i.ideal||i),t}}async getResolutions(t){var e,i,n,s,o,r,a,l,h,c,d;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let u="";const p=(t,e)=>{const i=Nn(this,Ds,"f").get(t);if(!i||!i.length)return!1;for(let t of i)if(t.width===e.width&&t.height===e.height)return!0;return!1};if(this._mediaStream){u=null===(d=Nn(this,us,"f"))||void 0===d?void 0:d.deviceId;let e=Nn(this,Ds,"f").get(u);if(e&&!t)return JSON.parse(JSON.stringify(e));e=[],Nn(this,Ds,"f").set(u,e),Un(this,xs,!0);try{for(let t of this.detectedResolutions){await Nn(this,ls,"f").applyConstraints({width:{ideal:t.width},height:{ideal:t.height}}),Nn(this,rs,"m",Os).call(this);const i=Nn(this,ls,"f").getSettings(),n={width:i.width,height:i.height};p(u,n)||e.push({width:n.width,height:n.height})}}catch(t){throw Nn(this,rs,"m",Vs).call(this),Un(this,xs,!1),t}try{await Nn(this,rs,"m",Ns).call(this)}catch(t){if("AbortError"===t.name)return e;throw t}finally{Un(this,xs,!1)}return e}{const e=async(t,e,i)=>{const n={video:{deviceId:{exact:t},width:{ideal:e},height:{ideal:i}}};let s=null;try{s=await navigator.mediaDevices.getUserMedia(n)}catch(t){return null}if(!s)return null;const o=s.getVideoTracks();let r=null;try{const t=o[0].getSettings();r={width:t.width,height:t.height}}catch(t){const e=document.createElement("video");e.srcObject=s,r={width:e.videoWidth,height:e.videoHeight},e.srcObject=null}return o.forEach((t=>{t.stop()})),r};let i=(null===(o=null===(s=null===(n=Nn(this,ds,"f"))||void 0===n?void 0:n.video)||void 0===s?void 0:s.deviceId)||void 0===o?void 0:o.exact)||(null===(l=null===(a=null===(r=Nn(this,ds,"f"))||void 0===r?void 0:r.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(c=null===(h=Nn(this,ds,"f"))||void 0===h?void 0:h.video)||void 0===c?void 0:c.deviceId);if(!i)return[];let d=Nn(this,Ds,"f").get(i);if(d&&!t)return JSON.parse(JSON.stringify(d));d=[],Nn(this,Ds,"f").set(i,d);for(let t of this.detectedResolutions){const n=await e(i,t.width,t.height);n&&!p(i,n)&&d.push({width:n.width,height:n.height})}return d}}async setMediaStreamConstraints(t,e){if(!(t=>{return null!==t&&"[object Object]"===(e=t,Object.prototype.toString.call(e));var e})(t))throw new TypeError("Invalid 'mediaStreamConstraints'.");Un(this,ds,JSON.parse(JSON.stringify(t))),Un(this,ps,null),e&&Nn(this,rs,"m",Us).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(Nn(this,ds,"f")))}resetMediaStreamConstraints(){Un(this,ds,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null)}getCameraCapabilities(){if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Nn(this,ls,"f").getCapabilities?Nn(this,ls,"f").getCapabilities():{}}getCameraSettings(){if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Nn(this,ls,"f").getSettings()}async turnOnTorch(){if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await Nn(this,ls,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await Nn(this,ls,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=$s(t,n.min,n.step,n.max)),await Nn(this,ls,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=$s(t,n.min,n.step,n.max)),await Nn(this,ls,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!n)throw Error("Not supported.");e&&(t<n.min?t=n.min:t>n.max&&(t=n.max));const s=this.getResolution();return await Nn(this,ls,"f").applyConstraints({width:{ideal:Math.max(s.width,s.height)},frameRate:t}),t}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(t,e){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),n=null==i?void 0:i.focusMode,s=null==i?void 0:i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof t.mode)throw TypeError("Invalid 'mode'.");const o=t.mode.toLowerCase();if(!n.includes(o))throw Error("Unsupported focus mode.");if("manual"===o){if(!s)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let i=t.distance;e&&(i<s.min?i=s.min:i>s.max&&(i=s.max),i=$s(i,s.min,s.step,s.max)),this._focusParameters.focusArea=null,await Nn(this,ls,"f").applyConstraints({advanced:[{focusMode:o,focusDistance:i}]})}else{if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const e=t.area.centerPoint;let i=t.area.width,n=t.area.height;if(!i||!n){const t=this.getResolution();i||(i=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:e.x,y:e.y},width:i,height:n},await Nn(this,rs,"m",js).call(this,e,i,n)}}}else this._focusParameters.focusArea=null,await Nn(this,ls,"f").applyConstraints({advanced:[{focusMode:o}]})}getFocus(){const t=this.getCameraSettings(),e=t.focusMode;return e?"manual"===e?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:e}:null}async enableTapToFocus(){Un(this,ws,!0)}disableTapToFocus(){Un(this,ws,!1)}isTapToFocusEnabled(){return Nn(this,ws,"f")}async setZoom(t){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if("number"!=typeof t.factor)throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");t.centerPoint?Nn(this,rs,"m",zs).call(this,t.centerPoint):this.resetScaleCenter();try{if(Nn(this,rs,"m",Gs).call(this,Nn(this,Es,"f"))){const e=await this.setHardwareScale(t.factor,!0);let i=this.getHardwareScale();1==i&&1!=e&&(i=e),t.factor>i?this.setSoftwareScale(t.factor/i):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(t.factor)}catch(e){const i=e.message||e;if("Not supported."!==i&&"Camera is not open."!==i)throw e;this.setSoftwareScale(t.factor)}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale()}catch(t){if("Camera is not open."!==(t.message||t))throw t}return{factor:t*Nn(this,Ts,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!Nn(this,ls,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=$s(t,n.min,n.step,n.max)),await Nn(this,ls,"f").applyConstraints({advanced:[{zoom:t}]}),t}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,e){if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");e&&Nn(this,rs,"m",zs).call(this,e),Un(this,Ts,t),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return Nn(this,Ts,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();Un(this,Es,{x:t.width/2,y:t.height/2})}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(Nn(this,xs,"f"))return null;const i=Date.now();t._onLog&&t._onLog("getFrameData() START: "+i);const n=Nn(this,as,"f").videoWidth,s=Nn(this,as,"f").videoHeight;let o={sx:0,sy:0,sWidth:n,sHeight:s,dWidth:n,dHeight:s};(null==e?void 0:e.position)&&(o=JSON.parse(JSON.stringify(e.position)));let r=qn.RGBA;(null==e?void 0:e.pixelFormat)&&(r=e.pixelFormat);let a=Nn(this,Ts,"f");(null==e?void 0:e.scale)&&(a=e.scale);let l=Nn(this,Es,"f");if(null==e?void 0:e.scaleCenter){if("string"!=typeof e.scaleCenter.x||"string"!=typeof e.scaleCenter.y)throw new Error("Invalid scale center.");let t=0,i=0;if(e.scaleCenter.x.endsWith("px"))t=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");t=parseFloat(e.scaleCenter.x)/100*n}if(e.scaleCenter.y.endsWith("px"))i=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(e.scaleCenter.y)/100*s}if(isNaN(t)||isNaN(i))throw new Error("Invalid scale center.");l.x=Math.round(t),l.y=Math.round(i)}let h=null;if((null==e?void 0:e.bufferContainer)&&(h=e.bufferContainer),0==n||0==s)return null;1!==a&&(o.sWidth=Math.round(o.sWidth/a),o.sHeight=Math.round(o.sHeight/a),o.sx=Math.round((1-1/a)*l.x+o.sx/a),o.sy=Math.round((1-1/a)*l.y+o.sy/a));const c=this.imageDataGetter.getImageData(Nn(this,as,"f"),o,{pixelFormat:r,bufferContainer:h});if(!c)return null;const d=Date.now();return t._onLog&&t._onLog("getFrameData() END: "+d),{data:c.data,width:c.width,height:c.height,pixelFormat:c.pixelFormat,timeSpent:d-i,timeStamp:d,toCanvas:Nn(this,Ps,"f")}}on(t,e){if(!Nn(this,Is,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);Nn(this,As,"f").on(t,e)}off(t,e){Nn(this,As,"f").off(t,e)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),Nn(this,As,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",Nn(this,Rs,"f")),Un(this,Ms,!0)}};var qs,Zs,Js,Ks,Qs,to,eo,io,no,so,oo,ro,ao,lo,ho,co,uo,po,go,fo,mo,vo,yo,xo,wo,bo,Co,So,_o,To,Eo,Po,Ao,Io,Do;as=new WeakMap,ls=new WeakMap,hs=new WeakMap,cs=new WeakMap,ds=new WeakMap,us=new WeakMap,ps=new WeakMap,gs=new WeakMap,fs=new WeakMap,ms=new WeakMap,vs=new WeakMap,ys=new WeakMap,xs=new WeakMap,ws=new WeakMap,bs=new WeakMap,Cs=new WeakMap,Ss=new WeakMap,_s=new WeakMap,Ts=new WeakMap,Es=new WeakMap,Ps=new WeakMap,As=new WeakMap,Is=new WeakMap,Ds=new WeakMap,ks=new WeakMap,Rs=new WeakMap,Ms=new WeakMap,rs=new WeakSet,Ls=async function(){const t=this.getMediaStreamConstraints();if("boolean"==typeof t.video&&(t.video={}),t.video.deviceId);else if(Nn(this,ps,"f"))delete t.video.facingMode,t.video.deviceId={exact:Nn(this,ps,"f")};else if(this.ifSaveLastUsedCamera&&Xs.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&i&&(t.video.width=e,t.video.height=i)}else if(this.ifSkipCameraInspection);else{const e=async t=>{let e=null;return"environment"===t&&["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)?(await this._getCameras(!1),Nn(this,rs,"m",Os).call(this),e=Xs.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):t||["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)||(await this._getCameras(!1),Nn(this,rs,"m",Os).call(this),e=Xs.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),e};let i=t.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const n=await e(i);n&&(delete t.video.facingMode,t.video.deviceId={exact:n})}return t},Os=function(){if(Nn(this,ms,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},Bs=async function(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;try{Xs._onLog&&Xs._onLog("======try getUserMedia========");let e=[0,500,1e3,2e3],i=null;const s=async t=>{for(let s of e){s&&(await new Promise((t=>setTimeout(t,s))),Nn(this,rs,"m",Os).call(this));try{Xs._onLog&&Xs._onLog("ask "+JSON.stringify(t)),n=await navigator.mediaDevices.getUserMedia(t),Nn(this,rs,"m",Os).call(this);break}catch(t){if("NotFoundError"===t.name||"NotAllowedError"===t.name||"AbortError"===t.name||"OverconstrainedError"===t.name)throw t;i=t,Xs._onLog&&Xs._onLog(t.message||t)}}};if(await s(t),n||"object"!=typeof t.video||(t.video.deviceId&&(delete t.video.deviceId,await s(t)),!n&&t.video.facingMode&&(delete t.video.facingMode,await s(t)),n||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,await s(t))),!n)throw i;return n}catch(t){throw null==n||n.getTracks().forEach((t=>{t.stop()})),"NotFoundError"===t.name&&(DOMException?t=new DOMException("No camera available, please use a device with an accessible camera.",t.name):(t=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),t}},Fs=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((t=>{t.stop()})),this._mediaStream=null),Un(this,ls,null)},Ns=async function(){Un(this,ms,!1);const t=Un(this,fs,Symbol());if(Nn(this,vs,"f")&&"pending"===Nn(this,ys,"f")){try{await Nn(this,vs,"f")}catch(t){}Nn(this,rs,"m",Os).call(this)}if(t!==Nn(this,fs,"f"))return;const e=Un(this,vs,(async()=>{Un(this,ys,"pending");try{if(this.videoSrc){if(!Nn(this,as,"f"))throw new Error("'videoEl' should be set.");await Xs.playVideo(Nn(this,as,"f"),this.videoSrc,this.cameraOpenTimeout),Nn(this,rs,"m",Os).call(this)}else{let t=await Nn(this,rs,"m",Ls).call(this);Nn(this,rs,"m",Fs).call(this);let e=await Nn(this,rs,"m",Bs).call(this,t);await this._getCameras(!1),Nn(this,rs,"m",Os).call(this);const i=()=>{const t=e.getVideoTracks();let i,n;if(t.length&&(i=t[0]),i){const t=i.getSettings();if(t)for(let e of this._arrCameras)if(t.deviceId===e.deviceId){e._checked=!0,e.label=i.label,n=e;break}}return n},n=Nn(this,ds,"f");if("object"==typeof n.video){let s=n.video.facingMode;if(s instanceof Array&&s.length&&(s=s[0]),"object"==typeof s&&(s=s.exact||s.ideal),!(Nn(this,ps,"f")||this.ifSaveLastUsedCamera&&Xs.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||n.video.deviceId)){const n=i(),o=Xs.findBestCamera(this._arrCameras,s,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});o&&o!=(null==n?void 0:n.deviceId)&&(e.getTracks().forEach((t=>{t.stop()})),t.video.deviceId={exact:o},e=await Nn(this,rs,"m",Bs).call(this,t),Nn(this,rs,"m",Os).call(this))}}const s=i();(null==s?void 0:s.deviceId)&&(Un(this,ps,s&&s.deviceId),this.ifSaveLastUsedCamera&&Xs.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",Nn(this,ps,"f")),"object"==typeof t.video&&t.video.width&&t.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(t.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(t.video.height))))),Nn(this,as,"f")&&(await Xs.playVideo(Nn(this,as,"f"),e,this.cameraOpenTimeout),Nn(this,rs,"m",Os).call(this)),this._mediaStream=e;const o=e.getVideoTracks();(null==o?void 0:o.length)&&Un(this,ls,o[0]),Un(this,us,s)}}catch(t){throw Nn(this,rs,"m",Vs).call(this),Un(this,ys,null),t}Un(this,ys,"fulfilled")})());return e},Us=async function(){var t;if("closed"===this.state||this.videoSrc)return;const e=null===(t=Nn(this,us,"f"))||void 0===t?void 0:t.deviceId,i=this.getResolution();await Nn(this,rs,"m",Ns).call(this);const n=this.getResolution();e&&e!==Nn(this,us,"f").deviceId&&Nn(this,As,"f").fire("camera:changed",[Nn(this,us,"f").deviceId,e],{target:this,async:!1}),i.width==n.width&&i.height==n.height||Nn(this,As,"f").fire("resolution:changed",[{width:n.width,height:n.height},{width:i.width,height:i.height}],{target:this,async:!1}),Nn(this,As,"f").fire("played",null,{target:this,async:!1})},Vs=function(){Nn(this,rs,"m",Fs).call(this),Un(this,us,null),Nn(this,as,"f")&&(Nn(this,as,"f").srcObject=null,this.videoSrc&&(Nn(this,as,"f").pause(),Nn(this,as,"f").currentTime=0)),Un(this,ms,!0);try{this.resetSoftwareScale()}catch(t){}},Ws=async function t(e,i){const n=t=>{if(!Nn(this,ls,"f")||!this.isVideoPlaying||t.focusTaskId!=this._focusParameters.curFocusTaskId){Nn(this,ls,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const e=new Error(`Focus task ${t.focusTaskId} canceled.`);throw e.name="DeprecatedTaskError",e}1===this._focusParameters.isDoingFocus&&Date.now()-t.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let s;i=$s(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await Nn(this,ls,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),s=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((t=>{setTimeout(t,s)})),n(e);let o=e.focusL-e.focusW/2,r=e.focusT-e.focusH/2,a=e.focusW,l=e.focusH;const h=this.getResolution();o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l),a>h.width&&(a=h.width),l>h.height&&(l=h.height),o<0?o=0:o+a>h.width&&(o=h.width-a),r<0?r=0:r+l>h.height&&(r=h.height-l);const c=4*h.width*h.height*this._focusParameters.defaultTempBufferContainerLenRatio,d=4*a*l;let u=this._focusParameters.tempBufferContainer;if(u){const t=u.length;c>t&&c>=d?u=new Uint8Array(c):d>t&&d>=c&&(u=new Uint8Array(d))}else u=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(c,d));if(!this.imageDataGetter.getImageData(Nn(this,as,"f"),{sx:o,sy:r,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:qn.RGBA,bufferContainer:u}))return Nn(this,rs,"m",t).call(this,e,i);const p=u;let g=0;for(let t=0,e=d-8;t<e;++t){let e=p[t]-p[t+8];++t;let i=p[t]-p[t+8];++t;let n=p[t]-p[t+8];++t,g+=e*e+i*i+n*n}return-g},Hs=async function t(e,i,n,s,o,r,a){let l;if(i=$s(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=$s(s,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r?r=$s(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(r=$s(Math.sqrt((i||this._focusParameters.fds.step)*(s||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await Nn(this,rs,"m",Ws).call(this,e,r)),a<=n&&a<=o?l=3:n<o&&n<a?l=1:o<n&&o<a&&(l=2),(s-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await Nn(this,ls,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await Nn(this,ls,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:s}]})),!0;if(1===l)return await Nn(this,rs,"m",t).call(this,e,i,n,r,a);if(2===l)return await Nn(this,rs,"m",t).call(this,e,r,a,s,o);if(3!==l)return n=await Nn(this,rs,"m",Ws).call(this,e,i),o=await Nn(this,rs,"m",Ws).call(this,e,s),await Nn(this,rs,"m",t).call(this,e,i,n,s,o);let h=$s(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),c=$s(Math.sqrt((s||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/h)<=Math.abs(1/this._focusParameters.oldDistance-1/c)){let l=await Nn(this,rs,"m",Ws).call(this,e,h);if(l<a)return await Nn(this,rs,"m",t).call(this,e,i,n,r,a,h,l);if(l==a)return await Nn(this,rs,"m",t).call(this,e,h,l,r,a);let d=await Nn(this,rs,"m",Ws).call(this,e,c);if(l>a&&a<d)return await Nn(this,rs,"m",t).call(this,e,h,l,c,d,r,a);if(a==d)return await Nn(this,rs,"m",t).call(this,e,r,a,c,d);if(a>d)return await Nn(this,rs,"m",t).call(this,e,r,a,s,o,c,d)}else{let l=await Nn(this,rs,"m",Ws).call(this,e,c);if(a>l)return await Nn(this,rs,"m",t).call(this,e,r,a,s,o,c,l);if(a==l)return await Nn(this,rs,"m",t).call(this,e,r,a,c,l);let d=await Nn(this,rs,"m",Ws).call(this,e,h);if(d>a&&a<l)return await Nn(this,rs,"m",t).call(this,e,h,d,c,l,r,a);if(d==a)return await Nn(this,rs,"m",t).call(this,e,h,d,r,a);if(d<a)return await Nn(this,rs,"m",t).call(this,e,i,n,r,a,h,d)}return!1},js=async function(t,e,i,n,s){var o;if(1==this._focusParameters.isDoingFocus)return!1;if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'centerPoint'.");if(!e||"string"!=typeof e)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const r=this.getResolution();let a=0,l=0;if(t.x.endsWith("px"))a=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(t.x)/100*r.width}if(t.y.endsWith("px"))l=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(t.y)/100*r.height}if(isNaN(a)||isNaN(l)||a<0||a>r.width||l<0||l>r.height)throw new Error("Invalid 'centerPoint'.");let h=0;if(e.endsWith("px"))h=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");h=parseFloat(e)/100*r.width}if(isNaN(h)||h<0)throw new Error("Invalid 'width'.");let c=0;if(i.endsWith("px"))c=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid 'height'.");c=parseFloat(i)/100*r.height}if(isNaN(c)||c<0)throw new Error("Invalid 'height'.");if(1!==Nn(this,Ts,"f")){const t=Nn(this,Ts,"f"),e=Nn(this,Es,"f");h/=t,c/=t,a=(1-1/t)*e.x+a/t,l=(1-1/t)*e.y+l/t}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(o=this.getCameraCapabilities())||void 0===o?void 0:o.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const d={focusL:a,focusT:l,focusW:h,focusH:c,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},u=async(t,e,i)=>{try{(null==e||e<this._focusParameters.fds.min)&&(e=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=$s(Math.sqrt(i*(e||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=$s(Math.sqrt((e||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=$s(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=await Nn(this,rs,"m",Ws).call(this,t,o),a=await Nn(this,rs,"m",Ws).call(this,t,s),l=await Nn(this,rs,"m",Ws).call(this,t,n);if(a>l&&l<r){const e=await Nn(this,rs,"m",Hs).call(this,t,s,a,o,r,n,l);return this._focusParameters.isDoingFocus=0,e}if(a<l&&a<r){let i=await Nn(this,rs,"m",Ws).call(this,t,e);const o=await Nn(this,rs,"m",Hs).call(this,t,e,i,n,l,s,a);return this._focusParameters.isDoingFocus=0,o}if(l>r&&a>r){let e=await Nn(this,rs,"m",Ws).call(this,t,i);const s=await Nn(this,rs,"m",Hs).call(this,t,n,l,i,e,o,r);return this._focusParameters.isDoingFocus=0,s}if(a==l&&l<r){const e=await Nn(this,rs,"m",Hs).call(this,t,s,a,n,l);return this._focusParameters.isDoingFocus=0,e}if(l==r&&a>l){const e=await Nn(this,rs,"m",Hs).call(this,t,n,l,o,r);return this._focusParameters.isDoingFocus=0,e}return u(t,e,i)}catch(t){if("DeprecatedTaskError"!==t.name)throw t}};return u(d,n,s)},zs=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'center'.");const e=this.getResolution();let i=0,n=0;if(t.x.endsWith("px"))i=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))n=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.y)/100*e.height}if(isNaN(i)||isNaN(n))throw new Error("Invalid scale center.");Un(this,Es,{x:i,y:n})},Gs=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},Xs.browserInfo=Gn,Xs.onWarning=null===(os=null===window||void 0===window?void 0:window.console)||void 0===os?void 0:os.warn;let ko=class t{constructor(t){qs.add(this),Zs.set(this,void 0),Js.set(this,0),Ks.set(this,void 0),Qs.set(this,0),to.set(this,!1),Je(this,Zs,t)}startCharging(){Ze(this,to,"f")||(t._onLog&&t._onLog("start charging."),Ze(this,qs,"m",io).call(this),Je(this,to,!0))}stopCharging(){Ze(this,Ks,"f")&&clearTimeout(Ze(this,Ks,"f")),Ze(this,to,"f")&&(t._onLog&&t._onLog("stop charging."),Je(this,Js,Date.now()-Ze(this,Qs,"f")),Je(this,to,!1))}};Zs=new WeakMap,Js=new WeakMap,Ks=new WeakMap,Qs=new WeakMap,to=new WeakMap,qs=new WeakSet,eo=function(){yt.cfd(1),ko._onLog&&ko._onLog("charge 1.")},io=function t(){0==Ze(this,Js,"f")&&Ze(this,qs,"m",eo).call(this),Je(this,Qs,Date.now()),Ze(this,Ks,"f")&&clearTimeout(Ze(this,Ks,"f")),Je(this,Ks,setTimeout((()=>{Je(this,Js,0),Ze(this,qs,"m",t).call(this)}),Ze(this,Zs,"f")-Ze(this,Js,"f")))};let Ro=class t{static beep(){if(!this.allowBeep)return;if(!this.beepSoundSource)return;let t,e=Date.now();if(!(e-Ze(this,no,"f",ro)<100)){if(Je(this,no,e,0,ro),Ze(this,no,"f",so).size&&(t=Ze(this,no,"f",so).values().next().value,this.beepSoundSource==t.src?(Ze(this,no,"f",so).delete(t),t.play()):t=null),!t)if(Ze(this,no,"f",oo).size<16){t=new Audio(this.beepSoundSource);let e=null,i=()=>{t.removeEventListener("loadedmetadata",i),t.play(),e=setTimeout((()=>{Ze(this,no,"f",oo).delete(t)}),2e3*t.duration)};t.addEventListener("loadedmetadata",i),t.addEventListener("ended",(()=>{null!=e&&(clearTimeout(e),e=null),t.pause(),t.currentTime=0,Ze(this,no,"f",oo).delete(t),Ze(this,no,"f",so).add(t)}))}else Ze(this,no,"f",ao)||(Je(this,no,!0,0,ao),console.warn("The requested audio tracks exceed 16 and will not be played."));t&&Ze(this,no,"f",oo).add(t)}}static vibrate(){if(this.allowVibrate){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(t.vibrateDuration)}}};no=Ro,so={value:new Set},oo={value:new Set},ro={value:0},ao={value:!1},Ro.allowBeep=!0,Ro.beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Ro.allowVibrate=!0,Ro.vibrateDuration=300;const Mo=new Map([[qn.GREY,a.IPF_GRAYSCALED],[qn.RGBA,a.IPF_ABGR_8888]]),Lo="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_ONED:"0x003007FF",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000"};let Oo=class t extends J{static set _onLog(e){Je(t,ho,e,0,co),Xs._onLog=e,ko._onLog=e}static get _onLog(){return Ze(t,ho,"f",co)}static async detectEnvironment(){return await(async()=>({wasm:Ke,worker:Qe,getUserMedia:ti,camera:await ei(),browser:Xe.browser,version:Xe.version,OS:Xe.OS}))()}static async testCameraAccess(){const t=await Xs.testCameraAccess();return t.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===t.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===t.errorName||"NotFoundError"===t.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===t.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===t.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===t.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===t.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:t.errorMessage}}static async createInstance(e){var i,n;if(e&&!(e instanceof Fn))throw new TypeError("Invalid view.");if(null===(i=gt.license)||void 0===i?void 0:i.LicenseManager){if(!(null===(n=gt.license)||void 0===n?void 0:n.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await yt.loadWasm(["license"]),await gt.license.dynamsoft()}const s=new t(e);return t.onWarning&&(location&&"file:"===location.protocol?setTimeout((()=>{t.onWarning&&t.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})}),0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout((()=>{t.onWarning&&t.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})}),0)),s}get video(){return this.cameraManager.getVideoEl()}set videoSrc(t){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraView&&(this.cameraView._hideDefaultSelection=!0),this.cameraManager.videoSrc=t}get videoSrc(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.videoSrc}set ifSaveLastUsedCamera(t){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSaveLastUsedCamera=t}get ifSaveLastUsedCamera(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.ifSaveLastUsedCamera}set ifSkipCameraInspection(t){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSkipCameraInspection=t}get ifSkipCameraInspection(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.ifSkipCameraInspection}set cameraOpenTimeout(t){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.cameraOpenTimeout=t}get cameraOpenTimeout(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.cameraOpenTimeout}set singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Je(this,go,t)}get singleFrameMode(){return Ze(this,go,"f")}get _isFetchingStarted(){return Ze(this,wo,"f")}get disposed(){return Ze(this,To,"f")}constructor(e){if(super(),lo.add(this),uo.set(this,"closed"),po.set(this,void 0),this.isTorchOn=void 0,go.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&await this.selectCamera(this.cameraView._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen())return;if(!this.cameraView||this.cameraView.disposed)return;let t,e;if(this.cameraView._selRsl&&-1!=this.cameraView._selRsl.selectedIndex){let i=this.cameraView._selRsl.options[this.cameraView._selRsl.selectedIndex];t=parseInt(i.getAttribute("data-width")),e=parseInt(i.getAttribute("data-height"))}await this.setResolution({width:t,height:e})},this._onCloseBtnClick=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&this.close()},fo.set(this,((t,e,i,n)=>{const s=Date.now(),o={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},r=Math.max(o.dWidth,o.dHeight);if(this.canvasSizeLimit&&r>this.canvasSizeLimit){const t=this.canvasSizeLimit/r;o.dWidth>o.dHeight?(o.dWidth=this.canvasSizeLimit,o.dHeight=Math.round(o.dHeight*t)):(o.dWidth=Math.round(o.dWidth*t),o.dHeight=this.canvasSizeLimit)}const l=this.cameraManager.imageDataGetter.getImageData(t,o,{pixelFormat:this.getPixelFormat()===a.IPF_GRAYSCALED?qn.GREY:qn.RGBA});let h=null;if(l){const t=Date.now();let r;r=l.pixelFormat===qn.GREY?l.width:4*l.width;let a=!0;0===o.sx&&0===o.sy&&o.sWidth===e&&o.sHeight===i&&(a=!1),h={bytes:l.data,width:l.width,height:l.height,stride:r,format:Mo.get(l.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_t.ITT_FILE_IMAGE,isCropped:a,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:e,originalHeight:i,currentWidth:l.width,currentHeight:l.height,timeSpent:t-s,timeStamp:t},toCanvas:Ze(this,mo,"f"),isDCEFrame:!0}}return h})),this._onSingleFrameAcquired=t=>{let e;e=this.cameraView?this.cameraView.getConvertedRegion():Hi.convert(Ze(this,yo,"f"),t.width,t.height),e||(e={x:0,y:0,width:t.width,height:t.height});const i=Ze(this,fo,"f").call(this,t,t.width,t.height,e);Ze(this,po,"f").fire("singleFrameAcquired",[i],{async:!1,copy:!1})},mo.set(this,(function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const t=document.createElement("canvas");let e;if(t.width=this.width,t.height=this.height,this.format===a.IPF_GRAYSCALED){e=new Uint8ClampedArray(this.width*this.height*4);for(let t=0;t<e.length;t+=4)e[t]=this.bytes[t/4],e[t+1]=this.bytes[t/4],e[t+2]=this.bytes[t/4],e[t+3]=255}else e=new Uint8ClampedArray(this.bytes.buffer);return t.getContext("2d").putImageData(new ImageData(e,this.width,this.height),0,0),t})),vo.set(this,void 0),yo.set(this,void 0),xo.set(this,a.IPF_ABGR_8888),wo.set(this,!1),this._imageId=-1,bo.set(this,void 0),this.fetchInterval=0,Co.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),So.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),_o.set(this,void 0),To.set(this,!1),this.isCameraEnhancer=!0,this._taskid4AutoTorch=null,this._delay4AutoTorch=250,this.grayThreshold4AutoTorch=20,this.maxDarkCount4AutoTroch=3,e&&!(e instanceof Fn))throw new TypeError("Invalid view.");Je(this,po,new Gi),this.cameraManager=new Xs,this._imageDataGetter=this.cameraManager.imageDataGetter,this.cameraManager.updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const t=this.cameraManager.getSoftwareScale();if(t<1)throw new RangeError("Invalid scale value.");this.cameraView&&!this.cameraView.disposed?(this.video.style.transform=1===t?"":`scale(${t})`,this.cameraView._updateVideoContainer()):this.video.style.transform=1===t?"":`scale(${t})`},["iPhone","iPad","Android","HarmonyOS"].includes(Xe.OS)?this.cameraManager.setResolution(1280,720):this.cameraManager.setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&(this.setCameraView(e),e.cameraEnhancer=this),this._on("before:camera:change",(()=>{Ze(this,_o,"f").stopCharging();const t=this.cameraView;t&&!t.disposed&&(t._startLoading(),t.clearAllInnerDrawingItems())})),this._on("camera:changed",(()=>{this.clearBuffer()})),this._on("before:resolution:change",(()=>{const t=this.cameraView;t&&!t.disposed&&(t._startLoading(),t.clearAllInnerDrawingItems())})),this._on("resolution:changed",(()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})})),this._on("paused",(()=>{Ze(this,_o,"f").stopCharging();const t=this.cameraView;t&&t.disposed})),this._on("resumed",(()=>{const t=this.cameraView;t&&t.disposed})),this._on("tapfocus",(()=>{Ze(this,Co,"f").tapToFocus&&Ze(this,_o,"f").startCharging()})),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(e,i)=>{var n,s,o,r;if(Ze(this,lo,"m",Eo).call(this)||!this.isOpen()||this.isPaused())return;const a=e.intermediateResultUnits;t._onLog&&(t._onLog("intermediateResultUnits:"),t._onLog(a));let l=!1,h=!1;for(let t of a){if(t.unitType===At.IRUT_DECODED_BARCODES&&t.decodedBarcodes.length){l=!0;break}t.unitType===At.IRUT_LOCALIZED_BARCODES&&t.localizedBarcodes.length&&(h=!0)}if(t._onLog&&(t._onLog("hasLocalizedBarcodes:"),t._onLog(h)),Ze(this,Co,"f").autoZoom||Ze(this,Co,"f").enhancedFocus)if(l)Ze(this,So,"f").autoZoomInFrameArray.length=0,Ze(this,So,"f").autoZoomOutFrameCount=0,Ze(this,So,"f").frameArrayInIdealZoom.length=0,Ze(this,So,"f").autoFocusFrameArray.length=0;else{const i=async t=>{await this.setZoom(t),Ze(this,Co,"f").autoZoom&&Ze(this,_o,"f").startCharging()},l=async t=>{await this.setFocus(t),Ze(this,Co,"f").enhancedFocus&&Ze(this,_o,"f").startCharging()};if(h){const h=a[0].originalImageTag,c=(null===(n=h.cropRegion)||void 0===n?void 0:n.left)||0,d=(null===(s=h.cropRegion)||void 0===s?void 0:s.top)||0,u=(null===(o=h.cropRegion)||void 0===o?void 0:o.right)?h.cropRegion.right-c:h.originalWidth,p=(null===(r=h.cropRegion)||void 0===r?void 0:r.bottom)?h.cropRegion.bottom-d:h.originalHeight,g=h.currentWidth,f=h.currentHeight;let m;{let e,i,n,s,o;{const t=this.video.videoWidth*(1-Ze(this,So,"f").autoZoomDetectionArea)/2,e=this.video.videoWidth*(1+Ze(this,So,"f").autoZoomDetectionArea)/2,i=e,n=t,s=this.video.videoHeight*(1-Ze(this,So,"f").autoZoomDetectionArea)/2,r=s,a=this.video.videoHeight*(1+Ze(this,So,"f").autoZoomDetectionArea)/2;o=[{x:t,y:s},{x:e,y:r},{x:i,y:a},{x:n,y:a}]}t._onLog&&(t._onLog("detectionArea:"),t._onLog(o));const r=[];{const e=(t,e)=>{const i=(t,e)=>{if(!t&&!e)throw new Error("Invalid arguments.");return function(t,e,i){let n=!1;const s=t.length;if(s<=2)return!1;for(let o=0;o<s;o++){const r=t[o],a=t[(o+1)%s];if(Yi(r,a,{x:e,y:i}))return!0;$i(r.y-i)>0!=$i(a.y-i)>0&&$i(e-(i-r.y)*(r.x-a.x)/(r.y-a.y)-r.x)<0&&(n=!n)}return n}(e,t.x,t.y)},n=(t,e)=>!!(Xi([t[0],t[1]],[t[2],t[3]],[e[0].x,e[0].y],[e[1].x,e[1].y])||Xi([t[0],t[1]],[t[2],t[3]],[e[1].x,e[1].y],[e[2].x,e[2].y])||Xi([t[0],t[1]],[t[2],t[3]],[e[2].x,e[2].y],[e[3].x,e[3].y])||Xi([t[0],t[1]],[t[2],t[3]],[e[3].x,e[3].y],[e[0].x,e[0].y]));return!!(i({x:t[0].x,y:t[0].y},e)||i({x:t[1].x,y:t[1].y},e)||i({x:t[2].x,y:t[2].y},e)||i({x:t[3].x,y:t[3].y},e))||!!(i({x:e[0].x,y:e[0].y},t)||i({x:e[1].x,y:e[1].y},t)||i({x:e[2].x,y:e[2].y},t)||i({x:e[3].x,y:e[3].y},t))||!!(n([e[0].x,e[0].y,e[1].x,e[1].y],t)||n([e[1].x,e[1].y,e[2].x,e[2].y],t)||n([e[2].x,e[2].y,e[3].x,e[3].y],t)||n([e[3].x,e[3].y,e[0].x,e[0].y],t))};for(let t of a)if(t.unitType===At.IRUT_LOCALIZED_BARCODES)for(let i of t.localizedBarcodes){if(!i)continue;const t=i.location.points;t.forEach((t=>{Fn._transformCoordinates(t,c,d,u,p,g,f)})),e(o,t)&&r.push(i)}if(t._debug&&this.cameraView){const t=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99));t.clearDrawingItems();const e=this.__styleId2||(this.__styleId2=kn.createDrawingStyle({strokeStyle:"red"}));for(let i of a)if(i.unitType===At.IRUT_LOCALIZED_BARCODES)for(let n of i.localizedBarcodes){if(!n)continue;const i=n.location.points,s=new Di({points:i},e);t.addDrawingItems([s])}}}if(t._onLog&&(t._onLog("intersectedResults:"),t._onLog(r)),!r.length)return;let l;if(r.length){let t=r.filter((t=>t.possibleFormats==Lo.BF_QR_CODE||t.possibleFormats==Lo.BF_DATAMATRIX));if(t.length||(t=r.filter((t=>t.possibleFormats==Lo.BF_ONED)),t.length||(t=r)),t.length){const e=t=>{const e=t.location.points,i=(e[0].x+e[1].x+e[2].x+e[3].x)/4,n=(e[0].y+e[1].y+e[2].y+e[3].y)/4;return(i-g/2)*(i-g/2)+(n-f/2)*(n-f/2)};l=t[0];let i=e(l);if(1!=t.length)for(let n=1;n<t.length;n++){const s=e(t[n]);(t[n].confidence>1.1*l.confidence||t[n].confidence>.9*l.confidence&&s<i)&&(l=t[n],i=s)}}}if(t._onLog&&(t._onLog("highPriorityResult:"),t._onLog(l)),l){const t=l.location.points;e=Math.min(t[0].x,t[1].x,t[2].x,t[3].x),i=Math.max(t[0].x,t[1].x,t[2].x,t[3].x),n=Math.min(t[0].y,t[1].y,t[2].y,t[3].y),s=Math.max(t[0].y,t[1].y,t[2].y,t[3].y),m={points:[{x:e,y:n},{x:i,y:n},{x:i,y:s},{x:e,y:s}],result:l}}}if(t._onLog&&(t._onLog("boundingRect:"),t._onLog(m)),!m)return;if(t._debug&&this.cameraView&&(null==m?void 0:m.points)){const t=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99)),e=this.__styleId1||(this.__styleId1=kn.createDrawingStyle({strokeStyle:"blue"})),i=new Di({points:m.points},e);t.addDrawingItems([i])}if(Ze(this,So,"f").autoZoomOutFrameCount=0,Ze(this,Co,"f").autoZoom){const t=Ze(this,So,"f").autoZoomIdealArea[1];let n=(1-Ze(this,So,"f").autoZoomTargetBorder)/2;const s=m.points[0].x/u,o=(u-m.points[2].x)/u,r=m.points[0].y/p,a=(p-m.points[2].y)/p;if(s>t&&o>t&&r>t&&a>t&&m.result.moduleSize<Ze(this,So,"f").autoZoomInIdealModuleSize){if(Ze(this,So,"f").autoZoomInFrameArray.push(!0),Ze(this,So,"f").autoZoomInFrameArray.splice(0,Ze(this,So,"f").autoZoomInFrameArray.length-Ze(this,So,"f").autoZoomInFrameLimit[0]),Ze(this,So,"f").frameArrayInIdealZoom.length=0,Ze(this,Co,"f").enhancedFocus&&l({mode:"continuous"}).catch((()=>{})),Ze(this,So,"f").autoZoomInFrameArray.filter((t=>!0===t)).length>=Ze(this,So,"f").autoZoomInFrameLimit[1]){Ze(this,So,"f").autoZoomInFrameArray.length=0;const t=[(.5-n)/(.5-s),(.5-n)/(.5-o),(.5-n)/(.5-r),(.5-n)/(.5-a)].filter((t=>t>0)),l=Math.min(...t,Ze(this,So,"f").autoZoomInIdealModuleSize/m.result.moduleSize),h=this.getZoomSettings().factor;let c=Math.max(Math.pow(h*l,1/Ze(this,So,"f").autoZoomInMaxTimes),Ze(this,So,"f").autoZoomInMinStep);c=Math.min(c,l);let d=h*c;d=Math.max(Ze(this,So,"f").minValue,d),d=Math.min(Ze(this,So,"f").maxValue,d);try{await i({factor:d})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else if(Ze(this,So,"f").autoZoomInFrameArray.length=0,Ze(this,So,"f").frameArrayInIdealZoom.push(!0),Ze(this,So,"f").frameArrayInIdealZoom.splice(0,Ze(this,So,"f").frameArrayInIdealZoom.length-Ze(this,So,"f").frameLimitInIdealZoom[0]),Ze(this,So,"f").frameArrayInIdealZoom.filter((t=>!0===t)).length>=Ze(this,So,"f").frameLimitInIdealZoom[1]&&(Ze(this,So,"f").frameArrayInIdealZoom.length=0,Ze(this,Co,"f").enhancedFocus)){const t=m.points;try{await l({mode:"manual",area:{centerPoint:{x:(t[0].x+t[2].x)/2+"px",y:(t[0].y+t[2].y)/2+"px"},width:t[2].x-t[0].x+"px",height:t[2].y-t[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}if(!Ze(this,Co,"f").autoZoom&&Ze(this,Co,"f").enhancedFocus&&(Ze(this,So,"f").autoFocusFrameArray.push(!0),Ze(this,So,"f").autoFocusFrameArray.splice(0,Ze(this,So,"f").autoFocusFrameArray.length-Ze(this,So,"f").autoFocusFrameLimit[0]),Ze(this,So,"f").autoFocusFrameArray.filter((t=>!0===t)).length>=Ze(this,So,"f").autoFocusFrameLimit[1])){Ze(this,So,"f").autoFocusFrameArray.length=0;try{const t=m.points;await l({mode:"manual",area:{centerPoint:{x:(t[0].x+t[2].x)/2+"px",y:(t[0].y+t[2].y)/2+"px"},width:t[2].x-t[0].x+"px",height:t[2].y-t[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else{if(Ze(this,Co,"f").autoZoom){if(Ze(this,So,"f").autoZoomInFrameArray.push(!1),Ze(this,So,"f").autoZoomInFrameArray.splice(0,Ze(this,So,"f").autoZoomInFrameArray.length-Ze(this,So,"f").autoZoomInFrameLimit[0]),Ze(this,So,"f").autoZoomOutFrameCount++,Ze(this,So,"f").frameArrayInIdealZoom.push(!1),Ze(this,So,"f").frameArrayInIdealZoom.splice(0,Ze(this,So,"f").frameArrayInIdealZoom.length-Ze(this,So,"f").frameLimitInIdealZoom[0]),Ze(this,So,"f").autoZoomOutFrameCount>=Ze(this,So,"f").autoZoomOutFrameLimit){Ze(this,So,"f").autoZoomOutFrameCount=0;const t=this.getZoomSettings().factor;let n=t-Math.max((t-1)*Ze(this,So,"f").autoZoomOutStepRate,Ze(this,So,"f").autoZoomOutMinStep);n=Math.max(Ze(this,So,"f").minValue,n),n=Math.min(Ze(this,So,"f").maxValue,n);try{await i({factor:n})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}Ze(this,Co,"f").enhancedFocus&&l({mode:"continuous"}).catch((()=>{}))}!Ze(this,Co,"f").autoZoom&&Ze(this,Co,"f").enhancedFocus&&(Ze(this,So,"f").autoFocusFrameArray.length=0,l({mode:"continuous"}).catch((()=>{})))}}},Je(this,_o,new ko(1e4))}setCameraView(t){if(!(t instanceof Fn))throw new TypeError("Invalid view.");if(t.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),t._singleFrameMode=this.singleFrameMode,t._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(this.cameraView._hideDefaultSelection=!0),Ze(this,lo,"m",Eo).call(this)||this.cameraManager.setVideoEl(t.getVideoElement()),this.cameraView=t,this.addListenerToView()}getCameraView(){return this.cameraView}releaseCameraView(){this.cameraView&&(this.removeListenerFromView(),this.cameraView.disposed||(this.cameraView._singleFrameMode="disabled",this.cameraView._onSingleFrameAcquired=null,this.cameraView._hideDefaultSelection=!1),this.cameraManager.releaseVideoEl(),this.cameraView=null)}addListenerToView(){if(!this.cameraView)return;if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");const t=this.cameraView;Ze(this,lo,"m",Eo).call(this)||this.videoSrc||(t._innerComponent&&(this.cameraManager.tapFocusEventBoundEl=t._innerComponent),t._selCam&&t._selCam.addEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.addEventListener("change",this._onResolutionSelChange)),t._btnClose&&t._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!this.cameraView||this.cameraView.disposed)return;const t=this.cameraView;this.cameraManager.tapFocusEventBoundEl=null,t._selCam&&t._selCam.removeEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.removeEventListener("change",this._onResolutionSelChange),t._btnClose&&t._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return Ze(this,lo,"m",Eo).call(this)?Ze(this,uo,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(this.cameraManager.state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}async open(){const t=this.cameraView;if(null==t?void 0:t.disposed)throw new Error("'cameraView' has been disposed.");t&&(t._singleFrameMode=this.singleFrameMode,Ze(this,lo,"m",Eo).call(this)?t._clickIptSingleFrameMode():(this.cameraManager.setVideoEl(t.getVideoElement()),t._startLoading()));let e={width:0,height:0,deviceId:""};if(Ze(this,lo,"m",Eo).call(this));else{try{await this.cameraManager.open()}catch(e){throw t&&t._stopLoading(),"NotFoundError"===e.name?new Error(`No camera devices were detected. Please ensure a camera is connected and recognized by your system. ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`):"NotAllowedError"===e.name?new Error(`Camera access is blocked. Please check your browser settings or grant permission to use the camera. ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`):e}let i,n=t.getUIElement();if(n=n.shadowRoot||n,i=n.querySelector(".dce-macro-use-mobile-native-like-ui")){let t=n.elTorchAuto=n.querySelector(".dce-mn-torch-auto"),e=n.elTorchOn=n.querySelector(".dce-mn-torch-on"),s=n.elTorchOff=n.querySelector(".dce-mn-torch-off");t&&(e.style.display=null==this.isTorchOn?"":"none"),e&&(e.style.display=1==this.isTorchOn?"":"none"),s&&(s.style.display=0==this.isTorchOn?"":"none");let o=n.elBeepOn=n.querySelector(".dce-mn-beep-on"),r=n.elBeepOff=n.querySelector(".dce-mn-beep-off");o&&(o.style.display=Ro.allowBeep?"":"none"),r&&(r.style.display=Ro.allowBeep?"none":"");let a=n.elVibrateOn=n.querySelector(".dce-mn-vibrate-on"),l=n.elVibrateOff=n.querySelector(".dce-mn-vibrate-off");a&&(a.style.display=Ro.allowVibrate?"":"none"),l&&(l.style.display=Ro.allowVibrate?"none":""),n.elResolutionBox=n.querySelector(".dce-mn-resolution-box");let h,c=n.elZoom=n.querySelector(".dce-mn-zoom");c&&(c.style.display="none",h=n.elZoomSpan=c.querySelector("span"));let d=n.elToast=n.querySelector(".dce-mn-toast"),u=n.elCameraClose=n.querySelector(".dce-mn-camera-close"),p=n.elTakePhoto=n.querySelector(".dce-mn-take-photo"),g=n.elCameraSwitch=n.querySelector(".dce-mn-camera-switch"),f=n.elCameraAndResolutionSettings=n.querySelector(".dce-mn-camera-and-resolution-settings");f&&(f.style.display="none");const m=n.dceMnFs={},v=()=>{this.turnOnTorch()};null==t||t.addEventListener("pointerdown",v);const y=()=>{this.turnOffTorch()};null==e||e.addEventListener("pointerdown",y);const x=()=>{this.turnAutoTorch()};null==s||s.addEventListener("pointerdown",x);const w=()=>{Ro.allowBeep=!Ro.allowBeep,o&&(o.style.display=Ro.allowBeep?"":"none"),r&&(r.style.display=Ro.allowBeep?"none":"")};for(let t of[r,o])null==t||t.addEventListener("pointerdown",w);const b=()=>{Ro.allowVibrate=!Ro.allowVibrate,a&&(a.style.display=Ro.allowVibrate?"":"none"),l&&(l.style.display=Ro.allowVibrate?"none":"")};for(let t of[l,a])null==t||t.addEventListener("pointerdown",b);const C=async t=>{let e,i=t.target;if(e=i.closest(".dce-mn-camera-option"))this.selectCamera(e.getAttribute("data-davice-id"));else if(e=i.closest(".dce-mn-resolution-option")){let t,i=parseInt(e.getAttribute("data-width")),n=parseInt(e.getAttribute("data-height")),s=await this.setResolution({width:i,height:n});{let e=Math.max(s.width,s.height),i=Math.min(s.width,s.height);t=i<=1080?i+"P":e<3e3?"2K":Math.round(e/1e3)+"K"}t!=e.textContent&&T(`Fallback to ${t}`)}else i.closest(".dce-mn-camera-and-resolution-settings")||(i.closest(".dce-mn-resolution-box")?f&&(f.style.display=f.style.display?"":"none"):f&&""===f.style.display&&(f.style.display="none"))};n.addEventListener("click",C);let S=null;m.funcInfoZoomChange=(t,e=3e3)=>{c&&h&&(h.textContent=t.toFixed(1),c.style.display="",null!=S&&(clearTimeout(S),S=null),S=setTimeout((()=>{c.style.display="none",S=null}),e))};let _=null,T=m.funcShowToast=(t,e=3e3)=>{d&&(d.textContent=t,d.style.display="",null!=_&&(clearTimeout(_),_=null),_=setTimeout((()=>{d.style.display="none",_=null}),e))};const E=()=>{this.close()};null==u||u.addEventListener("click",E);const P=()=>{};null==p||p.addEventListener("pointerdown",P);const A=()=>{var t,e;let i,n=this.getVideoSettings(),s=n.video.facingMode,o=null===(e=null===(t=this.cameraManager.getCamera())||void 0===t?void 0:t.label)||void 0===e?void 0:e.toLowerCase(),r=null==o?void 0:o.indexOf("front");-1===r&&(r=null==o?void 0:o.indexOf(""));let a=null==o?void 0:o.indexOf("back");-1===a&&(a=null==o?void 0:o.indexOf("")),"number"==typeof r&&-1!==r?i=!0:"number"==typeof a&&-1!==a&&(i=!1),void 0===i&&(i="user"===((null==s?void 0:s.ideal)||(null==s?void 0:s.exact)||s)),n.video.facingMode={ideal:i?"environment":"user"},delete n.video.deviceId,this.updateVideoSettings(n)};null==g||g.addEventListener("pointerdown",A);let I=-1/0,D=1;const k=t=>{let e=Date.now();e-I>1e3&&(D=this.getZoomSettings().factor),D-=t.deltaY/200,D>20&&(D=20),D<1&&(D=1),this.setZoom({factor:D}),I=e};i.addEventListener("wheel",k);const R=new Map;let M=!1;const L=async t=>{var e;for(t.touches.length>=2&&"touchmove"==t.type&&t.preventDefault();t.changedTouches.length>1&&2==t.touches.length;){let i=t.touches[0],n=t.touches[1],s=R.get(i.identifier),o=R.get(n.identifier);if(!s||!o)break;let r=Math.pow(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2),.5),a=Math.pow(Math.pow(i.clientX-n.clientX,2)+Math.pow(i.clientY-n.clientY,2),.5),l=Date.now();if(M||l-I<100)return;l-I>1e3&&(D=this.getZoomSettings().factor),D*=a/r,D>20&&(D=20),D<1&&(D=1);let h=!1;"safari"==(null===(e=null==Xe?void 0:Xe.browser)||void 0===e?void 0:e.toLocaleLowerCase())&&(a/r>1&&D<2?(D=2,h=!0):a/r<1&&D<2&&(D=1,h=!0)),M=!0,h&&T("zooming..."),await this.setZoom({factor:D}),h&&(d.textContent=""),M=!1,I=Date.now();break}R.clear();for(let e of t.touches)R.set(e.identifier,{x:e.clientX,y:e.clientY})};n.addEventListener("touchstart",L),n.addEventListener("touchmove",L),n.addEventListener("touchend",L),n.addEventListener("touchcancel",L),m.unbind=()=>{null==t||t.removeEventListener("pointerdown",v),null==e||e.removeEventListener("pointerdown",y),null==s||s.removeEventListener("pointerdown",x);for(let t of[r,o])null==t||t.removeEventListener("pointerdown",w);for(let t of[l,a])null==t||t.removeEventListener("pointerdown",b);n.removeEventListener("click",C),null==u||u.removeEventListener("click",E),null==p||p.removeEventListener("pointerdown",P),null==g||g.removeEventListener("pointerdown",A),i.removeEventListener("wheel",k),n.removeEventListener("touchstart",L),n.removeEventListener("touchmove",L),n.removeEventListener("touchend",L),n.removeEventListener("touchcancel",L),delete n.dceMnFs,i.style.display="none"},i.style.display="",t&&null==this.isTorchOn&&setTimeout((()=>{this.turnAutoTorch(1e3)}),0)}this.isTorchOn&&this.turnOnTorch().catch((()=>{}));const s=this.getResolution();e.width=s.width,e.height=s.height,e.deviceId=this.getSelectedCamera().deviceId}return Je(this,uo,"open"),t&&(t._innerComponent.style.display="",Ze(this,lo,"m",Eo).call(this)||(t._stopLoading(),t._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),t._renderResolutionInfo({width:e.width,height:e.height}),t.eventHandler.fire("content:updated",null,{async:!1}),t.eventHandler.fire("videoEl:resized",null,{async:!1}))),Ze(this,po,"f").fire("opened",null,{target:this,async:!1}),e}close(){var t;const e=this.cameraView;if(null==e?void 0:e.disposed)throw new Error("'cameraView' has been disposed.");if(this.stopFetching(),this.clearBuffer(),Ze(this,lo,"m",Eo).call(this));else{this.cameraManager.close();let i=e.getUIElement();i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")&&(null===(t=i.dceMnFs)||void 0===t||t.unbind())}Je(this,uo,"closed"),Ze(this,_o,"f").stopCharging(),e&&(e._innerComponent.style.display="none",Ze(this,lo,"m",Eo).call(this)&&e._innerComponent.removeElement("content"),e._stopLoading()),Ze(this,po,"f").fire("closed",null,{target:this,async:!1})}pause(){if(Ze(this,lo,"m",Eo).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");this.cameraManager.pause()}isPaused(){var t;return!Ze(this,lo,"m",Eo).call(this)&&!0===(null===(t=this.video)||void 0===t?void 0:t.paused)}async resume(){if(Ze(this,lo,"m",Eo).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await this.cameraManager.resume()}async selectCamera(t){if(!t)throw new Error("Invalid value.");let e;e="string"==typeof t?t:t.deviceId,await this.cameraManager.setCamera(e),this.isTorchOn=!1;const i=this.getResolution(),n=this.cameraView;return n&&!n.disposed&&(n._stopLoading(),n._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),n._renderResolutionInfo({width:i.width,height:i.height})),{width:i.width,height:i.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return this.cameraManager.getCamera()}async getAllCameras(){return this.cameraManager.getCameras()}async setResolution(t){await this.cameraManager.setResolution(t.width,t.height),this.isTorchOn&&this.turnOnTorch().catch((()=>{}));const e=this.getResolution(),i=this.cameraView;return i&&!i.disposed&&(i._stopLoading(),i._renderResolutionInfo({width:e.width,height:e.height})),{width:e.width,height:e.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return this.cameraManager.getResolution()}getAvailableResolutions(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getResolutions()}_on(t,e){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?Ze(this,po,"f").on(t,e):this.cameraManager.on(t,e)}_off(t,e){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?Ze(this,po,"f").off(t,e):this.cameraManager.off(t,e)}on(t,e){const i=t.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._on(n,e)}off(t,e){const i=t.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._off(n,e)}getVideoSettings(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getMediaStreamConstraints()}async updateVideoSettings(t){var e;await(null===(e=this.cameraManager)||void 0===e?void 0:e.setMediaStreamConstraints(t,!0))}getCapabilities(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getCameraCapabilities()}getCameraSettings(){return this.cameraManager.getCameraSettings()}async turnOnTorch(){var t,e;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");try{await(null===(t=this.cameraManager)||void 0===t?void 0:t.turnOnTorch())}catch(t){let i=this.cameraView.getUIElement();throw i=i.shadowRoot||i,null===(e=null==i?void 0:i.dceMnFs)||void 0===e||e.funcShowToast("Torch Not Supported"),t}this.isTorchOn=!0;let i=this.cameraView.getUIElement();i=i.shadowRoot||i,i.elTorchAuto&&(i.elTorchAuto.style.display="none"),i.elTorchOn&&(i.elTorchOn.style.display=""),i.elTorchOff&&(i.elTorchOff.style.display="none")}async turnOffTorch(){var t;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.turnOffTorch()),this.isTorchOn=!1;let e=this.cameraView.getUIElement();e=e.shadowRoot||e,e.elTorchAuto&&(e.elTorchAuto.style.display="none"),e.elTorchOn&&(e.elTorchOn.style.display="none"),e.elTorchOff&&(e.elTorchOff.style.display="")}async turnAutoTorch(e=250){if(null!=this._taskid4AutoTorch){if(!(e<this._delay4AutoTorch))return;clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null}this._delay4AutoTorch=e;let i=!1,n=0,s=0;const o=async()=>{var e,o,r;if(this.disposed||i||null!=this.isTorchOn||!this.isOpen())return clearInterval(this._taskid4AutoTorch),void(this._taskid4AutoTorch=null);if(this.isPaused())return;if(++s>10&&this._delay4AutoTorch<1e3)return clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null,void this.turnAutoTorch(1e3);let l;try{l=this.fetchImage()}catch(e){}if(!l||!l.width||!l.height)return;let h=0;if(a.IPF_GRAYSCALED===l.format){for(let t=0;t<l.bytes.length;++t)h+=l.bytes[t];h/=l.bytes.length}else{if(a.IPF_ABGR_8888!==l.format)return;for(let t=0;t<l.bytes.length;t+=4)h+=l.bytes[t],h+=l.bytes[t+1],h+=l.bytes[t+2];h/=l.bytes.length/4*3}if(h<this.grayThreshold4AutoTorch){if(++n>=this.maxDarkCount4AutoTroch){null===(e=t._onLog)||void 0===e||e.call(t,`darkCount ${n}`);try{await this.turnOnTorch(),this.isTorchOn=!0;let t=this.cameraView.getUIElement();t=t.shadowRoot||t,null===(o=null==t?void 0:t.dceMnFs)||void 0===o||o.funcShowToast("Torch Auto On")}catch(e){console.warn(e),i=!0;let t=this.cameraView.getUIElement();t=t.shadowRoot||t,null===(r=null==t?void 0:t.dceMnFs)||void 0===r||r.funcShowToast("Torch Not Supported")}}}else n=0};this._taskid4AutoTorch=setInterval(o,e),this.isTorchOn=void 0,o();let r=this.cameraView.getUIElement();r=r.shadowRoot||r,r.elTorchAuto&&(r.elTorchAuto.style.display=""),r.elTorchOn&&(r.elTorchOn.style.display="none"),r.elTorchOff&&(r.elTorchOff.style.display="none")}async setColorTemperature(t){if(Ze(this,lo,"m",Eo).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await this.cameraManager.setColorTemperature(t,!0)}getColorTemperature(){return this.cameraManager.getColorTemperature()}async setExposureCompensation(t){var e;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.setExposureCompensation(t,!0))}getExposureCompensation(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getExposureCompensation()}async _setZoom(t){var e,i,n;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.setZoom(t));{let e=null===(i=this.cameraView)||void 0===i?void 0:i.getUIElement();e=(null==e?void 0:e.shadowRoot)||e,null===(n=null==e?void 0:e.dceMnFs)||void 0===n||n.funcInfoZoomChange(t.factor)}}async setZoom(t){await this._setZoom(t)}getZoomSettings(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getZoom()}async resetZoom(){var t;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.resetZoom())}async setFrameRate(t){var e;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.setFrameRate(t,!0))}getFrameRate(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getFrameRate()}async setFocus(t){var e;if(Ze(this,lo,"m",Eo).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.setFocus(t,!0))}getFocusSettings(){var t;return null===(t=this.cameraManager)||void 0===t?void 0:t.getFocus()}setAutoZoomRange(t){Ze(this,So,"f").minValue=t.min,Ze(this,So,"f").maxValue=t.max}getAutoZoomRange(){return{min:Ze(this,So,"f").minValue,max:Ze(this,So,"f").maxValue}}async enableEnhancedFeatures(t){var e,i;if(!(null===(i=null===(e=gt.license)||void 0===e?void 0:e.LicenseManager)||void 0===i?void 0:i.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==yt.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");t&li.EF_ENHANCED_FOCUS&&(Ze(this,Co,"f").enhancedFocus=!0),t&li.EF_AUTO_ZOOM&&(Ze(this,Co,"f").autoZoom=!0),t&li.EF_TAP_TO_FOCUS&&(Ze(this,Co,"f").tapToFocus=!0,this.cameraManager.enableTapToFocus())}disableEnhancedFeatures(t){t&li.EF_ENHANCED_FOCUS&&(Ze(this,Co,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch((()=>{}))),t&li.EF_AUTO_ZOOM&&(Ze(this,Co,"f").autoZoom=!1,this.resetZoom().catch((()=>{}))),t&li.EF_TAP_TO_FOCUS&&(Ze(this,Co,"f").tapToFocus=!1,this.cameraManager.disableTapToFocus()),Ze(this,lo,"m",Ao).call(this)&&Ze(this,lo,"m",Po).call(this)||Ze(this,_o,"f").stopCharging()}_setScanRegion(t){if(null!=t&&!C(t)&&!A(t))throw TypeError("Invalid 'region'.");Je(this,yo,t?JSON.parse(JSON.stringify(t)):null),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegion(t)}setScanRegion(t){this._setScanRegion(t),this.cameraView&&!this.cameraView.disposed&&(null===t?this.cameraView.setScanRegionMaskVisible(!1):this.cameraView.setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(Ze(this,yo,"f")))}setErrorListener(t){if(!t)throw new TypeError("Invalid 'listener'");Je(this,vo,t)}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!this.cameraManager.isVideoLoaded()||Ze(this,lo,"m",Eo).call(this))}startFetching(){if(Ze(this,lo,"m",Eo).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");Ze(this,wo,"f")||(Je(this,wo,!0),Ze(this,lo,"m",Io).call(this))}stopFetching(){Ze(this,wo,"f")&&(t._onLog&&t._onLog("DCE: stop fetching loop: "+Date.now()),Ze(this,bo,"f")&&clearTimeout(Ze(this,bo,"f")),Je(this,wo,!1))}fetchImage(){if(Ze(this,lo,"m",Eo).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const t=this.getResolution();if(!(null==t?void 0:t.width)||!(null==t?void 0:t.height))throw new Error("The video is not loaded.");let e;if(e=Hi.convert(Ze(this,yo,"f"),t.width,t.height),e||(e={x:0,y:0,width:t.width,height:t.height}),e.x>t.width||e.y>t.height)throw new Error("Invalid scan region.");e.x+e.width>t.width&&(e.width=t.width-e.x),e.y+e.height>t.height&&(e.height=t.height-e.y);const i={sx:e.x,sy:e.y,sWidth:e.width,sHeight:e.height,dWidth:e.width,dHeight:e.height},n=Math.max(i.dWidth,i.dHeight);if(this.canvasSizeLimit&&n>this.canvasSizeLimit){const t=this.canvasSizeLimit/n;i.dWidth>i.dHeight?(i.dWidth=this.canvasSizeLimit,i.dHeight=Math.round(i.dHeight*t)):(i.dWidth=Math.round(i.dWidth*t),i.dHeight=this.canvasSizeLimit)}const s=this.cameraManager.getFrameData({position:i,pixelFormat:this.getPixelFormat()===a.IPF_GRAYSCALED?qn.GREY:qn.RGBA});if(!s)return null;let o;o=s.pixelFormat===qn.GREY?s.width:4*s.width;let r=!0;return 0===i.sx&&0===i.sy&&i.sWidth===t.width&&i.sHeight===t.height&&(r=!1),{bytes:s.data,width:s.width,height:s.height,stride:o,format:Mo.get(s.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_t.ITT_VIDEO_FRAME,isCropped:r,cropRegion:{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height,isMeasuredInPercentage:!1},originalWidth:t.width,originalHeight:t.height,currentWidth:s.width,currentHeight:s.height,timeSpent:s.timeSpent,timeStamp:s.timeStamp},toCanvas:Ze(this,mo,"f"),isDCEFrame:!0}}setImageFetchInterval(t){this.fetchInterval=t,Ze(this,wo,"f")&&(Ze(this,bo,"f")&&clearTimeout(Ze(this,bo,"f")),Je(this,bo,setTimeout((()=>{this.disposed||Ze(this,lo,"m",Io).call(this)}),t)))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(t){Je(this,xo,t)}getPixelFormat(){return Ze(this,xo,"f")}takePhoto(t){if(!this.isOpen())throw new Error("Not open.");if(Ze(this,lo,"m",Eo).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent",e.addEventListener("click",(()=>{const t=this.isOpen();this.close(),window.addEventListener("focus",(()=>{t&&this.open(),e.remove()}),{once:!0})})),e.addEventListener("change",(async()=>{const i=e.files[0],n=await(async t=>{let e=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(e=await createImageBitmap(t),e)return e}catch(t){}var n;return e||(i=await(n=t,new Promise(((t,e)=>{let i=URL.createObjectURL(n),s=new Image;s.src=i,s.onload=()=>{URL.revokeObjectURL(s.src),t(s)},s.onerror=t=>{e(new Error("Can't convert blob to image : "+(t instanceof Event?t.type:t)))}})))),i})(i),s=n instanceof HTMLImageElement?n.naturalWidth:n.width,o=n instanceof HTMLImageElement?n.naturalHeight:n.height;let r=Hi.convert(Ze(this,yo,"f"),s,o);r||(r={x:0,y:0,width:s,height:o});const a=Ze(this,fo,"f").call(this,n,s,o,r);t&&t(a)})),document.body.appendChild(e),e.click()}convertToPageCoordinates(t){const e=Ze(this,lo,"m",Do).call(this,t);return{x:e.pageX,y:e.pageY}}convertToClientCoordinates(t){const e=Ze(this,lo,"m",Do).call(this,t);return{x:e.clientX,y:e.clientY}}convertToScanRegionCoordinates(t){if(!Ze(this,yo,"f"))return JSON.parse(JSON.stringify(t));let e,i,n=Ze(this,yo,"f").left||Ze(this,yo,"f").x||0,s=Ze(this,yo,"f").top||Ze(this,yo,"f").y||0;if(!Ze(this,yo,"f").isMeasuredInPercentage)return{x:t.x-n,y:t.y-s};if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!Ze(this,lo,"m",Eo).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(Ze(this,lo,"m",Eo).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");if(Ze(this,lo,"m",Eo).call(this)){const t=this.cameraView._innerComponent.getElement("content");e=t.width,i=t.height}else{const t=this.getVideoEl();e=t.videoWidth,i=t.videoHeight}return{x:t.x-Math.round(n*e/100),y:t.y-Math.round(s*i/100)}}dispose(){this.close(),this.cameraManager.dispose(),this.releaseCameraView(),Je(this,To,!0)}};var Bo,Fo,No,Uo,Vo,Wo,Ho,jo;ho=Oo,uo=new WeakMap,po=new WeakMap,go=new WeakMap,fo=new WeakMap,mo=new WeakMap,vo=new WeakMap,yo=new WeakMap,xo=new WeakMap,wo=new WeakMap,bo=new WeakMap,Co=new WeakMap,So=new WeakMap,_o=new WeakMap,To=new WeakMap,lo=new WeakSet,Eo=function(){return"disabled"!==this.singleFrameMode},Po=function(){return!this.videoSrc&&"opened"===this.cameraManager.state},Ao=function(){for(let t in Ze(this,Co,"f"))if(1==Ze(this,Co,"f")[t])return!0;return!1},Io=function t(){if(this.disposed)return;if("open"!==this.getCameraState()||!Ze(this,wo,"f"))return Ze(this,bo,"f")&&clearTimeout(Ze(this,bo,"f")),void Je(this,bo,setTimeout((()=>{this.disposed||Ze(this,lo,"m",t).call(this)}),this.fetchInterval));const e=()=>{var t;let e;Oo._onLog&&Oo._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{e=this.fetchImage()}catch(e){const i=e.message||e;if("The video is not loaded."===i)return;if(null===(t=Ze(this,vo,"f"))||void 0===t?void 0:t.onErrorReceived)return void setTimeout((()=>{var t;null===(t=Ze(this,vo,"f"))||void 0===t||t.onErrorReceived(bt.EC_IMAGE_READ_FAILED,i)}),0);console.warn(e)}e?(this.addImageToBuffer(e),Oo._onLog&&Oo._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),Ze(this,po,"f").fire("frameAddedToBuffer",null,{async:!1})):Oo._onLog&&Oo._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case o.BOPM_BLOCK:break;case o.BOPM_UPDATE:e()}else e();Ze(this,bo,"f")&&clearTimeout(Ze(this,bo,"f")),Je(this,bo,setTimeout((()=>{this.disposed||Ze(this,lo,"m",t).call(this)}),this.fetchInterval))},Do=function(t){if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!Ze(this,lo,"m",Eo).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(Ze(this,lo,"m",Eo).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");const e=this.cameraView._innerComponent.getBoundingClientRect(),i=e.left,n=e.top,s=i+window.scrollX,o=n+window.scrollY,{width:r,height:a}=this.cameraView._innerComponent.getBoundingClientRect();if(r<=0||a<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let l,h,c;if(Ze(this,lo,"m",Eo).call(this)){const t=this.cameraView._innerComponent.getElement("content");l=t.width,h=t.height,c="contain"}else{const t=this.getVideoEl();l=t.videoWidth,h=t.videoHeight,c=this.cameraView.getVideoFit()}const d=r/a,u=l/h;let p,g,f,m,v=1;if("contain"===c)d<u?(v=r/l,p=i+t.x*v,g=n+t.y*v+(a-h*v)/2,f=s+t.x*v,m=o+t.y*v+(a-h*v)/2):(v=a/h,p=i+t.x*v+(r-l*v)/2,g=n+t.y*v,f=s+t.x*v+(r-l*v)/2,m=o+t.y*v);else if("cover"===c)if(d<u){v=a/h;let e=t.x*v-(l*v-r)/2;e=Math.max(e,0),e=Math.min(e,r),p=i+e,g=n+t.y*v,f=s+e,m=o+t.y*v}else{v=r/l;let e=t.y*v-(h*v-a)/2;e=Math.max(e,0),e=Math.min(e,a),p=i+t.x*v,g=n+e,f=s+t.x*v,m=o+e}return{clientX:p,clientY:g,pageX:f,pageY:m}},Oo._debug=!1,co={value:void 0},Oo.browserInfo=Xe;let zo=class{get magnifierCanvas(){return Ze(this,Bo,"f")}constructor(){Bo.set(this,void 0),Je(this,Bo,document.createElement("canvas")),Ze(this,Bo,"f").style.borderRadius="50%"}update(t,e,i,n){if(!this.magnifierCanvas)throw new Error("'magnifierCanvas' not created.");const s=this.magnifierCanvas;s.width=s.height=t;let o=e.x-i/2,r=e.y-i/2,a=i,l=i,h=s.width,c=s.height,d=s.getContext("2d");for(let t of n)d.drawImage(t.image,o,r,a,l,0,0,h,c);s.style.width=s.width+"px",s.style.height=s.height+"px"}show(){if(!this.magnifierCanvas)throw new Error("'magnifierCanvas' not created.");this.magnifierCanvas.style.display="block"}hide(){if(!this.magnifierCanvas)throw new Error("'magnifierCanvas' not created.");this.magnifierCanvas.style.display="none"}};Bo=new WeakMap;let Go=class t extends On{static async createInstance(e){const i=new t;return await i.setUIElement(e||Ze(i,Fo,"m",jo).call(i)),i}get disposed(){return Ze(this,Ho,"f")}constructor(){super(),Fo.add(this),this.containerClassName="dce-image-container",No.set(this,void 0),Uo.set(this,void 0),this.isUseMagnifier=!0,Vo.set(this,(t=>{var e;if(!this.isUseMagnifier)return;if(Ze(this,Uo,"f")||Je(this,Uo,new zo),!Ze(this,Uo,"f").magnifierCanvas)return;document.body.contains(Ze(this,Uo,"f").magnifierCanvas)||(Ze(this,Uo,"f").magnifierCanvas.style.position="fixed",Ze(this,Uo,"f").magnifierCanvas.style.boxSizing="content-box",Ze(this,Uo,"f").magnifierCanvas.style.border="2px solid #FFFFFF",document.body.append(Ze(this,Uo,"f").magnifierCanvas));const i=this._innerComponent.getElement("content");if(!i)return;if(t.pointer.x<0||t.pointer.x>i.width||t.pointer.y<0||t.pointer.y>i.height)return void Ze(this,Wo,"f").call(this);const n=null===(e=this._drawingLayerManager._getFabricCanvas())||void 0===e?void 0:e.lowerCanvasEl;if(!n)return;const s=Math.max(i.clientWidth/5/1.5,i.clientHeight/4/1.5),o=1.5*s,r=[{image:i,width:i.width,height:i.height},{image:n,width:n.width,height:n.height}];Ze(this,Uo,"f").update(o,t.pointer,s,r);{let e=0,i=0;t.e instanceof MouseEvent?(e=t.e.clientX,i=t.e.clientY):t.e instanceof TouchEvent&&t.e.changedTouches.length&&(e=t.e.changedTouches[0].clientX,i=t.e.changedTouches[0].clientY),e<1.5*o&&i<1.5*o?(Ze(this,Uo,"f").magnifierCanvas.style.left="auto",Ze(this,Uo,"f").magnifierCanvas.style.top="0",Ze(this,Uo,"f").magnifierCanvas.style.right="0"):(Ze(this,Uo,"f").magnifierCanvas.style.left="0",Ze(this,Uo,"f").magnifierCanvas.style.top="0",Ze(this,Uo,"f").magnifierCanvas.style.right="auto")}Ze(this,Uo,"f").show()})),Wo.set(this,(()=>{Ze(this,Uo,"f")&&Ze(this,Uo,"f").hide()})),Ho.set(this,!1)}_setUIElement(t){this.UIElement=t,this._unbindUI(),this._bindUI()}async setUIElement(t){let e;if("string"==typeof t){let i=await qi(t);e=document.createElement("div"),Object.assign(e.style,{width:"100%",height:"100%"}),e.attachShadow({mode:"open"}).appendChild(i)}else e=t;this._setUIElement(e)}getUIElement(){return this.UIElement}_bindUI(){if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;const t=this.UIElement;let e=t.classList.contains(this.containerClassName)?t:t.querySelector(`.${this.containerClassName}`);e||(e=document.createElement("div"),e.style.width="100%",e.style.height="100%",e.className=this.containerClassName,t.append(e)),this._innerComponent=document.createElement("dce-component"),e.appendChild(this._innerComponent)}_unbindUI(){var t,e,i;null===(t=this._drawingLayerManager)||void 0===t||t.clearDrawingLayers(),null===(e=this._innerComponent)||void 0===e||e.removeElement("drawing-layer"),this._layerBaseCvs=null,null===(i=this._innerComponent)||void 0===i||i.remove(),this._innerComponent=null}setImage(t,e,i){if(!this._innerComponent)throw new Error("Need to set 'UIElement'.");let n=this._innerComponent.getElement("content");n||(n=document.createElement("canvas"),n.style.objectFit="contain",this._innerComponent.setElement("content",n)),n.width===e&&n.height===i||(n.width=e,n.height=i);const s=n.getContext("2d");s.clearRect(0,0,n.width,n.height),t instanceof Uint8Array||t instanceof Uint8ClampedArray?(t instanceof Uint8Array&&(t=new Uint8ClampedArray(t.buffer)),s.putImageData(new ImageData(t,e,i),0,0)):(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement)&&s.drawImage(t,0,0)}getImage(){return this._innerComponent.getElement("content")}clearImage(){if(!this._innerComponent)return;let t=this._innerComponent.getElement("content");t&&t.getContext("2d").clearRect(0,0,t.width,t.height)}removeImage(){this._innerComponent&&this._innerComponent.removeElement("content")}setOriginalImage(t){if(b(t)){Je(this,No,t);const{width:e,height:i,bytes:n,format:s}=Object.assign({},t);let o;if(s===a.IPF_GRAYSCALED){o=new Uint8ClampedArray(e*i*4);for(let t=0;t<o.length;t+=4)o[t]=n[t/4],o[t+1]=n[t/4],o[t+2]=n[t/4],o[t+3]=255}else o=new Uint8ClampedArray(n.buffer);this.setImage(o,e,i)}else if(t instanceof HTMLCanvasElement)Je(this,No,t),this.setImage(t,t.width,t.height);else{if(!(t instanceof HTMLImageElement))throw new TypeError("Invalid img.");Je(this,No,t),this.setImage(t,t.naturalWidth,t.naturalHeight)}let e;try{e=this.getContentDimensions()}catch(t){if("Invalid content dimensions."===(t.message||t))return;throw t}this.updateDrawingLayers(e)}getOriginalImage(){return Ze(this,No,"f")}getContentDimensions(){let t,e,i;if(this._innerComponent){const n=this._innerComponent.getElement("content");t=null==n?void 0:n.width,e=null==n?void 0:n.height,i="contain"}if(!t||!e)throw new Error("Invalid content dimensions.");return{width:t,height:e,objectFit:i}}_createDrawingLayer(t,e,i,n){if(!this._layerBaseCvs){let s;try{s=this.getContentDimensions()}catch(t){if("Invalid content dimensions."!==(t.message||t))throw t}e||(e=(null==s?void 0:s.width)||300),i||(i=(null==s?void 0:s.height)||150),n||(n=(null==s?void 0:s.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(e,i,n)}const s=this._layerBaseCvs,o=this._drawingLayerManager.createDrawingLayer(s,t);this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",s.parentElement),t!=Rn.TIP_LAYER_ID&&o.setMode("editor");const r=this._drawingLayerManager._getFabricCanvas();return r&&(r.on("object:scaling",Ze(this,Vo,"f")),r.on("object:rotating",Ze(this,Vo,"f")),r.on("object:skewing",Ze(this,Vo,"f")),r.on("mouse:up",Ze(this,Wo,"f"))),o}dispose(){this._unbindUI(),this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"disposed",{value:!0})}};No=new WeakMap,Uo=new WeakMap,Vo=new WeakMap,Wo=new WeakMap,Ho=new WeakMap,Fo=new WeakSet,jo=function(){const t=document.createElement("div");return t.className=this.containerClassName,t.style.width="100%",t.style.height="100%",t};const Yo="undefined"==typeof self,$o="function"==typeof importScripts,Xo=(()=>{if(!$o){if(!Yo&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),qo=t=>{if(null==t&&(t="./"),Yo||$o);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};yt.engineResourcePaths.ddn={version:"2.6.11",path:Xo,isInternal:!0},ft.ddn={js:!0,wasm:!0,deps:["license","dip"]},gt.ddn={handleNormalizedImageResultItem:function(t){let e=t,i=F(e.imageData);e.toCanvas=()=>L(i),e.toImage=t=>O(t,i),e.toBlob=t=>B(t,i),e.saveToFile=async(t,e)=>{if(!t)return null;if("string"!=typeof t)throw new TypeError("FileName must be of type string.");return M(i,t,e)}}};const Zo="1.4.21";"string"!=typeof yt.engineResourcePaths.std&&k(yt.engineResourcePaths.std.version,Zo)<0&&(yt.engineResourcePaths.std={version:Zo,path:qo(Xo+`../../dynamsoft-capture-vision-std@${Zo}/dist/`),isInternal:!0});const Jo="2.4.31";(!yt.engineResourcePaths.dip||"string"!=typeof yt.engineResourcePaths.dip&&k(yt.engineResourcePaths.dip.version,Jo)<0)&&(yt.engineResourcePaths.dip={version:Jo,path:qo(Xo+`../../dynamsoft-image-processing@${Jo}/dist/`),isInternal:!0});let Ko=class{static getVersion(){const t=pt.ddn&&pt.ddn.wasm;return`2.6.11(Worker: ${pt.ddn&&pt.ddn.worker||"Not Loaded"}, Wasm: ${t||"Not Loaded"})`}async setThresholdValue(t,e,i,n){return await vt("ddn"),await new Promise(((s,o)=>{let r=at();lt[r]=async t=>{if(t.success)return s();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},ot.postMessage({type:"ddn_setThresholdValue",id:r,instanceID:t._instanceID,body:{threshold:e,leftLimit:i,rightLimit:n}})}))}};var Qo;!function(t){t[t.ICM_COLOUR=0]="ICM_COLOUR",t[t.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",t[t.ICM_BINARY=2]="ICM_BINARY"}(Qo||(Qo={}));const tr=async t=>{let e;await new Promise(((i,n)=>{e=new Image,e.onload=()=>i(e),e.onerror=n,e.src=URL.createObjectURL(t)}));const i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e.width,i.height=e.height,n.drawImage(e,0,0),{bytes:Uint8Array.from(n.getImageData(0,0,i.width,i.height).data),width:i.width,height:i.height,stride:4*i.width,format:10}};let er=class{async saveToFile(t,e,i){if(!t||!e)return null;if("string"!=typeof e)throw new TypeError("FileName must be of type string.");const n=F(t);return M(n,e,i)}async drawOnImage(t,e,i,n=4294901760,s=1,o){let r;if(t instanceof Blob)r=await tr(t);else if("string"==typeof t){let e=await I(t,"blob");r=await tr(e)}return await new Promise(((t,a)=>{let l=at();lt[l]=async e=>{if(e.success)return o&&this.saveToFile(e.image,"test.png",o),t(e.image);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}},ot.postMessage({type:"utility_drawOnImage",id:l,body:{dsImage:r,drawingItem:e instanceof Array?e:[e],color:n,thickness:s,type:i}})}))}};const ir="undefined"==typeof self,nr="function"==typeof importScripts,sr=(()=>{if(!nr){if(!ir&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),or=t=>{if(null==t&&(t="./"),ir||nr);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};yt.engineResourcePaths.utility={version:"1.4.32",path:sr,isInternal:!0},ft.utility={js:!0,wasm:!0};const rr="1.4.21";"string"!=typeof yt.engineResourcePaths.std&&k(yt.engineResourcePaths.std.version,rr)<0&&(yt.engineResourcePaths.std={version:rr,path:or(sr+`../../dynamsoft-capture-vision-std@${rr}/dist/`),isInternal:!0});const ar="2.4.31";(!yt.engineResourcePaths.dip||"string"!=typeof yt.engineResourcePaths.dip&&k(yt.engineResourcePaths.dip.version,ar)<0)&&(yt.engineResourcePaths.dip={version:ar,path:or(sr+`../../dynamsoft-image-processing@${ar}/dist/`),isInternal:!0});let lr=class{static getVersion(){return`1.4.32(Worker: ${pt.utility&&pt.utility.worker||"Not Loaded"}, Wasm: ${pt.utility&&pt.utility.wasm||"Not Loaded"})`}};function hr(t,e,i,n){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}var cr,dr,ur,pr,gr;function fr(t,e){let i=!0;for(let r=0;r<t.length;r++){const a=(r+1)%t.length;if(n=t[r],o=e,((s=t[a]).x-n.x)*(o.y-n.y)-(s.y-n.y)*(o.x-n.x)<0){i=!1;break}}var n,s,o;return i}function mr(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function vr(t,e){const[i,n]=t,s=i.x,o=i.y,r=n.x,a=n.y,l=e.x,h=e.y,c=(r-s)**2+(a-o)**2;if(0===c)return Math.sqrt((l-s)**2+(h-o)**2);const d=((l-s)*(r-s)+(h-o)*(a-o))/c;if(d<0)return Math.sqrt((l-s)**2+(h-o)**2);if(d>1)return Math.sqrt((l-r)**2+(h-a)**2);{const t=s+d*(r-s),e=o+d*(a-o);return Math.sqrt((l-t)**2+(h-e)**2)}}function yr(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i],s=t[(i+1)%t.length];e.push([n,s])}return e}function xr(t){const[e,i]=t;return{x:(e.x+i.x)/2,y:(e.y+i.y)/2}}function wr(t,e,i,n){const s=e.x-t.x,o=e.y-t.y,r=n.x-i.x,a=n.y-i.y,l=(-o*(t.x-i.x)+s*(t.y-i.y))/(-r*o+s*a),h=(r*(t.y-i.y)-a*(t.x-i.x))/(-r*o+s*a);return l>=0&&l<=1&&h>=0&&h<=1?{x:t.x+h*s,y:t.y+h*o}:null}function br(t){let e=0;for(let i=0;i<t.length;i++){const n=(i+1)%t.length;e+=t[i].x*t[n].y,e-=t[n].x*t[i].y}return Math.abs(e/2)}function Cr(t,e,i){let n=e.x-t.x,s=e.y-t.y,o=i.x-t.x;return n*(i.y-t.y)-s*o>0}function Sr(t,e){for(let i=0;i<4;i++)if(!Cr(t.points[i],t.points[(i+1)%4],e))return!1;return!0}"function"==typeof SuppressedError&&SuppressedError;function _r(t,e,i,n){const s=t.points,o=e.points;let r=8*i;r=Math.max(r,5);const a=yr(s)[3],l=yr(s)[1],h=yr(o)[3],c=yr(o)[1];let d,u=0;if(d=Math.max(Math.abs(vr(a,e.points[0])),Math.abs(vr(a,e.points[3]))),d>u&&(u=d),d=Math.max(Math.abs(vr(l,e.points[1])),Math.abs(vr(l,e.points[2]))),d>u&&(u=d),d=Math.max(Math.abs(vr(h,t.points[0])),Math.abs(vr(h,t.points[3]))),d>u&&(u=d),d=Math.max(Math.abs(vr(c,t.points[1])),Math.abs(vr(c,t.points[2]))),d>u&&(u=d),u>r)return!1;const p=xr(yr(s)[0]),g=xr(yr(s)[2]),f=xr(yr(o)[0]),m=xr(yr(o)[2]),v=mr(p,m),y=mr(f,g),x=v>y,w=Math.min(v,y),b=mr(p,g),C=mr(f,m);let S=12*i;return S=Math.max(S,5),S=Math.min(S,b),S=Math.min(S,C),!!(w<S||fr(s,x?f:m)||fr(o,x?g:p))&&(x?(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]):(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]),n.area=br(n.points),!0)}let Tr=class{constructor(t,e,i,n){this.overlapCount=t,this.verificationCount=e,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(t){const e={x:0,y:0};return t.forEach((({x:t,y:i})=>{e.x+=t,e.y+=i})),e.x/=t.length,e.y/=t.length,e}isProbablySameLocationWithOffset(t,e){const i=this.item.location,n=t.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let s=new Array(4).fill(0),o=new Array(4).fill(0),r=0,a=0;for(let t=0;t<4;++t)s[t]=Math.round(100*(n.points[t].x-i.points[t].x))/100,r+=s[t],o[t]=Math.round(100*(n.points[t].y-i.points[t].y))/100,a+=o[t];r/=4,a/=4;for(let t=0;t<4;++t){if(Math.abs(s[t]-r)>this.strictLimit||Math.abs(r)>.8)return!1;if(Math.abs(o[t]-a)>this.strictLimit||Math.abs(a)>.8)return!1}return e.x=r,e.y=a,!0}isLocationOverlap(t,e){if(this.locationArea>e){for(let e=0;e<4;e++)if(Sr(this.location,t.points[e]))return!0;const e=this.getCenterPoint(t.points);if(Sr(this.location,e))return!0}else{for(let e=0;e<4;e++)if(Sr(t,this.location.points[e]))return!0;if(Sr(t,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(t,e={x:0,y:0}){if(this.isOneD){const i=Object.assign({},t.location);for(let t=0;t<4;t++)i.points[t].x-=e.x,i.points[t].y-=e.y;if(!this.isLocationOverlap(i,t.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],s=[this.location.points[1],this.location.points[2]];for(let t=0;t<4;t++){const e=i.points[t],o=0===t||3===t?n:s;if(Math.abs(vr(o,e))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=t.location.points[i],s=this.location.points[i];if(!(Math.abs(s.x+e.x-n.x)<this.locationThreshold))return!1;if(Math.abs(s.y+e.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(t,e,i=!0){const n=Object.assign({},t.location);for(let t=0;t<4;t++)n.points[t].x-=e.x,n.points[t].y-=e.y;if(!this.isLocationOverlap(n,t.location.area))return!1;if(i){const t=.75;return function(t,e){const i=[];for(let n=0;n<4;n++)for(let s=0;s<4;s++){const o=wr(t[n],t[(n+1)%4],e[s],e[(s+1)%4]);o&&i.push(o)}return t.forEach((t=>{fr(e,t)&&i.push(t)})),e.forEach((e=>{fr(t,e)&&i.push(e)})),br(function(t){if(t.length<=1)return t;t.sort(((t,e)=>t.x-e.x||t.y-e.y));const e=t.shift();return t.sort(((t,i)=>Math.atan2(t.y-e.y,t.x-e.x)-Math.atan2(i.y-e.y,i.x-e.x))),[e,...t]}(i))}([...this.location.points],n.points)>this.locationArea*t}return!0}};const Er={BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096)},Pr={barcode:2,text_line:4,detected_quad:8,normalized_image:16},Ar=t=>Object.values(Pr).includes(t)||Pr.hasOwnProperty(t),Ir=(t,e)=>"string"==typeof t?e[Pr[t]]:e[t],Dr=(t,e,i)=>{"string"==typeof t?e[Pr[t]]=i:e[t]=i},kr=(t,e,i)=>{const n=[8,16].includes(i);if(!n&&t.isResultCrossVerificationEnabled(i))for(let t=0;t<e.length;t++)e[t]&&e[t].type===i&&!e[t].verified&&(e[t].isFilter=!0);if(!n&&t.isResultDeduplicationEnabled(i))for(let t=0;t<e.length;t++)e[t]&&e[t].type===i&&e[t].duplicate&&(e[t].isFilter=!0)};let Rr=class{constructor(){this.verificationEnabled={[xt.CRIT_BARCODE]:!1,[xt.CRIT_TEXT_LINE]:!0,[xt.CRIT_DETECTED_QUAD]:!0,[xt.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[xt.CRIT_BARCODE]:!1,[xt.CRIT_TEXT_LINE]:!1,[xt.CRIT_DETECTED_QUAD]:!1,[xt.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[xt.CRIT_BARCODE]:3e3,[xt.CRIT_TEXT_LINE]:3e3,[xt.CRIT_DETECTED_QUAD]:3e3,[xt.CRIT_NORMALIZED_IMAGE]:3e3},this.latestOverlappingEnabled={[xt.CRIT_BARCODE]:!1,[xt.CRIT_TEXT_LINE]:!1,[xt.CRIT_DETECTED_QUAD]:!1,[xt.CRIT_NORMALIZED_IMAGE]:!1},this.maxOverlappingFrames={[xt.CRIT_BARCODE]:5,[xt.CRIT_TEXT_LINE]:5,[xt.CRIT_DETECTED_QUAD]:5,[xt.CRIT_NORMALIZED_IMAGE]:5},this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,cr.set(this,new Map),dr.set(this,new Map),ur.set(this,new Map),pr.set(this,new Map),gr.set(this,new Map)}_dynamsoft(){hr(this,cr,"f").forEach(((t,e)=>{Dr(e,this.verificationEnabled,t)})),hr(this,dr,"f").forEach(((t,e)=>{Dr(e,this.duplicateFilterEnabled,t)})),hr(this,ur,"f").forEach(((t,e)=>{Dr(e,this.duplicateForgetTime,t)})),hr(this,pr,"f").forEach(((t,e)=>{Dr(e,this.latestOverlappingEnabled,t)})),hr(this,gr,"f").forEach(((t,e)=>{Dr(e,this.maxOverlappingFrames,t)}))}enableResultCrossVerification(t,e){Ar(t)&&hr(this,cr,"f").set(t,e)}isResultCrossVerificationEnabled(t){return!!Ar(t)&&Ir(t,this.verificationEnabled)}enableResultDeduplication(t,e){Ar(t)&&(e&&this.enableLatestOverlapping(t,!1),hr(this,dr,"f").set(t,e))}isResultDeduplicationEnabled(t){return!!Ar(t)&&Ir(t,this.duplicateFilterEnabled)}setDuplicateForgetTime(t,e){Ar(t)&&(e>18e4&&(e=18e4),e<0&&(e=0),hr(this,ur,"f").set(t,e))}getDuplicateForgetTime(t){return Ar(t)?Ir(t,this.duplicateForgetTime):-1}setMaxOverlappingFrames(t,e){Ar(t)&&hr(this,gr,"f").set(t,e)}getMaxOverlappingFrames(t){return Ar(t)?Ir(t,this.maxOverlappingFrames):-1}enableLatestOverlapping(t,e){Ar(t)&&(e&&this.enableResultDeduplication(t,!1),hr(this,pr,"f").set(t,e))}isLatestOverlappingEnabled(t){return!!Ar(t)&&Ir(t,this.latestOverlappingEnabled)}getFilteredResultItemTypes(){let t=0;const e=[xt.CRIT_BARCODE,xt.CRIT_TEXT_LINE,xt.CRIT_DETECTED_QUAD,xt.CRIT_NORMALIZED_IMAGE];for(let i=0;i<e.length;i++)(this.verificationEnabled[e[i]]||this.duplicateFilterEnabled[e[i]])&&(t|=e[i]);return t}onOriginalImageResultReceived(t){}latestOverlappingFilter(t){var e,i,n;const s=this.isResultCrossVerificationEnabled(xt.CRIT_BARCODE),o=this.isLatestOverlappingEnabled(xt.CRIT_BARCODE);if(o){const r=5,a=60,l=o?this.getMaxOverlappingFrames(xt.CRIT_BARCODE):5,h=t.items.length,c=null===(n=null===(i=null===(e=null==t?void 0:t.intermediateResult)||void 0===e?void 0:e[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,d=c?c.length:0;let u=[];const p=[],g={x:0,y:0};let f=new Array(h).fill(-1),m=0;const v=t.items.map((t=>{if(1!==t.type){const e=(BigInt(t.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0);return new Tr(l,e?1:2,e,t)}})).filter(Boolean);if(this.overlapSet.length>0){const t=new Array(h).fill(new Array(this.overlapSet.length).fill(1));let e=0;for(;e<h;){const i={x:0,y:0},n=new Array(h).fill(-1);let s=!1;for(;e<h;e++){if(!v[e])continue;const o=v[e].item;for(let r=0;r<this.overlapSet.length;r++){if(t[e][r]<1)continue;const a=this.overlapSet[r],l=a.item;if(o.format===l.format&&o.text===l.text){if(s=a.isProbablySameLocationWithOffset(v[e],i),s){n[e]=r,t[e][r]=0;break}}else t[e][r]=0}if(s)break}if(s){for(let s=0;s<h;s++){if(s===e||!v[s])continue;const o=v[s].item;for(let e=0;e<this.overlapSet.length;e++){if(t[s][e]<1)continue;if(n.includes(e))continue;const r=this.overlapSet[e],a=r.item;if(o.format===a.format&&o.text===a.text){if(r.isMatchedLocationWithOffset(v[s],i)){n[s]=e,t[s][e]=0;break}}else t[s][e]=0}}const s=n.filter((t=>-1!==t)).length;s>m&&(m=s,f=n,g.x=i.x,g.y=i.y)}}if(0===m){for(let e=0;e<h;e++){const i=v[e].item;for(let n=0;n<this.overlapSet.length;n++){if(t[e][n]<1)continue;if(f.includes(n))continue;const s=this.overlapSet[n],o=s.item;if(i.format===o.format&&i.text===o.text){if(s.isMatchedLocationWithOffset(v[e])){f[e]=n,t[e][n]=0;break}}else t[e][n]=0}}m+=f.filter((t=>-1!=t)).length}let i=this.overlapSet.length<=3?m>=1:m>=2;if(!i&&o&&d>0){let t=0;for(let e=0;e<this.overlapSet.length;e++){const i=this.overlapSet[e];for(let e=0;e<d;e++)if(i.isOverlappedLocationWithOffset(c[e],g)){t++;break}}i=this.overlapSet.length<=3?t>=1:t>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,t.items.forEach(((t,e)=>{if(1!==t.type){const i=Object.assign({},t),n=(BigInt(t.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0),o=t.confidence<a,r=new Tr(l,n?1:2,n,i);s&&n&&o&&p.push(e),this.overlapSet.push(r)}}));else{let e=!0;o?(Math.abs(g.x)>5||Math.abs(g.y)>5)&&(e=!1):e=!1;for(let i=0;i<t.items.length;i++){const t=f[i];if(t<0&&v[i]){const t=v[i].item;let n={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let i=0;i<4;i++)n.points[i].x=e?t.location.points[i].x-g.x:t.location.points[i].x,n.points[i].y=e?t.location.points[i].y-g.y:t.location.points[i].y;for(let s=0;s<this.overlapSet.length;s++){if(f.includes(s))continue;const o=this.overlapSet[s].item.text,r=this.overlapSet[s].item.format;if(t.format===r&&t.text===o){if(this.overlapSet[s].isOverlappedLocationWithOffset(t,g,!1)){const e=Object.assign({},t),n=(BigInt(e.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0),o=n?1:2;this.overlapSet[s]=new Tr(l,o,n,e),f[i]=s;break}if(v[i].isOneD){let o={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let t=0;t<4;t++)o.points[t].x=e?this.overlapSet[s].location.points[t].x:this.overlapSet[s].location.points[t].x+g.x,o.points[t].y=e?this.overlapSet[s].location.points[t].y:this.overlapSet[s].location.points[t].y+g.y;let r={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(_r(n,o,t.moduleSize,r)){t.location=r;const e=Object.assign({},t),n=(BigInt(e.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0),o=n?1:2;this.overlapSet[s]=new Tr(l,o,n,e),f[i]=s;break}}}}}else{if(e)v[i]&&(v[i].item.location=this.overlapSet[t].location);else{const e=Object.assign({},v[i].item),n=(BigInt(e.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[t]=new Tr(l,s,n,e)}this.overlapSet[t]&&(this.overlapSet[t].overlapCount=l,this.overlapSet[t].verificationCount=2,this.overlapSet[t].crossVerificationFrame=r)}}e?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let t=0;t<this.overlapSet.length;t++){if(f.includes(t))continue;const n=this.overlapSet[t];n.overlapCount--,n.crossVerificationFrame--;const s=n.overlapCount+this.stabilityCount;if(o&&s>0){for(let t=0;t<h;t++)if(n.isOverlappedLocationWithOffset(v[t],g,!1)){i=!1;break}if(!i)break;const t=n.item;if(!e){for(let t=0;t<4;t++)n.location.points[t].x+=g.x,n.location.points[t].y+=g.y;t.location=n.location}2===n.verificationCount&&u.push(t)}}if(o&&!i){u=[];for(let t=0;t<this.overlapSet.length;t++){if(f.includes(t))continue;const e=this.overlapSet[t];e.overlapCount=0-this.stabilityCount,e.crossVerificationFrame=0,e.verificationCount=0}}for(let t=0;t<h;t++){if(-1!==f[t]||!v[t])continue;const i=v[t].item;if(e){for(let e=0;e<4;e++)v[t].location.points[e].x-=g.x,v[t].location.points[e].y-=g.y;i.location=v[t].location}let n=!1;for(let e of this.overlapSet)if(!(e.crossVerificationFrame<=0&&e.verificationCount<=0)&&(n=e.isLocationOverlap(v[t].location,v[t].locationArea),n))break;if(n){p.push(t);continue}const o=Object.assign({},i),r=(BigInt(i.format)&BigInt(Er.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(Er.BF_GS1_DATABAR))!=BigInt(0),h=i.confidence<a,c=new Tr(l,r?1:2,r,o);s&&r&&h?p.push(t):c.verificationCount=2,this.overlapSet.push(c)}this.overlapSet=this.overlapSet.filter((t=>!(t.overlapCount+this.stabilityCount<=0&&t.crossVerificationFrame<=0)))}p.sort(((t,e)=>e-t)).forEach(((e,i)=>{t.items.splice(e,1)})),u.forEach((e=>{t.items.push(Object.assign(Object.assign({},e),{overlapped:!0}))}))}}onDecodedBarcodesReceived(t){this.latestOverlappingFilter(t),kr(this,t.items,xt.CRIT_BARCODE)}onRecognizedTextLinesReceived(t){kr(this,t.items,xt.CRIT_TEXT_LINE)}onDetectedQuadsReceived(t){kr(this,t.items,xt.CRIT_DETECTED_QUAD)}onNormalizedImagesReceived(t){kr(this,t.items,xt.CRIT_NORMALIZED_IMAGE)}};var Mr;cr=new WeakMap,dr=new WeakMap,ur=new WeakMap,pr=new WeakMap,gr=new WeakMap,function(t){t.Scanner="scanner",t.Result="scan-result",t.Correction="correction"}(Mr||(Mr={}));const Lr="DetectDocumentBoundaries_Default",Or="NormalizeDocument_Default";var Br,Fr;function Nr(t){if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error("Element not found");return e}return t instanceof HTMLElement?t:null}function Ur(t,e){Wr("dds-controls-style","\n  .dds-controls {\n    display: flex;\n    height: 8rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dds-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dds-control-btn.hide {\n    display: none;\n  }\n\n  .dds-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dds-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dds-control-icon img,\n  .dds-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dds-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n  }\n");const i=document.createElement("div");return i.className="dds-controls",t.forEach((t=>{const e=document.createElement("div");e.className=`dds-control-btn ${null==t?void 0:t.className}`;const n=document.createElement("div");if(n.className="dds-control-icon-wrapper",(s=t.icon).trim().startsWith("<svg")&&s.trim().endsWith("</svg>"))n.innerHTML=t.icon;else{const e=document.createElement("img");e.src=t.icon,e.alt=t.label,e.width=24,e.height=24,n.appendChild(e)}var s;const o=document.createElement("div");o.className="dds-control-text",o.textContent=t.label,t.isDisabled&&e.classList.add("disabled"),t.isHidden&&e.classList.add("hide"),e.appendChild(n),e.appendChild(o),t.onClick&&!t.isDisabled&&e.addEventListener("click",t.onClick),i.appendChild(e)})),i}function Vr(t){return[Fr.SMART_CAPTURE,Fr.UPLOADED_IMAGE,Fr.MANUAL].includes(t)}function Wr(t,e){if(!document.getElementById(t)){const i=document.createElement("style");i.id=t,i.textContent=e,document.head.appendChild(i)}}!function(t){t[t.RS_SUCCESS=0]="RS_SUCCESS",t[t.RS_CANCELLED=1]="RS_CANCELLED",t[t.RS_FAILED=2]="RS_FAILED"}(Br||(Br={})),function(t){t.MANUAL="manual",t.SMART_CAPTURE="smartCapture",t.AUTO_CROP="autoCrop",t.UPLOADED_IMAGE="uploadedImage"}(Fr||(Fr={}));const Hr='\n  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 25 25">\n  <defs>\n    <clipPath id="fullImageclip-path">\n      <rect id="Rectangle_2776" data-name="Rectangle 2776" width="25" height="25" fill="#fff"/>\n    </clipPath>\n  </defs>\n  <g id="full-image" transform="translate(0 0)">\n    <g id="Group_586" data-name="Group 586" transform="translate(0 0)" clip-path="url(#fullImageclip-path)">\n      <path id="Path_1528" data-name="Path 1528" d="M.621,3.618A.621.621,0,0,0,1.242,3V1.809a.569.569,0,0,1,.567-.567H3A.621.621,0,0,0,3,0H1.809A1.811,1.811,0,0,0,0,1.809V3a.621.621,0,0,0,.621.621" transform="translate(0 0)" fill="#fff"/>\n      <path id="Path_1529" data-name="Path 1529" d="M17.842,1.242H19.03a.568.568,0,0,1,.566.567V3a.621.621,0,1,0,1.242,0V1.809A1.811,1.811,0,0,0,19.03,0H17.842a.621.621,0,0,0,0,1.242" transform="translate(4.162 0)" fill="#fff"/>\n      <path id="Path_1530" data-name="Path 1530" d="M9.562,0H5.4a.621.621,0,0,0,0,1.242H9.562A.621.621,0,0,0,9.562,0" transform="translate(1.156 0)" fill="#fff"/>\n      <path id="Path_1531" data-name="Path 1531" d="M11.623,1.242h4.158a.621.621,0,0,0,0-1.242H11.623a.621.621,0,0,0,0,1.242" transform="translate(2.659 0)" fill="#fff"/>\n      <path id="Path_1532" data-name="Path 1532" d="M3,19.6H1.808a.568.568,0,0,1-.566-.567V17.841a.621.621,0,1,0-1.242,0v1.188a1.81,1.81,0,0,0,1.808,1.809H3A.621.621,0,0,0,3,19.6" transform="translate(0 4.161)" fill="#fff"/>\n      <path id="Path_1533" data-name="Path 1533" d="M9.562,19.134H5.4a.621.621,0,1,0,0,1.242H9.562a.621.621,0,1,0,0-1.242" transform="translate(1.156 4.624)" fill="#fff"/>\n      <path id="Path_1534" data-name="Path 1534" d="M.621,10.183a.621.621,0,0,0,.621-.621V5.4A.621.621,0,0,0,0,5.4V9.562a.621.621,0,0,0,.621.621" transform="translate(0 1.156)" fill="#fff"/>\n      <path id="Path_1535" data-name="Path 1535" d="M.621,16.4a.621.621,0,0,0,.621-.621V11.624a.621.621,0,1,0-1.242,0v4.157a.621.621,0,0,0,.621.621" transform="translate(0 2.659)" fill="#fff"/>\n      <path id="Path_1536" data-name="Path 1536" d="M20.376,5.4a.621.621,0,1,0-1.242,0V9.563a.621.621,0,1,0,1.242,0Z" transform="translate(4.624 1.156)" fill="#fff"/>\n      <path id="Path_1537" data-name="Path 1537" d="M20.217,17.221a.621.621,0,0,0-.621.621V19.03a.568.568,0,0,1-.567.566H17.841a.621.621,0,1,0,0,1.242h1.188a1.811,1.811,0,0,0,1.809-1.808V17.842a.621.621,0,0,0-.621-.621" transform="translate(4.162 4.162)" fill="#fff"/>\n      <path id="Path_1538" data-name="Path 1538" d="M15.781,19.134H11.623a.621.621,0,1,0,0,1.242h4.158a.621.621,0,0,0,0-1.242" transform="translate(2.659 4.624)" fill="#fff"/>\n      <path id="Path_1539" data-name="Path 1539" d="M19.755,11a.621.621,0,0,0-.621.621v4.157a.621.621,0,0,0,1.242,0V11.624A.621.621,0,0,0,19.755,11" transform="translate(4.624 2.659)" fill="#fff"/>\n      <path id="Path_1540" data-name="Path 1540" d="M7.5,18.3a.621.621,0,0,0-.621-.621H4.733l5.149-5.149A.621.621,0,0,0,9,11.656L3.855,16.806V14.579a.621.621,0,0,0-1.242,0V18.3a.611.611,0,0,0,.048.238A.606.606,0,0,0,3,18.877a.606.606,0,0,0,.238.048H6.878A.621.621,0,0,0,7.5,18.3" transform="translate(0.632 2.773)" fill="#fff"/>\n      <path id="Path_1541" data-name="Path 1541" d="M14.173,3.409a.619.619,0,0,0,.621.621h1.836L11.483,9.178a.621.621,0,0,0,.878.878l5.148-5.148V6.744a.621.621,0,1,0,1.242,0V3.41a.606.606,0,0,0-.048-.238.612.612,0,0,0-.335-.335.606.606,0,0,0-.238-.048H14.794a.621.621,0,0,0-.621.621" transform="translate(2.731 0.673)" fill="#fff"/>\n      <path id="Path_1542" data-name="Path 1542" d="M2.661,3.172a.615.615,0,0,0-.048.238V6.744a.621.621,0,0,0,1.242,0V4.908L9,10.057a.621.621,0,0,0,.878-.878L4.733,4.03H6.57a.621.621,0,1,0,0-1.242H3.235A.634.634,0,0,0,3,2.836a.624.624,0,0,0-.335.335" transform="translate(0.632 0.673)" fill="#fff"/>\n      <path id="Path_1543" data-name="Path 1543" d="M18.7,18.545a.617.617,0,0,0,.048-.24h0V14.581a.62.62,0,1,0-1.24,0v2.226l-5.148-5.15a.621.621,0,0,0-.878.878l5.147,5.149H14.4a.621.621,0,0,0-.621.621.623.623,0,0,0,.621.621h3.71a.616.616,0,0,0,.453-.18.6.6,0,0,0,.117-.175c0-.009.012-.016.016-.025" transform="translate(2.731 2.773)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n\n',jr='<svg xmlns="http://www.w3.org/2000/svg" width="25.04" height="25" viewBox="0 0 25.04 25">\n  <g id="bounds-detection" transform="translate(0.02)">\n    <g id="Group_306" data-name="Group 306" transform="translate(-0.02)">\n      <path id="Path_982" data-name="Path 982" d="M.791,8.146h.02a.468.468,0,0,0,.516-.416.455.455,0,0,0,0-.063V1.927a1,1,0,0,1,1-1H7.957A.468.468,0,0,0,8.436.492.468.468,0,0,0,7.977.013H2.247A1.913,1.913,0,0,0,.333,1.927v5.74A.468.468,0,0,0,.791,8.146Z" transform="translate(-0.293 -0.012)" fill="#fff"/>\n      <path id="Path_983" data-name="Path 983" d="M140.092,132.044a.468.468,0,0,0-.458-.478h-.02a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74a1,1,0,0,1-1,1h-5.671a.5.5,0,0,0,0,1h5.711a1.913,1.913,0,0,0,1.915-1.912q0-.041,0-.081Z" transform="translate(-115.132 -114.777)" fill="#fff"/>\n      <path id="Path_984" data-name="Path 984" d="M7.665,138.7H1.955a1,1,0,0,1-1-1v-5.661a.468.468,0,0,0-.458-.478H.48a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74A1.914,1.914,0,0,0,1.914,139.7H7.665a.5.5,0,1,0,0-1Z" transform="translate(-0.001 -114.777)" fill="#fff"/>\n      <path id="Path_985" data-name="Path 985" d="M138.405,0l-.081,0h-5.711a.468.468,0,0,0-.478.458q0,.01,0,.02a.468.468,0,0,0,.458.478h5.731a1,1,0,0,1,1,1v5.7a.5.5,0,0,0,1,0V1.915A1.913,1.913,0,0,0,138.405,0Z" transform="translate(-115.277)" fill="#fff"/>\n      <path id="Path_986" data-name="Path 986" d="M32.226,33.132v14.81a1.227,1.227,0,0,0,1.227,1.227H48.265a1.217,1.217,0,0,0,1.227-1.206V33.132a1.217,1.217,0,0,0-1.206-1.227H33.453A1.227,1.227,0,0,0,32.226,33.132Zm16.251-.045a.19.19,0,0,1,0,.045v14.81a.19.19,0,0,1-.179.2H33.453a.19.19,0,0,1-.211-.168.182.182,0,0,1,0-.033V33.132a.19.19,0,0,1,.212-.212H48.265A.191.191,0,0,1,48.477,33.087Z" transform="translate(-28.359 -28.076)" fill="#fff"/>\n      <path id="Path_987" data-name="Path 987" d="M59.363,95.652h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,95.652Z" transform="translate(-51.309 -82.838)" fill="#fff"/>\n      <path id="Path_988" data-name="Path 988" d="M59.363,128.6h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,128.6Z" transform="translate(-51.309 -111.663)" fill="#fff"/>\n      <path id="Path_989" data-name="Path 989" d="M59.364,64.6h4.285a.488.488,0,0,0,.478-.478.478.478,0,0,0-.478-.478H59.364a.468.468,0,0,0-.478.458q0,.01,0,.02A.478.478,0,0,0,59.364,64.6Z" transform="translate(-51.443 -55.678)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n',zr='<svg id="finish" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="finishclip-path">\n      <rect id="Rectangle_2775" data-name="Rectangle 2775" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_584" data-name="Group 584" clip-path="url(#finishclip-path)">\n    <path id="Path_1526" data-name="Path 1526" d="M17.6,6.7l-6.691,9.081L6.313,12.11a.5.5,0,0,0-.625.781l5,4a.508.508,0,0,0,.378.1.493.493,0,0,0,.337-.2l7-9.5A.5.5,0,1,0,17.6,6.7" fill="currentColor"/>\n    <path id="Path_1527" data-name="Path 1527" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n  </g>\n</svg>\n',Gr='<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path class="cls-1" transform="scale(1, -1) translate(0, -14)"\n      d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n  </g>\n</svg>\n',Yr='\n<svg id="sharePng" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="sharePng">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path transform="scale(0.4, -0.4) translate(8, -30)" stroke="#fff" fill="#fff" stroke-width="1px" d="M19.489,15.009h0c-.008,0-.014,0-.022,0a4.465,4.465,0,0,0-3.749,2.052l-7-3.5a4.482,4.482,0,0,0,0-3.1l7-3.5a4.466,4.466,0,0,0,3.771,2.053l.018,0A4.516,4.516,0,1,0,15.282,6.06L8.257,9.574a4.49,4.49,0,1,0-4.793,6.814,4.548,4.548,0,0,0,1.043.122,4.468,4.468,0,0,0,3.755-2.056l7.018,3.511a4.485,4.485,0,1,0,4.209-2.956M17.13,1.914a3.508,3.508,0,1,1,2.366,6.1h-.01l-.011,0a3.476,3.476,0,0,1-3.112-1.932l0-.006a3.525,3.525,0,0,1,.769-4.162M3.693,15.415a3.5,3.5,0,1,1,3.931-4.967v0a3.47,3.47,0,0,1,0,3.119l0,0a3.479,3.479,0,0,1-3.931,1.842m17.636,7.066a3.5,3.5,0,0,1-4.971-4.53l0,0a3.477,3.477,0,0,1,3.126-1.936l.011,0a3.5,3.5,0,0,1,1.831,6.472" />\n  </g>\n</svg>\n',$r='<svg id="normalize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="19" height="24" viewBox="0 0 19 24">\n<defs>\n  <clipPath id="normalizeclip-path">\n    <rect id="Rectangle_2772" data-name="Rectangle 2772" width="19" height="24" fill="#fff"/>\n  </clipPath>\n</defs>\n<g id="Group_578" data-name="Group 578" clip-path="url(#normalizeclip-path)">\n  <path id="Path_1510" data-name="Path 1510" d="M3.483,18.987a.521.521,0,0,0,.52.522H14.9a.522.522,0,0,0,0-1.044H4a.521.521,0,0,0-.52.522" fill="#fff"/>\n  <path id="Path_1511" data-name="Path 1511" d="M4,13.52h8.75a.522.522,0,0,0,0-1.043H4A.522.522,0,0,0,4,13.52" fill="#fff"/>\n  <path id="Path_1512" data-name="Path 1512" d="M4,10.526h7.448a.522.522,0,0,0,0-1.043H4a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1513" data-name="Path 1513" d="M4,7.532H9.927a.522.522,0,0,0,0-1.043H4A.522.522,0,0,0,4,7.532" fill="#fff"/>\n  <path id="Path_1514" data-name="Path 1514" d="M4.005,15.471H4a.522.522,0,0,0,0,1.043l9.79.039h0a.522.522,0,0,0,0-1.043Z" fill="#fff"/>\n  <path id="Path_1515" data-name="Path 1515" d="M9.33,1.044H11.5A.522.522,0,0,0,11.5,0H9.33a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1516" data-name="Path 1516" d="M13.679,1.044h2.174a.522.522,0,0,0,0-1.043H13.679a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1517" data-name="Path 1517" d="M18.48,17.548a.516.516,0,0,0-.367.152c-.572-3.035-1.506-7.61-3.012-14.546a.524.524,0,0,0-.139-.256,1.432,1.432,0,0,0-.972-.437L6.806,1.044h.349A.522.522,0,0,0,7.155,0H4.981A.522.522,0,0,0,4.46.522a.426.426,0,0,0,.013.062L3.291.351A.516.516,0,0,0,2.805,0H1.765a.515.515,0,0,0-.124.025L1.515,0A1.52,1.52,0,0,0,0,1.52V22.481A1.519,1.519,0,0,0,1.515,24H18.432a.142.142,0,0,0,.022,0,.238.238,0,0,0,.026,0,.52.52,0,0,0,.52-.521V22.435a.522.522,0,0,0-.152-.369c-.047-.358-.111-.8-.2-1.329A.516.516,0,0,0,19,20.25V18.069a.519.519,0,0,0-.52-.521M1.515,22.957a.475.475,0,0,1-.474-.476V1.52a.491.491,0,0,1,.373-.486L13.89,3.495a.468.468,0,0,1,.233.061c1.449,6.682,3.613,17.143,3.823,19.4Z" fill="#fff"/>\n  <path id="Path_1518" data-name="Path 1518" d="M18.48,4.461a.52.52,0,0,0-.52.522v2.18a.52.52,0,1,0,1.04,0V4.983a.52.52,0,0,0-.52-.522" fill="#fff"/>\n  <path id="Path_1519" data-name="Path 1519" d="M18.29.366a.521.521,0,0,0-.638.824.827.827,0,0,1,.308.653V2.8A.52.52,0,1,0,19,2.8V1.843A1.877,1.877,0,0,0,18.29.366" fill="#fff"/>\n  <path id="Path_1520" data-name="Path 1520" d="M18.48,13.185a.52.52,0,0,0-.52.522v2.181a.52.52,0,1,0,1.04,0V13.707a.52.52,0,0,0-.52-.522" fill="#fff"/>\n  <path id="Path_1521" data-name="Path 1521" d="M18.48,8.823a.52.52,0,0,0-.52.522v2.181a.52.52,0,1,0,1.04,0V9.345a.52.52,0,0,0-.52-.522" fill="#fff"/>\n</g>\n</svg>\n',Xr='<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',qr='\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',Zr='\n<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n<defs>\n<style>\n  .cls-1 {\n    fill: #fff;\n    stroke-width: 0px;\n  }\n</style>\n</defs>\n<g id="Layer_1-2">\n<path class="cls-1"\n  d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n<path class="cls-1"\n  d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n<path class="cls-1"\n  d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n<path class="cls-1"\n  d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n<path class="cls-1"\n  d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n</g>\n</svg>\n';let Jr=class{constructor(t,e){var i,n;this.resources=t,this.config=e,this.imageEditorView=null,this.layer=null,this.config.utilizedTemplateNames={detect:(null===(i=e.utilizedTemplateNames)||void 0===i?void 0:i.detect)||Lr,normalize:(null===(n=e.utilizedTemplateNames)||void 0===n?void 0:n.normalize)||Or}}async initialize(){if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create an Correction View Container element");const t=document.createElement("div");Object.assign(t.style,{display:"flex",width:"100%",height:"100%",backgroundColor:"#575757",fontSize:"12px",flexDirection:"column",alignItems:"center"});const e=document.createElement("div");Object.assign(e.style,{width:"100%",height:"100%"}),t.appendChild(e),Nr(this.config.container).appendChild(t),this.imageEditorView=await Go.createInstance(e),this.layer=this.imageEditorView.createDrawingLayer(),this.imageEditorView.setOriginalImage(this.resources.result.originalImageResult),this.setupDrawingLayerStyle(),this.setupInitialDetectedQuad(),this.setupCorrectionControls(),this.setupQuadConstraints()}setupDrawingLayerStyle(){const t=kn.createDrawingStyle({lineWidth:5,fillStyle:"transparent",strokeStyle:"#FE8E14",paintMode:"stroke"});this.layer.setDefaultStyle(t)}setupQuadConstraints(){const t=this.layer.fabricCanvas;t.defaultCursor="default",t.hoverCursor="default",t.moveCursor="default",t.on("object:scaling",(e=>{const i=e.target,n=i.points,s=this.getCanvasBounds();n.forEach((t=>{t.x=Math.max(0,Math.min(s.width,t.x)),t.y=Math.max(0,Math.min(s.height,t.y))})),i.set({points:n,dirty:!0}),t.renderAll()})),t.on("object:modified",(e=>{const i=e.target;if(!i)return;const n=i.points,s=this.getCanvasBounds();let o=!1;n.forEach((t=>{(t.x<0||t.x>s.width||t.y<0||t.y>s.height)&&(o=!0)})),o&&(n.forEach((t=>{t.x=Math.max(0,Math.min(s.width,t.x)),t.y=Math.max(0,Math.min(s.height,t.y))})),i.set({points:n,dirty:!0}),t.renderAll())}))}getCanvasBounds(){const t=this.layer.fabricCanvas;return{width:t.getWidth(),height:t.getHeight()}}addQuadToLayer(t){this.layer.clearDrawingItems();const e=t._getFabricObject();e.cornerSize=60,e.lockMovementX=!0,e.lockMovementY=!0,e.on("mousedown",(function(t){var e;t.target&&t.target.controls&&(this.cornerColor="transparent",this.dirty=!0,null===(e=this.canvas)||void 0===e||e.renderAll())})),e.on("mouseup",(function(){var t;this.cornerColor="#FE8E14",this.dirty=!0,null===(t=this.canvas)||void 0===t||t.renderAll()})),this.layer.renderAll(),this.layer.addDrawingItems([t]),this.layer.fabricCanvas.setActiveObject(e),this.layer.fabricCanvas.renderAll()}setupInitialDetectedQuad(){let t;if(this.resources.result.detectedQuadrilateral)t=new Fi(this.resources.result.detectedQuadrilateral);else{const{width:e,height:i}=this.resources.result.originalImageResult;t=new Fi({points:[{x:0,y:0},{x:e,y:0},{x:e,y:i},{x:0,y:i}],area:e*i})}this.addQuadToLayer(t)}createControls(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p;const{toolbarButtonsConfig:g}=this.config;return Ur([{id:"dds-correction-fullImage",icon:(null===(t=null==g?void 0:g.fullImage)||void 0===t?void 0:t.icon)||Hr,label:(null===(e=null==g?void 0:g.fullImage)||void 0===e?void 0:e.label)||"Full Image",className:`${(null===(i=null==g?void 0:g.fullImage)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==g?void 0:g.fullImage)||void 0===n?void 0:n.isHidden)||!1,onClick:()=>this.setFullImageBoundary()},{id:"dds-correction-detectBorders",icon:(null===(s=null==g?void 0:g.detectBorders)||void 0===s?void 0:s.icon)||jr,label:(null===(o=null==g?void 0:g.detectBorders)||void 0===o?void 0:o.label)||"Detect Borders",className:`${(null===(r=null==g?void 0:g.detectBorders)||void 0===r?void 0:r.className)||""}`,isHidden:(null===(a=null==g?void 0:g.detectBorders)||void 0===a?void 0:a.isHidden)||!1,onClick:()=>this.setBoundaryAutomatically()},{id:"dds-correction-apply",icon:(null===(l=null==g?void 0:g.apply)||void 0===l?void 0:l.icon)||(!1===(null===(h=this.config)||void 0===h?void 0:h._showResultView)?qr:zr),label:(null===(c=null==g?void 0:g.apply)||void 0===c?void 0:c.label)||(!1===(null===(d=this.config)||void 0===d?void 0:d._showResultView)?"Done":"Apply"),className:`${(null===(u=null==g?void 0:g.apply)||void 0===u?void 0:u.className)||""}`,isHidden:(null===(p=null==g?void 0:g.apply)||void 0===p?void 0:p.isHidden)||!1,onClick:()=>this.confirmCorrection()}])}setupCorrectionControls(){try{const t=this.createControls(),e=Nr(this.config.container).firstElementChild;e&&e.appendChild(t)}catch(t){throw console.error("Error setting up correction controls:",t),new Error(`Failed to setup correction controls: ${t.message}`)}}setFullImageBoundary(){if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");const{width:t,height:e}=this.resources.result.originalImageResult,i=new Fi({points:[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],area:t*e});this.addQuadToLayer(i)}async setBoundaryAutomatically(){var t;if(this.config.templateFilePath)await this.resources.cvRouter.initSettings(this.config.templateFilePath);else{let t=await this.resources.cvRouter.getSimplifiedSettings(this.config.utilizedTemplateNames.detect);t.capturedResultItemTypes|=xt.CRIT_ORIGINAL_IMAGE,await this.resources.cvRouter.updateSettings(this.config.utilizedTemplateNames.detect,t)}this.resources.cvRouter.maxImageSideLength=1/0;const e=null===(t=(await this.resources.cvRouter.capture(this.resources.result.originalImageResult,"DetectDocumentBoundaries_Default")).items.find((t=>t.type===xt.CRIT_DETECTED_QUAD)))||void 0===t?void 0:t.location;e?this.addQuadToLayer(new Fi(e)):this.setFullImageBoundary()}async confirmCorrection(){var t;const e=this.layer.getDrawingItems()[0];if(!e)throw new Error("No quad drawing item found");const i=e.getQuad(),n=await this.correctImage(null==i?void 0:i.points);if(n){const e=Object.assign(Object.assign({},this.resources.result),{correctedImageResult:n,detectedQuadrilateral:i});this.resources.onResultUpdated&&this.resources.onResultUpdated(e),(null===(t=this.config)||void 0===t?void 0:t.onFinish)&&this.config.onFinish(e),this.currentCorrectionResolver&&this.currentCorrectionResolver(e)}else this.currentCorrectionResolver&&this.currentCorrectionResolver(this.resources.result);this.dispose(),this.hideView()}async launch(){var t,e;try{return(null===(t=this.resources.result)||void 0===t?void 0:t.correctedImageResult)?(Nr(this.config.container).textContent="",await this.initialize(),Nr(this.config.container).style.display="flex",new Promise((t=>{this.currentCorrectionResolver=t}))):{status:{code:Br.RS_FAILED,message:"No image available for correction"}}}catch(t){let i=(null==t?void 0:t.message)||t;if(console.error(i),!(null===(e=this.resources.result)||void 0===e?void 0:e.correctedImageResult))return{status:{code:Br.RS_FAILED,message:i}}}}hideView(){Nr(this.config.container).style.display="none"}async correctImage(t){var e;const{cvRouter:i}=this.resources;this.config.templateFilePath&&await this.resources.cvRouter.initSettings(this.config.templateFilePath);const n=await i.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);n.roiMeasuredInPercentage=!1,n.roi.points=t,await i.updateSettings(this.config.utilizedTemplateNames.normalize,n);const s=await i.capture(this.resources.result.originalImageResult,this.config.utilizedTemplateNames.normalize);if(null===(e=null==s?void 0:s.normalizedImageResultItems)||void 0===e?void 0:e[0])return s.normalizedImageResultItems[0]}dispose(){var t,e;(null===(t=this.imageEditorView)||void 0===t?void 0:t.dispose)&&this.imageEditorView.dispose(),this.layer=null,(null===(e=this.config)||void 0===e?void 0:e.container)&&(Nr(this.config.container).textContent=""),this.currentCorrectionResolver=void 0}},Kr=class{showScannerLoadingOverlay(t){const e=Nr(this.config.container);this.loadingScreen=function(t,e={}){const{message:i,spinnerSize:n=32}=e,s=document.createElement("div");s.className="dds-loading-screen";const o=document.createElement("div");o.className="dds-loading";const r=document.createElement("div");r.className="dds-loading-content";const a=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(r.innerHTML=a,i){const t=document.createElement("div");t.className="dds-loading-message",t.textContent=i,r.appendChild(t)}return o.appendChild(r),s.appendChild(o),t.appendChild(s),{element:s,updateMessage:t=>{let e=o.querySelector(".dds-loading-message");null!==t?e?e.textContent=t:(e=document.createElement("div"),e.className="dds-loading-message",e.textContent=t,r.appendChild(e)):null==e||e.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout((()=>{var t;null===(t=s.parentNode)||void 0===t||t.removeChild(s)}),200))}}}(e,{message:t}),e.style.display="block",e.style.position="relative"}hideScannerLoadingOverlay(t=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,t&&(Nr(this.config.container).style.display="none"))}constructor(t,e){var i,n;this.resources=t,this.config=e,this.boundsDetectionEnabled=!1,this.smartCaptureEnabled=!1,this.autoCropEnabled=!1,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,closeScannerBtn:null,takePhotoBtn:null,boundsDetectionBtn:null,smartCaptureBtn:null,autoCropBtn:null},this.loadingScreen=null,this.config.utilizedTemplateNames={detect:(null===(i=e.utilizedTemplateNames)||void 0===i?void 0:i.detect)||Lr,normalize:(null===(n=e.utilizedTemplateNames)||void 0===n?void 0:n.normalize)||Or}}async initialize(){if(!this.initialized){Wr("dds-loading-screen-style",'\n  .dds-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dds-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dds-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dds-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dds-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dds-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n');try{const{cameraView:t,cameraEnhancer:e,cvRouter:i}=this.resources;t.setScanRegionMaskStyle(Object.assign(Object.assign({},t.getScanRegionMaskStyle()),{strokeStyle:"transparent"})),i.setInput(e);const n=new Rr;if(n.enableResultCrossVerification(xt.CRIT_DETECTED_QUAD,!0),n.enableResultDeduplication(xt.CRIT_DETECTED_QUAD,!0),await i.addResultFilter(n),this.config.templateFilePath)await i.initSettings(this.config.templateFilePath);else{let t=await i.getSimplifiedSettings(this.config.utilizedTemplateNames.detect);t.capturedResultItemTypes|=xt.CRIT_ORIGINAL_IMAGE,await i.updateSettings(this.config.utilizedTemplateNames.detect,t)}i.maxImageSideLength=1/0;const s=new Ne;s.onCapturedResultReceived=t=>this.handleBoundsDetection(t),await i.addResultReceiver(s),this.smartCaptureEnabled=!1,this.boundsDetectionEnabled=!0,this.initialized=!0}catch(t){let e=(null==t?void 0:t.message)||t;console.error(e),alert(e),this.closeCamera();const i={status:{code:Br.RS_FAILED,message:"DDS Init error"}};this.currentScanResolver(i)}}}async initializeElements(){const t=Nr(this.config.container),e=t.children[t.children.length-1];if(!(null==e?void 0:e.shadowRoot))throw new Error("Shadow root not found");this.DCE_ELEMENTS={selectCameraBtn:e.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:e.shadowRoot.querySelector(".dce-mn-upload-image-icon"),closeScannerBtn:e.shadowRoot.querySelector(".dce-mn-close"),takePhotoBtn:e.shadowRoot.querySelector(".dce-mn-take-photo"),boundsDetectionBtn:e.shadowRoot.querySelector(".dce-mn-bounds-detection"),smartCaptureBtn:e.shadowRoot.querySelector(".dce-mn-smart-capture"),autoCropBtn:e.shadowRoot.querySelector(".dce-mn-auto-crop")},await this.toggleBoundsDetection(this.boundsDetectionEnabled),await this.toggleSmartCapture(this.smartCaptureEnabled),await this.toggleAutoCrop(this.autoCropEnabled),this.assignDCEClickEvents(),!1===this.config._showCorrectionView&&(this.DCE_ELEMENTS.smartCaptureBtn.style.display="none"),this.initializedDCE=!0}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");const t={passive:!0};this.takePhoto=this.takePhoto.bind(this),this.toggleBoundsDetection=this.toggleBoundsDetection.bind(this),this.toggleSmartCapture=this.toggleSmartCapture.bind(this),this.toggleAutoCrop=this.toggleAutoCrop.bind(this),this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.takePhotoBtn.addEventListener("click",this.takePhoto,t),this.DCE_ELEMENTS.boundsDetectionBtn.addEventListener("click",(async()=>await this.toggleBoundsDetection()),t),this.DCE_ELEMENTS.smartCaptureBtn.addEventListener("click",(async()=>await this.toggleSmartCapture()),t),this.DCE_ELEMENTS.autoCropBtn.addEventListener("click",(async()=>await this.toggleAutoCrop()),t),this.DCE_ELEMENTS.closeScannerBtn.addEventListener("click",(async()=>await this.handleCloseBtn()),t),this.DCE_ELEMENTS.selectCameraBtn.addEventListener("click",(t=>{t.stopPropagation(),this.toggleSelectCameraBox()}),t),this.DCE_ELEMENTS.uploadImageBtn.addEventListener("click",(()=>this.uploadImage()),t)}async handleCloseBtn(){this.closeCamera(),this.currentScanResolver&&this.currentScanResolver({status:{code:Br.RS_CANCELLED,message:"Cancelled"}})}attachOptionClickListeners(){const t=Nr(this.config.container),e=t.children[t.children.length-1];if(!(null==e?void 0:e.shadowRoot))return;const i=e.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...e.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...e.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach((t=>{t.addEventListener("click",(()=>{"none"!==i.style.display&&this.toggleSelectCameraBox()}))}))}highlightCameraAndResolutionOption(){const t=Nr(this.config.container),e=t.children[t.children.length-1];if(!(null==e?void 0:e.shadowRoot))return;const i=e.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),n=i.querySelectorAll(".dce-mn-camera-option"),s=i.querySelectorAll(".dce-mn-resolution-option"),o=this.resources.cameraEnhancer.getSelectedCamera(),r=this.resources.cameraEnhancer.getResolution();n.forEach((t=>{const e=t;e.getAttribute("data-davice-id")===(null==o?void 0:o.deviceId)?e.style.border="2px solid #fe814a":e.style.border="none"})),s.forEach((t=>{const e=t;e.getAttribute("data-height")===`${r.height}`?e.style.border="2px solid #fe814a":e.style.border="none"}))}toggleSelectCameraBox(){const t=Nr(this.config.container),e=t.children[t.children.length-1];if(!(null==e?void 0:e.shadowRoot))return;const i=e.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),i.click()}async uploadImage(){var t,e,i,n,s;const o=document.createElement("input");o.type="file",o.accept="image/*",o.style.display="none",document.body.appendChild(o);try{this.showScannerLoadingOverlay("Processing image...");const r=await new Promise(((t,e)=>{o.onchange=i=>{var n;const s=null===(n=i.target.files)||void 0===n?void 0:n[0];(null==s?void 0:s.type.startsWith("image/"))?t(s):e(new Error("Please select an image file"))},o.addEventListener("cancel",(()=>this.hideScannerLoadingOverlay(!1))),o.click()}));if(!r)return void this.hideScannerLoadingOverlay(!1);this.closeCamera(!1);const{blob:a}=await this.fileToBlob(r);this.capturedResultItems=(await this.resources.cvRouter.capture(a,this.config.utilizedTemplateNames.detect)).items,this.originalImageData=null===(t=this.capturedResultItems[0])||void 0===t?void 0:t.imageData;let l=null;if((null===(e=this.capturedResultItems)||void 0===e?void 0:e.length)<=1){this.capturedResultItems=[];const{width:t,height:e}=this.originalImageData;l={points:[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],area:e*t}}else l=null===(i=this.capturedResultItems.find((t=>t.type===xt.CRIT_DETECTED_QUAD)))||void 0===i?void 0:i.location;const h=await this.normalizeImage(l.points,this.originalImageData),c={status:{code:Br.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,correctedImageResult:h,detectedQuadrilateral:l,_flowType:Fr.UPLOADED_IMAGE};null===(s=(n=this.resources).onResultUpdated)||void 0===s||s.call(n,c),this.currentScanResolver(c),this.hideScannerLoadingOverlay(!0)}catch(t){let e=(null==t?void 0:t.message)||t;console.error(e),alert(e),this.closeCamera();const i={status:{code:Br.RS_FAILED,message:"Error processing uploaded image"}};this.currentScanResolver(i)}finally{document.body.removeChild(o)}}async fileToBlob(t){return new Promise(((e,i)=>{const n=new Image;n.onload=()=>{const s=document.createElement("canvas");s.width=n.width,s.height=n.height;const o=s.getContext("2d");null==o||o.drawImage(n,0,0),s.toBlob((t=>{t?e({blob:t,width:n.width,height:n.height}):i(new Error("Failed to create blob"))}),t.type)},n.onerror=i,n.src=URL.createObjectURL(t)}))}async toggleAutoCaptureAnimation(t){const e=Nr(this.config.container),i=e.children[e.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-loading-auto-capture-animation");n.style.borderLeftColor=t?"transparent":"#fe8e14",n.style.borderBottomColor=t?"transparent":"#fe8e14"}async toggleBoundsDetection(t){const e=Nr(this.config.container),i=e.children[e.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-bounds-detection"),s=i.shadowRoot.querySelector(".dce-mn-bounds-detection-on"),o=i.shadowRoot.querySelector(".dce-mn-bounds-detection-off");if(!s||!o)return;this.toggleAutoCaptureAnimation(!1);const r=void 0!==t?t:!this.boundsDetectionEnabled;r||await this.toggleSmartCapture(!1);const{cvRouter:a}=this.resources;this.boundsDetectionEnabled=r,n.style.color=this.boundsDetectionEnabled?"#fe814a":"#fff",o.style.display=this.boundsDetectionEnabled?"none":"block",s.style.display=this.boundsDetectionEnabled?"block":"none",this.initialized&&this.boundsDetectionEnabled?await a.startCapturing(this.config.utilizedTemplateNames.detect):this.initialized&&!this.boundsDetectionEnabled&&this.stopCapturing()}async toggleSmartCapture(t){const e=Nr(this.config.container),i=e.children[e.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-smart-capture"),s=i.shadowRoot.querySelector(".dce-mn-smart-capture-on"),o=i.shadowRoot.querySelector(".dce-mn-smart-capture-off");if(!s||!o)return;const r=void 0!==t?t:!this.smartCaptureEnabled;this.toggleAutoCaptureAnimation(r),r&&!this.boundsDetectionEnabled?await this.toggleBoundsDetection(!0):r||!1===this.config._showCorrectionView||await this.toggleAutoCrop(!1),this.smartCaptureEnabled=r,n.style.color=this.smartCaptureEnabled?"#fe814a":"#fff",o.style.display=this.smartCaptureEnabled?"none":"block",s.style.display=this.smartCaptureEnabled?"block":"none",this.crossVerificationCount=0}async toggleAutoCrop(t){const e=Nr(this.config.container),i=e.children[e.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-auto-crop"),s=i.shadowRoot.querySelector(".dce-mn-auto-crop-on"),o=i.shadowRoot.querySelector(".dce-mn-auto-crop-off");if(!s||!o)return;const r=void 0!==t?t:!this.autoCropEnabled;!r||this.boundsDetectionEnabled&&this.smartCaptureEnabled||(await this.toggleBoundsDetection(!0),await this.toggleSmartCapture(!0)),r||!1!==this.config._showCorrectionView||await this.toggleSmartCapture(!1),this.autoCropEnabled=r,n.style.color=this.autoCropEnabled?"#fe814a":"#fff",o.style.display=this.autoCropEnabled?"none":"block",s.style.display=this.autoCropEnabled?"block":"none"}async openCamera(){try{this.showScannerLoadingOverlay("Initializing camera...");const{cameraEnhancer:t,cameraView:e}=this.resources,i=Nr(this.config.container);if(i.style.display="block",t.isOpen())t.isPaused()&&await t.resume();else{const n=e.getUIElement();n.parentElement||i.append(n),await t.open()}!this.initializedDCE&&t.isOpen()&&await this.initializeElements()}catch(t){let e=(null==t?void 0:t.message)||t;console.error(e),alert(e),this.closeCamera();const i={status:{code:Br.RS_FAILED,message:"DDS Open Camera Error"}};this.currentScanResolver(i)}finally{this.hideScannerLoadingOverlay()}}closeCamera(t=!0){const{cameraEnhancer:e,cameraView:i}=this.resources,n=Nr(this.config.container);n.style.display=t?"none":"block",i.getUIElement().parentElement&&n.removeChild(i.getUIElement()),e.close(),this.stopCapturing()}pauseCamera(){const{cameraEnhancer:t}=this.resources;t.pause()}stopCapturing(){const{cameraView:t,cvRouter:e}=this.resources;e.stopCapturing(),t.clearAllInnerDrawingItems()}getFlowType(){return this.autoCropEnabled?Fr.AUTO_CROP:this.smartCaptureEnabled?Fr.SMART_CAPTURE:Fr.MANUAL}async takePhoto(){var t,e;try{const{cameraEnhancer:i,onResultUpdated:n}=this.resources,s=!this.boundsDetectionEnabled||this.boundsDetectionEnabled&&(null===(t=this.capturedResultItems)||void 0===t?void 0:t.length)<=1;this.originalImageData=s?i.fetchImage():this.originalImageData;let o=null,r=null;if(s){this.capturedResultItems=[];const{width:t,height:e}=this.originalImageData;r={points:[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],area:e*t}}else r=null===(e=this.capturedResultItems.find((t=>t.type===xt.CRIT_DETECTED_QUAD)))||void 0===e?void 0:e.location;const a=this.getFlowType();await this.toggleSmartCapture(!1),this.closeCamera(),this.showScannerLoadingOverlay("Processing image..."),o=await this.normalizeImage(r.points,this.originalImageData),this.hideScannerLoadingOverlay(!0);const l={status:{code:Br.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,correctedImageResult:o,detectedQuadrilateral:r,_flowType:a};null==n||n(l),this.currentScanResolver(l)}catch(t){let e=(null==t?void 0:t.message)||t;console.error(e),alert(e),this.closeCamera();const i={status:{code:Br.RS_FAILED,message:"Error capturing image"}};this.currentScanResolver(i)}}async handleBoundsDetection(t){var e;if(this.capturedResultItems=t.items,!(null===(e=t.items)||void 0===e?void 0:e.length))return;const i=t.items.filter((t=>t.type===xt.CRIT_ORIGINAL_IMAGE));this.originalImageData=i.length&&i[0].imageData,(this.smartCaptureEnabled||this.autoCropEnabled)&&this.handleAutoCaptureMode(t)}async handleAutoCaptureMode(t){t.items.length<=1?this.crossVerificationCount=0:(1===t.detectedQuadResultItems[0].crossVerificationStatus&&this.crossVerificationCount++,this.crossVerificationCount>=2&&(this.crossVerificationCount=0,await this.takePhoto()))}async launch(){try{await this.initialize();const{cvRouter:t,cameraEnhancer:e}=this.resources;return new Promise((async i=>{this.currentScanResolver=i,await this.openCamera(),this.boundsDetectionEnabled&&await t.startCapturing(this.config.utilizedTemplateNames.detect),e.setPixelFormat(a.IPF_ABGR_8888),this.crossVerificationCount=0}))}catch(t){let e=(null==t?void 0:t.message)||t;console.error("DDS Launch error: ",e),this.closeCamera();const i={status:{code:Br.RS_FAILED,message:"DDS Launch error"}};this.currentScanResolver(i)}}async normalizeImage(t,e){var i;const{cvRouter:n,cameraEnhancer:s}=this.resources,o=await n.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);o.roiMeasuredInPercentage=!1,o.roi.points=t,await n.updateSettings(this.config.utilizedTemplateNames.normalize,o);const r=await n.capture(e,this.config.utilizedTemplateNames.normalize);if(null===(i=null==r?void 0:r.normalizedImageResultItems)||void 0===i?void 0:i[0])return r.normalizedImageResultItems[0]}},Qr=class{constructor(t,e,i,n){this.resources=t,this.config=e,this.scannerView=i,this.correctionView=n}async launch(){try{return Nr(this.config.container).textContent="",await this.initialize(),Nr(this.config.container).style.display="flex",new Promise((t=>{this.currentScanResultViewResolver=t}))}catch(t){let e=(null==t?void 0:t.message)||t;throw console.error(e),e}}async handleUploadAndShareBtn(t){var e;try{const{result:i}=this.resources;if(!(null==i?void 0:i.correctedImageResult))throw new Error("No image to upload");"upload"===t&&(null===(e=this.config)||void 0===e?void 0:e.onUpload)?await this.config.onUpload(i):"share"===t&&await this.handleShare()}catch(t){console.error("Error on upload/share:",t),alert("Failed")}}async handleShare(){var t;try{const{result:e}=this.resources;if(!(null==e?void 0:e.correctedImageResult))throw new Error("No image result provided");const i=await e.correctedImageResult.toBlob("image/png");if(!i)throw new Error("Failed to convert image to blob");const n=new File([i],`document-${Date.now()}.png`,{type:i.type});if(navigator.share&&(null===(t=navigator.canShare)||void 0===t?void 0:t.call(navigator,{files:[n]})))await navigator.share({files:[n],title:"Dynamsoft Document Scanner Shared Image"});else{const t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download=n.name,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(t)}return!0}catch(t){if("AbortError"!==t.name){let e=(null==t?void 0:t.message)||t;console.error("Error sharing image:",e),alert(`Error sharing image: ${e}`)}}}async handleCorrectImage(){try{if(!this.correctionView)return void console.error("Correction View not initialized");this.hideView();const t=await this.correctionView.launch();t.correctedImageResult&&(this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{correctedImageResult:t.correctedImageResult})),this.dispose(!0),await this.initialize(),Nr(this.config.container).style.display="flex")}catch(t){throw console.error("DocumentResultView - Handle Correction View Error:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:Br.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}async handleRetake(){var t;try{if(!this.scannerView)return void console.error("Correction View not initialized");this.hideView();const e=await this.scannerView.launch();if((null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.code)===Br.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(e));this.resources.onResultUpdated&&((null==e?void 0:e.status.code)===Br.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==e?void 0:e.status.code)===Br.RS_SUCCESS&&this.resources.onResultUpdated(e)),this.correctionView&&(null==e?void 0:e._flowType)&&Vr(null==e?void 0:e._flowType)&&await this.handleCorrectImage(),this.dispose(!0),await this.initialize(),Nr(this.config.container).style.display="flex"}catch(t){throw console.error("Error in retake handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:Br.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}async handleDone(){var t;try{(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(t){throw console.error("Error in done handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:Br.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}createControls(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x;const{toolbarButtonsConfig:w,onUpload:b}=this.config,C=new Blob(["mock-png-data"],{type:"image/png"}),S=new File([C],"test.png",{type:"image/png"}),_="share"in navigator&&navigator.canShare({files:[S]});return Ur([{id:"dds-scanResult-retake",icon:(null===(t=null==w?void 0:w.retake)||void 0===t?void 0:t.icon)||Xr,label:(null===(e=null==w?void 0:w.retake)||void 0===e?void 0:e.label)||"Re-take",onClick:()=>this.handleRetake(),className:`${(null===(i=null==w?void 0:w.retake)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==w?void 0:w.retake)||void 0===n?void 0:n.isHidden)||!1,isDisabled:!this.scannerView},{id:"dds-scanResult-correct",icon:(null===(s=null==w?void 0:w.correct)||void 0===s?void 0:s.icon)||$r,label:(null===(o=null==w?void 0:w.correct)||void 0===o?void 0:o.label)||"Correction",onClick:()=>this.handleCorrectImage(),className:`${(null===(r=null==w?void 0:w.correct)||void 0===r?void 0:r.className)||""}`,isHidden:(null===(a=null==w?void 0:w.correct)||void 0===a?void 0:a.isHidden)||!1,isDisabled:!this.correctionView},{id:"dds-scanResult-share",icon:(null===(l=null==w?void 0:w.share)||void 0===l?void 0:l.icon)||(_?Yr:Zr),label:(null===(h=null==w?void 0:w.share)||void 0===h?void 0:h.label)||(_?"Share":"Download"),className:`${(null===(c=null==w?void 0:w.share)||void 0===c?void 0:c.className)||""}`,isHidden:(null===(d=null==w?void 0:w.share)||void 0===d?void 0:d.isHidden)||!1,onClick:()=>this.handleUploadAndShareBtn("share")},{id:"dds-scanResult-upload",icon:(null===(u=null==w?void 0:w.upload)||void 0===u?void 0:u.icon)||Gr,label:(null===(p=null==w?void 0:w.upload)||void 0===p?void 0:p.label)||"Upload",className:`${(null===(g=null==w?void 0:w.upload)||void 0===g?void 0:g.className)||""}`,isHidden:!b||(null===(f=null==w?void 0:w.upload)||void 0===f?void 0:f.isHidden)||!1,isDisabled:!b,onClick:()=>this.handleUploadAndShareBtn("upload")},{id:"dds-scanResult-done",icon:(null===(m=null==w?void 0:w.done)||void 0===m?void 0:m.icon)||qr,label:(null===(v=null==w?void 0:w.done)||void 0===v?void 0:v.label)||"Done",className:`${(null===(y=null==w?void 0:w.done)||void 0===y?void 0:y.className)||""}`,isHidden:(null===(x=null==w?void 0:w.done)||void 0===x?void 0:x.isHidden)||!1,onClick:()=>this.handleDone()}])}async initialize(){var t;try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");const e=document.createElement("div");Object.assign(e.style,{display:"flex",width:"100%",height:"100%",backgroundColor:"#575757",fontSize:"12px",flexDirection:"column",alignItems:"center"});const i=document.createElement("div");Object.assign(i.style,{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"0"});const n=null===(t=this.resources.result.correctedImageResult)||void 0===t?void 0:t.toCanvas();Object.assign(n.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),i.appendChild(n),e.appendChild(i);const s=this.createControls();e.appendChild(s),Nr(this.config.container).appendChild(e)}catch(t){let e=(null==t?void 0:t.message)||t;console.error(e),alert(e)}}hideView(){Nr(this.config.container).style.display="none"}dispose(t=!1){Nr(this.config.container).textContent="",t||(this.currentScanResultViewResolver=void 0)}};const ta={rootDirectory:"https://cdn.jsdelivr.net/npm/"};let ea=class{constructor(t){this.config=t,this.resources={},this.isInitialized=!1,this.isCapturing=!1}async initialize(){if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,correctionView:this.correctionView,scanResultView:this.scanResultView}};try{this.initializeDDSConfig(),await this.initializeDCVResources(),this.resources.onResultUpdated=t=>{this.resources.result=t};const t={};return this.config.scannerViewConfig&&(this.scannerView=new Kr(this.resources,this.config.scannerViewConfig),t.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.correctionViewConfig&&(this.correctionView=new Jr(this.resources,this.config.correctionViewConfig),t.correctionView=this.correctionView),this.config.resultViewConfig&&(this.scanResultView=new Qr(this.resources,this.config.resultViewConfig,this.scannerView,this.correctionView),t.scanResultView=this.scanResultView),this.isInitialized=!0,{resources:this.resources,components:t}}catch(t){this.isInitialized=!1;let e=(null==t?void 0:t.message)||t;throw new Error(`Initialization Failed: ${e}`)}}async initializeDCVResources(){var t,e,i,n;try{Jt.initLicense((null===(t=this.config)||void 0===t?void 0:t.license)||"",!0),yt.engineResourcePaths=(n=null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)&&0!==Object.keys(n).length?this.config.engineResourcePaths:ta,yt.loadWasm(["DDN"]),this.resources.cameraView=await Fn.createInstance(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath),this.resources.cameraEnhancer=await Oo.createInstance(this.resources.cameraView),this.resources.cvRouter=await Le.createInstance()}catch(t){let e=(null==t?void 0:t.message)||t;throw new Error(`Resource Initialization Failed: ${e}`)}}shouldCreateDefaultContainer(){var t,e,i;const n=!this.config.container,s=!((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)||(null===(i=this.config.correctionViewConfig)||void 0===i?void 0:i.container));return n&&s}createDefaultDDSContainer(){const t=document.createElement("div");return t.className="dds-main-container",Object.assign(t.style,{display:"none",height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(t),t}checkForTemporaryLicense(t){return!(null==t?void 0:t.length)||(null==t?void 0:t.startsWith("A"))||(null==t?void 0:t.startsWith("L"))||(null==t?void 0:t.startsWith("P"))||(null==t?void 0:t.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":t}validateViewConfigs(){var t,e;if(!this.config.container){if(this.config.showCorrectionView&&!(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container))throw new Error("CorrectionView container is required when showCorrectionView is true and no main container is provided");if(this.config.showResultView&&!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container))throw new Error("ResultView container is required when showResultView is true and no main container is provided")}}showCorrectionView(){var t,e;return!1!==this.config.showCorrectionView&&(this.config.container?!(void 0!==this.config.showCorrectionView||!(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container)&&!this.config.container)||!!this.config.showCorrectionView:this.config.showCorrectionView&&!!(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container))}showResultView(){var t,e;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container))}initializeDDSConfig(){var t,e,i,n,s,o,r;this.validateViewConfigs(),this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultDDSContainer():this.config.container&&(this.config.container=Nr(this.config.container));const a=this.config.container?this.createViewContainers(Nr(this.config.container)):{},l={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:{detect:(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t.detect)||Lr,normalize:(null===(e=this.config.utilizedTemplateNames)||void 0===e?void 0:e.normalize)||Or},templateFilePath:(null===(i=this.config)||void 0===i?void 0:i.templateFilePath)||null},h=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:a[Mr.Scanner]||(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.cameraEnhancerUIPath)||"https://cdn.jsdelivr.net/npm/dynamsoft-document-scanner@1.1.1/dist/document-scanner.ui.html",templateFilePath:l.templateFilePath,utilizedTemplateNames:l.utilizedTemplateNames,_showCorrectionView:this.showCorrectionView()}),c=this.showCorrectionView()?Object.assign(Object.assign({},this.config.correctionViewConfig),{container:a[Mr.Correction]||(null===(o=this.config.correctionViewConfig)||void 0===o?void 0:o.container)||null,templateFilePath:l.templateFilePath,utilizedTemplateNames:l.utilizedTemplateNames,_showResultView:this.showResultView()}):void 0,d=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{container:a[Mr.Result]||(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)||null}):void 0;Object.assign(this.config,Object.assign(Object.assign({},l),{scannerViewConfig:h,correctionViewConfig:c,resultViewConfig:d}))}createViewContainers(t){t.textContent="";const e=[Mr.Scanner];return this.showCorrectionView()&&e.push(Mr.Correction),this.showResultView()&&e.push(Mr.Result),e.reduce(((e,i)=>{const n=document.createElement("div");return n.className=`dds-${i}-view-container`,Object.assign(n.style,{height:"100%",width:"100%",display:"none",position:"relative"}),t.append(n),e[i]=n,e}),{})}dispose(){var t,e,i;this.scanResultView&&(this.scanResultView.dispose(),this.scanResultView=null),this.correctionView&&(this.correctionView.dispose(),this.correctionView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const n=t=>{const e=Nr(t);e&&(e.style.display="none",e.textContent="")};n(this.config.container),n(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container),n(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container),n(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container),this.isInitialized=!1}async launch(){if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0;const{components:t}=await this.initialize();if(this.config.container&&(Nr(this.config.container).style.display="block"),!t.scannerView&&this.resources.result){if(t.correctionView)return await t.correctionView.launch();if(t.scanResultView)return await t.scanResultView.launch()}if(!t.scannerView&&!this.resources.result)throw new Error("Scanner view is required when no previous result exists");if(t.scannerView){const e=await t.scannerView.launch();if((null==e?void 0:e.status.code)!==Br.RS_SUCCESS)return{status:{code:null==e?void 0:e.status.code,message:(null==e?void 0:e.status.message)||"Failed to capture image"}};if(t.correctionView&&t.scanResultView&&Vr(e._flowType))return await t.correctionView.launch(),await t.scanResultView.launch();if(t.correctionView&&!t.scanResultView)return await t.correctionView.launch();if(t.scanResultView)return await t.scanResultView.launch()}return this.resources.result}catch(t){return console.error("Document capture flow failed:",(null==t?void 0:t.message)||t),{status:{code:Br.RS_FAILED,message:`Document capture flow failed. ${(null==t?void 0:t.message)||t}`}}}finally{this.isCapturing=!1,this.dispose()}}};const ia={DocumentScanner:ea,DocumentNormalizerView:Jr,DocumentScannerView:Kr,DocumentResultView:Qr,EnumResultStatus:Br,EnumFlowType:Fr,EnumDDSViews:Mr};function na(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function sa(t,e){return ca(t,ra(t,e,"get"))}function oa(t,e,i){return da(t,ra(t,e,"set"),i),i}function ra(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function aa(t,e,i){return ua(t,e),pa(i,"get"),ca(t,i)}function la(t,e,i,n){return ua(t,e),pa(i,"set"),da(t,i,n),n}function ha(t,e,i){return ua(t,e),i}function ca(t,e){return e.get?e.get.call(t):e.value}function da(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}function ua(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}function pa(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function ga(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function fa(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ma(t,e,i){fa(t,e),e.set(t,i)}function va(t,e){fa(t,e),e.add(t)}function ya(t,e,i,n){return new(i||(i=Promise))((function(e,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function r(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,r)}a((n=n.apply(t,[])).next())}))}function xa(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function wa(t,e,i,n,s){if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s?s.value=i:e.set(t,i),i}var ba,Ca,Sa,_a,Ta,Ea,Pa,Aa,Ia,Da,ka,Ra,Ma,La,Oa,Ba,Fa,Na,Ua,Va,Wa,Ha,ja,za,Ga,Ya,$a,Xa,qa,Za,Ja,Ka,Qa,tl,el,il,nl,sl,ol,rl,al,ll,hl,cl,dl,ul,pl,gl,fl,ml,vl,yl,xl,wl,bl,Cl,Sl,_l,Tl,El,Pl,Al,Il,Dl,kl,Rl,Ml,Ll,Ol,Bl,Fl,Nl,Ul,Vl,Wl,Hl,jl,zl,Gl,Yl,$l,Xl,ql,Zl,Jl,Kl,Ql,th,eh,ih,nh,sh,oh,rh,ah,lh,hh,ch,dh,uh,ph,gh,fh,mh,vh,yh,xh,wh,bh,Ch,Sh,_h,Th,Eh,Ph,Ah,Ih,Dh,kh,Rh,Mh,Lh,Oh,Bh,Fh,Nh,Uh,Vh,Wh,Hh,jh,zh,Gh,Yh,$h,Xh,qh,Zh,Jh,Kh,Qh,tc,ec,ic,nc,sc,oc,rc,ac,lc,hc,cc,dc,uc,pc,gc,fc,mc,vc,yc,xc,wc,bc,Cc,Sc,_c,Tc;"function"==typeof SuppressedError&&SuppressedError,function(t){t.logInfo="logInfo",t.logDebug="logDebug",t.logAll="logAll",t.imgIO="imgIO",t.core="imgCore",t.imgProc="imgProc",t.pdfR="pdfReader",t.pdfW="pdfWriter",t.crypto="crypto",t.binaryBlobType="application/octet-stream",t.wasmExtension=".wasm"}(ba||(ba={})),function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader"}(Ca||(Ca={})),function(t){t.pending="pending",t.ready="ready",t.failed="failed",t.destroyed="destroyed",t.init="init"}(Sa||(Sa={})),function(t){t.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",t.TIMEOUT="Timeout no Response = ",t.FILE_STREAM_ERROR="File Stream Error = ",t.WASM_EXCEPTION_ERROR="An WASM exception occurred."}(_a||(_a={})),function(t){t[t.LONG_KEY=0]="LONG_KEY",t[t.DLS_KEY=1]="DLS_KEY"}(Ta||(Ta={})),function(t){t[t.wasmSucceed=0]="wasmSucceed",t[t.wasmBase=-4e3]="wasmBase",t[t.wasmException=-4001]="wasmException",t[t.wasmNoModule=-4002]="wasmNoModule",t[t.wasmJsBase=-4100]="wasmJsBase",t[t.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",t[t.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",t[t.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",t[t.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",t[t.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",t[t.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",t[t.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",t[t.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",t[t.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",t[t.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",t[t.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",t[t.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed"}(Ea||(Ea={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL"}(Pa||(Pa={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64"}(Aa||(Aa={})),function(t){t[t.SF_DEF=0]="SF_DEF",t[t.SF_ENABLE=1]="SF_ENABLE",t[t.SF_DISABLE=2]="SF_DISABLE"}(Ia||(Ia={})),function(t){t.imgIOVer="2.1.0",t.coreVer="2.1.0",t.imgProcVer="2.1.0",t.pdfRVer="2.1.0",t.pdfWVer="2.1.0",t.cryptoVer="2.1.0"}(ll||(ll={}));class Ec{static setLogFunc(t,e,i){wa(this,Da,t,0,ka),wa(this,Da,e,0,Ra),wa(this,Da,i,0,Ma)}static get level(){return xa(this,Da,"f",ka)}static get func(){return xa(this,Da,"f",Ra)}static get context(){return xa(this,Da,"f",Ma)}static logAll(t){this.log(ba.logAll,t)}static logD(t){this.log(ba.logDebug,t)}static log(t,e){xa(this,Da,"f",Ra)&&xa(this,Da,"f",ka)===t&&xa(this,Da,"f",Ra).call(this,e,xa(this,Da,"f",Ma))}}Da=Ec,ka={value:""},Ra={value:void 0},Ma={value:null};class Pc{static unload(){wa(this,La,"",0,Oa),wa(this,La,"",0,Fa),wa(this,La,null,0,Na),wa(this,La,{name:ba.imgIO,workerName:Ca.core,autoLoad:!1,ver:ll.imgIOVer,prefixName:Pc.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli},0,il),wa(this,La,{name:ba.crypto,workerName:Ca.core,autoLoad:!1,ver:ll.cryptoVer,prefixName:Pc.CryptoPrefixName,dependencyModules:[ba.imgIO],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli},0,nl),wa(this,La,{name:ba.pdfR,workerName:Ca.reader,autoLoad:!1,ver:ll.pdfRVer,prefixName:Pc.PdfReaderPrefixName,dependencyModules:[ba.imgIO,ba.core],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli},0,sl),wa(this,La,{name:ba.core,workerName:Ca.core,autoLoad:!1,ver:ll.coreVer,prefixName:Pc.ImagecorePrefixName,dependencyModules:[ba.imgIO],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli},0,ol),wa(this,La,{name:ba.imgProc,workerName:Ca.core,autoLoad:!1,ver:ll.imgProcVer,prefixName:Pc.ImageProcPrefixName,dependencyModules:[ba.imgIO,ba.core],useSimd:Pc.UseSimd,useBrotli:Pc.UseBrotli},0,rl),Ec.setLogFunc("",void 0,null)}static get UseSimd(){return xa(this,La,"f",Va)}static set UseSimd(t){wa(this,La,t,0,Va)}static get UseBrotli(){return xa(this,La,"f",Wa)}static set UseBrotli(t){wa(this,La,t,0,Wa)}static get License(){return xa(this,La,"f",Oa)}static set License(t){wa(this,La,t,0,Oa)}static get LicMode(){return xa(this,La,"f",Ba)}static set LicMode(t){wa(this,La,t,0,Ba),xa(this,La,"m",ja).call(this)}static get UUID(){return xa(this,La,"f",Fa)}static set UUID(t){wa(this,La,t,0,Fa)}static get NavInfo(){return xa(this,La,"f",Na)}static set NavInfo(t){wa(this,La,t,0,Na)}static get Mobile(){return xa(this,La,"f",Ua)}static set Mobile(t){wa(this,La,t,0,Ua)}static get DefHeapSize(){return xa(this,La,"f",za)}static set DefHeapSize(t){wa(this,La,t,0,za)}static get MaxHeapSize(){return xa(this,La,"f",Ga)}static get HeapConfig(){return xa(this,La,"m",$a).call(this),Object.assign({},xa(this,La,"f",Ya))}static getWorkerHeap(t){return void 0!==xa(this,La,"f",Ya)[t]?xa(this,La,"f",Ya)[t]:{maxHeapSize:xa(this,La,"f",Ga),initHeapSize:xa(this,La,"f",za)}}static UpdateHeapConfig(t,e,i){xa(this,La,"m",$a).call(this),e&&void 0!==xa(this,La,"f",Ya)[t]&&(xa(this,La,"f",Ya)[t].maxHeapSize=e),i&&void 0!==xa(this,La,"f",Ya)[t]&&(xa(this,La,"f",Ya)[t].initHeapSize=i)}static get FileReadModeSize(){return xa(this,La,"f",Xa)}static set FileReadModeSize(t){wa(this,La,t,0,Xa)}static get FontUseFileReadMode(){return{load:xa(this,La,"f",qa),save:xa(this,La,"f",Za)}}static set FontUseFileReadMode(t){"boolean"==typeof t.load&&wa(this,La,t.load,0,qa),"boolean"==typeof t.save&&wa(this,La,t.save,0,Za)}static get ImageIOWorkerJS(){return"ddv-imageio.worker.js?v="+ll.imgIOVer}static get PdfReaderWorkerJS(){return"dynamsoft.pdfReader_wasm-"+ll.pdfRVer+".js"}static get ImageIOPrefixName(){return"ddv-imageio"}static get ImagecorePrefixName(){return"ddv-imagecore"}static get ImageProcPrefixName(){return"ddv-imageproc"}static get PdfReaderPrefixName(){return"ddv-pdfreader"}static get CryptoPrefixName(){return"ddv-crypto"}static get ImageIOResource(){return xa(this,La,"f",Qa)}static set ImageIOResource(t){wa(this,La,xa(this,La,"m",Ja).call(this,t),0,Qa),xa(this,La,"m",el).call(this,xa(this,La,"f",Qa),xa(this,La,"f",il)),xa(this,La,"m",el).call(this,xa(this,La,"f",Qa),xa(this,La,"f",nl)),xa(this,La,"m",el).call(this,xa(this,La,"f",Qa),xa(this,La,"f",ol)),xa(this,La,"m",el).call(this,xa(this,La,"f",Qa),xa(this,La,"f",rl))}static get PdfReaderResource(){return xa(this,La,"f",tl)}static set PdfReaderResource(t){t.useFastCompEdition=!1,wa(this,La,xa(this,La,"m",Ja).call(this,t),0,tl),xa(this,La,"m",el).call(this,xa(this,La,"f",tl),xa(this,La,"f",sl)),this.PdfReaderModule.singleInstance=!0}static get ImageIOModule(){return xa(this,La,"f",il)}static get CryptoModule(){return xa(this,La,"f",nl)}static get PdfReaderModule(){return xa(this,La,"f",sl)}static get ImagecoreModule(){return xa(this,La,"f",ol)}static get ImageReadereModule(){const t=Object.assign({},xa(this,La,"f",ol));return t.workerName=Ca.reader,t}static get ImageProcModule(){return xa(this,La,"f",rl)}static get DetectorModule(){return wa(this,La,Object.assign({},xa(this,La,"f",rl)),0,al),xa(this,La,"f",al).workerName=Ca.detector,xa(this,La,"f",al)}static get PdfWriterModule(){const t=Object.assign({},xa(this,La,"f",sl));return t.workerName=Ca.core,t}static setLogFunc(t,e,i){Ec.setLogFunc(t,e,i)}static hasLogFunc(){return void 0!==Ec.func}}La=Pc,Ha=function(t){this.LicMode==Ta.DLS_KEY&&t.dependencyModules&&-1!=t.dependencyModules.indexOf(ba.imgIO)&&-1==t.dependencyModules.indexOf(ba.crypto)&&t.dependencyModules.push(ba.crypto)},ja=function(){xa(this,La,"m",Ha).call(this,xa(this,La,"f",ol)),xa(this,La,"m",Ha).call(this,xa(this,La,"f",rl)),xa(this,La,"m",Ha).call(this,xa(this,La,"f",sl))},$a=function(){0===Object.keys(xa(this,La,"f",Ya)).length&&(xa(this,La,"f",Ya)[Ca.core]={},xa(this,La,"f",Ya)[Ca.core].maxHeapSize=xa(this,La,"f",Ga),xa(this,La,"f",Ya)[Ca.core].initHeapSize=xa(this,La,"f",za),xa(this,La,"f",Ya)[Ca.reader]={},xa(this,La,"f",Ya)[Ca.reader].maxHeapSize=xa(this,La,"f",Ga),xa(this,La,"f",Ya)[Ca.reader].initHeapSize=xa(this,La,"f",za),xa(this,La,"f",Ya)[Ca.detector]={},xa(this,La,"f",Ya)[Ca.detector].maxHeapSize=xa(this,La,"f",Ga),xa(this,La,"f",Ya)[Ca.detector].initHeapSize=xa(this,La,"f",za))},Ja=function(t){var e,i,n,s;let o={crossScript:!1,resourceDir:t.resourceDir,workerScript:t.workerScript,useFastCompEdition:null!==(e=t.useFastCompEdition)&&void 0!==e&&e,useSimd:null!==(i=t.useSimd)&&void 0!==i?i:xa(this,La,"f",Va),fetchOptions:null!==(n=t.fetchOptions)&&void 0!==n?n:xa(this,La,"f",Ka),useBrotli:null!==(s=t.useBrotli)&&void 0!==s?s:xa(this,La,"f",Wa)};return o.workerScript=t.resourceDir+t.workerScript,o.workerScript.startsWith("http://")||o.workerScript.startsWith("https://")||o.workerScript.includes("://")?(o.resourceDir=t.resourceDir,o.workerScript.startsWith(location.origin)||(o.crossScript=!0)):t.resourceDir.startsWith("/")?null!=location.origin&&(o.resourceDir=location.origin+t.resourceDir):null!=location.href&&(o.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+t.resourceDir),o.resourceDir.endsWith("/")||(o.resourceDir+="/"),t.useFastCompEdition&&(o.resourceDir+="fastcomp/",o.workerScript=o.resourceDir+t.workerScript),o},el=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.name===ba.imgProc?e.useSimd=t.useSimd:e.useSimd=!1,e.script=t.workerScript,e.fetchOptions=t.fetchOptions,e.useBrotli=t.useBrotli},Oa={value:""},Ba={value:Ta.LONG_KEY},Fa={value:""},Na={value:null},Ua={value:!1},Va={value:!1},Wa={value:!1},za={value:32},Ga={value:200},Ya={value:Object.create(null)},Xa={value:20},qa={value:!0},Za={value:!1},Ka={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}},Qa={value:{resourceDir:"",workerScript:Pc.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},tl={value:{resourceDir:"",workerScript:Pc.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},il={value:{name:ba.imgIO,workerName:Ca.core,autoLoad:!1,ver:ll.imgIOVer,prefixName:Pc.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},nl={value:{name:ba.crypto,workerName:Ca.core,autoLoad:!1,ver:ll.cryptoVer,prefixName:Pc.CryptoPrefixName,dependencyModules:[ba.imgIO],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},sl={value:{name:ba.pdfR,workerName:Ca.reader,autoLoad:!1,ver:ll.pdfRVer,prefixName:Pc.PdfReaderPrefixName,dependencyModules:[ba.imgIO,ba.core],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},ol={value:{name:ba.core,workerName:Ca.core,autoLoad:!1,ver:ll.coreVer,prefixName:Pc.ImagecorePrefixName,dependencyModules:[ba.imgIO],fetchOptions:xa(Pc,La,"f",Ka),useBrotli:Pc.UseBrotli}},rl={value:{name:ba.imgProc,workerName:Ca.core,autoLoad:!1,ver:ll.imgProcVer,prefixName:Pc.ImageProcPrefixName,dependencyModules:[ba.imgIO,ba.core],useSimd:Pc.UseSimd,useBrotli:Pc.UseBrotli}},al={value:void 0};class Ac{static read(t){return new Promise((function(e,i){let n=Object.prototype.toString.call(t);if("[object String]"===n){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((function(t){return t.arrayBuffer()})).then((function(t){return e(t)})).catch((function(t){return Promise.reject(t)}));i("Error url: Can not read the file URL")}else if("[object Blob]"===n||"[object FileList]"===n||"[object File]"===n){let s=t;"[object FileList]"!==n&&"[object File]"!==n||(s=t[0]?t[0]:t),xa(Ac,hl,"m",cl).call(Ac,s,e,i)}else"[object ArrayBuffer]"===n||"[object Uint8ClampedArray]"===n?e(t):i("Not support source type: "+n)}))}}hl=Ac,cl=function(t,e,i){let n,s,o=0;try{n=new ArrayBuffer(t.size),s=new Uint8Array(n)}catch(t){i(t)}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null===(l=null==a?void 0:a.target)||void 0===l?void 0:l.result){const i=a.target.result;s.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(n)}else i(a)},a.onerror=function(t){i(t)},a.onabort=function(t){i(t)};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h)}()};class Ic{static fetchRetry(t,e,i,n){let s=e.retries,o=e.retryDelay;return new Promise((function(r,a){const l=function(h){return fetch(t,e).then((function(t){r(t)})).catch((function(t){h<s?function(t,e){i&&i(e,n),setTimeout((function(){l(++t)}),o)}(h,t):a(t)}))};return l(0)}))}}class Dc{constructor(t,e,i,n,s,o){dl.add(this),ul.set(this,void 0),pl.set(this,void 0),gl.set(this,void 0),fl.set(this,void 0),ml.set(this,void 0),vl.set(this,void 0),yl.set(this,void 0),xl.set(this,void 0),wl.set(this,void 0),bl.set(this,void 0),Cl.set(this,void 0),Sl.set(this,void 0),_l.set(this,void 0),Tl.set(this,0),El.set(this,{}),Pl.set(this,null),wa(this,ul,t),wa(this,wl,n),wa(this,_l,i),wa(this,gl,[]),wa(this,fl,!1),wa(this,ml,!1),wa(this,Tl,e),wa(this,Pl,Object.create(null)),xa(this,El,"f").modulesInfo=[],wa(this,Cl,Object.create(null)),wa(this,xl,null),wa(this,bl,0),wa(this,Sl,0),wa(this,pl,xa(this,dl,"m",Il).call(this,xa(this,ul,"f"))),xa(this,pl,"f").on("message",xa(this,dl,"m",kl),this),xa(this,pl,"f").on("error",xa(this,dl,"m",Dl),this),xa(this,pl,"f").on("exit",(function(e,i,n){let s="Worker #terminated Unexpectedly\n";s+=" exitCode: `"+e+"`\n",s+=" signalCode: `"+i+"`\n",s+=" #script: `"+t+"`\n",xa(n,dl,"m",Dl).call(n,new Error(s),n)}),this)}get WorkerScript(){return xa(this,wl,"f")}get id(){return xa(this,Tl,"f")}get Module(){return xa(this,El,"f")}get Instances(){return xa(this,Pl,"f")}get WorkerName(){return xa(this,_l,"f")}execTask(t,e,i){i||((i={}).promise=new Promise((function(t,e){i.resolve=t,i.reject=e})));let n=wa(this,Sl,+xa(this,Sl,"f")+1);xa(this,Cl,"f")[n]={id:n,insId:e.insId,resolver:i,cost:e.cost},delete e.cost;let s={id:n,func:t,params:e};return Ec.logD("["+e.insId+"] "+t+" send"),xa(this,ml,"f")?i.reject(new Error("Worker is #terminated")):xa(this,fl,"f")?i.reject(new Error("Worker is #terminating")):xa(this,pl,"f").wasmReady||xa(this,pl,"f").ready&&"loadWasm"===t?xa(this,pl,"f").send(s):xa(this,gl,"f").push(s),i.promise}get memSize(){return xa(this,bl,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(xa(this,Cl,"f")).length}get alive(){return!xa(this,fl,"f")&&!xa(this,ml,"f")}terminate(t,e){if(Ec.logD("["+this.id+"] worker terminate "+t),t&&xa(this,dl,"m",Ml).call(this,"Worker has been #terminated"),"function"==typeof e&&wa(this,xl,e),this.busy)wa(this,fl,!0);else{if(xa(this,pl,"f")){if("function"!=typeof xa(this,pl,"f").terminate)throw new Error("Failed to terminate worker");Ec.logD("["+this.id+"] will be terminated"),xa(this,pl,"f").terminate(),wa(this,pl,null)}wa(this,fl,!1),wa(this,ml,!0),xa(this,xl,"f")&&xa(this,xl,"f").call(this,this)}}hasInstance(t){if(t){const e=xa(this,Pl,"f")[t];if(e)return 0!=Object.keys(e).length}else{const t=Object.keys(xa(this,Pl,"f"));for(const e of t)if(0!=Object.keys(xa(this,Pl,"f")[e]).length)return!0}return!1}exceedMaxMemory(){const t=1024*Pc.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return!!(xa(this,bl,"f")&&xa(this,bl,"f")>t&&0!=t)&&(Ec.logD("[w-"+this.id+"] current memSize="+xa(this,bl,"f")+", max="+t),!0)}shouldBeFreed(){return!(!this.exceedMaxMemory()||this.hasInstance(void 0)||(Ec.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}ul=new WeakMap,pl=new WeakMap,gl=new WeakMap,fl=new WeakMap,ml=new WeakMap,vl=new WeakMap,yl=new WeakMap,xl=new WeakMap,wl=new WeakMap,bl=new WeakMap,Cl=new WeakMap,Sl=new WeakMap,_l=new WeakMap,Tl=new WeakMap,El=new WeakMap,Pl=new WeakMap,dl=new WeakSet,Al=function(t){let e=new Error(""),i=Object.keys(t);for(let n=0;n<i.length;n++)e[i[n]]=t[i[n]];return e},Il=function(t){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let e=new Worker(t,{name:this.WorkerName});return e.on=function(t,e,i){this.addEventListener(t,(function(n){"exit"===t?e(n.data,"",i):e(n.data,i)}))},e.send=function(t){if(null!=t&&null!=t.params&&null!=t.params.input){let e=Object.prototype.toString.call(t.params.input);if("[object Array]"===Object.prototype.toString.call(t.params.input)){if(e=Object.prototype.toString.call(t.params.input[0]),"[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input[0].buffer?t.params.input[0].buffer:t.params.input[0]])}else if("[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input.buffer?t.params.input.buffer:t.params.input])}this.postMessage(t)},e},Dl=function(t,e){wa(e,ml,!0),Ec.logD("[js]["+e.id+"] worker error "+JSON.stringify(t)),xa(e,fl,"f")&&xa(e,xl,"f")&&xa(e,xl,"f").call(e,e),wa(e,fl,!1),xa(e,dl,"m",Ml).call(e)},kl=function(t,e){let i=t.id,n=xa(e,Cl,"f")[i];if(t&&t.cost&&n&&n.cost){const e=n.cost;e.exec=t.cost;const i=Date.now();e.total=i-e.ctime,e.msgQueue=t.ctime-e.time;const s=i-t.time;delete e.time,delete e.ctime,t.cost=e,t.cost.receive=s,delete t.ctime,delete t.time}if(Ec.logD(t.log?t.log:t),"string"==typeof t&&"ready"===t)xa(e,pl,"f").ready=!0,setTimeout((()=>{xa(e,dl,"m",Rl).call(e)}),0);else if(!t.log){if("object"==typeof t){let i=t.result;"object"==typeof i?(null!=i.errorCode&&(i.code=i.errorCode,delete i.errorCode),null!=i.errorMessage&&(i.message=i.errorMessage,delete i.errorMessage)):"string"==typeof i&&(i=i.replace('"errorCode"','"code"'),i=i.replace("'errorCode'","'code'"),i=i.replace('"errorMessage"','"message"'),i=i.replace("'errorMessage'","'message'"),t.result=i),null!=t.memSize&&wa(e,bl,t.memSize)}if(void 0!==n){const s=n.insId;delete xa(e,Cl,"f")[i],Ec.logD("["+s+"] "+t.func+" received"),!0===xa(e,fl,"f")&&e.terminate(),"loadWasm"===t.func&&null!=t.result&&(xa(e,pl,"f").wasmReady=!0,setTimeout((()=>{xa(e,dl,"m",Rl).call(e)}),0)),t.error?n.resolver.reject(xa(e,dl,"m",Al).call(e,t.error)):t.result&&n.resolver.resolve(t.result)}}},Rl=function(){this.alive&&(xa(this,gl,"f").forEach(xa(this,pl,"f").send.bind(xa(this,pl,"f"))),wa(this,gl,[]))},Ml=function(t){for(let e in xa(this,Cl,"f"))void 0!==xa(this,Cl,"f")[e]&&xa(this,Cl,"f")[e].resolver.reject(new Error(t));wa(this,Cl,Object.create(null))};class kc{constructor(){Ll.add(this),Fl.set(this,[]),Nl.set(this,4),Ul.set(this,60),Vl.set(this,!1),Wl.set(this,0),jl.set(this,!1)}static get Instance(){return xa(this,Ol,"f",Bl)||wa(this,Ol,new kc,0,Bl),xa(this,Ol,"f",Bl)}get Terminated(){return xa(this,Vl,"f")}getModuleLoadedError(t){for(let e of xa(kc,Ol,"f",Hl))if(e.name==t)return e.error}getModuleStatus(t){for(let e of xa(kc,Ol,"f",Hl))if(e.name==t)return e.status;return""}addModules(t,e){let i=!1;if(xa(kc,Ol,"f",Hl).forEach((function(e,n,s){e.name==t.name&&(e.ver==t.ver?i=!0:s.splice(n,1))})),!i){let i=t;i.status=e||"",i.wasmModule=null,xa(kc,Ol,"f",Hl).push(i)}}loadModule(t,e){return ya(this,0,void 0,(function*(){null==e&&(e=0!=xa(this,Ll,"m",Jl).call(this,t).length),this.addModules(t);for(let e of t.dependencyModules)e===ba.imgIO?(this.addModules(Pc.ImageIOModule,Sa.pending),Pc.LicMode===Ta.DLS_KEY&&t.name!=ba.crypto&&this.addModules(Pc.CryptoModule,Sa.pending)):e===ba.core&&this.addModules(Pc.ImagecoreModule,Sa.pending);let i,n;for(let s of xa(kc,Ol,"f",Hl))if(s.name===t.name){if(s.status===Sa.pending)return!1;if(s.wasmModule){if(e)return!0;i=s.wasmModule,n=s.wasmBinary;break}break}let s=null;if(i)s=t,s.wasmModule=i,s.wasmBinary=n,s.status=Sa.pending;else if(s=t,""===s.status)s.status=Sa.pending,s.wasmModule=null;else{if(s.status===Sa.pending)return!1;e||(s.error={code:0,message:""},s.status=Sa.pending)}return xa(this,Ll,"m",zl).call(this,s)}))}get busy(){xa(this,Ll,"m",eh).call(this);let t=xa(this,Fl,"f");for(let e of t)if(e.busy)return!0;return!1}getWorker(t,e){return ya(this,0,void 0,(function*(){if(xa(this,Ll,"m",Kl).call(this,t.name))return xa(this,Ll,"m",th).call(this),{worker:null,workers:0};let i=xa(this,Ll,"m",Jl).call(this,t,!0);return 0!=i.length?{worker:xa(this,Ll,"m",ih).call(this,i,e,t),workers:i.length}:(yield this.loadModule(t,!1),{worker:null,workers:0})}))}removeInstanceInWorker(t,e,i,n){if(xa(this,Ll,"m",nh).call(this,e,t.name,i),n&&e&&e.shouldBeFreed()){let t=xa(this,Fl,"f").indexOf(e);-1!==t&&xa(this,Fl,"f").splice(t,1)}}terminate(t){wa(kc,Ol,null,0,Bl),Ec.logD("worker pool terminate "+t),wa(this,Vl,!0);let e=[];return xa(this,Fl,"f").splice(0).forEach((function(i){let n={};n.promise=new Promise((function(t,e){n.resolve=t,n.reject=e})),e.push(n.promise),i.terminate(t,(function(t){n.resolve(t)}))})),Promise.all(e)}static unload(){wa(kc,Ol,new Array,0,Hl)}terminateWorker(t){xa(this,Fl,"f").splice(0,xa(this,Fl,"f").length,...xa(this,Fl,"f").filter((e=>e.WorkerName!==t||(e.terminate(!0),!1))))}getMemoryUsed(){let t=xa(this,Fl,"f"),e=[],i=0;for(let n of t)n&&null!=n.memSize&&(e[i]={},e[i].size=n.memSize,e[i].limit=1024*Pc.getWorkerHeap(n.WorkerName).maxHeapSize*1024,e[i].name=n.WorkerName,e[i].id=n.id,i+=1);return e}}Ol=kc,Fl=new WeakMap,Nl=new WeakMap,Ul=new WeakMap,Vl=new WeakMap,Wl=new WeakMap,jl=new WeakMap,Ll=new WeakSet,zl=function(t){return ya(this,0,void 0,(function*(){let e=this,i=yield xa(this,Ll,"m",ql).call(this,t);if(i){let n={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:t.fetchOptions}};if(n.params.resourceDir=t.resourceDir,n.params.initMemory=Pc.getWorkerHeap(t.workerName).initHeapSize,n.params.module){for(let e of xa(kc,Ol,"f",Hl))for(let i of t.dependencyModules)i==e.name&&n.params.module.modulesInfo.push(e);n.params.module.modulesInfo.push(t)}yield xa(this,Ll,"m",Yl).call(this,i,n),wa(e,Nl,xa(e,Ll,"m",Xl).call(e)),t.status===Sa.pending&&(t.status="")}else t.status="",t.wasmModule=null}))},Gl=function(t,e,i,n){for(let s of xa(kc,Ol,"f",Hl))if(s.name===t){s.status=e,s.wasmModule=i.wasmModule,s.wasmBinary=i.wasmBinary,s.error=n;break}},Yl=function(t,e,i){return ya(this,0,void 0,(function*(){let n=this;try{const i=yield t.execTask(e.func,e.params);let s=!1;return void 0===i.code||i.modules?s=xa(n,Ll,"m",$l).call(n,i,t):Ec.logD(i),s}catch(n){return Ec.logD(n),!1}finally{i&&i()}}))},$l=function(t,e){if(Ec.logD("handleWasmLoad:"),Ec.logD(t),xa(this,Vl,"f"))return e.terminate(),!1;if(("object"!=typeof t||null==t.modules)&&"object"==typeof t)return!1;let i=!1;for(const n of t.modules)t.code?(xa(this,Ll,"m",Gl).call(this,n.name,Sa.failed,null,{code:t.code,message:t.message}),e.Module.modulesInfo[n.name]=!1):(xa(this,Ll,"m",Gl).call(this,n.name,Sa.ready,n.wasmResource,void 0),e.Module.modulesInfo[n.name]=!0,i=!0);return i},Xl=function(){let t=2;return"hardwareConcurrency"in self.navigator&&(t=self.navigator.hardwareConcurrency),Math.max(Math.min(xa(this,Nl,"f"),Math.max(xa(this,Nl,"f"),t/2)),1)},ql=function(t){return ya(this,0,void 0,(function*(){xa(this,Ll,"m",eh).call(this);let e=xa(this,Fl,"f");for(let i of e)if(i.WorkerName===t.workerName)return i.busy?null:i;return xa(this,Ll,"m",Zl).call(this,t)}))},Zl=function(t){var e;return ya(this,0,void 0,(function*(){let i=this,n=xa(i,Fl,"f");if(n.length<xa(i,Nl,"f")&&!xa(i,jl,"f")){wa(i,jl,!0);let s=t.script;t.crossScript&&(s=yield Ic.fetchRetry(t.script,t.fetchOptions,Ec.func,i).then((t=>t.blob())).then((t=>URL.createObjectURL(t))).catch((t=>(Ec.logD("get new worker fetch failed: "),Ec.logD(t),wa(i,jl,!1),null))));let o=new Dc(s,wa(e=i,Wl,+xa(e,Wl,"f")+1),t.workerName,t.script,Ec.func,Ec.context);return n.push(o),wa(i,jl,!1),Ec.logAll(n),Ec.logD("[wl-"+xa(i,Fl,"f").length+"] got new worker w-"+o.id+"("+o.WorkerName+") succeed!"),o}return null}))},Jl=function(t,e){xa(this,Ll,"m",eh).call(this);let i=xa(this,Fl,"f");Ec.logAll(i);let n=[];for(let s of i)if(s.Module.modulesInfo[t.name]){let i=!0;if(t.dependencyModules.forEach((t=>{s.Module.modulesInfo[t]||(i=!1)})),!i)continue;if(e&&s.WorkerName!==t.workerName)continue;n.push(s)}return Ec.logAll("[wl-"+i.length+"] got workers for module "+t.name),Ec.logAll(n),n},Kl=function(t){for(let e of xa(kc,Ol,"f",Hl))if(e.name===t&&e.status===Sa.pending)return!0;return!1},Ql=function(){return ya(this,0,void 0,(function*(){this.terminate(!0);for(let t of xa(kc,Ol,"f",Hl))yield xa(this,Ll,"m",zl).call(this,t)}))},th=function(){xa(this,Ll,"m",eh).call(this),0==xa(this,Fl,"f").length&&0!=xa(kc,Ol,"f",Hl).length&&(Ec.logD("no worker ready, reinit"),xa(this,Ll,"m",Ql).call(this))},eh=function(){xa(this,Fl,"f").splice(0,xa(this,Fl,"f").length,...xa(this,Fl,"f").filter((function(t){return t.alive})))},ih=function(t,e,i){Ec.logAll("[wl-"+xa(this,Fl,"f").length+"] getWorkerByIntanceId"),Ec.logAll(t);let n,s=9007199254740991;for(let o of t){if(i.singleInstance&&o.hasInstance(i.name)&&!o.Instances[i.name][e])continue;const t=o.Instances[i.name];if(!t||void 0!==t[e]){n=o;break}{let t=o.howManyTasks;t<s&&(n=o,s=t)}}if(n){if(n.shouldBeFreed())return null;const s=n.Instances[i.name];if(s)s[e]="";else{const t=Object.create(null);t[e]="",n.Instances[i.name]=t}return Ec.logAll(t),Ec.logD("[wl-"+t.length+"]["+e+"] got worker w-"+n.id),n}return Ec.logAll("#getWorkerByIntanceId: no suitable worker"),null},nh=function(t,e,i){let n=xa(this,Fl,"f");Ec.logAll("removeInstanceInWorkerInner"),Ec.logAll(n);for(let s of n)if(s===t){const o=s.Instances[e];if(o){if(null!=o[i]){delete o[i],Ec.logAll(n),Ec.logD("[w-"+s.id+"] removeInstanceInWorkerInner "+i+" in "+t.id+" succeed!");break}Ec.logD("[w-"+s.id+"] not found instance "+i)}}},Bl={value:null},Hl={value:new Array};class Rc{static buildWasmFileName(t,e,i,n,s){return t+(n?"-simd":"")+i+"?v="+e}static base64DecToArr(t,e){let i=t.replace(/[^A-Za-z0-9\+\/]/g,""),n=i.length,s=e?Math.ceil((3*n+1>>>2)/e)*e:3*n+1>>>2,o=new Uint8Array(s);for(let t,e,r=0,a=0,l=0;l<n;l++)if(e=3&l,r|=xa(this,sh,"m",oh).call(this,i.charCodeAt(l))<<18-6*e,3===e||n-l==1){for(t=0;t<3&&a<s;t++,a++)o[a]=r>>>(16>>>t&24)&255;r=0}return o}static isWasmSupport(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){let t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1}static random(){return(Date.now()%10086).toString(36).slice(2)+Math.random().toString(36).slice(2)}static newBlobInChunks(t,e,i){var n;let s;const o=i||t.byteLength,r=8388608,a=[];for(let e=0;e<o;e+=r)a.push(new Blob([new Uint8Array(null!==(n=t.buffer)&&void 0!==n?n:t,e,Math.min(o-e,r))]));return s=null!=e?new Blob(a,{type:e}):new Blob(a),s}}sh=Rc,oh=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0};class Mc{constructor(t,e){var i,n,s,o;rh.add(this),hh.set(this,void 0),this._outputType=Pa.IT_JPG,this._inputType=Pa.IT_ALL,this._jpegQuality=80,ch.set(this,null!==(i=Pc.License)&&void 0!==i?i:""),dh.set(this,[]),uh.set(this,null),ph.set(this,0),gh.set(this,wa(o=Mc,ah,+xa(o,ah,"f",lh)+1,0,lh)),fh.set(this,null),mh.set(this,JSON.parse(JSON.stringify(Pc.NavInfo))),vh.set(this,Pc.Mobile),yh.set(this,location.origin),xh.set(this,""),wh.set(this,Sa.init),bh.set(this,!1),Ch.set(this,null!==(n=Pc.LicMode)&&void 0!==n?n:Ta.LONG_KEY),Sh.set(this,null!==(s=Pc.UUID)&&void 0!==s?s:""),_h.set(this,0),Th.set(this,!1),Eh.set(this,!1),this._handleBooleanResult=function(t,e){return!0},wa(this,hh,t),wa(this,ch,null!=e?e:Pc.License)}_prepareModule(t){}get workerId(){return xa(this,uh,"f")&&xa(this,uh,"f").alive?xa(this,uh,"f").id:0}get id(){return xa(this,gh,"f")}hasTask(){return xa(this,dh,"f").length>0}_canTerminateWork(){return!1}_makeSureWorkerMemoryNotExceed(){return!(xa(this,uh,"f")&&xa(this,uh,"f").alive&&this._canTerminateWork()&&xa(this,uh,"f").exceedMaxMemory()&&(Ec.logD(`[${this.id}] try to termiate worker [${xa(this,uh,"f").id}]`),xa(this,uh,"f").terminate(!0),wa(this,uh,null),wa(this,wh,Sa.init),1))}_workerChanged(t){}_handleBasicResult(t,e){return delete t.code,delete t.message,t}_handleImageData(t,e){var i,n,s;if("object"==typeof t.imageData)if(null!=t.imageCount&&t.imageCount>1)for(let n=0;n<t.imageCount;n++)t.imageData[n]=xa(i=e.context,rh,"m",Ih).call(i,t.imageData[n],t.blobType,e.params.returnBlob,t.imageDataSize);else t.imageData=xa(n=e.context,rh,"m",Ih).call(n,t.imageData,t.blobType,e.params.returnBlob,t.imageDataSize);return"object"==typeof t.pdfData&&(t.pdfData=xa(s=e.context,rh,"m",Ih).call(s,t.pdfData,t.blobType,e.params.returnBlob,t.pdfDataSize)),t}_handleResult(t,e){var i,n;let s=xa(n=e.context,rh,"m",Dh).call(n,t);if(void 0===s.code||!s.code&&"Successful."===s.message)s=e.handleResult(s,e),setTimeout((()=>{var t;xa(t=e.context,rh,"m",Ah).call(t)}),0),(0,e.resolve)(s);else{let t={code:s.code,message:s.code===Ea.wasmException?_a.WASM_EXCEPTION_ERROR+"("+(null===(i=e.params)||void 0===i?void 0:i.moduleName)+":"+e.func+":"+s.message+")":s.message};e.context.terminated?e.resolve(t):e.reject(t)}}_execTask(t){let e=this,i=xa(e,uh,"f");if(Ec.logAll(t),i)try{if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.taskQueue=t.params.cost.time-e}i.execTask(t.func,t.params).then((function(i){e._handleResult(xa(e,rh,"m",Dh).call(e,i),t)})).catch((function(i){Ec.logD(i),setTimeout((()=>{xa(e,rh,"m",Ah).call(e)}),0);let n=i;"object"==typeof i&&null!=i.message&&(n=i.message);let s={code:Ea.wasmJsWorkerRunFailed,message:n};xa(e,bh,"f")?t.resolve(s):t.reject(s)}))}catch(i){setTimeout((()=>{xa(e,rh,"m",Ah).call(e)}),0),Ec.logD(i);let n={code:Ea.wasmJsWorkerRunException,message:i.message,stack:i.stack};xa(e,bh,"f")?t.resolve(n):t.reject(n)}}_cancelAllTasks(t,e){for(let i of xa(this,dh,"f"))if(void 0!==i){let n={code:t,message:e};xa(this,bh,"f")?i.resolve(n):i.reject(n)}wa(this,dh,[])}_createTask(t,e,i){let n={moduleName:xa(this,hh,"f").name,insId:xa(this,gh,"f")},s={id:wa(this,ph,+xa(this,ph,"f")+1),func:t,params:n};return s.promise=new Promise((function(t,e){s.resolve=t,s.reject=e})),s.func=t,s.context=this,s.handleResult=void 0!==i&&i?i:this._handleBasicResult,s.params.input=void 0!==e&&e?e:"",s.params.returnType=Aa.RT_AUTO,s.params.returnBlob=!0,s.params.logLevel=Ec.level,s.params.cost={},s.params.cost.ctime=Date.now(),s.params.cost.time=s.params.cost.ctime,s}_addTask(t,e){if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.create=t.params.cost.time-e}return xa(this,wh,"f")===Sa.destroyed?t.reject({code:Ea.wasmJsObjectNotInit,message:xa(this,bh,"f")?"object has been disposed":"object not init"}):xa(this,wh,"f")===Sa.failed?t.reject({code:Ea.wasmJsObjectInitFailed,message:xa(this,xh,"f")}):(e?xa(this,dh,"f").unshift(t):xa(this,dh,"f").push(t),xa(this,rh,"m",Ah).call(this)),t.promise}terminate(t){let e=this;xa(e,Th,"f")?wa(e,bh,!0):(wa(this,Eh,!0),xa(e,rh,"m",Rh).call(e).then((function(t){Ec.logD("["+e.id+"] "+xa(e,hh,"f").name+" destroy return: "),Ec.logD(t)})).catch((function(t){Ec.logD(xa(e,hh,"f").name+" destroy failed"),Ec.logD(t)})).finally((()=>{kc.Instance&&kc.Instance.removeInstanceInWorker(xa(e,hh,"f"),xa(e,uh,"f"),xa(e,gh,"f"),null==t||t),wa(e,uh,null),wa(e,bh,!0),wa(e,Eh,!1)}))),wa(e,wh,"")}_readFile(t){return Ac.read(t).catch((function(t){let e=t;return"object"!=typeof e&&(e={},e.code=Ea.wasmJsReadFileFailed,e.message=t),Promise.reject(e)}))}updateLicense(t,e,i){return ya(this,0,void 0,(function*(){wa(this,ch,t),wa(this,Ch,null!=e?e:Ta.LONG_KEY),wa(this,Sh,null!=i?i:"");let n=this,s=n._createTask("UpdateLicense");return s.params.input=[xa(n,ch,"f"),xa(n,Ch,"f"),xa(n,Sh,"f")],n._addTask(s),s.promise}))}}ah=Mc,hh=new WeakMap,ch=new WeakMap,dh=new WeakMap,uh=new WeakMap,ph=new WeakMap,gh=new WeakMap,fh=new WeakMap,mh=new WeakMap,vh=new WeakMap,yh=new WeakMap,xh=new WeakMap,wh=new WeakMap,bh=new WeakMap,Ch=new WeakMap,Sh=new WeakMap,_h=new WeakMap,Th=new WeakMap,Eh=new WeakMap,rh=new WeakSet,Ph=function t(e){let i=null!=e?e:this;return xa(i,fh,"f")&&clearTimeout(xa(i,fh,"f")),xa(i,bh,"f")?(Ec.logD(`[${i.id}] has been termiated.(getWorker)`),i._cancelAllTasks(Ea.wasmJsObjectTerminated,`Instance [${i.id}] has been termiated.`),xa(i,uh,"f")):xa(i,uh,"f")&&xa(i,uh,"f").alive?xa(i,uh,"f"):void(kc.Instance?kc.Instance.getWorker(xa(i,hh,"f"),xa(i,gh,"f")).then((e=>{var n;if(wa(i,uh,e.worker),xa(i,uh,"f")&&xa(i,uh,"f").alive)xa(i,_h,"f")!=xa(i,uh,"f").id&&(0!==xa(i,_h,"f")&&i._workerChanged(xa(i,uh,"f").id),wa(i,_h,xa(i,uh,"f").id)),xa(i,dh,"f").length>0&&setTimeout((()=>{xa(i,rh,"m",Ah).call(i)}),0);else{let e=null===(n=kc.Instance)||void 0===n?void 0:n.getModuleLoadedError(xa(i,hh,"f").name);if(null==e?void 0:e.code)return i._cancelAllTasks(Ea.wasmJsNotLoaded,e.message),xa(i,uh,"f");xa(i,dh,"f").length>0&&wa(i,fh,setTimeout(xa(i,rh,"m",t),50,i))}return xa(i,uh,"f")})).catch((t=>xa(i,uh,"f"))):i._cancelAllTasks(Ea.wasmJsNotLoaded,"wasm env not loaded or unloaded"))},Ah=function(){if(Ec.logAll(xa(this,dh,"f")),xa(this,wh,"f")!=Sa.init)if(xa(this,uh,"f")&&xa(this,uh,"f").alive){if(xa(this,dh,"f").length>0&&(xa(this,wh,"f")===Sa.ready||"init"===xa(this,dh,"f")[0].func)){const t=xa(this,dh,"f").shift();this._execTask(t)}}else{if(xa(this,uh,"f")&&!xa(this,uh,"f").alive&&xa(this,dh,"f").length>0&&"init"!=xa(this,dh,"f")[0].func)return wa(this,uh,null),void xa(this,rh,"m",kh).call(this);xa(this,dh,"f").length>0&&xa(this,hh,"f").script&&xa(this,rh,"m",Ph).call(this,this)}else xa(this,rh,"m",kh).call(this)},Ih=function(t,e,i,n){return i?Rc.newBlobInChunks(t,e,n):void 0===n||n===t.byteLength?t:t.slice(0,n)},Dh=function(t){try{return"string"==typeof t?JSON.parse(t):t}catch(e){return t}},kh=function(){let t=this;t._prepareModule(xa(this,hh,"f"));let e=this._createTask("init");e.params.key=xa(this,ch,"f"),e.params.uuid=xa(this,Sh,"f"),e.params.licMode=xa(this,Ch,"f"),e.params.val={nv:xa(this,mh,"f"),mb:xa(this,vh,"f"),dm:xa(this,yh,"f")},e.handleResult=function(t,e){return wa(e.context,wh,Sa.ready),t},wa(this,wh,Sa.pending),this._addTask(e,!0),e.promise.then((function(e){Ec.logD("["+t.id+"] "+xa(t,hh,"f").name+" init return: "),Ec.logD(e),wa(t,Th,!1)})).catch((function(e){wa(t,wh,Sa.failed),wa(t,xh,e.message),Ec.logD(xa(t,hh,"f").name+" init failed"),Ec.logD(e),t._cancelAllTasks(Ea.wasmJsObjectInitFailed,e.message)}))},Rh=function(){if(xa(this,wh,"f")==Sa.pending||xa(this,wh,"f")==Sa.ready){let t=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(t),t.promise}return Promise.resolve(!0)},lh={value:0};class Lc extends Mc{constructor(t,e){super(t,e)}_prepareModule(t){let e=kc.Instance;e.addModules(Pc.ImageIOModule),Pc.LicMode===Ta.DLS_KEY&&e.addModules(Pc.CryptoModule),xa(Lc,Mh,"m",Lh).call(Lc,Pc.ImageIOModule,t),e.addModules(t)}}Mh=Lc,Lh=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.script=t.script,e.useSimd=t.useSimd,e.name===ba.imgProc?e.useSimd=Pc.UseSimd:e.useSimd=!1,e.fetchOptions=t.fetchOptions};class Oc extends Lc{constructor(t){super(Pc.ImagecoreModule,t),Oh.add(this),Bh.set(this,0)}getImageFormat(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const n=yield e._readFile(t);return i.params.input=n,e._addTask(i),i.promise}))}readImageInfo(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const n=yield e._readFile(t);return i.params.input=n,e._addTask(i),i.promise}))}getMD5(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("GetMD5");const n=yield e._readFile(t);return i.params.input=n,i.handleResult=function(t,e){return t.MD5},e._addTask(i),i.promise}))}getLicenseInfo(){return ya(this,0,void 0,(function*(){return this._addTask(this._createTask("GetLicenseInfo"))}))}getAesResult(t){return ya(this,0,void 0,(function*(){return t=null!=t?t:"",this._addTask(this._createTask("GetAesResult",[t]))}))}saveImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){return(s=null!=s&&s)?xa(this,Oh,"m",Fh).call(this,t,void 0,void 0,void 0,1,void 0,void 0,e,i,n):xa(this,Oh,"m",Fh).call(this,t,void 0,void 0,void 0,void 0,void 0,void 0,e,i,n)}))}readImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,n=null!=n&&n,s=null!=s&&s;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t);r.params.input=[a,e,i,s],r.params.returnType=n?Aa.RT_BASE64:Aa.RT_AUTO,r.params.returnBlob=!n,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer}return l}))}openTiff(t,e){return ya(this,0,void 0,(function*(){let i=this,n=i._createTask("LoadTiff");e=null!=e&&e;const s=yield i._readFile(t);n.params.input=[s,e],i._addTask(n);const o=yield n.promise;if(o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer}return o}))}readTiff(t,e,i,n){t=null!=t?t:0,e=null!=e?e:this._outputType,i=null!=i&&i,n=null!=n&&n;let s=this._createTask("ReadTiffPage");return s.params.input=[t,e,n],s.params.returnType=i?Aa.RT_BASE64:Aa.RT_AUTO,s.params.returnBlob=!i,s.handleResult=this._handleImageData,this._addTask(s)}readTiffInfos(t){let e=this._createTask("GetTiffPageInfos");return e.params.input=[t],this._addTask(e)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){e=null!=e?e:this._inputType,i=null!=i?i:xa(this,Bh,"f"),n=null!=n?n:this._jpegQuality,s=null!=s&&s;let o=this,r=o._createTask("AppendImageToTiff");const a=yield o._readFile(t);return r.params.input=[a,e,i,n,s],r.handleResult=o._handleBooleanResult,o._addTask(r),r.promise}))}addTag(t,e,i){return i=null!=i&&i,this._addTask(this._createTask("AddTagToNextPage",[t,e,i],this._handleBooleanResult))}getTiff(t){let e=this._createTask("GetTiffStream");return e.handleResult=this._handleImageData,e.params.returnType=null!=t?t:Aa.RT_AUTO,e.params.returnBlob=t!=Aa.RT_AUTO,this._addTask(e)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,(function(t,e){return t.memoryUsed})))}getMultiPartFile(t,e){return this._addTask(this._createTask("ds_get_file",[t,e],(function(t,e){return t})))}}Bh=new WeakMap,Oh=new WeakSet,Fh=function(t,e,i,n,s,o,r,a,l,h){return ya(this,0,void 0,(function*(){let c=this;e=null!=e?e:this._inputType,i=null!=i?i:0,n=null!=n?n:0,s=null!=s?s:24,o=null!=o?o:96,r=null!=r?r:96,a=null!=a?a:this._outputType,l=null!=l?l:this._jpegQuality,h=null!=h?h:Aa.RT_AUTO;let d=c._createTask("SaveImage");const u=yield c._readFile(t);return d.params.input=[u,e,i,n,s,o,r,a,l],d.params.returnType=h,d.params.returnBlob=h!=Aa.RT_BASE64,d.handleResult=c._handleImageData,c._addTask(d),d.promise}))};class Bc extends Lc{constructor(t){super(Pc.ImageReadereModule,t),Nh.add(this),Uh.set(this,0),Vh.set(this,!1),Wh.set(this,null),Hh.set(this,void 0),jh.set(this,0),zh.set(this,void 0),Gh.set(this,void 0)}workerChanged(t){wa(this,Vh,!1),t&&(Ec.logD("["+this.id+"] worker changed to "+t),wa(this,jh,t))}setExternalWorkerChanged(t,e){wa(this,zh,t),wa(this,Gh,e)}_workerChanged(t){this.workerChanged(t),xa(this,zh,"f")&&xa(this,zh,"f").call(this,xa(this,Gh,"f"),this,t)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(wa(this,Vh,!1),xa(this,zh,"f")&&xa(this,zh,"f").call(this,xa(this,Gh,"f"),this))}getImageFormat(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const n=yield e._readFile(t.fileSource);return i.params.input=n,e._addTask(i),i.promise}))}readImageInfo(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const n=yield e._readFile(t.fileSource);return i.params.input=n,e._addTask(i),i.promise}))}readImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,n=null!=n&&n,s=null!=s&&s;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t.fileSource);r.params.input=[a,e,i,s],r.params.returnType=n?Aa.RT_BASE64:Aa.RT_AUTO,r.params.returnBlob=!n,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t.fileSource);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer}return l}))}openTiff(t,e){return ya(this,0,void 0,(function*(){e=null!=e&&e;let i,n=this,s=n._createTask("LoadTiff");t!=xa(this,Wh,"f")&&(t instanceof Blob?wa(n,Wh,t):(i=yield n._readFile(t),wa(n,Wh,Rc.newBlobInChunks(i)))),xa(n,Wh,"f").size>1024*Pc.FileReadModeSize*1024?s.params.input=[xa(n,Wh,"f"),e]:(i||(i=yield n._readFile(xa(n,Wh,"f"))),s.params.input=[i,e]),n._addTask(s);const o=yield s.promise;if(wa(n,Vh,!0),o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer}return wa(n,Hh,{pageCount:o.pageCount}),o}))}readTiffPage(t,e,i,n,s){return ya(this,0,void 0,(function*(){yield xa(this,Nh,"m",Yh).call(this,t.fileSource),e=null!=e?e:0,i=null!=i?i:this._outputType,n=null!=n&&n,s=null!=s&&s;let o=this._createTask("ReadTiffPage");return o.params.input=[e,i,s],o.params.returnType=n?Aa.RT_BASE64:Aa.RT_AUTO,o.params.returnBlob=!n,o.handleResult=this._handleImageData,this._addTask(o)}))}getTiffInfo(t,e){return ya(this,0,void 0,(function*(){return yield xa(this,Nh,"m",Yh).call(this,t.fileSource),xa(this,Hh,"f")}))}getTiffPageInfos(t,e){return ya(this,0,void 0,(function*(){yield xa(this,Nh,"m",Yh).call(this,t.fileSource);let i=this._createTask("GetTiffPageInfos");return i.params.input=[e],this._addTask(i)}))}}Uh=new WeakMap,Vh=new WeakMap,Wh=new WeakMap,Hh=new WeakMap,jh=new WeakMap,zh=new WeakMap,Gh=new WeakMap,Nh=new WeakSet,Yh=function(t){return ya(this,0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),xa(this,Vh,"f")){if(xa(this,Wh,"f")===t)return void Ec.logD("["+this.id+"] already opened in "+this.workerId);yield xa(this,Nh,"m",$h).call(this)}Ec.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(t,!1)}))},$h=function(){if(wa(this,Wh,null),xa(this,Vh,"f"))return wa(this,Vh,!1),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))};class Fc{static decode(t){const e={decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function i(t){let e,i,n,s,o,r,a,l=[],h=t.length;for(e=0;e<h;e++)s=t.charCodeAt(e),s>>7&255?6==(s>>5&255)?(o=t.charCodeAt(++e),i=(31&s)<<6,n=63&o,a=i|n,l.push(String.fromCharCode(a))):14==(s>>4&255)&&(o=t.charCodeAt(++e),r=t.charCodeAt(++e),i=s<<4|o>>2&15,n=(3&o)<<6|63&r,a=(255&i)<<8|n,l.push(String.fromCharCode(a))):l.push(t.charAt(e));return l.join("")}return function(t){let n,s,o,r,a=[],l=0,h=t.length;for(;l<h;){do{n=e.decodeChars[255&t.charCodeAt(l++)]}while(l<h&&-1==n);if(-1==n)break;do{s=e.decodeChars[255&t.charCodeAt(l++)]}while(l<h&&-1==s);if(-1==s)break;a.push(String.fromCharCode(n<<2|(48&s)>>4));do{if(o=255&t.charCodeAt(l++),61==o)return i(a.join(""));o=e.decodeChars[o]}while(l<h&&-1==o);if(-1==o)break;a.push(String.fromCharCode((15&s)<<4|(60&o)>>2));do{if(r=255&t.charCodeAt(l++),61==r)return i(a.join(""));r=e.decodeChars[r]}while(l<h&&-1==r);if(-1==r)break;a.push(String.fromCharCode((3&o)<<6|r))}return i(a.join(""))}(t)}}!function(t){t[t.render=1]="render",t[t.extractImageOnly=2]="extractImageOnly",t[t.auto=3]="auto",t[t.renderWithAnnot=4]="renderWithAnnot"}(pc||(pc={}));class Nc extends Mc{constructor(t){super(Pc.PdfReaderModule,t),Xh.add(this),Jh.set(this,void 0),Kh.set(this,void 0),tc.set(this,0),ec.set(this,200),ic.set(this,3),nc.set(this,!1),sc.set(this,void 0),oc.set(this,null),rc.set(this,""),this._outputType=Pa.IT_ALL}static get fonts(){return xa(this,qh,"f",Zh)}static addPdfFont(t,e){return ya(this,0,void 0,(function*(){return xa(this,qh,"m",Qh).call(this,t,e)}))}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){wa(this,qh,Object.create(null),0,Zh)}workerChanged(t){wa(this,nc,!1),t&&(Ec.logD("["+this.id+"] worker changed to "+t),wa(this,tc,t))}setExternalWorkerChanged(t,e){wa(this,Jh,t),wa(this,Kh,e)}_workerChanged(t){this.workerChanged(t),xa(this,Jh,"f")&&xa(this,Jh,"f").call(this,xa(this,Kh,"f"),this,t)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(wa(this,nc,!1),xa(this,Jh,"f")&&xa(this,Jh,"f").call(this,xa(this,Kh,"f"),this))}getPdfInfo(t){return ya(this,0,void 0,(function*(){return yield xa(this,Xh,"m",ac).call(this,t),xa(this,sc,"f")}))}readPage(t,e,i,n,s,o,r,a){return ya(this,0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:n,renderOptions:{resolution:i}},s,o,r,a)}))}readPageEx(t,e,i,n,s,o,r){return ya(this,0,void 0,(function*(){yield xa(this,Xh,"m",ac).call(this,t),e=null!=e?e:0,n=null!=n?n:this._outputType,o=null!=o&&o,s=null!=s&&s,r=null!=r&&r;let a=i?JSON.stringify(i):"{}",l=this._createTask("ReadPdfPageEx");return l.params.input=[e,a,n,s,r],l.params.returnType=o?Aa.RT_BASE64:Aa.RT_AUTO,l.params.returnBlob=!o,l.handleResult=this._handleImageData,this._addTask(l)}))}readPageImageInfos(t,e,i,n){return ya(this,0,void 0,(function*(){yield xa(this,Xh,"m",ac).call(this,t),n=null!=n?n:this._outputType;let s=i?JSON.stringify(i):"{}",o=this._createTask("ReadPageImageInfos");return o.params.input=[e,s,n],this._addTask(o)}))}readPageAnnot(t,e){return ya(this,0,void 0,(function*(){yield xa(this,Xh,"m",ac).call(this,t),e=null!=e?e:0;let i=this._createTask("GetPageAnnot",[e]);return this._addTask(i)}))}findText(t,e,i,n){return ya(this,0,void 0,(function*(){yield xa(this,Xh,"m",ac).call(this,t);let s=0;return n&&(n.matchCase&&(s|=1),n.matchWholeWord&&(s|=2),n.consecutive&&(s|=4)),this._addTask(this._createTask("SearchText",[e,i,s]))}))}getCharInfos(t,e){return ya(this,0,void 0,(function*(){return yield xa(this,Xh,"m",ac).call(this,t),this._addTask(this._createTask("GetPageCharInfos",[e]))}))}getPageInfos(t,e){return ya(this,0,void 0,(function*(){return yield xa(this,Xh,"m",ac).call(this,t),this._addTask(this._createTask("GetPdfPageInfos",[e]))}))}getPdfPageType(t,e){return ya(this,0,void 0,(function*(){return yield xa(this,Xh,"m",ac).call(this,t),this._addTask(this._createTask("GetPageContentType",[e]))}))}UnloadPage(t){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("UnloadPdfPage",[t]))}))}}qh=Nc,Jh=new WeakMap,Kh=new WeakMap,tc=new WeakMap,ec=new WeakMap,ic=new WeakMap,nc=new WeakMap,sc=new WeakMap,oc=new WeakMap,rc=new WeakMap,Xh=new WeakSet,Qh=function(t,e){return ya(this,0,void 0,(function*(){if("string"==typeof t&&0!==t.length||Promise.reject("The 'name' should be a valid string"),void 0===xa(this,qh,"f",Zh)[t])if(e instanceof Blob)xa(this,qh,"f",Zh)[t]=e;else{const i=yield Ac.read(e);xa(this,qh,"f",Zh)[t]=Rc.newBlobInChunks(i)}}))},ac=function(t){var e,i;return ya(this,0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),xa(this,nc,"f")){if(xa(this,oc,"f")===t.fileSource)return void Ec.logD("["+this.id+"] already opened in "+this.workerId);yield xa(this,Xh,"m",uc).call(this)}Ec.logD("["+this.id+"] reopen in worker "+this.workerId),yield xa(this,Xh,"m",dc).call(this,null!==(e=t.fileSource)&&void 0!==e?e:xa(this,oc,"f"),null!==(i=t.password)&&void 0!==i?i:xa(this,rc,"f"))}))},lc=function(){return ya(this,0,void 0,(function*(){if(0===xa(this,tc,"f")||xa(this,tc,"f")!==this.workerId){if(Ec.logD("["+this.id+"] load font in worker "+this.workerId),Pc.FontUseFileReadMode.load)return yield xa(this,Xh,"m",hc).call(this);const t=Nc.fonts,e=Object.keys(t);for(let i of e){const e=t[i],n=yield Ac.read(e);n&&(yield xa(this,Xh,"m",cc).call(this,i,n))}}}))},hc=function(){return ya(this,0,void 0,(function*(){return this._addTask(this._createTask("SetSystemFonts",[Nc.fonts]))}))},cc=function(t,e){return ya(this,0,void 0,(function*(){return this._addTask(this._createTask("AddSystemFont",[t,e]))}))},dc=function(t,e){return ya(this,0,void 0,(function*(){yield xa(this,Xh,"m",lc).call(this),e=null!=e?e:"";let i,n=this,s=n._createTask("LoadPdf");return t!==xa(n,oc,"f")||e!==xa(n,rc,"f")?(t instanceof Blob?wa(n,oc,t):(i=yield n._readFile(t),wa(n,oc,Rc.newBlobInChunks(i))),wa(n,rc,e)):e=xa(n,rc,"f"),xa(n,oc,"f").size>1024*Pc.FileReadModeSize*1024?s.params.input=[xa(n,oc,"f"),e]:(i||(i=yield n._readFile(xa(n,oc,"f"))),s.params.input=[i,e]),s.handleResult=function(e,i){if(e.srcBuffer){let i=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=i&&"[object Uint8ClampedArray]"!=i&&delete e.srcBuffer}let s=Fc.decode(e.infoBase64);try{let t;try{s.replace(new RegExp("\\\\","gi"),"\\\\"),t=JSON.parse(s)}catch(e){t=s}let i={PdfCount:e.pageCount,PdfInfo:t,isTextBased:e.isTextBased};return e.srcBuffer&&(i.srcBuffer=e.srcBuffer,delete e.srcBuffer),wa(n,nc,!0),wa(n,sc,i),i}catch(e){i.reject({code:Ea.wasmJsInvalidJson,message:e.message,stack:e.stack})}},n._addTask(s)}))},uc=function(){return ya(this,0,void 0,(function*(){if(wa(this,oc,null),wa(this,rc,""),xa(this,nc,"f"))return wa(this,nc,!1),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))}))},Zh={value:Object.create(null)};const Uc=["readPdfPage","readTiffPage","readImage"];class Vc{constructor(t){this.items=[],t&&(this.items=t)}push(t){this.items.push(t)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(t){let e;-1!==Uc.indexOf(t.api)&&this.push(t);for(let i of this.items)i.api===t.api&&i.params[0]===t.params[0]&&i.params[1]===t.params[1]&&(e=i);e?(e.resolves=[...e.resolves,...t.resolves],e.rejects=[...e.rejects,...t.rejects]):this.push(t)}remove(t){-1!==Uc.indexOf(t.api)&&this.items.forEach(((e,i)=>{e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&this.items.splice(i,1).forEach((t=>{null==t||t.resolves.forEach((t=>{t(null)}))}))}))}}class Wc{static unload(){if(wa(this,gc,[],0,fc),wa(this,gc,new Vc,0,mc),wa(this,gc,!1,0,xc),Nc.removeFont(),xa(this,gc,"f",vc)){Ec.logD("pdfReader destroy");const t=xa(this,gc,"f",vc);wa(this,gc,null,0,vc),t.terminate()}if(xa(this,gc,"f",yc)){Ec.logD("imageReader destroy");const t=xa(this,gc,"f",yc);wa(this,gc,null,0,yc),t.terminate()}}static updateLicense(t,e,i){return ya(this,0,void 0,(function*(){let n=[];return xa(this,gc,"f",vc)&&n.push(xa(this,gc,"f",vc).updateLicense(t,e,i)),xa(this,gc,"f",yc)&&n.push(xa(this,gc,"f",yc).updateLicense(t,e,i)),Promise.all(n)}))}static add(t){return ya(this,0,void 0,(function*(){xa(this,gc,"f",fc).push(t),xa(this,gc,"f",vc)||(wa(this,gc,new Nc,0,vc),xa(this,gc,"f",vc).setExternalWorkerChanged(xa(Wc,gc,"m",Cc),this),this.initPdfReaderFunctionMap()),xa(this,gc,"f",yc)||(wa(this,gc,new Bc,0,yc),xa(this,gc,"f",yc).setExternalWorkerChanged(xa(Wc,gc,"m",Cc),this),this.initImageReaderFunctionMap())}))}static addFont(t,e){return ya(this,0,void 0,(function*(){Nc.addPdfFont(t,e)}))}static getFonts(){return Nc.getPdfFonts()}static delete(t){const e=xa(this,gc,"f",fc).indexOf(t);if(e>=0&&(xa(this,gc,"f",fc).splice(e,1),0===xa(this,gc,"f",fc).length&&!xa(this,gc,"f",xc))){if(xa(this,gc,"f",vc)){Ec.logD("pdfReader destroy");const t=xa(this,gc,"f",vc);wa(this,gc,null,0,vc),t.terminate()}if(xa(this,gc,"f",yc)){Ec.logD("imageReader destroy");const t=xa(this,gc,"f",yc);wa(this,gc,null,0,yc),t.terminate()}}}static createTask(t,e){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);const n=new Promise((function(t,e){i.resolves.push(t),i.rejects.push(e)}));return i.promise.push(n),xa(this,gc,"m",Sc).call(this,i),n}static cancelTask(t,e){if(-1!==Uc.indexOf(t)){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);xa(this,gc,"f",mc).remove(i)}}static initPdfReaderFunctionMap(){var t,e,i,n,s,o,r,a;xa(this,gc,"f",wc).findPdfText=null===(t=xa(this,gc,"f",vc))||void 0===t?void 0:t.findText,xa(this,gc,"f",wc).getPdfPageInfos=null===(e=xa(this,gc,"f",vc))||void 0===e?void 0:e.getPageInfos,xa(this,gc,"f",wc).getPdfInfo=null===(i=xa(this,gc,"f",vc))||void 0===i?void 0:i.getPdfInfo,xa(this,gc,"f",wc).readPdfPageAnnot=null===(n=xa(this,gc,"f",vc))||void 0===n?void 0:n.readPageAnnot,xa(this,gc,"f",wc).readPdfPage=null===(s=xa(this,gc,"f",vc))||void 0===s?void 0:s.readPageEx,xa(this,gc,"f",wc).readPdfPageImageInfos=null===(o=xa(this,gc,"f",vc))||void 0===o?void 0:o.readPageImageInfos,xa(this,gc,"f",wc).getPdfCharInfos=null===(r=xa(this,gc,"f",vc))||void 0===r?void 0:r.getCharInfos,xa(this,gc,"f",wc).getPdfPageType=null===(a=xa(this,gc,"f",vc))||void 0===a?void 0:a.getPdfPageType}static initImageReaderFunctionMap(){var t,e,i,n,s,o;xa(this,gc,"f",bc).readImage=null===(t=xa(this,gc,"f",yc))||void 0===t?void 0:t.readImage,xa(this,gc,"f",bc).getImageFormat=null===(e=xa(this,gc,"f",yc))||void 0===e?void 0:e.getImageFormat,xa(this,gc,"f",bc).readImageInfo=null===(i=xa(this,gc,"f",yc))||void 0===i?void 0:i.readImageInfo,xa(this,gc,"f",bc).getTiffInfo=null===(n=xa(this,gc,"f",yc))||void 0===n?void 0:n.getTiffInfo,xa(this,gc,"f",bc).readTiffPage=null===(s=xa(this,gc,"f",yc))||void 0===s?void 0:s.readTiffPage,xa(this,gc,"f",bc).getTiffPageInfos=null===(o=xa(this,gc,"f",yc))||void 0===o?void 0:o.getTiffPageInfos}}gc=Wc,Cc=function(t,e,i){let n=null!=t?t:this;xa(n,gc,"f",vc)&&xa(n,gc,"f",vc)!==e&&xa(n,gc,"f",vc).workerChanged(i),xa(n,gc,"f",yc)&&xa(n,gc,"f",yc)!==e&&xa(n,gc,"f",yc).workerChanged(i)},Sc=function(t){xa(this,gc,"f",mc).add(t),xa(this,gc,"f",xc)||(wa(this,gc,!0,0,xc),xa(this,gc,"m",Tc).call(this))},_c=function(){try{xa(this,gc,"f",yc)&&xa(this,gc,"f",yc).makeSureWorkerMemoryNotExceed(),xa(this,gc,"f",vc)&&xa(this,gc,"f",vc).makeSureWorkerMemoryNotExceed()}catch(t){}},Tc=function(){return ya(this,0,void 0,(function*(){do{if(xa(this,gc,"f",mc).isEmpty()||!xa(this,gc,"f",vc)||!xa(this,gc,"f",yc))break;const t=xa(this,gc,"f",mc).pop();if(t)try{let e,i=xa(this,gc,"f",wc)[t.api];i?(e=yield xa(this,gc,"f",wc)[t.api].apply(xa(this,gc,"f",vc),t.params),xa(this,gc,"f",vc).makeSureWorkerMemoryNotExceed()):(i=xa(this,gc,"f",bc)[t.api],i&&(e=yield xa(this,gc,"f",bc)[t.api].apply(xa(this,gc,"f",yc),t.params),xa(this,gc,"f",yc).makeSureWorkerMemoryNotExceed())),null==t||t.resolves.forEach((t=>{t(e)}))}catch(e){Ec.logD(e),t.retry<1?(t.retry+=1,xa(this,gc,"m",_c).call(this),xa(this,gc,"f",mc).push(t)):null==t||t.rejects.forEach((t=>{t(e)}))}}while(!xa(this,gc,"f",mc).isEmpty());wa(this,gc,!1,0,xc)}))},fc={value:[]},mc={value:new Vc},vc={value:void 0},yc={value:void 0},xc={value:!1},wc={value:Object.create(null)},bc={value:Object.create(null)};class Hc{constructor(){Wc.add(this)}destroy(){Wc.delete(this)}readImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){return Wc.createTask("readImage",[t,e,i,n,s])}))}getImageFormat(t){return ya(this,0,void 0,(function*(){return Wc.createTask("getImageFormat",[t])}))}readImageInfo(t){return ya(this,0,void 0,(function*(){return Wc.createTask("readImageInfo",[t])}))}cancelReadImage(t,e){return Wc.cancelTask("readImage",[t,e])}getTiffInfo(t){return ya(this,0,void 0,(function*(){return Wc.createTask("getTiffInfo",[t,!1])}))}readTiffPage(t,e,i,n,s){return ya(this,0,void 0,(function*(){return Wc.createTask("readTiffPage",[t,e,i,n,s])}))}cancelReadTiffPage(t,e){return Wc.cancelTask("readTiffPage",[t,e])}getTiffPageInfos(t,e){return ya(this,0,void 0,(function*(){return Wc.createTask("getTiffPageInfos",[t,e])}))}}var jc,zc,Gc,Yc,$c,Xc,qc,Zc,Jc,Kc,Qc,td,ed,id,nd,sd,od,rd,ad,ld;!function(t){t[t.NearestNeighbour=1]="NearestNeighbour",t[t.Bilinear=2]="Bilinear",t[t.Bicublic=3]="Bicublic",t[t.BestQuality=5]="BestQuality"}(Gc||(Gc={}));class hd extends Lc{constructor(t){super(Pc.ImageProcModule,t),jc.add(this)}initImage(t,e,i,n,s){return ya(this,0,void 0,(function*(){e=null!=e&&e,i=null!=i?i:0,n=null!=n?n:0,s=null!=s&&s;let o=this,r=o._createTask("InitImageObject");if(r.params.input=[t,i,n],e||s)e?r.params.input.push(Pa.IT_RGBA):r.params.input.push(Pa.IT_BGRA),o._addTask(r);else{const e=yield o._readFile(t);r.params.input[0]=e,r.params.input.push(Pa.IT_ALL),o._addTask(r)}const a=yield r.promise;if(a.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete a.srcBuffer}return a}))}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(t,e,i){var n,s,o,r,a,l,h,c,d,u;let p=this;e=null!=e?e:{},i=null!=i?i:{};let g=p._createTask("Filter");if(g.params.input=[],g.params.input.push(t),"toBW"===t)g.params.input.push(JSON.stringify(xa(p,jc,"m",zc).call(p,e)));else if("toGray"===t)g.params.input.push(JSON.stringify(xa(p,jc,"m",zc).call(p,e)));else if("removeShadow"===t)g.params.input.push(JSON.stringify(xa(p,jc,"m",zc).call(p,e)));else if("enhance"===t)g.params.input.push(JSON.stringify(xa(p,jc,"m",zc).call(p,e)));else if("invert"===t)g.params.input.push(JSON.stringify(xa(p,jc,"m",zc).call(p,e)));else if("brightnessAndContrast"===t){let t=null!==(n=e.brightness)&&void 0!==n?n:0,i=null!==(s=e.contrast)&&void 0!==s?s:0;g.params.input.push(t),g.params.input.push(i)}let f=null!==(o=i.returnType)&&void 0!==o?o:Pa.IT_JPG,m=null!==(r=i.jpegQuality)&&void 0!==r?r:this._jpegQuality,v=null!==(a=i.bRGBA)&&void 0!==a&&a,y=null!==(l=i.bitDepth)&&void 0!==l?l:0,x=null!==(h=i.xdpi)&&void 0!==h?h:0,w=null!==(c=i.ydpi)&&void 0!==c?c:0,b=null===(d=i.returnBlob)||void 0===d||d;f=v&&null==f?Pa.IT_JPG:null!=f?f:Pa.IT_ALL;let C=null!==(u=i.is1BitTo8Bit)&&void 0!==u&&u;return g.params.input.push([f,y,x,w,!1,m,!1,C]),g.params.returnBlob=b,g.handleResult=this._handleImageData,p._addTask(g),g.promise}rotate(t,e,i,n){return t=null!=t?t:0,i=null!=i&&i,n=null!=n?n:Gc.Bicublic,e=null!=e?e:"FFFFFF",(t<0||t>360)&&(t%=360)<0&&(t+=360),this._addTask(this._createTask("RotateEx",[t,i,n,e],this._handleBooleanResult))}flip(t){t=null!=t?t:1;let e=this._createTask("");return e.handleResult=this._handleBooleanResult,1===t?e.func="Flip":-1===t&&(e.func="Mirror"),this._addTask(e),e.promise}erase(t,e,i,n,s){let o=this,r=o._createTask("Erase");return r.handleResult=this._handleBooleanResult,r.params.input=[t,e,i,n,JSON.stringify(xa(o,jc,"m",zc).call(o,s))],o._addTask(r),r.promise}crop(t,e,i,n){return this._addTask(this._createTask("Crop",[t,e,i,n],this._handleBooleanResult))}resize(t,e,i){return i=null!=i?i:Gc.BestQuality,this._addTask(this._createTask("ChangeImageSize",[t,e,i],this._handleBooleanResult))}toGrayscaleLevel(t){(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let e={};return 2===t?(e.clean=!0,e.sigma=3,e.scaleLimit=720,e.alpha=1.05):3===t&&(e.clean=!0,e.sigma=5,e.scaleLimit=1080,e.alpha=1.05),this.toGrayscale(e)}toGrayscale(t){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(xa(this,jc,"m",zc).call(this,t)),this._handleBooleanResult))}toBinaryLevel(t,e){(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let i={};return null!=t&&(t?i.method="adaptiveThreshold":(i.method="threshold",2===e?(i.clean=!0,i.sigma=3,i.scaleLimit=720,i.alpha=1.05):3===e&&(i.clean=!0,i.sigma=5,i.scaleLimit=1080,i.alpha=1.05))),this.toBinary(i)}toBinary(t){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(xa(this,jc,"m",zc).call(this,t)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(t,e){return this._addTask(this._createTask("SetImageWidth",[t,JSON.stringify(xa(this,jc,"m",zc).call(this,e))],this._handleBooleanResult))}setImageHeight(t,e){return this._addTask(this._createTask("SetImageHeight",[t,JSON.stringify(xa(this,jc,"m",zc).call(this,e))],this._handleBooleanResult))}setDPI(t,e,i,n,s,o){return s=null!=s&&s,o=null!=o?o:Gc.Bilinear,this._addTask(this._createTask("SetDPI",[t,e,i,n,s,o],this._handleBooleanResult))}getImage(t,e,i,n,s,o,r,a,l){t=null!=t?t:this._jpegQuality,e=null==e||e,n=null!=n?n:0,s=null!=s?s:0,o=null!=o?o:0,r=null==r||r,a=(i=null!=i&&i)&&null==a?Pa.IT_JPG:null!=a?a:Pa.IT_ALL,l=null!=l&&l;let h=this._createTask("GetCurrentImage");return h.params.input=[a,n,s,o,!1,t,e,l],h.params.returnBlob=r,h.handleResult=this._handleImageData,this._addTask(h)}getSkewAngle(t){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(xa(this,jc,"m",zc).call(this,t))],(function(t,e){return t.skewAngle})))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(t,e,i,n,s){return t=null!=t?t:Gc.Bilinear,e=null!=e?e:75,i=null!=i?i:100,n=null!=n?n:0,s=null!=s?s:"",this._addTask(this._createTask("DocumentDetect",[t,e/100,i,n/255,s,"1"]))}perspective(t,e,i,n,s,o,r,a){return this._addTask(this._createTask("Perspective",[t,e,i,n,s,o,r,a],this._handleBooleanResult))}changeBrightness(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,0],this._handleBooleanResult)):this._addTask(this._createTask("ChangeBrightness",[Math.floor(t/1e3*255)],this._handleBooleanResult))}changeContrast(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[0,t],this._handleBooleanResult)):this._addTask(this._createTask("ChangeContrast",[1+t/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(t,e){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,e],this._handleBooleanResult))}removeShadowLevel(t,e){e=null!=e?e:1.05,(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let i={};return 1===t&&(i.sigma=3,i.scaleLimit=720,i.alpha=e),2===t?(i.sigma=5,i.scaleLimit=1080,i.alpha=e):3===t&&(i.sigma=10,i.scaleLimit=0,i.alpha=e),this.removeShadow(i)}removeShadow(t){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(xa(this,jc,"m",zc).call(this,t))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],(function(t,e){return t.blurryScore})))}drawQuadrangle(t,e,i,n,s,o,r,a,l){return this._addTask(this._createTask("DrawQuadrangle",[t,e,i,n,s,o,r,a,JSON.stringify(xa(this,jc,"m",zc).call(this,l))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}jc=new WeakSet,zc=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e};class cd{constructor(){Wc.add(this)}destroy(){Wc.delete(this)}static addPdfFont(t,e){return ya(this,0,void 0,(function*(){return Wc.addFont(t,e)}))}static getPdfFonts(){return Wc.getFonts()}getPdfInfo(t){return ya(this,0,void 0,(function*(){return Wc.createTask("getPdfInfo",[t])}))}getPdfPageType(t,e){return ya(this,0,void 0,(function*(){return Wc.createTask("getPdfPageType",[t,e])}))}readPage(t,e,i,n,s,o,r,a){return ya(this,0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:n,renderOptions:{resolution:i}},s,o,r,a)}))}readPageEx(t,e,i,n,s,o,r){return ya(this,0,void 0,(function*(){return Wc.createTask("readPdfPage",[t,e,i,n,s,o,r])}))}cancelReadPage(t,e){return Wc.cancelTask("readPdfPage",[t,e])}readPageImageInfos(t,e,i,n,s,o,r){return ya(this,0,void 0,(function*(){return Wc.createTask("readPdfPageImageInfos",[t,e,i,n,s,o,r])}))}readPageAnnot(t,e){return ya(this,0,void 0,(function*(){return Wc.createTask("readPdfPageAnnot",[t,e])}))}findText(t,e,i,n){return ya(this,0,void 0,(function*(){return Wc.createTask("findPdfText",[t,e,i,n])}))}getCharInfos(t,e){return ya(this,0,void 0,(function*(){return Wc.createTask("getPdfCharInfos",[t,e])}))}getPageInfos(t,e){return ya(this,0,void 0,(function*(){return Wc.createTask("getPdfPageInfos",[t,e])}))}}!function(t){t[t.auto=0]="auto",t[t.store=1]="store"}(Zc||(Zc={}));class dd extends Lc{constructor(t){super(Pc.PdfWriterModule,t),Yc.add(this)}initPdfSetting(t){return ya(this,0,void 0,(function*(){let e=this,i=e._createTask("CreateDocument");return i.params.input=[JSON.stringify(xa(e,Yc,"m",qc).call(e,t))],i.handleResult=this._handleBooleanResult,yield xa(this,Yc,"m",$c).call(this),e._addTask(i)}))}appendPage(t,e){return ya(this,0,void 0,(function*(){let i=this,n=i._createTask("InsertImagePage");e=null!=e&&e;const s=yield i._readFile(t);return n.params.input=[s,-1,e],n.handleResult=i._handleBooleanResult,i._addTask(n),n.promise}))}insertPage(t,e,i){return ya(this,0,void 0,(function*(){let n=this,s=n._createTask("InsertImagePage");i=null!=i&&i;const o=yield n._readFile(t);return s.params.input=[o,e,i],s.handleResult=n._handleBooleanResult,n._addTask(s),s.promise}))}writePdf(t){return ya(this,0,void 0,(function*(){let e=this._createTask("GetCurrentPdf");return e.params.returnType=null!=t?t:Aa.RT_AUTO,e.params.returnBlob=t!=Aa.RT_AUTO,e.handleResult=this._handleImageData,this._addTask(e)}))}insertBlankPage(t,e,i){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:595,i=null!=i?i:842,this._addTask(this._createTask("InsertBlankPage",[t,e,i]))}))}deletePage(t){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("DeletePdfPage",[t],this._handleBooleanResult))}))}pageSetRotation(t,e){return ya(this,0,void 0,(function*(){t=null!=t?t:0,0!=(e=((e=null!=e?e:0)%360+360)%360)&&90!==e&&180!==e&&270!==e&&(e=0);let i=this._createTask("SetPageRotation");return i.params.input=[t,e],i.handleResult=this._handleBooleanResult,this._addTask(i)}))}pageSetCropBox(t,e,i,n,s){return ya(this,0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(n=null!=n?n:e)<e&&(n=e),(s=null!=s?s:i)<i&&(s=i);let o=this._createTask("SetPageCropBox");return o.params.input=[t,e,i,n,s],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageSetMediaBox(t,e,i,n,s){return ya(this,0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(n=null!=n?n:e)<e&&(n=e),(s=null!=s?s:i)<i&&(s=i);let o=this._createTask("SetPageMediaBox");return o.params.input=[t,e,i,n,s],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageAddImage(t,e,i,n,s,o){return ya(this,0,void 0,(function*(){o=null!=o&&o;let r=this,a=r._createTask("PageAddImage"),l=JSON.stringify(xa(r,Yc,"m",qc).call(r,i));const h=yield r._readFile(t);return a.params.input=[h,e,l,n,s,o],a.handleResult=r._handleBooleanResult,r._addTask(a),a.promise}))}pageAddText(t,e){return ya(this,0,void 0,(function*(){let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddText",[t,i],this._handleBooleanResult))}))}pageAddPath(t,e){return ya(this,0,void 0,(function*(){let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddPath",[t,i],this._handleBooleanResult))}))}pageClearObjects(t){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("PageClearObjects",[t],this._handleBooleanResult))}))}pageSetAnnot(t,e){return ya(this,0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t)})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("SetPageAnnot",[t,i],this._handleBooleanResult))}))}pageFlattenAnnot(t,e){return ya(this,0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t)})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("FlattenPageAnnot",[t,i],this._handleBooleanResult))}))}getFontFromTextObject(t){return t.fontName?t.fontName:""}getFontFromAnnot(t){let e=[];t&&t.normalAppearance&&t.normalAppearance.objs&&t.normalAppearance.objs.forEach((t=>{if("text"===t.type){const i=t,n=this.getFontFromTextObject(i);n&&e.push(n)}}));const i=new Set(e);return e=[...i],e}getFontFromAnnots(t){let e=[];Array.isArray(t)?t.forEach((t=>{const i=this.getFontFromAnnot(t);e=e.concat(i)})):e=this.getFontFromAnnot(t);const i=new Set(e);return e=[...i],e}pageAddAnnot(t,e){return ya(this,0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t)})),i+="]"):i=JSON.stringify(e),this._addTask(this._createTask("PageAddAnnot",[t,i],this._handleBooleanResult))}))}pageDeleteAnnot(t,e){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("DeletePageAnnot",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByTypes(t,e){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByTypes",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByNames(t,e){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByNames",[t,e],this._handleBooleanResult))}))}mergePdf(t,e,i,n,s){return ya(this,0,void 0,(function*(){n=null!=n?n:-1,i=null!=i?i:[],e=null!=e?e:"",s=null!=s&&s;let o,r=this,a=r._createTask("MergePdfPages");return o=t instanceof Blob?t:yield r._readFile(t),a.params.input=[o,n,e,i,s],a.handleResult=r._handleBooleanResult,r._addTask(a),a.promise}))}pageFlatten(t,e){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("PageFlatten",[t,e],this._handleBooleanResult))}))}GetFontInfo(t){return ya(this,0,void 0,(function*(){const e=yield this._readFile(t);return this._addTask(this._createTask("GetFontInfo",[e]))}))}IfFontsExist(t){return ya(this,0,void 0,(function*(){let e=JSON.stringify(t);return yield xa(this,Yc,"m",$c).call(this),this._addTask(this._createTask("IfFontsExist",[e]))}))}UnloadPage(t){return ya(this,0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("UnloadPdfPage",[t]))}))}}Yc=new WeakSet,$c=function(){return ya(this,0,void 0,(function*(){if(Ec.logD("["+this.id+"] load font in worker "+this.workerId),0===Object.keys(Nc.fonts).length)return null;if(Pc.FontUseFileReadMode.save)return this._addTask(this._createTask("LoadFonts",[Nc.fonts]));const t=Nc.fonts,e=Object.keys(t);for(let i of e){const e=t[i],n=yield Ac.read(e);n&&(yield xa(this,Yc,"m",Xc).call(this,i,n))}}))},Xc=function(t,e){return ya(this,0,void 0,(function*(){return this._addTask(this._createTask("LoadFont",[e,t]))}))},qc=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e},function(t){t.Text="Text",t.Link="Link",t.FreeText="FreeText",t.Line="Line",t.Square="Square",t.Circle="Circle",t.Polygon="Polygon",t.PolyLine="PolyLine",t.Hignlight="Highlight",t.Underline="Underline",t.Squiggly="Squiggly",t.StrikeOut="StrikeOut",t.Stamp="Stamp",t.Caret="Caret",t.Ink="Ink",t.Popup="Popup"}(Jc||(Jc={})),function(t){t.None="none",t.Invisible="invisible",t.Hidden="hidden",t.Print="print",t.NoZoom="nozoom",t.NoRotate="norotate",t.NoView="noview",t.ReadOnly="readonly",t.Locked="locked",t.ToggleNoView="togglenoview",t.LockedContents="lockedcontents"}(Kc||(Kc={})),function(t){t.Solid="S",t.Dashed="D",t.Beveled="B",t.Insert="I",t.Underline="U"}(Qc||(Qc={})),function(t){t.NoEffect="S",t.Cloudy="C"}(td||(td={})),function(t){t.Comment="Comment",t.Key="Key",t.Note="Note",t.Help="Help",t.NewParagraph="NewParagraph",t.Paragraph="Paragraph",t.Insert="Insert"}(ed||(ed={})),function(t){t.Marked="Marked",t.Review="Review"}(id||(id={})),function(t){t.Accepted="Accepted",t.Rejected="Rejected",t.Cancelled="Cancelled",t.Completed="Completed",t.None="None"}(nd||(nd={})),function(t){t.None="None",t.Square="Square",t.Circle="Circle",t.Diamond="Diamond",t.OpenArrow="OpenArrow",t.ClosedArrow="ClosedArrow",t.Butt="Butt",t.ROpenArrow="ROpenArrow",t.RClosedArrow="RClosedArrow",t.Slash="Slash"}(sd||(sd={})),function(t){t[t.LeftJustified=0]="LeftJustified",t[t.Centered=1]="Centered",t[t.RightJustified=2]="RightJustified"}(od||(od={})),function(t){t.FreeText="FreeText",t.FreeTextCallout="FreeTextCallout",t.FreeTextTypeWriter="FreeTextTypeWriter"}(rd||(rd={})),function(t){t.LineArrow="LineArrow",t.LineDimension="LineDimension"}(ad||(ad={})),function(t){t.Approved="Approved",t.Experimental="Experimental",t.NotApproved="NotApproved",t.Asls="Asls",t.Expired="Expired",t.NotForPublicRelease="NotForPublicRelease",t.Confidential="Confidential",t.Final="Final",t.Sold="Sold",t.Departmental="Departmental",t.ForComment="ForComment",t.TopSecret="TopSecret",t.Draft="Draft",t.ForPublicRelease="ForPublicRelease"}(ld||(ld={}));const ud="undefined"==typeof self,pd=ud?{}:self;let gd,fd,md,vd,yd;"undefined"!=typeof navigator&&(gd=navigator,fd=gd.userAgent,md=gd.platform,vd=gd.mediaDevices),function(){if(!ud){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:gd.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:md,search:"Win"},Mac:{str:md},Linux:{str:md}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||fd,r=s.search||e,a=s.verStr||fd,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||fd,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=fd.indexOf("Windows NT")&&(s="HarmonyOS"),yd={browser:i,version:n,OS:s}}ud&&(yd={browser:"ssr",version:0,OS:"ssr"})}(),vd&&vd.getUserMedia;const xd="Chrome"===yd.browser&&yd.version>66||"Safari"===yd.browser&&yd.version>13||"OPR"===yd.browser&&yd.version>43||"Edge"===yd.browser&&yd.version>15,wd="\\s*([+-]?\\d+)\\s*",bd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sd=/^#([0-9a-f]{3,8})$/,_d=new RegExp(`^rgb\\(${wd},${wd},${wd}\\)$`),Td=new RegExp(`^rgb\\(${Cd},${Cd},${Cd}\\)$`),Ed=new RegExp(`^rgba\\(${wd},${wd},${wd},${bd}\\)$`),Pd=new RegExp(`^rgba\\(${Cd},${Cd},${Cd},${bd}\\)$`),Ad=new RegExp(`^hsl\\(${bd},${Cd},${Cd}\\)$`),Id=new RegExp(`^hsla\\(${bd},${Cd},${Cd},${bd}\\)$`),Dd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let kd=class{constructor(t,e,i,n){na(this,"r",void 0),na(this,"g",void 0),na(this,"b",void 0),na(this,"opacity",void 0),this.r=t,this.g=e,this.b=i,this.opacity=n}};function Rd(t){return new kd(t>>16&255,t>>8&255,255&t,1)}function Md(t,e,i,n){return n<=0&&(t=NaN,e=NaN,i=NaN),new kd(t,e,i,n)}function Ld(t,e,i,n){return n<=0?(t=NaN,e=NaN,i=NaN):i<=0||i>=1?(t=NaN,e=NaN):e<=0&&(t=NaN),{h:t,s:e,l:i,opacity:n}}function Od(t,e,i){return t<60?(e+(i-e)*t)/60*255:t<180?255*i:t<240?(e+(i-e)*(240-t))/60*255:255*e}function Bd(t){const e=t.h<0?t.h%360+360:t.h%360,i=Number.isNaN(e)||Number.isNaN(t.s)?0:t.s,{l:n}=t,s=n+(n<.5?n:1-n)*i,o=2*n-s;return new kd(Od(e>=240?e-240:e+120,o,s),Od(e,o,s),Od(e<120?e+240:e-120,o,s),t.opacity)}const Fd=t=>t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),Nd=t=>Object.prototype.toString.call(t),Ud=t=>Array.isArray?Array.isArray(t):"[object Array]"===Nd(t),Vd=t=>null!==t&&"[object Object]"===Nd(t),Wd=t=>{let e=null;return Ud(t)&&(e||(e=[]),t.forEach((t=>{e.push(Wd(t))}))),Vd(t)&&(e||(e={}),Object.keys(t).forEach((i=>{e[i]=Wd(t[i])}))),e||t},Hd=t=>void 0===t,jd=(t,e)=>{var i;t=null!==(i=t)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";const n=Hd(e)?new Date:new Date(e),s={"M+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"h+":n.getHours().toString(),"m+":n.getMinutes().toString(),"s+":n.getSeconds().toString(),"q+":Math.floor((n.getMonth()+3)/3).toString(),S:n.getMilliseconds().toString()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,`${n.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(s).forEach((e=>{new RegExp(`(${e})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?s[e]:`00${s[e]}`.substring(`${s[e]}`.length)))})),t},zd=t=>"[object ArrayBuffer]"===Nd(t),Gd=t=>"[object Blob]"===Nd(t),Yd=t=>"[object Boolean]"===Nd(t),$d=t=>"function"==typeof t,Xd=()=>"ontouchstart"in document.documentElement,qd=t=>"number"==typeof t&&!Number.isNaN(t),Zd=t=>"string"==typeof t,Jd=(t,e,i)=>Math.min(Math.max(t,e),i);let Kd=0;const Qd=()=>(Kd+=1,`${(new Date).getTime().toString(36)}${Kd.toString(36)}`),tu=t=>{const e=window.URL||window.webkitURL;let i="string";return Zd(t)?i="string":Gd(t)?(i="blob",t=e.createObjectURL(t)):(zd(t)||Ud(t))&&(i="blob",t=e.createObjectURL(new Blob([t]))),{type:i,data:t}};function eu(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}let iu=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";na(this,"prefix",void 0),na(this,"postfix",void 0),na(this,"isDestroyed",!1),na(this,"uid",Qd()),na(this,"cacheEvents",void 0),na(this,"events",void 0),na(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=e}static create(e,i){return new t(e,i)}save(){this.isCached=!0}restore(){this.isCached=!1,this.cacheEvents.forEach((t=>{let{eventName:e,param:i}=t;this.emit(e,...i)})),this.cacheEvents.length=0}destroy(){if(!this.isDestroyed){for(const t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){const e=this.events[t];e&&e.slice().forEach((t=>{let{name:e,fn:i,context:n,once:s}=t;this.off(e,i,n,s)}))}this.events={},this.isDestroyed=!0}}on(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:s}=this,o={name:t=this.format(t),uid:Qd(),context:i,once:n,fn:e};return s[t]||(s[t]=[]),s[t].indexOf(o)<0&&s[t].push(o),o}once(t,e,i){return this.on(t,e,i,!0)}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this.isCached)return this.cacheEvents.push({eventName:t,param:i}),!0;const{events:s}=this,o=s[t=this.format(t)];return!(!o||!o.length||(o.slice().forEach((t=>{let{fn:e,context:n}=t;e.call(n||null,...i)})),o.slice().forEach((e=>{let{fn:i,context:n,once:s}=e;s&&this.off(t,i,n,s)})),0))}off(t,e,i,n){const{events:s}=this,o=s[t=this.format(t)];if(!o)return!1;if(!arguments.length)return o.length=0,!0;for(let t=o.length-1;t>=0;t--){const s=o[t];e&&s.fn!==e||i&&s.context!==i||n&&s.once!==n||o.splice(t,1)}return!0}removeAllEventListeners(t){if(t){t=this.format(t);const e=this.cacheEvents.findIndex((e=>e.eventName===t));e>-1&&this.cacheEvents.splice(e,1),this.events[t]&&delete this.events[t]}else this.cacheEvents=[],this.events={}}getAllEvents(){return this.events}format(t){return`${this.prefix||""}${t}${this.postfix||""}`}};const nu="default";let su=class t{constructor(){na(this,"emitter",new iu)}static create(){return new t}on(t){this.emitter.on(nu,t)}emit(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.emitter.emit(nu,...e)}off(t){this.emitter.off(nu,t)}};function ou(){return new su}class ru{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;na(this,"x",void 0),na(this,"y",void 0),na(this,"z",void 0),this.x=t,this.y=e,this.z=i}static fromPoint(t){return new ru(t.x,t.y,t.z)}static fromTwoPoint(t,e){var i,n,s,o,r,a;return new ru((null!==(i=e.x)&&void 0!==i?i:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(s=e.y)&&void 0!==s?s:0)-(null!==(o=t.y)&&void 0!==o?o:0),(null!==(r=e.z)&&void 0!==r?r:0)-(null!==(a=t.z)&&void 0!==a?a:0))}static fromValue(t,e,i){return new ru(t,e,i)}setFromVector(t){var e;this.x=t.x,this.y=t.y,this.z=null!==(e=t.z)&&void 0!==e?e:0}clone(){return new ru(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(t){var e;return this.x*t.x+this.y*t.y+this.z*(null!==(e=t.z)&&void 0!==e?e:0)}projectionTo(t){const e=Math.hypot(t.x,t.y,t.z);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y,t.z),i=e&&this.dot(t)/e;return Math.acos(Jd(i,-1,1))}equals(t){var e;return this.x===t.x&&this.y===t.y&&this.z===(null!==(e=t.z)&&void 0!==e?e:0)}distance(t){var e;return Math.hypot(this.x-t.x,this.y-t.y,this.z-(null!==(e=t.z)&&void 0!==e?e:0))}lerp(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:n,y:s,z:o}=this;return new ru(n+i*(t.x-n),s+i*(t.y-s),o+i*((null!==(e=t.z)&&void 0!==e?e:0)-o))}normalize(){const t=this,e=t.norm();return t.x/=e,t.y/=e,t.z/=e,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(t){const e=this;return{x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}}function au(t,e){return ru.fromTwoPoint(t,e)}class lu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;na(this,"x",void 0),na(this,"y",void 0),na(this,"z",void 0),this.x=t,this.y=e,this.z=i}static fromPoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new lu(t.x,t.y,t.z)}matrixTransform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:e,y:i,z:n}=this,{m11:s,m21:o,m31:r,m41:a,m12:l,m22:h,m32:c,m42:d,m13:u,m23:p,m33:g,m43:f,m14:m,m24:v,m34:y,m44:x}=t,w=m*e+v*i+y*n+x;return hu({x:(s*e+o*i+r*n+a)/w,y:(l*e+h*i+c*n+d)/w,z:(u*e+p*i+g*n+f)/w})}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this}clone(){return hu(this)}equals(t){const{x:e=0,y:i=0,z:n=0}=t,s=this;return s.x===e&&s.y===i&&s.z===n}distanceTo(t){const{x:e=0,y:i=0,z:n=0}=t,s=this;return Math.hypot(s.x-e,s.y-i,s.z-n)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i=0,y:n=0,z:s=0}=t,o=this;return hu({x:o.x+e*(i-o.x),y:o.y+e*(n-o.y),z:o.z+e*(s-o.z)})}footPointInSegment(t,e){const i=au(t,this),n=au(t,e),s=n.norm(),o=hu(t);if(0===s)return o;const r=i.projectionTo(n)/s;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}}function hu(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return qd(t)?new lu(t,e,i):new lu(t.x,t.y,t.z)}function cu(t,e){return((t.x-e.x)**2+(t.y-e.y)**2)**.5}class du{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;na(this,"x",0),na(this,"y",0),na(this,"left",0),na(this,"top",0),na(this,"right",0),na(this,"bottom",0),na(this,"width",0),na(this,"height",0),this.update(t,e,i,n)}update(t,e,i,n){this.x=t,this.y=e,this.left=t,this.top=e,this.right=t+i,this.bottom=e+n,this.width=i,this.height=n}toJSON(){}}const uu=new class{constructor(){na(this,"tasks",[])}createTimer(t,e){const i=Qd();return this.tasks.push({uid:i,callback:t,time:e}),this.executeTimer(i),i}executeTimer(t){const e=this.tasks.find((e=>e.uid===t));if(!e)return;const i=()=>{e.callback(),null!==e.timer&&(e.timer=setTimeout(i,e.time))};e.timer=setTimeout(i,e.time)}clearTimer(t){const e=this.tasks.findIndex((e=>e.uid===t));e>-1&&(clearTimeout(this.tasks[e].timer),this.tasks[e].timer=null,this.tasks.splice(e,1))}};function pu(t,e,i,n){if(function(t,e,i,n){return Math.min(t[0],e[0])<=Math.max(i[0],n[0])&&Math.min(i[0],n[0])<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=Math.max(i[1],n[1])&&Math.min(i[1],n[1])<=Math.max(t[1],e[1])}(t,e,i,n)&&function(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((s^o)>=0&&0!==s&&0!==o||(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),o=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),(s^o)>=0&&0!==s&&0!==o))}(t,e,i,n)){let s=(n[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-n[1]),o=(t[1]-i[1])*(e[0]-t[0])*(n[0]-i[0])+i[0]*(n[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(n[0]-i[0]);if(0===s||0===o){const s=gu(t,e),o=gu(i,n),r=s[0],a=s[1],l=o[0],h=o[1];if(a[0]===l[0]&&a[1]===l[1])return a;if(r[0]===h[0]&&r[1]===h[1])return r;if(fu(a,o)&&fu(l,s))return[l,a];if(fu(r,o)&&fu(h,s))return[r,h];if(fu(r,o)&&fu(a,o))return[r,a];if(fu(l,o)&&fu(h,o))return[l,h]}const r=o/s;return s=(t[0]-e[0])*(n[1]-i[1])-(e[1]-t[1])*(i[0]-n[0]),o=e[1]*(t[0]-e[0])*(n[1]-i[1])+(n[0]-e[0])*(n[1]-i[1])*(t[1]-e[1])-n[1]*(i[0]-n[0])*(e[1]-t[1]),[r,o/s]}return!1}function gu(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]}function fu(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]}function mu(t){const e=[];let i=null;const n=t.slice(0,8).concat(t[0],t[1]);for(let t=0;t<4;t++){const s=n[2*(t+1)+1]-n[2*t+1],o=n[2*(t+1)]-n[2*t];i=0===s&&0===o?0:s/o,e.push(i)}return e}function vu(t){const[e,i,n,s,o,r,a,l]=t,h=(a-e)*(s-i)-(l-i)*(n-e),c=(e-n)*(r-s)-(i-s)*(o-n),d=(n-o)*(l-r)-(s-r)*(a-o),u=(o-a)*(i-l)-(r-l)*(e-a);if(h*c*d*u<0)return!1;const p=t.slice().concat(t.slice(0,2)),g=mu(t);if(g.length)for(let t=0;t<2;t++)if(g[t]!==g[t+2]&&pu(p.slice(2*t,2*(t+1)),p.slice(2*(t+1),2*(t+2)),p.slice(2*(t+2),2*(t+3)),p.slice(2*(t+3),2*(t+4))))return!1;return h*c*d*u>0}function yu(t,e){return((t.x-e.x)**2+(t.y-e.y)**2)**.5}function xu(t){const{type:e,value:i}=t;return"hex"===e?`#${i}`:"literal"===e?i:"rgb"===e?`rgb(${i.join(",")})`:`rgba(${i.join(",")})`}const wu=function(){const t=/^(linear\-gradient)/i,e=/^(repeating\-linear\-gradient)/i,i=/^(radial\-gradient)/i,n=/^(repeating\-radial\-gradient)/i,s=/^(conic\-gradient)/i,o=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,r=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,a=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,d=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,u=/^\(/,p=/^\)/,g=/^,/,f=/^\#([0-9a-fA-F]+)/,m=/^([a-zA-Z]+)/,v=/^rgb/i,y=/^rgba/i,x=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/;let w="";function b(t){throw new Error(`${w}: ${t}`)}function C(){return S("linear-gradient",t,T)||S("repeating-linear-gradient",e,T)||S("radial-gradient",i,E)||S("repeating-radial-gradient",n,E)||S("conic-gradient",s,E)}function S(t,e,i){return _(e,(e=>{const n=i();return n&&(F(g)||b("Missing comma before color stops")),{type:t,orientation:n,colorStops:k(R)}}))}function _(t,e){const i=F(t);if(i){F(u)||b("Missing (");const t=e(i);return F(p)||b("Missing )"),t}}function T(){return B("directional",o,1)||B("angular",d,1)}function E(){let t,e,i=P();return i&&(t=[],t.push(i),e=w,F(g)&&(i=P(),i?t.push(i):w=e)),t}function P(){let t=function(){const t=B("shape",/^(circle)/i,0);return t&&(t.style=O()||A()),t}()||function(){const t=B("shape",/^(ellipse)/i,0);return t&&(t.style=L()||A()),t}();if(t)t.at=I();else{const e=A();if(e){t=e;const i=I();i&&(t.at=i)}else{const e=D();e&&(t={type:"default-radial",at:e})}}return t}function A(){return B("extent-keyword",r,1)}function I(){if(B("position",/^at/,0)){const t=D();return t||b("Missing positioning value"),t}}function D(){const t={x:L(),y:L()};if(t.x||t.y)return{type:"position",value:t}}function k(t){let e=t();const i=[];if(e)for(i.push(e);F(g);)e=t(),e?i.push(e):b("One extra comma");return i}function R(){const t=B("hex",f,1)||_(y,(()=>({type:"rgba",value:k(M)})))||_(v,(()=>({type:"rgb",value:k(M)})))||B("literal",m,0);return t||b("Expected color definition"),t.length=L(),t}function M(){return F(x)[1]}function L(){return B("%",h,1)||B("position-keyword",a,1)||O()}function O(){return B("px",l,1)||B("em",c,1)}function B(t,e,i){const n=F(e);if(n)return{type:t,value:n[i]}}function F(t){const e=/^[\n\r\t\s]+/.exec(w);e&&N(e[0].length);const i=t.exec(w);return i&&N(i[0].length),i}function N(t){w=w.substring(t)}return function(t){return w=t,function(){const t=k(C);return w.length>0&&b("Invalid input not EOF"),t}()}}(),bu={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},Cu={};let Su;function _u(t,e){const i=Object.keys(t);let n=0;for(;n<i.length;n++){const s=i[n];if(!1===e.call(null,t[s],s,t))break}}_u(bu,((t,e)=>{Cu[t]=e}));const Tu=t=>{const{parentNode:e}=t,{children:i}=e;for(let e=0;e<i.length;e++)if(i[e]===t)return e;return-1},Eu=(t,e,i)=>{try{void 0===e?i.appendChild(t):i.insertBefore(t,e)}catch(t){}},Pu=()=>{const t=window;if(t){if(t.devicePixelRatio)return t.devicePixelRatio;if(t.screen.deviceXDPI&&t.screen.logicalXDPI)return t.screen.deviceXDPI/t.screen.logicalXDPI}return 1};function Au(t){let e="0px",i="",n="solid";if(!Hd(t)&&""!==t){const s=document.createElement("div");s.style.border=t;const{borderWidth:o,borderColor:r,borderStyle:a}=s.style;"initial"!==o&&""!==o&&(e=o),"initial"!==r&&""!==r&&(i=r),"initial"!==a&&""!==a&&(n=a)}return{borderWidth:e,borderColor:i,borderStyle:n}}const Iu=t=>{const{pointerType:e}=t;return"touch"===e||"pen"===e||void 0===e};let Du;function ku(t){return void 0===Du&&(Du=/Mac OS/.test(navigator.userAgent)),Ou(t,Du?3:2)}function Ru(t){return Ou(t,5)}function Mu(t){return Ou(t,1)}function Lu(t){return Ou(t,0)}function Ou(t,e){const{ctrlKey:i,metaKey:n,altKey:s,shiftKey:o}=t;switch(e){case 0:return i||n||s||o;case 1:return!(i||n||s||o);case 2:return i&&!n&&!s&&!o;case 3:return!i&&n&&!s&&!o;case 4:return!i&&!n&&s&&!o;case 5:return!i&&!n&&!s&&o;default:return!1}}const Bu=function(t,e){const i=t.indexOf(e);return!(i<0||(t.splice(i,1),0))},Fu=function(t,e,i){if(qd(i)){let n=[],s=[];if(e.includes(i)){const t=e.length;if(t>1){const o=e.indexOf(i);0===o?s=e.slice(1):o===t-1?n=e.slice(0,-1):(n=e.slice(0,o),s=e.slice(o+1))}}else n=e;const o=t[i],r=n.map((e=>t[e])),a=s.map((e=>t[e]));r.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),a.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)}));const l=t.indexOf(o);t.splice(l+1,0,...a),t.splice(l,0,...r)}else e.map((e=>t[e])).forEach((e=>{const i=t.indexOf(e);t.splice(i,1),t.push(e)}));return!0},Nu=function(t,e,i){if(e===i)return!0;const n=t[e];return t[e]=t[i],t[i]=n,!0},Uu=function(t,e){const i=e.length;return!(t.length!==i||!i||(e.every(((t,e)=>t===e))||e.map((e=>t[e])).forEach(((e,i)=>{t[i]=e})),0))};function Vu(t){return null==t}const Wu=(t,e)=>t in e,Hu=(t,e)=>{const i=[];for(;t;){const n=t.match(e);if(!n)break;i.push(n),t=t.substring(n.index+n[0].length)}return i};function ju(t,e){return Object.keys(t).forEach((i=>{(function(t){return"__proto__"===t||"constructor"===t||"prototype"===t})(i)||(Hd(e[i])?e[i]=t[i]:Vd(t[i])?ju(t[i],e[i]):e[i]=t[i])})),e}class zu{static read(t){return new Promise(((e,i)=>{const n=Object.prototype.toString.call(t);if("[object String]"===n){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((t=>t.arrayBuffer())).then((t=>e(t))).catch((t=>Promise.reject(t)));i("Error url: Can not read the file URL")}else if("[object Blob]"===n||"[object FileList]"===n||"[object File]"===n){let s=t;"[object FileList]"!==n&&"[object File]"!==n||(s=t[0]?t[0]:t),ha(zu,zu,Gu).call(zu,s,e,i)}else"[object ArrayBuffer]"===n||"[object Uint8ClampedArray]"===n?e(t):i(`Not support source type: ${n}`)}))}}function Gu(t,e,i){let n,s,o=0;try{n=new ArrayBuffer(t.size),s=new Uint8Array(n)}catch(t){i(t)}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null!=a&&null!==(l=a.target)&&void 0!==l&&l.result){const i=a.target.result;s.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(n)}else i(a)},a.onerror=function(t){i(t)},a.onabort=function(t){i(t)};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h)}()}async function Yu(t){let e;if(t instanceof ArrayBuffer)t.byteLength>12&&(e=new Uint8Array(t.slice(0,12)));else if(t instanceof Blob&&t.size>12){const i=t.slice(0,12),n=await zu.read(i);e=new Uint8Array(n)}if(e){if(function(t){return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]}(e))return"application/pdf";if(function(t){return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]}(e))return"image/png";if(function(t){return 255===t[0]&&216===t[1]}(e))return"image/jpeg";if(function(t){return 66===t[0]&&77===t[1]}(e))return"image/bmp";if(function(t){return 73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]}(e))return"image/tiff";if(function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&12===t[3]&&106===t[4]&&80===t[5]&&32===t[6]&&32===t[7]||255===t[0]&&79===t[1]&&255===t[2]&&81===t[3]}(e))return"image/jp2";if(function(t){return 82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]}(e))return null;if(t instanceof Blob&&("application/pdf"===t.type||"image/bmp"===t.type||"image/jp2"===t.type||"image/jpeg"===t.type||"image/png"===t.type||"image/tiff"===t.type||"image/rgba"===t.type))return t.type}return t instanceof Blob&&"application/ddv-blank-image"===t.type?t.type:null}function $u(t,e,i){return e===i?t:qd(t)?t/e*i:Ud(t)?t.map((t=>Ud(t)?[t[0]/e*i,t[1]/e*i]:t/e*i)):(t={...t},Object.keys(t).forEach((n=>{t[n]=t[n]/e*i})),t)}function Xu(t,e){return t.every(((t,i)=>{let[n,s]=t;const[o,r]=e[i];return n===o&&s===r}))}function qu(t,e){return Number.parseFloat(t.toFixed(e))}class Zu{constructor(){na(this,"disposed",!1),na(this,"toDispose",new Set)}get isDisposed(){return this.disposed}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(t),t.dispose()}}dispose(){this.disposed||(this.disposed=!0,this.clear())}clear(){try{for(const t of this.toDispose)if(t)try{t.dispose()}catch(t){throw new Error("can not dispose an object")}}finally{this.toDispose.clear()}}}class Ju{constructor(){na(this,"store",new Zu)}dispose(){this.store.dispose()}register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(t)}}class Ku{static create(t){return new Ku(t)}constructor(t){na(this,"isDisposed",!1),na(this,"listeners",void 0),na(this,"options",void 0),this.options=t,this.listeners=[]}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null))}on(t,e,i){var n,s,o,r;if(this.isDisposed)return{dispose:()=>{}};const a={uid:Qd(),callback:t,context:e};this.listeners.length?this.listeners.push(a):(null!==(n=this.options)&&void 0!==n&&null!==(s=n.beforeAddFirstListener)&&void 0!==s&&s.call(n,this),this.listeners.push(a),null===(o=this.options)||void 0===o||null===(r=o.afterAddFirstListener)||void 0===r||r.call(o,this));const l={dispose:()=>{this.remove(a)}};return i instanceof Zu?i.add(l):Array.isArray(i)?i.push(l):i instanceof Ju&&i.register(l),l}remove(t){var e,i,n,s;if(null!==(e=this.options)&&void 0!==e&&null!==(i=e.beforeRemoveListener)&&void 0!==i&&i.call(e,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(n=this.options)||void 0===n||null===(s=n.afterRemoveLastListener)||void 0===s||s.call(n,this));const o=this.listeners.indexOf(t);if(o<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(o,1)}off(t){if(this.isDisposed||!this.listeners)return;const e=this.listeners.findIndex((e=>e.callback===t));e>-1&&this.listeners.splice(e,1)}emit(t){this.listeners&&this.listeners.length&&this.listeners.slice().forEach((e=>{try{e.context?e.callback.call(e.context,t):e.callback(t)}catch(e){}}))}}function Qu(t,e,i){return{on:(n,s)=>{const o=new Ku({beforeAddFirstListener:()=>{t.addEventListener(e,n,s)},afterRemoveLastListener:()=>{t.removeEventListener(e,n)}});i.register(o.on((()=>{}))),i.register(o)}}}function tp(t){const e=t.register(new Ku);return{on:(i,n)=>e.on(i,t,n),emit:t=>{e.emit(t)}}}var ep,ip;!function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader"}(ip||(ip={}));class np{static get isApple(){return aa(this,np,fp)}static get version(){return Pc.CryptoModule.ver}static enableDebugOutput(t,e){if(t){const t=t=>{var i,n,s;let o=Wd(t);o.srcBuffer&&(o.srcBuffer=ha(this,np,sp).call(this,o.srcBuffer)),null!==(i=o.result)&&void 0!==i&&i.srcBuffer&&(o.result.srcBuffer=ha(this,np,sp).call(this,o.result.srcBuffer)),null!==(n=o.result)&&void 0!==n&&n.imageData&&(o.result.imageData=ha(this,np,sp).call(this,o.result.imageData)),null!==(s=o.result)&&void 0!==s&&s.pdfData&&(o.result.pdfData=ha(this,np,sp).call(this,o.result.pdfData)),o.imageData&&(o.imageData=ha(this,np,sp).call(this,o.imageData)),e&&(Zd(o)&&(o=`[${Date.now()}]${o}`),e(o))};Pc.setLogFunc("logDebug",t)}else Pc.setLogFunc("",void 0)}static hasDebugOutput(){return Pc.hasLogFunc()}static get blobReadModeSettings(){const{FontUseFileReadMode:t}=Pc;return{minBlobSize:Pc.FileReadModeSize,fontForLoad:t.load,fontForSave:t.save}}static set blobReadModeSettings(t){"number"==typeof t.minBlobSize&&(Pc.FileReadModeSize=t.minBlobSize),Pc.FontUseFileReadMode={load:t.fontForLoad,save:t.fontForSave}}static getMemoryUsed(){return kc.Instance.getMemoryUsed()}static get heapConfig(){return Pc.HeapConfig}static updateHeapConfig(t,e,i){Pc.UpdateHeapConfig(t,e,i),aa(this,np,vp)[t]||(aa(this,np,vp)[t]={}),e&&(aa(this,np,vp)[t].maxHeapSize=e),i&&(aa(this,np,vp)[t].initHeapSize=i)}static async getLicenseInfo(t,e,i){this.Init(t,e,i),e&&await kc.Instance.loadModule(Pc.CryptoModule),await kc.Instance.loadModule(Pc.ImageIOModule),await Wc.updateLicense(aa(this,np,ap),aa(this,np,lp),aa(this,np,hp));const n=new Oc(aa(this,np,ap));try{return await n.getLicenseInfo()}finally{n.terminate()}}static Init(t,e,i){var n;la(this,np,ap,null!=t?t:aa(this,np,ap)),void 0!==e&&la(this,np,lp,e?1:0),la(this,np,hp,null!=i?i:aa(this,np,hp));const s={bMac:"Mac"===yd.OS,biPhone:"iPhone"===yd.OS,biPad:"iPad"===yd.OS};la(this,np,fp,s.bMac||s.biPhone||s.biPad),Pc.NavInfo=s,Pc.License=aa(this,np,ap),Pc.UUID=aa(this,np,hp),Pc.LicMode=aa(this,np,lp),ha(this,np,rp).call(this),Pc.UpdateHeapConfig(ip.detector,null!==(n=ha(this,np,op).call(this,ip.detector))&&void 0!==n?n:100)}static async isResourceDirValid(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;ha(this,np,rp).call(this);let i=0;for(;i<t;){try{const t=Pc.PdfReaderModule;if(aa(this,np,mp)===t.script)return!0;const e={...t.fetchOptions};if(e.method="HEAD",(await fetch(t.script,e)).ok)return la(this,np,mp,t.script),!0}catch(t){}await new Promise((t=>setTimeout(t,e))),i+=1}return!1}static async loadPdfReader(t,e,i){return this.Init(t,e,i),aa(this,np,pp)||(await kc.Instance.loadModule(Pc.ImageProcModule),la(this,np,pp,kc.Instance.loadModule(Pc.PdfReaderModule)),await aa(this,np,pp)),aa(this,np,pp)}static async loadMain(t,e,i){return this.Init(t,e,i),aa(this,np,gp)||(la(this,np,gp,kc.Instance.loadModule(Pc.ImagecoreModule)),await aa(this,np,gp),kc.Instance.loadModule(Pc.ImageProcModule)),aa(this,np,gp)}static async load(t,e,i){kc.Instance.terminate(!0),this.Init(t,e,i),await this.loadMain(t,e,i)}static async preloadModule(t){let e;const i={...Pc.PdfReaderModule},n={...Pc.ImageProcModule};switch(t){case"core":if(aa(this,np,gp)){e=aa(this,np,gp);break}la(this,np,gp,kc.Instance.loadModule(Pc.ImagecoreModule)),e=aa(this,np,gp),await aa(this,np,gp);break;case"pdf":case"proc":if(aa(this,np,pp)){e=aa(this,np,pp);break}n.workerName=ip.loader,la(this,np,pp,kc.Instance.loadModule(n)),e=aa(this,np,pp),await aa(this,np,pp),i.workerName=ip.loader,la(this,np,pp,kc.Instance.loadModule(i)),e=aa(this,np,pp),await aa(this,np,pp),kc.Instance.terminateWorker(i.workerName)}return e}static unloadMainWorker(){la(this,np,gp,void 0),kc.Instance.terminateWorker(Pc.ImageIOModule.workerName)}static unloadPdfReaderWorker(){la(this,np,pp,void 0),kc.Instance.terminateWorker(Pc.PdfReaderModule.workerName)}static unloadDocumentDetectorWorker(){kc.Instance.terminateWorker(Pc.DetectorModule.workerName)}static async unloadWorker(){la(this,np,gp,void 0),la(this,np,pp,void 0),await kc.Instance.terminate(!0)}static async unload(){kc.unload(),Wc.unload(),Pc.unload(),la(this,np,gp,void 0),la(this,np,pp,void 0);try{await kc.Instance.terminate(!0)}catch(t){}}static getUseSimd(){if(this.enableSimd){var t;const e=navigator;if(null!==(t=e.userAgentData)&&void 0!==t&&t.brands)for(const{brand:t,version:i}of e.userAgentData.brands)if(t&&("Chromium"===t||"Google Chrome"===t)&&i&&parseInt(i,10)>=94)return!0}return!1}static getPdfFonts(){return cd.getPdfFonts()}static async getPdfInfo(t,e){let i;try{i=new cd;const n=await i.getPdfInfo({fileSource:t,password:e});return i.destroy(),n}catch(t){return null}finally{i&&i.destroy()}}}function sp(t){return t instanceof ArrayBuffer?{type:"ArrayBuffer",length:t.byteLength}:t instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:t.byteLength}:{type:Object.prototype.toString.call(t)}}function op(t){return void 0!==aa(this,ep,vp)[t]?aa(this,ep,vp)[t].maxHeapSize:null}function rp(){this.enableSimd?Pc.UseSimd=this.getUseSimd():Pc.UseSimd=!1,Pc.UseBrotli=this.enableWasmCompression;const t={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:Pc.UseSimd,fetchOptions:this.fetchOptions,useBrotli:Pc.UseBrotli};t.workerScript=Pc.ImageIOWorkerJS,Pc.ImageIOResource=t;const e={...t};e.workerScript=Pc.ImageIOWorkerJS,Pc.PdfReaderResource=e}ep=np,na(np,"resourceDir","");var ap={writable:!0,value:""},lp={writable:!0,value:Ta.LONG_KEY},hp={writable:!0,value:""};na(np,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),na(np,"enableSimd",!0),na(np,"enableWasmCompression",!1);var cp,dp,up,pp={writable:!0,value:void 0},gp={writable:!0,value:void 0},fp={writable:!0,value:!1},mp={writable:!0,value:void 0},vp={value:Object.create(null)};class yp{constructor(){na(this,"processor",void 0),this.processor=new hd}async initImage(t){return this.processor.initImage(t.source,t.isRGBA,t.width,t.height,t.isBGRA)}async getImage(t){return await this.processor.getImage(t.jpegQuality,t.ifDeleteObject,t.isRGBA,t.bitDepth,t.xDpi,t.yDpi,t.returnBlob,t.returnType,np.isApple)}async getImageInfo(){return await this.processor.getImageInfo()}async freeReservedData(){this.processor.freeReservedData()}async toBinaryLevel(t,e){return this.processor.toBinaryLevel(t,e)}async toGrayscale(t){return this.processor.toGrayscale(t)}async removeShadowLevel(t,e){return this.processor.removeShadowLevel(t,e)}async brighten(){return this.processor.brighten()}async invert(){return this.processor.invert()}async changeBrightnessAndContrast(t,e){return this.processor.changeBrightnessAndContrast(t,e)}async perspective(t){return this.processor.perspective(t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1])}async getSkewAngle(t){return this.processor.getSkewAngle(t)}async rotate(t){return this.processor.rotate(t.angle,t.fillColor,t.keepSize,t.mode)}async flip(){return this.processor.flip()}async resize(t,e,i){return this.processor.resize(t,e,i)}async resizeWidth(t,e){return this.processor.setImageWidth(t,e)}async resizeHeight(t,e){return this.processor.setImageHeight(t,e)}async crop(t){return this.processor.crop(t.left,t.top,t.left+t.width,t.top+t.height)}async erase(t,e){return this.processor.erase(t.left,t.top,t.left+t.width,t.top+t.height,e)}async setDpi(t){return this.processor.setDPI(t.rawResolutionX,t.rawResolutionY,t.resolutionX,t.resolutionY,t.resample,t.mode)}async drawQuadrangle(t){return this.processor.drawQuadrangle(t.location[0][0],t.location[0][1],t.location[1][0],t.location[1][1],t.location[2][0],t.location[2][1],t.location[3][0],t.location[3][1],t)}async filter(t,e,i){return this.processor.filter(t,e,i)}async setImageWidth(t,e){return this.processor.setImageWidth(t,e)}async setImageHeight(t,e){return this.processor.setImageHeight(t,e)}terminate(t){return this.processor.terminate(t)}}class xp{constructor(){na(this,"reader",void 0),this.reader=new Hc}async readImage(t){return await this.reader.readImage(t.source,t.outputType,t.jpegQuality,t.returnBase64,np.isApple)}async readImageInfo(t){return await this.reader.readImageInfo(t)}cancelReadImage(t,e){this.reader.cancelReadImage(t,e)}async readTiffPage(t){return await this.reader.readTiffPage(t.source,t.index,t.outputType,t.returnBase64,np.isApple)}async readTiffPageInfo(t,e){const{imageInfos:i}=await this.reader.getTiffPageInfos(t,e);return i}async getTiffPageCount(t){return(await this.reader.getTiffInfo(t)).pageCount}cancelReadTiffPage(t,e){this.reader.cancelReadTiffPage(t,e)}destroy(){var t;null===(t=this.reader)||void 0===t||t.destroy(),this.reader=void 0}}!function(t){t[t.RGBA=1]="RGBA",t[t.BGRA=2]="BGRA",t[t.JPEG=3]="JPEG",t[t.PNG=4]="PNG"}(cp||(cp={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL"}(dp||(dp={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64"}(up||(up={}));class wp{constructor(){na(this,"writer",void 0),this.writer=new Oc}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=void 0}createTiff(){return this.writer.createTiff()}addTiffTag(t,e,i){return this.writer.addTag(t,e,i)}async appendImage(t,e){var i;return e=null!==(i=e)&&void 0!==i?i:{},await this.writer.appendImage(t,e.inputType,e.tiffFormat,e.jpegQuality,e.is1Bit)}async getTiff(){return(await this.writer.getTiff(up.RT_BINARY)).imageData}async saveImage(t,e){var i;return e=null!==(i=e)&&void 0!==i?i:{},(await this.writer.saveImage(t,e.outputType,e.jpegQuality,e.returnType,e.is1Bit)).imageData}}class bp{constructor(){na(this,"reader",void 0),this.reader=new cd}initFonts(t){var e;const i=null==t||null===(e=t.renderOptions)||void 0===e?void 0:e.fonts;if(i)for(const t of i)t.name&&t.data&&bp.addPdfFont(t.name,t.data)}static addPdfFont(t,e){cd.addPdfFont(t,e)}async readPageImageInfos(t){await this.initFonts(t.readOptions);const{imageInfos:e}=await this.reader.readPageImageInfos(t.source,t.indices,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,np.isApple);return e}async readPage(t){return await this.initFonts(t.readOptions),await this.reader.readPageEx(t.source,t.index,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,np.isApple)}cancelReadPage(t,e){this.reader.cancelReadPage(t,e)}async getPdfPageCount(t,e){return await this.initFonts(e),(await this.reader.getPdfInfo(t)).PdfCount}async getPdfPageContentType(t,e){const i=await this.reader.getPdfPageType(t,e);return 1===i.pageContentType?"application/pdf/text":2===i.pageContentType?"application/pdf/image":"application/pdf"}async readAnnotations(t,e){const{annot:{annots:i}}=await this.reader.readPageAnnot(t,e);return i}async findText(t,e,i,n){return await this.reader.findText(t,e,i,n)}async getCharInfos(t,e){return(await this.reader.getCharInfos(t,e)).pageCharInfos}destroy(){this.reader.destroy(),this.reader=null}}class Cp{constructor(){na(this,"writer",void 0),this.writer=new dd}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=null}async initPdfSetting(t){return this.writer.initPdfSetting(t)}async insertBlankPage(t,e,i){return this.writer.insertBlankPage(t,e,i)}async appendPage(t,e){return this.writer.appendPage(t,e)}async addImageToPages(t,e,i,n,s,o){return this.writer.pageAddImage(t,e,i,n,s,o)}async mergeRawPdfPages(t,e,i){return this.writer.mergePdf(t,e,i)}async setPageRotation(t,e){return this.writer.pageSetRotation(t,e)}async clearPageObjects(t){return this.writer.pageClearObjects(t)}async setPageCropBox(t,e,i,n,s){return this.writer.pageSetCropBox(t,e,i,n,s)}async setPageMediaBox(t,e,i,n,s){return this.writer.pageSetMediaBox(t,e,i,n,s)}async setPageAnnotations(t,e){return this.writer.pageSetAnnot(t,e)}async addAnnotationsToPage(t,e){return this.writer.pageAddAnnot(t,e)}async flattenPageAnnotations(t,e){return this.writer.pageFlattenAnnot(t,e)}async deletePageAnnotationsByTypes(t,e){return this.writer.pageDeleteAnnotByTypes(t,e)}async deletePageAnnotations(t){return this.writer.pageDeleteAnnot(t)}async flattenPage(t,e){return this.writer.pageFlatten(t,e)}async getPdf(t){return(await this.writer.writePdf(t)).pdfData}async getFontInfo(t){return await this.writer.GetFontInfo(t)}async ifFontsExist(t){return(await this.writer.IfFontsExist(t)).fontsExist}async unloadPage(t){var e,i;await(null===(e=(i=this.writer).UnloadPage)||void 0===e?void 0:e.call(i,t))}}class Sp{constructor(t){na(this,"items",[]),t&&(this.items=t)}push(t){this.items.push(t)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(t){"filter"===t.api&&this.items.forEach(((e,i)=>{e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&e.params[2]===t.params[2]&&this.items.splice(i,1).forEach((t=>{null==t||t.resolve(null)}))}))}}const _p={[cp.BGRA]:dp.IT_BGRA,[cp.RGBA]:dp.IT_RGBA,[cp.PNG]:dp.IT_PNG,[cp.JPEG]:dp.IT_JPG},Tp={[dp.IT_BGRA]:cp.BGRA,[dp.IT_RGBA]:cp.RGBA,[dp.IT_PNG]:cp.PNG,[dp.IT_JPG]:cp.JPEG},Ep={displayResolution:96,dataResolution:72,pdfResolution:72,autoReleaseImg:Xd()};class Pp{constructor(){na(this,"db",void 0),this.db=new Map}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}getSaverConstructor(t){return this.db.get(t)}setSaverConstructor(t,e){this.db.set(t,e)}deleteSaverConstructor(t){this.db.delete(t)}clear(){this.db.clear()}}const Ap=new Pp,Ip=new Pp,Dp=new class{constructor(t,e){na(this,"saverConstructorRepo",void 0),na(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=t,this.customSaverConstructorRepo=e}execute(t){let e=this.customSaverConstructorRepo.getSaverConstructor(t);return e||(e=this.saverConstructorRepo.getSaverConstructor(t)),new e}}(Ap,Ip),kp=new class{constructor(t){na(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t}execute(t){let{mime:e,saverConstructor:i}=t;this.saverConstructorRepo.setSaverConstructor(e,i)}}(Ap),Rp=new class{constructor(t){na(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t}execute(t){this.saverConstructorRepo.deleteSaverConstructor(t)}}(Ap);var Mp,Lp,Op,Bp;!function(t){t.TIFF_AUTO="tiff/auto",t.TIFF_FAX3="tiff/fax3",t.TIFF_FAX4="tiff/fax4",t.TIFF_LZW="tiff/lzw",t.TIFF_JPEG="tiff/jpeg"}(Mp||(Mp={})),function(t){t.PDF_AUTO="pdf/auto",t.PDF_FAX4="pdf/fax4",t.PDF_LZW="pdf/lzw",t.PDF_JPEG="pdf/jpeg",t.PDF_JP2000="pdf/jp2000",t.PDF_JBIG2="pdf/jbig2"}(Lp||(Lp={})),function(t){t.PAGE_DEFAULT="page/default",t.PAGE_A4="page/a4",t.PAGE_A4_REVERSE="page/a4reverse",t.PAGE_A3="page/a3",t.PAGE_A3_REVERSE="page/a3reverse",t.PAGE_LETTER="page/letter",t.PAGE_LETTER_REVERSE="page/letterreverse",t.PAGE_LEGAL="page/legal",t.PAGE_LEGAL_REVERSE="page/legalreverse"}(Op||(Op={})),function(t){t.PRINT="print",t.MODIFY_CONTENTS="modify_contents",t.COPY_CONTENTS="copy_contents",t.EXTRACT_CONTENTS="extract_contents",t.MODIFY_ANNOTATIONS="modify_annotations",t.FILL_IN="fill_in",t.ASSEMBLY="assembly",t.DEGRADED_PRINT="degraded_print"}(Bp||(Bp={})),new Map([[Bp.PRINT,2052],[Bp.MODIFY_CONTENTS,8],[Bp.COPY_CONTENTS,16],[Bp.MODIFY_ANNOTATIONS,32],[Bp.FILL_IN,256],[Bp.EXTRACT_CONTENTS,512],[Bp.ASSEMBLY,1024],[Bp.DEGRADED_PRINT,4]]);const Fp=new Map([[Op.PAGE_DEFAULT,0],[Op.PAGE_A4,2],[Op.PAGE_A4_REVERSE,3],[Op.PAGE_A3,4],[Op.PAGE_A3_REVERSE,5],[Op.PAGE_LETTER,6],[Op.PAGE_LETTER_REVERSE,7],[Op.PAGE_LEGAL,8],[Op.PAGE_LEGAL_REVERSE,9]]),Np=new Map([[Lp.PDF_AUTO,0],[Lp.PDF_FAX4,2],[Lp.PDF_LZW,3],[Lp.PDF_JPEG,5],[Lp.PDF_JP2000,6],[Lp.PDF_JBIG2,7]]),Up=new Map([[Mp.TIFF_AUTO,0],[Mp.TIFF_FAX3,1],[Mp.TIFF_FAX4,2],[Mp.TIFF_LZW,3],[Mp.TIFF_JPEG,5]]);var Vp=new WeakMap,Wp=new WeakMap,Hp=new WeakMap;class jp{constructor(){ma(this,Vp,{writable:!0,value:void 0}),ma(this,Wp,{writable:!0,value:void 0}),ma(this,Hp,{writable:!0,value:void 0}),oa(this,Vp,new Cp),oa(this,Wp,new Map)}destroy(){var t;null===(t=sa(this,Vp))||void 0===t||t.terminate(),oa(this,Vp,void 0)}convertPageSize(t,e){let i=0,n=0,s=0,o=0,r=0,a=0,l=0,h=0;const{pdfResolution:c,displayResolution:d}=Ep;switch(t){case Op.PAGE_A4:s=210/25.4*c,o=297/25.4*c,l=s,a=o;break;case Op.PAGE_A4_REVERSE:s=297/25.4*c,o=210/25.4*c,l=s,a=o;break;case Op.PAGE_A3:s=297/25.4*c,o=420/25.4*c,l=s,a=o;break;case Op.PAGE_A3_REVERSE:s=420/25.4*c,o=297/25.4*c,l=s,a=o;break;case Op.PAGE_LETTER:s=8.5*c,o=11*c,l=s,a=o;break;case Op.PAGE_LETTER_REVERSE:s=11*c,o=8.5*c,l=s,a=o;break;case Op.PAGE_LEGAL:s=8.5*c,o=14*c,l=s,a=o;break;case Op.PAGE_LEGAL_REVERSE:s=14*c,o=8.5*c,l=s,a=o;break;default:i=e.mediaBox.left/d*c,n=e.mediaBox.top/d*c,s=e.mediaBox.width/d*c,o=e.mediaBox.height/d*c,r=e.cropBox.left/d*c,a=2*n+o-e.cropBox.top/d*c,l=Math.max(r+e.cropBox.width/d*c,r+1),h=Math.min(a-e.cropBox.height/d*c,a-1)}return{left:i,top:n,width:s,height:o,cropLeft:r,cropTop:a,cropRight:l,cropBottom:h}}convertPdfSettings(t){const e={};return e.author=null==t?void 0:t.author,e.compression=null!=t&&t.compression?Np.get(t.compression):void 0,e.creationDate=null==t?void 0:t.creationDate,e.creator=null==t?void 0:t.creator,e.keyWords=null==t?void 0:t.keyWords,e.modifiedDate=null==t?void 0:t.modifiedDate,e.pageType=null!=t&&t.pageType?Fp.get(t.pageType):void 0,e.producer=null==t?void 0:t.producer,e.quality=null==t?void 0:t.quality,e.subject=null==t?void 0:t.subject,e.title=null==t?void 0:t.title,e.version=null==t?void 0:t.version,null!=t&&t.password&&(e.encryptOptions={},e.encryptOptions.enabled=!0,e.encryptOptions.userPassword=t.password),e}async init(t){oa(this,Hp,t||{});const e=this.convertPdfSettings(t);await sa(this,Vp).initPdfSetting(e)}async appendImagePage(t,e){const{mediaBox:i}=e,n=this.convertPageSize(sa(this,Hp).pageType,e);let s=await sa(this,Vp).insertBlankPage(-1,n.left+n.width,n.top+n.height);const{pageIndex:o}=s;await sa(this,Vp).setPageMediaBox(o,n.left,n.top,n.left+n.width,n.top+n.height),e.rotation&&await sa(this,Vp).setPageRotation(o,e.rotation);const{displayResolution:r,pdfResolution:a}=Ep;let l=n.width,h=n.height,c=0,d=0;if(sa(this,Hp).pageType&&sa(this,Hp).pageType!==Op.PAGE_DEFAULT){const t={width:i.width/r*a,height:i.height/r*a},e=n.width/t.width,s=n.height/t.height;if(e<s){const i=t.height*e;d=(n.height-i)/2,l=n.width,h=i}else{const e=t.width*s;c=(n.width-e)/2,l=e,h=n.height}sa(this,Wp).set(o,[l/t.width,0,0,h/t.height,c,d])}c+=n.left,d+=n.top;let u=e.width,p=e.height,g=t;if(sa(this,Hp).imageScaleFactor){let i=Math.floor(e.width*sa(this,Hp).imageScaleFactor+.5),n=Math.floor(e.height*sa(this,Hp).imageScaleFactor+.5);if(i<1&&(i=1),n<1&&(n=1),i!==u&&n!==p){const e=new yp;await e.initImage({source:t}),await e.resize(i,n),g=(await e.getImage({})).imageData,u=i,p=n,await e.freeReservedData()}}return s=await sa(this,Vp).addImageToPages(g,[o],{type:"image",imageWidth:l,imageHeight:h,position:[c,d]},u,p,1===e.bitDepth),await sa(this,Vp).setPageCropBox(o,n.cropLeft,n.cropBottom,n.cropRight,n.cropTop),await sa(this,Vp).unloadPage(o),s}async appendRawPdfPages(t,e,i){await sa(this,Vp).mergeRawPdfPages(t,e,i)}async changePageImage(t,e,i){const n=this.convertPageSize(Op.PAGE_DEFAULT,i);return await sa(this,Vp).clearPageObjects(t),await sa(this,Vp).addImageToPages(e,[t],{type:"image",imageWidth:n.width,imageHeight:n.height,position:[n.left,n.top]},i.width,i.height)}async setPageInfo(t){for(const[e,i]of t){const t=this.convertPageSize(Op.PAGE_DEFAULT,i),{rotation:n}=i;await sa(this,Vp).setPageCropBox(e,t.cropLeft,t.cropBottom,t.cropRight,t.cropTop),await sa(this,Vp).setPageRotation(e,(n%360+360)%360)}}async setPageRotation(t){for(const[e,i]of t){const t=(i%360+360)%360;await sa(this,Vp).setPageRotation(e,t)}}async getPdf(t){return sa(this,Vp).getPdf(t)}updateAnnotPoint(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}fixAnnotationPosition(t,e){sa(this,Wp).has(t)&&e.forEach((e=>{const i=this.updateAnnotPoint([e.rect[0],e.rect[1]],sa(this,Wp).get(t)),n=this.updateAnnotPoint([e.rect[2],e.rect[3]],sa(this,Wp).get(t));if(e.rect=[i[0],i[1],n[0],n[1]],"Highlight"===e.type||"StrikeOut"===e.type||"Underline"===e.type||"Squiggly"===e.type)e.quadPoints.forEach((e=>{const i=this.updateAnnotPoint([e[0],e[1]],sa(this,Wp).get(t)),n=this.updateAnnotPoint([e[2],e[3]],sa(this,Wp).get(t)),s=this.updateAnnotPoint([e[4],e[5]],sa(this,Wp).get(t)),o=this.updateAnnotPoint([e[6],e[7]],sa(this,Wp).get(t));e=[i[0],i[1],n[0],n[1],s[0],s[1],o[0],o[1]]}));else if("Line"===e.type){const i=this.updateAnnotPoint([e.line[0],e.line[1]],sa(this,Wp).get(t)),n=this.updateAnnotPoint([e.line[2],e.line[3]],sa(this,Wp).get(t));e.line=[i[0],i[1],n[0],n[1]]}else if("Ink"===e.type)e.inkList.forEach((e=>{for(let i=0;i<e.length;i+=2){const[n,s]=this.updateAnnotPoint([e[i],e[i+1]],sa(this,Wp).get(t));e[i]=n,e[i+1]=s}}));else if("Polygon"===e.type||"PolyLine"===e.type)for(let i=0;i<e.vertices.length;i+=2){const[n,s]=this.updateAnnotPoint([e.vertices[i],e.vertices[i+1]],sa(this,Wp).get(t));e.vertices[i]=n,e.vertices[i+1]=s}}))}async removePageAnnotations(t){await sa(this,Vp).deletePageAnnotationsByTypes(t,"")}async setPageAnnotations(t,e,i){let n;return e&&e.length>0&&this.fixAnnotationPosition(t,e),i?e&&e.length>0&&(n=await sa(this,Vp).addAnnotationsToPage(t,e)):n=await sa(this,Vp).setPageAnnotations(t,e),n}async flattenPageAnnotations(t,e){return e&&e.length>0&&this.fixAnnotationPosition(t,e),await sa(this,Vp).flattenPageAnnotations(t,e)}async flattenPage(t){return await sa(this,Vp).flattenPage(t)}async getFontInfo(t){return await sa(this,Vp).getFontInfo(t)}async ifFontsExist(t){return await sa(this,Vp).ifFontsExist(t)}}class zp{constructor(){na(this,"imageWriter",void 0),this.imageWriter=new wp}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0}async save(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.imageWriter.saveImage(t,{outputType:e.outputType,jpegQuality:e.jpegQuality,returnType:e.returnType,is1Bit:e.is1Bit})}}class Gp{constructor(){na(this,"imageWriter",void 0),na(this,"tiffCompression",void 0),na(this,"tiffQuality",void 0),this.imageWriter=new wp,this.tiffCompression=Up.get(Mp.TIFF_AUTO)}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0}async init(t){if(await this.imageWriter.createTiff(),t&&(this.tiffQuality=t.quality,t.compression&&(this.tiffCompression=Up.get(t.compression)),t.customTag))for(let e=0;e<t.customTag.length;e++)await this.imageWriter.addTiffTag(t.customTag[e].id,t.customTag[e].content,t.customTag[e].contentIsBase64)}async appendPage(t,e){await this.imageWriter.appendImage(t,{inputType:void 0,tiffFormat:this.tiffCompression,jpegQuality:this.tiffQuality,is1Bit:null==e?void 0:e.is1Bit})}async getTiff(){return this.imageWriter.getTiff()}}class Yp{constructor(t){na(this,"uid",void 0),this.uid=t||Qd()}equals(t){return null!=t&&void 0!==t&&(this===t||!!function(t){return t instanceof Yp}(t)&&this.uid===t.uid)}}class $p extends Yp{}let Xp=class{constructor(t){na(this,"type",void 0),na(this,"uid",void 0),this.type=t,this.uid=Qd()}};class qp{constructor(t){na(this,"bubbles",!0),na(this,"cancelBubble",!0),na(this,"cancelable",!1),na(this,"composed",!1),na(this,"currentTarget",void 0),na(this,"defaultPrevented",!1),na(this,"eventPhase",qp.prototype.NONE),na(this,"isTrusted",void 0),na(this,"returnValue",void 0),na(this,"srcElement",void 0),na(this,"target",void 0),na(this,"timeStamp",void 0),na(this,"type",void 0),na(this,"detail",void 0),na(this,"view",void 0),na(this,"which",void 0),na(this,"path",void 0),na(this,"immediatePropagationStopped",!1),na(this,"propagationStopped",!1),na(this,"nativeEvent",void 0),na(this,"originalEvent",void 0),na(this,"eventService",void 0),na(this,"NONE",0),na(this,"CAPTURING_PHASE",1),na(this,"AT_TARGET",2),na(this,"BUBBLING_PHASE",3),this.eventService=t}initUIEvent(t,e,i,n,s){}composedPath(){const{path:t,eventService:e,target:i}=this;return!e||t&&t[this.path.length-1]===i||(this.path=i?e.getPropagationPath(i):[]),this.path}bindEvents(t,e,i){}preventDefault(){const{nativeEvent:t}=this;t instanceof Event&&t.cancelable&&t.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.immediatePropagationStopped=!0}stopPropagation(){this.propagationStopped=!0}}function Zp(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which}class Jp extends qp{constructor(t,e){super(null),this.type=t,this.detail=e}}class Kp{constructor(){na(this,"pubsub",iu.create())}addEventListener(t,e,i){let n,s=Yd(i)&&i;Vd(i)&&(s=i.capture,n=i.once),t=s?`${t}:capture`:t,e=$d(e)?e:e.handleEvent,this.pubsub.on(t,e,this,n)}dispatchEvent(t){const e=this.ownerDocument||this.document;var i;return e&&(t.eventService=(null===(i=e.defaultView)||void 0===i?void 0:i.eventService)||null,t.defaultPrevented=!1,t.path=[],t.target=this,tg(t)),!t.defaultPrevented}removeEventListener(t,e,i){let n=Yd(i)&&i;Vd(i)&&(n=i.capture),t=n?`${t}:capture`:t,e=$d(e)?e:e.handleEvent,this.pubsub.off(t,e)}removeAllEventListeners(){this.pubsub.removeAllEventListeners()}getAllEvents(){return this.pubsub.getAllEvents()}}function Qp(t,e){const i=t.currentTarget.getAllEvents()[e]||[];for(let e=0,n=i.length;e<n;e++){if(t.immediatePropagationStopped)return;const{context:n,fn:s}=i[e];s.call(n,t)}}function tg(t,e){var i;if(e=null!==(i=e)&&void 0!==i?i:t.type,t.propagationStopped=!1,t.immediatePropagationStopped=!1,!t.target)return;const n=t.composedPath(),s=n.length;t.eventPhase=t.CAPTURING_PHASE;for(let i=0;i<s-1;i++)if(t.currentTarget=n[i],Qp(t,`${e}:capture`),eg(t))return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,Qp(t,e),!eg(t)){t.eventPhase=t.BUBBLING_PHASE;for(let i=s-2;i>=0;i--)if(t.currentTarget=n[i],Qp(t,e),eg(t))return}}function eg(t){return t.propagationStopped||t.immediatePropagationStopped}const ig=t=>t/180*Math.PI,ng=t=>t/Math.PI*180;class sg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;na(this,"x",0),na(this,"y",0),this.x=t,this.y=e}static fromValue(t,e){return new sg(t,e)}static fromPoint(t){return new sg(t.x,t.y)}static fromTwoPoint(t,e){var i,n,s,o;return new sg((null!==(i=e.x)&&void 0!==i?i:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(s=e.y)&&void 0!==s?s:0)-(null!==(o=t.y)&&void 0!==o?o:0))}static create(){return new sg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)}setFromVector(t){this.x=t.x,this.y=t.y}clone(){return new sg(this.x,this.y)}norm(){return Math.hypot(this.x,this.y)}dot(t){return this.x*t.x+this.y*t.y}projectionTo(t){const e=Math.hypot(t.x,t.y);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y);return Math.acos(this.dot(t)/e)}equals(t){return this.x===t.x&&this.y===t.y}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i,y:n}=this;return new sg(i+(t.x-i)*e,n+(t.y-n)*e)}normalize(){const t=this.norm();return this.x/=t,this.y/=t,this}negate(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x*t.y-this.y*t.x}add(t){return new sg(this.x+t.x,this.y+t.y)}addSelf(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return new sg(this.x-t.x,this.y-t.y)}subSelf(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return new sg(this.x*t.x,this.y*t.y)}multiplySelf(t){return this.x*=t.x,this.y*=t.y,this}}class og{constructor(t){na(this,"a",1),na(this,"b",0),na(this,"c",0),na(this,"d",1),na(this,"e",0),na(this,"f",0),na(this,"m11",1),na(this,"m12",0),na(this,"m13",0),na(this,"m21",0),na(this,"m22",1),na(this,"m23",0),na(this,"m31",0),na(this,"m32",0),na(this,"m33",1),t&&this.setFromMatrix(t)}static compose(t,e,i){const n=ig(i),s=Math.cos(n),o=Math.sin(n),r=e.x*s,a=e.x*o,l=-e.y*o,h=e.y*s,c=t.x,d=t.y;return og.fromMatrix({m11:r,m21:l,m31:c,m12:a,m22:h,m32:d,m13:0,m23:0,m33:1})}static create(t){return new og(t)}static fromMatrix(t){return(new og).setFromMatrix(t)}static createRotationMatrix(t,e){const i=hg(t,e);return og.fromMatrix(i)}static createTranslationMatrix(t){const e=ag(t.x,t.y);return og.fromMatrix(e)}static createScaleMatrix(t){const e=lg(t.x,t.y);return og.fromMatrix(e)}setFromMatrix(t){if(Array.isArray(t)){const[e,i,n,s,o,r]=t;this.m11=e,this.m12=i,this.m13=0,this.m21=n,this.m22=s,this.m23=0,this.m31=o,this.m32=r,this.m33=1}else{var e,i,n,s,o,r,a,l,h,c,d,u,p,g,f;this.m11=null!==(e=null!==(i=t.m11)&&void 0!==i?i:t.a)&&void 0!==e?e:1,this.m12=null!==(n=null!==(s=t.m12)&&void 0!==s?s:t.b)&&void 0!==n?n:0,this.m13=null!==(o=t.m13)&&void 0!==o?o:0,this.m21=null!==(r=null!==(a=t.m21)&&void 0!==a?a:t.c)&&void 0!==r?r:0,this.m22=null!==(l=null!==(h=t.m22)&&void 0!==h?h:t.d)&&void 0!==l?l:1,this.m23=null!==(c=t.m23)&&void 0!==c?c:0,this.m31=null!==(d=null!==(u=t.m31)&&void 0!==u?u:t.e)&&void 0!==d?d:0,this.m32=null!==(p=null!==(g=t.m32)&&void 0!==g?g:t.f)&&void 0!==p?p:0,this.m33=null!==(f=t.m33)&&void 0!==f?f:1}return this.a=this.m11,this.b=this.m12,this.c=this.m21,this.d=this.m22,this.e=this.m31,this.f=this.m32,this}clone(){return og.fromMatrix(this)}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().translateSelf(t,e)}translateSelf(){const t=ag(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);return this.multiplySelf(t)}multiplySelf(){const t=rg(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(t)}preMultiplySelf(){const t=rg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(t)}multiply(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone().multiplySelf(t)}scaleSelf(t,e,i,n){var s,o;void 0===e&&(e=t),null!==(s=i)&&void 0!==s||(i=0),null!==(o=n)&&void 0!==o||(n=0),0===i&&0===n||this.translateSelf(i,n);const r=lg(t,e);return this.multiplySelf(r)}scale(t,e,i,n){return this.clone().scaleSelf(t,e,i,n)}rotateSelf(t,e,i){var n,s;null!==(n=e)&&void 0!==n||(e=0),null!==(s=i)&&void 0!==s||(i=0);const o=hg(t,{x:e,y:i});return this.multiplySelf(o)}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().rotateSelf(t)}invertSelf(){const t=function(t){const{m11:e,m21:i,m31:n,m12:s,m22:o,m32:r}=t,a=1/(e*o-s*i);return{m11:o*a,m21:-i*a,m31:(i*r-o*n)*a,m12:-s*a,m22:e*a,m32:(s*n-e*r)*a,m13:0,m23:0,m33:1}}(this);return this.setFromMatrix(t)}inverse(){return this.clone().invertSelf()}getScaling(){const t=Math.hypot(this.m11,this.m12),e=Math.hypot(this.m21,this.m22);return new sg(t,e)}getScaleMatrix(){const t=this.getScaling(),e=lg(t.x,t.y);return og.fromMatrix(e)}getTranslation(){return new sg(this.m31,this.m32)}getRotationMatrix(){const t=this.getScaling(),e={m11:this.m11/t.x,m12:this.m12/t.x,m13:0,m21:this.m21/t.y,m22:this.m22/t.y,m23:0,m31:0,m32:0,m33:1};return og.fromMatrix(e)}getRotation(){const t=Math.atan2(this.m12,this.m11);return ng(t)}decompose(){let{m11:t,m12:e,m21:i,m22:n}=this;const s={x:this.m31,y:this.m32},o={x:Math.hypot(t,e),y:Math.hypot(i,n)};t*n-e*i<0&&(t<n?o.x=-o.x:o.y=-o.y),o.x&&(t/=o.x,e/=o.x),o.y&&(i/=o.y,n/=o.y);const r=Math.atan2(e,t);return{translation:s,scale:o,rotation:ng(r)}}transformPoint(t){const{m11:e,m12:i,m21:n,m22:s,m31:o,m32:r}=this;return{x:t.x*e+t.y*n+o,y:t.x*i+t.y*s+r}}}function rg(t,e){const i={},{m11:n,m21:s,m31:o,m12:r,m22:a,m32:l,m13:h,m23:c,m33:d}=t,{m11:u,m21:p,m31:g,m12:f,m22:m,m32:v,m13:y,m23:x,m33:w}=e;return i.m11=n*u+s*f+o*y,i.m21=n*p+s*m+o*x,i.m31=n*g+s*v+o*w,i.m12=r*u+a*f+l*y,i.m22=r*p+a*m+l*x,i.m32=r*g+a*v+l*w,i.m13=h*u+c*f+d*y,i.m23=h*p+c*m+d*x,i.m33=h*g+c*v+d*w,i}function ag(){return{m11:1,m21:0,m31:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m12:0,m22:1,m32:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m13:0,m23:0,m33:1}}function lg(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m13:0,m23:0,m33:1}}function hg(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};const e=ig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),i=Math.cos(e),n=Math.sin(e),{x:s,y:o}=t;return{m11:i,m21:-n,m31:s-s*i+o*n,m12:n,m22:i,m32:o-s*n-o*i,m13:0,m23:0,m33:1}}const cg=new class{recursiveUpdateHierarchy(t){const{transform:e,childNodes:i}=t;e.frozen||(e.frozen=!0,(e.localDirty||e.worldDirty)&&this.updateHierarchy(t),i.forEach((t=>{this.recursiveUpdateHierarchy(t)})))}querySelector(t,e){return t.startsWith("#")?e.find((e=>e.id===t.substring(1))):null}querySelectorAll(t,e){return[]}append(t,e,i){t.parentNode&&this.remove(t),t.parentNode=e;const{childNodes:n,sortable:s}=e;void 0!==i?n.splice(i,0,t):n.push(t),s&&(s.dirty=!0);const{transform:o}=t;o&&this.dirtyWorld(t,o),o.frozen&&this.unfreezeParentToRoot(t)}remove(t){const{parentNode:e}=t;let i=!0;if(!e)return i=!1,i;const{sortable:n}=e;n&&(n.dirty=!0);const{childNodes:s}=e,o=s.indexOf(t);o>-1?(i=!0,s.splice(o,1)):i=!1;const{transform:r}=t;return r&&this.dirtyWorld(t,r),t.parentNode=null,i}isChildExist(t){const{parentNode:e}=t;if(!e)return!1;const{childNodes:i}=e;return!(i.indexOf(t)<0)}setOrigin(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;qd(e)&&(e=sg.fromValue(e,i));const{transform:n}=t;n.origin.equals(e)||(n.origin.setFromVector(e),this.dirtyLocal(t,n))}getOrigin(t){return t.transform.origin.clone()}setPosition(t,e){const{transform:i}=t,n=this.getPosition(t);if(n.equals(e))return;let s=this.getWorldTransform(t);if(i.position.setFromVector(e),t.hasParentTransform()){s=og.create().translateSelf(e.x-n.x,e.y-n.y).multiply(s);const{worldTransform:o}=t.parentNode.transform,r=this.getWorldTransform(t);r.m31=e.x,r.m32=e.y;const a=o.inverse().multiply(s),l=this.getOrigin(t),h=a.getScaleMatrix().inverse(),c=a.translate(l.x,l.y).multiply(h),d=c.getRotationMatrix().inverse(),u=c.multiply(d).getTranslation();u.subSelf(l),i.localPosition.setFromVector(u)}else i.localPosition.setFromVector(e);this.dirtyLocal(t,i)}setLocalPosition(t,e){const{transform:i}=t;i.localPosition.equals(e)||(i.localPosition.setFromVector(e),this.dirtyLocal(t,i))}getPosition(t){const e=this.getWorldTransform(t),{transform:i}=t,n=e.getTranslation();return i.position.setFromVector(n),t.transform.position.clone()}getLocalPosition(t){return t.transform.localPosition.clone()}translate(t,e){if(0===e.x&&0===e.y)return;const i=this.getPosition(t);i.addSelf(e),this.setPosition(t,i)}translateLocal(t,e){const{transform:i}=t;if(0===e.x&&0===e.y)return;const n=sg.fromPoint(e).multiplySelf(i.localScale),s=og.createRotationMatrix(i.localRotation).transformPoint(n);i.localPosition.addSelf(s),this.dirtyLocal(t,i)}scaleLocal(t,e){const{transform:i}=t;i.localScale.multiplySelf(e),this.dirtyLocal(t,i)}setLocalScale(t,e){const{transform:i}=t;i.localScale.equals(e)||(i.localScale.setFromVector(e),this.dirtyLocal(t,i))}getScale(t){const{transform:e}=t,i=this.getWorldTransform(t).getScaling();return e.scale.setFromVector(i),e.scale.clone()}getLocalScale(t){return t.transform.localScale.clone()}getRotation(t){const{transform:e}=t,i=this.getWorldTransform(t).getRotation();return e.rotation=i,i}getLocalRotation(t){return t.transform.localRotation}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e)return;const{transform:i}=t;if(t.hasParentTransform()){const n=this.getRotation(t),s=-this.getRotation(t.parentNode)+e+n;i.localRotation=s,this.dirtyLocal(t,i)}else this.rotateLocal(t,e)}rotateLocal(t,e){const{transform:i}=t;i.localRotation+=e,this.dirtyLocal(t,i)}setAngle(t,e){const{transform:i}=t;if(t.hasParentTransform()){const n=this.getRotation(t.parentNode);i.localRotation=-n+e,this.dirtyLocal(t,i)}else this.setLocalAngle(t,e)}setLocalAngle(t,e){const{transform:i}=t;i.localRotation=e,this.dirtyLocal(t,i)}getAngle(t){return this.getWorldTransform(t).getRotation()}getLocalAngle(t){return this.getLocalRotation(t)}setLocalTransform(t,e){const i=this.getOrigin(t),{rotation:n,scale:s}=e.decompose(),o=og.createScaleMatrix(s).inverse(),r=e.translate(i.x,i.y).multiply(o).getTranslation();r.subSelf(i),this.setLocalPosition(t,r),this.setLocalAngle(t,n),this.setLocalScale(t,s)}resetLocalTransform(t){this.setLocalScale(t,new sg(1,1)),this.setLocalPosition(t,new sg(0,0)),this.setLocalAngle(t,0)}getWorldTransform(t){const{transform:e}=t;if(!e.worldDirty&&!e.localDirty)return e.worldTransform;const{parentNode:i}=t;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(t),e.worldTransform.clone()}getLocalTransform(t){const{transform:e}=t;return e.localDirty&&e.updateLocalTransform(),e.localTransform.clone()}getBounds(t,e){const{renderable:i,childNodes:n}=t;if(e&&!i.renderBoundsDirty&&i)return i.renderBounds;if(!e&&!i.boundsDirty&&i.bounds)return i.bounds;let s=this.getTransformedGeometryBounds(t,e);n.forEach((t=>{const i=this.getBounds(t,e);i&&(s?s.addBounds(i):s=Qf.fromBounds(i))}));const{clipPath:o}=t.style;if(o){const e=this.getTransformedGeometryBounds(o,!0);let i=null;e&&(i=Qf.create(),i.setFromTransformedBounds(this.getWorldTransform(t),e)),s?i&&(s=i.intersection(s)):s=i}return e?(i.renderBoundsDirty=!1,s&&(i.renderBounds=s)):(i.boundsDirty=!1,s&&(i.bounds=s)),s||Qf.create()}getLocalBounds(t){const{parentNode:e}=t;if(e){let i=og.create();e.transform&&(i=this.getWorldTransform(e).inverse());const n=this.getBounds(t);if(!Qf.isEmpty(n)){const t=Qf.create();return t.setFromTransformedBounds(i,n),t}}return this.getBounds(t)}getGeometryBounds(t,e){const{geometry:i}=t;return(e?i.renderBounds:i.contentBounds)||Qf.create()}getBoundingClientRect(t){var e;let i;const n=this.getGeometryBounds(t);Qf.isEmpty(n)||(i=Qf.create(),i.setFromTransformedBounds(this.getWorldTransform(t),n));const s=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==s?void 0:s.left)||0),y:i.minY+((null==s?void 0:s.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==s?void 0:s.left)||0,y:(null==s?void 0:s.top)||0,width:0,height:0}}updateHierarchy(t){const{transform:e}=t;if(e.localDirty&&e.updateLocalTransform(),e.worldDirty){var i;let n=null==t||null===(i=t.parentNode)||void 0===i?void 0:i.transform;t.parentNode&&n||(n=new gg),e.updateWorldTransform(n)}}getTransformedGeometryBounds(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.getGeometryBounds(t,e);if(!Qf.isEmpty(i)){const e=Qf.create();return e.setFromTransformedBounds(this.getWorldTransform(t),i),e}return null}dirtyLocal(t,e){e.localDirty||(e.localDirty=!0,e.worldDirty||this.dirtyWorld(t,e))}dirtyWorld(t,e){e.worldDirty||this.unfreezeParentToRoot(t),this.recursiveDirtyWorld(t,e),function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t;for(;i;){const{renderable:t}=i;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0),i=i.parentNode}const n=new Jp("bounds-changed",{affectChildren:e});t.dispatchEvent(n)}(t,!0)}recursiveDirtyWorld(t,e){if(e.worldDirty)return;e.worldDirty=!0,e.frozen=!1,t.childNodes.forEach((t=>{const{transform:e}=t;e.worldDirty||this.recursiveDirtyWorld(t,e)}));const{renderable:i}=t;i&&(i.boundsDirty=!0,i.renderBoundsDirty=!0);const n=new pm("DOMAttrModified",t,null,null,"modelMatrix",pm.MODIFICATION,null,null);t.dispatchEvent(n)}unfreezeParentToRoot(t){let e=t;for(;e;){const{transform:t}=e;t&&(t.frozen=!1),e=e.parentNode}}};class dg{constructor(){na(this,"contentBounds",void 0),na(this,"renderBounds",void 0)}}class ug{constructor(){na(this,"boundsDirty",!0),na(this,"bounds",void 0),na(this,"renderBoundsDirty",!0),na(this,"renderBounds",void 0)}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0}}class pg{constructor(){na(this,"renderOrder",0),na(this,"lastSortedIndex",void 0),na(this,"sorted",void 0),na(this,"dirty",!1)}}let gg=class{constructor(){na(this,"frozen",!0),na(this,"worldDirty",!1),na(this,"localDirty",!1),na(this,"localRotation",0),na(this,"rotation",0),na(this,"localScale",sg.create(1,1)),na(this,"scale",sg.create(1,1)),na(this,"localPosition",sg.create(0,0)),na(this,"position",sg.create(0,0)),na(this,"localSkew",sg.create(0,0)),na(this,"skew",sg.create(0,0)),na(this,"origin",sg.create(0,0)),na(this,"worldTransform",og.create()),na(this,"localTransform",og.create())}updateLocalTransform(){const{origin:t,localScale:e,localPosition:i,localRotation:n}=this,s=og.create();s.translateSelf(t.x,t.y);const o=og.compose(i,e,n);s.multiplySelf(o),s.translateSelf(-t.x,-t.y),this.localTransform.setFromMatrix(s),this.localDirty=!1}updateWorldTransform(t){const e=t.worldTransform.clone();e.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(e),this.worldDirty=!1}};function fg(t,e){if(Number.isNaN(e))return{unit:"px",value:0};if(Vu(e))return{unit:"px",value:0};if(qd(e))return{unit:"px",value:e};if(e=e.trim().toLowerCase(),Number.isFinite(Number(e))&&"px".search(t)>=0)return{unit:"px",value:Number(e)};const i=[];e=e.replace(t,(t=>(i.push(t),`U${t}`)));const n=`U(${t.source})`;return i.map((t=>({unit:t,value:Number(e.replace(new RegExp(`U${t}`,"g"),"").replace(new RegExp(n,"g"),"*0"))})))[0]}const mg=t=>fg(/px|pt/g,t),vg=t=>fg(/px|%|em/g,t),yg=t=>fg(/deg|rad|grad|turn/g,t);class xg{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];na(this,"r",void 0),na(this,"g",void 0),na(this,"b",void 0),na(this,"alpha",void 0),na(this,"isNone",void 0),na(this,"formatted",""),this.r=t,this.g=e,this.b=i,this.alpha=n,this.isNone=s,this.formatted=`rgba(${t}, ${e}, ${i}, ${n})`}clone(){return new xg(this.r,this.g,this.b,this.alpha)}}class wg{constructor(t,e){na(this,"type",void 0),na(this,"value",void 0),this.type=t,this.value=e}clone(){return new wg(this.type,this.value)}}const bg={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},Cg=t=>{let e;return e="angular"===t.type?Number(t.value):bg[t.value]||0,{value:e,unit:"deg"}};function Sg(t){const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(e[3]||"1"),n=Math.floor(i*parseInt(e[0],10)+255*(1-i)),s=Math.floor(i*parseInt(e[1],10)+255*(1-i)),o=Math.floor(i*parseInt(e[2],10)+255*(1-i));return`#${`0${n.toString(16)}`.slice(-2)}${`0${s.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`}function _g(t){return/^hsla?\(.+\)$/i.test(t)}function Tg(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Vu(t))return null;if("currentColor"===t&&(t="black"),"transparent"===t)return new xg(0,0,0,0);const e=(t=>{if(t.includes("linear")||t.includes("radial"))return wu(t).map((t=>{let{type:e,orientation:i,colorStops:n}=t;!function(t){var e;const{length:i}=t;var n;t[i-1].length=null!==(e=t[i-1].length)&&void 0!==e?e:{type:"%",value:"100"},i>1&&(t[0].length=null!==(n=t[0].length)&&void 0!==n?n:{type:"%",value:"0"});let s=0,o=Number(t[0].length.value);for(let e=1;e<i;e++){var r;const i=null===(r=t[e].length)||void 0===r?void 0:r.value;if(!Vu(i)&&!Vu(o)){for(let n=1;n<e-s;n++)t[s+n].length={type:"%",value:`${o+(Number(i)-o)*n/(e-s)}`};s=e,o=Number(i)}}}(n);const s=n.map((t=>({offset:{value:t.length.value,unit:"%"},color:xu(t)})));if("linear-gradient"===e)return new wg(1,{angle:i?Cg(i):{value:0,unit:"deg"},steps:s});if("radial-gradient"===e){i||(i=[{type:"shape",value:"circle"}]);const t=i[0];if("shape"===(null==t?void 0:t.type)&&"circle"===(null==t?void 0:t.value)){const{cx:i,cy:n}=(t=>{let e=50,i=50,n="%",s="%";if("position"===(null==t?void 0:t.type)){const{x:o,y:r}=t.value;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?e=0:"center"===o.value?e=50:"right"===o.value?e=100:"top"===o.value?i=0:"bottom"===o.value&&(i=100)),"position-keyword"===(null==r?void 0:r.type)&&("left"===r.value?e=0:"center"===r.value?i=50:"right"===r.value?e=100:"top"===r.value?i=0:"bottom"===r.value&&(i=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(n=null==o?void 0:o.type,e=Number(o.value)),"px"!==(null==r?void 0:r.type)&&"%"!==(null==r?void 0:r.type)&&"em"!==(null==r?void 0:r.type)||(s=null==r?void 0:r.type,i=Number(r.value))}return{cx:{value:e,unit:n},cy:{value:i,unit:s}}})(null==t?void 0:t.at);let o;if(null!=t&&t.style){const{type:i,value:n}=t.style;o="extent-keyword"===i?n:{value:n,unit:e}}return new wg(2,{cx:i,cy:n,size:o,steps:s})}}}))})(t);if(e)return e;if(_g){const e=document.createElement("div");e.style.color=t,t=e.style.color}const i=(t=>{let e,i;if(t=`${t}`.trim().toLowerCase(),Sd.exec(t))switch(e=Sd.exec(t),i=e[1].length,e=parseInt(e[1],16),i){case 6:return Rd(e);case 3:return new kd(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1);case 8:return Md(e>>24&255,e>>16&255,e>>8&255,(255&e)/255);case 4:return Md(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255);default:return null}return _d.exec(t)?(e=_d.exec(t),new kd(e[1],e[2],e[3],1)):Td.exec(t)?(e=Td.exec(t),new kd(255*e[1]/100,255*e[2]/100,255*e[3]/100,1)):Ed.exec(t)?(e=Ed.exec(t),Md(e[1],e[2],e[3],e[4])):Pd.exec(t)?(e=Pd.exec(t),Md(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4])):Ad.exec(t)?(e=Ad.exec(t),Bd(Ld(e[1],e[2]/100,e[3]/100,1))):Id.exec(t)?(e=Id.exec(t),Bd(Ld(e[1],e[2]/100,e[3]/100,e[4]))):Dd.hasOwnProperty(t)?Rd(Dd[t]):"transparent"===t?new kd(NaN,NaN,NaN,0):null})(t),n=[0,0,0,0];return null!==i&&(n[0]=parseInt(i.r,10)||0,n[1]=parseInt(i.g,10)||0,n[2]=parseInt(i.b,10)||0,n[3]=parseFloat(i.opacity)),new xg(...n)}function Eg(t){let e=null;Ud(t)&&(e=t),Zd(t)&&(e=t.split(" "));for(let t=0;t<3;t++)e[t]?e[t]=mg(e[t]).value:e[t]=0;const i=Tg(e[3]);return e[3]=i?i.formatted:"black",e.slice(0,4)}function Pg(t){const e=[];return Zd(t)?t.split(" ").forEach((t=>{const i=mg(t);i&&e.push(i.value)})):e.push(...t),1===e.length?[e[0],e[0]]:e}const Ag=t=>{let e=t;if(Zd(t)){const i=vg(t);"%"===i.unit&&(e=i.value/100),"px"===i.unit&&(e=i.value)}return e>1&&(e=1),e},Ig={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},Dg={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function kg(t){const e=[];return t.forEach((t=>{e.push({...Dg,...t,fontSize:mg(t.fontSize||Dg.fontSize)})})),e}function Rg(t,e,i,n){const{x:s=0,y:o=0}=i.parsedStyle,{x:r,y:a}=i.getLocalPosition();i.boundsDirty=!0,"x"===n&&s===r||"y"===n&&o===a||i.setLocalPosition(s,o)}function Mg(t,e,i){if(!(i instanceof Bf||i instanceof Ff||i instanceof kf))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin()}function Lg(t,e,i){!(i instanceof Nf)||i instanceof jf||i instanceof Df||t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath(),i.updateOrigin())}function Og(t,e,i){(i instanceof Pf||i instanceof Af||i instanceof If)&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath())}function Bg(t,e,i){if(!(i instanceof Vf||i instanceof Ff))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin()}function Fg(t,e,i){t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath())}function Ng(t,e,i){i instanceof Uf&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath())}function Ug(t,e,i,n){i instanceof zf&&t!==e&&(i.setLimitWidth(i.parsedStyle.width.value),i.pathDirty=!0,i.boundsDirty=!0,("freeTextWriter"!==i.textType||"freeTextWriter"===i.textType&&["width","textContents"].includes(n))&&i.calculateTextLines(),i.getPath(),null!=i&&i.isEditMode||i.updateOrigin())}class Vg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;na(this,"x",void 0),na(this,"y",void 0),this.x=t,this.y=e}static fromPoint(t){return new Vg(t.x,t.y)}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this}clone(){return new Vg(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return new Vg(this.x+e*(t.x-this.x),this.y+e*(t.y-this.y))}footPointInSegment(t,e){const i=sg.fromTwoPoint(t,this),n=sg.fromTwoPoint(t,e),s=n.norm(),o=Vg.fromPoint(t);if(0===s)return o;const r=i.projectionTo(n)/s;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}}function Wg(t,e,i){const n=t.x-e.x,s=t.y-e.y;let o=(i.x-t.x)*n+(i.y-t.y)*s;return o/=n*n+s*s,new Vg(t.x+o*n,t.y+o*s)}function Hg(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((s^o)>=0&&0!==s&&0!==o||(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),o=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),(s^o)>=0&&0!==s&&0!==o))}function jg(t,e,i,n,s){const o=s||[],r=t[e],a=t[i];let l=0,h=1;for(let n=e+1;n<i;n++){const e=(c=Wg(r,a,t[n]),d=t[n],((c.x-d.x)**2+(c.y-d.y)**2)**.5);e>l&&(l=e,h=n)}var c,d;return l>=n?(jg(t,e,h,n,o),jg(t,h,i,n,o)):(!o.length&&r&&o.push(r),o.push(a)),o}function zg(t,e,i,n,s,o){const r=function(t,e,i,n,s,o){const r=function(t,e,i){const n=Math.cos(t),s=Math.sin(t);return function(t,o){return{x:n*(t-e)+s*(o-i),y:-s*(t-e)+n*(o-i)}}}((p=s-t,g=o-e,Math.atan2(g,p)),(t+s)/2,(e+o)/2),a=r(t,e),l=r(i,n),h=r(s,o),c=Math.abs(a.x),[d,u]=[l.y/2,0].sort(((t,e)=>t-e));var p,g;let f,m;return l.x>=a.x&&l.x<=h.y?[f,m]=[a.x,h.x]:l.x>0?[f,m]=[a.x,.5*(l.x+c*c/l.x)]:[f,m]=[.5*(l.x+c*c/l.x),h.x],function(t,e,i){const n=r(t,e);return!(n.x<f-i||n.x>m+i||n.y<d-i||n.y>u+i)}}(t,e,i,n,s,o),{getDistance:a}=function(t,e,i,n,s,o){const r=[i-t,n-e],a=[t-2*i+s,e-2*n+o],l=[2*r[0],2*r[1]],h=1/Yg(a,a),c=h*Yg(r,a),d=c*c,u=Yg(r,r),p=3**.5,g=0===Yg(a,a)?function(t){return 0===u?0:Gg(-Yg(r,t)/2/u,0,1)}:function(t){const e=h*(2*u+Yg(t,a))/3,i=h*Yg(t,r),n=e-d,s=c*(2*d-3*e)+i;let o=s*s+n*n*n*4;if(o>=0){o=Math.sqrt(o);const t=(o-s)/2,e=(-o-s)/2;return Gg(Math.sign(t)*Math.abs(t)**(1/3)+Math.sign(e)*Math.abs(e)**(1/3)-c,0,1)}const l=Math.sqrt(-n),g=Math.acos(s/(n*l*2))/3,f=Math.cos(g),m=Math.sin(g)*p;return[Gg((f+f)*l-c,0,1),Gg((-m-f)*l-c,0,1)]};return{getDistance(i,n){const s=[t-i,e-n],o=g(s);if("number"==typeof o)return Math.sqrt($g((l[0]+a[0]*o)*o+s[0],(l[1]+a[1]*o)*o+s[1]));const[r,h]=o;return Math.sqrt(Math.min($g(s[0]+(l[0]+a[0]*r)*r,s[1]+(l[1]+a[1]*r)*r),$g(s[0]+(l[0]+a[0]*h)*h,s[1]+(l[1]+a[1]*h)*h)))}}}(t,e,i,n,s,o);return{isHit:function(t,e){return function(t,e,i){return!!r(t,e,i)&&a(t,e)<=i}(t[0],t[1],e)}}}function Gg(t,e,i){return Math.min(Math.max(t,e),i)}function Yg(t,e){return t[0]*e[0]+t[1]*e[1]}function $g(t,e){return t*t+e*e}function Xg(t,e,i,n,s){const{PI:o,cos:r,sin:a,min:l,max:h,tan:c}=Math;s-n>2*o&&(s=n+2*o);let d=h(o/12,(s-n)/12);const u=[];for(u.push({x:t+i*r(n),y:e+i*a(n)});n<s;){const o=t+i*r(n),h=e+i*a(n),p=l(s,n+d);d=l(s-n,d);const g=t+i*r(p),f=e+i*a(p),m=i*c(d/3),v={x:o-(h-e)/i*m,y:h+(o-t)/i*m},y={x:g+(f-e)/i*m,y:f-(g-t)/i*m},x={x:g,y:f};u.push(v,y,x),n+=d}return u}function qg(t,e,i,n){const s=t-i,o=t+i,r=e-n,a=e+n,l=.551915024494,h=l*i,c=l*n,d=[];return d.push({x:o,y:e}),d.push({x:o,y:e+c},{x:t+h,y:a},{x:t,y:a}),d.push({x:t-h,y:a},{x:s,y:e+c},{x:s,y:e}),d.push({x:s,y:e-c},{x:t-h,y:r},{x:t,y:r}),d.push({x:t+h,y:r},{x:o,y:e-c},{x:o,y:e}),d}function Zg(t,e){return{type:t,data:e,close:arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}function Jg(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.length;if(i<=1)return[];const n=[],[s]=t;n.push(Zg("moveTo",[s]));for(let e=0;e+3<i;e+=3){const i=t[e+1],s=t[e+2],o=t[e+3];n.push(Zg("bezierCurveTo",[i,s,o]))}return e&&t.length>2&&n.push(Zg("lineTo",[s])),n}function Kg(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function Qg(t,e){const i=t.length;if(i<=1)return[];if(2===i)return[{index:0,ops:[Zg("moveTo",[t[0]])]},{index:1,ops:[Zg("lineTo",[t[1]])]}];let n=i-e;i<=e&&(n=0);const s=[];let o=[],r={index:n,ops:[]};if(s.push(r),i<=e){const e=Zg("moveTo",[t[0]]);r.ops.push(e),o=[...t]}else o=t.slice(-e);const a=function(t){const e=[];for(let i=1;i<t.length-1;i++){const n=180*Of(Mf(t[i-1],t[i]),Mf(t[i],t[i+1]))/Math.PI;n>=45&&n<=135&&e.push(i)}return e}(o),l=[];for(let e=0;e<o.length;e++)if(a.includes(e)){const i=t[e-1],s=t[e+1],r=Kg(t[e],i),a=Kg(t[e],s);let h,c;r>6&&(h=rf(i,t[e],.2),l.push({val:h})),l.push({index:e+n,val:o[e]}),a>6&&(c=rf(s,t[e],.2),l.push({val:c}))}else l.push({index:e+n,val:o[e]});for(let t=0;t<l.length;t++){var h,c,d,u,p,g;const e=l[t],i=l[t].val,o=null!==(h=null===(c=l[t-1])||void 0===c?void 0:c.val)&&void 0!==h?h:i,a=null!==(d=null===(u=l[t+1])||void 0===u?void 0:u.val)&&void 0!==d?d:i,f=tf(o,i,a,null!==(p=null===(g=l[t+2])||void 0===g?void 0:g.val)&&void 0!==p?p:a);void 0!==e.index&&(e.index!==n&&(r={index:void 0,ops:[]},s.push(r)),r.index=e.index),r.ops.push(f)}return s}function tf(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const o=Kg(e,i);let r={x:e.x+(i.x-t.x)/s,y:e.y+(i.y-t.y)/s},a={x:i.x-(n.x-e.x)/s,y:i.y-(n.y-e.y)/s};const l=Kg(r,e),h=Kg(a,i);return l>o&&(r=rf(r,e,o)),h>o&&(a=rf(a,i,o)),Zg("bezierCurveTo",[r,a,i])}function ef(t,e,i){const n=(t.x+e.x)/2,s=(t.y+e.y)/2,o=(e.x+i.x)/2,r=(e.y+i.y)/2;return Zg("bezierCurveTo",[{x:n+2*(e.x-n)/3,y:s+2*(e.y-s)/3},{x:o+2*(e.x-o)/3,y:r+2*(e.y-r)/3},e])}function nf(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];let[n]=t;i.push(Zg("moveTo",[n]));for(let e=1;e<t.length;e++)n=t[e],i.push(Zg("lineTo",[n]));return e&&t.length>2&&([n]=t,i.push(Zg("lineTo",[n]))),i}function sf(t,e){const{data:i,type:n}=e,[s,o,r]=i;switch(n){case"moveTo":t.moveTo(s.x,s.y);break;case"lineTo":t.lineTo(s.x,s.y);break;case"bezierCurveTo":t.bezierCurveTo(s.x,s.y,o.x,o.y,r.x,r.y);break;case"quadraticCurveTo":t.quadraticCurveTo(s.x,s.y,o.x,o.y)}}function of(t){let{x:e,y:i}=t[0],n=e,s=i;for(let o=1;o<t.length;o++){const{x:r,y:a}=t[o];e=Math.min(e,r),n=Math.max(n,r),i=Math.min(i,a),s=Math.max(s,a)}return{left:e,top:i,right:n,bottom:s,width:n-e,height:s-i}}function rf(t,e,i){const n=e.x-t.x,s=e.y-t.y,o=Math.abs(n)/Math.abs(s);let r=Math.sqrt(i*i/(o*o+1)),a=r*o;return 0===n&&(a=0,r=Math.sqrt(i)),0===s&&(r=0,a=Math.sqrt(i)),{x:e.x-(n>=0?a:-a),y:e.y-(s>=0?r:-r)}}function af(t){if(t.length<1)return[];const e=[];let i=[];for(let n=0;n<t.length;n++){const s=t[n];if(0===s.step)n>0&&e.push({step:i,close:t[n-1].close}),i=[],i.push(Zg("moveTo",[{x:s.x,y:s.y}]));else if(1===s.step)i.push(Zg("lineTo",[{x:s.x,y:s.y}]));else if(2===s.step&&n+2<t.length&&2===t[n+1].step&&2===t[n+2].step){const e=t[n+1],o=t[n+2];i.push(Zg("bezierCurveTo",[s,e,o])),n+=2}}return e.push({step:i,close:t[t.length-1].close}),e}function lf(t){return 180*t/Math.PI}function hf(t){return t<0?t%360+360:t%360}function cf(t,e,i,n){return t/(i*i)+e/(n*n)}function df(t,e,i,n){let s=0,o=0,r=0,a=0;const l=[t,e],h=of(l),c=function(t,e,i,n){let s=n/2,o=n/2;const r=e.y-t.y,a=e.x-t.x;if(0===r||0===a)return[a,r];const l=-1/((e.y-t.y)/(e.x-t.x)),h=Math.atan(l);return"square"===i?(s=Math.sqrt(2)*n/2,o=Math.sqrt(2)*n/2):"round"===i?(s=n/2,o=n/2):(s=Math.abs(Math.cos(h)*n)/2,o=Math.abs(Math.sin(h)*n)/2),[s,o]}(l[0],l[1],n,i||0);return 0===c[1]?(s=h.left,o=h.top-i/2,r=h.width,a=h.height+i,"square"!==n&&"round"!==n||(s-=i/2,r+=i)):0===c[0]?(s=h.left-i/2,o=h.top,r=h.width+i,a=h.height,"square"!==n&&"round"!==n||(o-=i/2,a+=i)):(s=h.left-c[0],o=h.top-c[1],r=h.width+2*c[0],a=h.height+2*c[1]),{x:s,y:o,width:r,height:a}}function uf(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function pf(t,e,i,n){const{x:s,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=n,c=Math.min(s,r),d=Math.max(s,r),u=Math.min(o,a),p=Math.max(o,a),g=i/2;return l>=c-g&&l<=d+g&&h>=u-g&&h<=p+g&&function(t,e,i,n,s,o){const r=[i-t,n-e];if(new sg(r[0],r[1]).equals({x:0,y:0}))return Math.sqrt((s-t)*(s-t)+(o-e)*(o-e));const a=[-r[1],r[0]],l=new sg(a[0],a[1]);l.normalize();const h=[s-t,o-e],c=new sg(h[0],h[1]);return Math.abs(c.dot(l))}(s,o,r,a,l,h)<=i/2}function gf(t,e,i,n,s){const o=t.length;if(o<2)return!1;for(let s=0;s<o-1;s++)if(pf(t[s],t[s+1],e,{x:i,y:n}))return!0;return!(!s||!pf(t[0],t[o-1],e,{x:i,y:n}))}function ff(t,e,i,n,s,o){return s>=t&&s<=t+i&&o>=e&&o<=e+n}function mf(t,e,i,n,s,o){const r=o;let a=n.x,l=n.y,h=s.x,c=s.y;0===e&&(a=s.x,l=s.y,h=n.x,c=n.y);let d=Math.PI/2;const u=h-a>=0?1:-1,p=c-l>=0?1:-1;a!==h&&(d=Math.atan(Math.abs(c-l)/Math.abs(h-a)));const g=Math.cos(d),f=Math.sin(d),m=i?1:-1,v={x:h+7.8*m*r*g*u-4.5*r*f*u,y:c+7.8*m*r*f*p+4.5*r*g*p,step:0,close:!1},y={x:h,y:c,step:1,close:!1};i&&(y.x=h+r*m*g*u,y.y=c+r*m*f*p);const x={x:h+7.8*m*r*g*u+4.5*r*f*u,y:c+7.8*m*r*f*p-4.5*r*g*p,step:1,close:!1};t.push(v,y,x)}function vf(t,e,i,n,s,o){const r=o;let a=n.x,l=n.y,h=s.x,c=s.y;0===e&&(a=s.x,l=s.y,h=n.x,c=n.y);let d=Math.PI/2;const u=h-a>=0?1:-1,p=c-l>=0?1:-1;a!==h&&(d=Math.atan(Math.abs(c-l)/Math.abs(h-a)));const g=Math.cos(d),f=Math.sin(d),m=i?1:-1,v={x:h+7.8*m*r*g*u-4.5*r*f*u,y:c+7.8*m*r*f*p+4.5*r*g*p,step:0,close:!1},y={x:h,y:c,step:1,close:!1};i&&(y.x=h+r*m*g*u,y.y=c+r*m*f*p);const x={x:h+7.8*m*r*g*u+4.5*r*f*u,y:c+7.8*m*r*f*p-4.5*r*g*p,step:1,close:!0};t.push(v,y,x)}function yf(t,e,i,n,s){const o=s;let r=i.x,a=i.y,l=n.x,h=n.y;0===e&&(r=n.x,a=n.y,l=i.x,h=i.y);let c=Math.PI/2;const d=l-r>=0?1:-1,u=h-a>=0?1:-1;r!==l&&(c=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const p=Math.cos(c),g=Math.sin(c),f={x:l-3*o*g*d,y:h+3*o*p*u,step:0,close:!1},m={x:l+3*o*g*d,y:h-3*o*p*u,step:1,close:!1};t.push(f,m)}function xf(t,e,i,n,s){const o=s;let r=i.x,a=i.y,l=n.x,h=n.y;0===e&&(r=n.x,a=n.y,l=i.x,h=i.y);let c=Math.PI/2;const d=l-r>=0?1:-1,u=h-a>=0?1:-1,p=h>=a&&l>=r||h<=a&&l<=r?-1:1;r!==l&&(c=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const g=Math.cos(c),f=Math.sin(c),m=4.5*Math.sqrt(3)*o,v={x:l+4.5*o*g*d-m*f*d*p,y:h+4.5*o*f*u+m*g*u*p,step:0,close:!1},y={x:l-4.5*o*g*d+m*f*d*p,y:h-4.5*o*f*u-m*g*u*p,step:1,close:!1};t.push(v,y)}function wf(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a-3*o,step:0,close:!1},h={x:r+3*o,y:a-3*o,step:1,close:!1},c={x:r+3*o,y:a+3*o,step:1,close:!1},d={x:r-3*o,y:a+3*o,step:1,close:!0};t.push(l,h,c,d)}function bf(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a,step:0,close:!1},h={x:r,y:a-3*o,step:1,close:!1},c={x:r+3*o,y:a,step:1,close:!1},d={x:r,y:a+3*o,step:1,close:!0};t.push(l,h,c,d)}function Cf(t,e,i,n,s){const o=s;let{x:r,y:a}=n;0===e&&(r=i.x,a=i.y);const l=3*o-0*o,h=qg(r,a,l,l);h.forEach(((e,i)=>{const n=0===i?0:2,s=i===h.length-1,o={x:e.x,y:e.y,step:n,close:s};t.push(o)}))}class Sf{constructor(t){na(this,"lineAlign",void 0),na(this,"owner",void 0),this.owner=t,this.reset()}reset(){this.lineAlign=.5}get x(){return this.owner.getAttribute("x")}set x(t){this.owner.setAttribute("x",t)}get y(){return this.owner.getAttribute("y")}set y(t){this.owner.setAttribute("y",t)}get r(){return this.owner.getAttribute("r")}set r(t){this.owner.setAttribute("r",t)}get width(){return this.owner.getAttribute("width")}set width(t){this.owner.setAttribute("width",t)}get height(){return this.owner.getAttribute("height")}set height(t){this.owner.setAttribute("height",t)}get points(){return this.owner.getAttribute("points")}set points(t){this.owner.setAttribute("points",t)}get origin(){return this.owner.getAttribute("origin")}set origin(t){this.owner.setAttribute("origin",t)}get anchor(){return this.owner.getAttribute("anchor")}set anchor(t){this.owner.setAttribute("anchor",t)}get visibility(){return this.owner.getAttribute("visibility")}set visibility(t){this.owner.setAttribute("visibility",t)}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(t){this.owner.setAttribute("zIndex",t)}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(t){this.owner.setAttribute("borderWidth",t)}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(t){this.owner.setAttribute("borderColor",t)}get opacity(){return this.owner.getAttribute("opacity")}set opacity(t){this.owner.setAttribute("opacity",t)}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(t){this.owner.setAttribute("fillOpacity",t)}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(t){this.owner.setAttribute("borderOpacity",t)}get background(){return this.owner.getAttribute("background")}set background(t){this.owner.setAttribute("background",t)}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(t){this.owner.setAttribute("clipPath",t)}get cursor(){return this.owner.getAttribute("cursor")}set cursor(t){this.owner.setAttribute("cursor",t)}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(t){this.owner.setAttribute("hitArea",t)}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(t){this.owner.setAttribute("pointerEvents",t)}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(t){this.owner.setAttribute("miterLimit",t)}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(t){this.owner.setAttribute("roundedRadius",t)}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(t){this.owner.setAttribute("lineCap",t)}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(t){this.owner.setAttribute("lineJoin",t)}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(t){this.owner.setAttribute("lineDash",t)}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(t){this.owner.setAttribute("lineDashOffset",t)}get shadow(){return this.owner.getAttribute("shadow")}set shadow(t){this.owner.setAttribute("shadow",t)}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(t){this.owner.setAttribute("shadowOffsetX",t)}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(t){this.owner.setAttribute("shadowOffsetY",t)}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(t){this.owner.setAttribute("shadowBlur",t)}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(t){this.owner.setAttribute("shadowColor",t)}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(t){this.owner.setAttribute("startAngle",t)}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(t){this.owner.setAttribute("endAngle",t)}get rx(){return this.owner.getAttribute("rx")}set rx(t){this.owner.setAttribute("rx",t)}get ry(){return this.owner.getAttribute("ry")}set ry(t){this.owner.setAttribute("ry",t)}get img(){return this.owner.getAttribute("img")}set img(t){this.owner.setAttribute("img",t)}get src(){return this.owner.getAttribute("src")}set src(t){this.owner.setAttribute("src",t)}get text(){return this.owner.getAttribute("text")}set text(t){this.owner.setAttribute("text",t)}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(t){this.owner.setAttribute("wordWarp",t)}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(t){this.owner.setAttribute("wordBreak",t)}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(t){this.owner.setAttribute("textMaxWidth",t)}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(t){this.owner.setAttribute("letterSpacing",t)}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(t){this.owner.setAttribute("textBaseLine",t)}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(t){this.owner.setAttribute("textTransform",t)}get color(){return this.owner.getAttribute("color")}set color(t){this.owner.setAttribute("color",t)}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(t){this.owner.setAttribute("fontStyle",t)}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(t){this.owner.setAttribute("fontVariant",t)}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(t){this.owner.setAttribute("fontWeight",t)}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(t){this.owner.setAttribute("fontSize",t)}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(t){this.owner.setAttribute("lineHeight",t)}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(t){this.owner.setAttribute("fontFamily",t)}get font(){return this.owner.getAttribute("font")}set font(t){this.owner.setAttribute("font",t)}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(t){this.owner.setAttribute("startPoint",t)}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(t){this.owner.setAttribute("endPoint",t)}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(t){this.owner.setAttribute("lineEnding",t)}get segments(){return this.owner.getAttribute("segments")}set segments(t){this.owner.setAttribute("segments",t)}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(t){this.owner.setAttribute("stampPoints",t)}get imageData(){return this.owner.getAttribute("imageData")}set imageData(t){this.owner.setAttribute("imageData",t)}get iconName(){return this.owner.getAttribute("iconName")}set iconName(t){this.owner.setAttribute("iconName",t)}get textContents(){return this.owner.getAttribute("textContents")}set textContents(t){this.owner.setAttribute("textContents",function(t){const e=[];return t.forEach((t=>{t.content.length&&e.push(t)})),e}(t))}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(t){this.owner.setAttribute("textAlign",t)}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(t){this.owner.setAttribute("renderBlendMode",t)}}const _f=new class{constructor(){na(this,"parsers",void 0),na(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater()}getStyleParser(t){return this.parsers.get(t)}getStyleUpdaters(t){return this.updaters.get(t)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],mg,void 0),this.bindHandler(["startAngle","endAngle"],yg,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],mg,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],Tg,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],Ag,void 0),this.bindHandler(["lineDash"],Pg,void 0),this.bindHandler(["shadow"],Eg,void 0),this.bindHandler(["textContents"],kg,void 0)}initUpdater(){this.bindHandler(["borderWidth"],void 0,Fg),this.bindHandler(["x","y"],void 0,Rg),this.bindHandler(["width","height"],void 0,Lg),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,Og),this.bindHandler(["points","segments"],void 0,Mg),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,Bg),this.bindHandler(["stampPoints"],void 0,Ng),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,Ug)}bindHandler(t,e,i){for(let n=0;n<t.length;n++)if(e&&this.parsers.set(t[n],e),i){const e=this.updaters.get(t[n])||[];e.push(i),this.updaters.set(t[n],e)}}};class Tf extends Kp{constructor(t){super(),na(this,"attributes",{}),na(this,"id",void 0),na(this,"pageUid",void 0),na(this,"index",void 0),na(this,"name",void 0),na(this,"renderable",new ug),na(this,"sortable",new pg),na(this,"geometry",new dg),na(this,"transform",new gg),na(this,"parsedStyle",{}),na(this,"style",void 0),na(this,"isDestroyed",!1),na(this,"childNodes",[]),na(this,"nodeName",""),na(this,"nodeType",0),na(this,"nodeValue",null),na(this,"ownerDocument",null),na(this,"parentNode",null),na(this,"isConnected",!1),na(this,"textContent",void 0),na(this,"shapeType",void 0),na(this,"config",void 0),na(this,"path",void 0),na(this,"steps",void 0),na(this,"pathDirty",!0),na(this,"boundsDirty",!0),na(this,"bounds",void 0),na(this,"strokePath",void 0),na(this,"strokeSteps",void 0),na(this,"externalMatrices",[]),na(this,"clippable",!1),na(this,"imageData",null),this.config=t,this.id=t.id||t.uid||"",this.name=t.name||"",this.index=t.index,this.nodeName=t.type||"container",this.pageUid=t.pageUid||"",(t.className||t.class)&&(this.className=t.className||t.class),this.style=new Sf(this),this.initAttributes(t)}static isNode(t){return!!t.childNodes}set className(t){this.setAttribute("class",t)}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter((t=>""!==t))}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:t}=this;return t.length>0?t[t.length-1]:null}get nextSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e-1]}return null}getAttribute(t){const e=this.attributes[t];return null==e?null:e}getElementsByName(t){return cg.querySelectorAll(`[name="${t}"]`,this)}getElementsByClassName(t){return cg.querySelectorAll(`.${t}`,this)}getElementsByTagName(t){return cg.querySelectorAll(t,this)}hasAttribute(t){return Object.keys(this.attributes).indexOf(t)>-1}removeAttribute(t){this.setAttribute(t,null),delete this.attributes[t]}appendChild(t,e){cg.append(t,this,e);const i=new Jp("child-inserted",{child:t});this.dispatchEvent(i);const n=new pm("DOMNodeInserted",this,"","","",0,"","");return t.dispatchEvent(n),t}cloneNode(t){return null}insertBefore(t,e){if(e){const i=this.childNodes.indexOf(e);this.appendChild(t,i-1)}else this.appendChild(t);return t}removeChild(t){const e=new pm("removed",this,"","","",0,"","");t.dispatchEvent(e);const i=new Jp("child-removed",{child:t});return this.dispatchEvent(i),cg.remove(t),t}isChildExist(t){return cg.isChildExist(t)}replaceChild(t,e){const i=this.childNodes.indexOf(e);return this.removeChild(e),this.appendChild(t,i),e}destroy(){const t=new Jp("destroy",{});this.dispatchEvent(t),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0}after(){const{parentNode:t}=this;if(t){const s=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(((e,i)=>{null==t||t.appendChild(e,s+i+1)}))}}before(){const{parentNode:t}=this;if(t){const s=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(((e,i)=>{null==t||t.appendChild(e,s+i)}))}}remove(){this.parentNode&&this.parentNode.removeChild(this)}replaceWith(){this.after(...arguments),this.remove()}append(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{this.appendChild(t)}))}prepend(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(((t,e)=>{this.appendChild(t,e)}))}querySelector(t){return cg.querySelector(t,this)}querySelectorAll(t){return cg.querySelectorAll(t,this)}find(t){let e=null;return this.recursiveCall((i=>!(i!==this||!t(i)||(e=i,0)))),e}findAll(t){const e=[];return this.recursiveCall((i=>{i===this&&t(i)&&e.push(i)})),e}contains(t){let e=t;for(;e&&this!==e;)e=e.parentNode;return!!e}getRootNode(t){return this.parentNode?this.parentNode.getRootNode(t):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(t){return this===t}isSameNode(t){return this.isEqualNode(t)}normalize(){throw new Error("Method to be implemented")}recursiveCall(t){t(this)||this.childNodes.forEach((e=>{e.recursiveCall(t)}))}hasParentTransform(){return!(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return cg.getGeometryBounds(this)}getRenderBounds(){return cg.getBounds(this,!0)}getBounds(){return cg.getBounds(this)}getLocalBounds(){return cg.getLocalBounds(this)}getBoundingClientRect(){return cg.getBoundingClientRect(this)}get isVisible(){return"visible"===this.parsedStyle.visibility}get isInteractive(){return"none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)if(Wu(e,t)){if("style"===e)continue;this.attributes[e]=t[e]}for(const e in t.style)Wu(e,t.style)&&(this.parseStyleProperty(e,t.style[e]),this.attributes[e]=t.style[e]);this.renderable.toRenderable()}setAttribute(t,e){if(Hd(e))return;const i="x"===t||"y"===t,n=this.attributes[t];(e!==this.attributes[t]||i)&&(this.attributes[t]=e,Object.keys(this.config).includes(t)||(this.parseStyleProperty(t,e),this.updateStyleProperty(t,n,e)))}parseStyleProperty(t,e){const i=_f.getStyleParser(t);this.parsedStyle[t]=i?i(e,this,t):e}updateStyleProperty(t,e,i){const n=_f.getStyleUpdaters(t);n&&n.forEach((n=>{n(e,i,this,t)}))}toFront(){const{parentNode:t}=this;if(t){const e=Math.max(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e+1}return this}toBack(){const{parentNode:t}=this;if(t){const e=Math.min(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e-1}return this}setOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return cg.setOrigin(this,t,e),this}getOrigin(){return cg.getOrigin(this)}setPosition(t){return t=Ef(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),cg.setPosition(this,t),this}setLocalPosition(t){return t=Ef(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),cg.setLocalPosition(this,t),this}getPosition(){return cg.getPosition(this)}getLocalPosition(){return cg.getLocalPosition(this)}translate(t){return t=Ef(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),cg.translate(this,t),this}translateLocal(t){return t=Ef(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),cg.translateLocal(this,t),this}scale(t,e){return this.scaleLocal(t,e)}scaleLocal(t,e){return qd(t)&&(t={x:t,y:e=e||t}),cg.scaleLocal(this,t),this}setLocalScale(t,e){return qd(t)&&(t={x:t,y:e=e||t}),cg.setLocalScale(this,t),this}getScale(){return cg.getScale(this)}getLocalScale(){return cg.getLocalScale(this)}rotate(t){return cg.rotate(this,t),this}rotateLocal(t){return cg.rotateLocal(this,t),this}setAngle(t){return cg.setAngle(this,t),this}setLocalAngle(t){return cg.setLocalAngle(this,t),this}getAngle(){return cg.getAngle(this)}getLocalAngle(){return cg.getLocalAngle(this)}getLocalTransform(){return cg.getLocalTransform(this)}getWorldTransform(){return cg.getWorldTransform(this)}setLocalTransform(t){return cg.setLocalTransform(this,t),this}resetLocalTransform(){return cg.resetLocalTransform(this),this}getPath(){}getBoundingRect(){return{x:0,y:0,width:0,height:0}}isPointInPath(t){return!1}updateStyle(t){Object.keys(t).forEach((e=>{Wu(e,t)&&(this.style[e]=t[e])}))}updatePosition(t,e){this.style.x=t||0,this.style.y=e||0}updateOrigin(){const{width:t,height:e}=this.getBoundingRect();this.setOrigin(t/2,e/2)}getBoundingRectObject(){const{x:t,y:e,width:i,height:n}=this.getBoundingRect();return new Nf({style:{x:t,y:e,width:i,height:n,borderWidth:1,background:"transparent"}})}}function Ef(t,e){return qd(t)?{x:t,y:e}:t}class Pf extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"arc",style:{...Ig,r:0,startAngle:0,endAngle:1.5*Math.PI,...t},...e}),na(this,"shapeType","arc");const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}normAngle(){const{startAngle:t,endAngle:e}=this.style;let i=yg(t).value,n=yg(e).value;if(i>n){const t=i;i=n,n=t}if(Math.abs(n-i)>=2*Math.PI-1e-5&&(i=0,n=2*Math.PI),i<-2*Math.PI||n<-2*Math.PI){const t=Math.max(Math.floor(i/(-2*Math.PI)),Math.floor(n/(-2*Math.PI)));i+=2*Math.PI*t,n+=2*Math.PI*t}if(i>2*Math.PI||n>2*Math.PI){const t=Math.max(Math.floor(i/(2*Math.PI)),Math.floor(n/(2*Math.PI)));i-=2*Math.PI*t,n-=2*Math.PI*t}this.parsedStyle.startAngle=yg(i),this.parsedStyle.endAngle=yg(n)}updateOrigin(){const{width:t,height:e,x:i,y:n}=this.getBoundingRect(),s=i-this.style.x+t/2,o=n-this.style.y+e/2;this.setOrigin(s,o)}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:t,borderWidth:e,startAngle:i,endAngle:n}=this.parsedStyle,s=.5*((null==e?void 0:e.value)||0),o=i.value,r=n.value;return this.path=Xg(0,0,t.value-s,o,r),this.steps=Jg(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i,startAngle:n,endAngle:s,borderWidth:o}=this.parsedStyle,r=i.value,a=n.value,l=s.value;if(null==o||o.value,n===s)return{x:t-r-0,y:e-r-0,width:2*r+0,height:2*r+0};const{sin:h,cos:c,PI:d}=Math,u=[t+r*c(a),t+r*c(l)],p=[e+r*h(a),e+r*h(l)];return a<0&&l>0&&u.push(t+r),(a<.5*d&&l>.5*d||a<-1.5*d&&l>-1.5*d)&&p.push(e+r),(a<d&&l>d||a<-d&&l>-d)&&u.push(t-r),(a<1.5*d&&l>1.5*d||a<-.5*d&&l>-.5*d)&&p.push(e-r),u.sort(((t,e)=>t-e)),p.sort(((t,e)=>t-e)),this.boundsDirty=!1,this.bounds={x:u[0]-0,y:p[0]-0,width:u[u.length-1]-u[0]+0,height:p[p.length-1]-p[0]+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{x:i,y:n,r:s,startAngle:o,endAngle:r,background:a,borderWidth:l}=this.parsedStyle,h=hf(lf(o.value)),c=hf(lf(r.value)),d=hf(lf(o.value+r.value)/2),u=Zd(this.style.background)&&""!==this.style.background,p=l&&l.value,g=u?0:e,f=(l.value+g||0)/2,m=s.value-f,v=new Vg(i+m*Math.cos(h*Math.PI/180),n+m*Math.sin(h*Math.PI/180)),y=new Vg(i+m*Math.cos(c*Math.PI/180),n+m*Math.sin(c*Math.PI/180)),x=new Vg(i+m*Math.cos(d*Math.PI/180),n+m*Math.sin(d*Math.PI/180)),w=new Vg(t.x,t.y),b=w.distanceTo({x:i,y:n}),C=Hg([v.x,v.y],[x.x,x.y],[w.x,w.y],[i,n]),S=Hg([y.x,y.y],[x.x,x.y],[w.x,w.y],[i,n]),_=Hg([v.x,v.y],[y.x,y.y],[w.x,w.y],[i,n]);if(b>m+f)return!1;const T=pf(v,y,2*f,t);if(c-h<180&&c-h>0||c-h<-180){if(a&&_||T)return!0;if(!a&&p&&b>=m-f&&b<=m+f&&_)return!0}else if(180===Math.abs(c-h)){if(a){if(C||S)return!0;if(function(t,e,i,n){const{x:s,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=i,{x:c,y:d}=n;return!(((c-s)*(a-o)-(d-o)*(r-s))*((l-s)*(a-o)-(h-o)*(r-s))<=0||((c-l)*(a-h)-(d-h)*(r-l))*((s-l)*(a-h)-(o-h)*(r-l))<=0||((c-s)*(h-o)-(d-o)*(l-s))*((r-s)*(h-o)-(a-o)*(l-s))<=0)}(v,x,y,t))return!0}if(!a&&p&&b>=m-f&&b<=m+f&&(C||S))return!0}else{if(a){if(C||S)return!0;if(!_)return!0}if(!a&&p&&b>=m-f&&b<=m+f&&(C||S))return!0}return!!T}}class Af extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"circle",style:{...Ig,r:0,anchor:[.5,.5],...t},...e}),na(this,"shapeType","circle");const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{r:t,borderWidth:e}=this.parsedStyle;let i=.5*((null==e?void 0:e.value)||0);return t.value===i&&(i=0),this.path=Xg(0,0,t.value-i,0,2*Math.PI),this.steps=Jg(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i}=this.parsedStyle,n=i.value;return this.boundsDirty=!1,this.bounds={x:t-n-0,y:e-n-0,width:2*n+0,height:2*n+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{x:i,y:n,r:s,background:o,borderWidth:r}=this.parsedStyle,a=Zd(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,c=(r.value+h||0)/2,d=s.value-c,u=new Vg(t.x,t.y).distanceTo({x:i,y:n});return o&&l?u<=d+c:o?u<=d:!!l&&u>=d-c&&u<=d+c}}let If=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ellipse",style:{...Ig,rx:"",ry:"",borderWidth:0,anchor:[.5,.5],...t},...e}),na(this,"shapeType","ellipse");const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{rx:t,ry:e,borderWidth:i}=this.parsedStyle,n=.5*i.value;return this.path=qg(0,0,t.value-n,e.value-n),this.steps=Jg(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,rx:i,ry:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t-i.value-0,y:e-n.value-0,width:2*i.value+0,height:2*n.value+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{x:i,y:n,rx:s,ry:o,borderWidth:r}=this.parsedStyle,a=Zd(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,c=(r.value||0)/2,d=s.value-c,u=o.value-c,p=(t.x-i)*(t.x-i),g=(t.y-n)*(t.y-n);return a&&l?cf(p,g,d+c,u+c)<=1:a?cf(p,g,d,u)<=1:!!l&&cf(p,g,d-c-h/2,u-c-h/2)>=1&&cf(p,g,d+c+h/2,u+c+h/2)<=1}},Df=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"image",style:{...Ig,width:0,height:0,img:"",...t},...e}),na(this,"shapeType","image"),na(this,"meteData",void 0),this.meteData=(null==e?void 0:e.metadata)||null;const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}},kf=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ink",style:{...Ig,segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:10,...t},...e}),na(this,"shapeType","ink"),na(this,"inkPaths",[]),na(this,"inkSteps",[]),na(this,"inkRenderPaths",[]),na(this,"inkOriginalRenderPath",void 0),na(this,"inkRenderSteps",[]),na(this,"initialRect",void 0),na(this,"douglasPeuckerPoints",[]),na(this,"partDirty",!1),na(this,"optimizedOpSteps",[]),na(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height)}addSegment(){const{segments:t}=this.style;t[t.length-1].length&&this.style.segments.push([])}addPoint(t){const e=[...this.style.segments],i=this.style.segments.length,n=e[i-1],s=n[n.length-1];if((null==s?void 0:s.x)!==t.x||(null==s?void 0:s.y)!==t.y){this.partDirty=!0;const n=this.getBoundingRect(),s=this.parsedStyle.borderWidth.value/2;(t.x<n.x+s||t.y<n.y+s)&&(this.positionDirty=!0),e[i-1].push(t),this.style.segments=e;const o=this.getBoundingRect();(t.x<o.x||t.y<o.y||t.x>o.x+o.width||t.y>o.y+o.height)&&(this.boundsDirty=!0)}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:t}=this.parsedStyle;if(this.partDirty){const e=t.length;if(e>1)for(let i=0;i<e-1;i++){const e=t[i];if(!this.optimizedOpSteps[i]){let t=[...e];1===t.length?t=this.offsetPoints(e[0],.1):(t=jg(t,0,t.length-1,1),t.length<=3&&t.push({...t[t.length-1]}));const n=Qg(t,t.length).map((t=>t.ops)).flat(2);this.optimizedOpSteps[i]=n}if(this.positionDirty||!this.inkRenderSteps[i]){const t=this.getRenderStep(this.optimizedOpSteps[i]);this.inkRenderSteps[i]=t}}let i=t[e-1];1===i.length?i=this.offsetPoints(i[0],.1):i.length<=3&&i.push(i[i.length-1]),i=this.getRenderPath(i);const n=function(t){const e=t.length;if(e<=1)return[];if(2===e)return[Zg("moveTo",[t[0]]),Zg("lineTo",[t[1]])];const i=[Zg("moveTo",[t[0]])];for(let n=0;n<e-1;n++){const e=t[n-1]||t[n],s=t[n],o=t[n+1]||t[n];i.push(ef(e,s,o))}return i}(i);this.inkRenderSteps[e-1]=n}else this.pathDirty&&(this.reset(),t.forEach(((t,e)=>{if(0===t.length)return;let i=[...t];1===t.length?i=this.offsetPoints(t[0],.1):(i=jg(i,0,i.length-1,1),i.length<=3&&i.push({...i[i.length-1]})),this.inkPaths[e]=i;const n=Qg(i,i.length);this.inkSteps[e]=n.map((t=>t.ops)).flat(2);const s=this.getRenderPath(i),o=Qg(s,s.length).map((t=>t.ops)).flat(2);this.inkRenderSteps[e]=o})));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:i,y:n}=t;return[{x:i-e,y:n-e},{x:i+e,y:n-e},{x:i+e,y:n+e},{x:i-e,y:n+e}]}getRenderStep(t){return t.map((t=>({...t,data:this.getRenderPath(t.data)})))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:t}=this.parsedStyle,e=[];for(let i=0;i<t.length;i++){const n=this.getRenderPath(t[i]);e.push(n)}this.inkOriginalRenderPath=e}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i})})),n}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t}=this.parsedStyle,e=[],i=[];this.parsedStyle.segments.forEach((t=>{t.forEach((t=>{t&&(e.push(t.x),i.push(t.y))}))}));const{min:n,max:s}=Rf(e),{min:o,max:r}=Rf(i),a=t.value/2;return this.boundsDirty=!1,this.bounds={x:n-a,y:o-a,width:s-n+2*a,height:r-o+2*a},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{borderWidth:i}=this.parsedStyle;for(let n=0;n<this.inkSteps.length;n++){const s=this.inkSteps[n];for(let n=1;n<s.length;n+=2){const o=s[n-1].data[0],r=s[n].data[0],a=s[n].data[1];if(zg(o.x,o.y,r.x,r.y,a.x,a.y).isHit([t.x,t.y],i.value+e))return!0}}return!1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[]}};function Rf(t){if(0===t.length)return{min:void 0,max:void 0};let e=t[0],i=t[0];for(let n=1;n<t.length;n++)t[n]<e&&(e=t[n]),t[n]>i&&(i=t[n]);return{min:e,max:i}}function Mf(t,e){return{x:e.x-t.x,y:e.y-t.y}}function Lf(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Of(t,e){const i=function(t,e){return t.x*e.x+t.y*e.y}(t,e),n=Lf(t),s=Lf(e);return Math.acos(i/(n*s))}let Bf=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polygon",style:{...Ig,points:[{x:0,y:0},{x:10,y:10}],miterLimit:10,borderWidth:2,...t},...e}),na(this,"shapeType","polygon"),na(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:i,y:n,width:s,height:o}=this.getBoundingRect();this.updatePosition(i,n),this.setOrigin(s/2,o/2)}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e}updatePoints(){const{renderPath:t}=this,e=this.getLocalPosition(),i=[];t.forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y})})),this.style.points=i}getPath(){if(!this.pathDirty)return this.path;const{x:t,y:e}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map((i=>({x:i.x-t,y:i.y-e}))),this.steps=nf(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,points:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=df(e[0],e[1],t.value,i),this.bounds;const n=of(e),s=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:n.left-s,y:n.top-s,width:n.width+2*s,height:n.height+2*s},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{borderWidth:i,points:n}=this.parsedStyle,s=Zd(this.style.background)&&""!==this.style.background,o=s?0:e;let r=!1;return i&&i.value&&(r=gf(n,i.value+o,t.x,t.y,!0)),!r&&s&&(r=function(t,e,i){let n=!1;const s=t.length;if(s<=2)return!1;for(let l=0;l<s;l++){const h=t[l],c=t[(l+1)%s];if(r=c,((a={x:e,y:i}).x-(o=h).x)*(r.y-o.y)==(r.x-o.x)*(a.y-o.y)&&Math.min(o.x,r.x)<=a.x&&a.x<=Math.max(o.x,r.x)&&Math.min(o.y,r.y)<=a.y&&a.y<=Math.max(o.y,r.y))return!0;uf(h.y-i)>0!=uf(c.y-i)>0&&uf(e-(i-h.y)*(h.x-c.x)/(h.y-c.y)-h.x)<0&&(n=!n)}var o,r,a;return n}(n,t.x,t.y)),r}},Ff=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polyline",style:{...Ig,points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:10,...t},...e}),na(this,"shapeType","polyline"),na(this,"renderPath",void 0),this.getPath();const{x:i,y:n}=this.getBoundingRect();this.updatePosition(i,n),this.updateOrigin()}initPath(){const{points:t,lineEnding:e}=this.parsedStyle,i=[];if(t.forEach(((t,e)=>{0===e?i.push({x:t.x,y:t.y,step:0,close:!1}):i.push({x:t.x,y:t.y,step:1,close:!1})})),e&&i.length>1)for(let t=0;t<e.length;t++)switch(e[t]){case"OpenArrow":this.addOpenArrow(i,t,!1);break;case"ROpenArrow":this.addOpenArrow(i,t,!0);break;case"ClosedArrow":this.addCloseArrow(i,t,!1);break;case"RClosedArrow":this.addCloseArrow(i,t,!0);break;case"Butt":this.addButt(i,t);break;case"Slash":this.addSlash(i,t);break;case"Square":this.addSquare(i,t);break;case"Diamond":this.addDiamond(i,t);break;case"Circle":this.addCircle(i,t)}return i}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close})})),n}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e}updatePoints(){const{length:t}=this.parsedStyle.points,e=this.getLocalPosition(),i=[];this.renderPath.slice(0,t).forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y})})),this.style.points=i}updatePoint(){const t=this.getLocalPosition(),e=this.parsedStyle.points.length,i=[];for(let n=0;n<e;n++)i.push({x:this.renderPath[n].x+t.x,y:this.renderPath[n].y+t.y});this.updateStyle({points:i})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=af(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=df(this.path[0],this.path[1],t.value,e),this.bounds;const i=of(this.path),n=t.value/2;return this.boundsDirty=!1,this.bounds={x:i.left-n,y:i.top-n,width:i.width+2*n,height:i.height+2*n},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{borderWidth:i,points:n}=this.parsedStyle;return gf(n,i.value+e,t.x,t.y,!1)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return!!t&&("None"!==t[0]||"None"!==t[1])}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:n,borderWidth:s}=this.parsedStyle,{length:o}=n;let r=n[o-2],a=n[o-1];0===e&&(r={...n[0]},a={...n[1]}),mf(t,e,i,r,a,s.value)}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:n,borderWidth:s}=this.parsedStyle,{length:o}=n;let r=n[o-2],a=n[o-1];0===e&&(r={...n[0]},a={...n[1]}),vf(t,e,i,r,a,s.value)}addCircle(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;Cf(t,e,i[0],i[s-1],n.value)}addDiamond(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;bf(t,e,i[0],i[s-1],n.value)}addSquare(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;wf(t,e,i[0],i[s-1],n.value)}addSlash(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;let o=i[s-2],r=i[s-1];0===e&&(o={...i[0]},r={...i[1]}),xf(t,e,o,r,n.value)}addButt(t,e){const{points:i,borderWidth:n}=this.parsedStyle,{length:s}=i;let o=i[s-2],r=i[s-1];0===e&&(o={...i[0]},r={...i[1]}),yf(t,e,o,r,n.value)}},Nf=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"rect",style:{...Ig,width:0,height:0,...t},...e}),na(this,"shapeType","rect");const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=(null==i?void 0:i.value)||0,s=n,o=n,r=t.value-2*n,a=e.value-2*n;return this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.steps=nf(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=.5*((null==i?void 0:i.value)||0),s=n,o=n,r=t.value-2*n,a=e.value-2*n;this.strokePath=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.strokeSteps=nf(this.strokePath)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:n,borderWidth:s,width:o,height:r}=this.parsedStyle,a=Zd(this.style.background)&&""!==this.style.background,l=s&&s.value,h=e/2;return a?ff(i,n,o.value,r.value,t.x,t.y):!!l&&function(t,e,i,n,s,o,r){return ff(t,e,i,s,o,r)||ff(t,e,s,n,o,r)||ff(t,e+n-s,i,s,o,r)||ff(t+i-s,e,s,n,o,r)}(i-h,n-h,o.value+e,r.value+e,s.value+e,t.x,t.y)}};class Uf extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stampPath",style:{...Ig,stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4,...t},...e}),na(this,"shapeType","stampPath"),na(this,"renderPath",void 0),this.getPath()}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close})})),n}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(t){if(t.length<1)return[];const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(0===n.step)e.push(Zg("lineTo",[n],n.close));else if(1===n.step){if(i+2<t.length&&1===t[i+1].step&&1===t[i+2].step){const s=t[i+1],o=t[i+2];e.push(Zg("bezierCurveTo",[n,s,o],n.close)),i+=2}}else 2===n.step&&e.push(Zg("moveTo",[n],n.close))}return e}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,stampPoints:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=df(e[0],e[1],t.value,i),this.bounds;const n=of(e),s=t.value/2;return this.boundsDirty=!1,this.bounds={x:n.left-s,y:n.top-s,width:n.width+2*s,height:n.height+2*s},this.bounds}}let Vf=class extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"line",style:{...Ig,startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2,...t},...e}),na(this,"shapeType","line"),na(this,"renderPath",void 0),this.getPath();const{x:i,y:n}=this.getBoundingRect();this.updatePosition(i,n),this.updateOrigin()}initPath(){const{startPoint:t,endPoint:e,lineEnding:i}=this.parsedStyle,n=[{...t,step:0,close:!1},{...e,step:1,close:!1}];if(i)for(let t=0;t<i.length;t++)switch(i[t]){case"OpenArrow":this.addOpenArrow(n,t,!1);break;case"ROpenArrow":this.addOpenArrow(n,t,!0);break;case"ClosedArrow":this.addCloseArrow(n,t,!1);break;case"RClosedArrow":this.addCloseArrow(n,t,!0);break;case"Butt":this.addButt(n,t);break;case"Slash":this.addSlash(n,t);break;case"Square":this.addSquare(n,t);break;case"Diamond":this.addDiamond(n,t);break;case"Circle":this.addCircle(n,t)}return n}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),n=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||n.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close})})),n}updatePoints(){const t=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+t.x,y:this.renderPath[0].y+t.y},endPoint:{x:this.renderPath[1].x+t.x,y:this.renderPath[1].y+t.y}})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=af(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle,i=of(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=df(this.path[0],this.path[1],t.value,e),this.bounds;const n=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:i.left-n,y:i.top-n,width:i.width+2*n,height:i.height+2*n},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return!1;const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;return pf(i,n,s.value+e,t)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return!!t&&("None"!==t[0]||"None"!==t[1])}addCircle(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;Cf(t,e,i,n,s.value)}addDiamond(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;bf(t,e,i,n,s.value)}addSquare(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;wf(t,e,i,n,s.value)}addSlash(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;xf(t,e,i,n,s.value)}addButt(t,e){const{startPoint:i,endPoint:n,borderWidth:s}=this.parsedStyle;yf(t,e,i,n,s.value)}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:n,endPoint:s,borderWidth:o}=this.parsedStyle;mf(t,e,i,n,s,o.value)}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:n,endPoint:s,borderWidth:o}=this.parsedStyle;vf(t,e,i,n,s,o.value)}};class Wf extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stampText",style:{...Ig,text:"",color:"black",fontSize:12,fontFamily:"Microsoft YaHei",fontWeight:"normal",fontStyle:"normal",...t},...e}),na(this,"shapeType","stampText"),this.setTextFont();const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}setTextFont(){const{fontStyle:t,fontWeight:e,fontFamily:i,fontSize:n}=this.parsedStyle,s=""===(null==i?void 0:i.trim())?"sans-serif":i;null!=i&&i.includes(" ")?this.style.font=`${t} ${e} ${n.value}${n.unit} '${s}'`:this.style.font=`${t} ${e} ${n.value}${n.unit} ${s}`}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,text:i,fontSize:n,font:s}=this.parsedStyle,o=document.createElement("canvas").getContext("2d");o.font=s;const{width:r}=o.measureText(i);return this.boundsDirty=!1,this.bounds={x:t,y:e-n.value,width:r,height:n.value},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}}let Hf=class extends Nf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stamp",style:{...t,background:"transparent",borderColor:"transparent"},...e}),na(this,"shapeType","stamp"),na(this,"stampConfig",[]),na(this,"stampItemShapes",[]),na(this,"renderType","stamp"),na(this,"initialWidth",0),na(this,"initialHeight",0),this.stampConfig=t.stampConfig||[]}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle())}initStampItem(){if(!Ud(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:t,stampItemShapes:e}=this,{renderBlendMode:i}=this.parsedStyle;for(let n=0;n<t.length;n++){let s;"path"===t[n].type&&(s=new Uf({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),"text"===t[n].type&&(s=new Wf({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),"image"===t[n].type&&(s=new Df({style:{opacity:this.style.opacity,renderBlendMode:i,...t[n]}})),s&&e.push(s)}}initStampStyle(){if(!Ud(this.stampConfig))return;const t=[],e=[],{stampItemShapes:i}=this,n=i.some((t=>t instanceof Uf));for(const s of i){if(n&&!(s instanceof Uf)){this.appendChild(s);continue}const i=s.getBoundingRect();t.push(i.x,i.x+i.width),e.push(i.y,i.y+i.height),this.appendChild(s)}this.initialWidth=Math.max(...t)-Math.min(...t),this.initialHeight=Math.max(...e)-Math.min(...e);const s=Math.min(...t),o=Math.min(...e);this.updateStyle({x:s,y:o,width:this.initialWidth,height:this.initialHeight});for(let t=0;t<i.length;t++){const e=i[t].getBoundingRect();let n=e.y-this.style.y;i[t]instanceof Wf&&(n+=i[t].parsedStyle.fontSize.value),i[t].setLocalPosition(e.x-this.style.x,n)}this.updateOrigin()}isPointInPath(t,e){return super.isPointInPath(t,0)}};class jf extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"roundedRect",style:{...Ig,roundedRadius:0,width:0,height:0,...t},...e}),na(this,"shapeType","roundedRect");const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:n}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:n.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:n,width:s,height:o,borderWidth:r}=this.parsedStyle,a=(r.value+e||0)/2;return ff(i-a,n-a,s.value+2*a,o.value+2*a,t.x,t.y)}getCenterPosition(){const{width:t,height:e}=this.parsedStyle,i=new Af({style:{x:t.value/2,y:e.value/2}});this.appendChild(i);const{x:n,y:s}=i.getPosition();return i.destroy(),{x:n,y:s}}}class zf extends Tf{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"freeText",style:{...Ig,width:0,height:0,textAlign:"left",...t},...e}),na(this,"shapeType","freeText"),na(this,"lines",void 0),na(this,"textType","textBox"),na(this,"lineHeightOffset",.2),na(this,"renderClipPath",void 0),na(this,"renderClipStep",void 0),na(this,"totalTextHeight",0),na(this,"limitWidth",1),na(this,"textMaxWidth",0),na(this,"borderOffset",0),na(this,"padding",1),this.textType=t.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateTextLines();const{x:i,y:n}=this.parsedStyle;this.setLocalPosition(i,n),this.updateOrigin()}getLimitTextWithoutSpace(t,e){const{textContents:i}=this.parsedStyle,n=Wd(t),s=n.segmentation.length,o=n.segmentation[s-1],r=Gf(" ",i[o.freeContentIndex]),a=o.text.split(" ").length-1;let l;for(let t=0;t<a&&(l=t+1,!(n.width-l*r<e));t++);for(let t=0;t<l;t++)n.word=n.word.slice(0,-1),n.width-=r,o.text=o.text.slice(0,-1),o.width-=r;return n}splitWordSegment(t,e){const i=t,n=[],s=[];let o=e;const r=i.segmentation.length;for(let t=0;t<r;t++){const e=i.segmentation[t];if(!(e.width<o)){if(e.width===o){n.push({...e}),s.push(...i.segmentation.slice(r-t-1));break}{const a=this.parsedStyle.textContents[e.freeContentIndex],l=Yf(e.text,o,a);2===l.length?(n.push({text:l[0],width:Gf(l[0],a),freeContentIndex:e.freeContentIndex}),s.push({text:l[1],width:Gf(l[1],a),freeContentIndex:e.freeContentIndex})):s.push({...e});const h=r-t-1;h>0&&s.push(...i.segmentation.slice(-h));break}}n.push({...e}),o-=e.width}const a=t=>{let e="",i=0;return t.forEach((t=>{e+=t.text,i+=t.width})),{word:e,width:i,segmentation:t}};return 0===n.length?[a(s)]:[a(n),a(s)]}getWordSegmentation(){const{textContents:t}=this.parsedStyle;let e="";const i=[0];t.forEach((t=>{e+=t.content,i.push(e.length)}));const n=e.match(/\S+\s*/g)||[],s=[];let o=0;const r=qf(e);if(r.length&&n.unshift(...r)," "===e[0]){const t=e.match(/^ +/)[0];n[0]?n[0]=t+n[0]:n[0]=t}for(let t=0;t<n.length;t++){const e=n[t].split(/(\r\n|[\r\n])/).filter((t=>""!==t));e.length>2&&(n[t]=e[0]+e[1],n.splice(t+1,0,...e.slice(2)))}return n.forEach((e=>{const n=o+e.length-1,r=[...i.filter((t=>t>o&&t<=n))];if(0===r.length){const n=i.filter((t=>t<=o)).length,r=Gf(e,t[n-1]);s.push({word:e,segmentation:[{text:e,width:r,freeContentIndex:n-1}],width:r})}else{const n=[];let a=0;r.forEach(((s,l)=>{const h=s-(r[l-1]||o),c=r[l-1]-o||0,d=e.substring(c,c+h),u=Gf(d,t[i.indexOf(s)-1]);if(n.push({text:d,width:u,freeContentIndex:i.indexOf(s)-1}),a+=u,l===r.length-1){const o=Gf(e.substring(c+h),t[i.indexOf(s)]);n.push({text:e.substring(c+h),freeContentIndex:i.indexOf(s),width:o}),a+=o}})),s.push({word:e,width:a,segmentation:n})}o+=e.length})),s}organizeLine(){if(0===this.lines.length)return;const{y:t}=this.parsedStyle;let e=t+this.borderOffset+this.padding,i=0,n=0;this.lines.forEach(((t,s)=>{n=0,i=Math.max(t.width,i);let o=0,r="";if(0===t.width&&""===t.words[0].text){const e=Gf(" ",t.words[0].style);t.width=e,t.words[0].wordWidth=e,t.words[0].text=" "}if(t.words.forEach((t=>{r+=t.text,o=Math.max(o,t.wordHeight),t.widthWithoutLf=Xf(t.text)?Gf(t.text,t.style,!0):t.wordWidth,n+=t.widthWithoutLf})),"textBox"===this.textType&&"justify"===this.style.textAlign&&s!==this.lines.length-1){const e=[],i=/\b\w/g;let s,o=0;for(;null!==(s=i.exec(r));)e.push(s.index);if(e.length>1){let i=this.limitWidth-n;i<0&&(i=0);const s=i/(e.length-1),r=t=>{for(let i=0;i<e.length;i++)if(e[i]>t)return i;return e.length};t.words.forEach(((t,e)=>{e>0&&(t.x+=s*(r(o)-1)),o+=t.text.length})),n=this.limitWidth,t.width=this.limitWidth}}const{lineHeightOffset:a}=this;t.widthWithoutLF=n,t.height=o,t.y=o*(1-a)+e,e+=o,s>0&&(t.y+=this.lines[s-1].height*a,e+=this.lines[s-1].height*a)})),this.textMaxWidth=i}getTextAlignOffset(t){if("freeTextWriter"===this.textType)return 0;const{limitWidth:e}=this,{textAlign:i}=this.parsedStyle,n=t?t.widthWithoutLF:0;let s=0;return"center"===i?s=(e-n)/2:"right"===i&&(s=e-n),s}getPath(){var t;if(!this.pathDirty)return this.path;const{width:e,height:i}=this.getBoundingRect(),n=.5*((null===(t=this.parsedStyle.borderWidth)||void 0===t?void 0:t.value)||0),s=n,o=n,r=e-2*n,a=i-2*n;if(this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],"textBox"===this.textType){const t=this.borderOffset/2;this.renderClipPath=[{x:s+t,y:o+t},{x:s+r-t,y:o+t},{x:s+r-t,y:o+a-t},{x:s+t,y:o+a-t}],this.renderClipStep=nf(this.renderClipPath)}return this.steps=nf(this.path),this.pathDirty=!1,this.path}setLimitWidth(t){const{borderWidth:e,borderColor:i}=this.parsedStyle;"textBox"===this.textType&&e.value&&!i.isNone&&(this.borderOffset=e.value,this.padding=e.value),this.limitWidth=t-2*this.borderOffset-2*this.padding}calculateTextLines(){const{textContents:t,x:e}=this.parsedStyle;if(null==t||!t.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const i=e+this.borderOffset+this.padding;this.lines=function(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=document.createElement("div"),o=function(t,e,i){const n=[],s=document.createDocumentFragment();return t.style.width=`${e}px`,t.style.wordBreak="break-word",t.style.visibility="hidden",i.forEach((t=>{const{fontSize:e,fontStyle:i,fontFamily:o,fontWeight:r,color:a,content:l}=t;if(!l.length)return;const h=""===(null==o?void 0:o.trim())?"sans-serif":o,c=null!=o&&o.includes(" ")?`${i} ${r} ${e.value}${e.unit} '${h}'`:`${i} ${r} ${e.value}${e.unit} ${h}`,d=document.createElement("div");if(d.style.font=c,d.style.letterSpacing="0px",d.style.whiteSpace="pre-wrap",d.style.display="inline",d.style.color=a,u=l,new RegExp("([A-Za-z0-9])\\1{9,}").test(u)){const t=document.createDocumentFragment();for(let t=0;t<l.length;t++){const e=document.createElement("span");e.style.display="inline-block",e.innerText=l[t],d.appendChild(e)}d.appendChild(t)}else d.innerText=l;var u;s.appendChild(d),n.push(d)})),t.appendChild(s),n}(s,e,t);document.body.appendChild(s);const r=[];let a,l=[],h={};const c=()=>{if(!l.length)return;h.x=i,h.words=l;let t=0;l.forEach((e=>{t+=e.wordWidth})),h.width=t,r.push(h),l=[],h={}},d=(e,s,o,r)=>{const h=t[o];if(n){const n=[],r=/\b\w/g;let c;for(;null!==(c=r.exec(e));)n.push(c.index);let d=s-(a||0)+i;for(let i=0;i<n.length;i++){const s=n[i],r=i===n.length-1?e.length:n[i+1],a=e.slice(s,r),c=Gf(a,t[o]);l.push({freeContentIndex:o,originText:a,style:h,text:a,wordHeight:h.fontSize.value,wordWidth:c,x:d}),d+=c}}else l.push({freeContentIndex:o,originText:e,style:h,text:e,wordHeight:h.fontSize.value,wordWidth:r,x:s-(a||0)+i})},u=(t,e)=>{d("\n",a||0,t,e),c()};for(let e=0;e<o.length;e++){const i=Zf(o[e]);if(0===i.length)continue;const n=t[e].content.replace(/\r\n/g,"\n"),s=n.length,r=qf(n).length,l=n.slice(r),h=Gf("\n",t[e]);if(r)for(let t=0;t<r;t++)u(e,h);i.length&&Hd(a)&&(a=i[0].x);const p=i.map(((t,e)=>({obj:t,index:e,oldIndex:e,minIndex:void 0}))).filter((t=>{let{obj:e,index:i}=t;return e.x===a&&0!==i}));i.length&&i[0].x===a&&c();const g=i[i.length-1];if(s===i.length)if(p.length){let t=0;p.forEach((s=>{const{index:o}=s,r=n.slice(t,o),a=i[o-1],l=i[t].x;t=o,d(r,l,e,a.x-l+a.width),c()}));const s=n.slice(t),o=i[t].x;d(s,o,e,g.x-o+g.width)}else{const t=g.x-i[0].x+g.width;d(n,i[0].x,e,t)}else{const t=Jf(l);for(let e=0;e<t.length;e++)p.forEach((i=>{i.index>=t[e]&&(i.index===t[e]&&Hd(null==i?void 0:i.minIndex)&&(i.minIndex=t[e]),i.index+=1)}));if(p.length){let n=0,s=0;p.forEach(((t,o)=>{const{index:r,oldIndex:a,minIndex:p}=t;let g=0;if(Hd(p)||(g=r-p),g){const t=l.slice(n,r-g+1),o=i[a-1],p=i[s].x,f=o.x-p+o.width+h;d(t,p,e,f),c();for(let t=0;t<g-1;t++)u(e,h)}else{const t=l.slice(n,r),o=i[a-1],h=i[s].x;d(t,h,e,o.x-h+o.width),c()}n=r,s=a}));const o=t.filter((t=>t>p[p.length-1].index)).length,r=l.slice(n,l.length-o+1),a=i[i.length-1],g=i[p[p.length-1].oldIndex].x,f=o>0?a.x-g+a.width+h:a.x-g+a.width;d(r,g,e,f);for(let t=0;t<o-1;t++)0===t&&c(),u(e,h)}else if(t.length){const n=l.slice(0,l.length-t.length+1),s=g.x-i[0].x+g.width+h;d(n,i[0].x,e,s),c();for(let i=0;i<t.length-1;i++)u(e,h)}else{const t=g.x-i[0].x+g.width;d(l,i[0].x,e,t)}}}return c(),s.remove(),r}(t,this.limitWidth,i,"justify"===this.style.textAlign),this.organizeLine(),this.calculateTotalHeight()}calculateTotalHeight(){const{y:t,height:e}=this.parsedStyle,i=this.lines.length;if(i){const n=this.lines[i-1];let s=n.y+n.height*this.lineHeightOffset-t+2*this.borderOffset;Xf(n.words[0].text)&&(s+=n.height*(1+this.lineHeightOffset)),this.totalTextHeight=s>e.value?s:e.value}else this.totalTextHeight=e.value}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,height:i}=this.parsedStyle;let n=i.value,s=this.limitWidth+2*this.borderOffset+2*this.padding;return"freeTextWriter"===this.textType?(s=this.textMaxWidth+2*this.borderOffset+2*this.padding,n=this.totalTextHeight):s=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:t,y:e,width:s,height:n},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}}function Gf(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:n,fontStyle:s,fontFamily:o,fontWeight:r}=e,a=document.createElement("canvas").getContext("2d"),l=""===(null==o?void 0:o.trim())?"sans-serif":o;null!=o&&o.includes(" ")?a.font=`${s} ${r} ${n.value}${n.unit} '${l}'`:a.font=`${s} ${r} ${n.value}${n.unit} ${l}`;let h=0;for(let e=0;e<t.length;e++){const n=t.charAt(e);i&&$f(n)||(h+=a.measureText(n).width)}return h}function Yf(t,e,i){let n=0;for(let s=0;s<t.length;s++)if(Gf(t.substring(0,s+1),i)>e){n=s;break}return 0===n?[t]:[t.substring(0,n),t.substring(n)]}function $f(t){return/^[\r\n]+$/.test(t)}function Xf(t){return t.endsWith("\n")||t.endsWith("\r")||t.endsWith("\r\n")}function qf(t){const e=t.match(/^(?:\r\n|\r|\n)*/);if(e){const t=e[0];let i=0;for(const e of t)"\n"!==e&&"\r"!==e||(i+=1);return t.includes("\r\n")&&(i-=1),Array.from({length:i},(()=>"\n"))}return[]}function Zf(t){const e=[],i=document.createRange(),n=function(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);let n;for(;n=i.nextNode();)e.push(n);return e}(t);return n.forEach((t=>{i.selectNodeContents(t);const n=t.nodeValue;for(let s=0;s<n.length;s++){i.setStart(t,s),i.setEnd(t,s+1);const o=i.getClientRects(),r=o.length>1?o[1]:o[0];e.push({text:n[s],x:r.left,y:r.top,width:r.width,height:r.height})}})),function(t){const e=new Map;t.forEach((t=>{var i;e.has(t.y)||e.set(t.y,[]),null===(i=e.get(t.y))||void 0===i||i.push(t)})),e.forEach((t=>{t.sort(((t,e)=>t.x-e.x))}));const i=[];return e.forEach((t=>{i.push(...t)})),i}(e)}function Jf(t){const e=/(\r\n|[\r\n])/g;let i;const n=[];for(;null!==(i=e.exec(t));)n.push(i.index);return n}const Kf=1/0;class Qf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Kf,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;na(this,"minX",void 0),na(this,"maxX",void 0),na(this,"minY",void 0),na(this,"maxY",void 0),na(this,"rect",void 0),na(this,"updateId",void 0),this.minX=t,this.maxX=e,this.minY=i,this.maxY=n,this.rect=null,this.updateId=-1}static isEmpty(t){return t.minX===t.maxX&&t.minY===t.maxY}static fromBounds(t){return(new Qf).setFromBounds(t)}static create(){return new Qf}setFromBounds(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}clear(){return this.minX=Kf,this.maxX=-1/0,this.minY=Kf,this.maxY=-1/0,this}getRect(t){const{minX:e,minY:i,maxX:n,maxY:s}=this;if(e>n||i>s)return new du(0,0,0,0);const o=t||new du;return o.update(e,i,n-e,s-i),o}addPoint(t){return this.addBounds({minX:t.x,maxX:t.x,minY:t.y,maxY:t.y})}addBounds(t){const e=em(this,t);return this.setFromBounds(e)}addBoundsMask(t,e){const i=tm(t,e);if(i.minX<=i.maxX&&i.minY<=i.maxY){const t=em(i,this);this.setFromBounds(t)}return this}intersection(t){if(i=t,!((e=this).minX<=i.maxX&&e.maxX>=i.minX&&e.minY<=i.maxY&&e.maxY>=i.minY))return null;var e,i;const n=tm(this,t);return Qf.fromBounds(n)}union(t){const e=em(this,t);return Qf.fromBounds(e)}addBoundsArea(t,e){const{x:i,y:n,width:s,height:o}=e,r={minX:i,minY:n,maxX:i+s,maxY:n+o};return this.addBoundsMask(t,r)}addFrame(t,e){return this.setFromTransformedBounds(t.worldTransform,e)}setFromTransformedBounds(t,e){for(let i=0;i<2;i++){const n=t.transformPoint({x:i?e.maxX:e.minX,y:i?e.maxY:e.minY});this.addPoint(n)}return this}addQuad(t){for(let e=0;e<4;e++)this.addPoint({x:t[2*e],y:t[2*e+1]})}}function tm(t,e){return{minX:t.minX>e.minX?t.minX:e.minX,minY:t.minY>e.minY?t.minY:e.minY,maxX:t.maxX<e.maxX?t.maxX:e.maxX,maxY:t.maxY<e.maxY?t.maxY:e.maxY}}function em(t,e){return{minX:t.minX<e.minX?t.minX:e.minX,minY:t.minY<e.minY?t.minY:e.minY,maxX:t.maxX>e.maxX?t.maxX:e.maxX,maxY:t.maxY>e.maxY?t.maxY:e.maxY}}class im extends Tf{constructor(){super({}),na(this,"name","Document"),na(this,"defaultView",void 0),na(this,"documentElement",void 0),na(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new Tf({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement]}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(t,e){return new(this.defaultView.customElements.get(t))(e)}getElementById(t){return null}getElementsByName(t){return this.documentElement.getElementsByTagName(t)}getElementsByTagName(t){return this.documentElement.getElementsByTagName(t)}getElementsByClassName(t){return this.documentElement.getElementsByClassName(t)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(t){return this.documentElement.querySelector(t)}querySelectorAll(t){return this.documentElement.querySelectorAll(t)}find(t){return this.documentElement.find(t)}findAll(t){return this.documentElement.findAll(t)}appendChild(t){return this.documentElement.appendChild(t)}cloneNode(t){return this.documentElement.cloneNode(t)}insertBefore(t,e){return this.documentElement.insertBefore(t,e)}removeChild(t){return this.documentElement.removeChild(t)}replaceChild(t,e){return this.documentElement.replaceChild(t,e)}destroy(){}}class nm extends qp{constructor(){super(...arguments),na(this,"altKey",void 0),na(this,"button",void 0),na(this,"buttons",void 0),na(this,"ctrlKey",void 0),na(this,"metaKey",void 0),na(this,"shiftKey",void 0),na(this,"relatedTarget",void 0),na(this,"client",new Vg),na(this,"movement",new Vg),na(this,"offset",new Vg),na(this,"page",new Vg),na(this,"screen",new Vg),na(this,"global",new Vg),na(this,"canvas",new Vg)}initEvent(t,e,i){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,o,r,a,l,h,c,d,u,p,g){throw this.initUIEvent(t,i,i,n,s),new Error("initMouseEvent() DOM API is deprecated.")}}function sm(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.setFromPoint(t.client),e.movement.setFromPoint(t.movement),e.offset.setFromPoint(t.offset),e.page.setFromPoint(t.page),e.screen.setFromPoint(t.screen),e.global.setFromPoint(t.global),e.canvas.setFromPoint(t.canvas)}class om extends nm{constructor(){super(...arguments),na(this,"deltaMode",void 0),na(this,"deltaX",void 0),na(this,"deltaY",void 0),na(this,"deltaZ",void 0),na(this,"DOM_DELTA_PIXEL",0),na(this,"DOM_DELTA_LINE",1),na(this,"DOM_DELTA_PAGE",2)}}function rm(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}class am extends nm{constructor(t){super(t),na(this,"height",0),na(this,"isPrimary",void 0),na(this,"pointerId",void 0),na(this,"pointerType",void 0),na(this,"pressure",void 0),na(this,"tangentialPressure",void 0),na(this,"tiltX",void 0),na(this,"tiltY",void 0),na(this,"twist",void 0),na(this,"width",0),na(this,"getCoalescedEvents",void 0),na(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0}}function lm(t,e){e.isPrimary=t.isPrimary,e.width=t.width,e.height=t.height,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.pointerType=t.pointerType,e.pointerId=t.pointerId,e.pressure=t.pressure,e.twist=t.twist,e.tangentialPressure=t.tangentialPressure}class hm{constructor(t,e){na(this,"root",void 0),na(this,"cursor","default"),na(this,"events",void 0),na(this,"trackingData",void 0),na(this,"contextService",void 0),this.root=t,this.contextService=e,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this))}clientToCanvas(t){const e=this.contextService.getBoundingClientRect();return new Vg(t.x-(e.x||0),t.y-(e.y||0))}canvasToClient(t){const e=this.root.defaultView.contextService.getBoundingClientRect();return new Vg(t.x+(e.x||0),t.y+(e.y||0))}getPropagationPath(t){const e=[t];for(;Tf.isNode(t)&&t!==this.root;)t=t.parentNode,e.push(t);return e.reverse()}getHitTarget(t,e){const{root:i}=this,{isInteractive:n}=i,s=um(i,n,new Vg(t,e));return s?s[0]:null}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push({fn:e,order:0}),this.events[t].sort(((t,e)=>t.order-e.order))}emit(t){if(!this.root)return;const e=this.events[t.type]||[];for(let i=0;i<e.length;i++)e[i].fn(t)}onPointerdown(t){if(!(t instanceof am))return;const e=this.generatePointerEvent(t);let i;tg(e,"pointerdown"),"touch"===e.pointerType?i="touchstart":cm(e)&&(i=2===e.button?"rightdown":"mousedown"),tg(e,i),this.getTrackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath()}onPointermove(t){if(!(t instanceof am))return;const e=this.generatePointerEvent(t),i=cm(e),n=this.getTrackingData(t.pointerId),s=dm(n.overTargets);if(s&&s!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",o=this.generatePointerEvent(t,n,s);tg(o,"pointerout"),i&&tg(o,"mouseout");const r=e.composedPath();if(!r.includes(s)){const e=this.generatePointerEvent(t,"pointerleave",s);for(e.eventPhase=e.AT_TARGET;e.target&&!r.includes(e.target);)e.currentTarget=e.target,Qp(e,e.type),i&&Qp(e,"mouseleave"),e.target=e.target.parentNode}}if(s!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",o=this.clonePointerEvent(e,n);tg(o,"pointerover"),i&&tg(o,"mouseover");let r=Tf.isNode(s)&&(null==s?void 0:s.parentNode);for(;r&&r!==(Tf.isNode(this.root)&&this.root.parentNode)&&r!==e.target;)r=r.parentNode;if(!r||r===this.root.parentNode){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==s&&t.target!==this.root.parentNode;)t.currentTarget=t.target,Qp(t,t.type),i&&Qp(t,"mouseenter"),t.target=t.target.parentNode}}var o;tg(e,"pointermove"),"touch"===e.pointerType&&tg(e,"touchmove"),i&&(tg(e,"mousemove"),this.cursor=null===(o=e.target)||void 0===o?void 0:o.cursor),n.overTargets=e.composedPath()}onPointerup(t){if(!(t instanceof am))return;const e=performance.now(),i=this.generatePointerEvent(t);tg(i,"pointerup");const{pointerType:n}=i;let s;"touch"===n?s="touchend":cm(i)&&(s=2===i.button?"rightup":"mouseup"),tg(i,s);const o=this.getTrackingData(t.pointerId),r=dm(o.pressTargetsByButton[t.button]);let a=r;const l=i.composedPath();if(r&&!l.includes(r)){let e=r;for(;e&&!l.includes(e);)i.currentTarget=e,Qp(i,"pointerupoutside"),"touch"===n?s="touchendoutside":cm(i)&&(s=2===i.button?"rightupoutside":"mouseupoutside"),Qp(i,s),e=e.parentNode;delete o.pressTargetsByButton[t.button],a=e}if(a){const r=this.clonePointerEvent(i,"click");r.target=a,r.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const l=o.clicksByButton[t.button];l.target===r.target&&e-l.timeStamp<200?l.clickCount+=1:l.clickCount=1,l.target=r.target,l.timeStamp=e,r.detail=l.clickCount,s="mouse"===n?"click":"touch"===n?"tap":"pointertap",tg(r,s)}}onPointerout(t){if(!(t instanceof am))return;const e=this.getTrackingData(t.pointerId);if(e.overTargets){const i=cm(t),n=dm(e.overTargets),s=this.generatePointerEvent(t,"pointerout",n);tg(s),i&&tg(s,"mouseout");const o=this.generatePointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=o.target,Qp(o,o.type),i&&Qp(o,"mouseleave"),o.target=o.target.parentNode;e.overTargets=null}this.cursor=null}onPointerover(t){if(!(t instanceof am))return;const e=this.getTrackingData(t.pointerId),i=this.generatePointerEvent(t),n=cm(t);var s;tg(i,"pointerover"),n&&tg(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=null===(s=i.target)||void 0===s?void 0:s.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=i.target,Qp(o,o.type),n&&Qp(o,"mouseenter"),o.target=o.target.parentNode;e.overTargets=i.composedPath()}onWheel(t){t instanceof om&&tg(this.generateWheelEvent(t))}generatePointerEvent(t,e,i){const n=new am(this);return lm(t,n),sm(t,n),Zp(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=null!=i?i:this.getHitTarget(n.globalX,n.globalY),n.type=null!=e?e:n.type,n}generateWheelEvent(t){const e=new om(this);return rm(t,e),sm(t,e),Zp(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.getHitTarget(e.globalX,e.globalY),e}clonePointerEvent(t,e){const i=new am(this);return lm(t,i),sm(t,i),Zp(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=t.target,i.path=t.composedPath().slice(),i}getTrackingData(t){return this.trackingData[t]||(this.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[t]}}function cm(t){const{pointerType:e}=t;return"mouse"===e||"pen"===e}function dm(t){if(!t)return null;let e=t[0]||null;for(let i=1,n=t.length;i<n&&t[i].parentNode===e;i++)e=t[i];return e}function um(t,e,i){if(!t||"visible"!==t.style.visibility)return null;const{hitArea:n}=t.style;if(n){const{x:e,y:s}=t.transform.worldTransform.transformPoint(i);if(!n.contains(e,s))return null}const{clipPath:s}=t.style;if(s&&!s.containPoint(i))return null;if(t.isChildrenInteractive&&t.children){const{children:n}=t;for(let s=n.length-1;s>=0;s--){const o=n[s],r=um(o,e||o.isInteractive,i);if(r)return(r.length>0||t.isInteractive)&&r.push(t),r}}return e&&t.containPoint(i)?t.isInteractive?[t]:[]:null}na(class{constructor(){na(this,"canvasConfig",void 0),na(this,"contextService",void 0),na(this,"renderingContext",void 0),na(this,"eventService",void 0),na(this,"rootPointerEvent",new am(null)),na(this,"rootWheelEvent",new om(null)),na(this,"autoPreventDefault",!0)}init(t){const{renderingService:e,renderingContext:i,contextService:n,canvasConfig:s}=t;this.eventService=new hm(i.root.parentNode,n),t.eventService=this.eventService,this.renderingContext=i,this.contextService=n,this.canvasConfig=s,e.hooks.wheel.on(this.onWheel),e.hooks.pointerdown.on(this.onPointerdown),e.hooks.pointermove.on(this.onPointermove),e.hooks.pointerup.on(this.onPointerup),e.hooks.pointerout.on(this.onPointermove),e.hooks.pointerover.on(this.onPointermove)}destroy(){}onWheel(t){const e=this.normalizeWheelEvent(t);this.eventService.emit(e)}onPointerdown(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t);this.autoPreventDefault&&e.isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();const i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor)}onPointermove(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t),i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor)}onPointerup(t){if(this.isTouchEvent(t))return;const e=this.contextService.getDomElement(),i=t.target===e?"":"outside",n=this.normalizeToPointerEvent(t),s=this.bootstrapEvent(n,this.rootPointerEvent);s.type+=i,this.eventService.emit(s),this.setCursor(this.eventService.cursor)}setCursor(t){this.contextService.setCursor(t||this.canvasConfig.cursor||"default")}normalizeWheelEvent(t){const e=this.rootWheelEvent;e.nativeEvent=t,this.transferMouseData(t,e),rm(t,e);const i=new Vg(t.clientX,t.clientY),{x:n,y:s}=this.eventService.clientToCanvas(i);return e.canvas.x=n,e.canvas.y=s,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),Zp(t,e),e}normalizeToPointerEvent(t){const e=this.renderingContext.root.ownerDocument.defaultView;if(e.supportTouchEvent&&t instanceof TouchEvent){const e=t;e.isNormalized=!0,e.pointerType="touch"}else if(!MouseEvent||t instanceof MouseEvent&&(!e.supportPointerEvent||!(t instanceof PointerEvent))){const e=t;e.isPrimary=!0,e.width=1,e.height=1,e.tiltX=0,e.tiltY=0,e.pointerType="mouse",e.pointerId=1,e.pressure=.5,e.twist=0,e.tangentialPressure=0,e.isNormalized=!0}return t}bootstrapEvent(t,e){this.renderingContext.root.ownerDocument.defaultView,e.originalEvent=null,e.nativeEvent=t,lm(t,e),this.transferMouseData(t,e);const{x:i,y:n}=this.eventService.clientToCanvas(new Vg(t.clientX,t.clientY));return e.canvas.x=i,e.canvas.y=n,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),Zp(t,e),"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&e.type.replace("mouse","pointer"),e}transferMouseData(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY}isTouchEvent(t){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===t.pointerType}},"moduleName","Event");class pm extends qp{constructor(t,e,i,n,s,o,r,a){super(null),na(this,"relatedNode",void 0),na(this,"prevValue",void 0),na(this,"newValue",void 0),na(this,"attrName",void 0),na(this,"attrChange",void 0),na(this,"prevParsedValue",void 0),na(this,"newParsedValue",void 0),this.type=t,this.relatedNode=e,this.prevValue=i,this.newValue=n,this.attrName=s,this.attrChange=o,this.prevParsedValue=r,this.newParsedValue=a}}na(pm,"ADDITION",2),na(pm,"MODIFICATION",1),na(pm,"REMOVAL",3);class gm{constructor(t){na(this,"contextService",void 0),na(this,"renderingPlugins",[]),na(this,"config",{autoRendering:!0}),Object.assign(this.config,t)}use(t){this.renderingPlugins.includes(t)||this.renderingPlugins.push(t)}initPlugins(t){this.renderingPlugins.forEach((e=>{e.init(t)}))}destroyPlugins(){this.renderingPlugins.forEach((t=>{t.destroy()}))}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}class fm{constructor(t){na(this,"hooks",{init:su.create(),beginFrame:su.create(),beforeRender:su.create(),render:su.create(),afterRender:su.create(),putImageData:su.create(),endFrame:su.create(),destroy:su.create(),pointerdown:su.create(),pointerup:su.create(),pointermove:su.create(),pointerout:su.create(),pointerover:su.create(),pointerCancel:su.create(),wheel:su.create()}),na(this,"isInited",!1),na(this,"zIndexCounter",0),na(this,"renderingContext",void 0),this.renderingContext=t}init(){this.hooks.init.emit(),this.isInited=!0}destroy(){this.isInited=!1,this.hooks.destroy.emit()}render(){const{root:t}=this.renderingContext;this.zIndexCounter=0,cg.recursiveUpdateHierarchy(t),this.isInited&&(this.renderDisplayObject(t),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear())}renderDisplayObject(t){if(!t.isVisible)return;const{sortable:e}=t;if(e.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),t.imageData)return void this.hooks.putImageData.emit(t);this.hooks.beforeRender.emit(t),this.hooks.render.emit(t),this.hooks.afterRender.emit(t);let i=!1;e.dirty&&(e.sorted=t.childNodes.slice().sort(mm),e.dirty=!1,i=!0);const n=e.sorted||t.childNodes;n.length>1&&n.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),n.forEach((t=>{this.renderDisplayObject(t)})),n.sort(((t,e)=>t.index-e.index)),i&&t.recursiveCall((t=>{const e=new Jp("renderOrderChanged",{renderOrder:t.sortable.renderOrder});t.dispatchEvent(e)}))}dirty(){this.renderingContext.renderCondition.add(0)}}function mm(t,e){const i=Number(t.style.zIndex),n=Number(e.style.zIndex);if(i===n&&t.parentNode){const{childNodes:i=[]}=t.parentNode;return i.indexOf(t)-i.indexOf(e)}return i-n}class vm extends Kp{constructor(t){super(),na(this,"document",void 0),na(this,"customElements",void 0),na(this,"devicePixelRatio",void 0),na(this,"eventService",void 0),na(this,"renderingService",void 0),na(this,"renderingContext",void 0),na(this,"canvasConfig",void 0),na(this,"renderer",void 0),na(this,"supportTouchEvent",void 0),na(this,"supportPointerEvent",void 0),na(this,"limit1px",!1),na(this,"contextService",void 0);const{renderer:e,dpr:i,width:n,height:s,canvas:o,supportPointerEvent:r,supportTouchEvent:a}=t;this.supportPointerEvent=null!=r?r:!!globalThis.PointerEvent,this.supportTouchEvent=null!=a?a:"touchstart"in window;let l=n,h=s,c=i;o&&(c=i||window.devicePixelRatio||1,l=n||o.width/c,h=s||o.height/c),this.canvasConfig={...t,width:l,height:h,dpr:c},this.canvasConfig=t,this.renderer=e,this.document=new im,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new fm(this.renderingContext),this.initRenderer(e)}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",(t=>{this.mountChildren(t.detail.child)})),this.document.documentElement.addEventListener("child-removed",(t=>{this.unmountChildren(t.detail.child)}))}initRenderer(t){this.renderingService.init(),t.initPlugins(this),this.contextService.init(),t.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall((t=>{const{renderable:e}=t;e&&(e.boundsDirty=!0,e.renderBoundsDirty=!0)})),this.mountChildren(this.document.documentElement)}render(){const t=new Jp("beforeRender",{});this.dispatchEvent(t),this.contextService.clearCanvas(),this.renderingService.render()}setDPR(t){this.canvasConfig.dpr=t,this.contextService.setDPR(t)}resize(t,e){this.canvasConfig.width=t,this.canvasConfig.height=e,this.contextService.resize(t,e)}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(t,e){return this.document.documentElement.appendChild(t,e)}insertBefore(t,e){return this.document.documentElement.insertBefore(t,e)}removeChild(t){return this.document.documentElement.removeChild(t)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(t){t.recursiveCall((t=>{if(!t.isConnected){t.isConnected=!0,t.ownerDocument=this.document;const e=new Jp("DOMNodeInsertedIntoDocument",{});t.dispatchEvent(e)}}))}unmountChildren(t){const e=[];t.recursiveCall((t=>{t.isConnected&&e.push(t)})),e.reverse().forEach((t=>{t.isConnected=!1;const e=new Jp("DOMNodeRemovedFromDocument",{});t.dispatchEvent(e),t!==this.document.documentElement&&(t.ownerDocument=null)}))}}class ym{}class xm extends ym{constructor(t){super(),na(this,"close",!0),na(this,"shape",void 0),na(this,"ctx",void 0),na(this,"rCanvas",void 0),this.rCanvas=t}render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Vu(i)&&!i.isNone,r=!Vu(n)&&!n.isNone;this.renderPath(t,e),o&&this.renderFill(t,e),this.renderStrokePath(t,e),r&&this.renderStroke(t,e)}renderPath(t,e){t.getPath(),e.beginPath(),t.steps.forEach((t=>{sf(e,t)})),this.close&&t.steps.length>2&&e.closePath()}renderStrokePath(t,e){$d(null==t?void 0:t.getStrokePath)&&(t.getStrokePath(),0!==t.strokePath.length&&(e.beginPath(),t.strokeSteps.forEach((t=>{sf(e,t)})),this.close&&t.strokeSteps.length>2&&e.closePath()))}renderFill(t,e){const{parsedStyle:i}=t,{background:n,opacity:s,fillOpacity:o,renderBlendMode:r}=i;if(e.save(),e.globalAlpha=s*o,"normal"!==r&&(e.globalCompositeOperation=r),Array.isArray(n)){this.setShapeGradientOrigin(t,e);for(let i=0;i<n.length;i++)0===i&&this.setShadow(t,e),e.fillStyle=this.getColor(t,n[i],e),e.fill()}else this.setShadow(t,e),e.fillStyle=n.formatted,e.fill();e.restore()}renderStroke(t,e){const{parsedStyle:i}=t,{borderWidth:n,borderColor:s,opacity:o,lineCap:r,lineJoin:a,miterLimit:l,lineDash:h,lineDashOffset:c,borderOpacity:d,renderBlendMode:u}=i;if(n&&n.value>0){if(e.save(),!Vu(n)){const i=t.getScale();this.rCanvas.limit1px?e.lineWidth=Math.max(1/i.x,n.value):e.lineWidth=n.value}"normal"!==u&&(e.globalCompositeOperation=u),e.miterLimit=l,e.globalAlpha=o*d,e.lineCap=r,e.lineJoin=a,e.setLineDash(function(t){if(0===t.length)return!0;if(1===t.length)return 0===t[0];t.length%2!=0&&(t=t.concat(t));for(let e=1;e<t.length;e+=2)if(0!==t[e])return!1;return!0}(h)?[0,0]:h),e.lineDashOffset=c.value,Array.isArray(s)?(this.setShapeGradientOrigin(t,e),s.forEach((i=>{e.strokeStyle=this.getColor(t,i,e),e.stroke()}))):(e.strokeStyle=s.formatted,e.stroke()),e.restore()}}setShadow(t,e){const{shadow:i,shadowOffsetX:n,shadowOffsetY:s,shadowBlur:o,shadowColor:r}=t.parsedStyle;(i||r)&&(e.shadowOffsetX=(null==n?void 0:n.value)||i[0],e.shadowOffsetY=(null==s?void 0:s.value)||i[1],e.shadowBlur=(null==o?void 0:o.value)||i[2],e.shadowColor=(null==r?void 0:r.formatted)||i[3])}getColor(t,e,i){let n;if(1===e.type||2===e.type){const s=t.getBoundingRect(),{width:o,height:r}=s;n=function(t,e){const{type:i,steps:n,width:s,height:o,angle:r,cx:a,cy:l,size:h}=t;let c=null;if(1===i){const{x1:t,y1:i,x2:n,y2:a}=function(t,e,i){const n=i*Math.PI/180,s=0+t/2,o=0+e/2,r=Math.abs(t*Math.cos(n))+Math.abs(e*Math.sin(n));return{x1:s-Math.cos(n)*r/2,y1:o-Math.sin(n)*r/2,x2:s+Math.cos(n)*r/2,y2:o+Math.sin(n)*r/2}}(s,o,r.value);c=e.createLinearGradient(t,i,n,a)}else if(2===i){const{x:t,y:i,r:n}=function(t,e,i,n,s){let o=i.value,r=n.value;"%"===i.unit&&(o=i.value/100*t),"%"===n.unit&&(r=n.value/100*e);let a=Math.max(yu({x:0,y:0},{x:o,y:r}),yu({x:0,y:e},{x:o,y:r}),yu({x:t,y:e},{x:o,y:r}),yu({x:t,y:0},{x:o,y:r}));return s&&(Vd(s)?a=s.value:Zd(s)&&("closest-side"===s?a=Math.min(o,t-o,r,e-r):"farthest-side"===s?a=Math.max(o,t-o,r,e-r):"closest-corner"===s&&(a=Math.min(yu({x:0,y:0},{x:o,y:r}),yu({x:0,y:e},{x:o,y:r}),yu({x:t,y:e},{x:o,y:r}),yu({x:t,y:0},{x:o,y:r}))))),{x:o,y:r,r:a}}(s,o,a,l,h);c=e.createRadialGradient(t,i,0,t,i,n)}return c&&n.forEach((t=>{let{offset:e,color:i}=t;var n;"%"===e.unit&&(null===(n=c)||void 0===n||n.addColorStop(e.value/100,i.toString()))})),c}({type:e.type,...e.value,width:o,height:r},i)}return n}setShapeGradientOrigin(t,e){const{type:i}=t.config;switch(i){case"circle":case"arc":{const{r:i}=t.parsedStyle;e.translate(0-i.value,0-i.value);break}case"ellipse":{const{rx:i,ry:n}=t.parsedStyle;e.translate(0-i.value,0-n.value);break}default:e.translate(0,0)}}}class wm extends xm{constructor(){super(),this.close=!1}}class bm extends xm{}class Cm extends xm{}class Sm extends xm{render(t,e){const{width:i,height:n,img:s,opacity:o,visibility:r}=t.parsedStyle;if("hidden"!==r&&!Zd(s)&&s){if(e.save(),e.globalAlpha=o,s instanceof ImageData)e.putImageData(s,0,0);else{e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high");try{e.drawImage(s,0,0,i.value,n.value)}catch(t){}}e.restore()}}}class _m extends xm{constructor(){super(...arguments),na(this,"close",!1)}render(t,e){const{visibility:i}=t.parsedStyle;"hidden"!==i&&(this.renderPath(t,e),this.renderStroke(t,e))}renderPath(t,e){t.getPath(),e.beginPath(),t.inkRenderSteps.forEach((t=>{t.forEach((t=>{sf(e,t)}))}))}}class Tm extends xm{}class Em extends xm{render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Vu(i)&&!i.isNone,r=!Vu(n)&&!n.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const n=t.steps[i];e.beginPath(),n.step.forEach((t=>{sf(e,t)})),n.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e)}}}class Pm extends xm{}class Am extends xm{constructor(){super(...arguments),na(this,"close",!0)}renderPath(t,e){t.getPath(),e.beginPath(),t.steps.forEach((t=>{sf(e,t),t.close&&e.closePath()}))}}class Im extends xm{render(t,e){const{background:i,borderColor:n,visibility:s}=t.parsedStyle;if("hidden"===s)return;const o=!Vu(i)&&!i.isNone,r=!Vu(n)&&!n.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const n=t.steps[i];e.beginPath(),n.step.forEach((t=>{sf(e,t)})),n.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e)}}}class Dm extends xm{render(t,e){const{width:i,height:n,roundedRadius:s,background:o,borderWidth:r,visibility:a}=t.parsedStyle;if("hidden"!==a){for(let t=0;t<4;t++){e.beginPath();const t=s.value;if(0===t)e.rect(0,0,i.value,n.value);else{const{PI:s}=Math;e.arc(t,t,t,s,3*s/2),e.arc(i.value-t,t,t,3*s/2,2*s),e.arc(i.value-t,n.value-t,t,0,s/2),e.arc(t,n.value-t,t,s/2,s)}}e.closePath(),o&&this.renderFill(t,e),r.value>0&&this.renderStroke(t,e)}}}class km extends xm{render(t,e){t&&"hidden"!==t.parsedStyle.visibility&&(this.renderBox(t,e),e.save(),t.renderClipStep&&(e.beginPath(),t.renderClipStep.forEach((t=>{sf(e,t)})),e.closePath(),e.clip()),this.renderText(t,e),e.restore())}renderBox(t,e){const{background:i,borderColor:n}=t.parsedStyle,s="textBox"===t.textType&&!Vu(i)&&!i.isNone,o="textBox"===t.textType&&!Vu(n)&&!n.isNone;this.renderPath(t,e),s&&this.renderFill(t,e),o&&this.renderStroke(t,e)}renderText(t,e){const{parsedStyle:i,lines:n}=t,{opacity:s,y:o,x:r}=i;e.globalAlpha=s,n.forEach((i=>{const n=i.height/30,s=t.getTextAlignOffset(i);i.words.forEach((t=>{const{color:a,fontFamily:l,fontSize:h,fontStyle:c,fontWeight:d,lineThrough:u,underline:p}=t.style;e.fillStyle=a;const g=""===l.trim()?"sans-serif":l;l.includes(" ")?e.font=`${c} ${d} ${h.value}${h.unit} '${g}'`:e.font=`${c} ${d} ${h.value}${h.unit} ${g}`;let f=t.x-r+s;if(function(t){return/[\u0600-\u06FF]/.test(t)}(t.text))e.fillText(t.text,f,i.y-o);else for(let n=0;n<t.text.length;n++){const s=t.text.charAt(n);e.fillText(s,f,i.y-o),f+=e.measureText(s).width}p&&e.fillRect(t.x-r+s,i.y-o+n,t.widthWithoutLf,n),u&&e.fillRect(t.x-r+s,i.y-t.wordHeight/3-o,t.widthWithoutLf,h.value/30)}))}))}}class Rm extends xm{render(t,e){t&&"hidden"!==t.parsedStyle.visibility&&this.renderText(t,e)}renderText(t,e){const{parsedStyle:i}=t;t.setTextFont();const{text:n,font:s,opacity:o,color:r,y:a}=i;e.save(),e.globalAlpha=o,e.font=s,e.fillStyle=r.formatted,e.textBaseline="alphabetic",e.fillText(n,0,0),e.restore()}}class Mm{constructor(t){na(this,"canvasConfig",void 0),na(this,"container",void 0),na(this,"canvas",void 0),na(this,"dpr",void 0),na(this,"context",void 0),na(this,"shapeRenderers",{}),this.canvasConfig=t}init(){const{container:t,canvas:e,dpr:i,willReadFrequently:n}=this.canvasConfig;if(e){this.canvas=e;const{parentElement:i}=e;t&&i!==t&&t.appendChild(e),this.container=i,this.canvasConfig.container=i}else if(t&&(this.container=t,Zd(t)&&(this.container=document.getElementById(t)),this.container)){const t=document.createElement("canvas");this.container.appendChild(t),this.canvas=t}this.context=this.canvas.getContext("2d",{willReadFrequently:n}),this.dpr=i||Pu(),this.resize(this.canvasConfig.width,this.canvasConfig.height)}registerShapeRenderer(t,e){this.shapeRenderers[t]||(this.shapeRenderers[t]=e)}getShapeRenderer(t){return this.shapeRenderers[t]}destroy(){const{canvas:t,container:e}=this;e&&null!=t&&t.parentNode&&e.removeChild(t)}resize(t,e){const{canvas:i,dpr:n}=this;i&&(i.width=t*n,i.height=e*n,this.context.scale(n,n))}getDPR(){return this.dpr}setDPR(t){this.canvasConfig.dpr=t,this.dpr=t}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(t){var e;null!=this&&null!==(e=this.container)&&void 0!==e&&e.style&&(this.container.style.cursor=t)}getBoundingClientRect(){var t;return null===(t=this.canvas)||void 0===t?void 0:t.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr))}}class Lm{constructor(){na(this,"restoreStack",[])}init(t){const{hooks:e}=t.renderingService;e.endFrame.on((()=>{const{contextService:e}=t,i=e.getContext();this.restoreStack.forEach((()=>{i.restore()})),this.restoreStack=[]})),e.render.on((e=>{this.renderDisplayObject(e,t)})),e.putImageData.on((e=>{if(e.imageData){const{x:i,y:n}=e.getPosition(),s=t.contextService.getContext(),o=t.contextService.getDPR();s.putImageData(e.imageData,Math.floor(i*o+.5),Math.floor(n*o+.5))}}))}renderDisplayObject(t,e){if(!t.isVisible)return;const{contextService:i}=e,n=i.getContext();let s=this.restoreStack[this.restoreStack.length-1];for(;s&&t.parentNode!==s;)n.restore(),this.restoreStack.pop(),s=this.restoreStack[this.restoreStack.length-1];n.save(),this.applyTransform(n,t);const{clipPath:o}=t.style;o&&(n.save(),this.applyTransform(n,o),n.restore(),n.clip()),this.useAnchor(n,t);const r=i.getShapeRenderer(t.shapeType);r&&(r.render(t,n),t.clippable&&n.clip()),this.restoreStack.push(t)}applyTransform(t,e){e.externalMatrices.length&&e.externalMatrices.slice().reverse().forEach((e=>{const{a:i,b:n,c:s,d:o,e:r,f:a}=e;t.transform(i,n,s,o,r,a)}));const i=e.getLocalTransform(),{a:n,b:s,c:o,d:r,e:a,f:l}=i;t.transform(n,s,o,r,a,l)}applyAttributes(t,e,i){}useAnchor(t,e){const{anchor:i}=e.parsedStyle||{};if(!i||0===i[0]&&0===i[1])return;const n=e.getGeometryBounds().getRect();t.translate(-(i&&i[0]||0)*n.width,-(i&&i[1]||0)*n.height)}destroy(){}}na(Lm,"moduleName",void 0);class Om{init(t){const e=new Mm(t.canvasConfig);t.contextService=e,[{name:"arc",renderer:new wm},{name:"circle",renderer:new bm(t)},{name:"ellipse",renderer:new Cm(t)},{name:"line",renderer:new Im(t)},{name:"image",renderer:new Sm(t)},{name:"ink",renderer:new _m(t)},{name:"polygon",renderer:new Tm(t)},{name:"polyline",renderer:new Em(t)},{name:"rect",renderer:new Pm(t)},{name:"stampText",renderer:new Rm(t)},{name:"stampPath",renderer:new Am(t)},{name:"roundedRect",renderer:new Dm(t)},{name:"freeText",renderer:new km(t)}].forEach((t=>{let{name:i,renderer:n}=t;e.registerShapeRenderer(i,n)}))}destroy(){}}class Bm extends gm{constructor(t){super(t),this.use(new Om),this.use(new Lm)}}function Fm(t,e,i){const n=e.x-t.x,s=e.y-t.y,o=i.x-t.x,r=n*(i.y-t.y)-s*o,a=cu(t,e),l=cu(t,i);let h=(a**2+l**2-cu(e,i)**2)/(2*a*l);h<-1&&(h=-1),h>1&&(h=1);let c=180*Math.acos(h)/Math.PI;return c=Math.round(100*c)/100,r<0?-c:c}function Nm(t,e,i){const n=sg.fromTwoPoint(e,t);return sg.fromTwoPoint(e,i).angle(n)>Math.PI/2}function Um(t,e){return(e=t.getWorldTransform().inverse().transformPoint(e)).x+=t.parsedStyle.x,e.y+=t.parsedStyle.y,e}function Vm(t){if(!t)return!1;const{shapeType:e}=t;return"annotationRect"===e||"annotationFreeText"===e&&"textBox"===t.textType||"annotationStamp"===e&&"image"===t.renderType}function Wm(t){return!!t&&("annotationPolyline"===t.shapeType||"annotationPolygon"===t.shapeType||"annotationLine"===t.shapeType)}function Hm(t){return!!t&&("annotationFreeText"===t.shapeType||"annotationTextBox"===t.shapeType)}function jm(t,e){return t.x*e.x+t.y*e.y}function zm(t,e){const i=window.TouchEvent&&e instanceof TouchEvent?e.targetTouches[0]:e,n=t.getBoundingClientRect();return{offsetX:i.pageX-window.scrollX-n.left,offsetY:i.pageY-window.scrollY-n.top}}function Gm(t){let e,i;if(t.controls){const{width:n,height:s}=t.controls.getLength();e=n,i=s}else{const{x:n,y:s}=t.getScale(),{width:o,height:r}=t.getBoundingRect();e=o*n,i=r*s}return{width:e,height:i}}function Ym(t){return/^[\r\n]+$/.test(t)}function $m(t,e,i){return t.slice(0,e)+t.slice(i+1)}function Xm(t,e){const{textContents:i}=t.style,n=[];return i.forEach((t=>{n.push({...t,...e})})),n}function qm(t,e){const{textContents:i}=t.style,{textSelection:n}=t.textEditEventHandler;if(!n.length)return i;const[s,o]=n,r=s.freeContentIndex,a=o.freeContentIndex,l=i.slice(0,r),h=i.slice(r,a+1),c=i.slice(a+1),d=[];if(s.freeContentIndex===o.freeContentIndex){const{content:t}=h[0],i=t.slice(0,s.indexInFreeContent),n=t.slice(s.indexInFreeContent,o.indexInFreeContent+1),r=t.slice(o.indexInFreeContent+1);i&&d.push({...h[0],content:i}),n&&d.push({...h[0],...e,content:n}),r&&d.push({...h[0],content:r})}else for(let t=0;t<h.length;t++){const i=h[t];0===t?(d.push({...i,content:i.content.slice(0,s.indexInFreeContent)}),d.push({...i,...e,content:i.content.slice(s.indexInFreeContent)})):t===h.length-1?(d.push({...i,...e,content:i.content.slice(0,o.indexInFreeContent+1)}),d.push({...i,content:i.content.slice(o.indexInFreeContent+1)})):d.push({...i,...e})}return[...l,...d,...c]}function Zm(t){if(!t)return!1;let e=t,i="visible"===e.parsedStyle.visibility;for(;e;)e.parsedStyle.visibility&&"hidden"===e.parsedStyle.visibility&&(i=!1),e=e.parentNode;return i}var Jm;!function(t){t.REJECTED="SBRejected",t.ACCEPTED="SHAccepted",t.INITIAL_HERE="SHInitialHere",t.SIGN_HERE="SHSignHere",t.WITNESS="SHWitness",t.APPROVED="SBApproved",t.NOT_APPROVED="SBNotApproved",t.DRAFT="SBDraft",t.FINAL="SBFinal",t.COMPLETED="SBCompleted",t.CONFIDENTIAL="SBConfidential",t.VOID="SBVoid"}(Jm||(Jm={}));const Km={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},Qm={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},tv={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:Jm.DRAFT,imageData:null,textAlign:"left",textContent:{...Qm}},ev={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},iv={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,enableDeleteWithKeyboard:!0,enableMoveWithKeyboard:!0,enableMultipleSelectWidthCtrl:!0,inkCreateDelay:3e3,controlsStyle:Km,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class nv{constructor(t){na(this,"shape",void 0),na(this,"startTime",void 0),na(this,"startPoint",void 0),na(this,"lastPoint",void 0),na(this,"limitPosition",void 0),na(this,"limitAngle",void 0),na(this,"unLimitPosition",void 0),na(this,"unLimitScale",void 0),na(this,"unLimitStyle",void 0),na(this,"limitArea",void 0),this.shape=t}setLimitArea(t){this.limitArea=t}updateShapeByLimitArea(){const{shapeType:t}=this.shape,{left:e,right:i,top:n,bottom:s}=this.isOutOfLimitArea(1,1),o=e||i||n||s,r=Vm(this.shape)||"annotationEllipse"===t;o?(r?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(r&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone())}getShapeOriginPosition(){const{x:t,y:e,width:i,height:n}=this.shape.getBoundingRect(),s=new Af({style:{x:t-this.shape.style.x+i/2,y:e-this.shape.style.y+n/2}});this.shape.appendChild(s);const{x:o,y:r}=s.getPosition();return s.destroy(),{x:o,y:r}}getShapeControlPointPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertexes";const{x:e,y:i,width:n,height:s}=this.shape.getBoundingRect(),o=[];for(let r=0;r<4;r++){let a=e-this.shape.style.x,l=i-this.shape.style.y;if("vertexes"===t)switch(r){case 1:a+=n;break;case 2:a+=n,l+=s;break;case 3:l+=s}else switch(r){case 1:a+=n,l+=s/2;break;case 2:a+=n/2,l+=s;break;case 3:l+=s/2;break;default:a+=n/2}const h=new Af({style:{x:a,y:l}});this.shape.appendChild(h);const{x:c,y:d}=h.getPosition();o.push({x:c,y:d}),h.destroy()}return o}isOutOfLimitArea(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.limitArea)return{left:!1,right:!1,top:!1,bottom:!1};const{x:n,y:s,width:o,height:r}=this.limitArea,a=i||this.getShapeControlPointPosition();let l=!1,h=!1,c=!1,d=!1;for(let i=0;i<4;i++){const{x:u,y:p}=a[i];l=u<n-t||l,h=u>n+o+t||h,c=p<s-e||c,d=p>s+r+e||d}return{left:l,right:h,top:c,bottom:d}}getLimitPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.limitArea)return null;const e=t||this.getShapeControlPointPosition(),{x:i,y:n}=e[0],{x:s,y:o,width:r,height:a}=this.limitArea,l=e[1].x-i,h=e[2].x-i,c=e[3].x-i,d=e[1].y-n,u=e[2].y-n,p=e[3].y-n;let g=s-Math.min(l,h,c),f=s+r-Math.max(l,h,c),m=o-Math.min(d,u,p),v=o+a-Math.max(d,u,p);if(l>=0&&h>=0&&c>=0?g=s:l<=0&&h<=0&&c<=0&&(f=s+r),d>=0&&u>=0&&p>=0?m=o:d<=0&&u<=0&&p<=0&&(v=o+a),(y=this.shape)&&("annotationEllipse"===y.shapeType||"annotationCircle"===y.shapeType)){const{x:t,y:e}=this.getShapeOriginPosition(),s=t-i,o=e-n;g+=s,f+=s,m+=o,v+=o}var y;return{minPosX:g,maxPosX:f,minPosY:m,maxPosY:v}}getLimitRotateAngle(){if(!this.limitArea)return[];const t=function(t,e){const i=t,[n,s,o,r]=i,{x:a,y:l,width:h,height:c}=e,d=a+h,u=l+c,p=(n.x+s.x+o.x+r.x)/4,g=(n.y+s.y+o.y+r.y)/4,f=Math.sqrt((p-n.x)**2+(g-n.y)**2),m=p-f,v=p+f,y=g-f,x=g+f;if(m>a&&y>l&&v<d&&x<u)return[];const w=t=>{const e=f*f-(t-p)**2;return[{x:t,y:g-Math.sqrt(e)},{x:t,y:g+Math.sqrt(e)}]},b=t=>{const e=f*f-(t-g)**2;return[{x:p-Math.sqrt(e),y:t},{x:p+Math.sqrt(e),y:t}]},C=(e,i)=>{const n=[];return e.forEach((e=>{t.forEach((t=>{let s=Fm({x:p,y:g},t,e);0===s&&(s=p>t.x?g>t.y?-0:0:g>t.y?0:-0,"top"!==i&&"bottom"!==i||(s=-s)),n.push(s)}))})),n},S=[];if(m<a){const t=w(a);S.push(...C(t,"left"))}if(y<l){const t=b(l);S.push(...C(t,"top"))}if(v>d){const t=w(d);S.push(...C(t,"right"))}if(x>u){const t=b(u);S.push(...C(t,"bottom"))}return S}(this.getShapeControlPointPosition(),this.limitArea);if(0===t.length)return[];let e=0;if(t.forEach((t=>{0===t&&e++})),e>=2)return[0,0];const{maxNegative:i,minPositive:n}=function(t){let e=-1/0,i=1/0;for(let n=0;n<t.length;n++)t[n]<0&&t[n]>e||Object.is(t[n],-0)?e=t[n]:(t[n]>0&&t[n]<i||Object.is(t[n],0))&&(i=t[n]);return e===-1/0&&(e=0),i===1/0&&(i=0),{maxNegative:e,minPositive:i}}(t);return[i,n]}moveByKeyboard(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const{shape:i}=this,{controlsFlags:n}=i.context;if(!n.enableMove)return!1;t.preventDefault();let s=0,o=0;const r=Math.max(1,Math.round(e*(Ru(t)?8:1)));switch(t.key){case"ArrowLeft":s=-r;break;case"ArrowRight":s=r;break;case"ArrowUp":o=-r;break;case"ArrowDown":o=r}const a=i.getPosition();let l=a.x+s,h=a.y+o;const{left:c,right:d,top:u,bottom:p}=this.isOutOfLimitArea(1,1),g=c||d||u||p,f=this.getLimitPosition();if(f&&!g){const{minPosX:t,maxPosX:e,minPosY:i,maxPosY:n}=f;l<t&&(l=t),l>e&&(l=e),h<i&&(h=i),h>n&&(h=n)}return this.shape.setPosition({x:l,y:h}),Wm(i)&&i.pointEventsHandler.updateLineControls(),!0}moveShape(t){const{shape:e,startPoint:i}=this,{lastWorldPosition:n,controlsFlags:s}=e.context;if(!s.enableMove)return;if(new Vg(t.x,t.y).distanceTo(i)<0)return;const o=t.x-i.x,r=t.y-i.y;let a=n.x+o,l=n.y+r;const{left:h,right:c,top:d,bottom:u}=this.isOutOfLimitArea(1,1),p=h||c||d||u;if(this.limitPosition&&!p){const{minPosX:t,maxPosX:e,minPosY:i,maxPosY:n}=this.limitPosition;a<t&&(a=t),a>e&&(a=e),l<i&&(l=i),l>n&&(l=n)}this.shape.setPosition({x:a,y:l})}moveVertex(t){const{shape:e}=this,{context:i,shapeType:n}=e,{hitControlPoint:s,lastLocalScale:o,lastControlsWidth:r,lastControlsHeight:a,keepAspectRatio:l,lastHitControlPoint:h,lastShareAxisYPoint:c,lastShareAxisXPoint:d,lastLocalTransform:u}=i,p=Wg(h,d,t).distanceTo(d)||1;if(Nm(h,d,t))return;let g=p-r,f=p/r;const m=Wg(h,c,t).distanceTo(c)||1;if(Nm(h,c,t))return;let v=m-a,y=m/a;l&&(f<=y?(y=f,v=y*a-a):(f=y,g=f*r-r));const{left:x,right:w,top:b,bottom:C}=this.isOutOfLimitArea(1,1),S=x||w||b||C,_="annotationEllipse"===n;if(Vm(e))this.moveRectVertex(s,g,v);else if(_)this.moveEllipseVertex(s,g,v);else{s<2&&(v=-v),0!==s&&3!==s||(g=-g),e.setLocalTransform(u);const{x:t,y:i}=e.getScale();g/=Math.abs(t),v/=Math.abs(i),e.translateLocal(g/2,v/2),e.setLocalScale(f*o.x,y*o.y)}S||0===e.getAngle()||this.updateShapeByLimitArea(),e.context.updateControls()}moveEllipseVertex(t,e,i){const{shape:n}=this,{x:s,y:o}=n.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastLocalTransform:l}=this.shape.context;e/=Math.abs(s),i/=Math.abs(o),n.style.rx=Math.max(1,(r+e)/2),n.style.ry=Math.max(1,(a+i)/2),t<2&&(i=-i),0!==t&&3!==t||(e=-e),n.setLocalTransform(l),n.translateLocal(e/2,i/2)}moveRectVertex(t,e,i){const{shape:n}=this,{x:s,y:o}=n.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastWorldPosition:l,lastLocalTransform:h}=this.shape.context;if(e/=Math.abs(s),i/=Math.abs(o),n.style.width=Math.max(r+e,1),n.style.height=Math.max(a+i,1),2===t)n.setPosition(l);else switch(n.setLocalTransform(h),t){case 1:n.translateLocal(0,-i);break;case 3:n.translateLocal(-e,0);break;default:n.translateLocal(-e,-i)}}moveMidpoints(t){const{shape:e}=this,{context:i,shapeType:n}=e,{lastLocalScale:s,lastWorldTransform:o,lastHitControlPoint:r,lastShareAxisPoint:a,hitControlPoint:l,lastWorldPosition:h,lastControlsWidth:c,lastControlsHeight:d,lastHitControlPointCenter:u,lastParentWorldAngle:p}=i,g=l-4,f=Wg(r,a,t).distanceTo(a);if(Nm(r,a,t))return;const m="annotationEllipse"===n,v=f/c*s.x,y=f/d*s.y,{left:x,right:w,top:b,bottom:C}=this.isOutOfLimitArea(1,1),S=x||w||b||C,_={x:t.x-(r.x-u.x),y:t.y-(r.y-u.y)};if(Vm(e))this.moveRectMidPoint(g,_);else if(m)this.moveEllipseMidPoint(g,_);else{const t=o.inverse(),i=t.transformPoint(_),n=t.transformPoint(h),r={...s};0===g?(r.y=y,90===p?n.x=i.x:n.y=i.y):1===g?r.x=v:2===g?r.y=y:3===g&&(r.x=v,90===p?n.y=i.y:n.x=i.x),this.shape.setLocalScale(r);const a=o.transformPoint(n);e.setPosition(a)}S||0===e.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls()}moveRectMidPoint(t,e){const{shape:i}=this,{lastShapeHeight:n,lastWorldPosition:s,lastShapeWidth:o}=i.context,r=i.getWorldTransform(),a=r.inverse().transformPoint(e),l=r.inverse().transformPoint(s),h=l;0===t?(i.style.height=n-(a.y-l.y),h.y=a.y):1===t?i.style.width=Math.max(1,a.x-l.x):2===t?i.style.height=Math.max(1,a.y-l.y):3===t&&(i.style.width=o-(a.x-l.x),h.x=a.x);const c=r.transformPoint(h);i.setPosition(c)}moveEllipseMidPoint(t,e){const{shape:i}=this,{lastShapeHeight:n,lastShapeWidth:s,lastWorldPosition:o}=i.context,r=i.getWorldTransform(),a=r.inverse().transformPoint(e),l=r.inverse().transformPoint(o),h=l;if(0===t){const t=(n/2-(a.y-l.y))/2;i.style.ry=t,h.y=a.y+t}else if(1===t){const t=(s/2+(a.x-l.x))/2;i.style.rx=t,h.x=a.x-t}else if(2===t){const t=(n/2+(a.y-l.y))/2;i.style.ry=t,h.y=a.y-t}else if(3===t){const t=(s/2-(a.x-l.x))/2;i.style.rx=t,h.x=a.x+t}const c=r.transformPoint(h);i.setPosition(c)}moveRotationPoint(t){const{startPoint:e,shape:i}=this,{lastOriginWorldPosition:n,lastLocalTransform:s}=i.context,o=Fm(n,e,t);this.shape.setLocalTransform(s),this.shape.rotateLocal(o)}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:i}=this,{context:n,parsedStyle:s}=i;if("hidden"===s.visibility||!n.controlsFlags.enableControl)return-1;if(n.isGrouped)return n.unHitShape(),-1;let{controls:o}=i,r=!0;o||(r=!1,n.initControls(),n.renderControls(),o=i.controls);let a=o.checkHitArea(t.x,t.y);return Wm(i)&&!i.context.controlsFlags.useDefaultControls&&(8===a?a=-1:a>0&&(a=9),-1!==i.pointEventsHandler.isHitPoint(t)&&(a=0)),a<0?(e&&(n.unHitShape(),r||i.context.destroyControls()),-1):a}startHandler(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.isHit(t);if(-1===i&&!e)return;-1===i&&e&&(i=9);const{shape:n}=this,{context:s}=n;s.isStart=!0,this.lastPoint={...t},this.startPoint={...t},this.startTime=(new Date).getTime(),Wm(n)&&(n.pointEventsHandler.enableEditMode(),n.pointEventsHandler.editStartHandler(t)),Hm(n)&&n.textEditEventHandler.editStartHandler(t);const o=this.getShapeControlPointPosition();if(this.limitPosition=this.getLimitPosition(o),s.controlsFlags.useDefaultControls){if(s.hitShape(),s.hitControlPoint=i,i<4){const{x:e,y:n}=o[i];s.lastHitControlPoint={...t},s.lastHitControlPointCenter={x:e,y:n},s.lastShareAxisYPoint={x:o[3-i].x+t.x-e,y:o[3-i].y+t.y-n},s.lastShareAxisXPoint={x:o[i%2?i-1:i+1].x+t.x-e,y:o[i%2?i-1:i+1].y+t.y-n}}else if(i<8){const e=this.getShapeControlPointPosition("mid"),{x:n,y:o}=e[i-4];s.lastHitControlPoint={...t},s.lastHitControlPointCenter={x:n,y:o},s.lastShareAxisPoint={x:e[(i-2)%4].x+t.x-n,y:e[(i-2)%4].y+t.y-o}}}else s.isHit=!0,s.hitControlPoint=9,s.lastWorldPosition=n.getPosition(),s.lastControlsWorldPosition=n.controls.getPosition()}moveHandler(t,e){const{shape:i}=this,{context:n,controls:s}=i,{isHit:o,isStart:r,hitControlPoint:a}=n,l=Wm(i),h=Hm(i);o&&r&&s&&(this.lastPoint={...t},l&&-1!==i.pointEventsHandler.hitIndex?i.pointEventsHandler.editMoveHandler(t):h&&i.textEditEventHandler.editMode?i.textEditEventHandler.editMoveHandler(t):a<4?(n.keepAspectRatio=e,this.moveVertex(t)):a<8?this.moveMidpoints(t):a<9?this.moveRotationPoint(t):(this.moveShape(t),l&&i.pointEventsHandler.updateLineControls()))}endHandler(t){const{shape:e,startPoint:i,lastPoint:n}=this,{context:s}=e,{isStart:o,isHit:r}=e.context;if(!o||!r)return;const a=(new Date).getTime()-this.startTime,l=n.x-i.x,h=n.y-i.y,c=a<=200&&(l**2+h**2)**.5<2,d=Wm(e),u=Hm(e);if(d&&e.pointEventsHandler.editEndHandler(),u&&e.textEditEventHandler.editEndHandler(),!s.isActive&&c&&(s.isActive=!0),t){if(u&&e.textEditEventHandler.editMode)return void(s.hitControlPoint=-1);const i=[];if(8===s.hitControlPoint&&this.shape.getAngle()!==(null==s?void 0:s.lastWorldAngle))i.push("rotated");else{const{lastControlsWorldPosition:t,lastControlsWidth:n,lastControlsHeight:o,lastWorldPosition:r}=s,{width:a,height:l}=e.controls.getLength(),h=e.controls.getPosition(),c=e.getPosition(),u=e instanceof lv?t:r,p=e instanceof lv?h:c;p.x.toFixed(1)===u.x.toFixed(1)&&p.y.toFixed(1)===u.y.toFixed(1)||i.push("moved");const g=d&&-1!==e.pointEventsHandler.hitIndex,f=!(!n||!o||a.toFixed(3)===n.toFixed(3)&&l.toFixed(3)===o.toFixed(3));if(!(e instanceof fv))if(f)i.push("resized");else if(g){const{hitIndex:t,hitPointPos:n}=e.pointEventsHandler,s=e.path[t];s.x.toFixed(2)===n.x.toFixed(2)&&s.y.toFixed(2)===n.y.toFixed(2)||i.push("resized")}}const n=[...new Set(i)];n.length&&t.emitModifyAnnotation(n,[e])}s.isHit=!1,s.keepAspectRatio=!1}}class sv extends Tf{constructor(t,e){super({type:"annotationGroup",style:{visibility:"visible"}}),na(this,"shapeType","annotationControls"),na(this,"container",void 0),na(this,"borders",void 0),na(this,"rotationPoint",void 0),na(this,"controlPoints",void 0),na(this,"rotationBorder",void 0),na(this,"rotationPointOffset",30),na(this,"vertexes",[]),na(this,"midpoints",[]),this.container=t;for(const t in e)Wu(t,e)&&(this[t]=e[t]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls()}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&Zm(null==this?void 0:this.container)}initBorders(){const{borderColor:t,borderWidth:e,lineDash:i,background:n}=this.container.context.parsedControlsStyle,{width:s}=this.container.getBoundingRect(),o=e/2;this.borders=new Bf({style:{points:this.vertexes,borderWidth:e,background:n,borderColor:t,lineDash:i}}),this.borders.setLocalPosition(-o,-o),this.rotationBorder=new Bf({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:e,borderColor:t,lineDash:i}});const r=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(s/2-o,-r),this.appendChild(this.borders),this.appendChild(this.rotationBorder)}initControls(){const{vertexes:t,midpoints:e,rotationPoint:i}=this,{ctrlBorderColor:n,ctrlBorderWidth:s,ctrlLineDash:o,ctrlBackground:r,ctrlWidth:a,ctrlHeight:l,ctrlBorderRadius:h}=this.container.context.parsedControlsStyle,{x:c,y:d}=this.container.getBoundingRect(),u=[...t,...e,i],p={background:r,borderColor:n,borderWidth:s,lineDash:o,width:a,height:l,roundedRadius:h};u.forEach((t=>{const e=new jf({style:{x:t.x,y:t.y,...p}});e.setLocalPosition(t.x-mg(a).value/2-c,t.y-mg(l).value/2-d),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(e),this.appendChild(e)}))}calculateMidpoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=new Vg((t[i].x+t[(i+1)%n].x)/2,(t[i].y+t[(i+1)%n].y)/2);e.push(s)}return e}calculateRotationPoint(t){const e=t[0].distanceTo(t[2]),i=this.rotationPointOffset/e+1;return t[2].lerpTo(t[0],i)}update(t){const{midpoints:e,rotationPoint:i,container:n}=this,{ctrlWidth:s,ctrlHeight:o,borderWidth:r}=this.container.context.parsedControlsStyle,a=[...t,...e,i],{x:l,y:h,width:c,height:d}=n.getBoundingRect(),u=r/2;this.controlPoints.forEach(((t,e)=>{const{x:i,y:n}=a[e];t.updateStyle({x:i,y:n}),t.setLocalPosition(i-s/2-l,n-o/2-h)})),this.borders.updateStyle({points:t}),this.borders.setLocalPosition(c<0?c:-u,d<0?d:-u);const p=Math.min(e[0].x,i.x),g=Math.min(e[0].y,i.y);this.rotationBorder.updateStyle({points:[e[0],i]}),this.rotationBorder.setLocalPosition(p-l-u,g-h)}updateOrigin(){const t=this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,e=this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y;this.setOrigin(t,e)}updateControlPoints(t){this.vertexes=t,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints)}getLength(){const t=this.midpoints[2].y-this.midpoints[0].y;return{width:this.midpoints[1].x-this.midpoints[3].x,height:t}}setVisible(t){this.style.visibility=t}setBoxVisible(t){this.borders.style.visibility=t}setRotationPointVisible(t){this.rotationBorder.style.visibility=t,this.controlPoints[8].style.visibility=t}setControlPointVisible(t){this.controlPoints.forEach(((e,i)=>{i<8&&(e.style.visibility=t)}))}checkHitArea(t,e){const i=this.getWorldTransform().inverse().transformPoint({x:t,y:e}),{x:n,y:s}=this.controlPoints[0].parsedStyle,o={x:i.x+n,y:i.y+s},{ctrlWidth:r,ctrlHeight:a}=this.container.context.parsedControlsStyle;i.x+=n+r/2,i.y+=s+a/2;const l=Xd()?10:0;let h=-1;for(let t=0;t<this.controlPoints.length;t++){const e=this.controlPoints[t];if("visible"===e.style.visibility&&e.isPointInPath({x:i.x,y:i.y},l)){h=t;break}}return h>-1?h:this.borders.isPointInPath(o)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null)}}class ov{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};na(this,"shape",void 0),na(this,"referencePoint",void 0),na(this,"controlsStyle",void 0),na(this,"controlsFlags",void 0),na(this,"parsedControlsStyle",void 0),na(this,"tempData",{}),na(this,"keepAspectRatio",!1),na(this,"isInGroup",!1),na(this,"isGrouped",!1),na(this,"isActive",!1),na(this,"isStart",!1),na(this,"isHit",!1),na(this,"hitControlPoint",-1),na(this,"lastHitControlPoint",void 0),na(this,"lastHitControlPointCenter",void 0),na(this,"lastLocalTransform",void 0),na(this,"lastWorldTransform",void 0),na(this,"lastWorldPosition",void 0),na(this,"lastLocalScale",void 0),na(this,"lastOriginWorldPosition",void 0),na(this,"lastWorldAngle",void 0),na(this,"lastParentWorldAngle",void 0),na(this,"lastControlsWorldPosition",void 0),na(this,"lastControlsWidth",void 0),na(this,"lastControlsHeight",void 0),na(this,"lastShareAxisPoint",void 0),na(this,"lastShareAxisXPoint",void 0),na(this,"lastShareAxisYPoint",void 0),na(this,"lastShapeWidth",void 0),na(this,"lastShapeHeight",void 0),this.shape=t,this.controlsStyle={...Km,...e},this.controlsFlags={...ev},this.parseControlsStyle()}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,n=e-this.shape.style.y,s=new Af({style:{x:i,y:n,r:0}});this.shape.appendChild(s),this.referencePoint=s}updateReferenceBox(){if(!this.referencePoint)return;const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,n=e-this.shape.style.y;this.referencePoint.updateStyle({x:i,y:n})}getControlVertexes(){const{shape:t}=this,{x:e,y:i,width:n,height:s}=t.getBoundingRect();return[new Vg(e,i),new Vg(e+n,i),new Vg(e+n,i+s),new Vg(e,i+s)]}getScaledControlVertexes(){const{shape:t}=this,{x:e,y:i}=t.getScale(),{x:n,y:s,width:o,height:r}=t.getBoundingRect(),a=o*Math.abs(e)||1,l=r*Math.abs(i)||1;return[new Vg(n,s),new Vg(n+a,s),new Vg(n+a,s+l),new Vg(n,s+l)]}showControls(){this.initReferenceBox();const{shape:t,referencePoint:e}=this,{x:i,y:n}=e.getPosition(),s=t.getAngle(),o=i,r=n;t.controls.setAngle(s),t.controls.setPosition({x:o,y:r})}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:t,border:e,ctrlWidth:i,ctrlHeight:n,ctrlBackground:s,ctrlBorderRadius:o,ctrlBorder:r}=this.controlsStyle,a=e||Km.border,{borderColor:l,borderStyle:h,borderWidth:c}=Au(a),d=mg(c).value,u=r||Km.ctrlBorder,{borderColor:p,borderStyle:g,borderWidth:f}=Au(u),m=mg(f).value,v=mg(i).value,y=vg(o),x="%"===y.unit?y.value/100*v:o||Km.ctrlBorderRadius;this.parsedControlsStyle={background:t||Km.background,ctrlBackground:s||Km.ctrlBackground,ctrlBorderRadius:x,borderColor:l,borderWidth:d,lineDash:"solid"===h?[0,0]:[2*d,d],ctrlWidth:v,ctrlHeight:mg(n).value,ctrlBorderColor:p,ctrlBorderWidth:m,ctrlLineDash:"solid"===g?[0,0]:[2*m,m]}}updateControlsFlags(t){const{enableEdit:e,enableRotate:i,enableControl:n,isVisible:s}=t;this.shape.controls&&(Yd(e)&&this.shape.controls.setControlPointVisible(e?"visible":"hidden"),Yd(i)&&this.shape.controls.setRotationPointVisible(i?"visible":"hidden"),Yd(n)&&!n&&this.destroyControls()),Yd(s)&&(this.shape.style.visibility=s?"visible":"hidden"),this.controlsFlags={...this.controlsFlags,...t}}hitShape(){var t;const{shape:e}=this,{shapeType:i,controls:n}=e;this.isHit=!0,this.lastWorldPosition=e.getPosition(),this.lastLocalTransform=e.getLocalTransform(),this.lastWorldTransform=e.getLocalTransform(),this.lastLocalScale=e.getLocalScale(),this.lastControlsWorldPosition=n.getPosition(),this.lastControlsWidth=n.getLength().width,this.lastControlsHeight=n.getLength().height;const s=e.getBoundingRect();this.lastParentWorldAngle=Math.round(Math.abs(null==e||null===(t=e.parentNode)||void 0===t?void 0:t.getAngle())),this.lastWorldAngle=e.getAngle(),this.lastOriginWorldPosition=e.getWorldTransform().transformPoint({x:s.x-e.style.x+s.width/2,y:s.y-e.style.y+s.height/2}),"annotationEllipse"===i&&(this.lastShapeWidth=2*e.parsedStyle.rx.value,this.lastShapeHeight=2*e.parsedStyle.ry.value),Vm(this.shape)&&(this.lastShapeWidth=e.parsedStyle.width.value,this.lastShapeHeight=e.parsedStyle.height.value)}unHitShape(){const{context:t}=this.shape;t.isStart=!1,t.isHit=!1,t.isActive=!1,t.hitControlPoint=-1,Hm(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),Wm(this.shape)&&this.shape.pointEventsHandler.disableEditMode()}initControls(){const{shape:t}=this,e=this.getControlVertexes(),i=new sv(t,{vertexes:e});t.controls=i,t.getRootNode().appendChild(i),this.updateControlsFlags(this.controlsFlags)}updateControls(){var t,e,i,n;const{shape:s}=this,o=this.getScaledControlVertexes();JSON.stringify(o)!==JSON.stringify(null===(t=s.controls)||void 0===t?void 0:t.vertexes)&&(null===(e=s.controls)||void 0===e||e.updateControlPoints(o),null===(i=s.controls)||void 0===i||i.update(o),null===(n=s.controls)||void 0===n||n.updateOrigin())}renderControls(){const{shape:t,isStart:e,isActive:i,controlsFlags:n,isInGroup:s}=this,{useDefaultControls:o}=n,{controls:r}=t;if(!r)return;let a="hidden";o&&(e||i||s)&&(a="visible"),r&&r.setVisible(a),this.updateControls(),this.showControls()}destroyControls(){var t,e;null===(t=this.referencePoint)||void 0===t||t.destroy(),this.referencePoint=null,null===(e=this.shape.controls)||void 0===e||e.destroy(),this.shape.controls=null}getTransform(){const{parentNode:t}=this.shape,e=t instanceof fv&&this.shape.context.isGrouped;e&&t.delete(this.shape,!1);const i={...this.shape.getLocalPosition()},n=this.shape.getLocalAngle(),s={...this.shape.getLocalScale()};return e&&t.add(this.shape),{angle:n,scale:s,position:i}}setTransform(t){if(t){const{scale:e,angle:i,position:n}=t;n&&this.shape.setLocalPosition(n),Hd(i)||this.shape.setLocalAngle(i),Hd(e)||this.shape.setLocalScale(e)}}getCommonStyleConfig(){const{lineCap:t,lineJoin:e,lineDash:i,background:n,fillOpacity:s,opacity:o,visibility:r,miterLimit:a,borderColor:l,borderWidth:h,borderOpacity:c}=this.shape.attributes;return{lineCap:t,lineJoin:e,lineDash:i,background:n,opacity:o,borderColor:l,borderWidth:h,miterLimit:a}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:t,y:e,width:i,height:n}=this.shape.getBoundingRect(),s=[],{useDefaultControls:o,enableRotate:r}=this.shape.context.controlsFlags,a=o&&r?5:4;for(let o=0;o<a;o++){let r=t-this.shape.style.x,a=e-this.shape.style.y;1!==o&&2!==o||(r+=i),2!==o&&3!==o||(a+=n),4===o&&(r+=i/2,a-=30/this.shape.getScale().y);const l=new Af({style:{x:r,y:a,r:0}});this.shape.appendChild(l);const{x:h,y:c}=l.getPosition();s.push({x:h,y:c}),l.destroy()}return of(s)}}class rv extends Pf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationArc",...t}),na(this,"shapeType","annotationArc"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t)}update(){this.updateOrigin(),this.context.updateControls()}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i,startAngle:n,endAngle:s}=this.attributes;return{type:"annotationArc",style:{x:e.x,y:e.y,r:i,startAngle:n,endAngle:s,...this.context.getCommonStyleConfig()},transform:t}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}class av extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationCircle",...t}),na(this,"shapeType","annotationCircle"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i}=this.attributes;return{type:"annotationCircle",style:{x:e.x,y:e.y,r:i,...this.context.getCommonStyleConfig()},transform:t}}}class lv extends If{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationEllipse",...t}),na(this,"shapeType","annotationEllipse"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const t=this.context.getTransform(),{rx:e,ry:i}=this.parsedStyle,{position:n}=t;return{type:"annotationEllipse",style:{x:n.x-e.value,y:n.y-i.value,width:2*e.value,height:2*i.value,...this.context.getCommonStyleConfig()},transform:t}}}class hv extends Df{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationImage",...t}),na(this,"shapeType","annotationImage"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:t,y:e,img:i,opacity:n,visibility:s,width:o,height:r}=this.attributes;return{type:"annotationImage",style:{x:t,y:e,width:o,height:r,img:i,opacity:n,visibility:s},meteData:this.meteData,transform:this.context.getTransform()}}}class cv extends kf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationInk",...t}),na(this,"shapeType","annotationInk"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t),this.update()}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}setUseDouglasPeucker(t){t&&(this.boundsDirty=!0,this.pathDirty=!0)}getAnnotationConfig(){var t;let e=this.attributes.segments;const i=this.context.getTransform(),n=this.getBoundingRect(),{position:s}=i;return(s.x!==n.x||s.y!==n.y)&&(e=[],this.attributes.segments.forEach((t=>{const i=[];t.forEach((t=>{i.push({x:t.x-n.x+s.x,y:t.y-n.y+s.y})})),e.push(i)})),this.context.isGrouped||(this.style.segments=e)),{type:"annotationInk",style:{renderBlendMode:null==this||null===(t=this.style)||void 0===t?void 0:t.renderBlendMode,segments:e,...this.context.getCommonStyleConfig()},transform:i}}}class dv extends Nf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationRect",...t}),na(this,"shapeType","annotationRect"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.eventHandler=new nv(this),this.context.setTransform(t)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const t=this.context.getTransform(),{width:e,height:i}=this.attributes,{position:n}=t;return{type:"annotationRect",id:this.id,style:{x:n.x,y:n.y,width:e,height:i,...this.context.getCommonStyleConfig()},transform:t}}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,n=.5*((null==i?void 0:i.value)||0),s=n,o=n,r=t.value-2*n,a=e.value-2*n;return this.path=[{x:s,y:o},{x:s+r,y:o},{x:s+r,y:o+a},{x:s,y:o+a}],this.steps=nf(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class uv{constructor(t){na(this,"shape",void 0),na(this,"textCursor",void 0),na(this,"textCursorInitCache",void 0),na(this,"inputComposition",!1),na(this,"startChar",void 0),na(this,"startDirection",void 0),na(this,"startPoint",void 0),na(this,"textRects",[]),na(this,"virtualChar",void 0),na(this,"isStart",!1),na(this,"canvas",void 0),na(this,"textClipboard",[]),na(this,"startTextContent",void 0),na(this,"lineChars",void 0),na(this,"flatChars",void 0),na(this,"editMode",void 0),na(this,"textarea",void 0),na(this,"textSelection",[]),this.shape=t,this.calculateCharPosition()}getLineIndexByMoved(t){const{lines:e,lineHeightOffset:i}=this.shape;let n=0;for(let s=0;s<e.length;s++){const{y:o,height:r}=e[s],a=o-r*(1-i);t.y>a&&(n=s)}return n}getLineIndexByPosition(t){const{lines:e,limitWidth:i,lineHeightOffset:n}=this.shape,{width:s}=this.shape.bounds;for(let i=0;i<e.length;i++){const o=e[i],{x:r,y:a,height:l,widthWithoutLF:h}=o,c=i===e.length-1?1:1+n;if(new Nf({style:{x:r,y:a-l*(1-n),width:Math.max(s,h),height:l*c,borderWidth:1,background:"transparent"}}).isPointInPath(t))return i}return-1}getCharByPosition(t,e){if(-1===e)return null;const{lineChars:i}=this,{lineHeightOffset:n}=this.shape,s=i[e];for(let e=0;e<s.length;e++){const o=s[e],{x:r,y:a,charWidth:l,charHeight:h}=o,c=o.lineIndex===i.length-1?1:1+n;if(new Nf({style:{x:r,y:a-h*(1-n),width:l,height:h*c,borderWidth:1,background:"transparent"}}).isPointInPath(t))return o}return null}getCharAndDirection(t){const e=this.getLineIndexByPosition(t);let i,n=1;if(-1===e)return i=this.flatChars[this.flatChars.length-1],n=1,{char:i,direction:n};const s="textBox"===this.shape.textType;if(i=this.getCharByPosition(t,e),i){const{x:e,charWidth:s}=i;n=t.x<e+s/2?0:1}else{const o=this.lineChars[e];i=o[o.length-1],n=1,s&&t.x<o[0].x&&(i=o[0],n=0)}return"\r"!==i.text&&"\n"!==i.text&&"\r\n"!==i.text||(n=0),0===n&&0!==i.indexInLine&&(i=this.lineChars[i.lineIndex][i.indexInLine-1],n=1),{char:i,direction:n}}createCursor(t,e,i,n){if(!this.textCursor){const s=document.createElement("div");return s.className="ddv-annotation-cursor",s.style.left=t-.5+"px",s.style.top=`${e}px`,s.style.transform=`rotate(${i}deg)`,s.style.width="1px",s.style.height=`${n}px`,this.canvas.parentNode.appendChild(s),void(this.textCursor=s)}this.textCursor.style.left=t-.5+"px",this.textCursor.style.top=`${e}px`,this.textCursor.style.height=`${n}px`,this.textCursor.style.transform=`rotate(${i}deg)`,this.textCursor.style.animation="none",this.textCursor.offsetWidth,this.textCursor.style.animation=""}showTextCursor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{lineHeightOffset:n}=this.shape,s=(t,e)=>{const{x:i,y:s,charWidth:o,charHeight:r,lineIndex:a}=t,l=e?i+o:i,h=s-r*(1-n),c=a>=this.lineChars.length-1?1:1+n;return new Nf({style:{x:l-this.shape.style.x,y:h-this.shape.style.y,borderWidth:"1px",height:r*c}})},o=t=>{this.shape.appendChild(t);const e=this.shape.getScale().y,i=t.getAngle();t.setAngle(0);const{x:n,y:s}=t.getPosition();t.destroy(),this.createCursor(n,s,i,t.parsedStyle.height.value*e)};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:r,shape:a}=this;if(!r.length&&this.virtualChar){const{fontSize:t}=this.shape.freeTextContentStyle,e=mg(t).value;if(e!==this.virtualChar.charHeight){const{borderOffset:t,padding:i}=this.shape,{y:s}=this.shape.style;this.virtualChar.charHeight=e,this.virtualChar.y=s+t+i+e*(1-n)}return o(s(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let l=r[t];if(Hd(t)&&(l=r[0],e=0),!r[t])return;"justify"===a.style.textAlign&&"textBox"===a.textType&&" "===l.text&&e&&r[l.totalIndex+1]&&(l=r[l.totalIndex+1],e=0);const h=r[l.totalIndex+1];let c;Ym(l.text)&&e&&h&&(l=h,e=0),c=Ym(l.text)&&e&&!h?s(this.virtualChar,1):s(l,e),o(c),this.startChar=l,this.startDirection=e,this.textCursorInitCache={char:l,isBack:e},i&&this.shape.hooks.selectTextChars.emit({startChar:l,endChar:l,isBack:!!e,needUpdate:!1})}moveTextCursor(t){const{textSelection:e}=this;let i,n;if(2===e.length){const[s,o]=e;switch(t){case"up":case"left":i=s.totalIndex,n=0;break;default:i=o.totalIndex,n=1}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(i,n)}const s=this.flatChars,o=s.length,{startChar:r,startDirection:a}=this;if(r){if("left"===t){const t=a?r.totalIndex-1:r.totalIndex-2;i=t>=0?t:0,n=t>=0?1:0}else if("right"===t){const t=a?r.totalIndex+1:r.totalIndex;i=t>o-1?o-1:t,n=1}else{const{x:e,charWidth:o,lineIndex:l}=r;if(0===l&&"up"===t)i=0,n=0;else if(l===this.lineChars.length-1&&"down"===t)i=s.length-1,n=1;else{const s=a?e+o:e,r="up"===t?this.lineChars[l-1]:this.lineChars[l+1];i=r[0].totalIndex,n=0,r.forEach((t=>{s>t.x+o/2&&!Ym(t.text)&&(i=t.totalIndex,n=1)}))}}this.showTextCursor(i,n)}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null)}showTextSelection(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[],{lines:s,parsedStyle:o,textType:r,lineHeightOffset:a}=this.shape;if(this.hideTextSelection(),this.textSelection=[t,e],!t||!e)return;const l=["right","justify"].includes(o.textAlign)&&"textBox"===r;if(t.y===e.y){const i=Ym(t.text),o=Ym(e.text);if(i&&o)return;const r=t.x===e.x?t.charWidth:o?e.x-t.x:e.x-t.x+e.charWidth;n.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:r,height:s[t.lineIndex].height})}else{const i=this.shape.getTextAlignOffset(s[t.lineIndex]),{x:o,height:r}=s[t.lineIndex],a=l?s[t.lineIndex].widthWithoutLF:s[t.lineIndex].width;if(n.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:o+a+i-t.x,height:r}),e.lineIndex-t.lineIndex>1)for(let i=t.lineIndex+1;i<e.lineIndex;i++){const{x:t,y:e,height:o}=s[i],r=l?s[i].widthWithoutLF:s[i].width,a=this.shape.getTextAlignOffset(s[i]);n.push({x:t+a,y:e,width:r,height:o,lineIndex:i})}const h=this.shape.getTextAlignOffset(s[e.lineIndex]),{x:c,y:d,height:u}=s[e.lineIndex],p=l&&Ym(e.text)?0:e.charWidth;n.push({x:c+h,y:d,width:e.x+p-c-h,height:u,lineIndex:e.lineIndex})}const{x:h,y:c}=this.shape.style;this.hideTextCursor(),n.forEach((t=>{const e=t.lineIndex===this.lineChars.length-1?1:1+a,i=new Nf({style:{x:t.x-h,y:t.y-c-t.height*(1-a),width:t.width,height:t.height*e,background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(i),this.textRects.push(i)})),this.shape.hooks.selectTextChars.emit({startChar:t,endChar:e,isBack:!0,needUpdate:i})}hideTextSelection(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach((t=>{t.destroy()})),this.textSelection=[],this.textRects=[],t){const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e)}}addText(t,e,i){if(!i||""===i)return;if(!t){const t={...this.shape.freeTextContentStyle,content:i};return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[t]}),this.showTextCursor(i.length-1,1),void this.shape.hooks.textContentUpdatedByChar.emit()}const n=Wd(this.shape.style.textContents),{freeContentIndex:s,indexInFreeContent:o}=t,r=n[s],{content:a}=r,l=pv(this.shape.freeTextContentStyle,r),h=()=>({...this.shape.freeTextContentStyle,content:i});if(e&&o===a.length-1)l?r.content+=i:n.splice(s+1,0,h());else if(e||o)if(l){const t=0===e?o:o+1;r.content=a.slice(0,t)+i+a.slice(t)}else{const t=[],i=a.slice(0,e?o+1:o),l=a.slice(e?o+1:o);i&&t.push({...r,content:i}),t.push(h()),l&&t.push({...r,content:l}),n.splice(s,1,...t)}else if(s){const t=n[s-1];pv(this.shape.freeTextContentStyle,t)?n[s-1].content+=i:n.splice(s,0,h())}else l?r.content=i+r.content:n.unshift(h());this.shape.updateStyle({textContents:[...n]}),this.shape.hooks.textContentUpdatedByChar.emit();const{char:c,isBack:d}=this.textCursorInitCache;d?this.showTextCursor(c.totalIndex+i.length,1):this.showTextCursor(c.totalIndex+i.length-1,1)}deleteText(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Wd(this.shape.style.textContents);if(!i.length)return;let n=0;if(2===this.textSelection.length){const[t,e]=this.textSelection;if(t.freeContentIndex===e.freeContentIndex){const n=i[t.freeContentIndex];n.content=$m(n.content,t.indexInFreeContent,e.indexInFreeContent)}else{const n=i[t.freeContentIndex],s=i[e.freeContentIndex];n.content=n.content.substring(0,t.indexInFreeContent),s.content=s.content.substring(e.indexInFreeContent+1);for(let n=t.freeContentIndex+1;n<e.freeContentIndex;n++)i[n].content=""}n=t.totalIndex-1}else{const{startChar:t,startDirection:o}=this;if(!t)return;let r=o?t:this.flatChars[t.totalIndex-1];if(e){var s;const t=Hd(null===(s=r)||void 0===s?void 0:s.totalIndex)?0:r.totalIndex+1;r=this.flatChars[t]}if(!r)return;const{freeContentIndex:a,indexInFreeContent:l}=r,h=i[a];if(!h.color)return;h.content=$m(h.content,l,l),n=r.totalIndex-1}this.hideTextSelection(),this.shape.updateStyle({textContents:[...i]}),t&&this.shape.hooks.textContentUpdatedByChar.emit(),-1===n?this.showTextCursor(0,0,!1):this.showTextCursor(n,1,!1),this.shape.hooks.reRenderText.emit()}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:t}=this.shape.style,[e,i]=this.textSelection,n=[],s=e.freeContentIndex,o=i.freeContentIndex;if(s===o){const o=t[s],r=o.content.slice(e.indexInFreeContent,i.indexInFreeContent+1);n.push({...o,content:r})}else for(let r=s;r<=o;r++){const a={...t[r]},l=a.content;r===s?a.content=l.slice(e.indexInFreeContent):r===o&&(a.content=l.slice(0,i.indexInFreeContent+1)),n.push({...a})}this.textClipboard=[...n],function(t){let e="";t.forEach((t=>{e+=t.content}));try{navigator.clipboard.writeText(e)}catch(t){}}(n)}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:t,char:e}=this.textCursorInitCache,{textContents:i}=this.shape.style,n=t?e:this.flatChars[e.totalIndex-1];let s=0,o=(null==n?void 0:n.totalIndex)||-1;if(this.textClipboard.forEach((t=>{s+=t.content.length})),n)if(this.flatChars.length){const t=i[e.freeContentIndex];if(t.content.length===n.indexInFreeContent+1)i.splice(e.freeContentIndex+1,0,...Wd(this.textClipboard)),this.shape.updateStyle({textContents:[...i]});else{const{content:s}=t,{indexInFreeContent:o}=n,r=[{...t,content:s.slice(0,o+1)},...Wd(this.textClipboard),{...t,content:s.slice(o+1)}];i.splice(e.freeContentIndex,1,...r),this.shape.updateStyle({textContents:[...i]})}}else this.shape.updateStyle({textContents:Wd(this.textClipboard)}),o=-1;else i.unshift(...Wd(this.textClipboard)),this.shape.updateStyle({textContents:i});this.showTextCursor(o+s,1),this.shape.hooks.textContentUpdatedByChar.emit()}selectAllText(){if(!this.flatChars.length)return;const t=this.flatChars[0],e=this.flatChars[this.flatChars.length-1];this.showTextSelection(t,e),this.shape.hooks.reRenderText.emit()}updateTextSelection(){if(!this.textSelection.length)return;const[t,e]=this.textSelection,i=this.flatChars[t.totalIndex],n=this.flatChars[e.totalIndex];this.showTextSelection(i,n,!0),this.shape.hooks.reRenderText.emit()}calculateCharPosition(){const{borderOffset:t,padding:e,lineHeightOffset:i,lines:n}=this.shape,s=[];let o=0,r=0,a=0,l=0;n.forEach(((t,e)=>{const i=t.height,n=[],h=this.shape.getTextAlignOffset(t),c=(t,s,a,h,c)=>{const d={text:t,x:s,y:a,charWidth:h,charHeight:i,freeContentIndex:c,lineIndex:e,indexInLine:r,indexInFreeContent:o,totalIndex:l};n.push(d)};r=0,t.words.forEach((e=>{const{wordWidth:i,freeContentIndex:n,x:s,text:d}=e;if(n!==a&&(o=0,a=n),1===e.text.length)c(d,s+h,t.y,i,n),l+=1,r+=1,o+=1;else{let i=e.x+h;for(let s=0;s<d.length;s++){const a=d.charAt(s),h=Gf(a,e.style);c(a,i,t.y,h,n),i+=h,l+=1,o+=1,r+=1}e.text.length!==e.originText.length&&(o+=e.originText.length-e.text.length)}})),s.push(n)}));const h=this.shape.getTextAlignOffset();if(this.flatChars=s.flat(),this.lineChars=s,this.virtualChar=null,!n.length){const{x:n,y:s,textAlign:o}=this.shape.parsedStyle,{fontSize:r}=this.shape.freeTextContentStyle,a=mg(r).value,l="right"===o?n+e+h:n+t+e+h;return void(this.virtualChar={x:l,y:s+t+e+a*(1-i),charWidth:1,charHeight:a,lineIndex:0})}const c=this.flatChars[this.flatChars.length-1];Ym(c.text)&&(this.virtualChar={x:this.shape.lines[0].x+h,y:c.y+n[c.lineIndex].height*(1+i),charWidth:1,charHeight:c.charHeight,lineIndex:c.lineIndex+1})}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e)}enableEditMode(t,e){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateTextLines(),this.shape.hooks.reRenderText.emit()),this.shape.hooks.enableTextEditMode.emit(),this.calculateCharPosition(),this.editMode=!0,this.canvas=e;let i=!1;if("textBox"===this.shape.textType){const{totalTextHeight:t,textMaxWidth:e}=this.shape,{height:i,width:n}=this.shape.parsedStyle;(t!==i.value||e>n.value)&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0)}if(this.flatChars.length){const e=Um(this.shape,t),i=this.getCharAndDirection(e),{char:n,direction:s}=i;this.startChar=n,this.startDirection=s,this.showTextCursor(n.totalIndex,s)}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(i=!0);this.shape.context.updateControlsFlags({useDefaultControls:i,enableMove:!1}),this.openTextarea(t),this.resetStartTextContent()}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:t,textMaxWidth:e,maxEditWidth:i}=this.shape,{height:n,width:s}=this.shape.parsedStyle;(t!==n.value||e>s.value||i>s.value)&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit())}this.shape.maxEditWidth=0,this.shape.hooks.disableTextEditMode.emit(),this.emitTextContentUpdated()}}editStartHandler(t){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const e=Um(this.shape,t),i=this.getCharAndDirection(e);this.hideTextSelection();const{char:n,direction:s}=i;this.showTextCursor(n.totalIndex,s),this.isStart=!0,this.startChar=n,this.startDirection=s,this.startPoint=e,this.shape.hooks.reRenderText.emit()}editMoveHandler(t){if(!this.editMode||!this.isStart)return;const{lineChars:e}=this,i=Um(this.shape,t),n=this.getLineIndexByMoved(i);let{startChar:s,startDirection:o}=this,r=null;const a=e[n],l=n===this.startChar.lineIndex?i.x>this.startPoint.x:i.y>this.startPoint.y,{lineIndex:h,indexInLine:c}=this.startChar;if(!this.startDirection&&!l){if(0===s.totalIndex)return void this.hideTextSelection(!0);const t=s.lineIndex===e.length-1;if(t&&i.y<this.startPoint.y)s=this.flatChars[s.totalIndex-1],o=1;else if(t)return void this.hideTextSelection(!0)}if(l&&o&&(s=e[h][c+1],o=0,!s))return void this.hideTextSelection(!0);if(l&&i.x<a[0].x+a[0].charWidth/2&&s.lineIndex!==n){const t=e[n-1];return r=t[t.length-1],void this.showTextSelection(s,r)}if(l)a.forEach(((t,e)=>{const{x:n,charWidth:s}=t;i.x>n+s/2&&(r=a[e])}));else for(let t=a.length-1;t>=0;t--){const{x:e,charWidth:n}=a[t];e+n/2>i.x&&(r=a[t])}if(!r)return void this.hideTextSelection(!0);const{lineIndex:d,indexInLine:u}=s,{lineIndex:p,indexInLine:g}=r;l&&d===p&&u===g+1||!l&&d===p&&u===g-1?this.hideTextSelection(!0):l?this.showTextSelection(s,r):this.showTextSelection(r,s)}editEndHandler(){this.isStart=!1}editClickHandler(t,e){this.editMode&&(this.canvas=e,this.openTextarea(t))}openTextarea(t){if(this.editMode){if(!this.textarea){const t=document.createElement("textarea");t.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(t),this.textarea=t,t.addEventListener("input",(t=>{this.inputComposition||this.textareaInput(t)}),!1),t.addEventListener("compositionstart",(t=>this.textareaCompositionstart(t)),!1),t.addEventListener("compositionend",(t=>{this.inputComposition=!1,this.textareaInput(t)}),!1),t.addEventListener("keydown",(t=>this.textareaKeydown(t)),!1)}if(t){const{x:e,y:i}=t;this.textarea.style.left=`${e}px`,this.textarea.style.top=`${i}px`}this.textarea.value="",this.textarea.focus()}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null)}emitTextContentUpdated(){(function(t,e){let i="",n="";for(let e=0;e<t.length;e++)i+=t[e].content;for(let t=0;t<e.length;t++)n+=e[t].content;return i===n})(this.startTextContent,this.shape.style.textContents)||(this.startTextContent=Wd(this.shape.style.textContents),this.shape.hooks.textContentUpdated.emit())}resetStartTextContent(){this.startTextContent=Wd(this.shape.style.textContents)}textareaInput(t){const e=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:t,isBack:i}=this.textCursorInitCache;this.addText(t,i,e)}else this.addText(void 0,void 0,e);this.textarea.value=""}textareaCompositionstart(t){this.inputComposition=!0}textareaKeydown(t){if(this.inputComposition||"Backspace"!==t.key||8!==t.keyCode)if(this.inputComposition||"Delete"!==t.key)switch(ku(t)&&("KeyC"===t.code?this.copyText():"KeyX"===t.code?(this.copyText(),this.textSelection.length&&this.deleteText()):"KeyV"===t.code&&this.textClipboard.length?(t.preventDefault(),this.pasteText()):"KeyZ"===t.code?(t.preventDefault(),t.stopPropagation()):"KeyA"===t.code&&this.selectAllText()),t.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down")}else this.deleteText(!0,!0);else this.deleteText()}}function pv(t,e){return t.color===e.color&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontStyle===e.fontStyle&&t.fontWeight===e.fontWeight&&t.lineThrough===e.lineThrough&&t.underline===e.underline}class gv extends zf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qm,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:t.id,style:{freeTextType:e,...t.style}}),na(this,"lastSelectedEndChar",void 0),na(this,"lastIsBack",void 0),na(this,"shapeType","annotationFreeText"),na(this,"textEditEventHandler",void 0),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),na(this,"freeTextContentStyle",void 0),na(this,"inputModeTimer",void 0),na(this,"maxEditWidth",0),na(this,"hooks",{reRenderText:ou(),selectTextChars:ou(),enableTextEditMode:ou(),disableTextEditMode:ou(),textContentUpdated:ou(),textContentUpdatedByChar:ou()}),this.freeTextContentStyle=i,this.init(t.transform,t.selectableStyle,n),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on((t=>{const e=t.endChar;if(this.isSameChar(e,this.lastSelectedEndChar)&&t.isBack===this.lastIsBack&&!t.needUpdate)return;let i=e.freeContentIndex;e.indexInFreeContent||!e.freeContentIndex||t.isBack||(i-=1);const n=this.style.textContents[i];this.lastSelectedEndChar=e,this.lastIsBack=t.isBack,this.freeTextContentStyle={...n,content:this.freeTextContentStyle.content}}))}get isEditMode(){var t;return null===(t=this.textEditEventHandler)||void 0===t?void 0:t.editMode}get hasSelectedChars(){var t;return(null===(t=this.textEditEventHandler)||void 0===t?void 0:t.textSelection.length)>0}init(t,e,i){if("freeTextWriter"===this.textType&&i&&super.updateOrigin(),this.context=new ov(this,e),this.textEditEventHandler=new uv(this),this.eventHandler=new nv(this),this.context.setTransform(t),"freeTextWriter"===this.textType&&i){const{x:t,y:e}=this.getPosition();this.updateOrigin(),this.setPosition({x:t,y:e})}}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin()}getAnnotationConfig(){const t="textBox"===this.textType?"annotationTextBox":"annotationFreeText",e=this.context.getTransform(),{position:i}=e,{width:n,height:s,textContents:o}=this.attributes,r={type:t,style:{x:i.x,y:i.y,textContents:Wd(o),textAlign:this.style.textAlign,...this.context.getCommonStyleConfig(),width:n},transform:e};return"textBox"===this.textType&&(r.style.height=s),r}calculateTotalHeight(){var t,e;const i=mg((null===(t=this.freeTextContentStyle)||void 0===t?void 0:t.fontSize)||16);if(null!==(e=this.lines)&&void 0!==e&&e.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=i.value+2*this.borderOffset;else{const{height:t}=this.parsedStyle;this.totalTextHeight=t.value>i.value+2*this.borderOffset?t.value:i.value+2*this.borderOffset+2*this.padding}}getBoundingRect(){var t;if(!this.boundsDirty)return this.bounds;const{x:e,y:i}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(t=this.lines)||void 0===t||!t.length)){var n;const t=mg((null===(n=this.freeTextContentStyle)||void 0===n?void 0:n.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:e,y:i,width:Gf("  ",{...this.freeTextContentStyle,fontSize:t}),height:t.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight,this.textMaxWidth>this.bounds.width&&(this.bounds.width=this.textMaxWidth+2*this.borderOffset+2*this.padding),this.maxEditWidth=Math.max(this.maxEditWidth,this.bounds.width),this.maxEditWidth>this.bounds.width&&(this.bounds.width=this.maxEditWidth)),this.bounds}updateFreeTextContentStyle(t){this.freeTextContentStyle=t,this.textEditEventHandler.updateCursor();const{flatChars:e}=this.textEditEventHandler;this.isEditMode&&!e.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit())}focusTexture(){const t=Xd();this.isEditMode&&this.textEditEventHandler.textarea&&(t||this.textEditEventHandler.textarea.focus())}updateCursor(){this.textEditEventHandler.updateCursor()}isSameChar(t,e){return!(!t||!e)&&t.charHeight===e.charHeight&&t.charWidth===e.charWidth&&t.freeContentIndex===e.freeContentIndex&&t.indexInFreeContent===e.indexInFreeContent&&t.indexInLine===e.indexInLine&&t.text===e.text&&t.totalIndex===e.totalIndex}}class fv extends Nf{constructor(t){super({id:t,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),na(this,"shapeType","annotationGroup"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),na(this,"parent",void 0),na(this,"parentPosition",void 0),na(this,"shapes",[]),na(this,"clickedShape",null),na(this,"state",!1),na(this,"groupMode",0),this.context=new ov(this),this.eventHandler=new nv(this),this.eventHandler.isHit=this.isHit.bind(this),this.groupMode?this.context.updateControlsFlags({enableEdit:!1}):this.context.updateControlsFlags({useDefaultControls:!1})}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:i,parsedStyle:n}=this;let{controls:s}=this;if(!this.state||"hidden"===n.visibility||!i.controlsFlags.enableControl)return this.clickedShape=null,-1;s||(i.initControls(),i.renderControls(),s=this.controls);let o=-1;if(this.groupMode)o=s.checkHitArea(t.x,t.y);else for(let e=0;e<this.shapes.length;e++)if(this.shapes[e].controls||(this.shapes[e].context.initControls(),this.shapes[e].context.renderControls()),this.shapes[e].controls.checkHitArea(t.x,t.y)>=0){this.clickedShape=this.shapes[e],o=9;break}return o<0&&e?(this.clickedShape=null,i.unHitShape(),this.context.destroyControls(),-1):o}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach((t=>{t instanceof gv&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),this.appendChild(t),t.context.isGrouped=!0})),this.update(),this.context.initControls()}add(t){if(!this.parent){const e=t.parentNode;this.parent=e,this.parentPosition=e.getPosition()}if("hidden"!==t.parsedStyle.visibility&&-1===this.shapes.indexOf(t)){if(t.context.isInGroup=!0,this.shapes.push(t),this.state){const e=[];this.shapes.forEach((t=>{e.push(t.getWorldTransform().clone())})),t instanceof gv&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),t.context.isGrouped=!0,this.appendChild(t),this.groupMode||this.showAllControls(t),this.shapes.forEach(((t,i)=>{const n=this.getWorldTransform().inverse().multiply(e[i]);t.setLocalTransform(n)})),this.update()}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init())}}update(){const t=[],e=[],i=[];let n=!0;for(let s=0;s<this.shapes.length;s++){const o=this.shapes[s];let{controls:r}=o;r||(o.context.initControls(),r=o.controls),o.context.renderControls(),this.groupMode&&o.context.unHitShape(),o.context.controlsFlags.enableMove||(n=!1);const a=r.controlPoints.slice(0,4);for(let i=0;i<4;i++){const{x:n,y:s}=a[i].getCenterPosition();t.push(n),e.push(s)}i.push(this.shapes[s].getWorldTransform().clone())}const s=Math.max(...t),o=Math.min(...t),r=Math.max(...e),a=Math.min(...e);this.updateStyle({x:0,y:0,width:s-o,height:r-a}),this.context.updateControlsFlags({enableMove:n}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1);const{x:l,y:h}=this.getScale();this.scale(1/Math.abs(l),1/Math.abs(h)),this.setPosition({x:o,y:a}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach(((t,e)=>{const n=this.getWorldTransform().inverse().multiply(i[e]);t.setLocalTransform(n)}))}delete(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent)return;if(-1===this.shapes.indexOf(t))return;const i=t.getWorldTransform().clone();this.parent.appendChild(t);const n=this.parent.getWorldTransform().inverse().multiply(i);t.setLocalTransform(n),t.context.isInGroup=!1,t.context.isGrouped=!1,t.context.isActive=!1,t.context.destroyControls(),"freeTextWriter"!==(null==t?void 0:t.textType)&&(t.context.updateControlsFlags({enableRotate:t.context.tempData.enableRotate||!1}),delete t.context.tempData.enableRotate),Wm(t)&&t.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(t),1),e&&this.update(),0===this.shapes.length&&this.clear()}clear(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.delete(this.shapes[e],!1);this.context.destroyControls(),this.reset()}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden"}destroy(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.shapes[e].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0})}showAllControls(t){if(!this.state)return;if(this.groupMode)return;const e=t=>{Wm(t)&&t.pointEventsHandler.enableEditMode(),t.controls||t.context.initControls(),t.context.controlsFlags.enableRotate&&(t.context.tempData.enableRotate=t.context.controlsFlags.enableRotate,t.context.updateControlsFlags({enableRotate:!1})),t.context.isActive=!0,t.context.renderControls()};t?e(t):this.shapes.forEach((t=>{e(t)}))}getAnnotationConfig(){return{type:"annotationGroup"}}}class mv extends Nf{constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),na(this,"shapeType","annotationLineControls"),na(this,"container",void 0),this.container=t}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&Zm(null==this?void 0:this.container)}}class vv{constructor(t){na(this,"shape",void 0),na(this,"editMode",void 0),na(this,"hitIndex",-1),na(this,"hitPointPos",void 0),na(this,"startPoint",void 0),na(this,"controlsBox",void 0),na(this,"controlsPoints",[]),this.shape=t}getLineShapePoints(){const{shape:t}=this,{shapeType:e}=t;if("annotationLine"===e){const{startPoint:e,endPoint:i}=t.style;return[e,i]}const{points:i}=this.shape.parsedStyle;return i.slice(0,i.length)}initLineControls(){const{shape:t}=this;t.updatePoints();const{x:e,y:i}=this.shape.getScale(),{ctrlBorderColor:n,ctrlBorderWidth:s,ctrlLineDash:o,borderColor:r,borderWidth:a,lineDash:l,ctrlBorderRadius:h,ctrlWidth:c,ctrlHeight:d,background:u,ctrlBackground:p}=t.context.parsedControlsStyle,g={background:p,borderColor:n,borderWidth:s,lineDash:o},f=this.shape.getBoundingRect(),m=this.getLineShapePoints();this.controlsBox=new mv(this.shape,{style:{width:f.width*e,height:f.height*i,borderColor:r,borderWidth:a,background:u,lineDash:l}}),m.forEach((n=>{const s=new jf({style:{width:c,height:d,roundedRadius:h,...g,visibility:t.context.controlsFlags.enableEdit?"visible":"hidden"}}),o=(n.x-f.x)*e-mg(c).value/2,r=(n.y-f.y)*i-mg(d).value/2;s.setLocalPosition(o,r),this.controlsPoints.push(s),this.controlsBox.appendChild(s)})),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox)}isHitPoint(t){if(!this.editMode)return-1;if(this.shape.context.controlsFlags.enableEdit)for(let e=0;e<this.controlsPoints.length;e++){const i=Um(this.controlsPoints[e],t);if(this.controlsPoints[e].isPointInPath(i))return e}return-1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length)return;if(!this.editMode)return;const{ctrlWidth:t,ctrlHeight:e}=this.shape.context.parsedControlsStyle,{x:i,y:n}=this.shape.getScale(),s=this.shape.getBoundingRect(),o=this.getLineShapePoints();this.controlsPoints.length!==o.length&&(this.destroyLineControls(),this.initLineControls()),o.forEach(((o,r)=>{const a=(o.x-s.x)*i-t/2,l=(o.y-s.y)*n-e/2;this.controlsPoints[r].setLocalPosition(a,l)})),this.controlsBox.updateStyle({width:s.width*i,height:s.height*n}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height)}destroyLineControls(){var t;null===(t=this.controlsBox)||void 0===t||t.destroy(),this.controlsPoints.forEach((t=>{t.destroy(),t=null})),this.controlsBox=null,this.controlsPoints=[]}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount)return;if(this.controlsPoints.length>0)return;const{shape:t}=this;this.editMode||this.initLineControls(),this.editMode=!0,t.context.isHit=!0,t.controls&&(t.context.lastControlsWidth=t.controls.getLength().width,t.context.lastControlsHeight=t.controls.getLength().height)}disableEditMode(){this.destroyLineControls(),this.editMode=!1}editStartHandler(t){if(!this.editMode)return;this.hitIndex=-1;const e=this.isHitPoint(t);-1!==e&&(this.hitIndex=e,this.hitPointPos={...this.shape.path[this.hitIndex]}),this.startPoint=t,this.shape.context.lastLocalTransform=this.shape.getLocalTransform()}editMoveHandler(t){if(!this.editMode||-1===this.hitIndex)return;const{shape:e}=this,i="annotationLine"===e.shapeType,n=i?[...e.path]:[...e.parsedStyle.points],s=Um(e,t);n[this.hitIndex]=s,i?e.updateStyle({startPoint:{x:n[0].x,y:n[0].y},endPoint:{x:n[1].x,y:n[1].y}}):e.style.points=n,this.updateLineControls()}editEndHandler(){this.editMode&&this.shape.updatePoints()}}class yv extends Bf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolygon",...t}),na(this,"shapeType","annotationPolygon"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),na(this,"pointEventsHandler",void 0),na(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.pointEventsHandler=new vv(this),this.eventHandler=new nv(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,n=i.x!==e.x||i.y!==e.y;let s=this.attributes.points;return n&&(s=[],this.attributes.points.forEach((t=>{s.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y})}))),{type:"annotationPolygon",style:{points:s,...this.context.getCommonStyleConfig()},transform:t}}}class xv extends Ff{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolyline",...t}),na(this,"shapeType","annotationPolyline"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),na(this,"pointEventsHandler",void 0),na(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.pointEventsHandler=new vv(this),this.eventHandler=new nv(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,n=i.x!==e.x||i.y!==e.y;let s=this.attributes.points;return n&&(s=[],this.attributes.points.forEach((t=>{s.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y})}))),{type:"annotationPolyline",style:{points:s,lineEnding:this.attributes.lineEnding,...this.context.getCommonStyleConfig()},transform:t}}}class wv extends Vf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationLine",...t}),na(this,"shapeType","annotationLine"),na(this,"eventHandler",void 0),na(this,"controls",void 0),na(this,"context",void 0),na(this,"pointEventsHandler",void 0),this.init(t.transform,t.selectableStyle)}init(t,e){this.context=new ov(this,e),this.pointEventsHandler=new vv(this),this.eventHandler=new nv(this),this.context.setTransform(t),this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{startPoint:i,endPoint:n,lineEnding:s}=this.attributes,{position:o}=t,r=o.x!==e.x||o.y!==e.y;return{type:"annotationLine",style:{startPoint:r?{x:i.x-e.x+o.x,y:i.y-e.y+o.y}:i,endPoint:r?{x:n.x-e.x+o.x,y:n.y-e.y+o.y}:n,lineEnding:s,...this.context.getCommonStyleConfig()},transform:t}}}const bv=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],Cv=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Sv=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],_v=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Tv=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Ev=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Pv=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Av=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Iv=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Dv=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],kv=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Rv=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class Mv extends Hf{constructor(t){var e;super({type:"annotationStamp",...t,style:{...t.style,stampConfig:(null==t||null===(e=t.style)||void 0===e?void 0:e.stampConfig)||Lv(null==t?void 0:t.style.iconName)}}),na(this,"shapeType","annotationStamp"),na(this,"stampType","base"),na(this,"controls",void 0),na(this,"eventHandler",void 0),na(this,"context",void 0),na(this,"renderClipStep",void 0),na(this,"shapes",[]),na(this,"initialRect",void 0),na(this,"iconName",void 0),na(this,"imageLoadedByDraw",!1),na(this,"initByDraw",!1),na(this,"hooks",{reRenderImage:ou()}),this.initByDraw=(null==t?void 0:t.initByDraw)||!1,this.initStamp(),this.init(t.transform,t.selectableStyle),this.initSize(t.style,t.transform)}init(t,e){this.eventHandler=new nv(this),this.context=new ov(this,e),this.context.setTransform(t),this.initialRect=this.getBoundingRect()}initStamp(){const{imageData:t,width:e,height:i}=this.style;if(this.stampItemShapes.forEach((t=>{t.destroy()})),this.stampItemShapes=[],t){var n;this.renderType="image",this.imageLoadedByDraw=!1,(null==this||null===(n=this.style)||void 0===n?void 0:n.img)instanceof HTMLImageElement&&this.style.img.src&&URL.revokeObjectURL(this.style.img.src);const s=t instanceof Blob?URL.createObjectURL(t):t,o=new Image;o.src=s,this.style.img=o,o.onload=()=>{if(this.initByDraw||!qd(e)||!qd(i)){const{width:t,height:e}=o;let i=t,n=e;if(t>400||e>400){const s=Math.max(t/400,e/400);i/=s,n/=s}this.updateStyle({width:i,height:n}),this.setLocalScale(1,1),this.initialWidth=i,this.initialHeight=n,this.initByDraw=!1,this.imageLoadedByDraw=!0}this.hooks.reRenderImage.emit()}}else this.initByDraw=!1,super.initStamp();this.getPath(),this.renderClipStep=this.steps}initSize(t,e){if("image"===this.renderType){const{x:t,y:e}=this.getLocalScale();1===t&&1===e||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value)}const i={},n=this.getAnnotationConfig(),{x:s,y:o}=(null==e?void 0:e.scale)||{x:1,y:1};var r;qd(null==t?void 0:t.x)&&(null==t?void 0:t.x)!==n.style.x&&(i.x=t.x),qd(null==t?void 0:t.y)&&(null==t?void 0:t.y)!==n.style.y&&(i.y=t.y),qd(null==t?void 0:t.width)&&t.width*s!==n.style.width&&(i.width=t.width),qd(null==t?void 0:t.height)&&t.height*o!==n.style.height&&(i.height=t.height),r=i,(0!==Object.keys(r).length||r.constructor!==Object)&&this.updateStampStyle(i)}update(){this.updateOrigin(),this.context.updateControls()}updateSize(t,e){const{x:i,y:n}=this.getLocalScale(),{x:s,y:o}=this.getPosition();if("image"===this.renderType){const{x:s,y:o}=this.getLocalPosition(),r=this.getAngle(),a=t*i,l=e*n;this.setAngle(0),this.setLocalScale(1,1),this.updateStyle({width:a,height:l});const h=s+(t-a)/2,c=o+(e-l)/2;return this.initialWidth=a,this.initialHeight=l,this.setLocalPosition({x:h,y:c}),void this.setAngle(r)}const{width:r,height:a}=this.parsedStyle,l=t||r.value*i,h=e||a.value*n;this.setLocalScale(l/r.value,h/a.value),this.setPosition({x:s,y:o})}updateStampStyle(t){const{x:e,y:i}=this.getLocalPosition(),{x:n,y:s}=this.getLocalScale(),{width:o,height:r}=this.parsedStyle,{width:a,height:l}=t,{imageData:h,iconName:c}=this.style;let d=e,u=i;h||Hd(null==t?void 0:t.imageData)||this.setLocalScale(1),null!=t&&t.imageData&&t.imageData!==h?(this.style.imageData=t.imageData,this.initStamp()):null!=t&&t.iconName&&t.iconName!==c&&(this.style.imageData=null,this.style.iconName=t.iconName,this.stampConfig=Lv(t.iconName),this.initStamp()),qd(null==t?void 0:t.opacity)&&(null==t?void 0:t.opacity)!==this.style.opacity&&(this.style.opacity=t.opacity),this.updateSize(qd(a)?a:o.value*n,qd(l)?l:r.value*s);const{x:p,y:g}=this.getLocalScale();if(qd(null==t?void 0:t.x)){const e=this.initialWidth*p;d=t.x-(this.initialWidth-e)/2}if(qd(null==t?void 0:t.y)){const e=this.initialHeight*g;u=t.y-(this.initialHeight-e)/2}this.setLocalPosition(d,u)}getAnnotationConfig(){const t=this.context.getTransform(),{x:e,y:i}=this.style,n=Wd(t);if(n.position.x===e&&n.position.y===i&&1===n.scale.x&&1===n.scale.y&&(delete n.position,delete n.scale),this.style.imageData)return{type:"annotationStamp",style:{x:t.position.x,y:t.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:{...n}};const{initialWidth:s,initialHeight:o}=this,r=s*t.scale.x,a=o*t.scale.y;return{type:"annotationStamp",style:{x:t.position.x+(s-r)/2,y:t.position.y+(o-a)/2,width:r,height:a,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:{...n}}}destroy(){var t;this.parentElement&&(this.parentElement.removeChild(this),(null==this||null===(t=this.style)||void 0===t?void 0:t.img)instanceof HTMLImageElement&&this.style.img.src&&URL.revokeObjectURL(this.style.img.src)),this.controls&&this.controls.destroy()}}function Lv(t){const e=[Jm.REJECTED,Jm.ACCEPTED,Jm.APPROVED,Jm.NOT_APPROVED,Jm.COMPLETED,Jm.DRAFT,Jm.FINAL,Jm.VOID,Jm.CONFIDENTIAL,Jm.INITIAL_HERE,Jm.SIGN_HERE,Jm.WITNESS];return[Iv,bv,Cv,Av,Sv,Tv,Ev,kv,_v,Pv,Dv,Rv][e.indexOf(t)]}var Ov;!function(t){t.HIGHLIGHT="highlight",t.UNDERLINE="underline",t.STRIKEOUT="strikeout"}(Ov||(Ov={}));class Bv extends Mv{constructor(t,e){super({...t}),na(this,"stampType","textAssist"),na(this,"textAssistType",void 0),na(this,"annotationRaw",void 0),this.textAssistType=e,this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}class Fv extends Mv{constructor(t){super({...t}),na(this,"stampType","raw"),na(this,"annotationRaw",void 0),this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}function Nv(t,e,i){var n;(i instanceof av||i instanceof lv||i instanceof rv)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls())}function Uv(t,e,i){t!==e&&i.childNodes.length>0&&i.childNodes.forEach((t=>{t&&t.style&&(t.style.opacity=e)}))}function Vv(t,e,i){var n;(i instanceof cv||i instanceof yv||i instanceof xv)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls())}function Wv(t,e,i){if(!(i instanceof yv||i instanceof xv||i instanceof wv||i instanceof cv))return;if(t===e)return;const{x:n,y:s}=i.getBoundingRect();i.updatePosition(n,s),i.updateOrigin()}function Hv(t,e,i){var n;(i instanceof dv||i instanceof gv)&&t!==e&&(null===(n=i.context)||void 0===n||n.updateControls())}function jv(t,e,i){var n;i instanceof wv&&t!==e&&(null==i||null===(n=i.context)||void 0===n||n.updateControls())}function zv(t,e,i){i instanceof gv&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.textEditEventHandler.updateTextSelection(),i.updateCursor(),i.hooks.reRenderText.emit())}function Gv(t,e,i){i instanceof gv&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.textEditEventHandler.updateTextSelection(),i.hooks.reRenderText.emit())}const Yv={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class $v{constructor(t){na(this,"eraserPath",void 0),na(this,"erasedShapeIds",[]),na(this,"selectionBox",void 0),na(this,"startCanvasPoint",void 0),na(this,"startLocalPoint",void 0),na(this,"lastMovePoint",void 0),na(this,"resetActivatedZIndex",!0),na(this,"isSeparateText",!1),na(this,"lastClickPointerType",""),na(this,"drawType","annotationRect"),na(this,"isStartEdit",!1),na(this,"isStartDraw",!1),na(this,"controller",void 0),na(this,"eventArea",void 0),na(this,"eventMode","none"),na(this,"defaultGroup",void 0),na(this,"activatedShape",void 0),na(this,"activatedZIndex",0),na(this,"drawLineShape",!1),na(this,"stampPreview",void 0),na(this,"inkDelayTimeout",void 0),na(this,"drawInkShape",!1),na(this,"isArrowKeyDown",!1),this.controller=t,this.defaultGroup=new fv("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5}isDefaultGroup(t){return t===this.defaultGroup}getDrawInitStyle(t,e){var i,n;let s={};const{defaultStyleConfig:o,eraserStyle:r,selectionStyle:a}=this.controller.interactiveConfig,l={x:e.x,y:e.y};let h=[{...tv.textContent,..."annotationFreeText"===t?null==o||null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent:null==o||null===(n=o.textBox)||void 0===n?void 0:n.textContent}];switch(""===h[0].content&&(h=[]),t){case"annotationInk":s={lineCap:"round",lineJoin:"round",segments:[[e]]};break;case"annotationPolygon":case"annotationPolyline":s={points:[e]};break;case"annotationLine":s={startPoint:e,endPoint:e};break;case"annotationFreeText":case"annotationTextBox":s={...l,textContents:h};break;default:s=l}let c={...tv,...o[Yv[t]]||{}};return"select"===this.eventMode?c={...a,zIndex:999}:"erase"===this.eventMode&&(c=r),{...c,...s}}getDrawUpdateStyle(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(this.startLocalPoint.x+e.x)/2,s=(this.startLocalPoint.y+e.y)/2,o=e.x-this.startLocalPoint.x,r=e.y-this.startLocalPoint.y;const a=["annotationCircle","annotationEllipse"].includes(t),l=Math.min(Math.abs(o),Math.abs(r));i&&(o=e.x>=this.startLocalPoint.x?l:-l,r=e.y>=this.startLocalPoint.y?l:-l,a&&(n=(2*this.startLocalPoint.x+o)/2,s=(2*this.startLocalPoint.y+r)/2));let h={};switch(t){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":h={x:n,y:s,r:l};break;case"annotationEllipse":h={x:n,y:s,rx:Math.abs(o)/2,ry:Math.abs(r)/2};break;case"annotationLine":h={endPoint:e};break;default:h={width:o,height:r}}return h}limitPoint(t,e,i){if(!this.eventArea)return;const{x:n,y:s,width:o,height:r}=this.eventArea;let a=0,l=0,h=0;if(e){const{lastHitControlPoint:t,lastHitControlPointCenter:e}=this.activatedShape.context;t&&e&&(l=t.x-e.x,h=t.y-e.y)}else a=Vm(i)?i.parsedStyle.borderWidth.value*i.getScale().x:0;t.x<n+a+l&&(t.x=n+a+l),t.y<s+a+h&&(t.y=s+a+h),t.x>n+o+l&&(t.x=n+o+l),t.y>s+r+h&&(t.y=s+r+h)}executeErase(){var t;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(t=this.eraserPath)||void 0===t?void 0:t.id],!1),this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[])}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:t,containerId:e}=this.controller,i=[],n=t.get(e),{width:s,height:o}=this.selectionBox.parsedStyle;if(s.value<2&&o.value<2){const t=[];n.forEach((e=>{if("hidden"===e.style.visibility||!e.context.controlsFlags.enableControl||e===this.selectionBox||"annotationGroup"===e.shapeType)return;const i=Um(e,this.startCanvasPoint);!e.context.isGrouped&&e.isPointInPath(i,this.getHitBorderOffset(e))&&t.push(e)})),t.length&&(t.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),i.push(t[t.length-1]))}else n.forEach((t=>{"annotationGroup"!==t.shapeType&&"visible"===t.style.visibility&&t.context.controlsFlags.enableControl&&t!==this.selectionBox&&function(t,e){e.controls||e.context.initControls(),e.context.renderControls();const i=e.controls.controlPoints.slice(0,4),n=[];for(let t=0;t<4;t++){const{x:e,y:s}=i[t].getPosition();n.push({x:e,y:s})}const{x:s,y:o}=t.getPosition(),{width:r,height:a}=t.parsedStyle,l=Math.abs(t.getScale().x),h=Math.abs(t.getScale().y);return function(t,e){const i={x1:Math.min(...e.map((t=>t.x))),y1:Math.min(...e.map((t=>t.y))),x2:Math.max(...e.map((t=>t.x))),y2:Math.max(...e.map((t=>t.y)))};return!!function(t,e){return!(t.x2<e.x1||e.x2<t.x1||t.y2<e.y1||e.y2<t.y1)}(t,i)&&function(t,e){const i=e,n=[];for(let t=0;t<i.length;t++){const e=(t+1)%i.length;n.push({p1:i[t],p2:i[e]})}for(const e of n){const n={x:e.p2.y-e.p1.y,y:e.p1.x-e.p2.x},s=Math.min(jm(n,{x:t.x1,y:t.y1}),jm(n,{x:t.x1,y:t.y2}),jm(n,{x:t.x2,y:t.y1}),jm(n,{x:t.x2,y:t.y2})),o=Math.max(jm(n,{x:t.x1,y:t.y1}),jm(n,{x:t.x1,y:t.y2}),jm(n,{x:t.x2,y:t.y1}),jm(n,{x:t.x2,y:t.y2})),r=Math.min(jm(n,i[0]),jm(n,i[1]),jm(n,i[2]),jm(n,i[3])),a=Math.max(jm(n,i[0]),jm(n,i[1]),jm(n,i[2]),jm(n,i[3]));if(o<r||a<s)return!1}return!0}(t,e)}({x1:s,y1:o,x2:s+r.value*l,y2:o+a.value*h},n)}(this.selectionBox,t)&&i.push(t)}));1===i.length?this.selectShapes([i[0]]):i.length>1?this.selectShapes(i):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender()}activateShape(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||"hidden"===t.style.visibility||!t.context.controlsFlags.enableControl)return;if(this.activatedShape===t&&t.context.isActive)return;const{showOnTopWhenSelected:n}=this.controller.interactiveConfig;var s;this.activatedShape&&this.activatedShape!==t&&(e?(n&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(s=this.activatedShape)||void 0===s?void 0:s.parentNode)===(null==t?void 0:t.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape()),this.activatedShape=t,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),n&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||t.context.initControls(),t.context.renderControls(),Wm(t)&&t.pointEventsHandler.enableEditMode(),this.isDefaultGroup(t)&&t.showAllControls(),e||this.controller.hooks.emitSelectAnnotation(t),i&&this.controller.hooks.emitAnnotationRender()}inactivateShape(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:i}=this.controller.interactiveConfig;if(i&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof cv&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof gv&&"freeTextWriter"===this.activatedShape.textType){const{textContents:t}=this.activatedShape.style;let e="";t.forEach((t=>{e+=(null==t?void 0:t.content)||""})),0===e.length&&this.controller.deleteShape([this.activatedShape.id],!0)}this.isArrowKeyDown&&(this.isArrowKeyDown=!1,this.controller.hooks.emitModifyAnnotation(["moved"],[this.activatedShape]),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape)),this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),t&&this.controller.hooks.emitSelectAnnotation(null,e)}setEventArea(t){this.eventArea=t,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea)}setEventMode(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof cv&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const t=[...this.activatedShape.style.points];Xd()||t.pop(),this.activatedShape.style.points=t}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=t,this.drawType=e,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==t&&(this.inactivateShape(!0),"erase"===t&&(this.drawType="annotationInk"),"select"===t&&(this.drawType="annotationRect"))}getFreeTextLimitWidth(t,e,i,n,s,o){const r=t,a=e,l=Math.round(i),h=Math.round(o);if(!r)return 0;let c=r,d=n;if(h!==l){if(0===h)switch(l){case 90:return s;case 180:return n;case-90:c=a,d=s}if(-90===h)switch(l){case 0:return s;case 90:return n;case 180:c=a,d=s}if(180===h||-180===h)switch(l){case 0:return n;case-90:return s;case 90:c=a,d=s}if(90===h)switch(l){case 180:return s;case-90:return n;case 0:c=a,d=s}}let u=c-d;return u<0&&(u=c),u}selectShapes(t){const e=[];return t.forEach((t=>{"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&e.push(t)})),this.inactivateShape(!t.length),!!e.length&&(this.defaultGroup.clear(),1===e.length?this.activateShape(e[0],!1,!0):(e.forEach((t=>{this.defaultGroup.add(t)})),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(t){if("none"!==this.eventMode)return;if(!this.activatedShape)return;const{offsetX:e,offsetY:i}=zm(this.controller.canvas,t),n={x:e,y:i};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(n,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape)}editMoveHandler(t){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:e,offsetY:i}=zm(this.controller.canvas,t),n={x:e,y:i};this.limitPoint(n,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(n,Ru(t)),this.controller.hooks.emitAnnotationRender()}editEndHandler(t){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape))}drawStartHandler(t){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==t.pointerType&&"pen"!==t.pointerType||this.drawStampMoveHandler(t,!1));if(!this.eventArea)return;const{controller:e}=this,{drawType:i,drawLineShape:n,eventMode:s}=this,{offsetX:o,offsetY:r}=zm(e.canvas,t),{x:a,y:l,width:h,height:c}=this.eventArea;if(o<a||o>a+h||r<l||r>l+c)return;const d={x:o,y:r},u=e.container.getWorldTransform().inverse().transformPoint(d);if(this.isStartDraw=!0,this.startCanvasPoint=d,this.startLocalPoint=u,this.lastMovePoint=null,"select"===s&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===s&&(n||this.drawInkShape)){const e=this.activatedShape instanceof cv;return e&&this.activatedShape.addSegment(),this.activatedShape.addPoint(u),void(e||"touch"!==t.pointerType&&"pen"!==t.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(i)&&(this.drawLineShape=!0),"draw"===s&&-1!==["annotationInk"].indexOf(i)&&(this.drawInkShape=!0);const p={style:this.getDrawInitStyle(this.drawType,u)};if("annotationFreeText"===this.drawType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),p.style.x-t.left||0,p.style.y-t.top||0,0);p.style.width=e||p.style.width}const g=this.controller.addShape(this.drawType,p,!1);g.style.zIndex=999;const f=()=>{0!==this.controller.container.getAngle()&&Xv(g)&&(g.setAngle(0),g.setPosition(d))},{container:m}=this.controller;if("draw"===s)this.controller.hooks.emitBeforeAnnotationDraw(g),f();else if("erase"===s){if(g.style.background=null,m){const t=g.style.borderWidth/m.getScale().x;g.style.borderWidth=t}this.eraserPath=g}else{if(m){const t=g.style.borderWidth/m.getScale().x;g.style.borderWidth=t}this.selectionBox=g,f()}this.activatedShape=g,this.controller.hooks.emitAnnotationRender()}drawMoveHandler(t,e){const{activatedShape:i,eventMode:n,isStartDraw:s,drawType:o}=this;if("none"===n)return;if("draw"===n&&"annotationStamp"===o)return void this.drawStampMoveHandler(t,e);if("draw"===n&&"annotationFreeText"===o)return;if(!s)return;const{offsetX:r,offsetY:a}=zm(this.controller.canvas,t),l={x:r,y:a};this.limitPoint(l,!1,this.activatedShape);const h=this.controller.container.getWorldTransform().inverse().transformPoint(l);if("annotationPolyline"===o||"annotationPolygon"===o){const t=Wd(i.parsedStyle.points),e=t.length;1===e?t[e]=h:t[e-1]=h,i.style.points=t}else if("annotationInk"===o)i.addPoint(h);else{const e=this.getDrawUpdateStyle(this.drawType,h,Ru(t)),n=this.controller.container.getAngle();if(0!==n&&Xv(i)){if(90===Math.abs(Math.round(n))){const t=e.width;e.width=e.height,e.height=t}e.width=l.x-this.startCanvasPoint.x>0?Math.abs(e.width):-Math.abs(e.width),e.height=l.y-this.startCanvasPoint.y>0?Math.abs(e.height):-Math.abs(e.height),i.updateStyle(e),i.setPosition({...this.startCanvasPoint})}else i.updateStyle(e)}this.controller.hooks.emitAnnotationRender()}drawStampMoveHandler(t,e){const{offsetX:i,offsetY:n}=zm(this.controller.canvas,t),s={x:i,y:n},o=this.controller.container.getRootNode(),r=o.getWorldTransform().inverse().transformPoint(s),a=()=>{if(!this.stampPreview)return;const i=this.stampPreview.getBoundingRect(),n=(null==t?void 0:t.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!e&&n?"visible":"hidden",this.stampPreview.setLocalPosition(r.x-i.width/2,r.y-i.height/2)};if(!this.stampPreview){const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==tv?void 0:tv.stampIcon),n=(null==e?void 0:e.imageData)||(null==tv?void 0:tv.imageData),s=(null==e?void 0:e.stampConfig)||null;if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:s?null:i,imageData:n,stampConfig:s,opacity:qd(e.opacity)?e.opacity:.5,zIndex:9999},initByDraw:!0}),o.appendChild(this.stampPreview),!n&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i)}this.stampPreview.hooks.reRenderImage.on((()=>{this.controller.hooks.emitAnnotationRender()}))}else this.stampPreview.hooks.reRenderImage.on((()=>{"visible"===this.stampPreview.style.visibility&&a(),this.controller.hooks.emitAnnotationRender()}))}a(),this.controller.hooks.emitAnnotationRender()}eraseMoveHandler(t){const{eraserStyle:e}=this.controller.interactiveConfig,{eventMode:i,isStartDraw:n,erasedShapeIds:s,controller:o}=this;if("erase"!==i||!o.container||!n)return;const r=o.shapeArrMap.get(o.containerId);if(!r.size)return;const{offsetX:a,offsetY:l}=zm(o.canvas,t),h={x:a,y:l};this.lastMovePoint||(this.lastMovePoint=h),r.forEach((t=>{t!==this.eraserPath&&-1===s.indexOf(t.id)&&"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&function(t,e,i){const n=Um(t,e),s=cu(e,i),o=t.isPointInPath(n,5);if(o||s<=.9)return o;const r=s/1,a=(e.x-i.x)/r,l=(e.y-i.y)/r;for(let e=0;e<Math.abs(r);e++){const n=Um(t,{x:i.x+a*e,y:i.y+l*e});if(t.isPointInPath(n,5))return!0}return!1}(t,h,this.lastMovePoint,e.borderWidth)&&(t.style.opacity=.5,s.push(t.id))})),this.lastMovePoint=h}drawEndHandler(t){const{eventMode:e,isStartDraw:i,drawLineShape:n,drawType:s,activatedShape:o,controller:r}=this;if("draw"===e&&"annotationStamp"===s)return void this.drawStampEndHandler(t);if("none"===e||!i||n)return;if(this.isStartDraw=!1,["annotationRect","annotationTextBox"].includes(s)){const{width:t,height:e,borderWidth:i}=o.parsedStyle,{x:n,y:s}=o.getPosition(),{x:r,y:a}=o.getScale(),l=(null==i?void 0:i.value)||0;let h=n,c=s;t.value<0&&(h=n-(-t.value+l)*r,o.style.width=-t.value+2*l),e.value<0&&(c=s-(-e.value+l)*a,o.style.height=-e.value+2*l),o.setPosition({x:h,y:c})}if("draw"===e&&this.drawInkShape)return o.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?r.hooks.emitAddAnnotation("draw",[this.activatedShape]):r.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout((()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof cv&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)))}),this.controller.interactiveConfig.inkCreateDelay));if("draw"===e&&"annotationFreeText"!==s&&"annotationStamp"!==s){const{offsetX:e,offsetY:i}=zm(r.canvas,t);((this.startCanvasPoint.x-e)**2+(this.startCanvasPoint.y-i)**2)**.5<2&&"annotationStamp"!==o.shapeType&&(r.deleteShape([o.id],!1),r.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null)}const a=(t,e)=>{if(t instanceof gv){const{enableControl:i}=t.context.controlsFlags;if(!i)return;t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e),"textBox"===t.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===t.textType&&setTimeout((()=>{document.activeElement instanceof HTMLTextAreaElement||t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e)}),10)}};if("draw"===e&&this.activatedShape){const t=this.activatedShape,{canvas:e}=this.controller;r.hooks.emitAddAnnotation("draw",[this.activatedShape]),r.interactiveConfig.enableContinuousDrawing?o instanceof gv?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),r.hooks.emitAfterAnnotationDraw(t),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e))}"erase"===e&&this.executeErase(),"select"===e&&this.executeBoxSelect()}drawStampEndHandler(t){const{offsetX:e,offsetY:i}=zm(this.controller.canvas,t);if(!this.stampPreview)return;if(!this.eventArea)return;if(this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return void(this.stampPreview.style.visibility="hidden");const{x:n,y:s,width:o,height:r}=this.eventArea;if(e<n||e>o+n||i<s||i>r+s)return;const{defaultStyleConfig:a}=this.controller.interactiveConfig,{stamp:l}=a,h=qd(null==l?void 0:l.opacity)?null==l?void 0:l.opacity:null==tv?void 0:tv.opacity,c=this.stampPreview;c.style.opacity=h;const{containerId:d,container:u,shapeArrMap:p}=this.controller,g={...c.getPosition()},f={...c.getScale()},m=u.getScale(),v=f.x/m.x,y=f.y/m.y;if(p.get(d).set(c.id,c),c.index=p.get(d).size,c.pageUid=d,u.appendChild(c),c.style.imageData){const{width:t,height:e}=c.parsedStyle;c.updateStyle({width:t.value*v,height:e.value*y}),c.setLocalScale(1,1)}else c.setLocalScale(v,y);c.setAngle(0),c.setPosition(g),this.stampPreview=null,this.activatedShape=c,this.controller.hooks.emitBeforeAnnotationDraw(c),this.controller.hooks.emitAddAnnotation("draw",[c]),this.controller.interactiveConfig.enableContinuousDrawing?Xd()&&this.createStampPreviewForMobile():(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(c,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(c))}dblClickHandler(t){const{activatedShape:e,controller:i}=this;if(!e)return;const{shapeType:n}=e;if(this.drawLineShape&&("annotationPolygon"===n||"annotationPolyline"===n)){const t=[...e.style.points],n=t.length;return Xd()?cu(t[n-1],t[n-2])<=15&&t.pop():t.pop(),"mouse"===this.lastClickPointerType&&(t.pop(),this.lastClickPointerType=""),t.length<2?(i.deleteShape([e.id],!1),this.activatedShape=null):(e.style.points=t,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!i.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(e),this.resetActivatedZIndex=!1,this.activateShape(e,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===n&&!this.isSeparateText){const{offsetX:i,offsetY:n}=zm(this.controller.canvas,t),{textEditEventHandler:s}=e,o={x:i,y:n};if(this.activatedShape instanceof gv&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-t.left,this.activatedShape.getLocalPosition().y-t.top,this.activatedShape.getAngle());e!==this.activatedShape.style.width&&(this.activatedShape.style.width=e)}s.enableEditMode(o,this.controller.canvas),this.controller.hooks.emitAnnotationRender()}}clickHandler(t){const{activatedShape:e,eventMode:i}=this;if(!e)return;const{shapeType:n}=e,s=()=>{if("annotationFreeText"===n){const{offsetX:i,offsetY:n}=zm(this.controller.canvas,t),{textEditEventHandler:s}=e,o={x:i,y:n};s.editClickHandler(o,this.controller.canvas)}};if(this.lastClickPointerType=null==t?void 0:t.pointerType,this.isSeparateText=!1,"none"===i){if(ku(t)&&this.controller.interactiveConfig.enableMultipleSelectWidthCtrl){if(this.isDefaultGroup(e)){const{clickedShape:t}=e;this.defaultGroup.delete(t);const{shapes:i}=this.defaultGroup;if(i.length<2&&(this.defaultGroup.context.isActive=!1),1===i.length){const t=i[0];this.activateShape(t,!1,!1),this.isSeparateText=t instanceof gv}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(e),s());return void this.controller.hooks.emitAnnotationRender()}s()}}keyDownHandler(t,e){const{activatedShape:i}=this;if(!i)return;const n=()=>{if(this.isStartDraw&&(this.isStartDraw=!1),this.drawLineShape)return this.drawLineShape=!1,this.controller.deleteShape([this.activatedShape.id]),void this.controller.hooks.emitAnnotationRender();this.inactivateShape(!0),this.defaultGroup.clear()};switch(t.code){case"Escape":n();break;case"Delete":case"Backspace":if(Hm(i)&&i.textEditEventHandler.editMode)return;if(!this.controller.interactiveConfig.enableDeleteWithKeyboard)return;if(this.drawInkShape||this.drawLineShape)return;t.preventDefault(),this.controller.deleteShape([i.id]),this.inactivateShape();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(!this.controller.interactiveConfig.enableMoveWithKeyboard)return;if(i instanceof gv&&i.isEditMode)return;if(this.drawInkShape||this.drawLineShape)return;this.isArrowKeyDown=!0,i.eventHandler.moveByKeyboard(t,e)&&(this.controller.hooks.emitBeforeAnnotationEdit(i),this.controller.hooks.emitAnnotationRender())}}keyUpHandler(t){this.isArrowKeyDown&&(this.isArrowKeyDown=!1,["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.code)&&(this.controller.hooks.emitModifyAnnotation(["moved"],[this.activatedShape]),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape)))}getHitBorderOffset(t){if(!t)return 10;const e=t.getScale();if(e.x<1||e.y<1){const t=Math.min(e.x,e.y);return Math.round(Math.abs(10/t))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==tv?void 0:tv.stampIcon),n=(null==e?void 0:e.imageData)||(null==tv?void 0:tv.imageData),s=(null==e?void 0:e.stampConfig)||null,o=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:s?null:i,imageData:n,stampConfig:s,opacity:qd(e.opacity)?e.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),o.appendChild(this.stampPreview),!n&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i)}}}}function Xv(t){return["annotationFreeText","annotationTextBox","annotationRect"].includes(t.shapeType)}var qv,Zv,Jv=new WeakMap;class Kv extends Ju{constructor(){super(...arguments),na(this,"renderAnnotation",tp(this)),na(this,"addAnnotation",tp(this)),na(this,"deleteAnnotation",tp(this)),na(this,"selectAnnotation",tp(this)),na(this,"modifyAnnotation",tp(this)),na(this,"annotationModeChanged",tp(this)),na(this,"beforeAnnotationEdit",tp(this)),na(this,"afterAnnotationEdit",tp(this)),na(this,"beforeAnnotationDraw",tp(this)),na(this,"afterAnnotationDraw",tp(this)),na(this,"annotationTextContentUpdated",tp(this)),na(this,"selectAnnotationTextChars",tp(this)),na(this,"enableAnnotationTextEditMode",tp(this)),na(this,"disableAnnotationTextEditMode",tp(this)),ma(this,Jv,{writable:!0,value:[]})}emitAddAnnotation(t,e){const i=[];e.forEach((t=>{i.push({uid:t.id,shape:t})})),this.addAnnotation.emit({action:t,shapes:i})}emitDeleteAnnotation(t){const e=[];t.forEach((t=>{e.push({uid:t.id,shape:t})})),this.deleteAnnotation.emit({shapes:e})}emitSelectAnnotation(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];t instanceof fv?t.shapes.forEach((t=>{i.push(t.id)})):t&&i.push(t.id),(i.length||sa(this,Jv).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...i],oldAnnotationsUids:[...sa(this,Jv)],emitSelected:e}),oa(this,Jv,i))}emitModifyAnnotation(t,e){const i=[];e.forEach((t=>{t instanceof fv?t.shapes.forEach((t=>{i.push({uid:t.id,shape:t})})):i.push({uid:t.id,shape:t})})),this.modifyAnnotation.emit({actions:t,shapes:i})}emitAnnotationModeChanged(t){this.annotationModeChanged.emit(t)}emitBeforeAnnotationEdit(t){t instanceof gv&&t.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(t)}emitAfterAnnotationEdit(t){this.afterAnnotationEdit.emit(t)}emitAnnotationRender(){this.renderAnnotation.emit()}emitSelectAnnotationTextChar(t){this.selectAnnotationTextChars.emit(t)}emitBeforeAnnotationDraw(t){this.beforeAnnotationDraw.emit(t)}emitAfterAnnotationDraw(t){this.afterAnnotationDraw.emit(t)}emitEnableAnnotationTextEditMode(t){this.enableAnnotationTextEditMode.emit(t)}emitDisableAnnotationTextEditMode(t){this.disableAnnotationTextEditMode.emit(t)}emitAnnotationTextContentUpdated(t){this.annotationTextContentUpdated.emit(t)}}class Qv{constructor(t){na(this,"shapeArrMap",void 0),na(this,"shapeMap",void 0),na(this,"annotationMode","none"),na(this,"brush","annotationRect"),na(this,"tempTextStyle",void 0),na(this,"canvas",void 0),na(this,"hooks",void 0),na(this,"interactiveConfig",Wd(iv)),na(this,"eventService",void 0),na(this,"containerId",void 0),na(this,"container",void 0),_f.bindHandler(["opacity"],void 0,Uv),_f.bindHandler(["width","height","borderWidth"],void 0,Hv),_f.bindHandler(["startPoint","endPoint","lineEnding"],void 0,jv),_f.bindHandler(["r","rx","ry","borderWidth"],void 0,Nv),_f.bindHandler(["points","segments"],void 0,Vv),_f.bindHandler(["borderWidth"],void 0,Wv),_f.bindHandler(["textContents","borderWidth","textAlign"],void 0,zv),_f.bindHandler(["textAlign"],void 0,Gv),this.canvas=t,this.eventService=new $v(this),this.hooks=new Kv,this.shapeArrMap=new Map,this.shapeMap=new Map}set drawType(t){this.brush=t,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",t)}get drawType(){return this.brush}bindFreeTextHooks(t){if(!(t instanceof gv))return;const e=t.hooks;let i;e.reRenderText.on((()=>{this.hooks.emitAnnotationRender()})),e.textContentUpdated.on((()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[t])})),e.textContentUpdatedByChar.on((()=>{this.hooks.emitAnnotationTextContentUpdated(t)})),e.selectTextChars.on((e=>{var n;if(e.startChar===e.endChar&&t.isSameChar(i,e.endChar)&&!e.needUpdate)return;const{freeTextContentStyle:s}=t,o="freeTextWriter"===t.textType?"textTypewriter":"textBox",{defaultStyleConfig:r}=this.interactiveConfig;r[o]||(r[o]={}),r[o].textContent={...s,content:null===(n=r[o])||void 0===n||null===(n=n.textContent)||void 0===n?void 0:n.content},i=e.endChar,this.hooks.emitSelectAnnotationTextChar(t)})),e.enableTextEditMode.on((e=>{this.tempTextStyle=Wd(this.interactiveConfig.defaultStyleConfig["textBox"===t.textType?"textBox":"textTypewriter"]),this.hooks.emitEnableAnnotationTextEditMode(t)})),e.disableTextEditMode.on((e=>{this.interactiveConfig.defaultStyleConfig["textBox"===t.textType?"textBox":"textTypewriter"]=this.tempTextStyle,this.tempTextStyle=null,i=null,this.hooks.emitDisableAnnotationTextEditMode(t)}))}bindStampHooks(t){t instanceof Mv&&t.hooks.reRenderImage.on((()=>{this.hooks.emitAnnotationRender()}))}isHitShape(t){const{offsetX:e,offsetY:i}=zm(this.canvas,t),{activatedShape:n,defaultGroup:s}=this.eventService,o={x:e,y:i},{shapeArrMap:r,shapeMap:a,containerId:l}=this,h=r.get(l)||a,c=s===this.eventService.activatedShape&&(null==s?void 0:s.parentNode)===this.container;if(n&&(c||h.has(n.id))){const t=n.eventHandler.isHit(o,!1);if(-1!==t)return{isHit:!0,isHitSelected:!0,hitControlPointIndex:t,shape:n}}const d=[];let u=!1,p=null;return h.forEach((t=>{if("hidden"===t.style.visibility||!t.context.controlsFlags.enableControl||t===n)return;const e=Um(t,o);!t.context.isGrouped&&t.isPointInPath(e,this.eventService.getHitBorderOffset(t))&&(u=!0,d.push(t))})),u&&(d.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),p=d[d.length-1]),{isHit:u,shape:p,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return!!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof gv)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=t,this.eventService.setEventMode(t,this.drawType),Xd()&&"draw"===t&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==t&&this.eventService.inactivateShape(),e&&this.hooks.emitAnnotationModeChanged(t)}setAnnotationContainer(t,e){if(e!==this.container){const{activatedShape:t,drawLineShape:e,drawInkShape:i,drawType:n}=this.eventService;if("draw"===this.eventService.eventMode&&t){if(i&&t instanceof cv&&(clearTimeout(this.eventService.inkDelayTimeout),t.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),e){const e=[...t.style.points];t.style.points=e,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1}"annotationInk"!==n&&(this.hooks.emitAddAnnotation("draw",[t]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(t)),this.eventService.activatedShape=null)}}this.containerId=t,this.container=e,this.shapeArrMap.get(t)||this.shapeArrMap.set(t,new Map)}setAnnotationInteractiveConfig(t){if(this.tempTextStyle){const e=this.eventService.activatedShape;if(e instanceof gv){const i=t.defaultStyleConfig["textBox"===e.textType?"textBox":"textTypewriter"];if(i){const t=this.tempTextStyle.textContent;this.tempTextStyle={...this.tempTextStyle,...i},this.tempTextStyle.textContent={...t,...i.textContent}}}}const e=Wd(t),{controlsStyle:i,defaultStyleConfig:n,eraserStyle:s,selectionStyle:o}=this.interactiveConfig;e.defaultStyleConfig=(null==e?void 0:e.defaultStyleConfig)||{};const{stamp:r}=n,{stamp:a}=e.defaultStyleConfig,l=(null==r?void 0:r.stampIcon)||tv.stampIcon,h=null==r?void 0:r.stampConfig,c=(null==r?void 0:r.imageData)||tv.imageData,d=null==a?void 0:a.stampIcon,u=null==a?void 0:a.stampConfig,p=null==a?void 0:a.imageData;this.interactiveConfig={...this.interactiveConfig,...e,controlsStyle:ju((null==e?void 0:e.controlsStyle)||{},i),defaultStyleConfig:ju((null==e?void 0:e.defaultStyleConfig)||{},n),eraserStyle:ju((null==e?void 0:e.eraserStyle)||{},s),selectionStyle:ju((null==e?void 0:e.selectionStyle)||{},o)},(d||u||p)&&(p||(this.interactiveConfig.defaultStyleConfig.stamp.imageData=null),u||(this.interactiveConfig.defaultStyleConfig.stamp.stampConfig=null)),null!=e&&e.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:g}=this.eventService;var f;g&&g.style.opacity!==(null==a?void 0:a.opacity)&&(this.eventService.stampPreview.style.opacity=null==a?void 0:a.opacity),l===d&&c===p&&h===u||!this.eventService.stampPreview||(null===(f=this.eventService.stampPreview)||void 0===f||f.destroy(),this.eventService.stampPreview=null)}setAnnotationFlags(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.getShape(t);if(!(n instanceof Fv||n instanceof Bv)&&n){n!==this.eventService.activatedShape||!1!==e.enableControl&&!1!==e.isVisible||this.eventService.inactivateShape(!0),n.context.updateControlsFlags({...e});const{isVisible:t,enableControl:s,enableEdit:o}=n.context.controlsFlags;if(n.context.isInGroup&&(!t||!s)){const{defaultGroup:t,activatedShape:e}=this.eventService;t.delete(n),e===t&&1===t.shapes.length&&this.eventService.activateShape(t.shapes[0],!1,!0)}Wm(n)&&n.pointEventsHandler.editMode&&!o&&(n.pointEventsHandler.disableEditMode(),n.pointEventsHandler.enableEditMode()),i&&this.hooks.emitAnnotationRender()}}getShape(t){if("ddvDefaultGroup"===t)return this.eventService.defaultGroup;return this.shapeMap.get(t)||null}getSelectedShapeUids(){const{activatedShape:t}=this.eventService;if(!t)return[];const e=[];return t instanceof fv?t.shapes.forEach((t=>{e.push(t.id)})):e.push(t.id),e}createShape(t,e){var i,n;let s;if(e.selectableStyle={...this.interactiveConfig.controlsStyle,...e.selectableStyle},"annotationEllipse"===t){const{style:t}=e;t.x+=t.width/2||0,t.y+=t.height/2||0,t.rx=t.width/2||t.rx,t.ry=t.height/2||t.ry}const{defaultStyleConfig:o}=this.interactiveConfig;switch(t){case"annotationRect":s=new dv(e);break;case"annotationGroup":s=new fv(null==e?void 0:e.id);break;case"annotationArc":s=new rv(e);break;case"annotationCircle":s=new av(e);break;case"annotationEllipse":s=new lv(e);break;case"annotationLine":s=new wv(e);break;case"annotationInk":s=new cv(e);break;case"annotationPolygon":s=new yv(e);break;case"annotationPolyline":s=new xv(e);break;case"annotationFreeText":s=new gv(e,"freeTextWriter",{...tv.textContent,...null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent});break;case"annotationTextBox":s=new gv(e,"textBox",{...tv.textContent,...null===(n=o.textBox)||void 0===n?void 0:n.textContent});break;case"annotationImage":s=new hv(e);break;case"annotationStamp":s=new Mv(e);break;case"annotationHighlight":s=new Bv(e,Ov.HIGHLIGHT);break;case"annotationUnderline":s=new Bv(e,Ov.UNDERLINE);break;case"annotationStrikeout":s=new Bv(e,Ov.STRIKEOUT);break;default:s=new Fv(e)}return s?(s.id||(s.id=Qd()),this.shapeMap.set(s.id,s),s):null}addShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=e&&e.id){const t=this.getShape(null==e?void 0:e.id);if(t)return t}const n=this.createShape(t,e);return this.containerId&&this.shapeArrMap.get(this.containerId).set(n.id,n),this.container&&(n.index=this.shapeArrMap.get(this.containerId).size,n.pageUid=this.containerId,this.container.appendChild(n),i&&this.hooks.emitAddAnnotation("data",[n])),this.bindFreeTextHooks(n),this.bindStampHooks(n),n}updateShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.getShape(t);if(!n)return!1;const{isGrouped:s}=n.context;if(s&&this.eventService.defaultGroup.delete(n),null!=e&&e.style)if(n instanceof Mv)n.updateStampStyle({...e.style});else{if(n instanceof lv){const{x:t,y:i,width:s,height:o}=e.style,{x:r,y:a}=n.getLocalPosition(),l=s?mg(s).value/2:0,h=o?mg(o).value/2:0,c=qd(t)?t+l:r,d=qd(i)?i+h:a,u=l||n.style.rx,p=h||n.style.ry;e.style={...e.style,x:c,y:d,rx:u,ry:p}}n.updateStyle({...e.style})}if(null!=e&&e.transform){const{angle:t,scale:i}=e.transform;Hd(t)||n.setLocalAngle(t),Hd(i)||n instanceof Mv||n.setLocalScale(i)}return i&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[n]),s&&this.eventService.defaultGroup.add(n),!0}updateAllShapeControlsStyle(t){let e=!1;this.shapeMap.forEach((i=>{i.context.controlsStyle=t,i.context.parseControlsStyle(),i.controls&&(i.controls.isVisible&&(e=!0),i.context.destroyControls(),i.context.initControls(),i.context.renderControls())})),e&&this.hooks.emitAnnotationRender()}updateFreeTextDefaultConfig(){const{defaultStyleConfig:t}=this.interactiveConfig;this.shapeMap.forEach((e=>{if(e instanceof gv){const i=tv.textContent,n="freeTextWriter"===e.textType?"textTypewriter":"textBox",{textContent:s}=t[n]||{};e.updateFreeTextContentStyle({...i,...s,content:i.content})}}))}updateLayer(t,e){const i=this.getShape(t);return!!i&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===i?this.eventService.activatedZIndex=e:i.updateStyle({zIndex:e}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&i.updateStyle({zIndex:e}),!0)}deleteShape(t){var e;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=[],{eventService:o}=this,r=t.includes(null==o||null===(e=o.activatedShape)||void 0===e?void 0:e.id);if(t.forEach((t=>{const e=this.getShape(t);e&&(e instanceof fv?(s.push(...e.shapes),e.clear()):s.push(e))})),!s.length)return!1;i&&this.hooks.emitDeleteAnnotation(s),s.forEach((t=>{t.context.isInGroup&&this.eventService.defaultGroup.delete(t),this.shapeMap.delete(t.id),this.shapeArrMap.get(t.pageUid)&&this.shapeArrMap.get(t.pageUid).delete(t.id),t.destroy()}));const{activatedShape:a,defaultGroup:l}=o,h=a===l&&!l.state;return(r||h)&&this.eventService.inactivateShape(!0,n),!0}selectShape(t){const e=[];return t.forEach((t=>{e.push(this.getShape(t))})),this.eventService.selectShapes(e)}moveShape(t,e,i){t.forEach((t=>{const n=this.getShape(t);if(!n)return;const s=n.pageUid,o=this.shapeArrMap.get(s);o&&o.delete(t),this.shapeArrMap.get(e)||this.shapeArrMap.set(e,new Map),this.shapeArrMap.get(e).set(t,n),n.context.isGrouped&&n.parentNode.delete(n,!0),i.appendChild(n)}))}setShapeLayout(t,e){var i;if(!t.parentNode)return;const n=t.parentNode;let s,o;if(n instanceof Df)s=n.width,o=n.height;else{const{width:t,height:e}=Gm(n);s=t,o=e}const{x:r,y:a}=n.getLocalScale();n.scale(r<0?-1:1,a<0?-1:1);const l=n.getAngle(),{width:h,height:c}=Gm(t),{x:d,y:u}=n.getPosition(),{x:p,y:g}=t.getPosition(),{shapeType:f}=t;let m,v;if(n.setAngle(0),null!=n&&null!==(i=n.context)&&void 0!==i&&i.referencePoint){const{x:t,y:e}=n.context.referencePoint.getPosition();m=t,v=e}else m=d,v=u;switch(e){case"left":v=g;break;case"top":m=p;break;case"right":m+=s-h,v=g;break;case"bottom":m=p,v+=o-c;break;case"center":m+=s/2-h/2,v+=o/2-c/2;break;case"horizontal-center":m+=s/2-h/2,v=g;break;case"vertical-center":m=p,v+=o/2-c/2}const y=t.getAngle();t.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(f)&&(["left","right","horizontal-center"].includes(e)?m+=h/2:(["top","bottom","vertical-center"].includes(e)||(m+=h/2),v+=c/2)),t.setPosition({x:m,y:v}),t.setAngle(y),n.setAngle(l),n.scale(r<0?-1:1,a<0?-1:1),this.hooks.emitAnnotationRender()}clickHandler(t){this.eventService.clickHandler(t)}dblClickHandler(t){this.eventService.dblClickHandler(t)}keyDownHandler(t,e){this.eventService.keyDownHandler(t,e)}keyUpHandler(t){this.eventService.keyUpHandler(t)}startHandler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.isHitShape(t),n=ku(t)&&this.interactiveConfig.enableMultipleSelectWidthCtrl;if("none"===this.annotationMode&&e&&(i.isHit?this.eventService.activateShape(i.shape,n,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||i.isHit||this.annotationMode===this.eventService.eventMode){if("draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&i.isHit)this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,n,!0);else if("select"===this.annotationMode){const{isHitSelected:t,isHit:e}=i;t?this.eventService.setEventMode("none"):!t&&e&&n?(this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,n,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear())}}else this.eventService.setEventMode(this.annotationMode,this.brush);this.eventService.editStartHandler(t),this.eventService.drawStartHandler(t)}moveHandler(t,e){this.eventService.editMoveHandler(t),this.eventService.drawMoveHandler(t,e),this.eventService.eraseMoveHandler(t)}endHandler(t){this.eventService.editEndHandler(t),this.eventService.drawEndHandler(t)}cursorHandler(t,e,i){if(!this.container)return;if(!(t.target instanceof HTMLCanvasElement))return;if(e)return void(t.target.style.cursor=i);if(!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(t.target.style.cursor=i);if("erase"===this.eventService.eventMode)return void(t.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const n=this.isHitShape(t);if(this.eventService.isStartEdit){if(!n.isHitSelected||9!==n.hitControlPointIndex)return;t.target.style.cursor="move"}"draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType)?t.target.style.cursor="crosshair":n.isHit?n.isHitSelected?(9===n.hitControlPointIndex?t.target.style.cursor="move":t.target.style.cursor="grab",9===n.hitControlPointIndex&&n.shape instanceof gv&&n.shape.isEditMode&&(t.target.style.cursor="text")):t.target.style.cursor="pointer":"draw"===this.annotationMode?t.target.style.cursor="crosshair":t.target.style.cursor=i}}class ty extends xm{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls())}}class ey extends ty{constructor(t){super(t),this.close=!1}}class iy extends ty{render(t,e){super.render(t,e)}}class ny extends ty{}class sy extends Im{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()))}}class oy extends ty{}class ry extends Sm{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls())}}class ay extends _m{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls())}}class ly extends ty{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()))}}class hy extends Em{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()))}}class cy extends ty{}class dy extends xm{render(t,e){if("hidden"!==t.parsedStyle.visibility){if("stamp"===t.renderType)t.renderClipStep&&(e.beginPath(),t.renderClipStep.forEach((t=>{sf(e,t)})),e.closePath(),e.clip()),super.render(t,e);else{const{width:i,height:n,img:s,opacity:o}=t.parsedStyle;if(Zd(s))return;e.save(),e.globalAlpha=o,e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high"),e.drawImage(s,0,0,i.value,n.value),e.restore()}t.controls&&t.context.renderControls()}}}class uy extends km{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls())}}class py extends xm{render(t,e){"hidden"!==t.parsedStyle.visibility&&gy(t,e)}}function gy(t,e){const{container:i}=t,n=t.parentNode;if(!n)return;const s=n.getLocalTransform(),{a:o,b:r,c:a,d:l,e:h,f:c}=s;let d=null,u=i.parentNode;for(;!d&&u;)"pageCropBox"===u.name&&(d=u),u=u.parentNode;if(d){const{x:t,y:i,width:n,height:s}=function(t){let{x:e,y:i}=t.getPosition(),{width:n,height:s}=t;const o=(t.parentNode.parentNode.rotation%360+360)%360/90,r=devicePixelRatio;if(1===o?e-=s:2===o?(e-=n,i-=s):3===o&&(i-=n),1===o||3===o){const t=n;n=s,s=t}return{x:e*r,y:i*r,width:n*r,height:s*r}}(d);e.save(),e.setTransform(o,r,a,l,h,c),e.beginPath(),e.moveTo(t,i),e.lineTo(t+n,i),e.lineTo(t+n,i+s),e.lineTo(t,i+s),e.closePath(),e.restore(),e.clip()}}class fy extends xm{render(t,e){"hidden"!==t.parsedStyle.visibility&&(gy(t,e),super.render(t,e))}}class my{init(t){[{name:"annotationArc",renderer:new ey(t)},{name:"annotationCircle",renderer:new iy(t)},{name:"annotationEllipse",renderer:new ny(t)},{name:"annotationLine",renderer:new sy(t)},{name:"annotationImage",renderer:new ry(t)},{name:"annotationInk",renderer:new ay(t)},{name:"annotationPolygon",renderer:new ly(t)},{name:"annotationPolyline",renderer:new hy(t)},{name:"annotationRect",renderer:new cy(t)},{name:"annotationFreeText",renderer:new uy(t)},{name:"annotationGroup",renderer:new oy(t)},{name:"annotationStamp",renderer:new dy(t)},{name:"annotationControls",renderer:new py(t)},{name:"annotationLineControls",renderer:new fy(t)}].forEach((e=>{let{name:i,renderer:n}=e;t.contextService.registerShapeRenderer(i,n)}))}destroy(){}}function vy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ep.displayResolution;const i={left:0,top:0,width:t.imageWidth/t.imageXResolution*e,height:t.imageHeight/t.imageYResolution*e};return{fileIndex:0,mediaBox:i,cropBox:{...i},resource:{data:t.imageData,width:t.imageWidth,height:t.imageHeight,resolutionX:t.imageXResolution,resolutionY:t.imageYResolution,bitDepth:t.imageBitDepth}}}class yy extends Yp{constructor(){super(),na(this,"type","imageParser"),na(this,"once",!1),na(this,"imgReader",void 0),na(this,"isDestroy",!1),na(this,"source",void 0),na(this,"parserOptions",void 0),this.imgReader=new xp}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e)}async getPageCount(){return 1}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=null,this.isDestroy=!0}async parse(){return this.isDestroy?null:[vy(await this.imgReader.readImageInfo(this.source))]}async parseAnnotations(t,e){return[]}async getPage(){var t;if(this.isDestroy)return null;const e={"image/jpeg":dp.IT_JPG,"image/png":dp.IT_PNG,"image/bmp":dp.IT_BMP},{outputType:i,jpegQuality:n,returnBase64:s}=null!==(t=this.parserOptions)&&void 0!==t?t:{},o=await this.imgReader.readImage({source:this.source,outputType:null!=i?i:e[this.source.fileSource.type],jpegQuality:n,returnBase64:s});return o?vy(o):null}cancelGetPage(t){var e;if(this.isDestroy)return;const{outputType:i}=null!==(e=this.parserOptions)&&void 0!==e?e:{};this.imgReader.cancelReadImage(this.source,i)}}class xy{constructor(){na(this,"type","tiffParser"),na(this,"once",!1),na(this,"imgReader",void 0),na(this,"parserOptions",void 0),na(this,"source",void 0),na(this,"isDestroy",!1),this.imgReader=new xp}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e)}async getPageCount(){return this.imgReader.getTiffPageCount(this.source)}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=void 0,this.isDestroy=!0}async parse(t){return this.isDestroy||!this.source?null:(await this.imgReader.readTiffPageInfo(this.source,t)).map((t=>{const e=vy(t);return e.fileIndex=t.pageIndex,e}))}async parseAnnotations(t,e){return[]}async getPage(t){var e;if(this.isDestroy||!this.source)return null;const{outputType:i,returnBase64:n}=null!==(e=this.parserOptions)&&void 0!==e?e:{},s=await this.imgReader.readTiffPage({source:this.source,index:t,outputType:i,returnBase64:n});if(s){const t=vy(s);return t.fileIndex=s.pageIndex,t}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,t)}}function wy(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Tg(t),s=e||1;if(Ud(n)&&n[0]&&n[0]instanceof wg){const t=n[0].value.steps,{length:e}=n[0].value.steps,s=[0,0,0];t.forEach((t=>{const e=Tg(t.color);s[0]+=e.r,s[1]+=e.g,s[2]+=e.b}));const o=[s[0]/e,s[1]/e,s[2]/e];return i&&(o[3]=255),o}const{r:o,g:r,b:a,alpha:l}=n,h=[o,r,a];return i&&(h[3]=Math.floor(l*s*255+.5)),h}function by(t,e){return{strokeColor:t?wy(t,1,!1):null,fillColor:e?wy(e,1,!1):null}}function Cy(t,e,i){let n,s;return n=t?wy(t,i,!0):null,s=e?wy(e,i,!0):null,{apStrokeColor:n,apFillColor:s}}function Sy(t,e,i){const n=t.value?t.value/i:0,s=Iy(e||[],i);return s.length?{width:n,style:"D",dash:s}:{width:n}}function _y(t){const e=t.getLocalTransform().clone(),{a:i,b:n,c:s,d:o}=e;return[Wy(i),-Wy(n),-Wy(s),Wy(o),0,0]}function Ty(t,e){const{min:i,max:n}=Math;let s=t[0][0],o=t[0][1],r=t[0][0],a=t[0][1];for(let e=1;e<t.length;e++){const l=t[e];s=i(s,l[0]),r=n(r,l[0]),a=i(a,l[1]),o=n(o,l[1])}return s===r&&(s-=1,r+=1),a===o&&(a-=1,o+=1),[s-e/2,a-e/2,r+e/2,o+e/2]}function Ey(t,e,i,n,s,o){const r=[],a=of(e),l=i/2,h=[{x:a.left-l*n,y:a.bottom+l*s},{x:a.right+l*n,y:a.bottom+l*s},{x:a.right+l*n,y:a.top-l*s},{x:a.left-l*n,y:a.top-l*s}],c=t.getLocalTransform();return h.forEach((t=>{const e=c.transformPoint({x:t.x,y:t.y});r.push([e.x/n,o-e.y/s])})),Ty(r,0)}function Py(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],{length:n}=t;if(n>50&&e){const e=Math.floor(n/2),s=Math.floor(n/4);i.push(t[0][0],t[0][1]),i.push(t[s][0],t[s][1]),i.push(t[e][0],t[e][1]),i.push(t[n-s][0],t[n-s][1]),i.push(t[n-1][0],t[n-1][1]),i.push(t[0][0],t[0][1])}else t.forEach((t=>{i.push(t[0],t[1])}));return i}function Ay(t){const e=[];for(let i=0;i<t.length;i++){const n=[];t[i].forEach((t=>{n.push(t[0],t[1])})),e.push(n)}return e}function Iy(t,e){return t?2===t.length&&0===t[0]&&0===t[1]?[]:t.map((t=>t/e)):[]}function Dy(t){return Math.max(["butt","round","square"].indexOf(t),0)}function ky(t){return Math.max(["miter","round","bevel"].indexOf(t),0)}function Ry(t){const e=[],i=t.getLocalTransform();return t.renderPath.forEach((t=>{const n=i.transformPoint({x:t.x,y:t.y});e.push({x:n.x,y:n.y})})),e}function My(t,e){const i=Tg(t);let n=0,s=0,o=99999,r=99999;if(Ud(i)&&i[0]&&i[0]instanceof wg){const i=(t=>{const e=t.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!e)return null;const i=e[0],n=e.slice(1);return{direction:i.replace(/\s+/g," ").trim(),colors:n.map((t=>t.trim()))}})(t);e.forEach((t=>{n=Math.max(n,t[0]),o=Math.min(o,t[0]),s=Math.max(s,t[1]),r=Math.min(r,t[1])}));const a=[o,s,n,r];i.direction.includes("left")&&(a[0]=n,a[2]=o),i.direction.includes("top")&&(a[1]=r,a[3]=s);const l=Tg(i.colors[0]),h=Tg(i.colors[1]);return{coords:a,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[l.r/255,l.g/255,l.b/255],c1:[h.r/255,h.g/255,h.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function Ly(t){const e=t.map((t=>t.toLowerCase())),i=[];return e.includes("print")&&i.push("print"),e.includes("noview")&&i.push("noview"),e.includes("readonly")&&i.push("readonly"),i}function Oy(t,e,i,n,s){const{width:o,height:r}=t.parsedStyle;let a=o.value,l=r.value;if(t instanceof gv){const{width:e,height:i}=t.getBoundingRect();a=e,l=i}const{x:h,y:c}=t.getLocalPosition(),d=e/2,u=h/i,p=s-c/n,g=a/i,f=l/n;return[[u+d,p-f+d,2,!1],[u+g-d,p-f+d,0,!1],[u+g-d,p-d,0,!1],[u+d,p-d,0,!1],[u+d,p-f+d,0,!0]]}function By(t,e,i,n){t.renderPath||t.getPath();const{renderPath:s}=t,o=[],{x:r,y:a}=t.getLocalPosition();let l=[];for(let t=0;t<s.length;t++){const{step:h,close:c}=s[t],d=(s[t].x+r)/e,u=n-(s[t].y+a)/i;0!==t?0!==h||0===t?2===h?l.push([d,u,1,c]):l.push([d,u,0,c]):(o.push(l),l=[],l.push([d,u,2,c])):l.push([d,u,2,c])}return o.push(l),o}function Fy(t,e,i,n){const s=t.childNodes,o=[];for(let t=0;t<s.length;t++){if(!(s[t]instanceof Uf))continue;const r=[],{renderPath:a}=s[t],{x:l,y:h}=s[t].getLocalPosition();a.forEach(((t,s)=>{const o=[(t.x+l)/e,n-(t.y+h)/i,t.step,!1];s===a.length-1&&(o[3]=!0),r.push(o)})),o.push(r)}return o}function Ny(t,e,i,n,s,o,r){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:l}=t.parsedStyle,h=_y(t),c=Ty(o,s),d=[];return a&&d.push(Uy(t,o,e,i,s,Iy(l,r))),{bbox:c,matrix:h,transform:c,objs:d}}function Uy(t,e,i,n,s,o){const{miterLimit:r,lineCap:a,lineJoin:l}=t.parsedStyle;return{dashArray:o,dashPhase:0,fillColor:i||[0,0,0,0],fillType:i?2:0,isStroke:s>0,lineCap:Dy(a),lineJoin:ky(l),lineWidth:s,miterLimit:r,objMatrix:[1,0,0,1,0,0],segments:e,strokeColor:n||[0,0,0,0],type:"path"}}function Vy(t,e,i,n){const{fontSize:s,fontFamily:o,fontWeight:r,fontStyle:a,opacity:l,text:h}=t.parsedStyle,{color:c,borderColor:d}=t.style,{x:u,y:p}=t.getLocalPosition(),{apStrokeColor:g,apFillColor:f}=Cy(d,c,l);return{type:"text",charSpace:0,wordSpace:0,fillColor:f||[0,0,0,255],strokeColor:g||[0,0,0,255],fontName:o,renderMode:0,fontIsBold:Hy(r),fontIsItalic:"italic"===a,fontSize:s.value/e,fontPitchFamily:16,text:h,position:[u/e,p/i],objMatrix:[1,0,0,1,u/e,n-p/i]}}function Wy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const i=t.toFixed(e);return Number.parseFloat(i)}function Hy(t){return"bold"===t||qd(t)&&t>=600}function jy(t,e,i){return t.replace(new RegExp(e,"g"),i)}function zy(t,e,i,n,s){const{segments:o,lineWidth:r,strokeColor:a,fillType:l,fillColor:h,dashArray:c,lineCap:d,lineJoin:u,miterLimit:p,isStroke:g,pattern:f}=t,m={type:"path",stampPoints:Zy(o,i,n,s),borderWidth:g?(r||1)*i:0,borderColor:Qy(a,e),background:l>0?Qy(h,e):null,lineDash:tx(c,i),lineCap:Jy(d),lineJoin:Ky(u),miterLimit:p};return f&&(m.background=function(t,e,i,n){var s,o,r,a;const{coords:l,type:h}=t;if("shading"!==h)return null;const c=l[0]*e,d=n-l[1]*i,u=l[2]*e,p=n-l[3]*i,g=c<u?"right":"left",f=d===p?"":d<p?"bottom":"top";if(!t||null==t||!t.function||null==t||null===(s=t.function[0])||void 0===s||!s.functions)return null;let m=null==t||null===(o=t.function[0])||void 0===o||null===(o=o.functions[0])||void 0===o?void 0:o.c0,v=null==t||null===(r=t.function[0])||void 0===r||null===(r=r.functions[0])||void 0===r?void 0:r.c1;if(!m||!v)return null;const y=(null==t||null===(a=t.function[0])||void 0===a?void 0:a.encode)||[1,0];if(y[0]>y[y.length-1]){const t=v;v=m,m=t}const x=`rgb(${255*m[0]},${255*m[1]},${255*m[2]})`,w=`rgb(${255*v[0]},${255*v[1]},${255*v[2]})`;return`linear-gradient(to ${g} ${f}, ${Sg(x)}, ${Sg(w)})`}(f,i,n,s)||m.background),m}function Gy(t,e,i,n,s){const{text:o,renderMode:r,fontIsBold:a,fontIsItalic:l,fillColor:h,fontSize:c,fontName:d,strokeColor:u,objMatrix:p}=t,g=og.create(p),{scale:f}=g.decompose(),m=function(t,e,i,n,s){const o=$y(t,e,[1,0,0,1,0,0]);return[o[0]*i,(s-o[1])*n]}(p[4],p[5],i,n,s);return{type:"text",text:o,color:Qy(h,e),borderWidth:r?i:"0px",borderColor:Qy(u,e),fontWeight:a?"bold":"normal",fontStyle:l?"italic":"normal",fontSize:c*i*Math.abs(f.x),fontFamily:d,textBaseLine:"alphabetic",x:m[0],y:m[1]}}function Yy(t,e,i){const n=function(t){const e=t.replace(/[^A-Za-z0-9\+\/]/g,""),i=e.length,n=3*i+1>>>2,s=new Uint8Array(n);for(let t,o,r=0,a=0,l=0;l<i;l++)if(o=3&l,r|=ix(e.charCodeAt(l))<<18-6*o,3===o||i-l==1){for(t=0;t<3&&a<n;t++,a++)s[a]=r>>>(16>>>t&24)&255;r=0}return s}(t),s=new ImageData(new Uint8ClampedArray(n),e,i);let o=document.createElement("canvas");o.width=e,o.height=i,o.getContext("2d").putImageData(s,0,0);const r=o.toDataURL();return o=null,r}function $y(t,e,i){return[i[0]*t+i[2]*e+i[4],i[1]*t+i[3]*e+i[5]]}function Xy(t,e,i,n,s,o){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=og.create(i),l=a.decompose(),h={x:(e[2]+e[0])/2,y:(e[1]+e[3])/2},c=(e[2]-e[0])/2,d=(e[1]-e[3])/2,u=a.transformPoint(h),p={x:(u.x-c)*n,y:(o-u.y+d)*s},g=-l.rotation,f={x:l.scale.x,y:l.scale.y};let m=p;var v;return r&&(m=null!==(v=function(t,e,i,n,s,o){const r=[];let a=!0;if(t.forEach((t=>{let e;"path"===t.type?(e=zy(t,1,n,s,o),a=!1):"text"===t.type&&(e=Gy(t,1,n,s,o),a=!1),e&&r.push(e)})),a)return null;if(r.length){const t=function(t,e,i,n,s){const o=e[0]*i,r=(s-e[3])*n,a=[],l=[];if(t.forEach((t=>{if("path"!==t.type)return;const{borderWidth:e,stampPoints:i,lineCap:n}=t;if(2===i.length){const t=df(i[0],i[1],mg(e).value,n);a.push(t.x,t.x+t.width),l.push(t.y,t.y+t.height)}else{const t=of(i),n=mg(e).value/2,s=t.left-n,o=t.top-n,r=t.width+2*n,h=t.height+2*n;a.push(s,s+r),l.push(o,o+h)}})),0===a.length)return{offsetX:0,offsetY:0};return{offsetX:Math.min(...a)-o,offsetY:Math.min(...l)-r}}(r,e,n,s,o);i.x+=t.offsetX,i.y+=t.offsetY}return i}(t,e,{...p},n,s,o))&&void 0!==v?v:m),{position:m,angle:g,scale:f}}function qy(t,e,i,n){const s=[];return t.forEach((t=>{s.push({x:t[0]*e,y:(n-t[1])*i})})),s}function Zy(t,e,i,n){const s=[];return t.forEach((t=>{const o=t[0],r=t[1];s.push({x:o*e,y:(n-r)*i,step:t[2],close:t[3]})})),s}function Jy(t){return["butt","round","square"][null!=t?t:0]}function Ky(t){return["miter","round","bevel"][null!=t?t:0]}function Qy(t,e){return t?(null==t?void 0:t.length)<3?null:4===(null==t?void 0:t.length)?`rgba(${t.slice(0,3).join()},${t[3]/255/(e||1)})`:`rgb(${t.join()})`:null}function tx(t,e){return t&&0!==t.length?t.map((t=>t*e)):[0,0]}function ex(t){if(!Ud(t))return[null];let e=[];for(let i=0;i<t.length;i++)t[i]instanceof Array?e=e.concat(ex(t[i])):e.push(Wd(t[i]));return e}function ix(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0}function nx(t,e){if(!t)return"";let i="";return t.split(";").forEach((t=>{const n=t.split(":");n[0].trim()===e&&(i=n[1].trim())})),i}function sx(t){if(!t)return{contents:[],textStyle:{}};const e=new DOMParser,i='xmlns="http://www.w3.org/1999/xhtml"';let n=t;t.includes('xmlns="')||(n=t.replace(/<body/,`<body ${i}`)),n=jy(n,'xmlns=""',i);const s=e.parseFromString(n,"text/xml"),o=s.getElementsByTagName("body")[0],r=s.getElementsByTagName("span"),a=s.getElementsByTagName("p"),l=t=>{for(const e in t)null!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e];return t},{color:h,fontFamily:c,fontSize:d,fontWeight:u,fontStyle:p,textDecoration:g}=o.style,f=l({color:h,fontFamily:c,fontSize:d,fontWeight:u,fontStyle:p,lineThrough:g.includes("line-through"),underline:g.includes("word")||g.includes("underline")}),m=[],v=t=>{for(let e=0;e<t.length;e++){const i=t[e],{color:n,fontFamily:s,fontSize:o,fontStyle:r,fontWeight:a}=i.style||{},h=nx(i.getAttribute("style"),"text-decoration"),c=l({content:i.textContent,color:n,fontFamily:s,fontSize:o,fontWeight:a,fontStyle:r,lineThrough:h.includes("line-through")||void 0,underline:h.includes("word")||h.includes("underline")||void 0});m.push(c)}};return r.length?v(r):v(a),{textStyle:f,contents:m}}function ox(t,e,i){if(1!==Math.abs(e[0])||1!==Math.abs(e[3])){const n=$y(i[0],i[1],e),s=$y(i[2],i[3],e);t.forEach((t=>{t.segments.forEach((t=>{const i=$y(t[0],t[1],e);t[0]=i[0],t[1]=i[1]}))})),i[0]=n[0],i[1]=n[1],i[2]=s[0],i[3]=s[1];for(let t=0;t<6;t++)e[t]=0===t||3===t?1:0}}function rx(t,e,i,n,s,o){var r;const{objs:a}=t||{},l=t&&(null==a?void 0:a.length)>0&&"path"===a[0].type,h=l?a[0]:null,c=(l?h.strokeColor:e)||[0,0,0],d=(l?h.fillColor:i)||null,u=l?h.fillType>0:!Vu(d),p=Qy(c,n),g=d?Qy(d,n):"",f=tx(l?h.dashArray:null==s?void 0:s.dash,o),m=Jy(l?h.lineCap:0),v=Ky(l?h.lineJoin:0),y=l?h.miterLimit:10;let x=(null!==(r=null==s?void 0:s.width)&&void 0!==r?r:1)*o||0;var w;return l&&(x=(null!==(w=null==h?void 0:h.lineWidth)&&void 0!==w?w:1)*o||0),{useObj:l,hasFill:u,borderColor:p,background:g,lineDash:f,lineCap:m,lineJoin:v,miterLimit:y,borderWidth:x}}class ax{constructor(){na(this,"pageWidth",void 0),na(this,"pageHeight",void 0),na(this,"ratioX",0),na(this,"ratioY",0)}setParserConfig(t,e,i,n){this.pageWidth=t,this.pageHeight=e,this.ratioX=i,this.ratioY=n}parseAnnotation(t){let e=null;switch(t.type){case"Square":e=this.parseRect(t);break;case"Circle":e=this.parseCircle(t);break;case"Line":e=this.parseLine(t);break;case"Polygon":e=this.parsePolygon(t);break;case"PolyLine":e=this.parsePolyline(t);break;case"Ink":e=this.parseInk(t);break;case"FreeText":e=t.intent&&"freetext"!==t.intent.toLocaleLowerCase()?"freetexttypewriter"===t.intent.toLocaleLowerCase()?this.parseFreeText(t):this.parseIncomplete(t):this.parseTextBox(t);break;case"Stamp":e=this.parseStamp(t);break;default:e=t.normalAppearance?this.parseIncomplete(t):this.parseUnknown(t)}if(e||(t.normalAppearance?(e=this.parseIncomplete(t),e||(e=this.parseUnknown(t))):e=this.parseUnknown(t)),e){var i;const{opacity:n}=t,s=e.style;if(e.raw=t,s.opacity=qd(s.opacity)?s.opacity:null!=n?n:1,null!=t&&t.normalAppearance){const{blendMode:i}=t.normalAppearance;e.style.renderBlendMode=i.toLowerCase()}null!==(i=e)&&void 0!==i&&i.transform&&e.transform.angle<0&&(e.transform.angle+=360),e.uid=Qd()}return e}isSegmentsRect(t){if(5!==t.length&&4!==t.length)return!1;if(5===t.length&&(t[0][0]!==t[4][0]||t[0][1]!==t[4][1]))return!1;if(t[0][0]===t[2][0]&&t[0][1]===t[2][1]||t[1][0]===t[3][0]&&t[1][1]===t[3][1])return!1;for(let e=1;e<t.length;e++)if(0!==t[e][2])return!1;for(let e=1;e<t.length;e++)if(t[e][0]!==t[e-1][0]&&t[e][1]!==t[e-1][1])return!1;return t[0][0]===t[3][0]||t[0][1]===t[3][1]}parseRect(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,rect:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this,{useObj:c,hasFill:d,borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:m,borderWidth:v}=rx(e,o,i,s,n,a);let y=null,x=0,w=0,b=0,C=0;if(e){const{bbox:t,objs:i,transform:s}=e,{position:o,angle:r,scale:d}=Xy(i||null,t,s,a,l,h,!(null==i||!i.length));if(b=o.x,C=o.y,y={angle:r,scale:d},c){const{lineWidth:t,segments:e}=i[0];if(!this.isSegmentsRect(e))return null;x=(e[1][0]-e[0][0]+t)*this.ratioX,w=(e[2][1]-e[0][1]+t)*this.ratioY}else{var S,_;x=(t[2]-t[0]-(null!==(S=null==n?void 0:n.width)&&void 0!==S?S:1))*this.ratioX,w=(t[3]-t[1]-(null!==(_=null==n?void 0:n.width)&&void 0!==_?_:1))*this.ratioY}}else{var T,E,P,A;b=(r[0]+(null!==(T=null==n?void 0:n.width)&&void 0!==T?T:1)/2)*this.ratioX,C=(h-r[3]+(null!==(E=null==n?void 0:n.width)&&void 0!==E?E:1)/2)*this.ratioY,x=(r[2]-r[0]-(null!==(P=null==n?void 0:n.width)&&void 0!==P?P:1))*this.ratioX,w=(r[3]-r[1]-(null!==(A=null==n?void 0:n.width)&&void 0!==A?A:1))*this.ratioY}return{type:"rectangle",style:{x:b,y:C,width:x,height:w,borderWidth:v,borderColor:u,background:d?p:"",lineDash:g,lineCap:f,lineJoin:m},iconColor:d?p:u,transform:y}}parseCircle(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,rect:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this,{objs:c}=e||{},{hasFill:d,borderColor:u,background:p,lineDash:g,borderWidth:f}=rx(e,o,i,s,n,a);let m=null,v=0,y=0,x=0,w=0;if(e){const{bbox:t,transform:i}=e,{position:n,angle:s,scale:o}=Xy(c||null,t,i,a,l,h,!(null==c||!c.length));x=n.x,w=n.y,m={angle:s,scale:o},v=(t[2]-t[0])*this.ratioX,y=(t[3]-t[1])*this.ratioY}else x=r[0]*this.ratioX,w=(h-r[3])*this.ratioY,v=(r[2]-r[0])*this.ratioX,y=(r[3]-r[1])*this.ratioY;return{type:"ellipse",style:{x,y:w,width:v,height:y,borderWidth:f,borderColor:u,background:d?p:"",lineDash:g},transform:m,iconColor:d?p:u}}parseLine(t){if(null!=t&&t.intent&&"linedimension"===t.intent.toLocaleLowerCase())return null;const{normalAppearance:e,interiorColor:i,borderStyle:n,lineEnding:s,opacity:o,color:r,line:a}=t,{ratioX:l,ratioY:h,pageHeight:c}=this,{objs:d}=e||{},{useObj:u,borderColor:p,background:g,lineDash:f,lineCap:m,lineJoin:v,miterLimit:y,borderWidth:x}=rx(e,r,i,o,n,l);let w,b={x:a[0]*this.ratioX,y:(this.pageHeight-a[1])*this.ratioY},C={x:a[2]*this.ratioX,y:(this.pageHeight-a[3])*this.ratioY};if(e){const{bbox:t}=e,{transform:i}=e;if(u){const{segments:e,lineWidth:n}=d[0];ox(d,i,t),b={x:e[0][0]*this.ratioX,y:(this.pageHeight-e[0][1])*this.ratioY},C={x:e[1][0]*this.ratioX,y:(this.pageHeight-e[1][1])*this.ratioY}}const{position:n,angle:s,scale:o}=Xy(ex(d),t,i,l,h,c,!(null==d||!d.length));w={position:n,scale:o,angle:s}}return{type:"line",style:{startPoint:b,endPoint:C,lineEnding:s||["None","None"],borderColor:p,borderWidth:x,background:g||"",lineCap:m,lineJoin:v,lineDash:f,miterLimit:y},transform:w,iconColor:p}}parsePolygon(t){const{normalAppearance:e,interiorColor:i,borderStyle:n,opacity:s,color:o,vertices:r,intent:a}=t;if(a&&["polygondimension","polygoncloud"].includes(a.toLocaleLowerCase()))return null;const{ratioX:l,ratioY:h,pageHeight:c}=this,{objs:d}=e||{},{hasFill:u,borderColor:p,background:g,lineDash:f,lineCap:m,lineJoin:v,miterLimit:y,useObj:x,borderWidth:w}=rx(e,o,i,s,n,this.ratioX);let b,C;if(x){const{segments:t}=d[0];C=qy(t,this.ratioX,this.ratioY,this.pageHeight)}else{const t=[];for(let e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);C=qy(t,this.ratioX,this.ratioY,this.pageHeight)}var S,_;if(C.length>2&&(S=C[0],_=C[C.length-1],S.x===_.x&&S.y===_.y)&&C.pop(),e){const{bbox:t}=e,{transform:i}=e;ox(d,i,t),b=Xy(ex(d),t,i,l,h,c,!(null==d||!d.length))}return{type:"polygon",style:{points:C,borderWidth:w,borderColor:p,background:u?g:"",lineDash:f,lineCap:m,lineJoin:v,miterLimit:y},transform:b,iconColor:u?g:p}}parsePolyline(t){const{normalAppearance:e,interiorColor:i,opacity:n,color:s,vertices:o,borderStyle:r,intent:a}=t;if(a&&"polylinedimension"===a.toLocaleLowerCase())return null;const{ratioX:l,ratioY:h,pageHeight:c}=this,{objs:d}=e||{},{borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:m,miterLimit:v,useObj:y,borderWidth:x}=rx(e,s,i,n,r,this.ratioX);let w,b;if(y){const{segments:t}=d[0];b=qy(t,this.ratioX,this.ratioY,this.pageHeight)}else{const t=[];for(let e=0;e<o.length;e+=2)t.push([o[e],o[e+1]]);b=qy(t,this.ratioX,this.ratioY,this.pageHeight)}if(e){const{bbox:t}=e,{transform:i}=e;ox(d,i,t),w=Xy(ex(d),t,i,l,h,c,!(null==d||!d.length))}return{type:"polyline",style:{points:b,borderWidth:x,borderColor:u,background:p,lineDash:g,lineCap:f,lineJoin:m,lineEnding:t.lineEnding||["None","None"],miterLimit:v},transform:w,iconColor:u}}parseInk(t){const{normalAppearance:e,inkList:i,opacity:n,borderStyle:s,interiorColor:o,color:r}=t,{ratioX:a,ratioY:l,pageHeight:h}=this;if(!i)return null;const{borderColor:c,background:d,lineDash:u,lineCap:p,lineJoin:g,miterLimit:f,borderWidth:m}=rx(e,r,o,n,s,this.ratioX),v=[];for(let t=0;t<i.length;t++){const e=i[t],n=[];for(let t=0;t<e.length;t+=2){const i=e[t],s=e[t+1];n.push([i,s,1,!1])}const s=qy(n,this.ratioX,this.ratioY,this.pageHeight);v.push(s)}let y=null;if(e){const{objs:t,transform:i,bbox:n}=e;y=Xy(ex(t),n,i,a,l,h,!(null==t||!t.length))}return{type:"ink",style:{segments:v,borderWidth:m,borderColor:c,background:d,lineDash:u,lineCap:p,lineJoin:g,miterLimit:f},transform:y,iconColor:c}}parseFreeText(t){const{normalAppearance:e,richText:i,rect:n,defaultAppearanceData:s,defaultStyle:o}=t,{ratioX:r,ratioY:a,pageHeight:l}=this;let h,c,d,u,p=0;if(e){const{bbox:t,transform:i,objs:n}=e,{position:s,angle:o,scale:u}=Xy(ex(n),t,i,r,a,l,n.length&&"path"===n[0].type);p=o,c=s.x,d=s.y,h={angle:p,scale:u}}else c=n[0]*this.ratioX,d=(l-n[3])*this.ratioY;(Math.round(p)+360)/90%2==0?(u=(n[2]-n[0])*this.ratioX,0===p&&(u+=12),u+c>this.pageWidth*this.ratioX&&(u=this.pageWidth*this.ratioX-c)):(u=(n[3]-n[1])*this.ratioY,u+c>this.pageHeight*this.ratioY&&(u=this.pageHeight*this.ratioY-c));const{fontName:g,fontSize:f,fontColor:m}=s,v={content:"",fontFamily:g,color:nx(o,"color")||`rgb(${m[0]},${m[1]},${m[2]})`,fontSize:f},y=sx(i),x=[];return y.contents.forEach((t=>{const e={...v,...y.textStyle,...t},i=mg(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(qd(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),x.push(e)})),{type:"textTypewriter",style:{x:c,y:d,width:u,textContents:x},transform:h,iconColor:v.color}}parseTextBox(t){const{normalAppearance:e,richText:i,defaultAppearanceData:n,defaultStyle:s,opacity:o,borderStyle:r,color:a,rect:l}=t,{ratioX:h,ratioY:c,pageHeight:d}=this,{hasFill:u,borderColor:p,background:g,borderWidth:f,lineDash:m,useObj:v}=rx(e,null==n?void 0:n.fontColor,a,o,r,h);let y,x,w,b,C;if(e&&e.objs.length){var S,_;const{bbox:t,transform:i,objs:n}=e,{position:s,angle:o,scale:a}=Xy(ex(n),t,i,h,c,d,"path"===n[0].type);y=s.x,x=s.y,C={angle:o,scale:a};const{segments:l,lineWidth:u}=n[0];w=v&&"path"===n[0].type?(l[1][0]-l[0][0]+u)*this.ratioX:(t[2]-t[0]-(null!==(S=null==r?void 0:r.width)&&void 0!==S?S:1))*this.ratioX,b="path"===n[0].type?(l[2][1]-l[0][1]+u)*this.ratioY:(t[3]-t[1]-(null!==(_=null==r?void 0:r.width)&&void 0!==_?_:1))*this.ratioY}else{var T,E,P,A;y=(l[0]+(null!==(T=null==r?void 0:r.width)&&void 0!==T?T:1)/2)*this.ratioX,x=(d-l[3]+(null!==(E=null==r?void 0:r.width)&&void 0!==E?E:1)/2)*this.ratioY,w=(l[2]-l[0]-(null!==(P=null==r?void 0:r.width)&&void 0!==P?P:1))*this.ratioX,b=(l[3]-l[1]-(null!==(A=null==r?void 0:r.width)&&void 0!==A?A:1))*this.ratioY}const{fontName:I,fontSize:D}=n,k={content:"",fontFamily:I,fontSize:D},R=sx(i);let M=nx(i,"text-align")||nx(s,"text-align");"justify-center"===M&&(M="justify");const L=[];if(R.contents.forEach((t=>{const e={...k,...R.textStyle,...t},i=mg(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(qd(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),L.push(e)})),0===L.length&&t.contents){const e={...k,content:t.contents};qd(e.fontSize)&&(e.fontSize*=this.ratioX),L.push(e)}return{type:"textBox",style:{x:y,y:x,width:w,height:b,borderWidth:f,borderColor:p,background:u?g:"",lineDash:m,textContents:L,textAlign:M},transform:C,iconColor:k.color}}parseStamp(t){const{icon:e,opacity:i,normalAppearance:n}=t;if(!n)return null;const{objs:s,transform:o,bbox:r}=t.normalAppearance;if(0===s.length)return null;const a=ex(s),l=[],{ratioX:h,ratioY:c,pageHeight:d}=this,{position:u,angle:p,scale:g}=Xy(a,r,o,h,c,d),f={position:u,angle:p,scale:g};for(let t=0;t<a.length;t++){let e;if("path"===a[t].type&&(e=zy(a[t],i,this.ratioX,this.ratioY,this.pageHeight)),"text"===a[t].type&&(e=Gy(a[t],i,this.ratioX,this.ratioY,this.pageHeight)),"image"===a[t].type){const e={type:"stamp",style:{imageData:a[t].jpegBase64?`data:image/jpeg;base64,${a[t].jpegBase64}`:Yy(a[t].RGBABase64,a[t].width,a[t].height),width:(a[t].rect[2]-a[t].rect[0])*this.ratioX,height:(a[t].rect[3]-a[t].rect[1])*this.ratioY},transform:f};return e.transform.position.x+=(a[t].rect[0]-r[0])*this.ratioX,e.transform.position.y-=(a[t].rect[3]-r[3])*this.ratioY,e}e&&l.push(e)}return{type:"stamp",style:{iconName:e,stampConfig:l},transform:f,iconColor:"#868E96"}}parseTextAssist(t,e){const{objs:i,transform:n,bbox:s}=t.normalAppearance,{opacity:o}=t;if(0===i.length)return null;const r=ex(i),a=[],{ratioX:l,ratioY:h,pageHeight:c}=this,{position:d,angle:u,scale:p}=Xy(r,s,n,l,h,c),g={position:d,angle:u,scale:p};for(let t=0;t<r.length;t++){let e;"path"===r[t].type&&(e=zy(r[t],o,this.ratioX,this.ratioY,this.pageHeight)),e&&a.push(e)}return{type:e,style:{opacity:o||1,stampConfig:a,annotationRaw:t},transform:g}}parseIncomplete(t){const{normalAppearance:e,opacity:i}=t;if(!e)return null;const{objs:n,transform:s,bbox:o}=t.normalAppearance;if(!n||0===n.length)return null;const r=ex(n),a=[],{ratioX:l,ratioY:h,pageHeight:c}=this,{position:d,angle:u,scale:p}=Xy(r,o,s,l,h,c),g={position:d,angle:u,scale:p};for(let e=0;e<r.length;e++){let n;if("path"===r[e].type)n=zy(r[e],i,l,h,c);else if("text"===r[e].type)n=Gy(r[e],i,l,h,c);else if("image"===r[e].type){let i;i=r[e].jpegBase64?`data:image/jpeg;base64,${r[e].jpegBase64}`:Yy(r[e].RGBABase64,r[e].width,r[e].height);const n={type:"incomplete",style:{imageData:i,width:(r[e].rect[2]-r[e].rect[0])*this.ratioX,height:(r[e].rect[3]-r[e].rect[1])*this.ratioY,annotationRaw:t},transform:g};return n.transform.position.x+=(r[e].rect[0]-o[0])*this.ratioX,n.transform.position.y-=(r[e].rect[3]-o[3])*this.ratioY,n}n&&a.push(n)}return{type:"incomplete",style:{stampConfig:a,annotationRaw:t},transform:g}}parseUnknown(t){return{type:"unknown",style:{annotationRaw:t}}}}class lx{constructor(){na(this,"map",new Map),na(this,"ratioX",Ep.displayResolution/Ep.pdfResolution),na(this,"ratioY",Ep.displayResolution/Ep.pdfResolution)}async toPdfAnnotations(t,e){const i=[],n=[...t];n.sort(((t,e)=>t.layer-e.layer));for(let t=0;t<n.length;t++){const s=n[t];if(s){const t=await this.toPdfAnnotation(s,{width:e.width/this.ratioX,height:e.height/this.ratioY});if(t){t.oriIndex=s.oriIndex,t.modified=s.modified;const{flags:e}=s,n=[];["noResize","noMove","noRotate"].forEach((t=>{e.includes(t)&&n.push(t)})),n.length&&(t.customData={dynamsoftFlags:n}),i.push(t)}}}return i}async toPdfAnnotation(t,e){if("stamp"===t.type&&t.style.imageData&&(!qd(t.style.width)||!qd(t.style.height))){const e=new xp,i=await e.readImageInfo({fileSource:t.style.imageData});let n=i.imageWidth,s=i.imageHeight;if(n>400||s>400){const t=Math.max(n/400,s/400);n/=t,s/=t}t.style.width=n,t.style.height=s}const i=this.createShape(t);if(i instanceof gv&&"freeTextWriter"===i.textType){const{width:t,height:e}=i.getBoundingRect();i.setOrigin(t/2,e/2)}let n=null;switch(t.type){case"rectangle":case"ellipse":n=this.toPdfRectOrEllipse(t,e,i);break;case"polyline":case"polygon":n=this.toPdfPolygonal(t,e,i);break;case"line":n=this.toPdfLine(t,e,i);break;case"ink":n=this.toPdfInk(t,e,i);break;case"stamp":n=await this.toPdfStamp(t,e,i);break;case"textBox":n=this.toPdfFreeText(t,e,i,"textBox");break;case"textTypewriter":n=this.toPdfFreeText(t,e,i,"freeTextWriter");break;case"highlight":n=this.toPdfTextAssist(t,"Highlight",e,i);break;case"underline":n=this.toPdfTextAssist(t,"Underline",e,i);break;case"strikeout":n=this.toPdfTextAssist(t,"StrikeOut",e,i);break;case"incomplete":case"unknown":n=t.style.annotationRaw}return n&&(n.title=t.comment.author,n.subject=t.comment.subject,n.creationdate=t.comment.creationDate),n}toPdfRectOrEllipse(t,e,i){const{borderColor:n,background:s,lineDash:o}=t.style,{borderWidth:r,opacity:a}=i.parsedStyle,{strokeColor:l,fillColor:h}=by(n,s),{apStrokeColor:c,apFillColor:d}=Cy(n,s,a),u=Sy(r,o,this.ratioX),p=u.width,g="rectangle"===t.type?Oy(i,p,this.ratioX,this.ratioY,e.height):function(t,e,i,n){const{x:s,y:o}=t.getLocalPosition();t.path||t.getPath();const{path:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+s)/e,h=n-(r[t].y+o)/i;0===t?(a.push([l,h,2,!1]),a.push([l,h,0,!1])):t===r.length-1?a.push([l,h,1,!0]):a.push([l,h,1,!1])}return a}(i,this.ratioX,this.ratioY,e.height),f=Ny(i,d,c,a,p,g,this.ratioX);return i.path||i.getPath(),{type:"rectangle"===t.type?"Square":"Circle",normalAppearance:f,interiorColor:h,color:l,borderStyle:u,opacity:a,rect:Ey(i,i.path,p,this.ratioX,this.ratioY,e.height),flags:Ly([...t.flags]),date:t.comment.modificationDate,name:t.uid,contents:""}}toPdfPolygonal(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,h="polyline"===t.type,{strokeColor:c,fillColor:d}=by(o,r),{apStrokeColor:u,apFillColor:p}=Cy(o,r,s),g=Sy(n,l,this.ratioX),f=g.width;let m,v,y;h?(m=By(i,this.ratioX,this.ratioY,e.height),v=m.flat(),y=Py(m[0])):(m=function(t,e,i,n){t.renderPath||t.getPath();const{x:s,y:o}=t.getLocalPosition(),{renderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+s)/e,h=n-(r[t].y+o)/i;if(0!==t){if(t===r.length-1){a.push([l,h,0,!0]);break}a.push([l,h,0,!1])}else a.push([l,h,2,!1])}return a}(i,this.ratioX,this.ratioY,e.height),v=m,y=Py(v));const x=Ny(i,p,u,s,f,v,this.ratioX,!h);if(h){const t=[];m.forEach((e=>{t.push(Uy(i,e,p,u,f,Iy(l,this.ratioX)))})),x.objs=t}const w={type:h?"PolyLine":"Polygon",borderStyle:g,color:c,interiorColor:d,normalAppearance:x,vertices:y,opacity:s,rect:Ey(i,i.renderPath,f,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Ly([...t.flags]),date:t.comment.modificationDate};return h&&i.isLineArrow()&&(w.lineEnding=a),w}toPdfLine(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,{strokeColor:h,fillColor:c}=by(o,r),{apStrokeColor:d,apFillColor:u}=Cy(o,r,s),p=Sy(n,l,this.ratioX),g=p.width,f=By(i,this.ratioX,this.ratioY,e.height),m=f.flat(),v=[];f.forEach((t=>{v.push(Uy(i,t,u,d,g,Iy(l,this.ratioX)))}));const y=Ny(i,u,d,s,g,m,this.ratioX,!1);y.objs=v;const x={type:"Line",line:[m[0][0],m[0][1],m[1][0],m[1][1]],interiorColor:c,color:h,normalAppearance:y,borderStyle:p,opacity:s,rect:Ey(i,i.renderPath,g,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Ly([...t.flags]),date:t.comment.modificationDate,toJsonString:()=>""};return i.isLineArrow()&&(x.lineEnding=a,x.intent="LineArrow"),x}toPdfInk(t,e,i){const{borderWidth:n,opacity:s}=i.parsedStyle,{borderColor:o,background:r,lineDash:a}=t.style,{strokeColor:l}=by(o,r),{apStrokeColor:h,apFillColor:c}=Cy(o,r,s),d=Sy(n,a,this.ratioX),u=d.width,p=function(t,e,i,n){t.inkOriginalRenderPath||t.getInkOriginalRenderPath();const{x:s,y:o}=t.getLocalPosition(),{inkOriginalRenderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=r[t],h=[];for(let t=0;t<l.length;t++){const r=(l[t].x+s)/e,a=n-(l[t].y+o)/i;0===t?h.push([r,a,2,!1]):h.push([r,a,1,!1])}if(h.length&&h.length<4)for(;h.length<4;){const t=h[h.length-1];h.push([...t])}a.push(h)}return a}(i,this.ratioX,this.ratioY,e.height),g=p.flat(),f=[],{x:m,y:v}=i.getLocalPosition();i.getPath();const{inkRenderSteps:y}=i,x=[];y.forEach((t=>{const i=[];t.forEach(((t,n)=>{if(0===n){const n=(t.data[0].x+m)/this.ratioX,s=e.height-(t.data[0].y+v)/this.ratioY;i.push([n,s,2,!1])}else t.data.forEach((t=>{const n=(t.x+m)/this.ratioX,s=e.height-(t.y+v)/this.ratioY;i.push([n,s,1,!1])}))})),x.push(i)})),x.forEach((t=>{f.push(Uy(i,t,c,h,u,Iy(a,this.ratioX)))}));const w=Ny(i,c,h,s,u,g,this.ratioX,!1);return w.objs=f,{type:"Ink",color:l,normalAppearance:w,borderStyle:d,opacity:s,inkList:Ay(p),rect:Ey(i,i.inkOriginalRenderPath.flat(),u,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:Ly([...t.flags]),date:t.comment.modificationDate}}async toPdfStamp(t,e,i){const{imageData:n,iconName:s,opacity:o}=t.style;if(n)return await this.toPdfStampImage(t,e,i);const r=i.childNodes,a=Fy(i,this.ratioX,this.ratioY,e.height),l=[],h=[];let c=0,d=0;for(let i=0;i<r.length;i++){let n;const s=r[i].parsedStyle.opacity;if(r[i].style.opacity=s/(t.style.opacity||1),r[i]instanceof Uf){const t=Ry(r[i]);h.push(...t);const{borderWidth:e,lineDash:s}=r[i].parsedStyle,{borderColor:u,background:p}=r[i].style,{apStrokeColor:g,apFillColor:f}=Cy(u,p,o),m=Sy(e,s,this.ratioX).width,v=My(p,a[c]);d=Math.max(m,d),n=Uy(r[i],a[c],f,g,m,Iy(s,this.ratioX)),v&&(n.pattern=v),c+=1,l.push(n)}r[i]instanceof Wf&&(n=Vy(r[i],this.ratioX,this.ratioY,e.height),l.push(n))}const u=Ny(i,null,null,o,d,a.flat(),this.ratioX,!1);return u.objs=l,{type:"Stamp",icon:s,rect:Ey(i,h,d,this.ratioX,this.ratioY,e.height),normalAppearance:u,opacity:o,name:t.uid,contents:"",flags:Ly([...t.flags]),date:t.comment.modificationDate}}async toPdfStampImage(t,e,i){const{imageData:n,opacity:s}=t.style;let o=n,r=[];Zd(n)&&(r=n.split(","),r[0].match(/:(.*?);/)[1],o=function(t){let e=null;const i=t.split(","),n=i[0].match(/:(.*?);/)[1],s=window.atob(i[1]);let o=s.length;const r=new Uint8Array(o);for(;o--;)r[o]=s.charCodeAt(o);return e=new Blob([r],{type:n}),e}(n));const{width:a,height:l}=i.parsedStyle,h=_y(i),c=[0,0,a.value/this.ratioX,l.value/this.ratioY],d=await async function(t,e,i,n){const{width:s,height:o}=t.parsedStyle,r=s.value/i,a=o.value/n;let l;if("image/jpeg"===e.type){const t=new xp,i=await t.readImage({source:{fileSource:e},outputType:1,returnBase64:!0});t.destroy(),l={type:"image",jpegBase64:i.imageData,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]}}else{const t=new xp,i=await t.readImage({source:{fileSource:e},outputType:-2,returnBase64:!0});t.destroy(),l={type:"image",RGBABase64:i.imageData,height:i.imageHeight,width:i.imageWidth,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]}}return l}(i,o,this.ratioX,this.ratioY),u=function(t,e,i,n){const{width:s,height:o}=t.parsedStyle,{x:r,y:a}=t.getLocalScale(),{x:l,y:h}=t.getLocalPosition(),c=t.getAngle(),d=l+s.value/2,u=h+o.value/2,p=s.value*r*.5,g=n*i-o.value*a*.5-u;let f=new Nf({style:{x:d-p,y:n*i-o.value*a-g,width:s.value*r,height:o.value*a}});f.setAngle(c),f.getPath();const m=Ey(f,f.path,0,e,i,n);return f=null,m}(i,this.ratioX,this.ratioY,e.height);return{type:"Stamp",normalAppearance:{bbox:c,matrix:h,objs:[d],transform:h},rect:u,opacity:s,name:t.uid,contents:"",flags:Ly([...t.flags]),date:t.comment.modificationDate}}toPdfFreeText(t,e,i,n){const{opacity:s,textContents:o,borderColor:r,background:a,lineDash:l,textAlign:h}=t.style;"freeTextWriter"===n&&(i.style.borderWidth=0);const{borderWidth:c}=i.parsedStyle,{strokeColor:d,fillColor:u}=by(r,a),{apStrokeColor:p,apFillColor:g}=Cy(r,a,s),f="textBox"===n?Sy(c,l,this.ratioX):{width:0},m=f.width,v=Ny(i,g,p,s,m,Oy(i,m,this.ratioX,this.ratioY,e.height),this.ratioX,"textBox"===n),y=function(t,e,i,n){const{lines:s}=t,{opacity:o}=t.parsedStyle,r=[],a=(t,e,i)=>({type:"path",strokeColor:t,fillColor:t,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:i,objMatrix:[1,0,0,1,0,0],segments:e,dashArray:[],dashPhase:0});return s.forEach((s=>{const l=s.height/30,h=t.getTextAlignOffset(s);s.words.forEach((t=>{const{fontFamily:c,fontSize:d,fontStyle:u,fontWeight:p,color:g,underline:f,lineThrough:m}=t.style,v=wy(g,1,!1),y=v?[...v,255*o]:[0,0,0,255],x=(t.x+h)/e,w=n-s.y/i,b={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:y,fontName:c,fontIsBold:Hy(p),fontIsItalic:"italic"===u,fontSize:d.value/e,text:(C=t.text,C.replace(/\r?\n?$/,"")),objMatrix:[1,0,0,1,x,w],position:[x,w]};var C;if(r.push(b),f){const o=n-(s.y+l)/i,h=a(y,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h)}if(m){const o=n-(s.y-t.wordHeight/3)/i,h=a(y,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h)}}))})),r}(i,this.ratioX,this.ratioY,e.height);"textBox"===n?v.objs.push(...y):v.objs=y;const{defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b}=function(t,e,i,n,s){const o=i[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:r,fontSize:a,fontStyle:l,fontWeight:h,color:c}=o,d=wy(c,1,!1),u=Sg(`rgb(${d[0]}, ${d[1]}, ${d[2]})`),p=mg(a).value/s,g=jy(r," ","");return{defaultAppearance:"textBox"===t?`${e[0]/255} ${e[1]/255} ${e[2]/255} rg /${g} ${p} Tf`:`${d[0]/255} ${d[1]/255} ${d[2]/255} rg /${g} ${p} Tf`,defaultStyle:`font:${"bold"===h?"bold":""} ${"italic"===l?"italic":""} '${r}' ${p}pt; text-align:${"justify"===n?"justify-center":n}; color:${u.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:d,fontSize:p,fontName:r}}}(n,d||[0,0,0],o,"freeTextWriter"===n?"left":h,this.ratioX);i.getPath();const C=Ey(i,i.path,m,this.ratioX,this.ratioY,e.height);let S="";o.forEach((t=>{S+=t.content}));const _=function(t,e,i){if(!t||!t.length)return null;const n=document.implementation.createDocument(null,"body",null),s=n.documentElement;s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),s.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),s.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),s.setAttribute("xfa:spec","2.0.2");const o=t=>`font-size:${mg(t).value/i}pt;`,r=t=>`font-weight:${"bold"===t?"bold":"normal"};`,a=t=>`font-style:${"italic"===t?"italic":"normal"};`,l=t=>`color:${Sg(Tg(t).formatted)};`,h=t=>`font-family:'${t}';`,c=t[0],{fontFamily:d,fontSize:u,fontStyle:p,fontWeight:g,color:f}=c,m=Tg(f),v=`${o(u)}text-align:${"justify"===e?"justify-center":e};${l(m.formatted)}${r(g)}${a(p)}${h(d)}font-stretch:normal;`;s.setAttribute("style",v);const y=n.createElement("p");y.setAttribute("dir","ltr"),t.forEach((t=>{if(!t.content.length)return;const e=n.createElement("span"),i=n.createTextNode(t.content);e.appendChild(i);let s="";d!==t.fontFamily&&(s+=h(t.fontFamily)),u!==t.fontSize&&(s+=o(t.fontSize)),p!==t.fontStyle&&(s+=a(t.fontStyle)),g!==t.fontWeight&&(s+=r(t.fontWeight)),f!==t.color&&(s+=l(t.color)),(t.lineThrough||t.underline)&&(s+=`text-decoration:${t.underline?"word":""} ${t.lineThrough?"line-through":""}`),s&&e.setAttribute("style",s),y.appendChild(e)})),s.appendChild(y);const x=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(n)}`,w='xmlns="http://www.w3.org/1999/xhtml"';return x.includes(w)?jy(x,'xmlns=""',w):jy(x.replace(/<body/,`<body ${w}`),'xmlns=""',w)}(o,h,this.ratioX),T={borderStyle:f,type:"FreeText",color:u,normalAppearance:v,defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b,rect:C,name:t.uid,contents:S,opacity:s,flags:Ly([...t.flags]),date:t.comment.modificationDate};return"freeTextWriter"===n&&(T.intent="FreeTextTypeWriter"),_&&(T.richText=_),T}toPdfTextAssist(t,e,i,n){if(t.style.annotationRaw)return t.style.annotationRaw;const{opacity:s}=t.style,o=n.childNodes,r=Fy(n,this.ratioX,this.ratioY,i.height),a=[],l=[];for(let t=0;t<o.length;t++){const e=Ry(o[t]);l.push(...e);const{borderWidth:i,lineDash:n}=o[t].parsedStyle,{borderColor:h,background:c}=o[t].style,{apStrokeColor:d,apFillColor:u}=Cy(h,c,s),p=Sy(i,n,this.ratioX).width,g=Uy(o[t],r[t],u,d,p,Iy(n,this.ratioX));a.push(g)}const h=Ny(n,null,null,s,0,r.flat(),this.ratioX,!1);h.objs=a;const c=Ey(n,l,0,this.ratioX,this.ratioY,i.height),d=[];return r.forEach((t=>{const e=[];t.forEach((t=>{e.push({x:t[0],y:t[1]})}));const i=of(e),{left:n,bottom:s,top:o,right:r}=i;d.push([n,s,r,s,n,o,r,o])})),{type:e,rect:c,normalAppearance:h,opacity:s,quadPoints:d,name:t.uid,flags:Ly([...t.flags]),date:t.comment.modificationDate}}createShape(t){const{type:e,transform:i,style:n}=Wd(t),s={id:t.uid,style:n,transform:i};let o;switch("ellipse"===e&&(n.x+=n.width/2||0,n.y+=n.height/2||0,n.rx=n.width/2||n.rx,n.ry=n.height/2||n.ry),e){case"rectangle":o=new dv(s);break;case"ellipse":o=new lv(s);break;case"line":o=new wv(s);break;case"ink":o=new cv(s);break;case"polygon":o=new yv(s);break;case"polyline":o=new xv(s);break;case"textTypewriter":o=new gv(s,"freeTextWriter",{},!1);break;case"textBox":o=new gv(s,"textBox");break;case"stamp":o=new Mv(s);break;case"highlight":o=new Bv(s,Ov.HIGHLIGHT);break;case"underline":o=new Bv(s,Ov.UNDERLINE);break;case"strikeout":o=new Bv(s,Ov.STRIKEOUT)}return o}}class hx{constructor(){na(this,"annotationParser",new ax),na(this,"annotationWriter",new lx)}getParsedAnnotations(t,e,i){const n=Ep.displayResolution/Ep.pdfResolution;t=t.filter((t=>null!==t)),this.annotationParser.setParserConfig(e,i,n,n),this.moveReplyToAnnotation(t);const s=[];return t.forEach((t=>{if(t){const n=this.annotationParser.parseAnnotation(t);if(n){var e,i;n.flags=this.parseFlags(t.flags||[]),null!=t&&null!==(e=t.customData)&&void 0!==e&&null!==(e=e.dynamsoftFlags)&&void 0!==e&&e.length&&n.flags.push(...t.customData.dynamsoftFlags);const o=this.parseReply(t);null!==(i=t.replies)&&void 0!==i&&i.length&&(o.replies=t.replies.map((t=>this.parseReply(t)))||[]),n.comment=o,s.push(n)}}})),s}moveReplyToAnnotation(t){t.forEach((e=>{if(e&&"Text"===e.type&&!Hd(e.inreplyto)){const i=t[e.inreplyto];"Review"===e.statemodel?(i.reviewStates||(i.reviewStates=[]),i.reviewStates.push(e)):"Marked"===e.statemodel?(i.markedStates||(i.markedStates=[]),i.markedStates.push(e)):(i.replies||(i.replies=[]),i.replies.push(e))}})),t.slice().forEach((e=>{if(!e||"Popup"===e.type||!Hd(e.inreplyto)){const i=t.findIndex((t=>t===e));t.splice(i,1)}}))}parseReply(t){var e,i;const n=this.parseCommon(t);return n.subject=t.subject,null!==(e=t.reviewStates)&&void 0!==e&&e.length&&(n.reviewStates=t.reviewStates.map((t=>this.parseState(t)))),null!==(i=t.markedStates)&&void 0!==i&&i.length&&(n.markedStates=t.markedStates.map((t=>this.parseState(t)))),n}parseFlags(t){const e=[],i={readonly:"readOnly",noview:"noView"};return t.forEach((t=>{e.push(i[t]||t)})),t.includes("hidden")&&!e.includes("noView")&&e.push("noView"),e}parseState(t){return{...this.parseCommon(t),state:t.state,stateModel:t.statemodel}}parseCommon(t){const e=t.creationdate,i=t.date;return{uid:Qd(),author:t.title,contents:t.contents,type:t.type,creationDate:e||i,modifiedDate:i||e,flags:t.flags?[...t.flags]:[]}}parseDate(t){if(!t)return;let e=2;if(!t)return"";const i=[4,2,2,2,2,2].map((i=>{const n=t.slice(e,e+i);return e+=i,parseInt(n,10)}));i[1]-=1;const n=new Date(...i).getTime();return jd("yyyy.MM.dd hh:mm:ss",n)}async getOriginalAnnotations(t,e){return await this.annotationWriter.toPdfAnnotations(t,e)}}function cx(t){return{left:t[0],top:t[1],width:t[2]-t[0],height:t[3]-t[1]}}!function(t){t.CM_RENDERALL="cm/renderall",t.CM_IMAGEONLY="cm/imageonly",t.CM_AUTO="cm/auto"}(qv||(qv={})),function(t){t.NO_ANNOTATIONS="noAnnotations",t.RENDER_ANNOTATIONS="renderAnnotations",t.LOAD_ANNOTATIONS="loadAnnotations"}(Zv||(Zv={}));var dx=new WeakSet;class ux{constructor(){va(this,dx),na(this,"type","pdfParser"),na(this,"once",!1),na(this,"pdfReader",void 0),na(this,"parserOptions",{convertMode:qv.CM_AUTO}),na(this,"source",void 0),na(this,"isDestroy",!1),na(this,"annotationMapper",void 0),this.pdfReader=new bp,this.annotationMapper=new hx}initParser(t,e){this.parserOptions=null!=e?e:{convertMode:qv.CM_AUTO},this.source={fileSource:t,password:this.parserOptions.password}}async getPageCount(){return this.pdfReader.getPdfPageCount(this.source,ga(this,dx,px).call(this))}destroy(){var t;null===(t=this.pdfReader)||void 0===t||t.destroy(),this.pdfReader=null,this.isDestroy=!0}splitArrayIntoChunks(t,e){const i=[];for(let n=0;n<t.length;n+=e){const s=t.slice(n,n+e);i.push(s)}return i}async parseAnnotations(t,e){var i;const n=[];if(this.parserOptions.convertMode===qv.CM_IMAGEONLY||(null===(i=this.parserOptions.renderOptions)||void 0===i?void 0:i.renderAnnotations)!==Zv.LOAD_ANNOTATIONS)return n;for(let i=0;i<t.length;i++){const s=e[t[i]],o=s.nativeMediaBox;if(1===s.realReadMode&&s.pdfOptions.annotCount>0){const e=await this.pdfReader.readAnnotations(this.source,t[i]),r={pageUid:s.pageUid,fileIndex:t[i],annotations:[]};e.length&&(r.annotations=this.annotationMapper.getParsedAnnotations(e,2*o.left+o.width,2*o.top+o.height),s.annotations=r.annotations),n.push(r)}}return n}async parse(t){const e=[],i=this.parserOptions.convertMode===qv.CM_RENDERALL?[t]:this.splitArrayIntoChunks(t,100);for(let t=0;t<i.length;t++){const o=await this.pdfReader.readPageImageInfos({source:this.source,indices:i[t],readOptions:ga(this,dx,px).call(this),outputType:dp.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:r,pdfResolution:a}=Ep;for(let t=0;t<o.length;++t){var n,s;const i=o[t];i.mediaBox[0]>i.mediaBox[2]&&([i.mediaBox[0],i.mediaBox[2]]=[i.mediaBox[2],i.mediaBox[0]]),i.mediaBox[1]>i.mediaBox[3]&&([i.mediaBox[1],i.mediaBox[3]]=[i.mediaBox[3],i.mediaBox[1]]),i.cropBox[0]>i.cropBox[2]&&([i.cropBox[0],i.cropBox[2]]=[i.cropBox[2],i.mediaBox[0]]),i.cropBox[1]>i.cropBox[3]&&([i.cropBox[1],i.cropBox[3]]=[i.cropBox[3],i.cropBox[1]]);const l=1===i.realReadMode,h=l?cx(i.mediaBox):{left:0,top:0,width:i.imageWidth/i.imageXResolution*a,height:i.imageHeight/i.imageYResolution*a},c=l?cx([i.cropBox[0],i.mediaBox[1]+i.mediaBox[3]-i.cropBox[3],i.cropBox[2],i.mediaBox[1]+i.mediaBox[3]-i.cropBox[1]]):{...h},d=$u(h,a,r),u=$u(c,a,r),p={fileIndex:i.pageIndex,rotation:i.rotation,mediaBox:d,cropBox:u,nativeMediaBox:h,nativeCropBox:c,resource:{width:i.imageWidth,height:i.imageHeight,resolutionX:i.imageXResolution,resolutionY:i.imageYResolution,bitDepth:i.imageBitDepth},pdfOptions:{convertMode:l?qv.CM_RENDERALL:qv.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(n=this.parserOptions.renderOptions)||void 0===n?void 0:n.renderAnnotations,renderGrayscale:null===(s=this.parserOptions.renderOptions)||void 0===s?void 0:s.renderGrayscale},rotation:i.rotation,mediaBox:{...d},cropBox:{...u},annotCount:i.annotCount},realReadMode:i.realReadMode,annotations:[]};e.push(p)}}return e}async getPage(t){if(this.isDestroy||!this.source)return null;const e=await this.pdfReader.readPage({source:this.source,index:t,readOptions:ga(this,dx,px).call(this),outputType:dp.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(e&&0===e.code){const{displayResolution:t,pdfResolution:i}=Ep,n=e.imageInfos[0];return{fileIndex:e.pageIndex,rotation:e.rotation,mediaBox:$u(cx(e.mediaBox),i,t),cropBox:$u(cx(e.cropBox),i,t),resource:{data:e.imageData,width:n.imageWidth,height:n.imageHeight,resolutionX:n.imageXResolution,resolutionY:n.imageYResolution,bitDepth:n.imageBitDepth}}}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,t)}}function px(){var t,e;if(this.isDestroy)return null;if(!this.parserOptions)return null;const i={[Zv.NO_ANNOTATIONS]:0,[Zv.RENDER_ANNOTATIONS]:1,[Zv.LOAD_ANNOTATIONS]:2};return{convertMode:{[qv.CM_IMAGEONLY]:2,[qv.CM_RENDERALL]:1,[qv.CM_AUTO]:3}[(null===(t=this.parserOptions)||void 0===t?void 0:t.convertMode)||qv.CM_AUTO],renderOptions:{...this.parserOptions.renderOptions||{},renderAnnotations:i[null===(e=this.parserOptions.renderOptions)||void 0===e?void 0:e.renderAnnotations]||0,renderIgnoreCrop:!0}}}class gx{constructor(){na(this,"type","rgbaParser"),na(this,"once",!1),na(this,"processor",void 0),na(this,"cachePage",[]),na(this,"source",void 0),na(this,"parserOptions",void 0),this.processor=new yp}initParser(t,e){this.source=t,this.parserOptions=e}async getPageCount(){return 1}destroy(){var t;null===(t=this.processor)||void 0===t||t.terminate(),this.processor=void 0}async parse(){var t;const{outputType:e,jpegQuality:i,returnBase64:n,width:s,height:o,bitDepth:r,xResolution:a,yResolution:l}=null!==(t=this.parserOptions)&&void 0!==t?t:{},h=await this.source.arrayBuffer();await this.processor.initImage({source:h,isRGBA:!0,width:s,height:o,isBGRA:!1});const c=await this.processor.getImage({jpegQuality:i,ifDeleteObject:!0,isRGBA:!0,bitDepth:r,xDpi:a,yDpi:l,returnBlob:!0,returnType:e}),d=vy(c);return c.srcBuffer,this.cachePage=[d],this.cachePage}async parseAnnotations(t,e){return[]}async getPage(){return Promise.resolve(this.cachePage[0])}cancelGetPage(t){}}class fx{constructor(){na(this,"db",void 0),this.db=new Map}saveByMime(t,e){this.db.set(t,e)}hasByMime(t){return this.db.has(t)}deleteConstructorByMime(t){return!!this.hasByMime(t)&&(this.db.delete(t),!0)}getConstructorByMime(t){return this.db.get(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear()}}const mx=new class{constructor(){na(this,"db",void 0),this.db=new Map}saveByFileUid(t,e){this.db.set(t,e)}getParserByFileUid(t){return this.db.get(t)}deleteParserByFileUid(t){return this.db.delete(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear()}getAllParsers(){return Array.from(this.db.values())}},vx=new fx,yx=new fx,xx=new class{constructor(){na(this,"db",void 0),this.db=new Map}getDefaultOptionsByMime(t){return this.db.get(t)}deleteDefaultOptionsByMime(t){return this.db.delete(t)}saveDefaultOptionsByMime(t,e){this.db.set(t,e)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear()}},wx=new class{constructor(t,e,i){na(this,"parserRepo",void 0),na(this,"parserConstructorRepo",void 0),na(this,"customParserConstructorRepo",void 0),this.parserRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=i}getParser(t,e){let i=this.parserRepo.getParserByFileUid(t);return i||(i=new(this.customParserConstructorRepo.getConstructorByMime(e)||this.parserConstructorRepo.getConstructorByMime(e)),i.once||this.parserRepo.saveByFileUid(t,i),i)}}(mx,vx,yx),bx=new class{constructor(t){na(this,"parserRepo",void 0),this.parserRepo=t}execute(t){let{fileIndex:e,fileUid:i}=t;const n=this.parserRepo.getParserByFileUid(i);n&&n.cancelGetPage(e)}}(mx),Cx=new class{constructor(t){na(this,"parserRepo",void 0),this.parserRepo=t}execute(t){const e=this.parserRepo.getParserByFileUid(t);e&&(e.destroy(),this.parserRepo.deleteParserByFileUid(t))}}(mx),Sx=new class{constructor(t,e){na(this,"parserService",void 0),na(this,"parserRepo",void 0),this.parserService=t,this.parserRepo=e}async execute(t){const{fileData:e,mime:i,fileUid:n,fileIndex:s}=t;let o=this.parserRepo.getParserByFileUid(n);return o||(o=this.parserService.getParser(n,i),o.initParser(e)),o.getPage(s)}}(wx,mx),_x=new class{constructor(t,e){na(this,"parserService",void 0),na(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e}async execute(t){const{fileData:e,mime:i,fileUid:n,indices:s}=t;let{parseOptions:o}=t;o=o||this.defaultParserOptionsRepo.getDefaultOptionsByMime(i);const r=this.parserService.getParser(n,i);return r.initParser(e,o),r.parse(s)}}(wx,xx),Tx=new class{constructor(t,e){na(this,"parserService",void 0),na(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e}async execute(t){const{fileData:e,mime:i,fileUid:n,indices:s,parsedPages:o}=t;let{parseOptions:r}=t;return r=r||this.defaultParserOptionsRepo.getDefaultOptionsByMime(i),this.parserService.getParser(n,i).parseAnnotations(s,o)}}(wx,xx),Ex=new class{constructor(t){na(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t}execute(t){let{mime:e,parser:i}=t;this.parserConstructorRepo.saveByMime(e,i)}}(vx),Px=new class{constructor(t){na(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t}execute(t){this.parserConstructorRepo.deleteConstructorByMime(t)}}(yx),Ax=new class{constructor(t){na(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t}execute(t){let{mime:e,parser:i}=t;this.customParserConstructorRepo.saveByMime(e,i)}}(vx),Ix=new class{constructor(t){na(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t}execute(t){this.customParserConstructorRepo.deleteConstructorByMime(t)}}(yx),Dx=new class{constructor(t){na(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=t}execute(t){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(t)}}(xx),kx=new class{constructor(t,e,i){na(this,"defaultParserOptionsRepo",void 0),na(this,"parserConstructorRepo",void 0),na(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=i}execute(t){let{mime:e,options:i}=t;return!(!i||!Vd(i)||!this.customParserConstructorRepo.hasByMime(e)&&!this.parserConstructorRepo.hasByMime(e)||(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(e,Wd(i)),0))}}(xx,vx,yx),Rx=new class{constructor(t){na(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t}execute(t){return this.customParserConstructorRepo.getConstructorByMime(t)}}(yx),Mx=new class{constructor(t,e){na(this,"parserService",void 0),na(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e}async execute(t){var e,i;let{fileData:n,mime:s,fileUid:o,options:r}=t;r=r||this.defaultParserOptionsRepo.getDefaultOptionsByMime(s);const a=this.parserService.getParser(o,s);return a.initParser(n,r),{pageCount:await a.getPageCount(),batchSize:null!==(e=null===(i=r)||void 0===i?void 0:i.batchSize)&&void 0!==e?e:0}}}(wx,xx);class Lx{constructor(){na(this,"type",void 0),na(this,"once",!1),na(this,"cachedPage",void 0),na(this,"parserOptions",void 0)}initParser(t,e){this.parserOptions=e}async getPageCount(){return Promise.resolve(1)}destroy(){}async parse(){const{width:t,height:e,bitDepth:i,resolutionX:n,resolutionY:s}=this.parserOptions,o=vy({imageBitDepth:i,imageHeight:e,imageWidth:t,imageXResolution:n,imageYResolution:s});return this.cachedPage=o,[this.cachedPage]}async parseAnnotations(t,e){return[]}async getPage(){const t=await this.createBlankPage(this.parserOptions.width,this.parserOptions.height);return this.cachedPage.resource.data=t,this.cachedPage}cancelGetPage(){}async createBlankPage(t,e){var i,n,s;const o=new Uint8Array([255,255,255,255]),r=new yp;await r.initImage({source:o,isRGBA:!0,width:1,height:1,isBGRA:!1}),await r.resize(t,e);const a=await r.getImage({jpegQuality:null!==(i=this.parserOptions.jpegQuality)&&void 0!==i?i:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(n=this.parserOptions.resolutionX)&&void 0!==n?n:96,yDpi:null!==(s=this.parserOptions.resolutionY)&&void 0!==s?s:96,returnBlob:!1,returnType:_p[cp.JPEG]});return new Blob([a.imageData],{type:a.blobType})}}var Ox;!function(t){t.GOOD="Good",t.AUTO_CAPTURE="AutoCaptured",t.SMALL_SIZE="SmallSize",t.OFF_CENTER="OffCenter",t.SKEW="Skew",t.NOTHING_DETECTED="NothingDetected"}(Ox||(Ox={}));var Bx,Fx=new WeakSet,Nx=new WeakSet,Ux=new WeakSet,Vx=new WeakSet,Wx=new WeakSet,Hx=new WeakSet,jx=new WeakSet,zx=new WeakSet,Gx=new WeakSet,Yx=new WeakSet;class $x{constructor(){va(this,Yx),va(this,Gx),va(this,zx),va(this,jx),va(this,Hx),va(this,Wx),va(this,Vx),va(this,Ux),va(this,Nx),va(this,Fx),na(this,"detector",void 0),na(this,"succeedDetect",0),na(this,"failedDetect",0),na(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0}destroy(){this.clear()}clear(){var t;null===(t=this.detector)||void 0===t||t.terminate(),this.detector=void 0}async detect(t,e){return Promise.resolve({success:!1})}getStatusMsg(t){switch(t){case Ox.AUTO_CAPTURE:return"Auto capture completed.";case Ox.GOOD:return"Capturing your document... Please do not move the camera.";case Ox.SMALL_SIZE:return"The document is too small. Try moving closer.";case Ox.OFF_CENTER:return"Try holding the device at the center of the document.";case Ox.SKEW:return"Please hold the device over a document to start scanning.";case Ox.NOTHING_DETECTED:return"No document is detected."}}processDetectResult(t){if([].concat(...t.location).every((t=>0===t)))return{success:!1,confidence:0,status:Ox.NOTHING_DETECTED};let e;const i=this.calculateConfidence(t.location,t.width,t.height);e=Hd(t.confidence)?this.calculateTotalConfidence(i):t.confidence;const n={success:!0,location:t.location,confidence:e},{angleConfidence:s,areaConfidence:o,centerConfidence:r}=i,{config:a}=t;return e>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.succeedDetect+=1,n.status=Ox.GOOD,this.succeedDetect,5===this.succeedDetect||this.succeedDetect,null!=a&&a.enableAutoCapture?this.autoCaptureStartTime<=0?this.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-this.autoCaptureStartTime>a.autoCaptureDelay&&(this.autoCaptureStartTime=0,n.status=Ox.AUTO_CAPTURE):this.autoCaptureStartTime=0):.45*s+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=Ox.SMALL_SIZE):.45*s+.45*o+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=Ox.OFF_CENTER):.45*o+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),n.status=Ox.SKEW):(n.success=!1,n.status=Ox.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0),this.failedDetect>5&&this.reset(),n.statusMsg=this.getStatusMsg(n.status),n}calculateConfidence(t,e,i){return ga(this,Ux,qx).call(this,ga(this,Fx,Xx).call(this,t),e,i)}calculateTotalConfidence(t){const{angleConfidence:e,areaConfidence:i,centerConfidence:n}=t;return e&&i&&n?.3*e+.3*i+.3*n+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0}}function Xx(t){return t?[t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1]]:[0,0,0,0,0,0,0,0]}function qx(t,e,i){return{angleConfidence:ga(this,Vx,Zx).call(this,t),areaConfidence:ga(this,Wx,Jx).call(this,t,e,i),centerConfidence:ga(this,Hx,Kx).call(this,t,e,i)}}function Zx(t){let e=0;const i=ga(this,zx,tw).call(this,[t[0],t[1]],[t[2],t[3]],[t[4],t[5]]),n=ga(this,zx,tw).call(this,[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]),s=ga(this,zx,tw).call(this,[t[4],t[5]],[t[6],t[7]],[t[0],t[1]]),o=ga(this,zx,tw).call(this,[t[6],t[7]],[t[0],t[1]],[t[2],t[3]]);return e+=Math.abs(i-90),e+=Math.abs(n-90),e+=Math.abs(s-90),e+=Math.abs(o-90),Math.max(0,100*Math.min(1,1-.025*e))}function Jx(t,e,i){const n=ga(this,Yx,iw).call(this,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);return Math.min(100,400*Math.max(0,n/(e*i)))}function Kx(t,e,i){const n=[(t[0]+t[2]+t[4]+t[6])/4,(t[1]+t[3]+t[5]+t[7])/4],s=ga(this,jx,Qx).call(this,n,[e/2,i/2]);return Math.max(0,100*Math.min(1,1-s/Math.min(e,i)))}function Qx(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function tw(t,e,i){const n=ga(this,jx,Qx).call(this,e,t),s=ga(this,jx,Qx).call(this,e,i),o=ga(this,jx,Qx).call(this,t,i);return 0===n||0===s?0:Math.acos((n*n+s*s-o*o)/(2*n*s))/Math.PI*180}function ew(t,e,i,n,s,o){return(t*n+e*s+i*o-s*n-o*t-i*e)/2}function iw(t,e,i,n,s,o,r,a){return ga(this,Gx,ew).call(this,t,e,i,n,s,o)+ga(this,Gx,ew).call(this,t,e,s,o,r,a)}!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert",t.BRIGHTNESS="brightness",t.CONTRAST="contrast",t.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast"}(Bx||(Bx={}));var nw=new WeakMap,sw=new WeakMap,ow=new WeakSet,rw=new WeakSet,aw=new WeakSet;async function lw(t,e,i,n){var s;return await(null===(s=this.filter)||void 0===s?void 0:s.applyFilter(t,e))}function hw(t){return sa(this,nw).push(t),sa(this,sw)||(oa(this,sw,!0),ga(this,aw,cw).call(this)),t.promise}async function cw(){do{if(sa(this,nw).isEmpty())break;const t=sa(this,nw).pop();try{let e;"filter"===(null==t?void 0:t.api)&&(e=await ga(this,ow,lw).apply(this,t.params)),null==t||t.resolve(e)}catch(e){t.retry<1?(t.retry+=1,sa(this,nw).push(t)):null==t||t.reject(e)}}while(!sa(this,nw).isEmpty());oa(this,sw,!1)}const dw=new Map([[Bx.NONE,"None"],[Bx.BLACK_AND_WHITE,"toBW"],[Bx.GRAY,"toGray"],[Bx.REMOVE_SHADOW,"removeShadow"],[Bx.SAVE_INK,"toBW"],[Bx.ENHANCE,"enhance"],[Bx.INVERT,"invert"],[Bx.CONTRAST,"brightnessAndContrast"],[Bx.BRIGHTNESS,"brightnessAndContrast"],[Bx.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var uw,pw=new WeakSet,gw=new WeakSet;function fw(t,e){const i={...e||{}};return t===Bx.SAVE_INK&&(i.method="adaptiveThreshold"),i}function mw(t){var e,i;return t.returnType=_p[t.outputType],t.bRGBA=t.outputType===cp.RGBA,t.returnBlob=null!==(e=t.returnBlob)&&void 0!==e&&e,t.bRGBA&&void 0===t.returnType?t.returnType=dp.IT_JPG:t.returnType=null!==(i=t.returnType)&&void 0!==i?i:dp.IT_ALL,t.is1BitTo8Bit=np.isApple,t}class vw{static replaceMessage(t,e,i){let n=t;return e&&(n=n.replace("<%api%>",e)),i&&(n=n.replace("<%param%>",i)),n}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null}static buildError(t,e,i){if(t&&!t.code&&t.cause&&t.cause.code&&t.cause.message)return Zd(t.message)&&(t.message=this.replaceMessage(t.message,e,i)),t;const n={code:t.code,message:t.message};null!=t&&t.details&&(n.details=t.details);let s={...t};return n.code>-8e4&&0!==n.code?n.code<=-2e4||(n.code=vw.WASM_ERR.code,n.message=vw.WASM_ERR.message,s.actualCode=s.code,s.code=n.code):n.code?(n.message=this.replaceMessage(n.message,e,i),s={...n},Array.isArray(n.details)&&0!==n.details.length&&(s.details=n.details)):(n.code=vw.EXTERNAL_ERR.code,n.message=vw.EXTERNAL_ERR.message,s.actualCode=t.code,s.message=t.message,t.name&&(s.name=t.name),t.stack&&(s.stack=t.stack),s.code=n.code,s.actualError=t),new Error(n.message,{cause:s})}static warning(t,e,i){const n=vw.buildError(t,e,i);this.lastError=n,this.onWarning.emit(n)}static error(t,e,i){const n=vw.buildError(t,e,i);throw this.lastError=n,this.onError.emit(n),n}static verbose(t,e,i){this.onVerbose.emit(t)}static throw(t,e,i){const n=vw.buildError(t,e,i);throw this.lastError=n,this.onError.emit(n),n}static reject(t,e,i){const n=vw.buildError(t,e,i);return this.lastError=n,this.onError.emit(n),Promise.reject(n)}static buildInfo(t,e){const i={details:e,id:vw.infoObjCount,status:"Pending",timestamp:Date.now(),type:t};return vw.infoObjCount+=1,i}static info(t){t.timestamp=Date.now(),this.onInfo.emit(Wd(t))}static on(t,e){"error"===t?this.onError.on(e):"verbose"===t?(this.onVerbose.on(e),0!==this.verboseListenerCount&&np.hasDebugOutput()||(np.enableDebugOutput(!0,(t=>{this.verbose(t)})),this.verboseListenerCount+=1)):"warning"===t?this.onWarning.on(e):"info"===t&&this.onInfo.on(e)}static off(t,e){"error"===t?this.onError.off(e):"verbose"===t?(this.onVerbose.off(e),this.verboseListenerCount-=1,0===this.verboseListenerCount&&np.enableDebugOutput(!1,void 0)):"warning"===t?this.onWarning.off(e):"info"===t&&this.onInfo.off(e)}}function yw(t,e,i,n){return e?i?`${e}${n?"":"."}${i}`:`${e}`:i?`${t}${n?"":"."}${i}`:`${t}`}na(vw,"onError",new su),na(vw,"onWarning",new su),na(vw,"onVerbose",new su),na(vw,"onInfo",new su),na(vw,"verboseListenerCount",0),na(vw,"infoObjCount",0),na(vw,"lastError",void 0),na(vw,"LIC_EMPTY",{code:-8e4,message:"No license."}),na(vw,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),na(vw,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),na(vw,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),na(vw,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),na(vw,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),na(vw,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),na(vw,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),na(vw,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),na(vw,"WASM_ERR",{code:-81e3,message:"WASM Error"}),na(vw,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),na(vw,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),na(vw,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),na(vw,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),na(vw,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),na(vw,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),na(vw,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),na(vw,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),na(vw,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),na(vw,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),na(vw,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),na(vw,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),na(vw,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),na(vw,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),na(vw,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),na(vw,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),na(vw,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),na(vw,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),na(vw,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),na(vw,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),na(vw,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),na(vw,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),na(vw,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),na(vw,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),na(vw,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),na(vw,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),na(vw,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),na(vw,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),na(vw,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),na(vw,"UNSELECTED_FLATTENED",{code:-80320,message:"Flattened annotation cannot be selected."}),na(vw,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),na(vw,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),na(vw,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),na(vw,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),na(vw,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),na(vw,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),na(vw,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),na(vw,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),na(vw,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class xw{static makeSureValid(t,e,i,n){const s=this.composeError(i,n);vw.throw(s,t,e)}static output(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=this.composeError(n,s);return 2===t?vw.reject(r,e,i):1===t?(vw.warning(r,e,i),o):0===t?vw.error(r,e,i):3===t?vw.verbose(r,e,i):void 0}static error(t,e,i,n){const s=this.composeError(i,n);vw.throw(s,t,e)}static warning(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=this.composeError(i,n);return vw.warning(o,t,e),s}static verbose(t,e,i,n){const s=this.composeError(i,n);vw.verbose(s,t,e)}static reject(t,e,i,n){const s=this.composeError(i,n);return vw.reject(s,t,e)}static composeError(t,e){const i={...Hd(e)?vw.PARAM_INVALID:e};return t&&(i.details=t),i}static formatDetails(t,e){const i=[];if(Yd(e))e||i.push(`'${t}' is invalid.`);else{const{isValid:n,isInRange:s,isSupported:o}=e;!1===n&&i.push(`'${t}' is invalid.`),!1===s&&i.push(`'${t}' is out of range.`),!1===o&&i.push(`'${t}' is not supported.`)}return i}static formatError(t,e){const{isValid:i,isInRange:n,isSupported:s}=t;if(!1===i||!1===n||!1===s){if(e)return e;if(!i)return vw.PARAM_INVALID;if(!n)return vw.PARAM_OUT_OF_RANGE;if(!s)return vw.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(t){return zd(t)||Gd(t)}static isArrayAndMeetMinLength(t,e){return Ud(t)?qd(e)?{isValid:0!==t.length,isInRange:t.length>=e}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(t,e,i){return qd(t)?{isValid:!0,isInRange:!(!Hd(e)&&t<e||!Hd(i)&&t>i)}:{isValid:!1}}static isStringAndNotEmpty(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Zd(t)?e?{isValid:!0}:{isValid:0!==t.trim().length}:{isValid:!1}}static isPdfDate(t){if(!Zd(t))return{isValid:!1};const e=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['](\d{2})[']|)$/);let i=!1;if(e){const[,t,n,s,o,r,a,l,h,c]=e,d=new Date(`${t}-${n}-${s}T${o}:${r}:${a}`);if(i=!0,d.getFullYear()===parseInt(t,10)&&d.getMonth()+1===parseInt(n,10)&&d.getDate()===parseInt(s,10)&&d.getHours()===parseInt(o,10)&&d.getMinutes()===parseInt(r,10)&&d.getSeconds()===parseInt(a,10)||(i=!1),i&&l){const t=parseInt(h,10),e=parseInt(c,10);(t<0||t>12||e<0||e>59||"+"!==l&&"-"!==l)&&(i=!1)}}return{isSupported:i}}}!function(t){t[t.BlackAndWhite=1]="BlackAndWhite",t[t.Gray=2]="Gray",t[t.RemoveShadow=3]="RemoveShadow",t[t.Enhance=4]="Enhance",t[t.Invert=5]="Invert",t[t.Brightness=6]="Brightness",t[t.Contrast=7]="Contrast",t[t.BrightnessAndContrast=8]="BrightnessAndContrast",t[t.Perspective=9]="Perspective",t[t.Deskew=10]="Deskew",t[t.Rotate=11]="Rotate",t[t.Flip=12]="Flip",t[t.Resize=13]="Resize",t[t.SetHeight=14]="SetHeight",t[t.SetWidth=15]="SetWidth",t[t.SetDPI=16]="SetDPI",t[t.Crop=17]="Crop",t[t.Erase=18]="Erase",t[t.DrawPolygon=19]="DrawPolygon"}(uw||(uw={}));var ww=new WeakSet,bw=new WeakSet;class Cw{constructor(){va(this,bw),va(this,ww)}async process(t,e,i){Ud(e)||(e=[e]),ga(this,ww,Sw).call(this,e);const n=new yp,s={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var o,r,a,l;const h=await n.initImage({source:t.data,isRGBA:t.type===cp.RGBA,width:t.width,height:t.height,isBGRA:t.type===cp.BGRA});h.srcBuffer&&(t.data=h.srcBuffer);for(const t of e)ga(this,bw,_w).call(this,n,t);const c=await n.getImage({jpegQuality:null==i||null===(o=i.params)||void 0===o?void 0:o.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===cp.RGBA,bitDepth:null==i||null===(r=i.params)||void 0===r?void 0:r.bitDepth,xDpi:null==i||null===(a=i.params)||void 0===a?void 0:a.xDpi,yDpi:null==i||null===(l=i.params)||void 0===l?void 0:l.yDpi,returnBlob:!1,returnType:_p[null==i?void 0:i.type]});await n.freeReservedData(),s.output=c.imageData,s.outputContentType=c.blobType,s.outputImageInfo={width:c.imageWidth,height:c.imageHeight,bitDepth:c.imageBitDepth,resolutionX:c.imageXResolution,resolutionY:c.imageYResolution},s.outputType=Tp[c.imageType]}finally{try{await n.terminate()}catch(t){vw.warning(t)}}return s}}function Sw(t){for(const e of t)e.type&&(e.type<=0||(e.type,uw.DrawPolygon),e.params)}async function _w(t,e){var i;const n=null!==(i=e.params)&&void 0!==i?i:{};switch(e.type){case uw.BlackAndWhite:return t.toBinaryLevel(n.saveInk,n.level);case uw.Gray:return t.toGrayscale(n.level);case uw.RemoveShadow:return t.removeShadowLevel(n.level,n.alpha);case uw.Enhance:return t.brighten();case uw.Invert:return t.invert();case uw.Contrast:return t.changeBrightnessAndContrast(void 0,n.contrast);case uw.Brightness:return t.changeBrightnessAndContrast(n.brightness,void 0);case uw.BrightnessAndContrast:return t.changeBrightnessAndContrast(n.brightness,n.contrast);case uw.Perspective:return t.perspective(n.location);case uw.Deskew:{var s;const e=await t.getSkewAngle(n.options);return t.rotate({angle:e,fillColor:n.fillColor,keepSize:null===(s=n.keepSize)||void 0===s||s,mode:n.mode})}case uw.Rotate:return t.rotate({angle:n.angle,fillColor:n.fillColor,keepSize:n.keepSize,mode:n.mode});case uw.Flip:return t.flip();case uw.Resize:{const{newWidth:e,newHeight:i,mode:s}=n;return t.resize(e,i,s)}case uw.SetHeight:{const{newHeight:e,fillColor:i}=n;return t.setImageHeight(e,i)}case uw.SetWidth:{const{newWidth:e,fillColor:i}=n;return t.setImageWidth(e,i)}case uw.SetDPI:return t.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:n.xRes,resolutionY:n.yRes,resample:!1});case uw.Crop:return t.crop({left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top});case uw.Erase:return t.erase({left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top},n.fillColor);case uw.DrawPolygon:return t.drawQuadrangle({location:n.location,strokeColor:n.strokeColor,lineWidth:n.lineWidth})}}!ud&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!ud&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Tw=async(t,e,i)=>{if(!t._bNeverShowDialog)try{let n=await fetch(t.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=s;let r=[];for(let t=0;t<o.childElementCount;++t){let e=o.children[t];e instanceof HTMLStyleElement&&(r.push(e),document.head.append(e))}let a=1==o.childElementCount?o.children[0]:o;a.remove();let l,h,c,d,u,p=[a],g=a.children;for(let t of g)p.push(t);for(let t=0;t<p.length;++t)for(let e of p[t].children)p.push(e);for(let t of p)if(!l&&t.classList.contains("dls-license-mask"))l=t,t.addEventListener("click",(e=>{if(t==e.target){a.remove();for(let t of r)t.remove()}}));else if(!h&&t.classList.contains("dls-license-icon-close"))h=t,t.addEventListener("click",(()=>{a.remove();for(let t of r)t.remove()}));else if(!c&&t.classList.contains("dls-license-icon-error"))c=t,"error"!=e&&t.remove();else if(!d&&t.classList.contains("dls-license-icon-warn"))d=t,"warn"!=e&&t.remove();else if(!u&&t.classList.contains("dls-license-msg-content")){u=t;let e=i;for(;e;){let i=e.indexOf("["),n=e.indexOf("]",i),s=e.indexOf("(",n),o=e.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==o){t.appendChild(new Text(e));break}i>0&&t.appendChild(new Text(e.substring(0,i)));let r=document.createElement("a"),a=e.substring(i+1,n);r.innerText=a;let l=e.substring(s+1,o);r.setAttribute("href",l),r.setAttribute("target","_blank"),t.appendChild(r),e=e.substring(o+1)}}document.body.appendChild(a)}catch(e){t._onLog&&t._onLog(e.message||e)}};var Ew=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function Pw(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if("TypeError"!==s.name)throw s;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}function Aw(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function Iw(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function Dw(t){return"string"!=typeof t&&(t=String(t)),t}function kw(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Rw="local-forage-detect-blob-support";let Mw;const Lw={},Ow=Object.prototype.toString,Bw="readonly",Fw="readwrite";function Nw(t){var e=Lw[t.name],i={};i.promise=new Promise((function(t,e){i.resolve=t,i.reject=e})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise}function Uw(t){var e=Lw[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function Vw(t,e){var i=Lw[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function Ww(t,e){return new Promise((function(i,n){if(Lw[t.name]=Lw[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);Nw(t),t.db.close()}var s=[t.name];e&&s.push(t.version);var o=Ew.open.apply(Ew,s);e&&(o.onupgradeneeded=function(e){var i=o.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(Rw)}catch(t){if("ConstraintError"!==t.name)throw t}}),o.onerror=function(t){t.preventDefault(),n(o.error)},o.onsuccess=function(){var e=o.result;e.onversionchange=function(t){t.target.close()},i(e),Uw(t)}}))}function Hw(t){return Ww(t,!1)}function jw(t){return Ww(t,!0)}function zw(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,s=t.version>t.db.version;if(n&&(t.version,t.version=t.db.version),s||i){if(i){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function Gw(t){var e=this,i=e._initReady().then((function(){var t=Lw[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return Iw(i,t,t),i}function Yw(t,e,i,n){void 0===n&&(n=1);try{var s=t.db.transaction(t.storeName,e);i(null,s)}catch(s){if(n>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return Promise.resolve().then((()=>{if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),jw(t)})).then((()=>function(t){Nw(t);for(var e=Lw[t.name],i=e.forages,n=0;n<i.length;n++){const t=i[n];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return t.db=null,Hw(t).then((e=>(t.db=e,zw(t)?jw(t):e))).then((n=>{t.db=e.db=n;for(var s=0;s<i.length;s++)i[s]._dbInfo.db=n})).catch((e=>{throw Vw(t,e),e}))}(t).then((function(){Yw(t,e,i,n-1)})))).catch(i);i(s)}}var $w={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var s=Lw[i.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},Lw[i.name]=s),s.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=Gw);var o=[];function r(){return Promise.resolve()}for(var a=0;a<s.forages.length;a++){var l=s.forages[a];l!==e&&o.push(l._initReady().catch(r))}var h=s.forages.slice(0);return Promise.all(o).then((function(){return i.db=s.db,Hw(i)})).then((function(t){return i.db=t,zw(i,e._defaultConfig.version)?jw(i):t})).then((function(t){i.db=s.db=t,e._dbInfo=i;for(var n=0;n<h.length;n++){var o=h[n];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version)}}))},_support:function(){try{if(!Ew||!Ew.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),getItem:function(t,e){var i=this;t=Dw(t);var n=new Promise((function(e,n){i.ready().then((function(){Yw(i._dbInfo,Bw,(function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).get(t);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null),function(t){return t&&t.__local_forage_encoded_blob}(t)&&(t=function(t){var e=function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),s=0;s<e;s++)n[s]=t.charCodeAt(s);return i}(atob(t.data));return Pw([e],{type:t.type})}(t)),e(t)},r.onerror=function(){n(r.error)}}catch(t){n(t)}}))})).catch(n)}));return Aw(n,e),n},setItem:function(t,e,i){var n=this;t=Dw(t);var s=new Promise((function(i,s){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===Ow.call(e)?function(t){return"boolean"==typeof Mw?Promise.resolve(Mw):function(t){return new Promise((function(e){var i=t.transaction(Rw,Fw),n=Pw([""]);i.objectStore(Rw).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return Mw=t,Mw}))}(o.db).then((function(t){return t?e:(i=e,new Promise((function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)})));var i})):e})).then((function(e){Yw(n._dbInfo,Fw,(function(o,r){if(o)return s(o);try{var a=r.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);r.oncomplete=function(){void 0===e&&(e=null),i(e)},r.onabort=r.onerror=function(){var t=l.error?l.error:l.transaction.error;s(t)}}catch(t){s(t)}}))})).catch(s)}));return Aw(s,i),s},removeItem:function(t,e){var i=this;t=Dw(t);var n=new Promise((function(e,n){i.ready().then((function(){Yw(i._dbInfo,Fw,(function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(r.error)},o.onabort=function(){var t=r.error?r.error:r.transaction.error;n(t)}}catch(t){n(t)}}))})).catch(n)}));return Aw(n,e),n},clear:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Yw(e._dbInfo,Fw,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).clear();s.oncomplete=function(){t()},s.onabort=s.onerror=function(){var t=o.error?o.error:o.transaction.error;i(t)}}catch(t){i(t)}}))})).catch(i)}));return Aw(i,t),i},length:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Yw(e._dbInfo,Bw,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){i(o.error)}}catch(t){i(t)}}))})).catch(i)}));return Aw(i,t),i},keys:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){Yw(e._dbInfo,Bw,(function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).openKeyCursor(),r=[];o.onsuccess=function(){var e=o.result;e?(r.push(e.key),e.continue()):t(r)},o.onerror=function(){i(o.error)}}catch(t){i(t)}}))})).catch(i)}));return Aw(i,t),i},dropInstance:function(t,e){e=kw.apply(this,arguments);var i,n=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName),t.name){const e=t.name===n.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):Hw(t).then((e=>{const i=Lw[t.name],n=i.forages;i.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e}));i=t.storeName?e.then((e=>{if(!e.objectStoreNames.contains(t.storeName))return;const i=e.version+1;Nw(t);const n=Lw[t.name],s=n.forages;e.close();for(let t=0;t<s.length;t++){const e=s[t];e._dbInfo.db=null,e._dbInfo.version=i}const o=new Promise(((e,n)=>{const s=Ew.open(t.name,i);s.onerror=t=>{s.result.close(),n(t)},s.onupgradeneeded=()=>{s.result.deleteObjectStore(t.storeName)},s.onsuccess=()=>{const t=s.result;t.close(),e(t)}}));return o.then((t=>{n.db=t;for(let e=0;e<s.length;e++){const i=s[e];i._dbInfo.db=t,Uw(i._dbInfo)}})).catch((e=>{throw(Vw(t,e)||Promise.resolve()).catch((()=>{})),e}))})):e.then((e=>{Nw(t);const i=Lw[t.name],n=i.forages;e.close();for(var s=0;s<n.length;s++)n[s]._dbInfo.db=null;const o=new Promise(((e,i)=>{var n=Ew.deleteDatabase(t.name);n.onerror=()=>{const t=n.result;t&&t.close(),i(n.error)},n.onblocked=()=>{},n.onsuccess=()=>{const t=n.result;t&&t.close(),e(t)}}));return o.then((t=>{i.db=t;for(var e=0;e<n.length;e++)Uw(n[e]._dbInfo)})).catch((e=>{throw(Vw(t,e)||Promise.resolve()).catch((()=>{})),e}))}))}else i=Promise.reject("Invalid arguments");return Aw(i,e),i}};const Xw=new Map;function qw(t,e){let i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}var Zw={_driver:"tempStorageWrapper",_initStorage:async function(t){const e={};if(t)for(let i in t)e[i]=t[i];const i=e.keyPrefix=qw(t,this._defaultConfig);this._dbInfo=e,Xw.has(i)||Xw.set(i,new Map)},getItem:function(t,e){t=Dw(t);const i=this.ready().then((()=>Xw.get(this._dbInfo.keyPrefix).get(t)));return Aw(i,e),i},setItem:function(t,e,i){t=Dw(t);const n=this.ready().then((()=>(void 0===e&&(e=null),Xw.get(this._dbInfo.keyPrefix).set(t,e),e)));return Aw(n,i),n},removeItem:function(t,e){t=Dw(t);const i=this.ready().then((()=>{Xw.get(this._dbInfo.keyPrefix).delete(t)}));return Aw(i,e),i},clear:function(t){const e=this.ready().then((()=>{const t=this._dbInfo.keyPrefix;Xw.has(t)&&Xw.delete(t)}));return Aw(e,t),e},length:function(t){const e=this.ready().then((()=>Xw.get(this._dbInfo.keyPrefix).size));return Aw(e,t),e},keys:function(t){const e=this.ready().then((()=>[...Xw.get(this._dbInfo.keyPrefix).keys()]));return Aw(e,t),e},dropInstance:function(t,e){if(e=kw.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){const e=this.config();t.name=t.name||e.name,t.storeName=t.storeName||e.storeName}let i;return i=t.name?new Promise((e=>{t.storeName?e(qw(t,this._defaultConfig)):e(`${t.name}/`)})).then((t=>{Xw.delete(t)})):Promise.reject("Invalid arguments"),Aw(i,e),i}};const Jw=(t,e)=>t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e),Kw=(t,e)=>{const i=t.length;let n=0;for(;n<i;){if(Jw(t[n],e))return!0;n++}return!1},Qw=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},tb={},eb={},ib={INDEXEDDB:$w,TEMPSTORAGE:Zw},nb=[ib.INDEXEDDB._driver,ib.TEMPSTORAGE._driver],sb=["dropInstance"],ob=["clear","getItem","keys","length","removeItem","setItem"].concat(sb),rb={description:"",driver:nb.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ab(t,e){t[e]=function(){const i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))}}function lb(){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(e)for(let t in e)e.hasOwnProperty(t)&&(Qw(e[t])?arguments[0][t]=e[t].slice():arguments[0][t]=e[t])}return arguments[0]}class hb{constructor(t){for(let t in ib)if(ib.hasOwnProperty(t)){const e=ib[t],i=e._driver;this[t]=i,tb[i]||this.defineDriver(e)}this._defaultConfig=lb({},rb),this._config=lb({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(t){if("object"==typeof t){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config}defineDriver(t,e,i){const n=new Promise((function(e,i){try{const n=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(s);const o=ob.concat("_initStorage");for(let e=0,n=o.length;e<n;e++){const n=o[e];if((!Kw(sb,n)||t[n])&&"function"!=typeof t[n])return void i(s)}const r=function(){const e=function(t){return function(){const e=new Error(`Method ${t} is not implemented by the current driver`),i=Promise.reject(e);return Aw(i,arguments[arguments.length-1]),i}};for(let i=0,n=sb.length;i<n;i++){const n=sb[i];t[n]||(t[n]=e(n))}};r();const a=function(i){tb[n],tb[n]=t,eb[n]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(a,i):a(!!t._support):a(!0)}catch(t){i(t)}}));return Iw(n,e,i),n}driver(){return this._driver||null}getDriver(t,e,i){const n=tb[t]?Promise.resolve(tb[t]):Promise.reject(new Error("Driver not found."));return Iw(n,e,i),n}ready(t){const e=this,i=e._driverSet.then((()=>(null===e._ready&&(e._ready=e._initDriver()),e._ready)));return Iw(i,t,t),i}setDriver(t,e,i){const n=this;Qw(t)||(t=[t]);const s=this._getSupportedDrivers(t);function o(){n._config.driver=n.driver()}function r(t){return n._extend(t),o(),n._ready=n._initStorage(n._config),n._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>Promise.resolve())):Promise.resolve();return this._driverSet=a.then((()=>{const t=s[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then((t=>{n._driver=t._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){let e=0;return function i(){for(;e<t.length;){let s=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(s).then(r).catch(i)}o();const s=new Error("No available storage method found.");return n._driverSet=Promise.reject(s),n._driverSet}()}}(s)}))})).catch((()=>{o();const t=new Error("No available storage method found.");return n._driverSet=Promise.reject(t),n._driverSet})),Iw(this._driverSet,e,i),this._driverSet}supports(t){return!!eb[t]}_extend(t){lb(this,t)}_getSupportedDrivers(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];this.supports(n)&&e.push(n)}return e}_wrapLibraryMethodsWithReady(){for(let t=0,e=ob.length;t<e;t++)ab(this,ob[t])}createInstance(t){return new hb(t)}}var cb=new hb;Date.prototype.kUtilFormat=function(t){const e={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("000"+e[i]).substr(("000"+e[i]).length-RegExp.$1.length)));return t},String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0==this.indexOf(t)});var db;class ub{static init(){la(this,ub,mb,void 0),la(this,ub,vb,void 0),la(this,ub,yb,"init")}static reset(){la(this,ub,mb,void 0),la(this,ub,vb,void 0),la(this,ub,yb,"")}static setLicenseInfo(t){var e;la(this,ub,yb,"done"),la(this,ub,mb,[]),la(this,ub,mb,null!==(e=null==t?void 0:t.modules)&&void 0!==e?e:[])}static setLicenseErr(t){la(this,ub,vb,t),la(this,ub,yb,"done")}static makeSureLoadLicenseExist(){return ha(this,ub,gb).call(this,3101,5001)}static makeSureCoreLicenseExist(){return ha(this,ub,gb).call(this,3101)}static makeSureCameraLicenseExist(){return ha(this,ub,gb).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return ha(this,ub,gb).call(this,15)}static annotationLicenseModuleIsExist(){return ha(this,ub,fb).call(this,15)}static pdfRLicenseModuleIsExist(){return ha(this,ub,fb).call(this,5001)}}function pb(t){for(const e of aa(this,db,mb))if(e.module===t)return e;return{code:vw.LIC_MISS_MODULE.code,message:vw.LIC_MISS_MODULE.message,module:t}}function gb(t,e){""===aa(this,db,yb)&&vw.throw(vw.INIT_SHOULD_SET_CONFIG),"done"!==aa(this,db,yb)&&vw.throw(vw.INIT_CONFIG_NOT_DONE),aa(this,db,vb)&&vw.throw(aa(this,db,vb));const i=ha(this,db,pb).call(this,t);0!==i.code&&(!e||e&&0!==ha(this,db,pb).call(this,e).code)&&vw.throw({code:i.code,message:i.message})}function fb(t){return 0===ha(this,db,pb).call(this,t).code}db=ub;var mb={writable:!0,value:void 0},vb={writable:!0,value:void 0},yb={writable:!0,value:""};function xb(t){let e;if(t){let i;const n=t.message;i=t.ltsErrorCode,qd(i)?111===i?i=vw.LIC_EXPIRED.code:106===i||108===i?i=vw.LIC_INVALID.code:i>0&&(i=-(2e4+i)):i=vw.LIC_INVALID.code,e={code:i,message:n}}else e=vw.LIC_INVALID;return e}const wb="2.1.0";var bb;!function(t){t[t.publicTrial=0]="publicTrial",t[t.privateTrial=1]="privateTrial",t[t.normal=2]="normal"}(bb||(bb={}));var Cb,Sb=new WeakMap,_b=new WeakMap,Tb=new WeakMap,Eb=new WeakMap,Pb=new WeakMap,Ab=new WeakMap,Ib=new WeakMap,Db=new WeakMap,kb=new WeakSet,Rb=new WeakSet,Mb=new WeakSet,Lb=new WeakSet,Ob=new WeakSet,Bb=new WeakSet;class Fb{constructor(t){va(this,Bb),va(this,Ob),va(this,Lb),va(this,Mb),va(this,Rb),va(this,kb),ma(this,Sb,{writable:!0,value:void 0}),ma(this,_b,{writable:!0,value:void 0}),ma(this,Tb,{writable:!0,value:void 0}),ma(this,Eb,{writable:!0,value:void 0}),ma(this,Pb,{writable:!0,value:void 0}),ma(this,Ab,{writable:!0,value:void 0}),ma(this,Ib,{writable:!0,value:void 0}),ma(this,Db,{writable:!0,value:void 0}),oa(this,_b,void 0),oa(this,Sb,void 0),oa(this,Tb,""),oa(this,Eb,""),oa(this,Ab,bb.publicTrial),oa(this,Db,void 0),oa(this,Ib,"");const e=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t;if(i._pLoad.isEmpty){let n,s,o,r=i._license||"",a=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,h=0;if(r.startsWith("t")||r.startsWith("f"))h=0;else if(0===r.length||r.startsWith("P")||r.startsWith("L")||r.startsWith("Y")||r.startsWith("A"))h=1;else{h=2;const e=r.indexOf(":");-1!=e&&(r=r.substring(e+1));const i=r.indexOf("?");if(-1!=i&&(s=r.substring(i+1),r=r.substring(0,i)),r.startsWith("DLC2"))h=0;else{if(r.startsWith("DLS2")){let e;try{let t=r.substring(4);t=atob(t),e=JSON.parse(t)}catch(t){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(r=e.handshakeCode?e.handshakeCode:e.organizationID?e.organizationID:"","number"==typeof r&&(r=JSON.stringify(r)),0===a.length){let t=[];e.mainServerURL&&(t[0]=e.mainServerURL),e.standbyServerURL&&(t[1]=e.standbyServerURL),a=(t=>{if(null==t)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!ud){let i=document.createElement("a");i.href=t[e],t[e]=i.href}t[e].endsWith("/")||(t[e]+="/")}}return t})(t)}!l&&e.sessionPassword&&(l=e.sessionPassword),n=e.remark}r&&"200001"!==r&&!r.startsWith("200001-")||(h=1)}}if(h&&(e||(pd.crypto||(o="Please upgrade your browser to support online key."),pd.crypto.subtle||(o="Require https to use online key in this browser."))),o){if(1!==h)throw new Error(o);h=0,i._lastErrorCode=-1,i._lastErrorString=o}return 1===h&&(r=""),{lt:h,l:r,ls:a,sp:l,rmk:n,cv:s}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")}({_pLoad:{isEmpty:!0},_license:t,_licenseServer:[]},!0);let i;if(e&&Zd(e.l)?(i=e.l.trim(),1===e.lt?oa(this,Ab,bb.publicTrial):2===e.lt?oa(this,Ab,bb.privateTrial):oa(this,Ab,bb.normal)):(i="",oa(this,Ab,bb.publicTrial)),""===i?oa(this,Sb,i):i.includes("-")?oa(this,_b,i):oa(this,Sb,i),Ud(e.ls)){e.ls.length>0&&oa(this,Db,e.ls);const t=sa(this,Db);let n,s;if(t&&t.length>0){for(n=0;n<t.length;n++)s=t[n],s.endsWith("/")||(t[n]=`${s}/`);ga(this,kb,Nb).call(this,t,i)&&oa(this,Ab,bb.publicTrial)}}oa(this,Ib,e.sp)}async init(t,e,i){let n=t;n.endsWith("/")||(n=`${n}/`),sa(this,Pb)||await ga(this,Mb,Vb).call(this,i);try{await ga(this,Bb,jb).call(this,e)}catch(t){const e=xb(t);let i=!1;e.code===vw.LIC_EXPIRED.code?-1!==e.message.toLowerCase().indexOf("trial license")&&(i=!0):this.isPublicTrial()&&(i=!0),i&&Tw({_bNeverShowDialog:!1,engineResourcePath:n,_onLog:console.log},"error",e.message),vw.throw(e)}}getClientUUID(){return sa(this,Eb)}getAuthResult(){return sa(this,Tb)}isPublicTrial(){return sa(this,Ab)===bb.publicTrial}setClientUUID(t){oa(this,Eb,t)}setAuthResult(t){oa(this,Tb,t)}}function Nb(t,e){let i=!0;if(Ud(t)&&t.length>0){const e=t[0];Zd(e)&&""!==e&&"mlts.dynamsoft.com"!==new URL(e).hostname&&(i=!1)}return i&&(!e||"200001"===e||e.startsWith("200001-"))}function Ub(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function Vb(t){const e={dm:ga(this,Rb,Ub).call(this),fetch:window.fetch};t&&(e.bd=!0,e.log=console.log),oa(this,Pb,(t=>{let e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w,b,C,S=t.fetch||pd.fetch,_=t.btoa||pd.btoa,T=t.atob||pd.atob,E=t.bd,P=t.dm,A=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],I=!1,D=Promise.resolve(),k=t.lf,R=t.log&&function(){try{for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];t.log.apply(null,i)}catch(t){setTimeout((()=>{throw t}),0)}}||(()=>{}),M=E&&R||(()=>{}),L=t.fol,O=t.sutlcb,B=t.feab,F=t=>T(T(t.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),N=t=>_(String.fromCharCode(97+25*Math.random())+_(t)).replace(/\+/g,"\n").replace(/=/g," "),U=()=>{if(C)return C;if(pd.crypto){let t=new Uint8Array(36);pd.crypto.getRandomValues(t);let e="";for(let i=0;i<36;++i){let n=t[i]%36;e+=n<10?n:String.fromCharCode(n+87)}return e}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))};const V=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let W,H,j,z,G={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+V,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+V,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},Y=async()=>(W=W||(async()=>{await(async()=>{k||(k=cb)})();{let t=await k.createInstance({name:"dynamjssdkhello"});await t.setItem("dynamjssdkhello","available")}if(m=await k.createInstance({name:"dynamdlsinfo"}),v=C?null:_(_("v2")+String.fromCharCode(P.charCodeAt(P.length/2)+1)+_(P)),!C){try{let t=await m.getItem(v);if(!t){let e=await k.createInstance({name:"dynamltsinfo"});t=await e.getItem(v),t&&await m.setItem(v,t)}t&&([a,p]=JSON.parse(await F(t)))}catch(t){}try{null==a&&(a=U(),m.setItem(v,await N(JSON.stringify([a,null]))))}catch(t){}}})(),W),$=async t=>{j=Date.now(),H||(H=(async()=>{try{let g={pd:e,vm:n,v:i,dt:r||"browser",ed:"javascript",cu:a,ad:P,os:l,fn:h};u&&(g.rmk=u),s&&(-1!=s.indexOf("-")?g.hs=s:g.og=s);let f={};if(p&&!C){let t=await m.getItem(v);t&&([a,p]=JSON.parse(await F(t))),f["lts-time"]=p}d&&(g.sp=d);let x=await Promise.race([(async()=>{let e,i=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p&&!C&&(m.setItem(v,await N(JSON.stringify([a,i]))),p=i);let n,s="auth/?ext="+encodeURIComponent(_(JSON.stringify(g))),r=!1,l=!1,h=async t=>{if(t&&!t.ok)try{let e=await t.text();if(e){let t=JSON.parse(e);t.errorCode&&(n=t,t.errorCode>100&&t.errorCode<200&&(o=null,r=!0,l=!0))}}catch(t){}};try{e=await S(A[0]+s,{headers:f,cache:t?"reload":"default",mode:"cors",timeout:1e4}),await h(e)}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(A[1]+s,{headers:f,mode:"cors",timeout:3e4})}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(A[0]+s,{headers:f,mode:"cors",timeout:3e4}),await h(e)}catch(t){}n&&151==n.errorCode&&!C&&(m.removeItem(v),m.removeItem(y),a=U(),g.cu=a,p=void 0,s="auth/?ext="+encodeURIComponent(_(JSON.stringify(g))),e=await S(A[0]+s,{headers:f,mode:"cors",timeout:3e4}),await h(e)),(()=>{if(!e||!e.ok){let t;l&&m.setItem(y,""),n?111==n.errorCode?t=n.message:(t=n.message.trim(),t.endsWith(".")||(t+="."),t=c?`An error occurred during authorization: ${t} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${t} Contact the site administrator for more information.`):t=c?G.publicTrialFailConnect:G.failConnect;let e=Error(t);throw n&&n.errorCode&&(e.ltsErrorCode=n.errorCode),e}})();let d=await e.text();try{p||C||(m.setItem(v,await N(JSON.stringify([a,i]))),p=i),m.setItem(y,d)}catch(t){}return d})(),new Promise(((t,e)=>{let i;i=c?G.publicTrialNetworkTimeout:G.networkTimeout,setTimeout((()=>e(new Error(i))),o?3e3:15e3)}))]);o=x}catch(t){g=t}H=null})()),await H},X=async()=>{z||(z=(async()=>{if(M(a),!o){if(!I)throw R(g.message),g;return}let t={dm:P};E&&(t.bd=!0),t.brtk=!0,t.ls=A[0],s&&(-1!=s.indexOf("-")?t.hs=s:t.og=s),t.cu=a,h&&(t.fn=h),e&&(t.pd=e),i&&(t.v=i),r&&(t.dt=r),l&&(t.os=l),u&&(t.rmk=u),M(o);try{t.ar=o,t.bafc=!!g}catch(t){}M(t);try{await x(t)}catch(t){M("error updl")}await q(),I||(I=!0),z=null})()),await z},q=async()=>{let t=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),e=await b();if(M(e),e&&e<t)throw g?new Error(G.dlsErrorAndCacheExpire):new Error(G.checkLocalTime)},Z=null;const J=new Promise((t=>{Z=()=>{J.isPending=!1,J.isFulfilled=!0,t()}}));let K=null,Q=async(t,e)=>(D=D.then((async()=>{try{let i=await f.keys();if(e||(J.isFulfilled?t&&(i=i.filter((e=>e<t))):t&&i.includes(t)?i=[t]:(i=[],M("Unexpected null key"))),!i.length)return;for(let t=0;t<i.length/1e3;++t){let e=i.slice(1e3*t,1e3*(t+1)),n=[];for(let t=0;t<e.length;++t)n.push(await f.getItem(e[t]));if(p=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!C){let t=await m.getItem(v);t&&([a]=JSON.parse(await F(t))),m.setItem(v,await N(JSON.stringify([a,p])))}try{let t,i,s=A[0]+"verify/v2";p&&!C&&(s+="?ltstime="+encodeURIComponent(p));try{t=S(s,{method:"POST",body:n.join(";"),keepalive:!0})}finally{!J.isFulfilled&&xd&&Z()}try{i=await t}finally{J.isFulfilled||Z()}if(!i.ok)throw new Error("verify failed. Status Code: "+i.status);for(let t=0;t<e.length;++t)await f.removeItem(e[t])}catch(t){throw J.isFulfilled||Z(),L&&(L(t),L=null),t}}O&&O()}catch(t){}})),await D);return{i:async t=>(e=t.pd,i=t.v,n=i.split(".")[0],t.dt&&(r=t.dt),s=t.l||"",l="string"!=typeof t.os?JSON.stringify(t.os):t.os,h=t.fn,"string"==typeof h&&(h=h.substring(0,255)),t.ls&&t.ls.length&&(A=t.ls,1==A.length&&A.push(A[0])),c=!s||"200001"===s||s.startsWith("200001-"),d=t.sp,u=t.rmk,"string"==typeof u&&(u=u.substring(0,255)),t.lf&&(k=t.lf),t.lsu&&(a=C=t.lsu),t.feab&&(B=t.feab),x=t.updl,w=t.mnet,b=t.mxet,t.sutlcb&&(O=t.sutlcb),await Y(),await(async()=>{y=_(String.fromCharCode(s.charCodeAt(0)+10)+_(e)+_(s)+n+_(""+r)),f=await k.createInstance({name:"dynamdlsuns"+_(_("v2"))+_(String.fromCharCode(s.charCodeAt(0)+10)+_(e)+_(s)+n+_(""+r))});try{o=await m.getItem(y)}catch(t){}})(),await $(),await X(),(!g||g.ltsErrorCode>=102&&g.ltsErrorCode<=120)&&Q(null,!0),{ar:o,cu:a}),c:async()=>{let t=new Date;if(t.getTime()<j+36e4)return;let e=t.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),i=await w(),n=await b();if(n&&n<e)await $(!0),await X();else if(i&&i<e){let e=new Date(t.getTime());e.setMinutes(t.getMinutes()-6);let i=e.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p<i&&$().then((()=>X()))}},s:async(t,e,i,n)=>{if(e){try{let t;t=e.startsWith("{")&&e.endsWith("}")?await B(e):e,t?(M("bs "+i),await f.setItem(i,t),M("ss "+i)):M("ept ecpt")}catch(t){}n&&(M("bd "+i),await Q(i,2==n),M("sd "+i)),K&&clearTimeout(K),K=setTimeout((async()=>{await Q()}),36e4)}else await Q(i)},p:J,u:async()=>(await Y(),a),caret:q}})(e))}function Wb(){return this.isPublicTrial()?"":sa(this,_b)||sa(this,Sb)}function Hb(){const t=[];return t.push(yd.browser),t.push(yd.version.toString()),t.push(yd.OS),t.join(" ")}async function jb(t){if(this.getAuthResult()&&this.getClientUUID())return{ar:this.getAuthResult(),cu:this.getClientUUID()};const e={pd:"ddv",dt:"browser",v:wb,os:ga(this,Ob,Hb).call(this),l:ga(this,Lb,Wb).call(this),ls:sa(this,Db),sp:sa(this,Ib),fn:t||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(e.lsu=this.getClientUUID()),e.updateLicense=t=>{this.setAuthResult(t.ar),this.getClientUUID()||this.setClientUUID(t.cu)};const i=await sa(this,Pb).i(e);return this.getAuthResult()||this.setAuthResult(i.ar),this.getClientUUID()||this.setClientUUID(i.cu),i}const zb={scrollToLatest:!1};class Gb{constructor(t){na(this,"viewerUids",void 0),na(this,"groupUid",void 0),na(this,"config",void 0),na(this,"isSetScrollToLatest",!1),this.groupUid=t,this.viewerUids=new Set,this.config=Wd(zb)}getViewerUids(){return[...this.viewerUids.values()]}updateConfig(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.config,t)}}var Yb,$b;!function(t){t.LEFT="left",t.TOP="top",t.RIGHT="right",t.BOTTOM="bottom"}(Yb||(Yb={})),function(t){t.DEFAULT="default",t.CAPTURE="capture",t.PERSPECTIVE="perspective",t.THUMBNAIL="thumbnail"}($b||($b={}));class Xb{constructor(){na(this,"db",void 0),this.db=new Map}async set(t,e){return new Promise(((i,n)=>{this.db.has(t)?n(new Error(`The item ${t} already exists.`)):(this.db.set(t,e),i(`Save ${t} to database successful.`))}))}async get(t){return new Promise(((e,i)=>{this.db.has(t)?e(this.db.get(t)):i(new Error(`The item ${t} does not exist.`))}))}async remove(t){return new Promise(((e,i)=>{const n=this.db.get(t);this.db.delete(t),e(n)}))}async update(t,e){return new Promise(((i,n)=>{this.db.has(t)?(this.db.set(t,e),i(`Update ${t} successful.`)):n(new Error(`The item ${t} does not exist.`))}))}dispose(){this.db.clear()}reset(){this.db.clear()}}class qb extends Ju{constructor(){super(),na(this,"openDocument",void 0),na(this,"closeDocument",void 0),na(this,"syncDocument",void 0),na(this,"addPagesToDoc",void 0),na(this,"deletePages",void 0),na(this,"updatePage",void 0),na(this,"selectedPageChanged",void 0),na(this,"viewerModeChanged",void 0),na(this,"pageChanged",void 0),na(this,"currentPageChanged",void 0),na(this,"pageChangedAfterRender",void 0),na(this,"pageExistenceChanged",void 0),na(this,"tabChanged",void 0),na(this,"displayModeChanged",void 0),na(this,"fitModeChanged",void 0),na(this,"filterChanged",void 0),na(this,"toolModeChanged",void 0),na(this,"zoomChanged",void 0),na(this,"visibleChanged",void 0),na(this,"cropRectDrawn",void 0),na(this,"cropRectDeleted",void 0),na(this,"cropModeChanged",void 0),na(this,"quadModified",void 0),na(this,"autoCaptureChanged",void 0),na(this,"autoDetectChanged",void 0),na(this,"torchChanged",void 0),na(this,"cameraPlayed",void 0),na(this,"cameraClosed",void 0),na(this,"cameraInit",void 0),na(this,"beforeLayout",void 0),na(this,"afterLayout",void 0),na(this,"beforeRender",void 0),na(this,"afterRender",void 0),na(this,"destroy",void 0),na(this,"canvasCursorStyleChanged",void 0),na(this,"quadSelectionStyleChanged",void 0),na(this,"perspectiveQuadChanged",void 0),na(this,"beforeCropPages",void 0),na(this,"operationsChanged",void 0),na(this,"resize",void 0),na(this,"annotationsUpdated",void 0),na(this,"annotationModeChanged",void 0),na(this,"annotationDefaultStyleChanged",void 0),na(this,"selectedAnnotationsChanged",void 0),na(this,"annotationLayerStateChanged",void 0),na(this,"beforeAnnotationEdit",void 0),na(this,"afterAnnotationEdit",void 0),na(this,"beforeAnnotationDraw",void 0),na(this,"afterAnnotationDraw",void 0),na(this,"annotationTextCharsSelected",void 0),na(this,"annotationTextContentUpdated",void 0),na(this,"scroll",void 0),this.openDocument=tp(this),this.closeDocument=tp(this),this.syncDocument=tp(this),this.addPagesToDoc=tp(this),this.deletePages=tp(this),this.updatePage=tp(this),this.selectedPageChanged=tp(this),this.viewerModeChanged=tp(this),this.pageChanged=tp(this),this.currentPageChanged=tp(this),this.pageChangedAfterRender=tp(this),this.pageExistenceChanged=tp(this),this.tabChanged=tp(this),this.displayModeChanged=tp(this),this.fitModeChanged=tp(this),this.filterChanged=tp(this),this.toolModeChanged=tp(this),this.zoomChanged=tp(this),this.visibleChanged=tp(this),this.cropRectDrawn=tp(this),this.cropRectDeleted=tp(this),this.cropModeChanged=tp(this),this.quadModified=tp(this),this.autoCaptureChanged=tp(this),this.autoDetectChanged=tp(this),this.torchChanged=tp(this),this.cameraPlayed=tp(this),this.cameraClosed=tp(this),this.cameraInit=tp(this),this.beforeLayout=tp(this),this.afterLayout=tp(this),this.beforeRender=tp(this),this.afterRender=tp(this),this.destroy=tp(this),this.canvasCursorStyleChanged=tp(this),this.quadSelectionStyleChanged=tp(this),this.perspectiveQuadChanged=tp(this),this.beforeCropPages=tp(this),this.operationsChanged=tp(this),this.resize=tp(this),this.annotationModeChanged=tp(this),this.selectedAnnotationsChanged=tp(this),this.annotationLayerStateChanged=tp(this),this.annotationDefaultStyleChanged=tp(this),this.beforeAnnotationEdit=tp(this),this.afterAnnotationEdit=tp(this),this.beforeAnnotationDraw=tp(this),this.afterAnnotationDraw=tp(this),this.annotationsUpdated=tp(this),this.annotationTextCharsSelected=tp(this),this.annotationTextContentUpdated=tp(this),this.scroll=tp(this)}}class Zb{static numberArrayIsValid(t,e,i,n,s){return ha(this,Zb,Jb).call(this,t,1,e,i,s,n)}static stringArrayIsValid(t,e){return ha(this,Zb,Jb).call(this,t,2,void 0,void 0,0,e)}static blobArrayIsValid(t,e){return ha(this,Zb,Jb).call(this,t,4,void 0,void 0,void 0,e)}static quadIsValid(t,e){const i=[],n="Quad";ha(this,Zb,eC).call(this,i,t,6,ha(this,Zb,Qb).call(this,n,e,void 0),4);let s=0;for(const o of t){const t=`[${s}]`;i.push(...ha(this,Zb,Jb).call(this,o,1,void 0,void 0,2,ha(this,Zb,Qb).call(this,n,e,t,!0))),s+=1}return i}static docDetectConfigIsValid(t,e){const i=[],n="DocumentDetectConfig";return ha(this,Zb,eC).call(this,i,t,5,ha(this,Zb,Qb).call(this,n,e)),ha(this,Zb,eC).call(this,i,t.autoCaptureDelay,1,ha(this,Zb,Qb).call(this,n,e,"autoCaptureDelay")),Hd(t.acceptedPolygonConfidence)||ha(this,Zb,eC).call(this,i,t.acceptedPolygonConfidence,1,ha(this,Zb,Qb).call(this,n,e,"acceptedPolygonConfidence")),Hd(t.enableAutoCapture)||ha(this,Zb,eC).call(this,i,t.enableAutoCapture,3,ha(this,Zb,Qb).call(this,n,e,"enableAutoCapture")),i}static docDetectConfIsValid(t,e){const i=[],n="DocumentDetectConfidence";return ha(this,Zb,eC).call(this,i,t,5,ha(this,Zb,Qb).call(this,n,e)),ha(this,Zb,eC).call(this,i,t.angleConfidence,1,ha(this,Zb,Qb).call(this,n,e,"angleConfidence"),0,100),ha(this,Zb,eC).call(this,i,t.areaConfidence,1,ha(this,Zb,Qb).call(this,n,e,"areaConfidence"),0,100),ha(this,Zb,eC).call(this,i,t.centerConfidence,1,ha(this,Zb,Qb).call(this,n,e,"centerConfidence"),0,100),i}static imageDataIsValid(t,e){const i=[],n="VImageData";return ha(this,Zb,eC).call(this,i,t,5,ha(this,Zb,Qb).call(this,n,e)),ha(this,Zb,eC).call(this,i,t.data,8,ha(this,Zb,Qb).call(this,n,e,"data")),ha(this,Zb,eC).call(this,i,t.type,9,ha(this,Zb,Qb).call(this,n,e,"type")),Hd(t.height)||ha(this,Zb,eC).call(this,i,t.height,1,ha(this,Zb,Qb).call(this,n,e,"height")),Hd(t.width)||ha(this,Zb,eC).call(this,i,t.width,1,ha(this,Zb,Qb).call(this,n,e,"width")),i}static filterTypeIsValid(t,e){const i=[];return ha(this,Zb,eC).call(this,i,t,10,ha(this,Zb,Qb).call(this,"EnumImageFilterType",e)),i}static imageEncodeOptionIsValid(t,e){const i=[],n="ImageEncodeOption";return ha(this,Zb,eC).call(this,i,t,5,ha(this,Zb,Qb).call(this,n,e)),ha(this,Zb,eC).call(this,i,t.type,9,ha(this,Zb,Qb).call(this,n,e,"type")),Hd(t.params)||ha(this,Zb,eC).call(this,i,t.params,5,ha(this,Zb,Qb).call(this,n,e,"params")),i}static makeSureNumberValid(t,e,i,n,s,o){return ha(this,Zb,Kb).call(this,ha(this,Zb,dC).call(this,t,e,i),n,s,o)}static makeSureStringValid(t,e,i,n){return ha(this,Zb,Kb).call(this,{isValid:ha(this,Zb,uC).call(this,t)},e,i,n)}static makeSureDetectResultValid(t,e,i,n){const s=[],o="DetectResult";ha(this,Zb,eC).call(this,s,t,5,ha(this,Zb,Qb).call(this,o,n)),s.push(...Zb.quadIsValid(null==t?void 0:t.location,o)),ha(this,Zb,eC).call(this,s,null==t?void 0:t.width,1,ha(this,Zb,Qb).call(this,o,n,"width"),1,void 0),ha(this,Zb,eC).call(this,s,null==t?void 0:t.height,1,ha(this,Zb,Qb).call(this,o,n,"height"),1,void 0),s.push(...Zb.docDetectConfigIsValid(null==t?void 0:t.config,o)),null!=t&&t.confidence&&ha(this,Zb,eC).call(this,s,t.confidence,1,ha(this,Zb,Qb).call(this,o,n,"confidence")),this.makeSureValid(s,e,i)}static makeSureValid(t,e,i,n){0!==t.length&&ha(this,Zb,tC).call(this,t,e,i,n)}static makeSureMissing(t,e,i){Hd(t)&&ha(this,Zb,tC).call(this,void 0,e,i,vw.PARAM_MISS)}static makeSureCameraObject(t,e,i){const n=[],s=i;this.makeSureMissing(t,e,i),Zd(t)?this.makeSureStringValid(t,e,i):(ha(this,Zb,eC).call(this,n,t,5,ha(this,Zb,Qb).call(this,s)),ha(this,Zb,eC).call(this,n,t.deviceId,2,ha(this,Zb,Qb).call(this,s,void 0,"deviceId")),ha(this,Zb,eC).call(this,n,t.label,2,ha(this,Zb,Qb).call(this,s,void 0,"label")),this.makeSureValid(n,e,i))}static initTypeCheckMap(){aa(this,Zb,fC)[7]=zd,aa(this,Zb,fC)[15]=Zd,aa(this,Zb,fC)[3]=Yd,aa(this,Zb,fC)[5]=Vd,aa(this,Zb,fC)[4]=Gd,aa(this,Zb,fC)[2]=ha(this,Zb,uC),aa(this,Zb,fC)[8]=ha(this,Zb,nC),aa(this,Zb,fC)[11]=ha(this,Zb,aC),aa(this,Zb,fC)[12]=ha(this,Zb,lC),aa(this,Zb,fC)[13]=ha(this,Zb,hC),aa(this,Zb,fC)[14]=ha(this,Zb,cC),aa(this,Zb,fC)[1]=ha(this,Zb,dC),aa(this,Zb,fC)[6]=ha(this,Zb,sC),aa(this,Zb,fC)[9]=ha(this,Zb,oC),aa(this,Zb,fC)[10]=ha(this,Zb,rC),aa(this,Zb,fC)[16]=ha(this,Zb,pC)}}function Jb(t,e,i,n,s,o){const r=[],a="Array";if(ha(this,Cb,eC).call(this,r,t,6,ha(this,Cb,Qb).call(this,a,o),s),r.length>0)return r;let l=0;for(const s of t){const t=`[${l}]`;ha(this,Cb,eC).call(this,r,s,e,ha(this,Cb,Qb).call(this,a,o,t,!0),i,n),l+=1}return r}function Kb(t,e,i,n){const{isValid:s,isInRange:o,isSupported:r}=t,a=!!Hd(s)||s,l=!!Hd(o)||o,h=!!Hd(r)||r;a&&l&&h||(n||(n=a?l?vw.PARAM_NOT_SUPPORT:vw.PARAM_OUT_OF_RANGE:vw.PARAM_INVALID),ha(this,Cb,tC).call(this,void 0,e,i,n))}function Qb(t,e,i,n){return e?i?`${e}${n?"":"."}${i}`:`${e}`:i?`${t}${n?"":"."}${i}`:`${t}`}function tC(t,e,i,n){const s=Hd(n)?{...vw.PARAM_INVALID}:{...n};t&&(s.details=t),vw.throw(s,e,i)}function eC(t,e,i,n,s,o){const r=ha(this,Cb,iC).call(this,e,i,n,s,o);r&&t.push(r)}function iC(t,e,i,n,s){if(Hd(t))return`${i} is missing.`;const o=aa(this,Cb,fC)[e];if(o){const e=o.bind(this)(t,n,s);if(Yd(e)){if(!e)return`${i} is invalid.`}else if(Vd(e)){const{isValid:t,isInRange:n,isSupported:s}=e;if(!1===t)return`${i} is invalid.`;if(!1===n)return`${i} is out of range.`;if(!1===s)return`${i} is not supported.`}}}function nC(t){return zd(t)||Gd(t)}function sC(t,e){return Ud(t)?qd(e)&&0===t.length||!Hd(e)&&t.length<e?{isValid:!1}:{isValid:!0,isInRange:!!Hd(e)||t.length>=e}:{isValid:!1}}function oC(t){return qd(t)?{isValid:!0,isInRange:t>=cp.RGBA&&t<=cp.PNG}:{isValid:!1}}function rC(t){return Zd(t)?{isValid:!0,isInRange:(e=t,!!dw.get(e))}:{isValid:!1};var e}function aC(t){return void 0!==Np.get(t)}function lC(t){return void 0!==Up.get(t)}function hC(t){return void 0!==Fp.get(t)}function cC(t){if(Zd(t)){const e=t.trim();return-1!==aa(this,Cb,gC).indexOf(e)}return!1}function dC(t,e,i){let n=!0;return qd(t)?(Hd(e)||(n=t>=e),!Hd(i)&&n&&(n=t<=i),{isValid:!0,isInRange:n}):{isValid:!1}}function uC(t){return!!Zd(t)&&0!==t.trim().length}function pC(t){if(!ha(this,Cb,uC).call(this,t))return{isValid:!1};const e=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['](\d{2})[']|)$/);let i=!1;if(e){const[,t,n,s,o,r,a,l,h,c]=e,d=new Date(`${t}-${n}-${s}T${o}:${r}:${a}`);if(i=!0,d.getFullYear()===parseInt(t,10)&&d.getMonth()+1===parseInt(n,10)&&d.getDate()===parseInt(s,10)&&d.getHours()===parseInt(o,10)&&d.getMinutes()===parseInt(r,10)&&d.getSeconds()===parseInt(a,10)||(i=!1),i&&l){const t=parseInt(h,10),e=parseInt(c,10);("+"===l&&(t<0||t>12||e<0||e>59)||"-"===l&&(t<0||t>12||e<0||e>59))&&(i=!1)}}return{isSupported:i}}Cb=Zb;var gC={value:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},fC={value:Object.create(null)};Zb.initTypeCheckMap();class mC{constructor(t){na(this,"maxConcurrency",void 0),na(this,"currentConcurrency",void 0),na(this,"queue",void 0),this.maxConcurrency=t,this.currentConcurrency=0,this.queue=[]}async acquire(){return new Promise((t=>{this.currentConcurrency<this.maxConcurrency?(this.currentConcurrency+=1,t(!0)):this.queue.push(t)}))}release(){this.queue.length>0?this.queue.shift()():this.currentConcurrency-=1}}class vC{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;na(this,"tasks",void 0),na(this,"semaphore",void 0),this.tasks=[],this.semaphore=new mC(t)}async process(t){await this.semaphore.acquire();let e=null;try{t.cancelled||(e=await this.handler(t.taskUid))}catch(t){e=null}if(t.completed=!0,this.tasks.includes(t)){const e=this.tasks.indexOf(t);this.tasks.splice(e,1)}t.emitter.emit(t.taskUid,e),this.semaphore.release()}async executeTask(t){return new Promise(((e,i)=>{let n=this.tasks.find((e=>e.taskUid===t));n||(n={taskUid:t,emitter:new iu,completed:!1,cancelled:!1,running:!1},this.tasks.push(n)),n.cancelled=!1,n.emitter.on(t,(t=>{e(t)})),n.running||(n.running=!0,this.process(n))}))}cancel(t){const e=this.tasks.find((e=>e.taskUid===t));e&&(e.cancelled=!0)}destroy(){this.tasks=[]}async handler(t){return Promise.resolve(null)}}class yC extends vC{async handler(t){return new Promise(((e,i)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{n.onload=null,n.onerror=null,e(n)},n.onerror=t=>{n.onload=null,n.onerror=null,e(null)},n.src=t}))}}class xC extends yC{constructor(t,e){super(),na(this,"core",void 0),na(this,"imageLoader",void 0),this.core=t,this.imageLoader=e}async handler(t){let e=this.core.pageService.getPage(t);if(!e||e.isDestroyed)return null;let{img:i}=e.raw;if(!i){let{url:n}=e.raw;if(!n){let i=e.raw.data;if(!i){let n=await this.core.imageDataService.getRaw(t);const s=this.core.pageService.getPage(t);if(!s)return null;if(e.isDestroyed&&!s.isDestroyed&&(n=await this.core.imageDataService.getRaw(t,!0)),!n||s.isDestroyed)return null;i=n.data}n=URL.createObjectURL(i),e.raw.url=n}if(i=await this.imageLoader.executeTask(n),e=this.core.pageService.getPage(t),!e||e.isDestroyed)return null;e.raw.img=i}return i}}class wC extends yC{constructor(t,e){super(),na(this,"core",void 0),na(this,"imageLoader",void 0),this.core=t,this.imageLoader=e}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.original)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.original)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.original)||void 0===o?void 0:o.data;if(!n){let e=await this.core.imageDataService.getOriginal(t);const s=this.core.pageService.getPage(t);if(!s)return null;if(i.isDestroyed&&!s.isDestroyed&&(e=await this.core.imageDataService.getRaw(t,!0)),!e||s.isDestroyed)return null;n=e.data}e=URL.createObjectURL(n),i.original.url=e}if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;i.original.img=n}return n}}class bC extends yC{constructor(t,e){super(),na(this,"core",void 0),na(this,"imageLoader",void 0),this.core=t,this.imageLoader=e}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.display)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.display)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.display)||void 0===o?void 0:o.data;if(!n){let e=await this.core.imageDataService.getDisplay(t,!0);const s=this.core.pageService.getPage(t);if(!s)return null;if(i.isDestroyed&&!s.isDestroyed&&(e=await this.core.imageDataService.getDisplay(t,!0)),!e||s.isDestroyed)return null;n=e.data}e=URL.createObjectURL(n),i.display.url=e}const{filter:r}=i;if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;if(r!==i.filter)return this.handler(i.uid);i.display.img=n}return n}}class CC extends yC{constructor(t,e){super(),na(this,"core",void 0),na(this,"imageLoader",void 0),this.core=t,this.imageLoader=e}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=null===(e=i.thumbnail)||void 0===e?void 0:e.img;if(!n){var s;let e=null===(s=i.thumbnail)||void 0===s?void 0:s.url;if(!e){var o;let n=null===(o=i.thumbnail)||void 0===o?void 0:o.data;if(!n){const e=await this.core.imageDataService.getThumbnail(t);if(i=this.core.pageService.getPage(t),!e||i.isDestroyed)return null;n=e.data}e=URL.createObjectURL(n),i.thumbnail.url=e}if(n=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),i.isDestroyed)return null;i.thumbnail.img=n}return n}}class SC{constructor(t){na(this,"rawImageLoader",void 0),na(this,"originalImageLoader",void 0),na(this,"displayImageLoader",void 0),na(this,"thumbnailImageLoader",void 0);const e=new yC;this.rawImageLoader=new xC(t,e),this.originalImageLoader=new wC(t,e),this.displayImageLoader=new bC(t,e),this.thumbnailImageLoader=new CC(t,e)}async loadRawImage(t){return this.rawImageLoader.executeTask(t)}cancelLoadRawImage(t){this.rawImageLoader.cancel(t)}async loadOriginalImage(t){return this.originalImageLoader.executeTask(t)}cancelLoadOriginalImage(t){this.originalImageLoader.cancel(t)}async loadDisplayImage(t){return this.displayImageLoader.executeTask(t)}cancelLoadDisplayImage(t){this.displayImageLoader.cancel(t)}async loadThumbnailImage(t){return this.thumbnailImageLoader.executeTask(t)}cancelLoadThumbnailImage(t){this.thumbnailImageLoader.cancel(t)}}class _C{constructor(t,e,i){na(this,"worker",void 0),na(this,"id",void 0),na(this,"manager",void 0),na(this,"callbacks",{}),na(this,"busy",!1),na(this,"counter",0),na(this,"tasks",[]),this.worker=t,this.id=e,this.manager=i,this.worker.addEventListener("message",(t=>{this.onMessage(t)}),!1)}cancel(t){const e=this.tasks.findIndex((e=>{var i;return(null===(i=e.data)||void 0===i?void 0:i.taskUid)===t}));if(e>=0){const t=this.tasks.splice(e,1)[0];this.callbacks[t.callbackId]&&delete this.callbacks[t.callbackId],this.setBusy(!1)}}setBusy(t){if(this.busy=t,!t)if(this.tasks.length){const t=this.tasks.shift();this.send(t)}else this.worker.terminate(),this.manager.removeActor(this)}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(t){this.setBusy(!1);const{callbackId:e}=t.data,i=e?this.callbacks[e]:null;i&&i(t.data),delete this.callbacks[e]}send(t,e){if(this.busy)return void this.tasks.push({...t});this.setBusy(!0);const i=`${this.id}-${t.action}-cb-${this.counter}`;t.callback&&(this.callbacks[i]=t.callback,this.counter+=1),t.callbackId=i;const n={...t.data,callbackId:i};e?this.worker.postMessage(n,[e.data.buffer]):this.worker.postMessage(n)}}class TC{constructor(t,e){na(this,"concurrency",1),na(this,"actors",[]),na(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=e}send(t,e){this.getActor().send(t,e)}getActor(){const t=this.actors.filter((t=>!t.isBusy()))[0];if(t)return t;if(this.actors.length<this.concurrency){const t=new Worker(this.workerUrl),e=new _C(t,this.actors.length,this);return this.actors.push(e),e}const e=Math.floor(Math.random()*this.concurrency);return this.actors[e]}removeActor(t){const e=this.actors.indexOf(t);this.actors.splice(e,1)}cancel(t){for(const e of this.actors)e.cancel(t)}clear(){for(const t of this.actors)t.getWorker().terminate();this.actors=[]}}function EC(){onmessage=t=>{const{index:e}=t.data,i=t.data.sourceWidth,n=t.data.sourceHeight,s=t.data.width,o=t.data.height,r=t.data.source.data,a=s*o*4,l=new ArrayBuffer(a);let h=null;try{h=new Uint8ClampedArray(l,0,a)}catch(t){h=new Uint8Array(l,0,a)}for(let t=0;t<o;t++){const e=t*n/o,a=Math.floor(e),l=1-(e-a),c=a,d=(t+1)*n/o,u=Math.floor(d-1e-5),p=d-u,g=u;let f=t*s*4;for(let t=0;t<s;t++){const e=t*i/s,n=Math.floor(e),o=1-(e-n),a=n,d=(t+1)*i/s,u=Math.floor(d-1e-5),m=d-u,v=u;let y=0,x=0,w=0,b=0,C=0;const S=255;let _,T,E=(c+1)*i*4+4*a;for(_=c+1;_<g;++_){const t=S;y+=r[E+2]*o*t,x+=r[E+1]*o*t,w+=r[E]*o*t,b+=r[E+3]*o*t,C+=S*o,E+=4*i}let P=(c+1)*i*4+4*v;for(_=c+1;_<g;++_){const t=S;y+=r[P+2]*m*t,x+=r[P+1]*m*t,w+=r[P]*m*t,b+=r[P+3]*m*t,C+=S*m,P+=4*i}let A=c*i*4+4*(a+1);for(T=a+1;T<v;++T){const t=S;y+=r[A+2]*l*t,x+=r[A+1]*l*t,w+=r[A]*l*t,b+=r[A+3]*l*t,C+=S*l,A+=4}let I=g*i*4+4*(a+1);for(T=a+1;T<v;++T){const t=S;y+=r[I+2]*p*t,x+=r[I+1]*p*t,w+=r[I]*p*t,b+=r[I+3]*p*t,C+=S*p,I+=4}for(_=c+1;_<g;++_){let t=_*i*4+4*(a+1);for(T=a+1;T<v;++T){const e=S;y+=r[t+2]*e,x+=r[t+1]*e,w+=r[t]*e,b+=r[t+3]*e,C+=e,t+=4}}let D=c*i*4+4*a;const k=S;y+=r[D+2]*(l*o)*k,x+=r[D+1]*(l*o)*k,w+=r[D]*(l*o)*k,b+=r[D+3]*(l*o)*k,C+=S*(l*o),D=c*i*4+4*v;const R=S;y+=r[D+2]*(l*m)*R,x+=r[D+1]*(l*m)*R,w+=r[D]*(l*m)*R,b+=r[D+3]*(l*m)*R,C+=S*(l*m),D=g*i*4+4*a;const M=S;y+=r[D+2]*(p*o)*M,x+=r[D+1]*(p*o)*M,w+=r[D]*(p*o)*M,b+=r[D+3]*(p*o)*M,C+=S*(p*o),D=g*i*4+4*v;const L=S;y+=r[D+2]*(p*m)*L,x+=r[D+1]*(p*m)*L,w+=r[D]*(p*m)*L,b+=r[D+3]*(p*m)*L,C+=S*(p*m);let O=b/C,B=0,F=0,N=0;0!==O&&(B=y/C,F=x/C,N=w/C),B+=.5,F+=.5,N+=.5,O+=.5,h[f]=Math.floor(N),f+=1,h[f]=Math.floor(F),f+=1,h[f]=Math.floor(B),f+=1,h[f]=Math.floor(O),f+=1}}const c={index:e,target:h,taskUid:t.data.taskUid,callbackId:t.data.callbackId};try{postMessage(c,[h.buffer])}catch(t){postMessage(c,null)}h=null}}let PC=class{constructor(){na(this,"actorSystem",void 0),na(this,"concurrency",3);const t=window.URL.createObjectURL(new Blob(["(",EC.toString(),")()"],{type:"text/plain"}));this.actorSystem=new TC(t,this.concurrency)}cancel(t){this.actorSystem.cancel(t)}optimize(t,e,i,n,s,o){return new Promise(((r,a)=>{const l=t.getContext("2d"),h=Math.floor(e)||1,c=Math.floor(i)||1,d=l.getImageData(0,0,h,c),u={action:"optimize",data:{taskUid:o,sourceWidth:h,sourceHeight:c,width:Math.ceil(n)||1,height:Math.ceil(s)||1,source:d},callback(t){r(t)}};this.actorSystem.send(u,u.data.source)}))}};class AC{constructor(){}reset(){}async perspectivePreview(t,e,i,n){var s,o,r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l=new yp,h=await l.initImage({source:t,isRGBA:e===cp.RGBA,width:n.width,height:n.height,isBGRA:e===cp.BGRA});h.srcBuffer&&(t=h.srcBuffer);let c=n.width,d=n.height;const u=null!==(s=n.angle)&&void 0!==s?s:0;90!==u&&270!==u||(c=n.height,d=n.width);const p=Math.min((null!==(o=a.width)&&void 0!==o?o:c)/c,(null!==(r=a.height)&&void 0!==r?r:d)/d),g=Math.floor(c*p+.5),f=Math.floor(d*p+.5);await l.resize(g,f,a.mode),null!=n&&n.angle&&await l.rotate({angle:n.angle});const m=[[Math.floor(i[0][0]*p+.5),Math.floor(i[0][1]*p+.5)],[Math.floor(i[1][0]*p+.5),Math.floor(i[1][1]*p+.5)],[Math.floor(i[2][0]*p+.5),Math.floor(i[2][1]*p+.5)],[Math.floor(i[3][0]*p+.5),Math.floor(i[3][1]*p+.5)]];await l.drawQuadrangle({location:m,strokeColor:a.strokeColor,lineWidth:a.lineWidth});const v=await l.getImage({ifDeleteObject:!0,isRGBA:e===cp.RGBA,returnBlob:!1});await l.freeReservedData();const y={data:new Blob([v.imageData],{type:v.blobType}),width:v.imageWidth,height:v.imageHeight,resolutionX:v.imageXResolution,resolutionY:v.imageYResolution};return l.terminate(),y}async resize(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const r=new yp,a=await r.initImage({source:t,isRGBA:e===cp.RGBA,width:i,height:n,isBGRA:e===cp.BGRA});if(a.srcBuffer&&(t=a.srcBuffer),s>0){let t=1;t=i>n?i/s:n/s;const e=Math.floor(i/t+.5),a=Math.floor(n/t+.5);await r.resize(e,a,o.mode)}const l=await r.getImage({ifDeleteObject:!0,isRGBA:e===cp.RGBA,returnBlob:!1});await r.freeReservedData();const h={data:new Blob([l.imageData],{type:l.blobType}),width:l.imageWidth,height:l.imageHeight,resolutionX:l.imageXResolution,resolutionY:l.imageYResolution};return r.terminate(),h}}class IC{constructor(t){}}class DC extends IC{static create(t,e){return new DC(t,e)}constructor(t,e){super("cameraChanged"),na(this,"oldDeviceId",void 0),na(this,"newDeviceId",void 0),this.oldDeviceId=t,this.newDeviceId=e}}class kC extends IC{static create(t){return new kC(t)}constructor(t){super("captured"),na(this,"pageUid",void 0),this.pageUid=t}}class RC extends IC{static create(t){return new RC(t)}constructor(t){super("cropRectDeleted"),na(this,"rect",void 0),this.rect=t}}class MC extends IC{static create(t){return new MC(t)}constructor(t){super("cropRectDrawn"),na(this,"rect",void 0),this.rect=t}}class LC extends IC{static create(t,e){return new LC(t,e)}constructor(t,e){super("cropRectModified"),na(this,"oldRect",void 0),na(this,"newRect",void 0),this.oldRect=t,this.newRect=e}}class OC extends IC{static create(t,e){return new OC(t,e)}constructor(t,e){super("currentIndexChanged"),na(this,"oldIndex",void 0),na(this,"newIndex",void 0),this.oldIndex=t,this.newIndex=e}}class BC extends IC{static create(t,e){return new BC(t,e)}constructor(t,e){super("displayModeChanged"),na(this,"oldDisplayMode",void 0),na(this,"newDisplayMode",void 0),this.oldDisplayMode=t,this.newDisplayMode=e}}class FC extends IC{static create(t,e){return new FC(t,e)}constructor(t,e){super("document"),na(this,"docUid",void 0),na(this,"docName",void 0),this.docUid=t,this.docName=e}}class NC extends IC{static create(t,e){return new NC(t,e)}constructor(t,e){super("fitModeChanged"),na(this,"oldFitMode",void 0),na(this,"newFitMode",void 0),this.oldFitMode=t,this.newFitMode=e}}class UC extends IC{static create(t,e){return new UC(t,e)}constructor(t,e){super("pagesDragged"),na(this,"indices",void 0),na(this,"pageUids",void 0),this.indices=t,this.pageUids=e}}class VC extends IC{static create(t,e,i){return new VC(t,e,i)}constructor(t,e,i){super("pagesDropped"),na(this,"indicesBefore",void 0),na(this,"indicesAfter",void 0),na(this,"pageUids",void 0),this.indicesBefore=t,this.indicesAfter=e,this.pageUids=i}}class WC extends IC{static create(t,e){return new WC(t,e)}constructor(t,e){super("pageRendered"),na(this,"index",void 0),na(this,"pageUid",void 0),this.index=t,this.pageUid=e}}class HC extends IC{static create(t,e,i){return new HC(t,e,i)}constructor(t,e,i){super("pagesAdded"),na(this,"docUid",void 0),na(this,"indices",void 0),na(this,"pageUids",void 0),this.docUid=t,this.indices=e,this.pageUids=i}}class jC extends IC{static create(t,e,i){return new jC(t,e,i)}constructor(t,e,i){super("pagesDeleted"),na(this,"docUid",void 0),na(this,"pageUids",void 0),na(this,"indices",void 0),this.docUid=t,this.pageUids=e,this.indices=i}}class zC extends IC{static create(t,e){return new zC(t,e)}constructor(t,e){super("played"),na(this,"deviceId",void 0),na(this,"resolution",void 0),this.deviceId=t,this.resolution=e}}class GC extends IC{static create(t,e){return new GC(t,e)}constructor(t,e){super("quadModified"),na(this,"oldQuad",void 0),na(this,"newQuad",void 0),this.oldQuad=t,this.newQuad=e}}class YC extends IC{static create(t,e,i,n){return new YC(t,e,i,n)}constructor(t,e,i,n){super("resized"),na(this,"oldWidth",void 0),na(this,"oldHeight",void 0),na(this,"newWidth",void 0),na(this,"newHeight",void 0),this.oldWidth=t,this.oldHeight=e,this.newWidth=i,this.newHeight=n}}class $C extends IC{static create(t,e,i,n){return new $C(t,e,i,n)}constructor(t,e,i,n){super("selectedPagesChanged"),na(this,"oldIndices",void 0),na(this,"newIndices",void 0),na(this,"oldPageUids",void 0),na(this,"newPageUids",void 0),this.oldIndices=t,this.newIndices=e,this.oldPageUids=i,this.newPageUids=n}}class XC extends IC{static create(t){return new XC(t)}constructor(t){super("stopped"),na(this,"deviceId",void 0),this.deviceId=t}}class qC extends IC{static create(t,e){return new qC(t,e)}constructor(t,e){super("toolModeChanged"),na(this,"oldToolMode",void 0),na(this,"newToolMode",void 0),this.oldToolMode=t,this.newToolMode=e}}class ZC extends IC{static create(t,e,i,n,s,o,r){return new ZC(t,e,i,n,s,o,r)}constructor(t,e,i,n,s,o,r){super("vPointer"),na(this,"index",void 0),na(this,"pageUid",void 0),na(this,"imageX",void 0),na(this,"imageY",void 0),na(this,"canvasX",void 0),na(this,"canvasY",void 0),na(this,"nativeEvent",void 0),this.index=t,this.pageUid=e,this.imageX=i,this.imageY=n,this.canvasX=s,this.canvasY=o,this.nativeEvent=r}}class JC extends IC{static create(t,e){return new JC(t,e)}constructor(t,e){super("zoomChanged"),na(this,"oldZoomRatio",void 0),na(this,"newZoomRatio",void 0),this.oldZoomRatio=t,this.newZoomRatio=e}}class KC extends IC{static create(t,e){return new KC(t,e)}constructor(t,e){super("currentPageChanged"),na(this,"oldPageUid",void 0),na(this,"newPageUid",void 0),this.oldPageUid=t,this.newPageUid=e}}class QC extends IC{static create(t,e){return new QC(t,e)}constructor(t,e){super("selectedAnnotationsChanged"),na(this,"oldAnnotationUids",void 0),na(this,"newAnnotationUids",void 0),this.oldAnnotationUids=t,this.newAnnotationUids=e}}class tS extends IC{static create(t,e){return new tS(t,e)}constructor(t,e){super("annotationModeChanged"),na(this,"oldAnnotationMode",void 0),na(this,"newAnnotationMode",void 0),this.oldAnnotationMode=t,this.newAnnotationMode=e}}class eS extends IC{static create(t){return new eS(t)}constructor(t){super("annotationLayerStateChanged"),na(this,"state",void 0),this.state=t}}class iS extends IC{static create(t,e,i,n){return new iS(t,e,i,n)}constructor(t,e,i,n){super("addPagesToDoc"),na(this,"docUid",void 0),na(this,"pageUids",void 0),na(this,"indices",void 0),na(this,"index",void 0),this.docUid=t,this.pageUids=e,this.indices=i,this.index=n}}class nS extends IC{static create(t,e,i){return new nS(t,e,i)}constructor(t,e,i){super("createPage"),na(this,"pageUid",void 0),na(this,"fileUid",void 0),na(this,"fileIndex",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=i}}class sS extends IC{static create(t,e,i){return new sS(t,e,i)}constructor(t,e,i){super("movePages"),na(this,"docUid",void 0),na(this,"indices",void 0),na(this,"insertBeforeIndex",void 0),this.docUid=t,this.indices=e,this.insertBeforeIndex=i}}class oS extends IC{static create(t,e,i){return new oS(t,e,i)}constructor(t,e,i){super("renameDocument"),na(this,"docUid",void 0),na(this,"oldName",void 0),na(this,"newName",void 0),this.docUid=t,this.oldName=e,this.newName=i}}class rS extends IC{static create(t,e){return new rS(t,e)}constructor(t,e){super("reorderPages"),na(this,"docUid",void 0),na(this,"indices",void 0),this.docUid=t,this.indices=e}}class aS extends IC{static create(t,e,i){return new aS(t,e,i)}constructor(t,e,i){super("switchPage"),na(this,"docUid",void 0),na(this,"one",void 0),na(this,"another",void 0),this.docUid=t,this.one=e,this.another=i}}class lS extends IC{static create(t,e,i){return new lS(t,e,i)}constructor(t,e,i){super("updatePage"),na(this,"docUid",void 0),na(this,"pageUid",void 0),na(this,"data",void 0),this.docUid=t,this.pageUid=e,this.data=i}}class hS extends IC{static create(t){return new hS(t)}constructor(t){super("autoCaptureChanged"),na(this,"enableAutoCapture",void 0),this.enableAutoCapture=t}}class cS extends IC{static create(t){return new cS(t)}constructor(t){super("autoDetectChanged"),na(this,"enableAutoDetect",void 0),this.enableAutoDetect=t}}class dS extends IC{static create(t){return new dS(t)}constructor(t){super("torchChanged"),na(this,"torchState",void 0),this.torchState=t}}class uS extends IC{static create(t){return new uS(t)}constructor(t){super("cameraPlayed"),na(this,"resolution",void 0),this.resolution=t}}class pS extends IC{static create(t,e){return new pS(t,e)}constructor(t,e){super("paginationChanged"),na(this,"current",void 0),na(this,"total",void 0),this.current=t,this.total=e}}class gS extends IC{static create(t,e){return new gS(t,e)}constructor(t,e){super("visibleChanged"),na(this,"newVisibility",void 0),na(this,"oldVisibility",void 0),this.newVisibility=t,this.oldVisibility=e}}class fS extends IC{static create(t,e,i){return new fS(t,e,i)}constructor(t,e,i){super("openDocument"),na(this,"doc",void 0),na(this,"viewerUid",void 0),na(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=i}}class mS extends IC{static create(t,e,i){return new mS(t,e,i)}constructor(t,e,i){super("closeDocument"),na(this,"doc",void 0),na(this,"viewerUid",void 0),na(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=i}}class vS extends IC{static create(t,e,i,n){return new vS(t,e,i,n)}constructor(t,e,i,n){super("gotoPage"),na(this,"docUid",void 0),na(this,"groupUid",void 0),na(this,"viewerUid",void 0),na(this,"index",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.index=n}}class yS extends IC{static create(t){return new yS(t)}constructor(t){super("cameraInit"),na(this,"enableConvert",void 0),this.enableConvert=t}}class xS extends IC{static create(t,e,i,n){return new xS(t,e,i,n)}constructor(t,e,i,n){super("selectPages"),na(this,"docUid",void 0),na(this,"groupUid",void 0),na(this,"viewerUid",void 0),na(this,"indices",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.indices=n}}class wS extends IC{static create(t,e,i){return new wS(t,e,i)}constructor(t,e,i){super("filterChanged"),na(this,"docUid",void 0),na(this,"pageUids",void 0),na(this,"filterType",void 0),this.docUid=t,this.pageUids=e,this.filterType=i}}class bS extends IC{static create(t,e,i,n){return new bS(t,e,i,n)}constructor(t,e,i,n){super("currentChangedByScroll"),na(this,"docUid",void 0),na(this,"groupUid",void 0),na(this,"viewerUid",void 0),na(this,"current",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.current=n}}class CS extends IC{static create(t,e,i){return new CS(t,e,i)}constructor(t,e,i){super("rotatePages"),na(this,"docUid",void 0),na(this,"angle",void 0),na(this,"pageUids",void 0),this.docUid=t,this.angle=e,this.pageUids=i}}class SS extends IC{static create(t,e,i){return new SS(t,e,i)}constructor(t,e,i){super("cropPages"),na(this,"docUid",void 0),na(this,"rect",void 0),na(this,"pageUids",void 0),this.docUid=t,this.rect=e,this.pageUids=i}}class _S extends IC{static create(t,e){return new _S(t,e)}constructor(t,e){super("perspectiveQuadChanged"),na(this,"quad",void 0),na(this,"isFull",void 0),this.quad=t,this.isFull=e}}class TS extends IC{static create(t){return new TS(t)}constructor(t){super("deletePages"),na(this,"pageUids",void 0),this.pageUids=t}}class ES extends IC{static create(t,e,i){return new ES(t,e,i)}constructor(t,e,i){super("operationsChanged"),na(this,"docUid",void 0),na(this,"undo",void 0),na(this,"redo",void 0),this.docUid=t,this.undo=e,this.redo=i}}class PS extends IC{static create(t,e,i,n,s){return new PS(t,e,i,n,s)}constructor(t,e,i,n,s){super("perspective"),na(this,"docUid",void 0),na(this,"pageUid",void 0),na(this,"quad",void 0),na(this,"width",void 0),na(this,"height",void 0),this.docUid=t,this.pageUid=e,this.quad=i,this.width=n,this.height=s}}class AS extends IC{static create(t){return new AS(t)}constructor(t){super("pageExistenceChanged"),na(this,"pageCount",void 0),this.pageCount=t}}class IS extends IC{static create(t){return new IS(t)}constructor(t){super("deleteDocs"),na(this,"docUids",void 0),this.docUids=t}}class DS extends IC{static create(t,e,i,n){return new DS(t,e,i,n)}constructor(t,e,i,n){super("pagePreloadChanged"),na(this,"docUid",void 0),na(this,"viewerUid",void 0),na(this,"viewerMode",void 0),na(this,"changes",void 0),this.docUid=t,this.viewerUid=e,this.viewerMode=i,this.changes=n}}class kS extends IC{static create(t){return new kS(t)}constructor(t){super("viewerCreated"),na(this,"viewer",void 0),this.viewer=t}}class RS extends IC{static create(t,e){return new RS(t,e)}constructor(t,e){super("annotationsUpdated"),na(this,"uids",void 0),na(this,"actions",void 0),this.uids=t,this.actions=e}}class MS extends IC{static create(t,e,i,n){return new MS(t,e,i,n)}constructor(t,e,i,n){super("copyPage"),na(this,"pageUid",void 0),na(this,"fileUid",void 0),na(this,"fileIndex",void 0),na(this,"annotations",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=i,this.annotations=n}}let LS=0;const OS=()=>{const t=`doc-${Date.now().toString()}-${LS.toString()}`;return LS+=1,t};function BS(t){if(t||(t=`D:${jd("yyyyMMddhhmmss")}`),/[+-]\d{2}'\d{2}'$/.test(t))return t;const e=-(new Date).getTimezoneOffset();return`${t}${e>=0?"+":"-"}${String(Math.floor(Math.abs(e)/60)).padStart(2,"0")}'${String(Math.abs(e)%60).padStart(2,"0")}'`}class FS{constructor(){var t,e;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};na(this,"type",void 0),na(this,"uid",void 0),na(this,"name",void 0),na(this,"pages",void 0),na(this,"tags",void 0),na(this,"creationDate",void 0),na(this,"author",void 0),na(this,"isDestroyed",void 0),na(this,"pageSize",void 0),this.uid=Qd(),this.name=null!==(t=i.name)&&void 0!==t?t:OS(),this.type=i.type||"document",this.pages=[],this.tags=i.tags||[],this.creationDate=BS(i.creationDate),this.author=null!==(e=i.author)&&void 0!==e?e:"",this.pageSize="none"}dispose(){this.isDestroyed=!0}}class NS{constructor(){na(this,"users",void 0),this.users=[]}addUser(t){this.users.push(t)}deleteUser(t){const e=this.users.indexOf(t);e>-1&&this.users.splice(e,1)}}var US;!function(t){t.IMAGE_PNG="image/png",t.IMAGE_JPEG="image/jpeg",t.IMAGE_BMP="image/bmp",t.IMAGE_TIFF="image/tiff",t.IMAGE_JP2="image/jp2",t.APPLICATION_PDF="application/pdf"}(US||(US={}));class VS{constructor(t){let{uid:e,mime:i,pageCount:n}=t;na(this,"uid",void 0),na(this,"mime",void 0),na(this,"pageCount",void 0),na(this,"name",void 0),na(this,"count",void 0),na(this,"pages",void 0),this.uid=e,this.mime=i,this.count=0,this.pages=[],this.pageCount=n;for(let t=0;t<n;t++){const t=new NS;this.pages.push(t)}}getPageByIndex(t){return this.pages[t]}addUser(t,e){const i=this.pages[t];return!!i&&(i.addUser(e),this.count+=1,!0)}deleteUser(t,e){const i=this.pages[t];return!!i&&(i.deleteUser(e),this.count-=1,!0)}}function WS(t,e,i,n){if(0==(e=(e%360+360)%360))return t;const s=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===s?(t[2*e]=r,t[2*e+1]=n-o):2===s?(t[2*e]=i-o,t[2*e+1]=n-r):3===s&&(t[2*e]=i-r,t[2*e+1]=o)}return zS(t,8-2*s),t}function HS(t,e,i,n){if(0==(e=(e%360+360)%360))return t;const s=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===s?(t[2*e]=n-r,t[2*e+1]=o):2===s?(t[2*e]=i-o,t[2*e+1]=n-r):3===s&&(t[2*e]=r,t[2*e+1]=i-o)}return zS(t,2*s),t}function jS(t,e,i){for(;e<i;){const n=t[e];t[e]=t[i],t[i]=n,e+=1,i-=1}}function zS(t,e){const i=e%t.length;0!==i&&(jS(t,0,t.length-1),jS(t,0,i-1),jS(t,i,t.length-1))}const GS=t=>Array(4).fill(0).map(((e,i)=>[t[2*i],t[2*i+1]])),YS=(t,e,i)=>0===t[0][0]&&0===t[0][1]&&t[1][0]===e&&0===t[1][1]&&t[2][0]===e&&t[2][1]===i&&0===t[3][0]&&t[3][1]===i;class $S{constructor(t){na(this,"data",void 0),na(this,"width",void 0),na(this,"height",void 0),na(this,"url",void 0),na(this,"img",void 0),na(this,"users",void 0),na(this,"isDestroyed",void 0),na(this,"isAvailable",void 0),na(this,"pageWidth",void 0),na(this,"pageHeight",void 0),na(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=t}getImageDetail(){const{docPage:t}=this;return{data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:t.resolutionX,resolutionY:t.resolutionY,url:this.url,img:this.img}}getPageSize(){return{width:this.pageWidth,height:this.pageHeight}}updateImageDetail(t){if(!t)return;t.data&&(this.isAvailable=!0,this.data=t.data);const{docPage:e}=this;this.width=t.width,this.height=t.height,this.pageWidth=t.width/e.resolutionX*Ep.displayResolution,this.pageHeight=t.height/e.resolutionY*Ep.displayResolution}addUser(t){this.getUserIndex(t)<0&&this.users.push(t)}deleteUser(t){const e=this.getUserIndex(t);e>-1&&this.users.splice(e,1)}hasUser(){return!!this.users.length}reset(){this.resetBlob(),this.resetImg()}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null}getUserIndex(t){return this.users.findIndex((e=>{let{viewerUid:i,docUid:n,pageUid:s}=e;return i===t.viewerUid&&n===t.docUid&&s===t.pageUid}))}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset()}}function XS(t){const e=function(t){[...t].sort(((t,e)=>e[1]-t[1]));let e=Number.MAX_SAFE_INTEGER,i=0;t.forEach(((t,n)=>{t[1]<e&&([,e]=t,i=n)}));const n=(i+3)%4,s=(i+1)%4,o=qS(t[n],t[i]);return qS(t[s],t[i])>o?n:i}(t),i=t.map(((e,i)=>{let n=t[i+1];return 3===i&&([n]=t),ZS(n,e)}));let n=Math.max(i[e],i[(e+2)%4]),s=Math.max(i[(e+1)%4],i[(e+3)%4]);return n=Math.round(n),s=Math.round(s),{width:n,height:s}}function qS(t,e){const i=Math.abs(t[0]-e[0]),n=ZS(t,e);return Math.acos(i/n)}function ZS(t,e){return((t[0]-e[0])**2+(t[1]-e[1])**2)**.5}const JS=t=>{t&&t.forEach((t=>{const e=Math.ceil(t[0]);e-t[0]<=1e-7?t[0]=e:t[0]=Math.floor(t[0]);const i=Math.ceil(t[1]);i-t[1]<=1e-7?t[1]=i:t[1]=Math.floor(t[1])}))};function KS(t,e,i,n){e=(e%360+360)%360;const s={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(s.left=n-r-l,s.top=o):2===h?(s.left=i-o-a,s.top=n-r-l):3===h&&(s.left=r,s.top=i-o-a),h%2>0&&(s.width=l,s.height=a),s}class QS{constructor(t,e){let{fileIndex:i,pageUid:n,fileUid:s,rotation:o,filter:r,perspectiveQuad:a,annotations:l,pdfOptions:h,resource:c,cropBox:d,mediaBox:u,pageSize:p}=t;na(this,"uid",void 0),na(this,"doc",void 0),na(this,"metadata",void 0),na(this,"customData",void 0),na(this,"fileUid",void 0),na(this,"fileIndex",void 0),na(this,"resolutionX",void 0),na(this,"resolutionY",void 0),na(this,"filter",void 0),na(this,"rotation",void 0),na(this,"quad",void 0),na(this,"activeQuad",void 0),na(this,"isFull",void 0),na(this,"raw",void 0),na(this,"original",void 0),na(this,"display",void 0),na(this,"thumbnail",void 0),na(this,"editedDisplay",void 0),na(this,"initRotation",void 0),na(this,"editRotation",void 0),na(this,"actionRotation",void 0),na(this,"actions",void 0),na(this,"pActions",void 0),na(this,"actionResult",void 0),na(this,"pActionResult",void 0),na(this,"isDestroyed",void 0),na(this,"annotations",void 0),na(this,"pageSize",void 0),na(this,"cropBox",void 0),na(this,"mediaBox",void 0),na(this,"resource",void 0),na(this,"editCaches",void 0),na(this,"pdfOptions",void 0),na(this,"initState",void 0),this.uid=n,this.doc=e,this.annotations=l||[],this.resolutionX=c.resolutionX,this.resolutionY=c.resolutionY,this.fileIndex=i,this.fileUid=s,this.pageSize=null!=p?p:"none",this.resource=c,"none"===this.pageSize?(this.mediaBox={...u},this.cropBox={...d}):this.pageSize,this.filter=r,this.rotation=o||0,this.initRotation=o||0,this.editRotation=o||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=h,this.raw=new $S(this),this.original=new $S(this),this.display=new $S(this),this.thumbnail=new $S(this),this.editedDisplay=new $S(this);let g={width:c.width,height:c.height};if(this.raw.updateImageDetail(g),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:o},a){g=XS(a),this.mediaBox={left:0,top:0,width:$u(g.width,c.resolutionX,Ep.displayResolution),height:$u(g.height,c.resolutionY,Ep.displayResolution)},this.cropBox={...this.mediaBox};const t=this.quadToDisplayPPI(a);this.setQuad(t)}this.original.updateImageDetail(g),this.display.updateImageDetail(g),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map}isMediaBoxEqualCropBox(){const{mediaBox:t,cropBox:e}=this;return t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height}getPageSize(){return"inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(t,e){const i=new QS({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:t,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&Wd(this.pdfOptions),mediaBox:Wd(this.mediaBox),cropBox:Wd(this.cropBox),resource:Wd(this.resource),annotations:[]},e),n=Wd(this.actions);n.forEach((t=>{t.docUid=e.uid}));const s=Wd(this.pActions);s.forEach((t=>{t.docUid=e.uid})),i.actions=n,i.pActions=s,i.initRotation=this.initRotation,i.actionRotation=this.actionRotation,i.editRotation=this.editRotation,i.quad=Wd(this.quad),i.activeQuad=Wd(this.activeQuad),i.isFull=this.isFull,i.actionResult=new Map(this.actionResult),i.pActionResult=new Map(this.pActionResult);const o={width:this.mediaBox.width||this.display.width||i.raw.width,height:this.mediaBox.height||this.display.height||i.raw.height};return i.original.updateImageDetail(o),i.display.updateImageDetail(o),i}setQuad(t){const e=this.isQuadFull(t);let i=!1;if(this.isFull=e,e)this.quad&&(i=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else{const{width:e,height:n}=this.raw.getPageSize(),s=WS(t.flat(),this.rotation,e,n),o=GS(s);let r,a;this.quad&&(a=this.quadToPixelPPI(o),r=this.quadToPixelPPI(this.quad),JS(r),JS(a)),this.quad&&Xu(r,a)||(this.quad=o,this.activeQuad=o,i=!0),this.editRotation=this.actionRotation}return i&&this.clearActions(),i}isQuadChanged(t){let e=!1;if(this.isQuadFull(t))this.quad&&(e=!0);else{const{width:i,height:n}=this.raw.getPageSize(),s=WS(t.flat(),this.rotation,i,n),o=GS(s);let r,a;this.quad&&(a=this.quadToPixelPPI(o),r=this.quadToPixelPPI(this.quad),JS(r),JS(a)),this.quad&&Xu(r,a)||(e=!0)}return e}setActiveQuad(t){const{width:e,height:i}=this.raw.getPageSize();if(!this.isFull){const n=WS(t.flat(),this.rotation,e,i),s=GS(n);this.activeQuad=s}}getQuadVertices(){let t;const{width:e,height:i}=this.raw.getPageSize();return t=this.isFull?[0,0,e,0,e,i,0,i]:this.activeQuad.flat(),t=HS(t,this.rotation,e,i),t}getProcessedQuad(){if(this.quad){let{width:t,height:e}=this.raw.getPageSize(),{quad:i}=this;i=this.quad.map((t=>[this.toPixelPPI(t[0],!1),this.toPixelPPI(t[1],!0)])),t=this.toPixelPPI(t,!1),e=this.toPixelPPI(e,!0);const n=HS(i.flat(),this.initRotation,t,e);return GS(n)}return null}toggleFull(){let t=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,t=!0):this.isFull||(this.isFull=!0,t=!0),t}isQuadFull(t){let{width:e,height:i}=this.raw.getPageSize();const n=Math.abs((this.rotation%360+360)%360);if(90===n||270===n){const t=e;e=i,i=t}return YS(t,e,i)}getEditResultForPixel(){const t=this.getEditResult();return{rWidth:this.toPixelPPI(t.rWidth,!1),rHeight:this.toPixelPPI(t.rHeight,!0),cropLeft:this.toPixelPPI(t.cropLeft,!1),cropTop:this.toPixelPPI(t.cropTop,!0),cropWidth:this.toPixelPPI(t.cropWidth,!1),cropHeight:this.toPixelPPI(t.cropHeight,!0),rotation:t.rotation}}getEditResult(){if(!this.actions.length){const t=KS(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return{rWidth:t.width,rHeight:t.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:{...this.mediaBox},cropBox:{...this.cropBox}}}const t=this.actions[this.actions.length-1],{rotatedCropBox:e,cropBox:i,rotation:n}=this.actionResult.get(t.actionUid).to;return{rWidth:e.width,rHeight:e.height,cropLeft:i.left,cropTop:i.top,cropWidth:i.width,cropHeight:i.height,rotation:n,mediaBox:{...this.mediaBox},cropBox:{...i}}}getEditResultForPerspective(){const t=this.raw.getPageSize(),e={left:0,top:0,width:t.width,height:t.height};if(!this.pActions.length){const i=KS(e,this.rotation,e.width,e.height);return{rWidth:i.width,rHeight:i.height,cropLeft:0,cropTop:0,cropWidth:t.width,cropHeight:t.height,rotation:this.rotation,cropBox:{...e},mediaBox:e}}const i=this.pActions[this.pActions.length-1],{rotatedCropBox:n,cropBox:s,rotation:o}=this.pActionResult.get(i.actionUid).to;return{rWidth:n.width,rHeight:n.height,cropLeft:s.left,cropTop:s.top,cropWidth:s.width,cropHeight:s.height,rotation:o,mediaBox:e,cropBox:{...s}}}getActions(){return[...this.actions]}getPerspectiveActions(){return this.pActions}addAction(t){let e=null;if(this.actions.length){const t=this.actionResult.get(this.actions[this.actions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}}}else e={mediaBox:{...this.mediaBox},cropBox:{...this.cropBox},rotation:this.rotation,rotatedCropBox:{...this.cropBox}};if(this.actions.push(t),!this.actionResult.has(t.actionUid)){const i=function(t,e,i,n){let s={...t};const o=e.left+e.width,r=e.top+e.height;let a=i,l=KS(t,a,o,r);if("rotate"===n.type)a+=n.angle,l=KS(t,a,o,r);else if("crop"===n.type){const t=n.rect;l={left:t.left+l.left,top:t.top+l.top,width:t.width,height:t.height},s=function(t,e,i,n){e=(e%360+360)%360;const s={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(s.left=r,s.top=n-a-o):2===h?(s.left=i-a-o,s.top=n-l-r):3===h&&(s.left=i-l-r,s.top=o),h%2>0&&(s.width=l,s.height=a),s}(l,a,o,r)}return{rotatedCropBox:l,cropBox:s,mediaBox:e,rotation:a}}(e.cropBox,this.mediaBox,this.rotation,t);this.actionResult.set(t.actionUid,{from:e,to:i}),this.cropBox={...i.cropBox},this.mediaBox={...i.mediaBox}}if("rotate"===t.type){let e=null;const{width:i,height:n}=this.raw.getPageSize(),s={left:0,top:0,width:i,height:n};if(this.pActions.length){const t=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}}}else e={mediaBox:{...s},cropBox:{...s},rotation:this.rotation,rotatedCropBox:{...s}};if(this.pActions.push(t),!this.pActionResult.has(t.actionUid)){const s=function(t,e,i,n){const s=i+n.angle;return{rotatedCropBox:KS(t,s,e.left+e.width,e.top+e.height),cropBox:t,mediaBox:e,rotation:s}}({left:0,top:0,width:i,height:n},{left:0,top:0,width:i,height:n},this.rotation,t);this.pActionResult.set(t.actionUid,{from:e,to:s})}this.rotation+=t.angle}}deleteAction(t){var e,i;if((null===(e=this.actions[this.actions.length-1])||void 0===e?void 0:e.actionUid)===t){this.actions.pop();const e=this.actionResult.get(t);this.cropBox={...e.from.cropBox},this.mediaBox={...e.from.mediaBox},this.rotation=e.from.rotation,this.actionResult.delete(t)}(null===(i=this.pActions[this.pActions.length-1])||void 0===i?void 0:i.actionUid)===t&&(this.pActions.pop(),this.pActionResult.delete(t))}clearActions(){this.actions=[]}toDisplayPPI(t,e){const{resolutionX:i,resolutionY:n}=this;return e?t/n*Ep.displayResolution:t/i*Ep.displayResolution}toPixelPPI(t,e){const{resolutionX:i,resolutionY:n}=this;return e?t*n/Ep.displayResolution:t*i/Ep.displayResolution}quadToDisplayPPI(t){const e=Wd(t);for(let t=0;t<4;t++)e[t][0]=this.toDisplayPPI(e[t][0],!1),e[t][1]=this.toDisplayPPI(e[t][1],!0);return e}quadToPixelPPI(t){const e=Wd(t);for(let t=0;t<4;t++)e[t][0]=this.toPixelPPI(e[t][0],!1),e[t][1]=this.toPixelPPI(e[t][1],!0);return e}rectToDisplayPPI(t){const e={...t};return e.left=this.toDisplayPPI(t.left,!1),e.top=this.toDisplayPPI(t.top,!0),e.width=this.toDisplayPPI(t.width,!1),e.height=this.toDisplayPPI(t.height,!0),e}rectToPixelPPI(t){const e={...t};return e.left=this.toPixelPPI(t.left,!1),e.top=this.toPixelPPI(t.top,!0),e.width=this.toPixelPPI(t.width,!1),e.height=this.toPixelPPI(t.height,!0),e}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0}getAnnotationUids(){return[...this.annotations]}}class t_ extends Ju{constructor(){super(),na(this,"uid",void 0),na(this,"emitter",void 0),na(this,"repo",void 0),na(this,"onDocumentCreated",tp(this)),na(this,"onDocumentDeleted",tp(this)),na(this,"onDocumentRenamed",tp(this)),na(this,"onPagesAddedOut",tp(this)),na(this,"onAddPagesToDoc",tp(this)),na(this,"onBeforeDeletePagesFromDoc",tp(this)),na(this,"onDeletePagesFromDoc",tp(this)),na(this,"onBeforeDeleteAllPagesFromDoc",tp(this)),na(this,"onDeleteAllPagesFromDoc",tp(this)),na(this,"onMovePages",tp(this)),na(this,"onSwitchPage",tp(this)),na(this,"onReorderPages",tp(this)),na(this,"onBeforeDeleteDocs",tp(this)),na(this,"onAfterDeleteDocs",tp(this)),na(this,"onOpenDocument",tp(this)),na(this,"onCloseDocument",tp(this)),this.emitter=new iu,this.uid=Qd(),this.repo=new Map}dispose(){this.repo.forEach((t=>t.dispose())),this.repo.clear(),super.dispose()}reset(){this.repo.clear()}createDocument(){const t=new FS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(t.uid,t);const e=FC.create(t.uid,t.name);return this.onDocumentCreated.emit(e),t}getDocument(t){return this.repo.get(t)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(t,e){const i=this.repo.get(t);if(!i)return!1;const n=oS.create(t,i.name,e);return i.name=e,this.onDocumentRenamed.emit(n),!0}deleteDocuments(t){return t.forEach((t=>{const e=this.getDocument(t);e.dispose(),this.repo.delete(t);const i=FC.create(t,e.name);this.onDocumentDeleted.emit(i)})),!0}addPagesToDocument(t,e,i){const n=this.repo.get(t);if(!n)return!1;const{length:s}=e,o=[];let r=n.pages.length;qd(i)?(n.pages.splice(i,0,...e),r=i):n.pages.push(...e);for(let t=0;t<s;t++)o.push(r+t);const a=iS.create(t,e,o,i);return this.onAddPagesToDoc.emit(a),!0}removePagesFromDocument(t,e){const i=this.getDocument(t);if(!i)return!1;const n=e.map((t=>i.pages.indexOf(t)));e.forEach((t=>{Bu(i.pages,t)}));const s=jC.create(t,e,n);return this.onBeforeDeletePagesFromDoc.emit(s),this.onDeletePagesFromDoc.emit(s),!0}removeAllPagesFromDocument(t){const e=this.getDocument(t);if(!e)return!1;const i=[...e.pages.keys()],n=[...e.pages];e.pages.length=0;const s=jC.create(t,n,i);return this.onBeforeDeleteAllPagesFromDoc.emit(s),this.onDeleteAllPagesFromDoc.emit(s),!0}movePages(t,e,i){const n=this.repo.get(t);if(!n)return!1;Fu(n.pages,e,i);const s=sS.create(t,e,i);return this.onMovePages.emit(s),!0}swapPages(t,e,i){const n=this.repo.get(t);if(!n)return!1;Nu(n.pages,e,i);const s=aS.create(t,e,i);return this.onSwitchPage.emit(s),!0}reorderPages(t,e){const i=this.repo.get(t);if(!i)return!1;Uu(i.pages,e);const n=rS.create(t,e);return this.onReorderPages.emit(n),!0}}class e_{on(t,e){}emit(t){}}(new e_).on("debug",(function(){}));class i_{constructor(){na(this,"undoStack",void 0),na(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[]}getOperation(){return{undo:this.undoStack.length,redo:this.redoStack.length}}execute(t){return!!t.execute()&&(this.undoStack.push(t),this.redoStack.length>0&&(this.redoStack.forEach((t=>{t.dispose()})),this.redoStack.length=0),!0)}undo(){const t=this.undoStack.pop();return t&&(t.undo(),this.redoStack.push(t)),!!t}redo(){const t=this.redoStack.pop();return t&&(t.execute(),this.undoStack.push(t)),!!t}removeUidsFromCommand(t){this.removeFromStack(this.undoStack,t),this.removeFromStack(this.redoStack,t)}removeFromStack(t,e){t.slice().forEach((e=>{if(!e.isValid){const i=t.indexOf(e);t.splice(i,1),e.dispose()}}))}reset(){this.undoStack.forEach((t=>{t.dispose()})),this.redoStack.forEach((t=>{t.dispose()})),this.undoStack=[],this.redoStack=[]}}class n_ extends Ju{constructor(){super(),na(this,"invokers",void 0),na(this,"onOperationsChanged",tp(this)),na(this,"onBeforeRefreshCommands",tp(this)),na(this,"onRefreshCommands",tp(this)),this.invokers=new Map}createInvoker(t){if(!this.invokers.has(t)){const e=new i_;this.invokers.set(t,e)}}deleteInvokers(t){t.forEach((t=>{if(this.invokers.has(t)){const e=this.invokers.get(t);null==e||e.reset(),this.invokers.delete(t)}}))}execute(t,e){const i=this.invokers.get(e);null!=i&&i.execute(t)&&this.emitOperationsChanged(e)}undo(t){const e=this.invokers.get(t),i=!(null==e||!e.undo());return i&&this.emitOperationsChanged(t),i}redo(t){const e=this.invokers.get(t),i=!(null==e||!e.redo());return i&&this.emitOperationsChanged(t),i}saveOperations(t){const e=this.invokers.get(t);return!!e&&(e.reset(),this.emitOperationsChanged(t),!0)}getOperationState(t){return this.invokers.get(t).getOperation()}removePageFromCommand(t,e){this.onBeforeRefreshCommands.emit({docUid:t,pageUids:e}),this.invokers.get(t).removeUidsFromCommand(e),this.emitOperationsChanged(t)}emitOperationsChanged(t){const e=this.invokers.get(t);let i=0,n=0;if(e){const t=e.getOperation();i=t.undo,n=t.redo}const s=ES.create(t,i,n);this.onOperationsChanged.emit(s)}dispose(){this.invokers.clear(),super.dispose()}reset(){this.invokers.forEach((t=>{t.reset()})),this.invokers.clear()}}class s_ extends Ju{constructor(){super(),na(this,"files",void 0),na(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=tp(this)}dispose(){this.files.clear(),super.dispose()}reset(){this.files.clear()}addFile(t,e,i){const n=new VS({uid:t,mime:e,pageCount:i});this.files.set(t,n)}getByUid(t){return this.files.get(t)}addUser(t,e,i){const n=this.getByUid(t);return null==n?void 0:n.addUser(e,i)}addUsersByParsedPages(t,e){e.forEach((e=>{this.addUser(t,e.fileIndex,e.pageUid)}))}deleteUser(t,e,i){const n=this.getByUid(t);return n&&(n.deleteUser(e,i),n.count||(this.onDeleteFileData.emit(t),this.files.delete(t))),!1}}class o_ extends Ju{constructor(t){super(),na(this,"pages",void 0),na(this,"core",void 0),na(this,"onUpdatePage",tp(this)),na(this,"onCreatePage",tp(this)),na(this,"onCopyPage",tp(this)),na(this,"onDeletePages",tp(this)),na(this,"onBeforeDeletePages",tp(this)),na(this,"onAfterDeletePages",tp(this)),na(this,"onBeforeCopyPages",tp(this)),na(this,"onCopyPages",tp(this)),this.core=t,this.pages=new Map}handlePagePreloadChange(t){let{viewerUid:e,viewerMode:i,docUid:n,changes:s}=t;s.forEach((t=>{let{pageUid:s,from:o,to:r}=t;const a=this.getPage(s),l={viewerUid:e,docUid:n,pageUid:s},{autoReleaseImg:h}=Ep;o&&!r?(a.raw.deleteUser(l),a.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(s),this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex),a.raw.resetBlob(),h&&a.raw.resetImg()),i!==$b.DEFAULT&&i!==$b.THUMBNAIL||(a.original.deleteUser(l),a.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(s),a.original.resetBlob(),h&&a.original.resetImg()),a.display.deleteUser(l),a.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(s),a.display.resetBlob(),h&&a.display.resetImg())),i===$b.THUMBNAIL&&(a.thumbnail.deleteUser(l),a.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(s),a.thumbnail.resetBlob(),h&&a.thumbnail.resetImg())),a.raw.hasUser()||this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex)):(a.raw.addUser(l),i!==$b.DEFAULT&&i!==$b.THUMBNAIL||(a.original.addUser(l),a.display.addUser(l)),i===$b.THUMBNAIL&&a.thumbnail.addUser(l))}))}dispose(){this.pages.clear(),super.dispose()}reset(){this.pages.clear()}getPage(t){return this.pages.get(t)}startCreatePagesByParsedPages(t,e,i){t.forEach(((t,n)=>{var s;this.createPage({...t,fileUid:e,annotations:(null===(s=t.annotations)||void 0===s?void 0:s.map((t=>t.uid)))||[]},i)}))}endCreatePagesByParsedPages(t,e){t.forEach((t=>{let{pageUid:i,fileIndex:n}=t;const s=nS.create(i,e,n);this.onCreatePage.emit(s)}))}createPage(t,e){const i=new QS(t,e);return this.pages.set(i.uid,i),i}copyPage(t,e,i){const n=i.copy(t,e);return this.pages.set(n.uid,n),MS.create(t,n.fileUid,n.fileIndex,i.annotations.slice()),n}deletePages(t){const e=TS.create(t);this.onBeforeDeletePages.emit(e),t.forEach((t=>{const e=this.pages.get(t);e&&e.dispose(),this.pages.delete(t)})),this.onDeletePages.emit(e),this.onAfterDeletePages.emit(e)}updatePage(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=this.pages.get(t);if(n){const{doc:s,customData:o}=n;n.dispose();const r=new QS({...i,pageUid:t},s);r.customData=o,this.pages.set(t,r);const a=lS.create(s.uid,t,e);this.onUpdatePage.emit(a)}}getPageCount(){return this.pages.size}}var r_=new WeakSet,a_=new WeakSet;class l_{constructor(t){va(this,a_),va(this,r_),na(this,"core",void 0),na(this,"annotationMapper",void 0),this.core=t,this.annotationMapper=new hx}reset(){}async saveToPng(t,e,i){const n=this.core.pageService.getPage(t);if(!n)return Promise.resolve(null);const s=await this.core.sourceStore.get(n.fileUid);if(!(ga(this,r_,h_).call(this,n)||(null==e?void 0:e.saveAnnotation)&&n.annotations.length>0)&&s.fileData&&"image/png"===s.fileData.type)return i&&(i.details.current=i.details.total,i.status="InProgress",vw.info(i),i.status="Completed",vw.info(i)),s.fileData;const o=await this.core.getPageData(t,{display:!0,raw:!1,thumbnail:!1,renderAnnotation:!(null==e||!e.saveAnnotation),getPng:!0}),r=np.isApple&&!(null!=e&&e.saveAnnotation&&n.annotations.length>0)&&ga(this,a_,c_).call(this,n);if(!r&&"image/png"===await Yu(o.display.data))return i&&(i.details.current=i.details.total,i.status="InProgress",vw.info(i),i.status="Completed",vw.info(i)),o.display.data;const a=this.core.saverService.getSaver("image/png");try{const t=await a.save(o.display.data,{outputType:3,is1Bit:r});return i&&(i.details.current=i.details.total,i.status="InProgress",vw.info(i),i.status="Completed",vw.info(i)),t}finally{a.destroy()}}async saveToJpeg(t,e,i){const n=this.core.pageService.getPage(t);if(!n)return Promise.resolve(null);const s=await this.core.sourceStore.get(n.fileUid);if((null==e||!e.saveAnnotation)&&s.fileData&&"image/jpeg"===s.fileData.type&&!ga(this,r_,h_).call(this,n))return i&&(i.details.current=i.details.total,i.status="InProgress",vw.info(i),i.status="Completed",vw.info(i)),s.fileData;const o=this.core.saverService.getSaver("image/jpeg");try{const n=await this.core.getPageData(t,{display:!0,raw:!1,thumbnail:!1,renderAnnotation:!(null==e||!e.saveAnnotation)}),s=await o.save(n.display.data,{outputType:1,jpegQuality:null==e?void 0:e.quality});return i&&(i.details.current=i.details.total,i.status="InProgress",vw.info(i),i.status="Completed",vw.info(i)),s}finally{o.destroy()}}async saveToTiff(t,e,i){const n=this.core.saverService.getSaver("image/tiff"),s=!(null==e||!e.saveAnnotation);try{await n.init(e);for(let o=0;o<t.length;o++){const r=t[o],a=this.core.pageService.getPage(r);if(!a)break;const l=await this.core.getPageData(r,{display:!0,renderAnnotation:s}),h=np.isApple&&!(null!=e&&e.saveAnnotation&&a.annotations.length>0)&&ga(this,a_,c_).call(this,a);await n.appendPage(l.display.data,{is1Bit:h}),i&&(i.details.current=o+1,i.status="InProgress",vw.info(i))}const o=await n.getTiff();return i&&(i.details.current=i.details.total,i.status="Completed",vw.info(i)),o}finally{n.destroy()}}isPdfInfoChanged(t){return!!t.pdfOptions&&(t.rotation!==t.pdfOptions.rotation||t.mediaBox.left!==t.pdfOptions.mediaBox.left||t.mediaBox.width!==t.pdfOptions.mediaBox.width||t.mediaBox.height!==t.pdfOptions.mediaBox.height||t.mediaBox.top!==t.pdfOptions.mediaBox.top||t.cropBox.left!==t.pdfOptions.cropBox.left||t.cropBox.width!==t.pdfOptions.cropBox.width||t.cropBox.height!==t.pdfOptions.cropBox.height||t.cropBox.top!==t.pdfOptions.cropBox.top)}splitArrayIntoChunks(t,e){const i=[];for(let n=0;n<t.length;n+=e){const s=t.slice(n,n+e);i.push(s)}return i}async saveToPdf(t,e,i){null!=e&&e.creationDate&&(e.creationDate=BS(e.creationDate)),null!=e&&e.modifiedDate&&(e.modifiedDate=BS(e.modifiedDate)),!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||ub.makeSureAnnotationLicenseExist();const n=this.core.saverService.getSaver("application/pdf");try{await n.init(e);const u=new Map,p=e&&e.pageType&&e.pageType!==Op.PAGE_DEFAULT;let g=0;for(let h=0;h<t.length;h++){var s,o;const c=t[h],d=this.core.pageService.getPage(c);if(!d)break;const f=await this.core.sourceStore.get(d.fileUid),m=p||(null===(s=d.pdfOptions)||void 0===s?void 0:s.convertMode)===qv.CM_IMAGEONLY||(null===(o=d.pdfOptions)||void 0===o?void 0:o.renderOptions.renderGrayscale),v=[],y=[];if(f.fileData&&"application/pdf"===f.fileData.type&&!m)for(let i=h;i<t.length;i++){var r,a;const n=t[i],s=this.core.pageService.getPage(n);if(!s)break;if(s.fileUid!==d.fileUid)break;if(!s.isFull)break;if("image"===(null==e?void 0:e.saveAnnotation)&&s.annotations.length>0)break;if((null===(r=s.pdfOptions)||void 0===r?void 0:r.convertMode)===qv.CM_IMAGEONLY||null!==(a=s.pdfOptions)&&void 0!==a&&a.renderOptions.renderGrayscale)break;let o=!1;s.filter&&"none"!==s.filter&&(o=!0);const l=s.getActions(),c=s.getPerspectiveActions();l.every((t=>"rotate"===t.type||"crop"===t.type))&&c.every((t=>"rotate"===t.type||"crop"===t.type))||(o=!0);let p=!1;if(o&&this.core.getAnnotationsByPageUid(t[h]).forEach((t=>{t.oriIndex>=0&&!t.modified&&(p=!0)})),o&&!p)break;this.isPdfInfoChanged(s)&&u.set(g+v.length,{mediaBox:s.mediaBox,cropBox:s.cropBox,rotation:s.rotation}),v.push(s.fileIndex),p&&y.push({pageUid:n,pageIndex:i,fileIndex:s.fileIndex})}if(v.length>0){var l;const t=null===(l=f.loadOptions)||void 0===l?void 0:l.password,s=f.fileData.size/f.pageCount,o=Math.max(1,Math.floor(83886080/s)),r=this.splitArrayIntoChunks(v,o),a=[];y.forEach((t=>{a.push(t.fileIndex)}));let c=0;for(let e=0;e<r.length;e++)if(await n.appendRawPdfPages(f.fileData,t,r[e]),i){i.status="InProgress";for(let t=0;t<r[e].length;t++)a.includes(r[e][t])||(c+=1,i.details.current=g+c,vw.info(i))}for(let t=0;t<y.length;t++){const s=await this.core.imageDataService.getNotRotatedDisplay(y[t].pageUid,"image"===(null==e?void 0:e.saveAnnotation));await n.changePageImage(y[t].pageIndex,s.data,{cropBox:d.cropBox,mediaBox:d.mediaBox,rotation:d.rotation,width:s.width,height:s.height}),i&&(i.status="InProgress",c+=1,i.details.current=g+c,vw.info(i))}h+=v.length-1,g+=v.length}else{const t=await this.core.imageDataService.getNotRotatedDisplay(c,"image"===(null==e?void 0:e.saveAnnotation)),s=np.isApple&&!("image"===(null==e?void 0:e.saveAnnotation)&&d.annotations.length>0)&&ga(this,a_,c_).call(this,d);await n.appendImagePage(t.data,{cropBox:d.cropBox,mediaBox:d.mediaBox,rotation:d.rotation,width:t.width,height:t.height,bitDepth:s?1:void 0}),g+=1,i&&(i.details.current=g,i.status="InProgress",vw.info(i))}}u.size>0&&await n.setPageInfo(u);const f=[];for(let i=0;i<t.length;i++){var h;const s=this.core.pageService.getPage(t[i]);if(s)if(e&&"image"===e.saveAnnotation)(null===(h=s.pdfOptions)||void 0===h?void 0:h.annotCount)>0&&await n.removePageAnnotations(i);else{const o=s.pdfOptions&&s.pdfOptions.convertMode===qv.CM_RENDERALL&&s.pdfOptions.renderOptions.renderAnnotations===Zv.RENDER_ANNOTATIONS,r=this.core.getAnnotationsByPageUid(t[i]);if(!r.length){!o&&s.pdfOptions&&s.pdfOptions.annotCount>0&&await n.removePageAnnotations(i);continue}e&&"none"===e.saveAnnotation&&r.forEach((t=>{!["textBox","textTypewriter"].includes(t.type)||!t.modified&&qd(null==t?void 0:t.oriIndex)||t.style.textContents.forEach((t=>{f.push({family:t.fontFamily,isBlob:"bold"===t.fontWeight,isItalic:"italic"===t.fontStyle})}))}));const a=[];for(let t=0;t<r.length;t++)!0===r[t].flattened&&(a.push(r[t]),r.splice(t,1),t-=1);if(a.length>0){const t=await this.annotationMapper.getOriginalAnnotations(a,{width:s.mediaBox.left+s.mediaBox.width,height:2*s.mediaBox.top+s.mediaBox.height});await n.flattenPageAnnotations(i,t)}if(e&&"none"!==e.saveAnnotation){const t=await this.annotationMapper.getOriginalAnnotations(r,{width:s.mediaBox.left+s.mediaBox.width,height:2*s.mediaBox.top+s.mediaBox.height});var c;await n.setPageAnnotations(i,t,o),"flatten"===e.saveAnnotation&&(t.length>0||o&&null!==(c=s.pdfOptions)&&void 0!==c&&c.annotCount)&&await n.flattenPage(i)}else{var d;(null===(d=s.pdfOptions)||void 0===d?void 0:d.annotCount)>0&&await n.removePageAnnotations(i)}}}f.length&&(await n.ifFontsExist(f)||vw.warning(vw.WASM_FONT_LOSS));const m=await n.getPdf(up.RT_BINARY);return i&&(i.details.current=i.details.total,i.status="Completed",vw.info(i)),m}catch(t){throw vw.EXTERNAL_ERR}finally{n.destroy()}}}function h_(t){if(!t.isFull)return!0;if(t.filter&&"none"!==t.filter)return!0;if(t.getActions().some((t=>"rotate"!==t.type)))return!0;if(t.getPerspectiveActions().some((t=>"rotate"!==t.type)))return!0;const e=this.core.getAnnotationsByPageUid(t.uid);let i=!1;return e.forEach((t=>{t.flattened&&(i=!0)})),!!i||0!==t.rotation}function c_(t){if(1!==t.resource.bitDepth)return!1;if(t.filter&&t.filter!==Bx.NONE&&t.filter!==Bx.BLACK_AND_WHITE&&t.filter!==Bx.SAVE_INK)return!1;const e=this.core.getAnnotationsByPageUid(t.uid);let i=!1;return e.forEach((t=>{t.flattened&&(i=!0)})),!i}const d_=t=>{const e=new Set(t);return Array.from(e.values())};class u_ extends Ju{constructor(){super(),na(this,"observer",void 0),na(this,"onResizeObserver",tp(this)),this.observer=new ResizeObserver((t=>{t.forEach((t=>{this.onResizeObserver.emit(t)}))}))}observe(t){this.observer.observe(t)}unobserve(t){this.observer.unobserve(t)}reset(){this.observer.disconnect()}dispose(){this.observer.disconnect(),this.observer=null,super.dispose()}}class p_{constructor(){na(this,"canvas",void 0),na(this,"renderer",void 0),na(this,"root",void 0),this.renderer=new Bm,this.canvas=new vm({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new my).init(this.canvas)}render(t,e,i){this.root.children.slice().forEach((t=>{this.root.removeChild(t)})),this.root.appendChild(t),this.canvas.resize(e||t.width,i||t.height),this.canvas.render()}reset(){this.root.children.slice().forEach((t=>{this.root.removeChild(t)})),this.root.sortable.sorted=[]}getCanvas(){return this.canvas.contextService.getDomElement()}}let g_;const f_="p".charCodeAt(0),m_="H".charCodeAt(0),v_="Y".charCodeAt(0),y_="s".charCodeAt(0);function x_(t,e){const i=t.slice(0,33);return new Promise(((n,s)=>{const o=new FileReader;o.onload=()=>{const i=new Uint8Array(o.result),s=t.slice(33),r=function(t,e,i){if("image/jpeg"===i)return t[13]=1,t[14]=e>>8,t[15]=255&e,t[16]=e>>8,t[17]=255&e,t;if("image/png"===i){const i=new Uint8Array(13);e*=39.3701,i[0]=f_,i[1]=m_,i[2]=v_,i[3]=y_,i[4]=e>>>24,i[5]=e>>>16,i[6]=e>>>8,i[7]=255&e,[i[8],i[9],i[10],i[11]]=[i[4],i[5],i[6],i[7]],i[12]=1;const n=function(t){let e=-1;g_||(g_=function(){const t=new Int32Array(256);for(let e=0;e<256;e++){let i=e;for(let t=0;t<8;t++)i=1&i?3988292384^i>>>1:i>>>1;t[e]=i}return t}());for(let i=0;i<t.length;i++)e=g_[255&(e^t[i])]^e>>>8;return~e}(i),s=new Uint8Array(4);s[0]=n>>>24,s[1]=n>>>16,s[2]=n>>>8,s[3]=255&n;const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const r=new Uint8Array(54);return r.set(t,0),r.set(o,33),r.set(i,37),r.set(s,50),r}throw new Error(`The format ${i} is not supported.`)}(i,e,t.type),a=new Blob([r,s],{type:t.type});n(a)},o.onerror=t=>{s(t)},o.readAsArrayBuffer(i)}))}class w_{constructor(t){na(this,"core",void 0),this.core=t}async getRaw(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.raw.isAvailable)return i.raw.getImageDetail();const{fileUid:n,fileIndex:s}=i,o=await this.core.sourceStore.get(n);let r;return r=this.core.parserService.getCustomParserClasses(o.fileData.type)?o.fileData.type:await Yu(o.fileData),r||vw.throw(vw.FILE_NOT_SUPPORT),new Promise(((t,a)=>{let l=!1;const h=setTimeout((()=>{l=!0,t(null)}),15e3);this.core.parserService.getPage(o.fileData,r,n,s).then((n=>{if(l)return;if(clearTimeout(h),!n)return void t(null);let{raw:s}=i;e||(s=new $S(i)),s.updateImageDetail(n.resource),t(s.getImageDetail())})).catch((e=>{l||(clearTimeout(h),vw.error(e),t(null))}))}))}catch(t){return vw.error(t),null}}async getOriginal(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const{original:n}=i;if(n.isAvailable)return n.getImageDetail();const s=await this.getRaw(t);if(!s)return null;const o=await this.handlePerspectiveQuad(t,s);return e&&o&&i.original.updateImageDetail(o),o}async handlePerspectiveQuad(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let n=e;const s=i.getProcessedQuad();if(s){const o=vw.buildInfo("perspective",{pageUid:t,perspectiveQuad:s});if(vw.info(o),n=await this.core.perspectiveService.perspective({data:e.data,type:cp.JPEG},s,{angle:i.initRotation}),!n)return o.status="Failed",vw.info(o),null;o.status="Completed",vw.info(o)}const o=new $S(i);return o.updateImageDetail(n),o.getImageDetail()}async getDisplay(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.display.isAvailable)return i.display.getImageDetail();const n=await this.getOriginal(t);if(!n)return null;const{filter:s}=i,o=await this.handleFilter(t,n);return i.filter!==s?this.getDisplay(t):(e&&o&&i.display.updateImageDetail(o),o)}async handleFilter(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const n=e,{filter:s}=i;if(s&&"none"!==s){const i=vw.buildInfo("filter",{pageUid:t,filterType:s});vw.info(i);const o=await this.core.filterService.applyFilter({data:e.data,type:cp.JPEG,width:e.width,height:e.height},s);if(!Gd(o))return i.status="Failed",vw.info(i),null;i.status="Completed",vw.info(i),n.data=o}const o=new $S(i);return o.updateImageDetail(n),o.getImageDetail()}async getEditedDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.core.pageService.getPage(t);if(!s||s.isDestroyed)return null;const o=await this.getDisplay(t,!1),r=this.core.getAnnotationsByPageUid(t).some((t=>!0===t.flattened));if(s.getActions().length||0!==s.rotation||!s.isMediaBoxEqualCropBox()||e&&s.annotations.length||r){const o=await this.applyEditToDisplay(t,e,i,!0,n),r=new $S(s);return r.updateImageDetail(o),r.getImageDetail()}return o}async getNotRotatedDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.core.pageService.getPage(t);if(!n||n.isDestroyed)return null;const s=await this.getOriginal(t);if(!s)return null;const o=await this.handleFilter(t,s);if(e&&n.annotations.length){const s=await this.applyEditToDisplay(t,e,!1,!1,i),o=new $S(n);return o.updateImageDetail(s),o.getImageDetail()}return o}async getThumbnail(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.thumbnail.isAvailable)return i.thumbnail.getImageDetail();const n=await this.getDisplay(t,!0);if(!n)return null;const s=await this.displayToThumbnail(n.data);return s?(e&&i.thumbnail.updateImageDetail(s),s):null}async displayToThumbnail(t){return t}async applyEditToDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=await this.core.imageLoadService.loadDisplayImage(t),r=this.core.pageService.getPage(t),a=await this.getDisplay(t,!1);let l;if(n)l=r.getEditResultForPixel();else{const[t,e]=$u([r.initState.mediaBox.width,r.initState.mediaBox.height],Ep.displayResolution,r.resource.resolutionX);l={rWidth:t,rHeight:e,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:e,rotation:0}}const h={width:Math.round(l.rWidth)||1,height:Math.round(l.rHeight)||1,data:null},c=new Df({style:{x:-l.cropLeft,y:-l.cropTop,img:o,width:a.width,height:a.height}}),d=new Nf({style:{x:-(l.cropWidth-l.rWidth)/2,y:-(l.cropHeight-l.rHeight)/2,width:l.cropWidth,height:l.cropHeight}});if(d.appendChild(c),d.setLocalAngle(l.rotation),this.core.annotationService&&r.annotations.length){const n=this.core.getAnnotationsByPageUid(t).some((t=>!0===t.flattened));if(e||!e&&n){const s=new Nf({style:{x:-l.cropLeft,y:-l.cropTop,width:r.original.pageWidth,height:r.original.pageHeight}});await this.applyAnnotationToPage(s,t,i,!e&&n),d.appendChild(s)}}this.core.commonCanvas.render(d,Math.max(1/devicePixelRatio,l.rWidth),Math.max(1/devicePixelRatio,l.rHeight)),this.core.commonCanvas.reset();const u=this.core.commonCanvas.getCanvas();return new Promise(((t,e)=>{u.toBlob((async e=>{e=await x_(e,r.resolutionX||Ep.displayResolution),h.data=e,t(h)}),s?"image/png":"image/jpeg",1)}))}async applyAnnotationToPage(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.core.pageService.getPage(e),o=[];s.annotations.forEach((t=>{const e=this.core.annotationService.getAnnotationByUid(t);o.push(e)})),o.sort(((t,e)=>t.layer-e.layer));for(let e=0;e<o.length;e++){if(i&&!o[e].flags.includes("print"))continue;if(n&&!o[e].flattened)return;if("stamp"===o[e].type&&o[e].style.imageData&&(!qd(o[e].style.width)||!qd(o[e].style.height))){const t=new xp,i=await t.readImageInfo({fileSource:o[e].style.imageData});let n=i.imageWidth,s=i.imageHeight;if(n>400||s>400){const t=Math.max(n/400,s/400);n/=t,s/=t}o[e].style.width=n,o[e].style.height=s}const r=this.core.annotationService.createAnnotationShape(o[e],s);r instanceof Mv&&r.style.imageData&&r.style.img instanceof HTMLImageElement&&await new Promise((t=>{r.style.img.onload=()=>{t()}})),r&&t.appendChild(r)}}}class b_{constructor(t){na(this,"name",void 0),this.name=t||"Guest"}getUser(){return this.name}setUser(t){this.name=t}}class C_ extends IC{static create(t){return new C_(t)}constructor(t){super("setExternalHandler"),na(this,"handlerType",void 0),this.handlerType=t}}class S_{static makeSureSourcesTypeSupported(t,e,i,n,s){const o=[];if(Ud(e))e.forEach(((t,e)=>{if(!t||0===t.length){const t=yw("Source[]",i,`[${e}].fileData`,!0);o.push(`${t}: ${vw.FILE_NOT_SUPPORT.message}`)}}));else if(!e||0===e.length){const t=yw("Source",i,"fileData");o.push(`${t}: ${vw.FILE_NOT_SUPPORT.message}`)}if(o.length>0){if(!t)throw vw.buildError({...vw.FILE_NOT_SUPPORT,details:o},n,s);vw.throw({...vw.FILE_NOT_SUPPORT,details:o},n,s)}}}const __=new Map,T_=[];let E_=class t extends Ju{constructor(t,e,i,n,s){super(),na(this,"parserService",void 0),na(this,"saverService",void 0),na(this,"perspectiveService",void 0),na(this,"filterService",void 0),na(this,"detectorService",void 0),na(this,"viewerService",void 0),na(this,"editService",void 0),na(this,"annotationService",void 0),na(this,"documentService",void 0),na(this,"trackerService",void 0),na(this,"imageLoadService",void 0),na(this,"optimizationService",void 0),na(this,"processService",void 0),na(this,"commandService",void 0),na(this,"fileSaveService",void 0),na(this,"fileService",void 0),na(this,"pageService",void 0),na(this,"resizeService",void 0),na(this,"imageDataService",void 0),na(this,"userService",void 0),na(this,"sourceStore",void 0),na(this,"commonCanvas",void 0),na(this,"onBeforeGetPageData",void 0),na(this,"onBeforeLoadSource",void 0),na(this,"onAfterLoadSource",void 0),na(this,"onSetExternalHandler",void 0),na(this,"onAfterPerspective",void 0),na(this,"onFilterChanged",void 0),na(this,"onUnload",void 0),this.parserService=t,this.saverService=e,this.perspectiveService=i,this.filterService=n,this.detectorService=s,this.onBeforeGetPageData=tp(this),this.onBeforeLoadSource=tp(this),this.onAfterLoadSource=tp(this),this.onSetExternalHandler=tp(this),this.onUnload=tp(this),this.onAfterPerspective=tp(this),this.onFilterChanged=tp(this),this.commonCanvas=new p_,this.sourceStore=new Xb,this.trackerService=new e_,this.documentService=new t_,this.fileService=new s_,this.pageService=new o_(this),this.imageLoadService=new SC(this),this.optimizationService=new PC,this.processService=new AC,this.commandService=new n_,this.fileSaveService=new l_(this),this.resizeService=new u_,this.imageDataService=new w_(this),this.userService=new b_("Guest"),T_.forEach((t=>{var e;null===(e=t.apply)||void 0===e||e.call(t,this)})),this.initServiceEvent()}initServiceEvent(){const{documentService:t,commandService:e,pageService:i,viewerService:n,fileService:s,parserService:o}=this;t.onDocumentCreated.on((t=>{e.createInvoker(t.docUid)}),e),t.onDocumentDeleted.on((t=>{e.deleteInvokers([t.docUid])}),e),n.onPagePreloadChanged.on((t=>{i.handlePagePreloadChange(t)}),i),s.onDeleteFileData.on((t=>{this.sourceStore.remove(t)})),s.onDeleteFileData.on((t=>{o.freeParserByFileUid(t)}),o)}static getClass(t){return __.get(t)}static setClass(t,e){__.set(t,e)}static registerPlugin(e){T_.includes(e)||T_.push(e),e.install&&e.install(t)}getClass(t){return __.get(t)}createAsyncRepository(){return new Xb}createViewer(e){const i=t.getClass("Viewer"),n={...e,core:this,groupUid:e.groupUid||Qd()},s=this.viewerService.createViewer(i,n);return s.context.isInitialized=!0,s}removeViewer(t){this.viewerService.removeViewer(t.uid)}getViewer(t){return this.viewerService.getViewer(t)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(t){return this.parserService.getDefaultParserOptions(t)}setFileParserDefaultOptions(t,e){return this.parserService.setDefaultParserOptions(t,e)}setFileParser(t,e){this.parserService.registerCustomParser(t,e)}getSourceParseOptions(t,e){if("application/pdf"===e){var i;const e=t;return e.convertMode=null!==(i=e.convertMode)&&void 0!==i?i:qv.CM_AUTO,Wd(e)}if("width"in t)return Wd(t)}async loadSource(t,e,i,n){Ud(t)||(t=[t]);const s=this.documentService.getDocument(e);if(!s)return[];const o=qd(i)?{insertBeforeIndex:i}:{...i},r="ignore"===o.exception,a=await this.getSourcesMimeTypes(t);r||S_.makeSureSourcesTypeSupported(!1,a,"sources");const l=[],h=async(t,i)=>{const n=a[i];r&&S_.makeSureSourcesTypeSupported(!1,n,`sources[${i}]`);const h=[],c=Qd(),d=this.getSourceParseOptions(t,n),{fileData:u}=t,{pageCount:p,batchSize:g}=await this.parserService.getParseInfo(u,n,c,d);this.sourceStore.set(c,{fileData:n===u.type?u:u.slice(0,u.size,n),loadOptions:d,pageCount:p}),this.fileService.addFile(c,n,p);const f=this.getBatchIndices(g,p);for(const i of f){var m;const r=await this.parserService.parse(u,n,c,i,d).catch((t=>{throw t}));null===(m=t.extraPageData)||void 0===m||m.forEach((t=>{const e=r.find((e=>e.fileIndex===t.index));if(e){const i={...t};delete i.index,qd(e.rotation)&&qd(i.rotation)&&(i.rotation+=e.rotation),Hd(i.filter)||(e.filter=i.filter),Hd(i.rotation)||(e.rotation=i.rotation),Hd(i.perspectiveQuad)||(e.perspectiveQuad=i.perspectiveQuad),Hd(i.index)||(e.index=i.index)}}));const a=r.map((t=>{var e;const i=Qd();return t.pageUid=i,null!==(e=t.filter)&&void 0!==e||(t.filter=this.filterService.getDefaultFilterType()||"none"),i}));l.push({fileData:u,mimeType:n,fileUid:c,parsedPages:r,indices:i,parseOptions:d}),this.fileService.addUsersByParsedPages(c,r),this.pageService.startCreatePagesByParsedPages(r,c,s),this.documentService.addPagesToDocument(e,a,o.insertBeforeIndex),Hd(o.insertBeforeIndex)||(o.insertBeforeIndex+=r.length),h.push(...a)}return h};this.onBeforeLoadSource.emit({docUid:e});const c=[];for(const[e,i]of t.entries())try{const t=await h(i,e);c.push(...t),n&&(n.status="InProgress",n.details.current=e+1,vw.info(n))}catch(t){if(!r)throw t;vw.warning(t)}for(let t=0;t<l.length;t++){const i=l[t];await this.parserService.parseAnnotation(i.fileData,i.mimeType,i.fileUid,i.parsedPages,i.indices,i.parseOptions),this.annotationService.createAnnotationsByParsedPages(e,i.parsedPages),i.parsedPages.forEach((t=>{const e=this.pageService.getPage(t.pageUid);t.annotations&&(e.annotations=t.annotations.map((t=>t.uid)))}))}const d=c.map((t=>s.pages.indexOf(t)));return this.onAfterLoadSource.emit(HC.create(e,d,c)),this.documentService.onPagesAddedOut.emit(HC.create(e,[...d],[...c])),n&&(n.details.current=n.details.total,n.status="Completed",vw.info(n)),c}async getSourcesMimeTypes(t){const e=[];for(const i of t){const t=this.parserService.getCustomParserClasses(i.fileData.type)?i.fileData.type:await Yu(i.fileData);e.push(t)}return e}getAnnotationsByPageUid(t){const e=this.pageService.getPage(t);return e?e.annotations.map((t=>this.annotationService.getAnnotationByUid(t))):[]}getBatchIndices(t,e){const i=[];for(let n=0;n<e;){const s=t>0?Math.min(t,e-n):e;i.push(Array.from({length:s},((t,e)=>n+e))),n+=s}return i}async getPageData(t,e){var i;null!==(i=e)&&void 0!==i||(e={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1,getPng:!1});const n=this.pageService.getPage(t);if(!n)return null;this.onBeforeGetPageData.emit({pageUid:t});const s=await this.sourceStore.get(n.fileUid);let{quad:o}=n;o&&(o=n.quadToPixelPPI(o),JS(o));const r={uid:n.uid,fileData:"application/ddv-blank-image"!==s.fileData.type?s.fileData:null,fileIndex:n.fileIndex,perspectiveQuad:o,rotation:n.rotation,filter:n.filter,mediaBox:{...n.mediaBox},cropBox:{...n.cropBox}};if(e.raw){const e=await this.imageDataService.getRaw(t);r.raw={...e}}if(e.display){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData,e.getPng);r.display={...i}}if(e.thumbnail){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData,e.getPng);r.thumbnail={...i}}return r}async setCustomData(t,e){const i=this.pageService.getPage(t);return i?(i.customData=Wd(e),!0):Promise.reject()}async getCustomData(t){const e=this.pageService.getPage(t);return e?Wd(e.customData):Promise.reject()}async updatePage(t,e){var i,n;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=this.pageService.getPage(t);if(!o)return!1;const r=Qd(),a=this.parserService.getCustomParserClasses(e.type)?e.type:await Yu(e);S_.makeSureSourcesTypeSupported(!0,[a],"data");const l=this.getSourceParseOptions({fileData:e},a),{pageCount:h}=await this.parserService.getParseInfo(e,a,r,l);if(qd(s.fileIndex)&&(s.fileIndex>=h||s.fileIndex<0))return vw.reject(vw.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.sourceStore.set(r,{fileData:e,loadOptions:l,pageCount:h}),this.fileService.addFile(r,a,h);const[c]=await this.parserService.parse(e,a,r,[s.fileIndex||0],l).catch((t=>{throw t}));c.pageUid=t,null!==(i=c.filter)&&void 0!==i||(c.filter=this.filterService.getDefaultFilterType()||"none");const d=this.annotationService.createAnnotationsByParsedPages(o.doc.uid,[c]);return this.commandService.removePageFromCommand(o.doc.uid,[t]),this.fileService.addUser(r,s.fileIndex,t),this.fileService.deleteUser(o.fileUid,o.fileIndex,t),null===(n=this.annotationService)||void 0===n||n.deleteAnnotations(o.annotations,!1),this.pageService.updatePage(t,e,{...c,...s,fileUid:r,annotations:d[0]}),!0}async updatePageInternal(t,e){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.pageService.getPage(t);if(!s)return!1;const o=Qd(),r=this.parserService.getCustomParserClasses(e.type)?e.type:await Yu(e);S_.makeSureSourcesTypeSupported(!0,[r],"data");const a=this.getSourceParseOptions({fileData:e,renderOptions:{renderAnnotations:"loadAnnotations"}},r),{pageCount:l}=await this.parserService.getParseInfo(e,r,o,a);if(qd(n.fileIndex)&&(n.fileIndex>=l||n.fileIndex<0))return vw.reject(vw.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.sourceStore.set(o,{fileData:e,loadOptions:a,pageCount:l}),this.fileService.addFile(o,r,l);const[h]=await this.parserService.parse(e,r,o,[n.fileIndex||0],a).catch((t=>{throw t}));h.pageUid=t,null!==(i=h.filter)&&void 0!==i||(h.filter=this.filterService.getDefaultFilterType()||"none"),this.annotationService.createAnnotationsByParsedPages(s.doc.uid,[h]),this.commandService.removePageFromCommand(s.doc.uid,[t]),this.fileService.addUser(o,n.fileIndex,t),this.fileService.deleteUser(s.fileUid,s.fileIndex,t);const c=this.pageService.getPage(t).annotations.slice();return this.pageService.updatePage(t,e,{...h,...n,fileUid:o,annotations:c}),!0}async getPerspectivePreviewData(t,e,i){const n=this.pageService.getPage(t),s=await this.imageDataService.getRaw(t);if(!n||!s)return null;let{quad:o}=n;o||(o=[[0,0],[s.width,0],[s.width,s.height],[0,s.height]]);const r=await this.processService.perspectivePreview(s.data,4,o,{width:s.width,height:s.height},{...e,...i});return Promise.resolve(r)}createDocument(t){return this.documentService.createDocument(t)}getDocument(t){return this.documentService.getDocument(t)}deleteDocuments(t){const{documentService:e,pageService:i}=this;if(t.map((t=>e.getDocument(t))).includes(void 0))return!1;const n=IS.create(t);e.onBeforeDeleteDocs.emit(n),t.forEach((t=>{const n=e.getDocument(t);var s;n&&(n.pages.forEach((t=>{const e=i.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t)})),null===(s=this.annotationService)||void 0===s||s.deleteAnnotationPages([...n.pages]),i.deletePages(n.pages))}));const s=e.deleteDocuments(t);return e.onAfterDeleteDocs.emit(n),s}renameDocument(t,e){this.documentService.renameDocument(t,e)}transferDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:n}=this,s=n.getDocument(t),o=n.getDocument(e);if(!s||!o)return!1;if(t===e&&!i.copy)return!i.sourceIndices||this.movePages(t,i.sourceIndices,i.insertBeforeIndex);let r=[];if(r=null!=i&&i.sourceIndices?d_(i.sourceIndices).map((t=>s.pages[t])):[...s.pages],!r.length)return!0;i.copy?r.forEach(((t,e,n)=>{const s=this.pageService.getPage(t),r=Qd();if(this.fileService.addUser(s.fileUid,s.fileIndex,r),this.pageService.copyPage(r,o,s),!1!==(null==i?void 0:i.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=s.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:o.uid,pageUid:r,uid:Qd()})));t.length&&this.annotationService.annotationApp.createAnnotations(t)}n[e]=r})):(n.removePagesFromDocument(s.uid,r),r.forEach((t=>{const e=this.pageService.getPage(t);var n;e.doc=o,!1===(null==i?void 0:i.includeAnnotations)&&(null===(n=this.annotationService)||void 0===n||n.deleteAnnotations(e.annotations),e.annotations=[])}))),n.addPagesToDocument(o.uid,r,i.insertBeforeIndex);const a=r.map((t=>o.pages.indexOf(t)));return n.onPagesAddedOut.emit(HC.create(o.uid,a,r)),!0}mergeDocuments(t,e){const{documentService:i}=this,n=i.createDocument(e);if(!t.length)return n;t=d_(t);const s=[];if(t.forEach((t=>{const e=i.getDocument(t);s.push(...e.pages)})),null!=e&&e.deleteOriginal?(i.deleteDocuments(t),s.forEach((t=>{const i=this.pageService.getPage(t);var s;i.doc=n,!1===(null==e?void 0:e.includeAnnotations)&&(null===(s=this.annotationService)||void 0===s||s.deleteAnnotations(i.annotations),i.annotations=[])}))):s.forEach(((t,i,s)=>{const o=this.pageService.getPage(t),r=Qd();if(this.fileService.addUser(o.fileUid,o.fileIndex,r),this.pageService.copyPage(r,n,o),!1!==(null==e?void 0:e.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=o.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:n.uid,pageUid:r,uid:Qd()})));t.length&&this.annotationService.annotationApp.createAnnotations(t)}s[i]=r})),s.length){i.addPagesToDocument(n.uid,s);const t=s.map((t=>n.pages.indexOf(t)));i.onPagesAddedOut.emit(HC.create(n.uid,t,s))}return n}openDocument(t,e){return this.openOrCloseDocument(t,e)}closeDocument(t,e){return this.openOrCloseDocument(t,e,!0)}openOrCloseDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.documentService.getDocument(t);if(!n||!this.viewerService.hasViewer(e))return!1;const s=this.viewerService.getViewer(e);return i?this.documentService.onCloseDocument.emit(mS.create(n,e,s.groupUid)):this.documentService.onOpenDocument.emit(fS.create(n,e,s.groupUid)),this.commandService.emitOperationsChanged(t),!0}deletePages(t,e){var i;return e=d_(e),this.commandService.removePageFromCommand(t,[...e]),e.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t)})),null===(i=this.annotationService)||void 0===i||i.deleteAnnotationPages(e),this.documentService.removePagesFromDocument(t,[...e]),this.pageService.deletePages(e),!0}deleteAllPages(t){var e;const i=this.documentService.getDocument(t),n=[...i.pages];return this.commandService.removePageFromCommand(t,n),i.pages.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t)})),null===(e=this.annotationService)||void 0===e||e.deleteAnnotationPages(i.pages),this.documentService.removeAllPagesFromDocument(t),this.pageService.deletePages(n),!0}movePages(t,e,i){return e=d_(e),this.documentService.movePages(t,e,i)}swapPages(t,e,i){return this.documentService.swapPages(t,e,i)}reorderPages(t,e){return e=d_(e),this.documentService.reorderPages(t,e)}async printPages(t,e,i){const n=this.documentService.getDocument(t);if(!n)return Promise.reject(vw.DOC_NOT_EXIST);const s=e||Array.from(Array(n.pages.length).keys()),o=[];for(let t=0;t<s.length;t++){var r;const e=await this.getPageData(n.pages[s[t]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(r=null==i?void 0:i.printAnnotation)||void 0===r||r,isGetPrintPageData:!0});o.push(e)}if(0===o.length)return Promise.reject();const a=[];return o.forEach((t=>{a.push({data:t.display.data,width:t.display.width,height:t.display.height})})),function(t){let e="",i=0,n=0;t.forEach(((t,s)=>{let o=1120,r=850;const a=r/t.width,l=o/t.height;a<l?o=Math.floor(t.height*a):a>l&&(r=Math.floor(t.width*l)),e+=`<div class="imageContainer"><img id="DDV_Image${s}" src='${tu(t.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,i+=r,n+=o}));const s=`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${i}, height=${n}`,o=window.open("about:blank","_blank",s),r=`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                object-fit: contain;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${e}</body></html>`;if(o){o.document.write(r),o.document.close(),o.focus();const t=o.document.getElementById("DDV_body");t&&(t.onload=()=>{o&&o.print()})}}(a),!0}setDetectHandler(t,e){this.onSetExternalHandler.emit(C_.create("detect")),this.detectorService.setDetector(e)}setImageFilterHandler(t){this.onSetExternalHandler.emit(C_.create("filter")),this.filterService.setImageFilter(t)}clearExternalHandler(t){if(Zd(t))switch(t){case"documentBoundariesDetect":this.setDetectHandler(t,null);break;case"imageFilter":this.setImageFilterHandler(null)}}unload(){var t;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(t=this.annotationService)||void 0===t||t.reset(),ub.reset(),np.unload()}preloadModule(t){np.preloadModule(t)}async perspectivePage(t,e,i){let n,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.pageService.getPage(e);if(o.setQuad(i)){if(this.annotationService.deleteAnnotations(o.annotations),this.commandService.removePageFromCommand(t,[e]),o.quad){const{width:t,height:e}=XS(o.quad);o.original.updateImageDetail({width:t,height:e}),o.display.updateImageDetail({width:t,height:e})}this.imageLoadService.cancelLoadOriginalImage(e),o.original.reset(),s||(n=await this.imageDataService.getOriginal(e)),this.imageLoadService.cancelLoadDisplayImage(e),this.imageLoadService.cancelLoadThumbnailImage(e),o.display.reset(),o.thumbnail.reset();let{width:r,height:a}=o.original.getPageSize();o.isFull?(o.mediaBox={...o.initState.mediaBox},o.cropBox={...o.initState.cropBox}):(s&&({width:r,height:a}=XS(o.quad)),o.mediaBox={left:0,top:0,width:r,height:a},o.cropBox={...o.mediaBox}),this.onAfterPerspective.emit(PS.create(o.doc.uid,e,i,r,a))}return s?null:n||this.imageDataService.getOriginal(e)}async filterPages(t,e,i){e.forEach((t=>{const e=this.pageService.getPage(t);e.filter!==i&&(e.filter=i,e.display.reset(),e.thumbnail.reset())}));const n=wS.create(t,e,i);return this.onFilterChanged.emit(n),!0}insertBlankPage(t,e,i,n,s,o){const r=this.documentService.getDocument(t);if(!r)return"";this.onBeforeLoadSource.emit({docUid:t});const a=Qd(),l={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=e?e:816,height:null!=i?i:1056,resolutionX:null!=n?n:96,resolutionY:null!=s?s:96},h=this.getSourceParseOptions(l,"application/ddv-blank-image");this.sourceStore.set(a,{fileData:l.fileData,loadOptions:h,pageCount:1}),this.fileService.addFile(a,"application/ddv-blank-image",1),this.parserService.parse(l.fileData,"application/ddv-blank-image",a,[0],h);const{displayResolution:c}=Ep,d=Qd();this.fileService.addUser(a,0,d);const u={resource:{data:l.fileData,width:l.width,height:l.height,resolutionX:l.resolutionX,resolutionY:l.resolutionY},mediaBox:{left:0,top:0,width:l.width/l.resolutionX*c,height:l.height/l.resolutionY*c},cropBox:{left:0,top:0,width:l.width/l.resolutionX*c,height:l.height/l.resolutionY*c},annotations:[],fileIndex:0,pageUid:d,fileUid:a};return this.pageService.createPage(u,r),this.annotationService.createAnnotationsByParsedPages(t,[u]),this.documentService.addPagesToDocument(t,[d],o),this.onAfterLoadSource.emit(HC.create(t,[r.pages.indexOf(d)],[d])),this.documentService.onPagesAddedOut.emit(HC.create(t,[r.pages.indexOf(d)],[d])),d}async getPageSourceInfo(t){const e=this.pageService.getPage(t),i={};i.bitDepth=e.resource.bitDepth,i.resolutionX=e.resource.resolutionX,i.resolutionY=e.resource.resolutionY;const n=await this.sourceStore.get(e.fileUid);if("application/pdf"!==n.fileData.type)return i.pageContentType=n.fileData.type,i;if(e.pdfOptions&&e.pdfOptions.pageContentType)return i.pageContentType=e.pdfOptions.pageContentType,i;const s=new bp;try{const t=await s.getPdfPageContentType({fileSource:n.fileData,password:n.loadOptions.password},e.fileIndex);return e.pdfOptions&&(e.pdfOptions.pageContentType=t),i.pageContentType=t,i}finally{s.destroy()}}};function P_(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:i,style:n,id:s,className:o,children:r}=t,a=document.createElement(i);return s&&(a.id=s+e),o&&(a.className=o),n&&function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Zd(e))t.style.cssText=e;else if(i){let i="";Object.keys(e).forEach((t=>{i+=`${t}:${e[t]};`})),t.style.cssText=i}else Object.keys(e).forEach((i=>{t.style[i]=e[i]}))}(a,n),r&&r.forEach((t=>{const i=P_(t,e);a.appendChild(i)})),a}function A_(t){t&&(t.style.display="none")}function I_(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.style.display=e)}const D_=t=>parseFloat(Number(t).toFixed(4));class k_ extends Ju{constructor(){super(),na(this,"uid",void 0),na(this,"type",void 0),na(this,"action",void 0),na(this,"isValid",void 0),this.isValid=!0,this.uid=Qd()}execute(){return null}undo(){return null}}new class extends Ju{constructor(){super(...arguments),na(this,"docCreated",tp(this)),na(this,"docDeleted",tp(this)),na(this,"pageAdded",tp(this)),na(this,"pageDeleted",tp(this)),na(this,"annotationCreated",tp(this)),na(this,"annotationDeleted",tp(this)),na(this,"annotationUpdated",tp(this)),na(this,"replyToAnnotation",tp(this)),na(this,"commentDeleted",tp(this)),na(this,"commentUpdated",tp(this))}};class R_ extends $p{static create(t){return new R_(t,t.uid)}constructor(t,e){super(e),na(this,"type",void 0),na(this,"docUid",void 0),na(this,"pageUid",void 0),na(this,"style",void 0),na(this,"transform",void 0),na(this,"flags",void 0),na(this,"comment",void 0),na(this,"layer",void 0),na(this,"creationDate",void 0),na(this,"modified",!1),na(this,"flattened",!1),na(this,"oriIndex",void 0),this.type=t.type,this.docUid=t.docUid,this.pageUid=t.pageUid,this.style=t.style,this.flags=t.flags||["print"],this.transform=t.transform,this.oriIndex=t.oriIndex,Hd(null==t?void 0:t.modified)||(this.modified=t.modified)}getConfig(){return{uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:Wd(this.style),transform:Wd(this.transform),flags:Wd(this.flags),comment:Wd(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(t,e){const i=R_.create({docUid:this.docUid,pageUid:t,type:this.type,style:Wd(this.style),transform:Wd(this.transform),flags:this.flags.slice(),comment:this.comment}),n=this.comment.clone(i.uid,e);return i.comment=n,i.layer=this.layer,i}updateStyle(t){Object.assign(this.style,t)}updateComment(t){this.comment.updateComment(t)}addReplies(t){this.comment.replies.push(...t)}deleteReplies(t){const e=this.comment.replies;t.forEach((t=>{if(e.includes(t)){const i=e.findIndex((e=>e.uid===t.uid));e.splice(i,1)}}))}updateReply(t){const e=this.comment.replies.findIndex((e=>e.uid===t.uid));this.comment.replies[e]=t}getAllReplies(){return[...this.comment.replies]}deleteReplyReviewSate(t){const e=this.comment.getReply(t);e&&e.deleteReviewState()}setReplyReviewState(t,e){const i=this.comment.getReply(t);i&&i.setReviewState(e)}deleteReplyMarkedSate(t){const e=this.comment.getReply(t);e&&e.deleteMarkedState()}setReplyMarkedState(t,e){const i=this.comment.getReply(t);i&&i.setMarkedState(e)}}class M_{static create(t){return new M_(t)}constructor(t){na(this,"uid",void 0),na(this,"author",void 0),na(this,"contents",void 0),na(this,"creationDate",void 0),na(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state}}class L_{static create(t){return new L_(t)}constructor(t){na(this,"uid",void 0),na(this,"author",void 0),na(this,"contents",void 0),na(this,"creationDate",void 0),na(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state}}class O_ extends Yp{static create(t,e){return new O_(t,e)}constructor(t,e){var i,n;super(e),na(this,"annotationUid",void 0),na(this,"author",void 0),na(this,"subject",void 0),na(this,"contents",void 0),na(this,"creationDate",void 0),na(this,"modificationDate",void 0),na(this,"markedStates",void 0),na(this,"reviewStates",void 0),this.annotationUid=t.annotationUid,this.author=t.author,this.subject=t.subject,this.contents=t.contents,this.creationDate=t.creationDate,this.modificationDate=t.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(i=t.markedStates)&&void 0!==i&&i.length&&t.markedStates.forEach((t=>{const e=L_.create(t);this.markedStates.push(e)})),null!==(n=t.reviewStates)&&void 0!==n&&n.length&&t.reviewStates.forEach((t=>{const e=M_.create(t);this.reviewStates.push(e)}))}updateReply(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}setMarkedState(t){const e=this.markedStates.length,i=this.markedStates[e-1];if((null==i?void 0:i.state)!==t.state||!i&&"marked"===t.state){const e=L_.create(t);return this.markedStates.push(e),!0}return!1}deleteMarkedState(){this.markedStates.pop()}setReviewState(t){const e=M_.create(t);this.reviewStates.push(e)}deleteReviewState(){this.reviewStates.pop()}clone(t,e){const i=O_.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),i}cloneStates(t){this.markedStates.forEach((e=>{const i=L_.create({...e,uid:Qd()});t.markedStates.push(i)})),this.reviewStates.forEach((e=>{const i=M_.create({...e,uid:Qd()});t.reviewStates.push(i)}))}}class B_ extends O_{static create(t,e){return new B_(t,e)}constructor(t,e){super(t,e),na(this,"replies",void 0),this.replies=[]}updateComment(t){Object.assign(this,t)}getReply(t){return this.replies.find((e=>e.uid===t.uid))}clone(t,e){const i=B_.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),this.replies.forEach((n=>{i.replies.push(n.clone(t,e))})),i}}class F_ extends Yp{static create(t){return new F_(t)}constructor(t){super(t),na(this,"bottom",void 0),na(this,"top",void 0),na(this,"annotations",void 0),na(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[]}clone(t){const e=F_.create(t);return e.top=this.top,e.bottom=this.bottom,e.annotations=this.annotations.slice(),e.layers=Wd(this.layers),e}createTop(){const{top:t}=this;return this.top+=1,t}addAnnotation(t,e){if(!this.annotations.includes(t)){this.annotations.push(t);const i={annotationUid:t,layer:e};return this.layers.push(i),Hd(e)?(i.layer=this.top,this.top+=1):this.sortLayers(),i}return null}sortLayers(){this.layers.sort(((t,e)=>t.layer-e.layer))}deleteAnnotations(t){t.forEach((t=>{const e=this.annotations.indexOf(t);e>-1&&this.annotations.splice(e,1);const i=this.layers.findIndex((e=>e.annotationUid===t));i>-1&&this.layers.splice(i,1)}))}moveAnnotation(t){const e=this.annotations.indexOf(t);if(e<0)return null;const i=this.layers.findIndex((e=>e.annotationUid===t));if(i<0)return null;const n={annotationUid:t,index:e,layerIndex:i,layer:this.layers[i].layer};return this.deleteAnnotations([t]),n}undoMoveAnnotation(t){const{annotationUid:e}=t;this.annotations.includes(e)||this.layers.find((t=>t.annotationUid===e))||(this.annotations.splice(t.index,0,e),this.layers.splice(t.layerIndex,0,{annotationUid:e,layer:t.layer}))}bringForward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],n=this.layers[e+1];return n&&(this.switchLayer(i,n),this.sortLayers()),{curLayer:i,forward:n}}switchLayer(t,e){const i=t.layer;t.layer=e.layer,e.layer=i}sendBackward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],n=this.layers[e-1];return n&&(this.switchLayer(i,n),this.sortLayers()),{curLayer:i,backward:n}}bringToFront(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e<this.layers.length-1&&(i.layer=this.top,this.top+=1,this.sortLayers()),i}sendToBack(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e>0&&(i.layer=this.bottom,this.bottom-=1,this.sortLayers()),i}restoreLayer(t,e){const i=this.layers.findIndex((e=>e.annotationUid===t));return i<0?null:(this.layers[i].layer=e,this.sortLayers(),!0)}getLayerState(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return{back:!1,front:!1,forward:!1,backward:!1};const i={back:!0,front:!0,forward:!0,backward:!0};return 0===e&&(i.back=!1,i.backward=!1),e===this.layers.length-1&&(i.front=!1,i.forward=!1),1===this.layers.length&&(i.front=!1,i.forward=!1,i.back=!1,i.backward=!1),i}getAnnotationUidListByLayer(){return this.layers.slice().sort(((t,e)=>t.layer-e.layer)).map((t=>t.annotationUid))}}const N_=new class{constructor(){na(this,"db",void 0),this.db=new Map}findAnnotationByUid(t){return this.db.get(t)}deleteAnnotation(t){return!!this.db.has(t.uid)&&(this.db.delete(t.uid),!0)}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t)}clear(){this.db.clear()}},U_=new class{constructor(){na(this,"db",void 0),this.db=new Map}findCommentByUid(t){return this.db.get(t)}deleteComment(t){this.db.has(t.uid)&&this.db.delete(t.uid)}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t)}clear(){this.db.clear()}},V_=new class{constructor(){na(this,"db",void 0),this.db=new Map}findPageByUid(t){return this.db.get(t)}deletePagesByUids(t){t.forEach((t=>{this.db.delete(t)}))}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t)}clear(){this.db.clear()}},W_=new class extends Ju{constructor(){super(...arguments),na(this,"annotationCreated",tp(this)),na(this,"annotationDeleted",tp(this)),na(this,"annotationUpdated",tp(this)),na(this,"commentDeleted",tp(this)),na(this,"commentUpdated",tp(this)),na(this,"replyToAnnotation",tp(this)),na(this,"replyDeleted",tp(this)),na(this,"replyUpdated",tp(this)),na(this,"setReplyReviewState",tp(this)),na(this,"deleteReplyReviewState",tp(this)),na(this,"bringFroward",tp(this)),na(this,"sendBackward",tp(this)),na(this,"bringToFront",tp(this)),na(this,"sendToBack",tp(this)),na(this,"restoreLayer",tp(this)),na(this,"annotationPageSwitched",tp(this))}};class H_ extends Xp{static create(t){return new H_(t)}constructor(t){super("annotationCreatedDomainEvent"),na(this,"annotations",void 0),this.annotations=t}}const j_=new class{constructor(t,e,i,n){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"annotationPageRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.annotationPageRepo=i,this.eventHooks=n}execute(t){const e=t.map((t=>{const e=R_.create({...t}),i=this.annotationPageRepo.findPageByUid(e.pageUid).addAnnotation(e.uid,t.layer);if(i&&(e.layer=i.layer),this.annotationRepo.save(e),t.comment){var n;const i=B_.create(t.comment);e.comment=i,null!==(n=t.comment.replies)&&void 0!==n&&n.length&&t.comment.replies.forEach((t=>{const e=O_.create(t);i.replies.push(e),this.replyRepo.save(e)}))}return Hd(null==t?void 0:t.flattened)||(e.flattened=t.flattened),e})),i=H_.create(e);return this.eventHooks.annotationCreated.emit(i),e}}(N_,U_,V_,W_);class z_ extends Xp{static create(t,e){return new z_(t,e)}constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),na(this,"annotations",void 0),na(this,"emitEvent",void 0),this.annotations=t,this.emitEvent=e}}const G_=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"annotationPageRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=i}execute(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const e of t)if(!this.annotationRepo.has(e))return!1;t.forEach((t=>{this.annotationRepo.deleteAnnotation(t),this.annotationPageRepo.findPageByUid(t.pageUid).deleteAnnotations([t.uid])}));const i=z_.create(t,e);return this.eventHooks.annotationDeleted.emit(i),!0}}(N_,V_,W_),Y_=new class{constructor(t){na(this,"annotationRepo",void 0),this.annotationRepo=t}execute(t){return this.annotationRepo.findAnnotationByUid(t)}}(N_);class $_ extends Xp{static create(t){return new $_(t)}constructor(t){super("replyToAnnotationDomainEvent"),na(this,"reply",void 0),this.reply=t}}const X_=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid),i=O_.create({annotationUid:t.annotationUid,author:t.author,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,subject:""});e.addReplies([i]),this.replyRepo.save(i);const n=$_.create(i);return this.eventHooks.replyToAnnotation.emit(n),!0}}(N_,U_,W_);class q_ extends Xp{static create(t,e,i){return new q_(t,e,i)}constructor(t,e,i){super("annotationUpdatedDomainEvent"),na(this,"updateDetails",void 0),na(this,"updatedBy",void 0),na(this,"updateActions",void 0),this.updateDetails=t,this.updatedBy=e,this.updateActions=i}}const Z_=new class{constructor(t,e){na(this,"annotationRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e}execute(t){const e=[],i=t.updateDetails.map((t=>{const i=this.annotationRepo.findAnnotationByUid(t.uid);if(!i)return null;const n=i.getConfig();t.style&&i.updateStyle(t.style),t.transform&&ju(t.transform,i.transform),t.flags&&(i.flags=[...t.flags]),Hd(t.flattened)||(i.flattened=t.flattened),Hd(t.layer)||(i.layer=t.layer),i.modified=t.modified,t.comment&&Object.assign(i.comment,t.comment),this.annotationRepo.save(i);const s=i.getConfig();return e.push({annotationUid:i.uid,from:n,to:s}),i})),n=q_.create(e,t.updatedBy,t.updateActions);return this.eventHooks.annotationUpdated.emit(n),i}}(N_,W_);class J_ extends Xp{static create(t){return new J_(t)}constructor(t){super("replyUpdatedDomainEvent"),na(this,"reply",void 0),this.reply=t}}const K_=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return!1;const i=this.replyRepo.findCommentByUid(t.replyUid);if(!i)return!1;i.updateReply({author:t.author,contents:t.contents,modifiedDate:t.modifiedDate}),e.updateReply(i),this.annotationRepo.save(e),this.replyRepo.save(i);const n=J_.create(i);return this.eventHooks.replyUpdated.emit(n),!0}}(N_,U_,W_);class Q_ extends Xp{static create(t){return new Q_(t)}constructor(t){super("replyDeletedDomainEvent"),na(this,"reply",void 0),this.reply=t}}const tT=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i}execute(t){if(!this.replyRepo.has(t))return!1;const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return!1;e.deleteReplies([t]),this.replyRepo.deleteComment(t);const i=Q_.create(t);return this.eventHooks.replyDeleted.emit(i),!0}}(N_,U_,W_);class eT extends Xp{static create(t,e,i){return new eT(t,e,i)}constructor(t,e,i){super("bringToFrontDomainEvent"),na(this,"annotationUid",void 0),na(this,"from",void 0),na(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i}}const iT=new class{constructor(t,e,i){na(this,"annotRepo",void 0),na(this,"annotPageRepo",void 0),na(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return!1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.bringToFront(t);if(!s)return!1;e.layer=s.layer;const o=i.getAnnotationUidListByLayer(),r=eT.create(t,n,o);return this.eventHooks.bringToFront.emit(r),!0}}(N_,V_,W_);class nT extends Xp{static create(t,e,i){return new nT(t,e,i)}constructor(t,e,i){super("sendToBackDomainEvent"),na(this,"annotationUid",void 0),na(this,"from",void 0),na(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i}}const sT=new class{constructor(t,e,i){na(this,"annotRepo",void 0),na(this,"annotPageRepo",void 0),na(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return!1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.sendToBack(t);if(!s)return!1;e.layer=s.layer;const o=i.getAnnotationUidListByLayer(),r=nT.create(t,n,o);return this.eventHooks.sendToBack.emit(r),!0}}(N_,V_,W_);class oT extends Xp{static create(t,e,i,n){return new oT(t,e,i,n)}constructor(t,e,i,n){super("bringForwardDomainEvent"),na(this,"annotationUid",void 0),na(this,"forwardUid",void 0),na(this,"from",void 0),na(this,"to",void 0),this.annotationUid=t,this.forwardUid=e,this.from=i,this.to=n}}const rT=new class{constructor(t,e,i){na(this,"annotRepo",void 0),na(this,"annotPageRepo",void 0),na(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return!1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.bringForward(t);if(!s)return!1;const{curLayer:o,forward:r}=s;e.layer=o.layer,r&&(this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer);const a=i.getAnnotationUidListByLayer(),l=oT.create(t,null==r?void 0:r.annotationUid,n,a);return this.eventHooks.bringFroward.emit(l),!0}}(N_,V_,W_);class aT extends Xp{static create(t,e,i,n){return new aT(t,e,i,n)}constructor(t,e,i,n){super("sendBackwardDomainEvent"),na(this,"annotationUid",void 0),na(this,"backwardUid",void 0),na(this,"from",void 0),na(this,"to",void 0),this.annotationUid=t,this.backwardUid=e,this.from=i,this.to=n}}const lT=new class{constructor(t,e,i){na(this,"annotRepo",void 0),na(this,"annotPageRepo",void 0),na(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return!1;const i=this.annotPageRepo.findPageByUid(e.pageUid),n=i.getAnnotationUidListByLayer(),s=i.sendBackward(t);if(!s)return!1;const{curLayer:o,backward:r}=s;e.layer=o.layer,r&&(this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer);const a=i.getAnnotationUidListByLayer(),l=aT.create(t,null==r?void 0:r.annotationUid,n,a);return this.eventHooks.sendBackward.emit(l),!0}}(N_,V_,W_);class hT extends Xp{static create(t){return new hT(t)}constructor(t){super("commentUpdatedDomainEvent"),na(this,"comment",void 0),this.comment=t}}const cT=new class{constructor(t,e){na(this,"annotationRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return!1;e.updateComment(t);const i=hT.create(e.comment);return this.eventHooks.commentUpdated.emit(i),!0}}(N_,W_);class dT extends Xp{static create(t){return new dT(t)}constructor(t){super("deleteReplyReviewStateDomainEvent"),na(this,"replyUid",void 0),this.replyUid=t}}const uT=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i}execute(t){const e=this.replyRepo.findCommentByUid(t);if(!e)return!1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return!1;i.deleteReplyReviewSate(e),this.annotationRepo.save(i);const n=dT.create(t);return this.eventHooks.deleteReplyReviewState.emit(n),!0}}(N_,U_,W_);class pT extends Xp{static create(t){return new pT(t)}constructor(t){super("setReplyReviewStateDomainEvent"),na(this,"author",void 0),na(this,"creationDate",void 0),na(this,"contents",void 0),na(this,"state",void 0),na(this,"replyUid",void 0),this.author=t.author,this.creationDate=t.creationDate,this.contents=t.contents,this.state=t.state,this.replyUid=t.replyUid}}const gT=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i}execute(t){const e=this.replyRepo.findCommentByUid(t.replyUid);if(!e)return!1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return!1;i.setReplyReviewState(e,t),this.annotationRepo.save(i);const n=pT.create(t);return this.eventHooks.setReplyReviewState.emit(n),!0}}(N_,U_,W_),fT=new class{constructor(t){na(this,"annotationPageRepo",void 0),this.annotationPageRepo=t}execute(t){let e=this.annotationPageRepo.findPageByUid(t);return e||(e=F_.create(t),this.annotationPageRepo.save(e)),e}}(V_),mT=new class{constructor(t,e,i){na(this,"annotationPageRepo",void 0),na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=i}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=e.clone(t.newPageUid),n=new Map;return e.annotations.forEach(((e,s)=>{const o=this.annotationRepo.findAnnotationByUid(e).clone(t.newPageUid,"");o.comment.replies.forEach((t=>{this.replyRepo.save(t)})),this.annotationRepo.save(o),i.annotations[s]=o.uid,n.set(e,o.uid)})),i.layers.forEach((t=>{t.annotationUid=n.get(t.annotationUid)})),this.annotationPageRepo.save(i),i}}(V_,N_,U_),vT=new class{constructor(t){na(this,"annotationPageRepo",void 0),this.annotationPageRepo=t}execute(t){this.annotationPageRepo.deletePagesByUids(t)}}(V_),yT=new class{constructor(t,e,i){na(this,"annotationPageRepo",void 0),na(this,"annotationRepo",void 0),na(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=i}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!i)return null;const n=i.clone(t.pageUid," ");return n.comment.replies.forEach((t=>{this.replyRepo.save(t)})),e.addAnnotation(n.uid),this.annotationRepo.save(n),n}}(V_,N_,U_);class xT extends Xp{static create(t,e,i){return new xT(t,Wd(e),Wd(i))}constructor(t,e,i){super("annotationPageSwitchedDomainEvent"),na(this,"annotationUid",void 0),na(this,"from",void 0),na(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i}}const wT=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"annotationPageRepo",void 0),na(this,"eventHook",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHook=i}execute(t){const{annotationUid:e,pageUid:i,x:n,y:s,layer:o}=t,r=this.annotationRepo.findAnnotationByUid(e);if(!r)return!1;const a=this.annotationPageRepo.findPageByUid(r.pageUid);if(!a)return!1;const l=this.annotationPageRepo.findPageByUid(i);if(!l)return!1;const h={pageUid:r.pageUid,x:r.style.x,y:r.style.y,layer:r.layer};a.deleteAnnotations([e]),l.addAnnotation(e,o),r.updateStyle({x:n,y:s}),r.layer=o,r.pageUid=i;const c=xT.create(r.uid,h,{pageUid:i,x:n,y:s,layer:o});return this.eventHook.annotationPageSwitched.emit(c),!0}}(N_,V_,W_);class bT extends Xp{static create(t,e){return new bT(t,e)}constructor(t,e){super("restoreLayerDomainEvent"),na(this,"annotationUid",void 0),na(this,"layer",void 0),this.annotationUid=t,this.layer=e}}const CT=new class{constructor(t,e,i){na(this,"annotationRepo",void 0),na(this,"annotationPageRepo",void 0),na(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=i}execute(t){let{annotationUid:e,layer:i}=t;const n=this.annotationRepo.findAnnotationByUid(e);if(!n)return!1;this.annotationPageRepo.findPageByUid(n.pageUid).restoreLayer(e,i),n.layer=i;const s=bT.create(e,i);return this.eventHooks.restoreLayer.emit(s),!0}}(N_,V_,W_),ST=new class{constructor(t,e){na(this,"annotationPageRepo",void 0),na(this,"annotationRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e}execute(t){let e={back:!1,front:!1,forward:!1,backward:!1};const i=this.annotationRepo.findAnnotationByUid(t);if(!i)return e;const n=this.annotationPageRepo.findPageByUid(i.pageUid);return n?(e=n.getLayerState(t),e):e}}(V_,N_);class _T extends Ju{constructor(){super(),na(this,"annotationRepo",N_),na(this,"annotationReplyRepo",U_),na(this,"annotationPageRepo",V_),na(this,"hooks",W_),this.register(W_)}dispose(){this.reset(),this.hooks.dispose(),super.dispose()}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear()}createAnnotationPage(t){return fT.execute(t)}copyAnnotationPage(t,e){return mT.execute({pageUid:t,newPageUid:e})}deleteAnnotationPage(t){return vT.execute(t)}createAnnotations(t){return j_.execute(t)}copyAnnotation(t,e){return yT.execute({annotationUid:t,pageUid:e})}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t.map((t=>(Zd(t)&&(t=N_.findAnnotationByUid(t)),t)));return G_.execute(i,e)}updateAnnotation(t){return Z_.execute(t)}switchAnnotationPage(t,e){return wT.execute({annotationUid:Vd(t)?t.uid:t,...e})}getAnnotationByUid(t){return Y_.execute(t)}getAnnotationLayerState(t){return ST.execute(t)}replyToAnnotation(t){return X_.execute(t)}deleteReply(t){return Zd(t)&&(t=U_.findCommentByUid(t)),tT.execute(t)}updateReply(t){return K_.execute(t)}updateComment(t){return cT.execute(t)}deleteReplyReviewState(t){return uT.execute(t)}setReplyReviewState(t){return gT.execute(t)}bringToFront(t){return iT.execute(t)}sendToBack(t){return sT.execute(t)}bringForward(t){return rT.execute(t)}sendBackward(t){return lT.execute(t)}restoreLayer(t,e){return CT.execute({annotationUid:t,layer:e})}}const TT=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle","enableMoveWithKeyboard","enableDeleteWithKeyboard","enableMultipleSelectWidthCtrl"];class ET extends Ju{constructor(t){super(),na(this,"context",void 0),this.context=t}updateConfig(t){for(const[e,i]of Object.entries(t))TT.includes(e)&&this[e](i)}defaultStyleConfig(t){if(!Vd(t))return;const{annotationController:e}=this.context,{viewer:i}=this.context;e.setAnnotationInteractiveConfig({defaultStyleConfig:t}),e.updateFreeTextDefaultConfig(),i.hooks.annotationDefaultStyleChanged.emit(i.getAnnotationConfig().defaultStyleConfig),i.emit("annotationDefaultStyleChanged",i.getAnnotationConfig().defaultStyleConfig)}enableContinuousDrawing(t){const{annotationController:e}=this.context;e.interactiveConfig.enableContinuousDrawing=t}enableMoveWithKeyboard(t){const{annotationController:e}=this.context;e.interactiveConfig.enableMoveWithKeyboard=t}enableDeleteWithKeyboard(t){const{annotationController:e}=this.context;e.interactiveConfig.enableDeleteWithKeyboard=t}enableMultipleSelectWidthCtrl(t){const{annotationController:e}=this.context;e.interactiveConfig.enableMultipleSelectWidthCtrl=t}controlsStyle(t){if(!Vd(t))return;const{annotationController:e}=this.context;e.setAnnotationInteractiveConfig({controlsStyle:t})}inkCreateDelay(t){const{annotationController:e}=this.context;e.interactiveConfig.inkCreateDelay=t}showOnTopWhenSelected(t){const{annotationController:e}=this.context;e.interactiveConfig.showOnTopWhenSelected=t}}const PT={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},AT={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class IT extends Ju{constructor(t){super(),na(this,"viewer",void 0),na(this,"annotationConfigService",void 0),na(this,"annotationController",void 0),na(this,"context",void 0),this.viewer=t,this.context=t.context,this.annotationConfigService=new ET(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation()}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new my).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new Qv(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on((t=>{const e=new Set(t.shapes.map((t=>t.uid)));this.context.core.annotationService.deleteAnnotations([...e])}),this),this.annotationController.hooks.selectAnnotation.on((t=>{const e=QC.create(t.oldAnnotationsUids,t.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(e),t.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...t.newAnnotationUids],oldAnnotationUids:[...t.oldAnnotationsUids]})}),this),this.annotationController.hooks.modifyAnnotation.on((t=>{const e=t.shapes.map((t=>{const e=t.shape.getAnnotationConfig();return{annotationUid:t.uid,options:{transform:Wd(e.transform),style:e.style}}}));this.context.core.annotationService.updateAnnotations(e,this.context.uid,t.actions)}),this),this.annotationController.hooks.addAnnotation.on((t=>{const e=this.context.getActiveTab();if(!e)return;const{annotationService:i}=this.context.core;t.shapes.forEach((t=>{const n=t.shape.getAnnotationConfig(),s=BS(),o=i.createAnnotation(e.uid,{uid:t.uid,docUid:e.uid,pageUid:t.shape.pageUid,type:AT[n.type],transform:Wd(n.transform),style:Wd(n.style),flags:["print"],comment:{annotationUid:t.uid,author:"",subject:"",contents:"",creationDate:s,modificationDate:s,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(t.uid,o.layer)}))}),this),this.annotationController.hooks.annotationModeChanged.on((t=>{"none"===t&&"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"})})),this.annotationController.hooks.beforeAnnotationEdit.on((t=>{this.viewer.hooks.beforeAnnotationEdit.emit(t)})),this.annotationController.hooks.afterAnnotationEdit.on((t=>{this.viewer.hooks.afterAnnotationEdit.emit(t)})),this.annotationController.hooks.beforeAnnotationDraw.on((t=>{this.viewer.hooks.beforeAnnotationDraw.emit(t)})),this.annotationController.hooks.afterAnnotationDraw.on((t=>{this.viewer.hooks.afterAnnotationDraw.emit(t)})),this.annotationController.hooks.renderAnnotation.on((()=>{this.context.render()})),this.annotationController.hooks.selectAnnotationTextChars.on((t=>{this.viewer.hooks.annotationTextCharsSelected.emit(t)})),this.annotationController.hooks.annotationTextContentUpdated.on((t=>{this.viewer.hooks.annotationTextContentUpdated.emit(t)})))}listenViewerNativeEventsForAnnotation(){const t=this.context.rendererService.getCanvasDom();Qu(t,Xd()?"click":"pointerup",this).on((t=>{t.preventDefault(),this.annotationController.clickHandler(t)})),Qu(t,"dblclick",this).on((t=>{this.annotationController.dblClickHandler(t)}))}listenViewerEventsForAnnotation(){const{context:t,context:{hooks:e,tabService:i}}=this;(t.isDefaultViewer||t.isThumbnailViewer)&&(e.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null)})),e.toolModeChanged.on((e=>{const{annotationMode:i}=t.viewerConfig;if("annotation"!==e.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===e.newToolMode&&this.selectAnnotations([]);else{let t="draw";"select"===i?t="select":"erase"===i&&(t="erase"),this.annotationController.setAnnotationMode(t)}}),this),e.annotationModeChanged.on((e=>{const{toolMode:i}=t.viewerConfig;if("select"===e.newAnnotationMode||"erase"===e.newAnnotationMode){const t=e.newAnnotationMode;"annotation"===i&&this.annotationController.setAnnotationMode(t)}else{const t=PT[e.newAnnotationMode];this.annotationController.drawType=t,"annotation"===i&&this.annotationController.setAnnotationMode("draw")}}),this),e.addPagesToDoc.on((t=>{i.getTab(t.docUid)&&this.addAnnotationByPageUids(t.pageUids)}),this),e.openDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages))}),this),e.closeDocument.on((t=>{t.pages.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1)}))}),this),e.deletePages.on((t=>{t.pageUids.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1)}))}),this),e.syncDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages))}),this),e.afterRender.on((e=>{if(null==e||!e.total)return;const i=t.annotationEditService.containerPage;if(!i)return;if(!e.getPageByUid(i.uid))return;let{x:n,y:s}=i.cropBox.getPosition(),{width:o,height:r}=i.cropBox;const a=(i.rotation%360+360)%360/90;if(1===a?n-=r:2===a?(n-=o,s-=r):3===a&&(s-=o),1===a||3===a){const t=o;o=r,r=t}this.annotationController.eventService.setEventArea({x:n,y:s,width:o,height:r})}),this))}disableTextEditMode(){const{eventService:t}=this.annotationController;null!=t&&t.activatedShape&&(null==t?void 0:t.activatedShape)instanceof gv&&null!=t&&t.activatedShape.isEditMode&&(null==t||t.activatedShape.textEditEventHandler.disableEditMode(),this.context.render())}addAnnotationByPageUids(t){t.forEach((t=>{const e=this.context.core.pageService.getPage(t);if(e.annotations.forEach((t=>{const e=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);this.addAnnotationByAnnotationData(e)})),0===e.annotations.length){const t=this.context.tabService.getTab(e.doc.uid);if(!t)return;const i=t.getPageByUid(e.uid);if(!i)return;this.annotationController.setAnnotationContainer(e.uid,i.mediaBox)}}))}addAnnotationByAnnotationData(t){if("unknown"===t.type)return!0;const e=this.context.core.pageService.getPage(t.pageUid);if(!e)return!1;const i=this.context.tabService.getTab(e.doc.uid);if(!i)return!1;const n=i.getPageByUid(t.pageUid);if(!n)return!1;let s=t.getConfig();this.annotationController.setAnnotationContainer(t.pageUid,n.mediaBox);const o=this.annotationController.addShape(PT[t.type],{id:t.uid,style:{...s.style,zIndex:t.layer},transform:s.transform},!1);s=t.getConfig();const r={enableControl:!s.flags.includes("readOnly")&&!s.flags.includes("flattened"),isVisible:!s.flags.includes("noView"),enableEdit:!s.flags.includes("noResize"),enableRotate:!s.flags.includes("noRotate"),enableMove:!s.flags.includes("noMove")};if(o instanceof gv&&"freeTextWriter"===o.textType){r.enableEdit=!1,r.enableRotate=!1;const e=o.getAnnotationConfig();t.style.width=e.style.width}if(o.context.isInGroup&&(r.enableRotate=!1),this.annotationController.setAnnotationFlags(t.uid,r,!1),o instanceof Mv&&"base"===o.stampType||o instanceof cv){const e=o.getAnnotationConfig();t.transform.position=e.transform.position,t.transform.scale=e.transform.scale,t.style=e.style}return this.syncAnnotationLayerState(),!0}updateAnnotations(t,e){if(e===this.context.uid)return!0;const i=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const n=this.context.core.pageService.getPage(i.pageUid);if(n&&this.context.tabService.getTab(n.doc.uid)){const n=i.getConfig();t.push({annotationUid:e,config:n}),this.viewer.context.core.annotationService.annotationApp.restoreLayer(e,i.layer)}}return t}),[]);return i.length===t.length&&(i.forEach((t=>{var e,i;let{annotationUid:n,config:s}=t;const o=this.annotationController.getShape(n),r={enableControl:!s.flags.includes("readOnly")&&!s.flags.includes("flattened"),isVisible:!s.flags.includes("noView"),enableEdit:!s.flags.includes("noResize"),enableRotate:!s.flags.includes("noRotate"),enableMove:!s.flags.includes("noMove")};if(o&&(o instanceof gv&&"freeTextWriter"===o.textType&&(r.enableEdit=!1,r.enableRotate=!1),o.context.isInGroup&&(o.context.tempData.enableRotate=r.enableRotate,r.enableRotate=!1)),this.annotationController.setAnnotationFlags(n,r),this.annotationController.updateShape(n,{id:n,style:s.style,transform:s.transform},!1),!o)return;const a=this.context.core.annotationService.annotationApp.getAnnotationByUid(n),l=o.getAnnotationConfig();null!=l&&null!==(e=l.transform)&&void 0!==e&&e.position&&(a.transform.position=l.transform.position),null!=l&&null!==(i=l.transform)&&void 0!==i&&i.scale&&(a.transform.scale=l.transform.scale),o instanceof Mv&&"stamp"===o.renderType&&(a.style.stampConfig=l.style.stampConfig)})),!0)}updateAnnotationPage(t,e){const i=this.context.core.annotationService.getAnnotationByUid(t);if(!i)return;const n=this.context.core.pageService.getPage(i.pageUid);if(!n)return;const s=this.context.tabService.getTab(n.doc.uid);if(!s)return;const o=s.getPageByUid(e);o&&(this.annotationController.moveShape([t],e,o.mediaBox),this.syncAnnotationLayerState())}updateLayer(t){const e=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const e=this.context.core.pageService.getPage(i.pageUid);e&&this.context.tabService.getTab(e.doc.uid)&&t.push(i)}return t}),[]);return e.length===t.length&&(e.forEach((t=>{this.annotationController.updateLayer(t.uid,t.layer)})),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let t={back:!1,front:!1,forward:!1,backward:!1};const e=this.annotationController.getSelectedShapeUids();return 1===e.length&&(t=this.context.core.annotationService.getAnnotationLayerState(e[0])),this.viewer.hooks.annotationLayerStateChanged.emit(eS.create(t)),t}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.annotationController.deleteShape(t,!1,e),this.syncAnnotationLayerState()}selectAnnotations(t){return this.annotationController.selectShape(t)}getSelectedAnnotations(){const t=this.annotationController.getSelectedShapeUids();if(!t.length)return[];const e=[];return t.forEach((t=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);i&&e.push(i)})),e}duplicateAnnotation(t,e){throw new Error("Method not implemented.")}}class DT extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"containerPage",void 0),this.context=t}isHitAnnotation(t){return this.context.annotationController.isHitShape(t)}startHandler(t,e){this.context.annotationController.startHandler(t,e)}cursorHandler(t,e,i){this.context.annotationController.cursorHandler(t,e,i)}moveHandler(t,e){this.context.annotationController.moveHandler(t,e)}endHandler(t){this.context.annotationController.endHandler(t)}activateAnnotation(t,e){this.context.annotationController.eventService.activateShape(t,e)}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear()}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}keydownHandler(t){const e=this.context.context.getActiveTab();this.context.annotationController.keyDownHandler(t,e.context.zoom)}keyupHandler(t){this.context.annotationController.keyUpHandler(t)}setAnnotationContainer(t){this.containerPage=t,this.context.annotationController.setAnnotationContainer(t.uid,t.mediaBox)}setAnnotationInteractionArea(t){this.context.annotationController.eventService.setEventArea(t)}copyAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(t)}cutAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(t)}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations()}dispose(){super.dispose(),this.containerPage=null}}class kT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)}),this)}execute(){const{action:t}=this,{annotationApp:e}=this.core.annotationService,{annotationConfig:i}=this.action;return!!e.createAnnotations([{docUid:t.docUid,uid:i.uid,pageUid:t.pageUid,type:i.type,style:i.style,transform:i.transform,flags:i.flags,comment:i.comment,layer:i.layer,flattened:i.flattened}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid])}}class RT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="deleteAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&(t.deleteConfigs.slice().forEach((i=>{if(e.pageUids.includes(i.pageUid)){const e=t.deleteConfigs.findIndex((t=>t.pageUid===i.pageUid));t.deleteConfigs.splice(e,1)}})),this.isValid=t.deleteConfigs.length>0)}),this)}execute(){const{action:t}=this,e=t.deleteConfigs.map((t=>t.uid));return this.core.annotationService.annotationApp.deleteAnnotations(e),!0}undo(){const{annotationApp:t}=this.core.annotationService,e=this.action.deleteConfigs.map((t=>({docUid:this.action.docUid,uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified,flattened:t.flattened})));t.createAnnotations(e)}}class MT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),na(this,"oldLayer",void 0),na(this,"newLayer",void 0),this.action=t,this.core=e,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)}),this)}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.bringToFront(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class LT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),na(this,"oldLayer",void 0),na(this,"newLayer",void 0),this.action=t,this.core=e,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)}),this)}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.bringForward(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class OT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)}),this)}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}}class BT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),na(this,"oldLayer",void 0),na(this,"newLayer",void 0),this.action=t,this.core=e,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)}),this)}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.sendToBack(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class FT extends k_{constructor(t,e,i){super(),na(this,"action",void 0),na(this,"core",void 0),na(this,"updatedBy",void 0),this.action=t,this.core=e,this.updatedBy=i,this.type="updateAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{if(t.docUid!==e.docUid)return;const{pageUid:i}=t;e.pageUids.includes(i)&&(this.isValid=!1)}),this)}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1)}update(t){const{annotationApp:e}=this.core.annotationService,i=this.action.updateDetails.map((e=>{const i=Wd(t?e.to:e.from);return{uid:e.annotationUid,...i}}));e.updateAnnotation({updateDetails:i,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]})}}class NT extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="switchAnnotationPage",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&t.moveConfigs.slice().every((t=>((e.pageUids.includes(t.from.pageUid)||e.pageUids.includes(t.to.pageUid))&&(this.isValid=!1),this.isValid)))}),this)}execute(){const{annotationApp:t}=this.core.annotationService;return this.action.moveConfigs.forEach((e=>{if(Hd(e.to.layer)){const i=t.annotationPageRepo.findPageByUid(e.to.pageUid).createTop();e.to.layer=i}t.switchAnnotationPage(e.annotationUid,{...e.to})})),!0}undo(){const{annotationApp:t}=this.core.annotationService;this.action.moveConfigs.forEach((e=>{t.switchAnnotationPage(e.annotationUid,{...e.from})}))}}class UT extends Ju{constructor(t){super(),na(this,"core",void 0),na(this,"annotationApp",void 0),na(this,"hooks",void 0),na(this,"enableEmitLayerChanged",!0),na(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),na(this,"clipboard",[]),na(this,"currentClipboard",[]),na(this,"currentPastePageUid",null),na(this,"flattenedAnnotData",{}),this.core=t,this.annotationApp=new _T,this.hooks=this.annotationApp.hooks,this.hooks.annotationCreated.on((t=>{t.annotations.forEach((t=>{t.flattened&&(this.flattenedAnnotData[t.pageUid]?this.flattenedAnnotData[t.pageUid].push(t.uid):this.flattenedAnnotData[t.pageUid]=[t.uid])}))})),this.hooks.annotationDeleted.on((t=>{t.annotations.forEach((t=>{if(t.flattened){const e=this.flattenedAnnotData[t.pageUid],i=e.indexOf(t.uid);-1!==i&&e.splice(i,1)}}))})),this.hooks.annotationUpdated.on((t=>{t.updateActions.includes("flattenedChanged")&&t.updateDetails.forEach((t=>{const e=this.getAnnotationByUid(t.annotationUid);if(this.flattenedAnnotData[e.pageUid]&&this.flattenedAnnotData[e.pageUid].includes(e.uid)&&!e.flattened){const t=this.flattenedAnnotData[e.pageUid].indexOf(e.uid);-1!==t&&this.flattenedAnnotData[e.pageUid].splice(t,1)}e.flattened&&(this.flattenedAnnotData[e.pageUid]&&!this.flattenedAnnotData[e.pageUid].includes(e.uid)&&this.flattenedAnnotData[e.pageUid].push(e.uid),this.flattenedAnnotData[e.pageUid]||(this.flattenedAnnotData[e.pageUid]=[e.uid]))}))}))}reset(){this.annotationApp.reset()}getAnnotationByUid(t){return this.annotationApp.getAnnotationByUid(t)}deleteAnnotationPages(t){const e=t.reduce(((t,e)=>{const i=this.core.pageService.getPage(e);return i&&t.push(...i.annotations),t}),[]);this.deleteAnnotations(e,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(t)}createAnnotationsByParsedPages(t,e){const i=BS();return e.reduce(((e,n)=>{var s;this.annotationApp.createAnnotationPage(n.pageUid);const o=null===(s=n.annotations)||void 0===s?void 0:s.reduce(((e,s)=>{var o,r,a,l,h;HT(s);const c={uid:s.uid,docUid:t,pageUid:n.pageUid,type:s.type,style:s.style,transform:s.transform,flags:s.flags,comment:VT(s.comment),creationDate:null!==(o=null===(r=s.comment)||void 0===r?void 0:r.creationDate)&&void 0!==o?o:i,modificationDate:null!==(a=null===(l=s.comment)||void 0===l?void 0:l.modifiedDate)&&void 0!==a?a:i,oriIndex:null===(h=s.raw)||void 0===h?void 0:h.oriIndex};return e.push(c),e}),[]);return null!=o&&o.length?(this.annotationApp.createAnnotations(o),e.push(o.map((t=>t.uid)))):e.push([]),e}),[])}createAnnotation(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(HT(e),i){const i=new kT({actionUid:Qd(),type:"createAnnotation",docUid:t,pageUid:e.pageUid,annotationConfig:{uid:e.uid,type:e.type,style:e.style,transform:e.transform,flags:e.flags,comment:e.comment,layer:e.layer,modified:e.modified,oriIndex:e.oriIndex,flattened:e.flattened}},this.core);this.core.commandService.execute(i,t)}else this.annotationApp.createAnnotations([e]);return this.annotationApp.getAnnotationByUid(e.uid)}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:i,commandService:n}=this.core,s=t.reduce(((t,e)=>{const n=this.annotationApp.getAnnotationByUid(e);if(n){const e=i.getPage(n.pageUid),s=t.get(e.doc.uid)||{uid:e.doc.uid,annotationConfigs:[]};t.set(s.uid,s);const o=n.getConfig();o.layer=n.layer,o.flattened=n.flattened,null!=o&&o.flattened&&!o.flags.includes("flattened")&&o.flags.push("flattened"),s.annotationConfigs.push(o)}return t}),new Map);if(e)for(const[t,e]of s){const i=e.annotationConfigs.map((t=>({uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified,flattened:t.flattened}))),s=new RT({actionUid:Qd(),type:"createAnnotation",docUid:t,deleteConfigs:i},this.core);n.execute(s,e.uid)}else this.annotationApp.deleteAnnotations(t,!1)}updateAnnotations(t,e,i,n){let s,o;const r=t.reduce(((t,e)=>{const{annotationUid:i}=e,n=this.annotationApp.getAnnotationByUid(i);var r;return n&&(s=n.pageUid,o=n.docUid,null!=n&&n.flattened&&!e.options.flags.includes("flattened")&&!1!==(null==e||null===(r=e.options)||void 0===r?void 0:r.flattened)&&e.options.flags.push("flattened"),t.push({annotation:n,options:e.options})),t}),[]);if(null==r||!r.length||r.length!==t.length)return;const a=BS(),l=r.map((t=>{let{annotation:e,options:i}=t;return i.comment||(i.comment={}),i.comment.modificationDate=a,{annotationUid:e.uid,from:{...e.getConfig(),modified:e.modified,flattened:e.flattened,layer:e.layer},to:{...i,modified:!n||e.modified,flattened:Yd(null==i?void 0:i.flattened)?null==i?void 0:i.flattened:e.flattened,layer:(null==i?void 0:i.layer)||e.layer}}})),h=new FT({actionUid:Qd(),type:"updateAnnotation",docUid:o,pageUid:s,updateDetails:l,updateActions:i||[]},this.core,e);this.core.commandService.execute(h,o)}switchAnnotationPage(t){const e=t.map((t=>({annotation:this.annotationApp.getAnnotationByUid(t.annotationUid),...t}))),i=this.core.pageService.getPage(e[0].annotation.pageUid);if(!i)return;const n=e.map((t=>{let{annotationUid:e,annotation:i,pageUid:n,x:s,y:o}=t;return{annotationUid:e,from:{pageUid:i.pageUid,x:i.style.x,y:i.style.y,layer:i.layer},to:{pageUid:n,x:Hd(s)?i.style.x:s,y:Hd(o)?i.style.y:o,layer:void 0}}})),s=new NT({actionUid:Qd(),type:"switchAnnotationPage",docUid:i.doc.uid,moveConfigs:n},this.core);this.core.commandService.execute(s,i.doc.uid)}duplicateAnnotation(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return null;const n=i.getConfig();return n.uid=Qd(),e&&(n.pageUid=e),n.comment.creationDate=BS(),n.comment.modificationDate=n.comment.creationDate,this.createAnnotation(n.docUid,n)}copyAnnotations(t){t.length&&(this.clipboard=[],this.currentClipboard=[],this.currentPastePageUid=null),t.forEach((t=>{const e=this.annotationApp.getAnnotationByUid(t);if(e){const t=e.getConfig();this.clipboard.push(t),this.currentClipboard.push(Wd(t))}}))}cutAnnotations(t){this.copyAnnotations(t),this.deleteAnnotations(t)}pasteAnnotations(t,e){if(!this.clipboard.length)return;const i=this.core.pageService.getPage(e);this.currentPastePageUid&&this.currentPastePageUid!==e&&(this.currentClipboard=Wd(this.clipboard)),this.currentPastePageUid=e,this.currentClipboard.forEach((n=>{var s,o,r,a;const l=BS();let{x:h,y:c}=n.style;const d=!Hd(null==n||null===(s=n.style)||void 0===s?void 0:s.x)&&!Hd(null==n||null===(o=n.style)||void 0===o?void 0:o.y);!d&&null!=n&&null!==(r=n.transform)&&void 0!==r&&r.position&&(h=n.transform.position.x,c=n.transform.position.y),h+=10,c+=10,(h>i.cropBox.left+i.cropBox.width-10||c>i.cropBox.top+i.cropBox.height-10||h<i.cropBox.left||c<i.cropBox.top)&&(h=i.cropBox.left,c=i.cropBox.top),d?(n.style.x=h,n.style.y=c,delete n.transform.position):!d&&null!=n&&null!==(a=n.transform)&&void 0!==a&&a.position&&(n.transform.position={x:h,y:c});const u=Wd(n),p=Qd();Object.assign(u,{uid:p,docUid:t,pageUid:e,creationDate:l,modificationDate:l});const g={annotationUid:p,creationDate:l,modificationDate:l,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(u.comment,g):Object.assign(u.comment,g,{contents:""}),this.createAnnotation(n.docUid,u)}))}clearAnnotationClipboard(){this.clipboard=[],this.currentClipboard=[],this.currentPastePageUid=null}bringToFront(t){return this.handleLayer(t,"f")}bringForward(t){return this.handleLayer(t,"fw")}sendToBack(t){const e=this.getAnnotationByUid(t),i=this.flattenedAnnotData[e.pageUid];if(!i||i&&0===i.length)return this.handleLayer(t,"b");if(!this.getAnnotationLayerState(t).back)return!0;this.enableEmitLayerChanged=!1;const n=i.length,s=e.layer;this.annotationApp.sendToBack(t);for(let i=0;i<n;i++)i===n-1?(e.layer=s,this.enableEmitLayerChanged=!0,this.bringForward(t)):this.annotationApp.bringForward(t);return!0}sendBackward(t){return this.handleLayer(t,"bw")}handleLayer(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return!1;const n=this.core.pageService.getPage(i.pageUid);if(!n)return!1;const s={actionUid:Qd(),type:e,annotationUid:t,docUid:n.doc.uid,pageUid:n.uid},o=this.annotationApp.getAnnotationLayerState(t);let r;return"f"===e&&o.front?r=new MT(s,this.core):"fw"===e&&o.forward?r=new LT(s,this.core):"bw"===e&&o.backward?r=new OT(s,this.core):"b"===e&&o.back&&(r=new BT(s,this.core)),r&&this.core.commandService.execute(r,n.doc.uid),!0}getAnnotationLayerState(t){const e=this.annotationApp.getAnnotationLayerState(t),i=this.getAnnotationByUid(t);if(!i)return e;const n=this.flattenedAnnotData[i.pageUid];if(!n||n&&0===n.length)return e;const s=[...this.core.getAnnotationsByPageUid(i.pageUid)];return s.sort(((t,e)=>t.layer-e.layer)),s.indexOf(i)===n.length&&(e.back=!1,e.backward=!1),e}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(t,e){var i,n;const{type:s,transform:o,style:r}=t.getConfig();let a=r,l=o;if("textTypewriter"===s&&(null===(i=t.transform)||void 0===i||!i.position)){const t=new gv({style:r,transform:o},"freeTextWriter",{}).getAnnotationConfig();a=t.style,l=t.transform}e&&!["highlight","underline","strikeout","incomplete"].includes(t.type)&&function(t,e){const i=["rx","x","width","borderWidth","fontSize"],n=["ry","y","height"],s=["startPoint","endPoint"];Object.keys(t).forEach((o=>{const r=t[o];if(i.includes(o)||n.includes(o)){const i=mg(r);t[o]=e.toPixelPPI(i.value,n.includes(o))}else s.includes(o)?t[o]={x:e.toPixelPPI(r.x,!1),y:e.toPixelPPI(r.y,!0)}:"lineDash"===o?t[o]=r.map((t=>e.toPixelPPI(t,!1))):"points"===o?t[o]=r.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))):"segments"===o?t[o]=r.map((t=>t.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))))):"textContents"===o&&(t[o]=r.map((t=>({...t,fontSize:e.toPixelPPI(mg(t.fontSize).value,!1)}))))}))}(a,e),"ellipse"===s&&(a.x+=a.width/2||0,a.y+=a.height/2||0,a.rx=a.width/2||a.rx,a.ry=a.height/2||a.ry),l&&null!==(n=l)&&void 0!==n&&n.position&&(l.position={x:e.toPixelPPI(l.position.x,!1),y:e.toPixelPPI(l.position.y,!0)});const h={id:t.uid,style:a,transform:l};let c;switch(s){case"rectangle":c=new dv(h);break;case"ellipse":c=new lv(h);break;case"line":c=new wv(h);break;case"ink":c=new cv(h);break;case"polygon":c=new yv(h);break;case"polyline":c=new xv(h);break;case"textTypewriter":c=new gv(h,"freeTextWriter",{},!1);break;case"textBox":c=new gv(h,"textBox");break;case"stamp":c=new Mv(h);break;case"highlight":c=new Bv(h,Ov.HIGHLIGHT);break;case"underline":c=new Bv(h,Ov.UNDERLINE);break;case"strikeout":c=new Bv(h,Ov.STRIKEOUT);break;case"incomplete":c=new Fv(h)}if(c instanceof Mv&&!c.style.imageData&&c.updateStampStyle({x:a.x,y:a.y,width:a.width,height:a.height}),["highlight","underline","strikeout","incomplete"].includes(s)){const{resolutionX:t,resolutionY:i}=e,{displayResolution:n}=Ep,s=t/n,o=i/n;c.setOrigin(0,0),c.scaleLocal(s,o)}return c}getAnnotationUidsByLayer(t){const e=this.annotationApp.annotationPageRepo.findPageByUid(t);return null==e?void 0:e.getAnnotationUidListByLayer()}flattenAnnotations(t){const e=t.map((t=>this.getAnnotationByUid(t))),i=[],n=[];this.enableEmitLayerChanged=!1,e.forEach((t=>{var e;const s=t.layer;if(this.core.annotationService.annotationApp.sendToBack(t.uid),null!==(e=this.flattenedAnnotData[t.pageUid])&&void 0!==e&&e.length){var o;const e=null===(o=this.flattenedAnnotData[t.pageUid])||void 0===o?void 0:o.length;for(let i=0;i<e;i++)this.core.annotationService.annotationApp.bringForward(t.uid)}n.push(s),i.push({annotationUid:t.uid,options:{flags:[...t.flags,"flattened"],flattened:!0}}),this.flattenedAnnotData[t.pageUid]?this.flattenedAnnotData[t.pageUid].push(t.uid):this.flattenedAnnotData[t.pageUid]=[t.uid]})),this.enableEmitLayerChanged=!0,e.forEach(((t,e)=>{i[e].options.layer=t.layer,t.layer=n[e]})),this.updateAnnotations(i,void 0,["flattenedChanged"],!0)}unFlattenAnnotation(t){const e=this.getAnnotationByUid(t),i=this.flattenedAnnotData[e.pageUid];if(!i||0===i.length)return!1;const n=i.indexOf(e.uid);if(-1===n)return!1;this.enableEmitLayerChanged=!1;const s=i.length-(n+1),o=e.layer;for(let t=0;t<s;t++)this.core.annotationService.annotationApp.bringForward(e.uid);const r=e.layer,a=e.flags.filter((t=>"flattened"!==t));return e.layer=o,this.updateAnnotations([{annotationUid:e.uid,options:{flags:a,flattened:!1,layer:r}}],void 0,["flattenedChanged"],!0),i.includes(e.uid)&&i.splice(n,1),this.enableEmitLayerChanged=!0,!0}}function VT(t){return{annotationUid:t.uid,author:t.author,subject:t.subject,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,markedStates:WT(t.markedStates||[]),reviewStates:WT(t.reviewStates||[])}}function WT(t){return t.map((t=>({uid:t.uid,author:t.author,contents:t.contents,creationDate:t.creationDate,state:t.state})))}function HT(t){if("stamp"===t.type){const e=new Mv({style:t.style,transform:t.transform}).getAnnotationConfig();t.style=e.style,t.transform={...t.transform,position:e.transform.position,scale:e.transform.scale}}}var jT=new WeakMap,zT=new WeakMap,GT=new WeakMap,YT=new WeakMap,$T=new WeakSet,XT=new WeakSet,qT=new WeakSet;class ZT{constructor(t,e){va(this,qT),va(this,XT),va(this,$T),ma(this,jT,{writable:!0,value:void 0}),ma(this,zT,{writable:!0,value:void 0}),ma(this,GT,{writable:!0,value:void 0}),ma(this,YT,{writable:!0,value:void 0}),ga(this,$T,JT).call(this,t,e)}getCanvas(){return sa(this,jT).contextService.getDomElement()}getInkOptions(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!sa(this,YT))return null;const{x:e,y:i}=sa(this,YT).getLocalPosition();sa(this,YT).setLocalPosition(0,0);const n=sa(this,YT).getAnnotationConfig(),s={borderWidth:n.style.borderWidth,borderColor:n.style.borderColor,opacity:n.style.opacity};if(t){const{displayResolution:t,dataResolution:o}=Ep,r=n.style.segments.map((e=>e.map((e=>({x:$u(e.x,t,o),y:$u(e.y,t,o)})))));return s.borderWidth=$u(s.borderWidth,t,o),sa(this,YT).setLocalPosition(e,i),sa(this,YT).getAnnotationConfig(),{points:r,...s}}return{segments:n.style.segments,...s}}getSignatureImage(){if(!sa(this,YT))return Promise.resolve(null);const t=sa(this,YT).getBoundingRect(),e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(this.getCanvas(),t.x*devicePixelRatio,t.y*devicePixelRatio,t.width*devicePixelRatio,t.height*devicePixelRatio,0,0,t.width,t.height),new Promise((t=>{e.toBlob(t,"image/png")}))}updateSignatureStyle(t){oa(this,GT,{...sa(this,GT),...t}),sa(this,YT)&&(sa(this,YT).updateStyle({...t}),sa(this,jT).render())}clearSignature(){sa(this,zT).children.slice().forEach((t=>{sa(this,zT).removeChild(t)})),oa(this,YT,null),sa(this,jT).render()}}function JT(t,e){const i=document.createElement("canvas");i.style.touchAction="none",oa(this,jT,new vm({renderer:new Bm,width:t,height:e,canvas:i,dpr:window.devicePixelRatio,willReadFrequently:!0})),i.style.width=`${t}px`,i.style.height=`${e}px`,oa(this,zT,sa(this,jT).document.documentElement),(new my).init(sa(this,jT)),ga(this,XT,KT).call(this)}function KT(){let t=!1;const e=this.getCanvas();e.addEventListener("pointerdown",(e=>{const i={x:e.offsetX,y:e.offsetY};t=!0,sa(this,YT)?(sa(this,YT).addSegment(),sa(this,YT).addPoint(i)):(oa(this,YT,new cv({style:{segments:[[i]],...sa(this,GT),lineCap:"round",lineJoin:"round"}})),sa(this,zT).appendChild(sa(this,YT))),sa(this,jT).render()})),e.addEventListener("pointermove",(e=>{if(!t)return;const i={x:e.offsetX,y:e.offsetY};sa(this,YT).addPoint(i),sa(this,jT).render()})),document.addEventListener("pointerup",(()=>{t&&(t=!1,sa(this,YT).pathDirty=!0,sa(this,YT).boundsDirty=!0,sa(this,jT).render())}))}const QT={stampText:"Draft",fontSize:32,fontFamily:"Arial",fontWeight:"bold",fontStyle:"normal",underline:!1,strikeout:!1,color:"#182564",borderColor:"#182564",background:"#c7d2e4",timeStampFontSize:16,userName:"Guest",hasUserName:!0,hasDate:!0,hasTime:!0};var tE=new WeakMap,eE=new WeakMap,iE=new WeakMap,nE=new WeakMap,sE=new WeakMap,oE=new WeakMap,rE=new WeakSet,aE=new WeakSet;class lE{constructor(t,e){va(this,aE),va(this,rE),ma(this,tE,{writable:!0,value:void 0}),ma(this,eE,{writable:!0,value:void 0}),ma(this,iE,{writable:!0,value:void 0}),ma(this,nE,{writable:!0,value:void 0}),ma(this,sE,{writable:!0,value:void 0}),ma(this,oE,{writable:!0,value:{...QT}}),oa(this,iE,t),oa(this,nE,e),ga(this,rE,hE).call(this,t,e)}get signatureStyle(){return{...sa(this,oE)}}getStampConfig(){const{background:t,borderColor:e,stampText:i}=sa(this,oE),n=[],s=function(t,e){const i=t-1,n=e-1;return[{x:i,y:n-10.6,step:2},{x:i,y:n-4.8,step:1},{x:i-6,y:n,step:1},{x:i-13.4,y:n,step:1},{x:14.4,y:n,step:0},{x:7,y:n,step:1},{x:1,y:n-4.8,step:1},{x:1,y:n-10.6,step:1},{x:1,y:11.6,step:0},{x:1,y:5.8,step:1},{x:7,y:1,step:1},{x:14.4,y:1,step:1},{x:i-13.4,y:1,step:0},{x:i-6,y:1,step:1},{x:i,y:5.8,step:1},{x:i,y:11.6,step:1},{x:i,y:n-10.6,step:0}]}(sa(this,iE),sa(this,nE));n.push({type:"path",stampPoints:s,borderWidth:1.3333333333333333,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4,background:t,borderColor:e});const{color:o,fontFamily:r,fontSize:a,fontStyle:l,fontWeight:h}=sa(this,oE),c=null!=r&&r.includes(" ")?`'${r}'`:r,d=document.createElement("canvas").getContext("2d"),{hasUserName:u,hasDate:p,hasTime:g,timeStampFontSize:f,userName:m}=sa(this,oE),v=u||p||g;if(v){let t="";t+=u?`${m} `:"",t+=p?`${function(){const t=new Date,e=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0");return`${t.getDate().toString().padStart(2,"0")}/${i}/${e}`}()} `:"",t+=g?`${function(){const t=new Date;let e=t.getHours();const i=e>=12?"PM":"AM";return e%=12,e=e||12,`${e}:${t.getMinutes().toString().padStart(2,"0")} ${i}`}()}`:"";const e=`${l} ${h} ${f}px ${c}`;d.font=e;const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a}=d.measureText(t.trim()),v=s+a;n.push({type:"text",text:t,x:(sa(this,iE)-i)/2,y:sa(this,nE)/2+sa(this,nE)/4+v/2,color:o,fontFamily:r,fontSize:f,fontStyle:l,fontWeight:h})}if(i){const t=`${l} ${h} ${a}px ${c}`;d.font=t;const{underline:e,strikeout:s}=this.signatureStyle,{width:u,actualBoundingBoxAscent:p,actualBoundingBoxDescent:g}=d.measureText(i),f=p+g;if(n.push({type:"text",text:i,x:(sa(this,iE)-u)/2,y:v?sa(this,nE)/2:sa(this,nE)/2+f/2,color:o,fontFamily:r,fontSize:a,fontStyle:l,fontWeight:h}),s){const t=v?sa(this,nE)/2-f/3:sa(this,nE)/2+f/2-f/3,e=(sa(this,iE)-u)/2;n.push({type:"path",stampPoints:[{x:e,y:t,step:2},{x:e+u,y:t,step:0}],borderWidth:2,borderColor:o})}if(e){const t=v?sa(this,nE)/2+f/10:sa(this,nE)/2+f/2+f/10,e=(sa(this,iE)-u)/2;n.push({type:"path",stampPoints:[{x:e,y:t,step:2},{x:e+u,y:t,step:0}],borderWidth:2,borderColor:o})}}return n}getCanvas(){return sa(this,eE).contextService.getDomElement()}updateSignatureStyle(t){oa(this,oE,{...sa(this,oE),...t});const e=this.getStampConfig();sa(this,sE).stampConfig=e,sa(this,sE).initStamp(),sa(this,eE).render()}getSignatureImage(){if(!sa(this,sE))return Promise.resolve(null);const t=document.createElement("canvas");return t.width=sa(this,iE),t.height=sa(this,nE),t.getContext("2d").drawImage(this.getCanvas(),-.65*devicePixelRatio,-.65*devicePixelRatio,(sa(this,iE)+1.3)*devicePixelRatio,(sa(this,nE)+1.3)*devicePixelRatio,0,0,sa(this,iE),sa(this,nE)),new Promise((e=>{t.toBlob(e,"image/png")}))}}function hE(t,e){const i=document.createElement("canvas");oa(this,eE,new vm({renderer:new Bm,width:t,height:e,canvas:i,dpr:window.devicePixelRatio,willReadFrequently:!0})),i.style.width=`${t}px`,i.style.height=`${e}px`,oa(this,tE,sa(this,eE).document.documentElement),oa(this,sE,new Mv({style:{stampConfig:this.getStampConfig()}})),sa(this,tE).appendChild(sa(this,sE)),(new my).init(sa(this,eE)),sa(this,eE).render()}const cE={install(t){const e=t.getClass("Viewer"),i=(n=e,class extends n{constructor(t){super(t),na(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new IT(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new DT(this.annotationViewerContext));const e=this.getViewerConfig();this.context.isDefaultViewer&&this.updateAnnotationConfig({enableDeleteWithKeyboard:e.enableDeleteWithKeyboard,enableMoveWithKeyboard:e.enableMoveAnnotationWithKeyboard,enableMultipleSelectWidthCtrl:e.enableMultipleSelectAnnotationWithKeyboard})}listenHooksForAnnotation(){const t=()=>{const t=this.getSelectedAnnotations();if(1!==t.length)return;if(!t[0])return;const e=this.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.updateCursor()};this.hooks.scroll.on((e=>{this.context.isDefaultViewer&&t()})),this.hooks.resize.on((e=>{this.context.isDefaultViewer&&t()})),this.hooks.zoomChanged.on((e=>{this.context.isDefaultViewer&&t()})),this.hooks.pageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e)}t&&"single"===t.context.displayMode&&this.annotationViewerContext.disableTextEditMode()}}),this),this.hooks.currentPageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e)}}}),this)}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const{core:t}=this.context,e=t.annotationService.annotationApp.hooks;t.onBeforeGetPageData.on((t=>{const{activatedShape:e}=this.annotationViewerContext.annotationController.eventService;(null==e?void 0:e.pageUid)===t.pageUid&&e instanceof gv&&e.isEditMode&&e.textEditEventHandler.emitTextContentUpdated()}),this),e.annotationCreated.on((t=>{t.annotations.forEach((t=>{this.annotationViewerContext.addAnnotationByAnnotationData(t)})),this.context.render()}),this),e.annotationDeleted.on((t=>{this.annotationViewerContext.deleteAnnotations(t.annotations.map((t=>t.uid)),t.emitEvent),this.context.render()}),this);let i=null;e.annotationUpdated.on((t=>{const e=t.updateDetails.map((t=>t.annotationUid));this.annotationViewerContext.updateAnnotations(e,t.updatedBy),this.hooks.annotationsUpdated.emit(new RS(e,t.updateActions)),i||(i=setTimeout((()=>{var t;null===(t=this.context)||void 0===t||t.render(),i=null}),17))}),this),e.bringFroward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.forwardUid]),this.context.render()}),this),e.bringToFront.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render()}),this),e.sendBackward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.backwardUid]),this.context.render()}),this),e.sendToBack.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render()}),this),e.restoreLayer.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render()}),this),e.annotationPageSwitched.on((t=>{this.annotationViewerContext.updateAnnotationPage(t.annotationUid,t.to.pageUid),this.context.render()}),this)}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&Qu(document,"click",this).on((t=>{const e=this.getActiveTab(),i="visible"===this.context.viewerConfig.visibility;e&&i&&(this.context.viewService.mainContainer.contains(null==t?void 0:t.target)||this.annotationViewerContext.disableTextEditMode())}))}getAnnotationConfig(){return Wd(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(t){this.annotationViewerContext.annotationConfigService.updateConfig(t)}selectAnnotations(t){return this.annotationViewerContext.selectAnnotations(t)}deleteAnnotations(t){this.context.core.annotationService.deleteAnnotations(t),this.context.render()}updateAnnotation(t,e,i){const n=this.getAnnotationObject(t);n instanceof gv&&n.isEditMode&&n.textEditEventHandler.emitTextContentUpdated(),this.context.core.annotationService.updateAnnotations([{annotationUid:t,options:e}],void 0,i)}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(t){return this.context.core.annotationService.bringForward(t)}bringToFront(t){return this.context.core.annotationService.bringToFront(t)}sendBackward(t){return this.context.core.annotationService.sendBackward(t)}sendToBack(t){return this.context.core.annotationService.sendToBack(t)}getAnnotationObject(t){return this.annotationViewerContext.annotationController.getShape(t)}copyAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.copyAnnotations(t)}cutAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.cutAnnotations(t)}pasteAnnotations(t,e){const i=this.context.getActiveTab();if(null==i||!i.total)return;const n=i.getCurrentPage();n&&this.context.core.annotationService.pasteAnnotations(t||i.uid,e||n.uid)}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard()}undo(){const{activatedShape:t}=this.annotationViewerContext.annotationController.eventService;if(!this.context.getActiveTab())return!1;const e=t instanceof gv&&t.isEditMode;e&&t.textEditEventHandler.emitTextContentUpdated();const i=super.undo();return e&&t.textEditEventHandler.resetStartTextContent(),i}redo(){const{activatedShape:t}=this.annotationViewerContext.annotationController.eventService;if(!this.context.getActiveTab())return!1;const e=t instanceof gv&&t.isEditMode;e&&t.textEditEventHandler.emitTextContentUpdated();const i=super.redo();return e&&t.textEditEventHandler.resetStartTextContent(),i}});var n;t.setClass("Viewer",i)},apply(t){const e=new UT(t);t.annotationService=e;const{documentService:i,pageService:n}=t;e.hooks.annotationCreated.on((t=>{t.annotations.forEach((t=>{const e=n.getPage(t.pageUid);e&&e.annotations.push(t.uid)}))}),n),e.hooks.annotationDeleted.on((t=>{t.annotations.forEach((t=>{const e=n.getPage(t.pageUid);if(e){const i=e.annotations.indexOf(t.uid);e.annotations.splice(i,1)}}))}),n),e.hooks.annotationPageSwitched.on((t=>{const e=n.getPage(t.from.pageUid),i=n.getPage(t.to.pageUid);if(e){const i=e.annotations.indexOf(t.annotationUid);e.annotations.splice(i,1)}i&&i.annotations.push(t.annotationUid)}),n)}},dE={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},croppingMagnifierStyle:{type:"circle",size:100,borderColor:"#323232",borderWidth:3,crosshairWidth:1,crosshairColor:"#323232",magnification:3},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,enableMagnifier:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,hasThb:!1,visibility:"visible",viewerMode:$b.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableLoadSourceByDrag:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWithKeyboard:!0,enableZoomOutWithKeyboard:!0,enableUndoWithKeyboard:!0,enableRedoWithKeyboard:!0,enableDeleteWithKeyboard:!0,enableSelectAllWithKeyboard:!0,enableMoveAnnotationWithKeyboard:!0,enableSaveWithKeyboard:!0,enableLoadSourceWithKeyboard:!0,enablePrintWithKeyboard:!0,enableSelectPageWithKeyboard:!0,enableCopyCutPasteWithKeyboard:!0,enableMultipleSelectAnnotationWithKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class uE extends Tf{constructor(){super({name:"Checkbox"}),na(this,"shapeType","checkbox"),na(this,"checkboxStyle",void 0),na(this,"parsedCheckboxStyle",void 0),na(this,"isChecked",!1)}get checked(){return this.isChecked}set checked(t){this.isChecked=t}updateStyle(t){Object.assign(this.style,t)}}class pE extends Tf{constructor(){super({name:"PageNumber"}),na(this,"shapeType","pageNumber"),na(this,"text",void 0),na(this,"parsedPageNumberStyle",void 0),this.text="0"}updateText(t){this.text=t}updateStyle(t){Object.assign(this.style,t)}}class gE extends Nf{constructor(t){super({...t,name:"TabPage"}),na(this,"uid",void 0),na(this,"tab",void 0),na(this,"isSelected",!1),na(this,"isHovered",!1),na(this,"isDragging",!1),na(this,"isLoading",!1),na(this,"isPreload",!1),na(this,"isLoaded",!1),na(this,"rWidth",void 0),na(this,"rHeight",void 0),na(this,"rotation",0),na(this,"cropLeft",void 0),na(this,"cropTop",void 0),na(this,"cropWidth",void 0),na(this,"cropHeight",void 0),na(this,"mediaBoxRect",void 0),na(this,"cropBoxRect",void 0),na(this,"isOptimized",!1),na(this,"optimizedUid","1"),na(this,"optimizationUid","2"),na(this,"editUid",void 0),na(this,"editedUid",void 0),na(this,"zoom",1),na(this,"image",void 0),na(this,"borderBox",void 0),na(this,"checkbox",void 0),na(this,"pageNumber",void 0),na(this,"curBox",void 0),na(this,"mediaBox",void 0),na(this,"cropBox",void 0),na(this,"realTimeBox",void 0),this.tab=t.tab,this.uid=t.uid,this.rWidth=t.style.width,this.rHeight=t.style.height,this.initSubShapes(t)}initSubShapes(t){this.updateStyle({visibility:"hidden"});const e=new Df({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),i=new Nf({name:"pageOptimizedBox",style:{x:0,y:0}}),n=new Nf({name:"pageCropBox"});n.clippable=!0;const s=new Nf({name:"pageMediaBox"}),o=new Nf({name:"pageBorderBox",style:{...t.style,...t.formattedPageStyle}}),r=new Nf({name:"currentStyleBox",style:{visibility:"hidden"}}),a=new uE,l=new pE;s.appendChild(e),n.appendChild(s),o.appendChild(i),o.appendChild(n),o.appendChild(r),o.appendChild(a),this.appendChild(l),this.appendChild(o),this.image=e,this.borderBox=o,this.realTimeBox=i,this.pageNumber=l,this.checkbox=a,this.curBox=r,this.cropBox=n,this.mediaBox=s}getRect(){const t=this.realTimeBox.getPosition();return{left:t.x,top:t.y,width:this.rWidth,height:this.rHeight}}setImgDom(t){this.image.style.img=t}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=Qd()}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null}setPage(t,e,i,n){this.updateStyle({x:t,y:e,width:i,height:n})}setBorderBox(t,e,i,n,s){Hd(s)?this.borderBox.updateStyle({x:t,y:e,width:i,height:n}):this.borderBox.updateStyle({x:t,y:e,width:i,height:n,borderWidth:s})}setCropBox(t,e,i,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:t,y:e,width:i,height:n}),this.cropBox.setLocalScale(s),this.cropBox.setLocalAngle(o),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9)}setRealTimeBox(t,e,i,n,s){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:t,y:e,width:i,height:n}),this.realTimeBox.setLocalScale(s,s)}setMediaBox(t,e,i,n){this.mediaBox.updateStyle({x:t,y:e,width:i,height:n})}setCurBox(t,e,i,n){this.curBox.updateStyle({x:t,y:e,width:i,height:n})}setImage(t,e,i,n){this.image.updateStyle({x:t,y:e,width:i,height:n})}}function fE(t){const{borderWidth:e,borderColor:i,borderStyle:n}=Au(t),s=parseInt(e||"0px",10);let o=[0,0];return"dashed"===n&&(o=[2*s,s]),{borderWidth:s,borderStyle:o,borderColor:i||"",lineDash:o}}const mE=t=>{const{border:e}=t;if(!e)return 0;const i=e.match(/[0-9]+/g)[0];return parseInt(i||"0",10)};function vE(t,e){if(Hd(t)||""===t)return null;const i=vg(t);return"%"===i.unit?e*i.value/100:i.value}function yE(t,e,i){t.style.width=`${e}px`,t.style.height=`${i}px`}function xE(t){const e=devicePixelRatio;return qd(t)&&t>0?(t=Math.floor(t*e)/e)||(t=1/e):t=0,t}function wE(t){const e=devicePixelRatio;return qd(t)?(t=Math.round(t*e)/e)||(t=1/e):t=0,t}function bE(t){return wE(t)}const CE=()=>{const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e};class SE{constructor(t,e){na(this,"tab",void 0),na(this,"viewerContext",void 0),na(this,"viewportWidth",600),na(this,"viewportHeight",800),na(this,"currentViewportWidth",0),na(this,"currentViewportHeight",0),na(this,"currentLayoutWidth",0),na(this,"currentLayoutHeight",0),na(this,"placeholderPages",[]),na(this,"scrollLeft",0),na(this,"scrollTop",0),na(this,"maxScrollLeft",0),na(this,"maxScrollTop",0),na(this,"startRow",0),na(this,"endRow",0),na(this,"startColumn",0),na(this,"endColumn",0),na(this,"preloadCount",1),na(this,"pagePreloadChanges",[]),na(this,"direction","vertical"),na(this,"displayMode",void 0),na(this,"fitMode",void 0),na(this,"rows",void 0),na(this,"columns",void 0),na(this,"zoom",void 0),na(this,"defaultReference",void 0),na(this,"zoomReference",void 0),na(this,"resizeReference",void 0),na(this,"oldZoom",void 0),na(this,"isZoomChanged",void 0),na(this,"isOutOfBounds",void 0),na(this,"isScrollbarResized",!0),na(this,"scrollbarWidthCache",void 0),na(this,"defaultWidth",void 0),na(this,"defaultHeight",void 0),this.tab=t,this.viewerContext=e;const{viewerConfig:i}=e;this.rows=i.rows,this.columns=i.columns,this.zoom=i.zoom,this.oldZoom=i.zoom,this.displayMode=i.displayMode,this.fitMode=i.fitMode,this.direction=i.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1}get isVertical(){return"vertical"===this.direction}get isContinuousDisplay(){return"continuous"===this.displayMode}get isSingleDisplay(){return"single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const t=CE();return this.scrollbarWidthCache=t,this.isScrollbarResized=!1,t}getRealRowAndColumnContinuous(){const{rows:t,columns:e,isVertical:i}=this,{total:n}=this.tab;let s=t,o=e;return i?(s=Math.ceil(n/e),n<=e&&(o=Math.max(1,n),s=1)):(o=Math.ceil(n/t),n<=t&&(s=Math.max(1,n),o=1)),{realRow:s,realColumn:o}}getRealRowAndColumnThumbnail(){const{total:t}=this.tab,{rows:e,columns:i,isVertical:n}=this,s=n?i:Math.ceil(t/e);return{realRow:n?Math.ceil(t/i):e,realColumn:s}}getZoomOriginCord(){const{zoomOrigin:t}=this.viewerContext.viewerConfig,e={start:0,center:.5,end:1};return{originX:this.currentViewportWidth*e[t.x],originY:this.currentViewportHeight*e[t.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:t}=this.viewerContext,{borderWidth:e}=t.getParsedPageStyle();return{borderWidth:e,selectedBorderWidth:t.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:t.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(t,e){return this.viewerContext.styleService.getParsedPageNumberStyle({width:t,height:e})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(t,e){return this.viewerContext.styleService.getParsedCheckboxStyle({width:t,height:e})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(t){if(Zd(t)){if(/px/.test(t)){const[e]=t.match(/(\d+)/);return parseInt(e,10)}const e=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(t)){const i=e.width/Pu(),[n]=t.match(/(\d+)/);return i*parseInt(n,10)/100}if(/em/.test(t)){const i=getComputedStyle(e).fontSize,[n]=i.match(/(\d+)/),[s]=t.match(/(\d+)/);return parseInt(n,10)*parseInt(s,10)}}return qd(t)?t:parseInt(t,10)}setZoom(t){this.oldZoom=this.zoom,this.zoom=t,this.tab.pages.forEach((e=>{e.zoom=t}))}getTabOffset(){const{maxScrollLeft:t,maxScrollTop:e,currentLayoutWidth:i,currentLayoutHeight:n,currentViewportWidth:s,currentViewportHeight:o,scrollLeft:r,scrollTop:a}=this;let l=0,h=0;const c=this.getParsedCanvasStyle().borderWidth||0;return l=t>0?-r:(s-(i-2*c))/2,h=e>0?-a:(o-(n-2*c))/2,{offsetX:l,offsetY:h}}parseReferenceDefault(){const{tab:t,maxScrollLeft:e,maxScrollTop:i}=this,n=t.current,s=this.placeholderPages[n];if(!s)return{scrollLeft:0,scrollTop:0};const o=this.getMargin();let r=s.x-o,a=s.y-o;return this.isContinuousDisplay&&(r=s.pageX-o,a=s.pageY-o),r=Jd(r,0,e),a=Jd(a,0,i),{scrollLeft:r,scrollTop:a}}parseReferenceZoom(t,e,i){if(Hd(t)&&(t=this.zoomReference),Hd(e)||Hd(i)){const{originX:t,originY:n}=this.getZoomOriginCord();e=t,i=n}let{scrollLeft:n,scrollTop:s}=this.parseReference(t,e,i);const{maxScrollLeft:o,maxScrollTop:r}=this;return n=Jd(n,0,o),s=Jd(s,0,r),{scrollLeft:n,scrollTop:s}}parseReferenceResize(){const{resizeReference:t}=this;let{scrollLeft:e,scrollTop:i}=this.parseReference(t,0,0);const{maxScrollLeft:n,maxScrollTop:s}=this;return e=Math.min(e,n),i=Math.min(i,s),{scrollLeft:e,scrollTop:i}}updateReference(){const{currentViewportWidth:t,currentViewportHeight:e}=this,i=this.generateReference(0,0),n=this.generateReference(t/2,e/2),{originX:s,originY:o}=this.getZoomOriginCord(),r=this.generateReference(s,o);this.defaultReference=n,this.resizeReference=i,this.zoomReference=r}generateReference(t,e){let i,n,s,o,r=null,a=Number.MAX_VALUE;const{offsetX:l,offsetY:h}=this.getTabOffset(),{zoom:c}=this;return this.placeholderPages.forEach((d=>{if(d&&("single"===this.displayMode&&d.uid===this.tab.currentUid||"continuous"===this.displayMode)){const u=d.x+l,p=d.y+h,g=new lu(u+d.width/2,p+d.height/2).distanceTo({x:t,y:e});g<a&&(a=g,r=d.uid,t<u?(i="start",s=u-t):t>u+d.width?(i="end",s=t-(u+d.width)):(i="center",s=(t-u)/c),e<p?(n="start",o=p-e):e>p+d.height?(n="end",o=e-(p+d.height)):(n="center",o=(e-p)/c))}})),{pageX:s,pageY:o,positionX:i,positionY:n,pageUid:r}}parseReference(t,e,i){const{pageX:n,pageY:s,positionX:o,positionY:r,pageUid:a}=t,l=this.placeholderPages.find((t=>t.uid===a)),{zoom:h}=this;let c,d,u=0,p=0;return l&&("start"===o?c=l.x-n:"center"===o?c=l.x+n*h:"end"===o&&(c=l.x+l.width+n),"start"===r?d=l.y-s:"center"===r?d=l.y+s*h:"end"===r&&(d=l.y+l.height+s)),u=c-e,p=d-i,{scrollLeft:u,scrollTop:p}}getScrollValuesByCurrentChanged(){const{placeholderPages:t,currentViewportWidth:e,currentViewportHeight:i,startRow:n,endRow:s,startColumn:o,endColumn:r,isVertical:a}=this,{current:l}=this.tab,h=this.getMargin(),{realRow:c,realColumn:d}=this.getRealRowAndColumnThumbnail();let u=l,p=l;a?(u=n*d+o,p=s*d+r):(u=o*c+n,p=r*c+r);let g=Jd(this.scrollLeft,0,this.maxScrollLeft),f=Jd(this.scrollTop,0,this.maxScrollTop);if(l>=u&&l<=p)return{scrollLeft:g,scrollTop:f};const m=t[l];return m&&(a?(g=0,l<u?f=m.y-h:l>p&&(f=m.y+m.height+h-i)):(f=0,l<u?g=m.x-h:l>p&&(g=m.x+m.width+h-e))),g=Jd(g,0,this.maxScrollLeft),f=Jd(f,0,this.maxScrollTop),{scrollLeft:g,scrollTop:f}}getCurrentByScroll(){let t=this.tab.current;const{placeholderPages:e,currentViewportWidth:i,currentViewportHeight:n,startRow:s,endRow:o,startColumn:r,endColumn:a,isVertical:l}=this,{realRow:h,realColumn:c}=this.getRealRowAndColumnContinuous(),d=i/2,u=n/2,{offsetX:p,offsetY:g}=this.getTabOffset(),{current:f}=this.tab;let m=Number.MAX_VALUE,v=Number.MAX_VALUE,y=l?Math.floor(f/c):f%h,x=l?f%c:Math.floor(f/h);for(let t=s;t<=o;t++){const i=e[t*c];if(!i)continue;const{y:n,height:s}=i,o=n+g,r=o-u,a=u-o-s;if(r<=0&&a<=0){y=t;break}r>0&&r<v?(v=r,y=t):a>0&&a<v&&(v=a,y=t)}for(let t=r;t<=a;t++){const i=e[r];if(!i)continue;const{x:n,width:s}=i,o=n+p,a=o-d,l=d-o-s;if(a<=0&&l<=0){x=t;break}a>0&&a<m?(m=a,x=t):l>0&&l<m&&(m=l,x=t)}return t=y*c+x,t===this.tab.current?null:t}setTabScrollValue(t,e){this.scrollLeft=t,this.scrollTop=e;const{offsetX:i,offsetY:n}=this.getTabOffset();this.tab.setPosition({x:i,y:n})}}class _E extends Tf{constructor(t,e){super({name:"DocTab"}),na(this,"uid",void 0),na(this,"docType",void 0),na(this,"docName",void 0),na(this,"doc",void 0),na(this,"isActive",!1),na(this,"currentUid",void 0),na(this,"total",void 0),na(this,"selected",void 0),na(this,"context",void 0),na(this,"viewerContext",void 0),na(this,"shiftReference",void 0),na(this,"oldCurrentUid",void 0),na(this,"oldCurrent",void 0),na(this,"pageMap",new Map),this.doc=t,this.uid=t.uid,this.docName=t.name,this.docType=t.type,this.total=0,this.selected=[],this.viewerContext=e,this.context=new SE(this,e),this.oldCurrent=-1,this.oldCurrentUid=void 0,t.pages.forEach((t=>{const e=this.createPage(t);this.pageMap.set(t,e),this.appendChild(e)})),this.total=t.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid)}get scrollToLatest(){let{scrollToLatest:t}=this.viewerContext.viewer.group.config;return Hd(t)&&(t=this.viewerContext.viewerConfig.scrollToLatest),t}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return"document"===this.docType}createPage(t){const{pageStyle:e,pageNumberStyle:i,checkboxStyle:n,removeBtnStyle:s,blankFillColor:o}=this.viewerContext.viewerConfig,r=function(t){const{border:e,background:i}=t;let n={};return e&&(n=fE(e)),{background:i,...n}}(e),{width:a,height:l}=this.viewerContext.getPageRenderSize(t);return new gE({tab:this,uid:t,formattedPageStyle:r,pageNumberStyle:i,checkboxStyle:n,removeBtnStyle:s,blankFillColor:o,style:{pointerEvents:"auto",width:a,height:l}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current}updateViewportSize(t,e){this.context.viewportWidth=t,this.context.viewportHeight=e}rename(t){this.docName=t}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map((t=>t.uid))}appendPages(t,e,i){const n=t.length;if(!n)return;const s=qd(i);if(t.forEach(((t,e)=>{const n=this.createPage(t);this.appendChild(n,s?i+e:void 0),this.pageMap.set(t,n)})),this.total=this.pages.length,e)this.currentUid=this.indexToUid(s?i+n-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var o;this.currentUid=null===(o=this.pages[0])||void 0===o?void 0:o.uid,this.updateDefaultReference()}}deletePages(t){this.updateOldInfo();const e=[...t],i=t.includes(this.currentUid);if(i){const i=t.indexOf(this.currentUid);e.splice(i,1),e.push(this.currentUid)}e.forEach((t=>{const e=this.getPageByUid(t);if(i&&e.uid===this.currentUid){if(1===this.total)this.currentUid=null;else{const{current:t}=this,e=t===this.total-1?-1:1;this.currentUid=this.indexToUid(t+e)}this.updateDefaultReference()}Bu(this.selected,t),this.removeChild(e),this.pageMap.delete(e.uid),this.total-=1})),0===this.total&&(this.context.placeholderPages=[])}deleteAllPages(){this.updateOldInfo(),[...this.pages].forEach((t=>{this.removeChild(t),this.pageMap.delete(t.uid)})),this.currentUid=null,this.selected=[],this.context.placeholderPages=[],this.total=0}movePages(t,e){return this.updateOldInfo(),Fu(this.pages,t,e)}switchPage(t,e){return this.updateOldInfo(),Nu(this.pages,t,e)}reorderPages(t){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),Uu(this.pages,t)}gotoPage(t){return 0===this.total?-1:(this.updateOldInfo(),t!==this.current&&(t=Jd(t,0,this.total-1),this.currentUid=this.indexToUid(t),this.updateDefaultReference()),this.updateShiftReference(),t)}selectPages(t){this.pages.forEach((e=>{e.isSelected=t.includes(e.uid)})),this.selected=t}selectPagesByIndices(t){const e=this.indicesToUids(t);this.selectPages(e)}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map((t=>this.uidToIndex(t)))}getPageByIndex(t){return this.pages[t]}getPageByUid(t){return this.pageMap.get(t)}getPageIndex(t){return this.pages.findIndex((e=>e.uid===t.uid))}uidToIndex(t){return this.pages.findIndex((e=>e.uid===t))}uidsToIndices(t){return t.map((t=>this.uidToIndex(t)))}indexToUid(t){var e;return null===(e=this.pages[t])||void 0===e?void 0:e.uid}indicesToUids(t){return t.map((t=>this.indexToUid(t)))}updateShiftReference(){this.shiftReference=this.currentUid}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid}}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0}}class TE extends Ju{constructor(t){super(),na(this,"tabActivationStack",void 0),na(this,"tabs",void 0),na(this,"activeTabUid",void 0),na(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=t}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose()}updateViewportSize(t,e){const i=this.getActiveTab();null!=i&&i.isDocType&&i.updateViewportSize(t,e)}createTab(t){if(this.tabs.has(t.uid))return this.tabs.get(t.uid);let e=null;return"document"===t.type&&(e=new _E(t,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(e.uid,e),e}closeTab(t){if(!this.tabs.has(t))return!1;const{tabActivationStack:e}=this;if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1)}return this.getTab(t).isActive=!1,this.tabs.delete(t),this.activeTabUid===t&&(this.activeTabUid=e[e.length-1]),!0}getTab(t){return this.tabs.get(t)}getDocTab(t){const e=this.getTab(t);return null!=e&&e.isDocType?e:null}hasTab(t){return this.tabs.has(t)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(t){if(!this.tabs.has(t))return!1;const{tabActivationStack:e}=this;if(this.context.viewerConfig.enableMultiTab){if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1)}}else e.length=0;return e.push(t),this.activeTabUid=t,this.tabs.forEach((e=>{e.isActive=e.uid===t})),!0}clearTabs(){this.getAllTabs().forEach((t=>{t.destroy()})),this.tabs.clear()}resizeScrollbar(){this.tabs.forEach((t=>{t.context.isScrollbarResized=!0}))}}class EE{constructor(t){na(this,"parsedPageStyleCache",void 0),na(this,"parsedCurrentPageStyleCache",void 0),na(this,"parsedSelectedPageStyleCache",void 0),na(this,"parsedHoveredPageStyleCache",void 0),na(this,"parsedPlaceholderStyleCache",void 0),na(this,"parsedCheckboxStyleCache",void 0),na(this,"parsedPageNumberStyleCache",void 0),na(this,"parsedQuadSelectionStyleCache",void 0),na(this,"parsedCanvasStyleCache",void 0),na(this,"context",void 0),na(this,"isPageStyleChanged",void 0),na(this,"isCurrentPageStyleChanged",void 0),na(this,"isSelectedPageStyleChanged",void 0),na(this,"isHoveredPageStyleChanged",void 0),na(this,"isPlaceholderStyleChanged",void 0),na(this,"isCheckboxStyleChanged",void 0),na(this,"isPageNumberStyleChanged",void 0),na(this,"isQuadSelectionStyleChanged",void 0),na(this,"isCanvasStyleChanged",void 0),this.context=t}getParsedCanvasStyle(){return!this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=PE(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(t){return!this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=PE(this.context.viewerConfig.checkboxStyle,t),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(t){return!this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=PE(this.context.viewerConfig.pageNumberStyle,t),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return!this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=PE(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return!this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=PE(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return!this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=PE(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return!this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=PE(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return!this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=PE(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return!this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=PE(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return mE(t.pageStyle)===mE(t.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return mE(t.selectedPageStyle)===mE(t.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:t}=this.context;return mE(t.pageStyle)===mE(t.selectedPageStyle)}}function PE(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const i={};if(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:i,ctrlBorder:n}=t;if(!Hd(i)){const t=fE(i);Object.assign(e,t)}if(!Hd(n)){const t=fE(n);Object.assign(e,{ctrlBorderWidth:t.borderWidth,ctrlBorderColor:t.borderColor,ctrlBorderStyle:t.borderStyle})}}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};AE.forEach((i=>{Hd(t[i])||(e[i]=mg(t[i]).value||0)}))}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};IE.forEach((i=>{Hd(t[i])||(e[i]=t[i])}))}(t,i),function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!Hd(t.width)&&(i.width=vE(t.width,e.width),Hd(t.translateX)||(i.translateX=vE(t.translateX,i.width)),!Hd(t.borderRadius))){const e=vE(t.borderRadius,i.width);i.borderRadiusX=Math.max(0,Math.min(e,i.width/2))}if(!Hd(t.height)&&(i.height=vE(t.height,e.height),Hd(t.translateY)||(i.translateY=vE(t.translateY,i.height)),!Hd(t.borderRadius))){const e=vE(t.borderRadius,i.height);i.borderRadiusY=Math.max(0,Math.min(e,i.height/2))}if(!Hd(t.borderRadius)){const n=vE(t.borderRadius,e.width);i.borderRadius=Math.max(0,Math.min(n,e.height/2,e.width/2))}if(!Hd(t.ctrlBorderRadius)){const e=vE(t.ctrlBorderRadius,i.ctrlWidth);i.ctrlBorderRadius=Math.max(0,Math.min(e,i.ctrlWidth/2,i.ctrlHeight/2))}DE.forEach((n=>{const s=["left","right"].includes(n)?e.width:e.height,o=vg(t[n]);let r=o.value;"%"===o.unit&&(r=s*o.value/100),i[n]=r}))}(t,e,i),t.left||t.right||t.bottom||t.top){const{left:n,top:s,right:o,bottom:r,width:a,height:l,translateX:h,translateY:c}=i;""!==t.left?i.x=n+h||0:""!==t.right&&qd(a)?i.x=e.width-a-o+h||0:i.x=0,""!==t.top?i.y=s+c||0:""!==t.bottom&&qd(l)?i.y=e.height-l-r+c||0:i.y=0}return i}const AE=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],IE=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],DE=["left","top","right","bottom"],kE="visible",RE="hidden";class ME{constructor(t){na(this,"context",void 0),this.context=t}handleVisibility(t){if(this.context.isDestroyed||t.isDestroyed||!t.total||!t.isActive)return;const{context:e}=this;if(e.isDefaultViewer?t.context.isContinuousDisplay?this.continuousVisibility(t):t.context.isSingleDisplay&&this.singleVisibility(t):e.isThumbnailViewer?this.thumbnailVisibility(t):e.isPerspectiveViewer&&t.context.isSingleDisplay&&this.singleVisibility(t),t.context.pagePreloadChanges.length){t.context.pagePreloadChanges.forEach((e=>{if(e.from&&!e.to){const i=t.getPageByUid(e.pageUid);i&&(i.isLoaded=!1)}}));const i=DS.create(t.uid,e.uid,e.viewerConfig.viewerMode,t.context.pagePreloadChanges);e.core.viewerService.onPagePreloadChanged.emit(i)}}thumbnailVisibility(t){const{total:e}=t;if(!e)return;const i=t.context;if(i.isOutOfBounds)return void t.pages.forEach((t=>{t.updateStyle({visibility:"hidden"})}));const{rows:n,columns:s,placeholderPages:o,preloadCount:r,isVertical:a}=i,{width:l,height:h}=o[0],c=i.getParsedPageStyle(),d=i.getParsedCurrentPageStyle(),u=i.getParsedSelectedPageStyle(),p=i.getParsedHoveredPageStyle(),g=i.getParsedPlaceholderStyle(),f=i.getParsedPageNumberStyle(l,h),m=i.getParsedCheckboxStyle(l,h),{visibility:v,top:y,bottom:x,onPage:w,height:b}=f;let C=0;const S="visible"===v,_=i.getPageNumberStyle();if(S){const t=""!==_.top?y:x||0;w||(C=""!==_.top?b+t:0)}const{realColumn:T,realRow:E}=i.getRealRowAndColumnThumbnail(),{startRow:P,endRow:A}=this.getVisibleRow(t,E,T),{startColumn:I,endColumn:D}=this.getVisibleColumn(t,E,T);t.context.startRow=P,t.context.endRow=A,t.context.startColumn=I,t.context.endColumn=D;const k=xE(d.borderWidth),R=[];t.pages.forEach(((e,i)=>{const o=a?Math.floor(i/s):i%n,l=a?i%s:Math.floor(i/n),h=o>=P-r&&o<=A+r&&l>=I-r&&l<=D+r,v=o>=P&&o<=A&&l>=I&&l<=D?kE:RE;e.isPreload!==h&&R.push({from:e.isPreload,to:h,pageUid:e.uid,index:i});let y={borderWidth:0,background:"#ffffff00"};e.isDragging&&(y=g);let x=c;e.isHovered&&(x=p),e.isSelected&&(x=u);const b=xE(x.borderWidth);if(e.isPreload=h,e.updateStyle({visibility:v,...y}),e.borderBox.updateStyle({...x,visibility:v,borderWidth:b}),S){let t=f.y;w||(t=""!==_.top?-C:f.y+f.bottom),e.pageNumber.parsedPageNumberStyle={...f,y:t},e.pageNumber.updateText((i+1).toString())}e.pageNumber.updateStyle({visibility:f.visibility,zIndex:f.onPage?1:0});let T=m.visibility;m.visibleByHover&&(T=e.isHovered||e.isSelected?m.visibility:"hidden"),e.checkbox.parsedCheckboxStyle={...m},e.checkbox.updateStyle({visibility:T}),e.checkbox.checked=e.isSelected,e.curBox.updateStyle({...d,visibility:e.uid===t.currentUid?kE:RE,borderWidth:k})})),t.context.pagePreloadChanges=R}continuousVisibility(t){const{preloadCount:e,isVertical:i}=t.context,{pages:n}=t,s=t.context.getParsedPageStyle(),o=t.context.getParsedCurrentPageStyle(),{realRow:r,realColumn:a}=t.context.getRealRowAndColumnContinuous(),{startRow:l,endRow:h}=this.getVisibleRow(t,r,a),{startColumn:c,endColumn:d}=this.getVisibleColumn(t,r,a);t.context.startRow=l,t.context.endRow=h,t.context.startColumn=c,t.context.endColumn=d;const u=xE(s.borderWidth),p=xE(o.borderWidth),g=[];n.forEach(((n,f)=>{const m=i?Math.floor(f/a):f%r,v=i?f%a:Math.floor(f/r),y=m>=l&&m<=h&&v>=c&&v<=d,x=m>=l-e&&m<=h+e&&v>=c-e&&v<=d+e;n.isPreload!==x&&g.push({from:n.isPreload,to:x,pageUid:n.uid,index:f}),n.checkbox.updateStyle({visibility:RE}),n.pageNumber.updateStyle({visibility:RE}),n.curBox.updateStyle({...o,visibility:n.uid===t.currentUid?kE:RE,borderWidth:p}),n.borderBox.updateStyle({...s,borderWidth:u}),n.updateStyle({visibility:y?kE:RE}),n.isPreload=x})),t.context.pagePreloadChanges=g}singleVisibility(t){const{preloadCount:e}=t.context,{current:i,total:n,pages:s}=t,o=t.getCurrentPage(),r=t.context.getParsedPageStyle(),a=Math.max(i-e,0),l=Math.min(i+e,n-1);o.checkbox.updateStyle({visibility:RE}),o.pageNumber.updateStyle({visibility:RE});const h=xE(r.borderWidth),c=[];s.forEach(((t,e)=>{const i=e>=a&&e<=l,n=t.uid===o.uid;t.isPreload!==i&&c.push({from:t.isPreload,to:i,pageUid:t.uid,index:e}),t.borderBox.updateStyle({...r,borderWidth:h}),t.updateStyle({visibility:n?kE:RE}),t.isPreload=i,t.curBox.updateStyle({visibility:RE})})),t.context.pagePreloadChanges=c}getVisibleColumn(t,e,i){const{scrollLeft:n,placeholderPages:s,currentViewportWidth:o,isVertical:r}=t.context;let a=0,l=i-1;if(r&&this.context.isThumbnailViewer)return{startColumn:a,endColumn:l};let h=Number.MAX_VALUE,c=Number.MAX_VALUE,d=null,u=null;for(let t=0;t<i;t++){const i=s[r?t:t*e];if(!i)continue;const{width:p,x:g}=i;if(null===d){const e=g-n;e<=0&&n-(g+p)<-1?(d=t,a=t):e>0&&e<h&&(h=e,a=t)}if(null===u){const e=n+o,i=e-(g+p);g-e<-1&&i<=0?(u=t,l=t):i>0&&i<c&&(c=i,l=t)}if(null!==d&&null!==u)break}return{startColumn:a,endColumn:l}}getVisibleRow(t,e,i){const{scrollTop:n,placeholderPages:s,currentViewportHeight:o,isVertical:r}=t.context;let a=0,l=e-1;if(!r&&this.context.isThumbnailViewer)return{startRow:a,endRow:l};let h=Number.MAX_VALUE,c=Number.MAX_VALUE,d=null,u=null;for(let t=0;t<e;t++){const e=s[r?t*i:t];if(!e)continue;const{y:p,height:g}=e;if(null===d){const e=p-n;e<=0&&n-(p+g)<-1?(d=t,a=t):e>0&&e<h&&(h=e,a=t)}if(null===u){const e=n+o,i=e-(p+g);p-e<-1&&i<=0?(u=t,l=t):i>0&&i<c&&(c=i,l=t)}if(null!==d&&null!==u)break}return{startRow:a,endRow:l}}}function LE(t,e,i,n){const s={isOver:!1,pointerX:-1,pointerY:-1,page:t};if(t&&n){const{x:n,y:o}=t.getPosition(),{width:r,height:a}=t;s.isOver=e>=n&&i>=o&&e<=n+r&&i<=o+a;const l=t.getScale();s.pointerX=(e-n)/l.x,s.pointerY=(i-o)/l.y}return s}const OE={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},BE={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},FE={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},NE={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},UE={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},VE={tag:"div",id:"ddv-core",className:"ddv-core"};class WE extends Ju{constructor(t,e){super(),na(this,"container",void 0),na(this,"defaultDom",void 0),na(this,"mainAndThbContainer",void 0),na(this,"thumbnailContainer",void 0),na(this,"mainContainer",void 0),na(this,"scrollerAndCanvasContainer",void 0),na(this,"scrollContainer",void 0),na(this,"scrollContent",void 0),na(this,"canvasContainer",void 0),na(this,"videoContainer",void 0),na(this,"audioContainer",void 0),na(this,"rootDom",void 0),na(this,"hooks",void 0),na(this,"isBindContainer",!1),na(this,"viewportWidth",void 0),na(this,"viewportHeight",void 0),na(this,"context",void 0),na(this,"dpr",Pu()),na(this,"hasScrollbarX",!1),na(this,"hasScrollbarY",!1),na(this,"winResizeTimer",void 0),this.context=t,this.hooks=e;const i=P_(VE,t.postfix);this.defaultDom=i}dispose(){var t,e;null===(t=this.rootDom)||void 0===t||t.remove(),null===(e=this.thumbnailContainer)||void 0===e||e.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose()}createMainAndThbContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainAndThbContainer){const e=P_(UE,t);this.mainAndThbContainer=e,this.defaultDom.appendChild(e)}}createMainContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const e=P_(BE,t);this.mainContainer=e,this.mainAndThbContainer.appendChild(e);const i=e.querySelector(`#ddv-scroller-and-canvas${t}`),n=e.querySelector(`#ddv-canvas-container${t}`),s=e.querySelector(`#ddv-scroll-container${t}`),o=e.querySelector(`#ddv-scroll-content${t}`);this.scrollerAndCanvasContainer=i,this.canvasContainer=n,this.scrollContainer=s,this.scrollContent=o;const r=()=>{this.winResizeTimer&&clearTimeout(this.winResizeTimer),this.winResizeTimer=window.setTimeout((()=>{var t;null===(t=this.context)||void 0===t||t.resize()}),200)};window.addEventListener("resize",r);const a=t=>{t.target===e&&this.isBindContainer&&this.context.isInitialized&&this.context.resize()},{resizeService:l}=this.context.core;l.observe(e),l.onResizeObserver.on(a,this),this.context.hooks.destroy.on((()=>{l.unobserve(e),window.removeEventListener("resize",r)}))}}createThumbnailContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.thumbnailContainer){const e=P_(OE,t);this.thumbnailContainer=e,this.mainAndThbContainer.insertBefore(e,this.mainContainer)}}createVideoContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.videoContainer){const e=P_(FE,t);this.mainContainer.appendChild(e)}}createAudioContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.audioContainer){const e=P_(NE,t);this.mainContainer.appendChild(e)}}getViewportSize(){if(!this.mainContainer)return{width:0,height:0};const{offsetWidth:t,offsetHeight:e}=this.getElSize(this.mainContainer),i=this.getCanvasBorderSize();return{width:t-2*i,height:e-2*i}}resetViewport(){const{scrollContent:t,canvasContainer:e}=this;yE(e,0,0),yE(t,0,0);const{width:i,height:n}=this.getViewportSize();this.viewportWidth=i,this.viewportHeight=n,this.updateCanvasContainerSize()}resizeViewport(){const{canvasContainer:t,scrollContainer:e}=this;yE(t,0,0);const{offsetWidth:i,offsetHeight:n}=this.getElSize(e);this.viewportWidth=i,this.viewportHeight=n,this.updateCanvasContainerSize()}checkIsRound(t){const e=getComputedStyle(t);return{roundWidth:parseFloat(e.width)%1>=.5,roundHeight:parseFloat(e.height)%1>=.5}}getElSize(t){const{roundWidth:e,roundHeight:i}=this.checkIsRound(t);let{clientWidth:n,clientHeight:s,offsetWidth:o,offsetHeight:r}=t;return e&&(n-=1,o-=1),i&&(s-=1,r-=1),{clientWidth:n,clientHeight:s,offsetWidth:o,offsetHeight:r}}getMaxScrollValue(){const{scrollContainer:t}=this;return{scrollLeft:t.scrollWidth-t.clientWidth,scrollTop:t.scrollHeight-t.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const t=Pu();return this.dpr!==t&&(this.dpr=t,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(t){let e=t;return t&&Zd(t)&&(e=document.querySelector(`#${t}`)),e instanceof HTMLElement&&(e.appendChild(this.defaultDom),this.container=e,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return!1;for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(t,e){const{scrollContainer:i}=this;i.scrollTo?i.scrollTo(t,e):(i.scrollLeft=t,i.scrollTop=e)}scrollBy(t,e){const{scrollContainer:i}=this;i.scrollBy?i.scrollBy(t,e):(i.scrollLeft+=t,i.scrollTop+=e)}updateScrollerContentSize(t){const{currentLayoutWidth:e,currentLayoutHeight:i}=t.context,{scrollContent:n,canvasContainer:s,scrollContainer:o}=this;yE(s,10,10),yE(n,e,i);let r=o.scrollWidth-o.clientWidth,a=o.scrollHeight-o.clientHeight;const l=getComputedStyle(o),h=getComputedStyle(n),c=parseFloat(l.width),d=parseFloat(l.height);c>=parseFloat(h.width)&&(r=0),d>=parseFloat(h.height)&&(a=0),t.context.maxScrollLeft=r,t.context.maxScrollTop=a;const u=r>0,p=a>0;let g=!1;u!==this.hasScrollbarX&&(this.hasScrollbarX=u,g=!0),p!==this.hasScrollbarY&&(this.hasScrollbarY=p,g=!0),g&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize()}updateCanvasContainerSize(){const{scrollContainer:t,canvasContainer:e}=this,{width:i,height:n}=getComputedStyle(this.scrollContainer);let s,o=parseFloat(i),r=parseFloat(n);t.offsetWidth!==t.clientWidth&&(qd(s)||(s=CE()),o-=s),t.offsetHeight!==t.clientHeight&&(qd(s)||(s=CE()),r-=s),yE(e,o,r)}getCanvasBorderSize(){const{canvasContainer:t}=this;return(t.offsetWidth-t.clientWidth)/2}}class HE{constructor(){na(this,"canvasDom",void 0),na(this,"canvas",void 0),na(this,"renderer",void 0),na(this,"isInitialized",!1),na(this,"canvasWidth",0),na(this,"canvasHeight",0)}clear(){var t;const e=null===(t=this.canvas)||void 0===t?void 0:t.document.documentElement;e&&(e.children.slice().forEach((t=>{e.removeChild(t)})),e.sortable.sorted=[])}render(t){var e;const i=null===(e=this.canvas)||void 0===e?void 0:e.document.documentElement;if(i){if(t)0===i.children.length?i.appendChild(t):i.children.indexOf(t)<0&&i.replaceChild(t,i.children[0]);else{const t=[...i.children];for(let e=t.length;e>=0;e--)i.removeChild(t[e])}this.canvas.render()}}initCanvas(t){let{container:e,width:i,height:n,limit1px:s}=t;const o=new Bm({}),r=new vm({renderer:o,container:e,width:i,height:n});r.limit1px=s,this.canvasWidth=i,this.canvasHeight=n,this.renderer=o,this.canvas=r,this.canvasDom=r.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0}registerShapeRenderer(t,e){this.canvas.contextService.registerShapeRenderer(t,e)}getCanvasPosition(){const t=this.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return{x:t.left+e,y:t.top+i}}resize(t,e){const i=Pu();this.canvas.setDPR(i),this.canvasWidth=t,this.canvasHeight=e,this.canvas.resize(t,e)}}class jE{render(t,e){const{opacity:i,visibility:n}=t.parsedCheckboxStyle;0!==i&&"hidden"!==n&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderCheckMark(t,e),e.restore())}renderBox(t,e,i){const{x:n,y:s,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedCheckboxStyle;let c=0;"center"===i?c=a/2:"in"===i&&(c=a);const d=[{x:n+l,y:s+h,start:Math.PI,end:3*Math.PI/2},{x:n+o-l,y:s+h,start:3*Math.PI/2,end:2*Math.PI},{x:n+o-l,y:s+r-h,start:0,end:Math.PI/2},{x:n+l,y:s+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-c,0),p=Math.max(h-c,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:n,start:s,end:o}=d[t];e.ellipse(i,n,u,p,0,s,o)}else e.rect(n,s,o,r);e.closePath()}fill(t,e){const{background:i}=t.parsedCheckboxStyle;i&&""!==i&&(e.fillStyle=i,e.fill())}stroke(t,e){const{borderColor:i,borderWidth:n,borderStyle:s}=t.parsedCheckboxStyle;e.setLineDash(s),e.strokeStyle=i,e.lineWidth=n,n>0&&i&&""!==i&&e.stroke()}renderCheckMark(t,e){if(!t.checked)return;const{x:i,y:n,width:s,height:o,borderWidth:r,checkMarkLineWidth:a,checkMarkColor:l}=t.parsedCheckboxStyle,h=Math.max(Math.min(s-2*r,o-2*r),0);let c=i,d=n;0!==h&&(s<o?(c+=r,d=d+r+(o-s)/2):(c=c+r+(s-o)/2,d+=r),e.setLineDash([0,0]),e.lineWidth=a,e.strokeStyle=l,e.beginPath(),e.moveTo(c+.15*h,d+.5*h),e.lineTo(c+.4*h,d+.8*h),e.lineTo(c+.85*h,d+.2*h),e.stroke())}}class zE{render(t,e){const{opacity:i,visibility:n}=t.parsedPageNumberStyle;0!==i&&"hidden"!==n&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderFont(t,e),e.restore())}renderBox(t,e,i){const{x:n,y:s,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedPageNumberStyle;let c=0;"center"===i?c=a/2:"in"===i&&(c=a);const d=[{x:n+l,y:s+h,start:Math.PI,end:3*Math.PI/2},{x:n+o-l,y:s+h,start:3*Math.PI/2,end:2*Math.PI},{x:n+o-l,y:s+r-h,start:0,end:Math.PI/2},{x:n+l,y:s+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-c,0),p=Math.max(h-c,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:n,start:s,end:o}=d[t];e.ellipse(i,n,u,p,0,s,o)}else e.rect(n,s,o,r);e.closePath()}renderFont(t,e){const{x:i,y:n,width:s,height:o,fontSize:r,color:a,fontFamily:l}=t.parsedPageNumberStyle;e.fillStyle=a,e.textAlign="center",e.textBaseline="middle",l.includes(" ")?e.font=`${r}px '${l}'`:e.font=`${r}px ${l}`,e.fillText(t.text,i+s/2,n+o/2+r/8,s)}fill(t,e){const{background:i}=t.parsedPageNumberStyle;i&&""!==i&&(e.fillStyle=i,e.fill())}stroke(t,e){const{borderColor:i,borderWidth:n,borderStyle:s}=t.parsedPageNumberStyle;e.setLineDash(s),e.strokeStyle=i,e.lineWidth=n,n>0&&i&&""!==i&&e.stroke()}}class GE extends Ju{constructor(t,e){super(),na(this,"context",void 0),na(this,"docRenderer",void 0),na(this,"hooks",void 0),this.context=t,this.hooks=e,this.docRenderer=new HE}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null}initRenderer(t,e,i){if(!this.docRenderer.isInitialized){Object.assign(t.style,this.context.viewerConfig.canvasStyle);const n=this.context.isDefaultViewer;this.docRenderer.initCanvas({container:t,width:e,height:i,limit1px:n}),this.docRenderer.registerShapeRenderer("checkbox",new jE),this.docRenderer.registerShapeRenderer("pageNumber",new zE)}}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const t=this.getCanvasDom();t&&t.getContext("2d").clearRect(0,0,t.width,t.height)}resize(t,e){this.docRenderer&&this.docRenderer.resize(t,e)}updateCanvasSize(){if(this.docRenderer){const t=this.getCanvasDom();if(!t)return;const{clientWidth:e,clientHeight:i}=t;this.docRenderer.resize(e,i)}}render(t){t.isDestroyed||(this.hooks.beforeRender.emit(t),this.docRenderer.render(t),this.hooks.afterRender.emit(t),t.pages.forEach(((t,e)=>{if(t.isVisible&&t.isLoaded){const i=WC.create(e,t.uid);this.context.emit("pageRendered",i)}})))}getCanvasPosition(){const t=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}=window;return{x:t.left+e,y:t.top+i}}}function YE(t){const e=t.getPages(),i=e.length;if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{viewportWidth:n,viewportHeight:s}=t;const{rows:o,columns:r,scrollbarWidth:a,tab:l,isVertical:h}=t,c=t.getMargin();r*o<i&&(h?n-=a:s-=a);let d=0,u=0;h?(d=(n-(r+1)*c)/r,u=(s-(o+1)*c)/o):(u=(s-(o+1)*c)/o,d=(n-(r+1)*c)/r);let p=!1;(d<0||u<0)&&(p=!0,d=Math.max(0,d),u=Math.max(0,u));const g=h?Math.max(o,Math.ceil(i/r)):o,f=h?r:Math.max(r,Math.ceil(i/o)),m=d*f+(f+1)*c,v=u*g+(g+1)*c,y=l.pages.map((t=>({uid:t.uid,x:0,y:0,width:d,height:u}))),x=t.getParsedPageStyle(),w=t.getParsedSelectedPageStyle(),b=t.getParsedHoveredPageStyle(),C=t.getParsedPageNumberStyle(d,u),{visibility:S,top:_,bottom:T,onPage:E,height:P}=C;let A=d,I=u;const D=d;let k=u,R=0;const M="visible"===S,L=t.getPageNumberStyle();if(M){const t=""!==L.top?_:T||0;E||(I=u-P-t,k=u-P-t,R=""!==L.top?P+t:0)}I<0&&(p=!0,I=Math.max(0,I)),(A-2*x.borderWidth<0||I-2*x.borderWidth<0)&&(p=!0);const O=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=p?0:m+2*O,t.currentLayoutHeight=p?0:v+2*O,t.currentViewportWidth=p?t.viewportWidth:n,t.currentViewportHeight=p?t.viewportHeight:s,t.isOutOfBounds=p,p||(A=bE(A),I=bE(I),e.forEach(((e,i)=>{let n=x.borderWidth;e.isHovered&&(n=b.borderWidth),e.isSelected&&(n=w.borderWidth),n=xE(n);const s=h?i%r:Math.floor(i/o),a=h?Math.floor(i/r):i%o,l=c+s*(c+d),p=c+a*(c+u);y[i].x=l,y[i].y=p;let g=A-2*n,f=I-2*n;g=Math.max(g,0),f=Math.max(f,0);const m=e.rWidth,v=e.rHeight;let C=m,S=v,_=1;(m>g||v>f)&&(m/v>g/f?(_=g/m,C=g,S=v*_):(_=f/v,S=f,C=m*_)),e.zoom=_;const T=wE(l),E=wE(p+R);let P=n+(g-C)/2,M=n+(f-S)/2;P=wE(P),M=wE(M);const L=bE(m),O=bE(v),B=m*(1-_)/2,F=v*(1-_)/2,N=e.cropWidth,U=e.cropHeight,V=P-B-(N-L)/2,W=M-F-(U-O)/2,H=P-B,j=M-F,z=L,G=O,Y=P,$=M,X=bE(C),q=bE(S);e.setPage(T,E,D,k),e.setBorderBox(0,0,A,I,n),e.setCropBox(V,W,N,U,_,e.rotation),e.setRealTimeBox(H,j,z,G,_);const{width:Z,height:J}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,Z,J),e.setImage(0,0,Z,J),e.setCurBox(Y,$,X,q)})),t.placeholderPages=y)}function $E(t){const{tab:e}=t,i=e.getCurrentPage();if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);const{viewportWidth:n,viewportHeight:s,scrollbarWidth:o,fitMode:r}=t,a=t.getMargin(),l=t.getParsedPageStyle(),{borderWidth:h=0}=l,c=2*h,d=i.rWidth,u=i.rHeight,p=2*a,g=c+p,f=c+p,m=n-g,v=s-f;let{zoom:y}=t;const x=qE(r,{zoom:y,validLayoutWidth:d,validLayoutHeight:u,scrollbarWidth:o,fitViewportWidth:m,fitViewportHeight:v,isZoomChanged:t.isZoomChanged},XE);t.isZoomChanged=!1;const{zoomedLayoutWidth:w,zoomedLayoutHeight:b,zoomedViewportWidth:C,zoomedViewportHeight:S,newFitMode:_}=x;if(y=x.zoom,_&&r!==_){t.fitMode=_,t.viewerContext.viewerConfig.fitMode=_;const e=NC.create(r,_);t.viewerContext.hooks.fitModeChanged.emit(e)}t.setZoom(y);const T=w+g,E=b+f,P=C+g,A=S+f,I=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=T+2*I,t.currentLayoutHeight=E+2*I,t.currentViewportWidth=P,t.currentViewportHeight=A,i.zoom=y,t.tab.setPosition({x:-0,y:-0});const D=e.pages.map((t=>{let{uid:e}=t;return{uid:e,x:a,y:a,width:w+c,height:b+c}}));t.placeholderPages=D;const k=bE(w+c),R=bE(b+c),M=wE(a),L=M,O=xE(h),B=O,F=bE(d),N=bE(u),U=d*(1-y)/2,V=u*(1-y)/2,W=i.cropWidth,H=i.cropHeight,j=O-U-(W-F)/2,z=B-V-(H-N)/2,G=O-U,Y=B-V;i.setPage(M,L,k,R),i.setBorderBox(0,0,k,R),i.setCropBox(j,z,W,H,y,i.rotation),i.setRealTimeBox(G,Y,d,u,y);const{width:$,height:X}=t.viewerContext.getPageRenderSize(i.uid);i.setMediaBox(-i.cropLeft,-i.cropTop,$,X),i.setImage(0,0,$,X)}function XE(t,e){let{zoom:i,validLayoutWidth:n,validLayoutHeight:s,scrollbarWidth:o,fitViewportWidth:r,fitViewportHeight:a}=e;return"none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(n*i)>r&&(a-=o),Math.floor(s*i)>a&&(r-=o)):"width"===t||"window"===t&&n/r>=s/a?(i=r/n,s*i>a&&(r-=o,i=r/n)):(i=a/s,n*i>r&&(a-=o,i=a/s)),{zoom:i,zoomedLayoutWidth:n*i,zoomedLayoutHeight:s*i,zoomedViewportWidth:r,zoomedViewportHeight:a}}function qE(t,e,i){const{zoom:n,isZoomChanged:s}=e;let o={};if(s){let s;const r=D_(n);1===n?(s="actualSize",o=i("actualSize",e)):(o=i("width",e),D_(o.zoom)===r?(s="width","window"===t&&(s="window")):(o=i("height",e),r===D_(o.zoom)&&(s="height","window"===t&&(s="window")))),s?o.newFitMode=s:(o=i("none",e),o.newFitMode="none")}else o=i(t,e);return o}function ZE(t,e){let{zoom:i,fitWidth:n,fitHeight:s,validLayoutWidth:o,validLayoutHeight:r,scrollbarWidth:a,isVertical:l,fitViewportWidth:h,fitViewportHeight:c}=e;return"none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(o*i)>h&&(c-=a),Math.floor(r*i)>c&&(h-=a)):"width"===t||"window"===t&&n/h>=s/c?(i=h/n,l?r*i>c&&(h-=a,i=h/n):(o*i>h&&(c-=a),s*i>c&&(h-=a,i=h/n))):(i=c/s,l?(r*i>c&&(h-=a),n*i>h&&(c-=a,i=c/s)):o*i>h&&(c-=a,i=c/s)),{zoom:i,zoomedLayoutWidth:o*i,zoomedLayoutHeight:r*i,zoomedViewportWidth:h,zoomedViewportHeight:c}}const JE=t=>{const e=t.getPages();if(!e.length)return;const{tab:i}=t,n=i.current,s=e[n-1],o=e[n+1];s&&KE(t,s,-1),o&&KE(t,o,1)};function KE(t,e,i){const{viewportWidth:n,viewportHeight:s}=t,o=t.getParsedPageStyle(),{borderWidth:r=0}=o,a=t.getMargin(),{rWidth:l,rHeight:h}=e,c=n-2*a-2*r,d=s-2*a-2*r;let u=0,p=0,g=1;l/h>c/d?(u=c,g=c/l,p=h*g):(p=d,g=d/h,u=l*g);let f=(c-u)/2+a,m=(d-p)/2+a;f=Math.max(a,f),m=Math.max(a,m);const{x:v,y}=t.tab.getPosition();-1===i?(f=-n+f-v,m-=y):1===i&&(f=n+f-v,m-=y);const x=l*(1-g)/2,w=h*(1-g)/2,b=r,C=r,S=l,_=h,T=e.cropWidth,E=e.cropHeight,P=b-x-(T-S)/2,A=C-w-(E-_)/2,I="visible",D="hidden";e.updateStyle({visibility:I,x:f,y:m,width:u+2*r,height:p+2*r}),e.borderBox.updateStyle({x:0,y:0,width:u+2*r,height:p+2*r,...o,background:"#ffffff00",visibility:I}),e.cropBox.setLocalScale(1),e.cropBox.updateStyle({x:P,y:A,width:T,height:E}),e.cropBox.setLocalScale(g,g,1),e.cropBox.setLocalAngle(e.rotation);const{width:k,height:R}=t.viewerContext.getPageRenderSize(e.uid);e.mediaBox.updateStyle({x:-e.cropLeft,y:-e.cropTop,width:k,height:R}),e.zoom=g,e.checkbox.updateStyle({visibility:D}),e.pageNumber.updateStyle({visibility:D}),e.setImage(0,0,k,R)}function QE(t){const{displayMode:e}=t;"single"===e?$E(t):"continuous"===e?function(t){const e=t.getPages();if(!e.length)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{zoom:i}=t;const{viewportWidth:n,viewportHeight:s,tab:o,fitMode:r,scrollbarWidth:a,isVertical:l}=t,h=t.getParsedPageStyle(),{borderWidth:c}=h,d=2*c,u=t.getMargin(),{realRow:p,realColumn:g}=t.getRealRowAndColumnContinuous(),f=new Array(g).fill(0),m=new Array(p).fill(0);let v=0,y=0;e.forEach(((t,e)=>{const i=l?Math.floor(e/g):e%p,n=l?e%g:Math.floor(e/p),s=t.rWidth+d,o=t.rHeight+d;f[n]=Math.max(f[n],s),m[i]=Math.max(m[i],o),v=Math.max(f[n],v),y=Math.max(m[i],y)}));let x=f.reduce(((t,e)=>t+e),0),w=m.reduce(((t,e)=>t+e),0);const b=(g+1)*u,C=(p+1)*u,S=g*d+b,_=p*d+C;x+=b,w+=C;const T=x-S,E=w-_;let P=0,A=0,I=0,D=0;l?(P=n-S,A=s-2*u-d,I=f.reduce(((t,e)=>t+e-d),0),D=y-d):(P=n-2*u-d,A=s-_,I=v-d,D=m.reduce(((t,e)=>t+e-d),0));const k=qE(r,{zoom:i,fitWidth:I,fitHeight:D,validLayoutWidth:T,validLayoutHeight:E,scrollbarWidth:a,isVertical:l,fitViewportWidth:P,fitViewportHeight:A,isZoomChanged:t.isZoomChanged},ZE);t.isZoomChanged=!1;const{zoomedLayoutWidth:R,zoomedLayoutHeight:M,zoomedViewportWidth:L,zoomedViewportHeight:O,newFitMode:B}=k;if(i=k.zoom,B&&r!==B){t.fitMode=B,t.viewerContext.viewerConfig.fitMode=B;const e=NC.create(r,B);t.viewerContext.hooks.fitModeChanged.emit(e)}t.setZoom(i);const F=R+S,N=M+_;let U=0,V=0;l?(U=L+(g+1)*u+g*d,V=O+2*u+d):(U=L+2*u+d,V=O+(p+1)*u+p*d);const W=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=F+2*W,t.currentLayoutHeight=N+2*W,t.currentViewportWidth=U,t.currentViewportHeight=V,t.tab.setPosition({x:-0,y:-0});const H=o.pages.map((t=>({uid:t.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0})));e.forEach(((e,n)=>{const s=l?Math.floor(n/g):n%p,o=l?n%g:Math.floor(n/p),r=(f[o]-d)*i+d,a=(m[s]-d)*i+d,h=e.rWidth,v=e.rHeight;let y=0,x=0;if(0===o)y=u;else{const t=H[l?n-1:(o-1)*p+s];y=t.x+t.width+u}if(0===s)x=u;else{const t=H[l?(s-1)*g+o:n-1];x=t.y+t.height+u}const w=H[n];w.width=r,w.height=a,w.x=y,w.y=x,e.zoom=i;const b=h*i,C=v*i,S=x+(a-C)/2-c,_=wE(y+(r-b)/2-c),T=wE(S);w.pageX=_,w.pageY=T;let E=b+d,P=C+d;E=bE(E),P=bE(P);const A=wE(c),I=A,D=bE(h),k=bE(v),R=h*(1-i)/2,M=v*(1-i)/2,L=A,O=A,B=bE(b),F=bE(C),N=e.cropWidth,U=e.cropHeight,V=A-R-(N-D)/2,W=I-M-(U-k)/2,j=A-R,z=I-M;e.setPage(_,T,E,P),e.setBorderBox(0,0,E,P),e.setCropBox(V,W,N,U,i,e.rotation),e.setRealTimeBox(j,z,h,v,i);const{width:G,height:Y}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,G,Y),e.setImage(e.mediaBoxRect.left,e.mediaBoxRect.top,G,Y),e.setCurBox(L,O,B,F)})),t.placeholderPages=H}(t):"slide"===e&&JE(t)}class tP{constructor(t,e){na(this,"context",void 0),na(this,"hooks",void 0),this.context=t,this.hooks=e}layout(t){if(t.isDestroyed||!t.isActive)return;let e;if(this.context.isDefaultViewer)e=QE;else if(this.context.isThumbnailViewer)e=YE;else if(this.context.isPerspectiveViewer){const{displayMode:i}=t.context;"single"===i?e=$E:"slide"===i&&(e=JE)}e&&(this.hooks.beforeLayout.emit(t),e(t.context),this.hooks.afterLayout.emit(t))}}const eP=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class iP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"handlers",{}),this.context=t}dispose(){this.context=null,this.handlers={},super.dispose()}updateConfig(t){for(const[e,i]of Object.entries(t))eP.includes(e)&&this[e](i)}registerHandler(t,e){return!this[t]&&(this[t]=e,!0)}viewerMode(t){const{context:e}=this;e.viewerConfig.viewerMode=t,$b.CAPTURE}toolMode(t){const{context:e}=this,i=e.viewerConfig.toolMode;t!==i&&(e.viewerConfig.toolMode=t,e.hooks.toolModeChanged.emit(qC.create(i,t)))}annotationMode(t){const{context:e}=this,i=e.viewerConfig.annotationMode;t!==i&&(e.viewerConfig.annotationMode=t),e.hooks.annotationModeChanged.emit(tS.create(i,t))}fitMode(t){const{context:e}=this,i=e.getActiveTab();if(!i){const i=e.viewerConfig.fitMode;if(i===t)return;return e.viewerConfig.fitMode=t,void e.hooks.fitModeChanged.emit(NC.create(i,t))}const n=i.context.fitMode;n!==t&&(i.context.fitMode=t,"none"!==t&&(e.showTab(i,!0),e.hooks.fitModeChanged.emit(NC.create(n,t))))}displayMode(t){const{context:e}=this,i=e.getActiveTab();let n;if(i){if(n=i.context.displayMode,t===n)return;i.context.displayMode=t,e.showTab(i,!0)}else{if(n=e.viewerConfig.displayMode,t===n)return;e.viewerConfig.displayMode=t}if("slide"!==n&&"slide"!==t){const i=BC.create(n,t);e.viewer.hooks.displayModeChanged.emit(i)}}margin(t){const{context:e}=this;e.viewerConfig.margin!==t&&(e.viewerConfig.margin=t,e.showCurrentTab(!0))}rows(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.rows&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.rows=t,this.context.showTab(i,!0)):e.viewerConfig.rows=t}columns(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.columns&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.columns=t,this.context.showTab(i,!0)):e.viewerConfig.columns=t}maxColumns(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxColumns=t;const i=e.getActiveTab();i&&i.context.columns>t&&this.columns(t)}maxRows(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxRows=t;const i=e.getActiveTab();i&&i.context.rows>t&&this.rows(t)}zoom(t){const{context:e}=this;e.getActiveTab()&&e.zoomTo(t)}visibility(t){const{context:e}=this;if(t===e.viewerConfig.visibility)return;const{rootDom:i,defaultDom:n,thumbnailContainer:s}=e.viewService;if(!i)return;const{ui:o}=e.viewer,r=!s&&o.container.classList.contains("ddv-thumbnail-container"),a=e.viewerConfig.visibility;e.viewerConfig.visibility=t,"visible"===t?(i.style.display="flex",n.style.display="flex",r?(o.container.style.display="flex",e.core.viewerService.onResize.emit()):e.core.viewerService.onResize.emit()):(i.style.display="none",r&&(o.container.style.display="none",e.core.viewerService.onResize.emit()));const l=gS.create(t,a);e.hooks.visibleChanged.emit(l)}zoomOrigin(t){const{context:e}=this;e.viewerConfig.zoomOrigin=t}minZoom(t){const{context:e}=this;e.viewerConfig.minZoom=t}maxZoom(t){const{context:e}=this;e.viewerConfig.maxZoom=t}multiselectMode(t){const{context:e}=this;e.viewerConfig.multiselectMode=t}canvasStyle(t){const{context:e}=this;if(Vd(t))if(Object.assign(e.viewerConfig.canvasStyle,t),e.isCaptureViewer){var i;const n=null===(i=e.viewer)||void 0===i||null===(i=i.cameraContext)||void 0===i?void 0:i.cameraContainer;n&&Object.assign(n.style,t)}else{const{canvasContainer:i}=e.viewService,n=e.rendererService.getCanvasDom();i&&(Object.assign(i.style,t),t.cursor&&n&&Object.assign(n.style,{cursor:t.cursor}),e.styleService.isCanvasStyleChanged=!0,t.border&&e.resize(),t.cursor&&e.hooks.canvasCursorStyleChanged.emit())}}pageStyle(t){const{context:e}=this;Vd(t)&&(Object.assign(e.viewerConfig.pageStyle,t),e.styleService.isPageStyleChanged=!0,e.showCurrentTab(!0))}selectedPageStyle(t){const{context:e}=this;Vd(t)&&(Object.assign(e.viewerConfig.selectedPageStyle,t),e.styleService.isSelectedPageStyleChanged=!0,e.showCurrentTab(!0))}hoveredPageStyle(t){const{context:e}=this;Vd(t)&&(Object.assign(e.viewerConfig.hoveredPageStyle,t),e.styleService.isHoveredPageStyleChanged=!0,e.showCurrentTab(!0))}placeholderStyle(t){const{context:e}=this;Vd&&(Object.assign(e.viewerConfig.placeholderStyle,t),e.styleService.isPlaceholderStyleChanged=!0,e.showCurrentTab())}currentPageStyle(t){const{context:e}=this;Vd&&(Object.assign(e.viewerConfig.currentPageStyle,t),e.styleService.isCurrentPageStyleChanged=!0,e.showCurrentTab())}pageNumberStyle(t){const{context:e}=this;if(Vd(t)){const{pageNumberStyle:i}=e.viewerConfig,n=(null==t?void 0:t.onPage)!==(null==i?void 0:i.onPage);Object.assign(i,t),e.styleService.isPageNumberStyleChanged=!0,e.showCurrentTab(n)}}checkboxStyle(t){const{context:e}=this;Vd(t)&&(Object.assign(e.viewerConfig.checkboxStyle,t),e.styleService.isCheckboxStyleChanged=!0,e.showCurrentTab())}quadSelectionStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:e}=this;Vd(t)&&(Object.assign(e.viewerConfig.quadSelectionStyle,t),e.styleService.isQuadSelectionStyleChanged=!0,e.hooks.quadSelectionStyleChanged.emit(),e.showCurrentTab())}scrollDirection(t){const{context:e}=this;e.viewerConfig.scrollDirection=t;const i=e.getActiveTab();i&&(i.context.direction=t,e.resize())}}class nP extends Ju{constructor(t){super(),na(this,"context",void 0),this.context=t}dispose(){super.dispose(),this.context=null}handleExternalEvents(){const{context:t}=this,{hooks:e}=this.context;e.pageChanged.on((t=>{const i=this.context.getActiveTab();let n;!i||0===i.total||-1===i.current&&-1!==i.oldCurrent?n=0:-1!==i.current&&-1===i.oldCurrent&&(n=t.total),Hd(n)||e.pageExistenceChanged.emit(AS.create(n))})),e.pageChangedAfterRender.on((i=>{const n=this.context.getActiveTab();if(!n)return;const{current:s,oldCurrent:o,currentUid:r,oldCurrentUid:a}=n;if(o!==s){const e=OC.create(o,s);t.emit("currentIndexChanged",e)}if(a!==r){const n=KC.create(a||"",r||"");t.emit("currentPageChanged",n),e.currentPageChanged.emit(i)}})),e.displayModeChanged.on((e=>{t.emit("displayModeChanged",{...e})})),e.fitModeChanged.on((e=>{t.emit("fitModeChanged",{...e})})),e.toolModeChanged.on((e=>{t.emit("toolModeChanged",{...e})})),e.zoomChanged.on((t=>{t.oldZoomRatio!==t.newZoomRatio&&this.context.viewer.emit("zoomChanged",{...t})}));const i=this.context.rendererService.getCanvasDom();this.context.isCaptureViewer||(Qu(i,"click",this).on((e=>{const i=this.formatEvent(e);t.emit("click",i)})),Qu(i,"dblclick",this).on((e=>{const i=this.formatEvent(e);t.emit("dblclick",i)})),Qu(document.body,"dblclick",this).on((t=>{})),Qu(i,"contextmenu",this).on((e=>{e.preventDefault();const i=this.formatEvent(e);t.emit("rightclick",i)}))),t.viewerConfig.enableLoadSourceByDrag&&!this.context.isCaptureViewer&&(Qu(i,"dragenter",this).on((t=>{t.preventDefault()})),Qu(i,"dragleave",this).on((t=>{t.preventDefault()})),Qu(i,"drop",this).on((t=>{var e;t.preventDefault();const i=null===(e=t.dataTransfer)||void 0===e?void 0:e.files;if(!i)return;const n=i.length,s=[];for(let t=0;t<n;t++){const e=new Blob([i[t]],{type:i[t].type});if("application/pdf"===i[t].type){const t=ub.annotationLicenseModuleIsExist();s.push({fileData:e,convertMode:qv.CM_AUTO,renderOptions:{renderAnnotations:t?Zv.LOAD_ANNOTATIONS:Zv.NO_ANNOTATIONS}})}else s.push({fileData:e})}this.context.loadSource(s)})),Qu(i,"dragover",this).on((t=>{t.preventDefault()})))}formatEvent(t){var e,i;const[n]=this.context.toCanvas(t),s=this.context.getPointerOverPageInfo(n.pageX,n.pageY),o=Ep.displayResolution,r=Ep.dataResolution,{pointerX:a,pointerY:l}=s.imageInfo;return ZC.create(s.index,null!==(e=null===(i=s.pageInfo.page)||void 0===i?void 0:i.uid)&&void 0!==e?e:"",a<0?-1:qu($u(a,o,r),2),l<0?-1:qu($u(l,o,r),2),Math.floor(n.pageX),Math.floor(n.pageY),t)}}class sP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"offsetX",0),na(this,"offsetY",0),na(this,"startX",0),na(this,"startY",0),na(this,"isDragging",!1),na(this,"startPage",void 0),na(this,"newIndexes",void 0),na(this,"cacheChildren",void 0),na(this,"cacheSelectedIndexes",void 0),na(this,"isMousedown",!1),na(this,"starDragIndices",[]),this.context=t}dispose(){super.dispose(),this.context=null}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:n}=e;if("pan"!==i.toolMode)return;if(e.isLoadSource)return;const s=e.getActiveTab();if(null==s||!s.total)return;this.isMousedown=!0;const[o]=e.toCanvas(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(r&&r){this.startX=o.pageX,this.startY=o.pageY;const t=r.getPosition();this.offsetX=o.pageX-t.x,this.offsetY=o.pageY-t.y,this.startPage=r,this.cacheChildren=s.pages.slice()}}moveHandler(t){const{context:e}=this,i=e.getActiveTab();if(!i||!e.isThumbnailViewer)return;const[n]=e.toCanvas(t),s=e.getPointerOverPageInfo(n.pageX,n.pageY),{page:o}=s.pageInfo;if(this.isDragging){var r,a,l;if(o&&!o.isSelected){const t=i.selected.map((t=>i.uidToIndex(t))).sort(((t,e)=>t-e)),n=t[0],s=i.getPageIndex(o),r=i.pages.slice();t.slice().reverse().forEach((t=>{r.splice(t,1)}));let a=r.indexOf(o);s>n&&(a+=1),this.cacheSelectedIndexes.forEach(((t,e)=>{const n=i.getPageByUid(t.uid);r.splice(a+e,0,n)})),this.newIndexes=r.map((t=>i.getPageIndex(t))),i.reorderPages(this.newIndexes,!1),e.layoutService.layout(i),e.visibilityService.handleVisibility(i)}const t=e.styleService.getParsedPlaceholderStyle(),s=devicePixelRatio;let h=n.pageX-this.offsetX,c=n.pageY-this.offsetY;h=Math.round(h*s)/s,c=Math.round(c*s)/s,i.selected.forEach((e=>{const n=i.getPageByUid(e);n.isDragging=!0,n.updateStyle({...t}),n.borderBox.updateStyle({visibility:"hidden"})})),null===(r=this.startPage)||void 0===r||r.updateStyle({zIndex:1}),null===(a=this.startPage)||void 0===a||a.borderBox.updateStyle({visibility:"visible"}),null===(l=this.startPage)||void 0===l||l.borderBox.setPosition({x:h,y:c}),e.loadVisiblePages(i),e.rendererService.render(i)}else if(o&&o===this.startPage&&o.isSelected&&((n.pageX-this.startX)**2+(n.pageY-this.startY)**2)**.5>=e.viewerConfig.dragThreshold&&this.startPage&&e.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=i.selected.map((t=>({uid:t,index:i.uidToIndex(t)}))).sort(((t,e)=>t.index-e.index));const t=i.uidsToIndices(i.selected);this.starDragIndices=[...t],e.viewer.emit("pagesDragged",UC.create(t,[...i.selected]))}}endHandler(t){var e;if(!this.isMousedown)return;const{context:i}=this,n=i.getActiveTab();if(n){if(this.isDragging){if(this.newIndexes){const t=n.pages.map((t=>this.cacheChildren.indexOf(t)));n.childNodes=this.cacheChildren,i.viewer.reorderPages(t),this.newIndexes=null}n.selected.forEach((t=>{const e=n.getPageByUid(t);e.borderBox.setLocalPosition({x:0,y:0}),e.isDragging=!1,e.borderBox.updateStyle({visibility:"visible"})}));const t=n.uidsToIndices(n.selected);i.viewer.emit("pagesDropped",VC.create(this.starDragIndices,t,[...n.selected]))}null===(e=this.startPage)||void 0===e||e.updateStyle({zIndex:0}),this.isDragging&&(i.scrollByCurrentChanged=!0,i.layoutService.layout(n),i.visibilityService.handleVisibility(n),i.rendererService.render(n)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1}}}class oP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"isStart",!1),na(this,"startX",void 0),na(this,"startY",void 0),na(this,"lastX",void 0),na(this,"lastY",void 0),na(this,"startTime",void 0),na(this,"startScrollLeft",void 0),na(this,"startScrollTop",void 0),na(this,"isScrolling",void 0),na(this,"scrollTimer",void 0),na(this,"scrollDirectionX","left"),na(this,"scrollDirectionY","top"),na(this,"canvasElX",void 0),na(this,"canvasElY",void 0),this.context=t,this.isScrolling=!1}startHandler(t){const{context:e}=this;if(e.isPanning||e.isZooming)return;const i=e.getActiveTab();if(null==i||!i.total)return;const n=e.toCanvas(t);if(n.length>1)return;this.canvasElX=t.screenX,this.canvasElY=t.screenY;const{pageX:s,pageY:o}=n[0];this.isStart=!0,this.startX=s,this.startY=o,this.lastX=s,this.lastY=o,this.startTime=(new Date).getTime();const{scrollLeft:r,scrollTop:a}=i.context;this.startScrollLeft=r,this.startScrollTop=a,this.isScrolling=!1,this.scrollTimer&&(uu.clearTimer(this.scrollTimer),this.scrollTimer=null)}moveHandler(t){if(!this.isStart)return;t instanceof PointerEvent&&t.cancelable&&t.preventDefault();const{context:e}=this;if(e.isZooming)return;const i=e.toCanvas(t);if(i.length>1)return;const n=e.getActiveTab(),{maxScrollLeft:s,maxScrollTop:o}=n.context;let{scrollLeft:r,scrollTop:a}=n.context;if(!s&&!o)return;const{viewerConfig:l}=e,{panThreshold:h,enablePanX:c,enablePanY:d}=l,{pageX:u,pageY:p}=i[0],g=u-this.startX,f=p-this.startY,m=u-this.lastX,v=p-this.lastY;if(e.isPanning){if(!r&&!a&&m>=0&&v>=0)return;if(r===s&&a===o&&m<=0&&v<=0)return;c&&(r=this.startScrollLeft-g),d&&(a=this.startScrollTop-f),r=Jd(r,0,s),a=Jd(a,0,o),e.viewService.scrollTo(r,a)}else e.isPanning=c&&Math.abs(g)>=h||d&&Math.abs(f)>=h;this.lastX=u,this.lastY=p}endHandler(t){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:e}=this,i=e.toCanvas(t,!0);if(i.length>1)return;if(e.isZooming)return;if("mouse"===t.pointerType)return;if(this.canvasElX===t.screenX&&this.canvasElY===t.screenY)return;const{scrollLeft:n,scrollTop:s}=this.context.viewService.getMaxScrollValue(),{scrollLeft:o,scrollTop:r}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(n>0||s>0)){const t=(new Date).getTime(),e=i[0].pageX,a=i[0].pageY,l=e-this.startX,h=a-this.startY;let c=!1,d=!1;l>0?(c=0!==o,this.scrollDirectionX="right"):(c=o!==n,this.scrollDirectionX="left"),h>0?(d=0!==r,this.scrollDirectionY="bottom"):(d=r!==s,this.scrollDirectionY="top");const u=t-this.startTime;if((Math.abs(l)>10||Math.abs(h)>10)&&u>0&&u<300&&(c||d)){let t=Math.abs(l)/u,e=Math.abs(h)/u;(t>.4||e>.4)&&(t=Math.min(t,2.8),e=Math.min(e,2.8),this.scroll(t,e,-.05))}}}scroll(t,e,i){this.isScrolling=!0;const{scrollLeft:n,scrollTop:s}=this.context.viewService.scrollContainer;let o=0,r=0;this.scrollTimer=uu.createTimer((()=>{const{scrollLeft:a,scrollTop:l}=this.context.viewService.getMaxScrollValue();if(t<=0&&e<=0||!1===this.isScrolling)return uu.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);t>=0&&("right"===this.scrollDirectionX?o-=40*t:o+=40*t,t+=i),e>=0&&("bottom"===this.scrollDirectionY?r-=40*e:r+=40*e,e+=i);const h=Jd(n+o,0,a),c=Jd(s+r,0,l);this.context.viewService.scrollTo(h,c)}),25)}}class rP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"scrollTimer",void 0),this.context=t}scrollHandler(t){const{context:e}=this;if(e.scrollByCurrentChanged)return void(e.scrollByCurrentChanged=!1);const i=e.getActiveTab();if(null==i||!i.total)return;const{scrollLeft:n,scrollTop:s}=t.target;i.context.setTabScrollValue(n,s),e.visibilityService.handleVisibility(i),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((()=>{if(!e.isDestroyed&&i.isActive){if(e.isDefaultViewer){if(i.context.updateReference(),i.context.isContinuousDisplay&&e.viewerConfig.autoChangeIndex){const t=i.context.getCurrentByScroll();null!==t&&(i.gotoPage(t),e.visibilityService.handleVisibility(i),e.emitPageChangedEvent(i),e.emitPageChangedAfterRenderEvent(i),e.core.viewerService.onCurrentChangedByScroll.emit(bS.create(i.uid,e.groupUid,e.uid,t)))}e.loadVisiblePages(i)}else e.isThumbnailViewer&&e.loadVisiblePages(i);this.scrollTimer=null}}),42),e.rendererService.render(i),e.hooks.scroll.emit()}wheelHandler(t){if(!Ru(t)&&!Mu(t))return;const{context:e}=this,i=e.getActiveTab(),{maxScrollLeft:n,maxScrollTop:s,scrollLeft:o,scrollTop:r}=i.context;let{wheelDelta:a}=t;t.deltaY&&(a=-t.deltaY),1===t.deltaMode?a*=16:2===t.deltaMode&&(a=a<0?-100:100),t.shiftKey&&n?(a>0&&0!==o||a<0&&o!==n)&&(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(-a,0)):s&&(a<0&&r!==s||a>0&&0!==r)&&(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-a))}}class aP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"wheelTimer",void 0),na(this,"isStart",void 0),na(this,"isZooming",void 0),na(this,"startDistance",void 0),na(this,"touchZoomTimer",void 0),na(this,"startZoom",void 0),this.context=t,this.isZooming=!1,this.isStart=!1,this.startZoom=1}zoomTo(t,e,i){var n;t=D_(t);const{context:s}=this;if(!s.isDefaultViewer)return;const o=s.getActiveTab();if(null==o||!o.total)return;const{viewerConfig:r}=s;if((t=Jd(t,r.minZoom,r.maxZoom))===r.zoom)return;qd(e)&&qd(i)||({originX:e,originY:i}=o.context.getZoomOriginCord());const a=null===(n=o.context.placeholderPages)||void 0===n?void 0:n.length;let l;a&&(l=o.context.generateReference(e,i));const h=o.context.zoom;if(o.context.setZoom(t),r.zoom=t,o.context.isZoomChanged=!0,a){s.layoutService.layout(o),s.viewService.updateScrollerContentSize(o),s.rendererService.updateCanvasSize();const{scrollLeft:t,scrollTop:n}=o.context.parseReferenceZoom(l,e,i);o.context.setTabScrollValue(t,n),s.viewService.scrollTo(t,n),s.visibilityService.handleVisibility(o),s.loadVisiblePages(o),s.clearCurrentTabOptimization(),s.rendererService.render(o)}o.context.oldZoom=h,s.emitZoomChangedEvent(o)}wheelHandler(t){const{viewerConfig:e}=this.context;if(e.enableZoom&&e.enableZoomWithCtrl&&ku(t)){let{wheelDelta:i}=t;t.deltaY&&(i=-t.deltaY),t.cancelable&&t.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout((()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const n=e.wheelZoomFactor||1,s=i>0?n:1/n,{x:o,y:r}=this.context.rendererService.getCanvasPosition();this.zoomTo(e.zoom*s,t.pageX-o,t.pageY-r)}),40))}}touchstartHandler(t){const{context:e}=this,i=e.getActiveTab(),{displayMode:n}=i.context,s="continuous"===n||"single"===n;if(!e.viewerConfig.enableZoom||!s)return;const o=e.toCanvas(t);o.length<2||(e.isZooming=!0,this.startZoom=i.context.zoom,this.startDistance=lP(o),this.isStart=!0)}touchmoveHandler(t){if(!this.isStart)return;t.cancelable&&t.preventDefault();const{context:e}=this,i=e.toCanvas(t);if(i.length<2)return;const n=(i[0].pageX+i[1].pageX)/2,s=(i[0].pageY+i[1].pageY)/2;let o=lP(i)/this.startDistance;t.scale&&(o=t.scale);const r=e.getActiveTab();let{zoom:a}=r.context;const l=a;a=this.startZoom*o,a!==l&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout((()=>{this.zoomTo(a,n,s),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null}),25))),e.isZooming=!0}touchendHandler(t){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1)}tapZoomHandler(t){const{toolMode:e,enableZoom:i,tapZoomFactor:n}=this.context.viewerConfig;if(!i)return;const s="zoomIn"===e,o="zoomOut"===e;if(!s&&!o)return;const r=this.context.toCanvas(t);if(r.length>1)return;const a=(r[0].pageX+r[1].pageX)/2,l=(r[0].pageY+r[1].pageY)/2,h=this.context.getActiveTab();let{zoom:c}=h.context;s?c*=n||1:o&&(c/=n||1),this.zoomTo(c,a,l)}}function lP(t){return((t[0].pageX-t[1].pageX)**2+(t[0].pageY-t[1].pageY)**2)**.5}class hP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"isStart",!1),na(this,"startX",void 0),na(this,"isSliding",void 0),na(this,"slideDistance",void 0),na(this,"slideDirection",void 0),na(this,"slideRAF",void 0),na(this,"tabX",void 0),na(this,"tabY",void 0),this.context=t,this.isSliding=!1}startHandler(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:n}=this.context.viewService.getMaxScrollValue();if(i||n)return;const s=this.context.toCanvas(t);if(s.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=s[0].pageX,this.isStart=!0}moveHandler(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),n=e.toCanvas(t)[0].pageX-this.startX;if(n>0?this.slideDirection="right":n<0&&(this.slideDirection="left"),this.slideDistance=Math.min(i.context.viewportWidth,Math.abs(n)),this.isSliding)"right"===this.slideDirection?i.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&i.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===i.context.displayMode&&"pan"===e.viewerConfig.toolMode&&e.viewerConfig.enableSlide){const{scrollLeft:t,scrollTop:i}=this.context.viewService.getMaxScrollValue();Math.abs(n)>e.viewerConfig.startSlideThreshold&&!t&&!i&&(this.isSliding=!0,this.context.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}))}}endHandler(t){if(!this.isStart)return;const{context:e}=this;this.context.toCanvas(t,!0);const i=e.getActiveTab(),{displayMode:n}=i.context;"slide"===n&&this.slide(i),this.isStart=!1}slide(t){let e,i=0,n=0,s=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThreshold)?(n=t.context.viewportWidth,e=n-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(s=-this.slideDistance,i=-e/6):(n=0,e=this.slideDistance,o=!0,s=-this.slideDistance,i=e/6):0!==t.current?(s=this.slideDistance,i=e/6):(n=0,e=this.slideDistance,o=!0,s=this.slideDistance,i=-e/6)):(o=!0,n=0,e=this.slideDistance,"left"===this.slideDirection?(s=-this.slideDistance,i=e/6):(s=this.slideDistance,i=-e/6));const l=()=>{s+=i;const e=s>=0;if(Math.abs(s)>=n&&(s=n,e||(s*=-1)),t.setPosition({x:s+this.tabX,y:this.tabY,z:0}),Math.abs(s)===n)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render()};this.slideRAF=requestAnimationFrame(l)}}class cP extends Ju{constructor(t){super(),na(this,"context",void 0),this.context=t}handleOptimizationEvents(){this.context.hooks.afterRender.on((t=>{this.optimizeTab(t)}))}dispose(){super.dispose(),this.context=null}optimizeTab(t){this.context.viewerConfig.enableOptimizePage&&t.pages.forEach(((t,e)=>{!Xd()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&setTimeout((()=>{!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&this.optimizePage(t.uid)}),500)}))}cancelOptimization(t){this.context.core.optimizationService.cancel(t)}optimizePage(t){if(!this.context)return;const{context:e}=this,{viewerConfig:i}=e;if(!i.enableOptimizePage)return;const n=e.getActiveTab();if(!n)return;const s=n.getPageByUid(t);if(!s)return;if(s.isOptimized||!s.isVisible||!s.isLoaded||s.optimizationUid===s.optimizedUid||e.isSliding||e.isDestroyed)return;const o=e.core.pageService.getPage(t);if(null==o||!o.display.img)return;const{img:r}=s.image.style;if(!r)return;const{naturalWidth:a,naturalHeight:l}=r;let h=a,c=l;const{maxOptimizationSize:d}=i;if(h>d||c>d||s.rWidth>d||s.rHeight>d)return;let u=0,p=0,g=0,f=0,m=0;({rWidth:h,rHeight:c,cropLeft:u,cropTop:p,cropWidth:g,cropHeight:f,rotation:m}=o.getEditResultForPixel());const v=$u(o.mediaBox.left,Ep.displayResolution,o.resource.resolutionX),y=$u(o.mediaBox.top,Ep.displayResolution,o.resource.resolutionX),x=new Df({style:{x:-u+v,y:-p+y,img:r,width:a,height:l}});let w="rgba(0,0,0,0)";if(i.enableFillColor)w=i.blankFillColor;else if(i.viewerMode===$b.THUMBNAIL){let t=i.pageStyle;s.isSelected?t=i.selectedPageStyle:s.isHovered&&(t=i.hoveredPageStyle),w=t.background}const b=new Nf({style:{x:-(g-h)/2,y:-(f-c)/2,width:g,height:f,background:w}});b.appendChild(x),b.setLocalAngle(m);const{commonCanvas:C}=e.core;C.render(b,h,c),C.reset();const S=C.getCanvas(),_=devicePixelRatio,T=Math.floor(s.realTimeBox.width*_+.5)||1,E=Math.floor(s.realTimeBox.height*_+.5)||1;s.isOptimized=!0,e.core.optimizationService.optimize(S,h,c,T,E,s.optimizationUid).then((t=>{if(!e.isDestroyed&&t.taskUid===s.optimizationUid){s.isOptimized=!0,s.optimizedUid=s.optimizationUid;const i=S.getContext("2d",{willReadFrequently:!0}).createImageData(T,E);i.data.set(t.target),s.realTimeBox.imageData=i,s.image.updateStyle({visibility:"hidden"}),s.isVisible&&e.render()}})).catch((t=>{s.isOptimized=!1}))}}class dP extends Ju{constructor(t,e,i,n,s,o){super(),na(this,"context",void 0),na(this,"panModeInteraction",void 0),na(this,"cropModeInteraction",void 0),na(this,"annotationModeInteraction",void 0),na(this,"zoomInModeInteraction",void 0),na(this,"zoomOutModeInteraction",void 0),this.context=t,this.panModeInteraction=e,this.cropModeInteraction=i,this.annotationModeInteraction=n,this.zoomInModeInteraction=s,this.zoomOutModeInteraction=o}handleEvents(){if(this.context.isCaptureViewer)return;const t=this.context.rendererService.getCanvasDom();Qu(t,"pointerdown",this).on((t=>{if(this.context.isPointerWorking=!0,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerdownHandler(t),this.cropModeInteraction.pointerdownHandler(t),this.annotationModeInteraction.pointerdownHandler(t),this.zoomInModeInteraction.startHandler(t),this.zoomOutModeInteraction.startHandler(t))})),Qu(t,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!1),this.cropModeInteraction.pointermoveHandler(t),this.annotationModeInteraction.cursorHandler(t))}),{passive:!1}),Qu(t,"pointerup",this).on((t=>{if(this.context.isPointerWorking=!1,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&this.panModeInteraction.pointerupHandler(t)})),Qu(document,"pointerdown",this).on((t=>{this.context.isPointerWorking=!0})),Qu(document,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!0),this.annotationModeInteraction.pointermoveHandler(t))}),{passive:!1}),Qu(document,"pointerup",this).on((t=>{if(this.context.isPointerWorking=!1,0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerupHandler(t),this.cropModeInteraction.pointerupHandler(t),this.annotationModeInteraction.pointerupHandler(t),this.zoomInModeInteraction.endHandler(t),this.zoomOutModeInteraction.endHandler(t))})),Qu(t,"touchstart",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchstartHandler(t),this.cropModeInteraction.touchstartHandler(t))}),{passive:!1}),Qu(t,"touchmove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(t.cancelable&&t.preventDefault(),this.panModeInteraction.touchmoveHandler(t),this.cropModeInteraction.touchmoveHandler(t))}),{passive:!1}),Qu(t,"touchend",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchendHandler(t),this.cropModeInteraction.touchendHandler(t))})),Qu(t,"wheel",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.wheelHandler(t),this.cropModeInteraction.wheelHandler(t),this.annotationModeInteraction.wheelHandler(t))}),{passive:!1}),Qu(this.context.viewService.scrollContainer,"scroll",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.scrollHandler(t),this.cropModeInteraction.scrollHandler(t),this.annotationModeInteraction.scrollHandler(t))})),Qu(document,"keydown",this).on((t=>{if(!this.context.isFocusCanvas||!this.context.viewerConfig.enableKeyboardInteraction)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.keydownHandler(t),this.cropModeInteraction.keydownHandler(t),this.annotationModeInteraction.keydownHandler(t),this.zoomInModeInteraction.keydownHandler(t),this.zoomOutModeInteraction.keydownHandler(t))})),Qu(document,"keyup",this).on((t=>{this.context.isFocusCanvas&&this.context.viewerConfig.enableKeyboardInteraction&&this.context.getActiveTab()&&(this.panModeInteraction.keyupHandler(t),this.annotationModeInteraction.keyupHandler(t))})),Qu(document,"click",this).on((t=>{var e;if(this.context.isDestroyed)return;if("hidden"===this.context.viewerConfig.visibility)return;if(t.target instanceof HTMLInputElement)return void(this.context.isFocusCanvas=!1);if(this.context.viewerConfig.hasThb&&this.context.viewService.thumbnailContainer.contains(t.target))return void(this.context.isFocusCanvas=!1);let i=!(null===(e=this.context.viewService.rootDom)||void 0===e||!e.contains(t.target));i||document.body.contains(t.target)||!this.context.isDefaultViewer||(i=!0),this.context.isFocusCanvas=i}))}}class uP extends Ju{constructor(t){super(),na(this,"context",void 0),na(this,"isPointerdown",!1),na(this,"startPage",void 0),na(this,"mouseOverPage",void 0),this.context=t}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:n}=e,s=this.context.getActiveTab();if(null==s||!s.total)return;this.isPointerdown=!0;const[o]=e.toCanvas(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(!r)return;if(this.startPage=r,!Mu(t)&&!Ru(t))return;const a=s.getPageIndex(r),l=s.getCurrentPage(),h=t.shiftKey&&i.enableSelectWithShift;if(h&&s.selected.length){if(h&&l!==r&&s.shiftReference){const t=s.uidToIndex(s.shiftReference),i=Math.min(a,t),o=Math.max(a,t),l=[];for(let t=i;t<=o;t++)l.push(t);if(e.viewerConfig.enableOptimizePage){n.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid]),n.isSelectedBorderWidthEqualNormal()||l.forEach((t=>{const o=s.getPageByIndex(i+t);!o||s.selected.includes(o.uid)||o.uid===r.uid||n.isSelectedBorderWidthEqualNormal()||e.clearOptimization([o.uid])}));const t=s.indicesToUids(l);n.isSelectedBorderWidthEqualNormal()||s.selected.forEach((i=>{if(!t.includes(i)){const t=s.getPageByUid(i);t&&e.clearOptimization([t.uid])}}))}a<t&&l.reverse();const{shiftReference:h}=s;e.viewer.gotoPage(a),s.shiftReference=h,e.viewer.selectPagesByIndices(l)}}else i.multiselectMode||(r.uid!==s.currentUid?e.viewer.gotoPage(a):s.shiftReference=r.uid,r.isSelected||(e.viewerConfig.enableOptimizePage&&(n.isSelectedBorderWidthEqualNormal()||s.selected.forEach((t=>{const i=s.getPageByUid(t);i&&e.clearOptimization([i.uid])})),n.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid])),e.viewer.selectPagesByIndices([a])))}moveHandler(t){const{context:e}=this,{styleService:i}=e,n=e.getActiveTab();if(null==n||!n.total)return;const[s]=e.toCanvas(t),o=e.getPointerOverPageInfo(s.pageX,s.pageY),{page:r}=o.pageInfo,{mouseOverPage:a}=this;e.viewerConfig.enableOptimizePage&&!i.isBorderWidthEqualHovered()&&(a&&!a.isSelected&&(r&&a===r||e.clearOptimization([a.uid])),r&&!r.isSelected&&(a&&a===r||e.clearOptimization([r.uid]))),this.mouseOverPage=r;let l=!1;"mouse"===t.pointerType&&n.pages.forEach((t=>{r&&r.uid===t.uid?(t.isHovered||(l=!0),t.isHovered=!0):(t.isHovered&&(l=!0),t.isHovered=!1)})),l&&(e.layoutService.layout(n),e.visibilityService.handleVisibility(n),e.rendererService.render(n))}endHandler(t){if(!this.isPointerdown)return;const{context:e}=this,{styleService:i}=e,[n]=e.toCanvas(t,!0),s=e.getActiveTab();if(null==s||!s.total)return;const o=e.getPointerOverPageInfo(n.pageX,n.pageY).pageInfo.page;if(o&&o===this.startPage)if(ku(t)&&e.viewerConfig.enableSelectWithCtrl||e.viewerConfig.multiselectMode){const t=s.selected.slice(),n=t.indexOf(o.uid);o.isSelected?t.splice(n,1):t.push(o.uid);const r=s.uidsToIndices(t);if(o.uid!==s.currentUid){const t=s.uidToIndex(o.uid);e.viewer.gotoPage(t)}!i.isSelectedBorderWidthEqualHovered()&&e.viewerConfig.enableOptimizePage&&e.clearOptimization([o.uid]),e.viewer.selectPagesByIndices(r)}else if(!Lu(t)){const t=s.getPageIndex(o);o.uid!==s.currentUid&&e.viewer.gotoPage(t),e.viewerConfig.enableOptimizePage&&(i.isSelectedBorderWidthEqualNormal()||s.selected.forEach((t=>{const i=s.getPageByUid(t);i&&e.clearOptimization([i.uid])})),i.isSelectedBorderWidthEqualHovered()||e.clearOptimization([o.uid])),e.viewer.selectPagesByIndices([t])}this.isPointerdown=!1,this.startPage=null}keydownHandler(t){}}class pP extends Ju{constructor(t){super(),na(this,"context",void 0),this.context=t}selectAllHandler(t){this.context.viewerConfig.enableSelectAllWithKeyboard&&ku(t)&&this.context.isThumbnailViewer&&(t.preventDefault(),this.context.viewer.selectAllPages())}undoHandler(t){this.context.viewerConfig.enableUndoWithKeyboard&&ku(t)&&(t.preventDefault(),this.context.viewer.undo())}redoHandler(t){this.context.viewerConfig.enableRedoWithKeyboard&&ku(t)&&(t.preventDefault(),this.context.viewer.redo())}zoomInHandler(t){this.context.viewerConfig.enableZoomInWithKeyboard&&ku(t)&&(t.preventDefault(),this.context.viewer.zoomIn())}zoomOutHandler(t){this.context.viewerConfig.enableZoomOutWithKeyboard&&ku(t)&&(t.preventDefault(),this.context.viewer.zoomOut())}arrowLeftHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollLeft:n,currentViewportWidth:s,scrollLeft:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Mu(t)?0!==i.current&&e.viewer.gotoPage(i.current-1):Ru(t)&&(n?0===o?0!==i.current&&e.viewer.gotoPage(i.current-1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(-r,0)):0!==i.current&&e.viewer.gotoPage(i.current-1));else if(e.isThumbnailViewer){if(Lu(t))return;0!==i.current&&e.viewer.gotoPage(i.current-1)}}arrowRightHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollLeft:n,currentViewportWidth:s,scrollLeft:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Mu(t)?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):Ru(t)&&(n?o===n?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r,0)):i.current!==i.total-1&&e.viewer.gotoPage(i.current+1));else if(e.isThumbnailViewer){if(Lu(t))return;i.current!==i.total-1&&e.viewer.gotoPage(i.current+1)}}arrowUpHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Mu(t)&&(n?0===o?0!==i.current&&e.viewer.gotoPage(i.current-1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-r)):0!==i.current&&e.viewer.gotoPage(i.current-1));else if(e.isThumbnailViewer){if(Lu(t))return;const{rows:n,columns:s}=i.context,{current:o}=i,r=Math.floor(o/s),a=o%s;0===r?0!==i.current&&e.viewer.gotoPage(i.current-1):e.viewer.gotoPage(s*(r-1)+a)}}arrowDownHandler(t){const{context:e}=this;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o}=i.context;t.preventDefault();const r=s/30;if(e.isDefaultViewer)Mu(t)&&(n?o===n?i.current!==i.total-1&&e.viewer.gotoPage(i.current+1):(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,r)):i.current!==i.total-1&&e.viewer.gotoPage(i.current+1));else if(e.isThumbnailViewer){if(Lu(t))return;const{rows:n,columns:s}=i.context,{current:o}=i,r=Math.floor(o/s),a=o%s;if(r===(i.total-1)/s)0!==i.current&&e.viewer.gotoPage(i.current+1);else{const t=Math.min(i.total-1,s*(r+1)+a);e.viewer.gotoPage(t)}}}escapeHandler(t){Lu(t)||t.preventDefault()}enterHandler(t){Lu(t)||t.preventDefault()}pageUpHandler(t){if(Lu(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o,scrollLeft:r}=i.context;t.preventDefault(),e.isDefaultViewer&&(n&&0!==o&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)),"single"===i.context.displayMode?n&&0!==o?(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)):0!==i.current&&(e.viewer.gotoPage(i.current-1),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r-i.context.scrollLeft,n)):"continuous"===i.context.displayMode&&n&&0!==o&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-s)))}pageDownHandler(t){if(Lu(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,currentViewportHeight:s,scrollTop:o,scrollLeft:r}=i.context;t.preventDefault(),e.isDefaultViewer&&("single"===i.context.displayMode?n&&o!==n?(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,s)):i.current!==i.total-1&&(e.viewer.gotoPage(i.current+1),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(r-i.context.scrollLeft,0)):"continuous"===i.context.displayMode&&n&&o!==n&&(e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,s)))}homeHandler(t){if(Lu(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,scrollTop:s}=i.context;t.preventDefault(),e.isDefaultViewer?n&&0!==s&&(e.scrollByCurrentChanged=!1,e.viewService.scrollTo(0,0)):e.isThumbnailViewer&&0!==i.current&&e.viewer.gotoPage(0)}endHandler(t){if(Lu(t))return;if(!this.context.viewerConfig.enableSelectPageWithKeyboard)return;const{context:e}=this,i=e.getActiveTab(),{maxScrollTop:n,scrollTop:s}=i.context;t.preventDefault(),e.isDefaultViewer?n&&s!==n&&(e.scrollByCurrentChanged=!1,e.viewService.scrollTo(0,n)):e.isThumbnailViewer&&i.current!==i.total-1&&e.viewer.gotoPage(i.total-1)}}class gP{constructor(t){na(this,"context",void 0),na(this,"isEditAnnotation",!1),na(this,"isMove",!1),na(this,"isSlide",!1),na(this,"isActivateAnnotation",!1),na(this,"isTouchstart",!1),na(this,"isPointerdown",!1),na(this,"isFirstMove",!0),na(this,"isPointerOnAnnotation",!1),na(this,"isAnnotationActive",!1),na(this,"activeShape",void 0),na(this,"pointerNum",0),na(this,"startPoint",void 0),na(this,"dragTimer",void 0),na(this,"isDragPages",!1),na(this,"isMoveForThumbnail",!1),na(this,"isMoved",!1),na(this,"canScroll",!0),na(this,"startX",void 0),na(this,"startY",void 0),this.context=t}get isPanMode(){return"pan"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isPanMode)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;if("slide"===e.context.displayMode)return;const{isDefaultViewer:i,isThumbnailViewer:n,viewService:s,hasAnnotationModule:o,annotationEditService:r,selectPagesService:a,moveService:l,dragService:h,slideService:c,viewerConfig:{dragStartTimeThreshold:d,enableSlide:u,enableDragPage:p}}=this.context,{displayMode:g}=e.context;if(this.isPointerdown=!0,this.isFirstMove=!0,i){const{scrollLeft:e,scrollTop:i}=s.getMaxScrollValue();if(o){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(this.startPoint={x:e.pageX,y:e.pageY},i){let{x:t,y:e}=i.cropBox.getPosition(),{width:n,height:s}=i.cropBox;const o=(i.rotation%360+360)%360/90;if(1===o?t-=s:2===o?(t-=n,e-=s):3===o&&(e-=n),1===o||3===o){const t=n;n=s,s=t}r.setAnnotationContainer(i),r.setAnnotationInteractionArea({x:t,y:e,width:n,height:s})}const{isHit:n,shape:s,isHitSelected:o}=this.context.annotationEditService.isHitAnnotation(t);n&&i?(this.activeShape=s,this.isPointerOnAnnotation=!0,"touch"===t.pointerType||"pen"===t.pointerType?o?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!1)):(this.isActivateAnnotation=!0,r.deactivateAnnotation()):"mouse"===t.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!0)),r.hasActiveAnnotation()&&(this.canScroll=!1)):r.deactivateAnnotation()}this.isPointerOnAnnotation||(e||i?(this.isMove=!0,this.isSlide=!1,l.startHandler(t)):"single"===g&&u&&(this.isMove=!1,this.isSlide=!0,c.startHandler(t)))}else if(n){a.startHandler(t);const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;i&&!ku(t)?(this.startX=t.pageX,this.startY=t.pageY,"touch"===t.pointerType||"pen"===t.pointerType?p?this.dragTimer=setTimeout((()=>{this.isMoveForThumbnail||(this.isDragPages=!0,h.startHandler(t))}),d):(this.isMoveForThumbnail=!0,l.startHandler(t)):"mouse"===t.pointerType&&(p?(this.isDragPages=!0,h.startHandler(t)):(this.isMoveForThumbnail=!0,l.startHandler(t)))):(this.isMoveForThumbnail=!0,l.startHandler(t))}}pointermoveHandler(t,e){if(this.pointerNum>1)return;const i=this.context.getActiveTab();if(null==i||!i.total)return;const{isDefaultViewer:n,isThumbnailViewer:s,viewService:o,moveService:r,slideService:a,annotationEditService:l,dragService:h,selectPagesService:c}=this.context,{displayMode:d}=i.context;if(n&&!e&&this.isPointerdown){const[e]=this.context.toCanvas(t),i=cu(this.startPoint,{x:e.pageX,y:e.pageY});if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){i>1&&(this.isActivateAnnotation=!1);const{scrollLeft:e,scrollTop:n}=o.getMaxScrollValue();e||n?(this.isMove=!0,this.isSlide=!1,r.startHandler(t)):"single"===d&&(this.isMove=!1,this.isSlide=!0,a.startHandler(t))}if(this.isEditAnnotation){const{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;l.moveHandler(t,!i)}else this.isMove&&i>2?(this.isActivateAnnotation=!1,r.moveHandler(t)):this.isSlide&&i>10&&(this.isActivateAnnotation=!1,a.moveHandler(t));this.isFirstMove=!1}else if(s&&e)if(c.moveHandler(t),"touch"===t.pointerType){const e=cu({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),e>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(e>5&&(this.isMoveForThumbnail=!0,r.moveHandler(t)),this.isMoved=!0)}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,r.moveHandler(t),this.isMoved=!0)}pointerupHandler(t){if(!this.isPointerdown)return;const{isDefaultViewer:e,isThumbnailViewer:i,annotationEditService:n,moveService:s,slideService:o,dragService:r,selectPagesService:a}=this.context;if(e)this.isEditAnnotation?n.endHandler(t):this.isActivateAnnotation?(n.activateAnnotation(this.activeShape,ku(t)),this.context.render()):this.isMove?s.endHandler(t):this.isSlide&&o.endHandler(t);else if(i){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const e=cu({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});(!this.isMoved||e<10)&&a.endHandler(t),this.isDragPages?r.endHandler(t):s.endHandler(t)}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null}touchstartHandler(t){if(this.pointerNum=t.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:e,enableZoomInPanMode:i,enableZoomWithTouch:n}=this.context.viewerConfig;if(!this.isPanMode||2!==t.targetTouches.length||this.isTouchstart||!e||!n||!i)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(t)}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t)}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t))}wheelHandler(t){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void t.preventDefault();const{isDefaultViewer:e,isThumbnailViewer:i,viewerConfig:{enableZoom:n,enableZoomInPanMode:s,enableZoomWithCtrl:o},zoomService:r,scrollService:a}=this.context;if(e)if(ku(t)){if(!n||!s||!o)return;r.wheelHandler(t)}else a.wheelHandler(t);else i&&a.wheelHandler(t)}scrollHandler(t){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t)}keydownHandler(t){if(!this.isPanMode)return;const{context:e,context:{keyboardService:i,annotationEditService:n,viewerConfig:{enableKeyboardInteraction:s,enableZoom:o,enableZoomInPanMode:r,enableCopyCutPasteWithKeyboard:a},isPointerWorking:l}}=this;if(s&&!l)if(e.isDefaultViewer){if(this.context.annotationEditService.hasActiveAnnotation()){if(ku(t))switch(t.key){case"c":case"C":a&&n.copyAnnotations();break;case"x":case"X":a&&n.cutAnnotations();break;case"v":case"V":a&&n.pasteAnnotations();break;case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t)}else if(Ru(t)||Mu(t)){const e=this.context.annotationEditService.containerPage;if(e){let{x:t,y:i}=e.cropBox.getPosition(),{width:s,height:o}=e.cropBox;const r=(e.rotation%360+360)%360/90;if(1===r?t-=o:2===r?(t-=s,i-=o):3===r&&(i-=s),1===r||3===r){const t=s;s=o,o=t}n.setAnnotationContainer(e),n.setAnnotationInteractionArea({x:t,y:i,width:s,height:o})}n.keydownHandler(t)}return}switch(t.key){case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"v":case"V":a&&n.pasteAnnotations();break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);break;case"Escape":i.escapeHandler(t);break;case"Enter":i.enterHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t)}}else if(e.isThumbnailViewer)switch(t.key){case"a":case"A":i.selectAllHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t)}}keyupHandler(t){if(!this.isPanMode)return;const{context:e,context:{annotationEditService:i,viewerConfig:{enableKeyboardInteraction:n}}}=this;n&&e.isDefaultViewer&&i.keyupHandler(t)}}class fP{constructor(t){na(this,"context",void 0),na(this,"isEditCropBox",!1),na(this,"isPerspectiveQuad",!1),na(this,"isTouchstart",!1),na(this,"isPointerdown",!1),na(this,"pointerNum",0),this.context=t}get isCropMode(){return"crop"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:e}=this;e.hasBoxRendererModule?e.isDefaultViewer?(this.isEditCropBox=e.cropBoxEditService.isEditCropBox(t),this.isEditCropBox?e.cropBoxEditService.startHandler(t):e.moveService.startHandler(t)):e.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,e.perspectiveQuadEditService.startHandler(t)):e.isDefaultViewer&&e.moveService.startHandler(t)}pointermoveHandler(t){if(this.pointerNum>1)return;const{context:e}=this;e.isDefaultViewer?(e.cropBoxEditService.moveHandler(t),!this.isEditCropBox&&this.isPointerdown&&e.moveService.moveHandler(t)):e.isPerspectiveViewer&&e.perspectiveQuadEditService.moveHandler(t)}pointerupHandler(t){if(!this.isPointerdown)return;const{context:e}=this;e.isDefaultViewer?this.isEditCropBox?e.cropBoxEditService.endHandler(t):e.moveService.endHandler(t):e.isPerspectiveViewer&&this.isPerspectiveQuad&&e.perspectiveQuadEditService.endHandler(t),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1}touchstartHandler(t){this.pointerNum=t.targetTouches.length;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer){if(!this.isCropMode||2!==t.targetTouches.length||this.isTouchstart||!i.enableZoom||!i.enableZoomWithTouch||!i.enableZoomInCropMode)return;this.isTouchstart=!0,e.zoomService.touchstartHandler(t)}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t)}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t))}wheelHandler(t){if(this.pointerNum=0,!this.isCropMode)return;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer)if(ku(t)){if(!i.enableZoom||!i.enableZoomInCropMode||!i.enableZoomWithCtrl)return;e.zoomService.wheelHandler(t)}else e.isPointerWorking||e.scrollService.wheelHandler(t)}scrollHandler(t){if(!this.isCropMode)return;const{context:e}=this;(e.isDefaultViewer||e.isThumbnailViewer)&&e.scrollService.scrollHandler(t)}keydownHandler(t){if(!this.isCropMode)return;const{keyboardService:e,isDefaultViewer:i,viewerConfig:{enableKeyboardInteraction:n,enableZoom:s,enableZoomInCropMode:o},isPointerWorking:r}=this.context;if(i&&n&&!r)switch(t.key){case"y":case"Y":e.redoHandler(t);break;case"z":case"Z":e.undoHandler(t);break;case"-":s&&o&&e.zoomOutHandler(t);break;case"=":s&&o&&e.zoomInHandler(t);break;case"Escape":e.escapeHandler(t);break;case"Enter":e.enterHandler(t);break;case"PageUp":e.pageUpHandler(t);break;case"PageDown":e.pageDownHandler(t);break;case"Home":e.homeHandler(t);break;case"End":e.endHandler(t);break;case"ArrowLeft":e.arrowLeftHandler(t);break;case"ArrowRight":e.arrowRightHandler(t);break;case"ArrowUp":e.arrowUpHandler(t);break;case"ArrowDown":e.arrowDownHandler(t)}}}class mP{constructor(t){na(this,"context",void 0),na(this,"isPointerdown",!1),na(this,"pointerId",null),na(this,"canScroll",!0),this.context=t}get isAnnotationMode(){return"annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=t.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(i){let{x:t,y:e}=i.cropBox.getPosition(),{width:n,height:s}=i.cropBox;const o=360,r=(i.rotation%o+o)%o/90;if(1===r?t-=s:2===r?(t-=n,e-=s):3===r&&(e-=n),1===r||3===r){const t=n;n=s,s=t}this.context.annotationEditService.setAnnotationContainer(i),this.context.annotationEditService.setAnnotationInteractionArea({x:t,y:e,width:n,height:s})}this.isPointerdown=!0,this.context.annotationEditService.startHandler(t,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1)}}pointermoveHandler(t){if((this.pointerId===t.pointerId||"touch"!==t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;this.context.annotationEditService.moveHandler(t,!i)}}cursorHandler(t){if("mouse"===(null==t?void 0:t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.toCanvas(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(t,!i,this.context.viewerConfig.canvasStyle.cursor)}}pointerupHandler(t){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(t),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null)}wheelHandler(t){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(ku(t)){const{enableZoom:e,enableZoomInAnnotationMode:i,enableZoomWithCtrl:n}=this.context.viewerConfig;if(!(this.isAnnotationMode&&e&&i&&n))return;this.context.zoomService.wheelHandler(t)}else this.context.scrollService.wheelHandler(t)}else t.preventDefault()}scrollHandler(t){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t)}keydownHandler(t){if(!this.isAnnotationMode)return;const{context:e,context:{keyboardService:i,annotationEditService:n,viewerConfig:{enableKeyboardInteraction:s,enableZoom:o,enableZoomInAnnotationMode:r,enableCopyCutPasteWithKeyboard:a},hasAnnotationModule:l,isPointerWorking:h}}=this;if(s&&!h&&e.isDefaultViewer)if(this.context.annotationEditService.hasActiveAnnotation()){if(ku(t))switch(t.key){case"c":case"C":a&&n.copyAnnotations();break;case"x":case"X":a&&n.cutAnnotations();break;case"v":case"V":a&&n.pasteAnnotations();break;case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t)}else if(Ru(t)||Mu(t)){const e=this.context.annotationEditService.containerPage;if(e){let{x:t,y:i}=e.cropBox.getPosition(),{width:s,height:o}=e.cropBox;const r=(e.rotation%360+360)%360/90;if(1===r?t-=o:2===r?(t-=s,i-=o):3===r&&(i-=s),1===r||3===r){const t=s;s=o,o=t}n.setAnnotationContainer(e),n.setAnnotationInteractionArea({x:t,y:i,width:s,height:o})}n.keydownHandler(t)}}else switch(t.key){case"y":case"Y":i.redoHandler(t);break;case"z":case"Z":i.undoHandler(t);break;case"v":case"V":a&&n.pasteAnnotations();break;case"-":o&&r&&i.zoomOutHandler(t);break;case"=":o&&r&&i.zoomInHandler(t);break;case"Escape":i.escapeHandler(t);break;case"Enter":i.enterHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t)}}keyupHandler(t){if(!this.isAnnotationMode)return;const{context:e,context:{annotationEditService:i,viewerConfig:{enableKeyboardInteraction:n}}}=this;n&&e.isDefaultViewer&&i.keyupHandler(t)}}class vP{constructor(t){na(this,"context",void 0),na(this,"isPointerdown",!1),this.context=t}get isZoomInMode(){return"zoomIn"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0)}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(t){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;if(!e.enableKeyboardInteraction||!e.enableZoom||!e.enableZoomInWithKeyboard||this.context.isPointerWorking)return;const{keyboardService:i}=this.context;switch(t.key){case"-":i.zoomInHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t)}}}class yP{constructor(t){na(this,"context",void 0),na(this,"isPointerdown",!1),this.context=t}get isZoomOutMode(){return"zoomOut"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0)}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(t){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;if(!e.enableKeyboardInteraction||!e.enableZoom||!e.enableZoomOutWithKeyboard||this.context.isPointerWorking)return;const{keyboardService:i}=this.context;switch(t.key){case"=":i.zoomOutHandler(t);break;case"PageUp":i.pageUpHandler(t);break;case"PageDown":i.pageDownHandler(t);break;case"Home":i.homeHandler(t);break;case"End":i.endHandler(t);break;case"ArrowLeft":i.arrowLeftHandler(t);break;case"ArrowRight":i.arrowRightHandler(t);break;case"ArrowUp":i.arrowUpHandler(t);break;case"ArrowDown":i.arrowDownHandler(t)}}}class xP extends Ju{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),na(this,"core",void 0),na(this,"viewer",void 0),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"hooks",void 0),na(this,"viewService",void 0),na(this,"rendererService",void 0),na(this,"tabService",void 0),na(this,"layoutService",void 0),na(this,"styleService",void 0),na(this,"configService",void 0),na(this,"visibilityService",void 0),na(this,"annotationEditService",void 0),na(this,"cropBoxEditService",void 0),na(this,"perspectiveQuadEditService",void 0),na(this,"eventsService",void 0),na(this,"dragService",void 0),na(this,"moveService",void 0),na(this,"scrollService",void 0),na(this,"zoomService",void 0),na(this,"slideService",void 0),na(this,"optimizationService",void 0),na(this,"interactionService",void 0),na(this,"selectPagesService",void 0),na(this,"keyboardService",void 0),na(this,"viewerConfig",Wd(dE)),na(this,"postfix",void 0),na(this,"isDestroyed",!1),na(this,"viewportWidth",0),na(this,"viewportHeight",0),na(this,"scrollByCurrentChanged",!1),na(this,"isInitialized",!1),na(this,"addPagesTimer",null),na(this,"isPanning",void 0),na(this,"isZooming",void 0),na(this,"isSliding",void 0),na(this,"isLoadSource",!1),na(this,"isFocusCanvas",!1),na(this,"isFocusViewer",!1),na(this,"hasBoxRendererModule",!1),na(this,"hasAnnotationModule",!1),this.core=t,this.viewer=e,this.postfix=e.postfix,this.hooks=e.hooks,this.uid=e.uid,this.groupUid=e.groupUid,ju(i,this.viewerConfig),this.styleService=new EE(this),this.viewService=this.register(new WE(this,this.hooks)),this.rendererService=this.register(new GE(this,this.hooks)),this.layoutService=new tP(this,this.hooks),this.configService=this.register(new iP(this)),this.tabService=this.register(new TE(this)),this.visibilityService=new ME(this),this.optimizationService=this.register(new cP(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new nP(this)),this.dragService=this.register(new sP(this)),this.moveService=this.register(new oP(this)),this.scrollService=this.register(new rP(this)),this.zoomService=this.register(new aP(this)),this.slideService=this.register(new hP(this)),this.interactionService=this.register(new dP(this,new gP(this),new fP(this),new mP(this),new vP(this),new yP(this))),this.selectPagesService=this.register(new uP(this)),this.keyboardService=this.register(new pP(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents()}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var t;return"visible"===(null===(t=this.viewerConfig)||void 0===t?void 0:t.visibility)}syncViewer(t){const e=t.getActiveTab();if(!e)return;const i=this.tabService.createTab(e.doc);if(i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e)}i.currentUid=e.currentUid,i.selectPages([...e.selected]),this.tabService.activateTab(i.uid),this.hooks.syncDocument.emit(i.doc),this.emitPageChangedEvent(i),this.showTab(i),this.emitPageChangedAfterRenderEvent(i)}toCanvas(t){const e=[];let i=null;i=t instanceof MouseEvent||t instanceof PointerEvent?[t]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t.changedTouches:t.touches;const{x:n,y:s}=this.rendererService.getCanvasPosition();for(let t=0;t<i.length;t++){const o=i[t];e.push({pageX:o.pageX-n,pageY:o.pageY-s})}return e}getPointerOverPageInfo(t,e){const i=function(t,e,i){const n={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(t)for(let s=0;s<t.pages.length;s++){const o=t.pages[s],r=LE(o,e,i,o.isVisible);if(r.isOver){n.index=s,Object.assign(n.pageInfo,r);const t=LE(o.image,e,i,!0);return t.isOver&&Object.assign(n.imageInfo,t),n}}return n}(this.getActiveTab(),t,e);return i}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const t=this.getActiveTab();t&&(this.clearCurrentTabOptimization(),this.showTab(t,!0))}updateViewportSize(){const{width:t,height:e}=this.viewService.getViewportSize();this.viewportWidth=t,this.viewportHeight=e,this.tabService.updateViewportSize(t,e)}handleViewerModeChanged(){const{postfix:t,viewService:e,isDefaultViewer:i,isPerspectiveViewer:n,isThumbnailViewer:s}=this;if(i||n||s){e.createMainAndThbContainer(t),e.createMainContainer(t),s||e.createThumbnailContainer(t),i&&(e.createVideoContainer(t),e.createAudioContainer(t)),I_(e.mainAndThbContainer,"flex");const{width:n,height:o}=e.getViewportSize();this.rendererService.initRenderer(e.canvasContainer,n,o),this.rendererService.updateCanvasSize()}}loadSource(t){const e=this.getActiveTab();let i=null==e?void 0:e.uid;if(!e){const t=this.core.createDocument({name:OS(),type:"document"});this.viewer.openDocument(t),i=t.uid}const n=vw.buildInfo("loadSource",{docUid:i,current:0,total:Ud(t)?t.length:1});return vw.info(n),this.core.loadSource(t,i,{exception:"ignore"},n)}openDocument(t){const{tabService:e}=this;let i=e.getTab(t.uid);if(!i){const n=e.getActiveTab();if(n&&this.hooks.closeDocument.emit(n.doc),i=e.createTab(t),i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e)}}i.isActive||(this.tabService.activateTab(i.uid),this.emitPageChangedEvent(i),this.showTab(i),this.hooks.openDocument.emit(t),this.emitPageChangedAfterRenderEvent(i))}closeTabs(t){const e=t.filter((t=>this.tabService.hasTab(t)));if(!e.length)return;const i=e.reduce(((t,e,i)=>{const n=this.tabService.getTab(e);return n&&t.push(n),t}),[]);i.forEach((t=>{t.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(t.uid),this.hooks.closeDocument.emit(t.doc)}));const n=this.tabService.getActiveTab();n?this.showTab(n):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(pS.create(-1,0)))}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas())}render(){if("hidden"===this.viewerConfig.visibility)return;if(this.isDestroyed)return;const t=this.getActiveTab();t&&this.rendererService.render(t)}showCurrentTab(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.getActiveTab();null!=e&&e.total&&this.showTab(e,t)}showTab(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||t.isDestroyed||(this.tabService.activateTab(t.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(t,e):this.isThumbnailViewer?this.showTabThumbnail(t,e):this.isPerspectiveViewer&&this.showTabPerspective(t)))}showTabDefault(t){const e=t;if(!e.isDocType)return;e.style.visibility="visible";const i=e.context.zoom;this.layoutService.layout(e),this.viewerConfig.zoom=e.context.zoom;const n=e.context.zoom!==i;if(this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:s,scrollTop:o}=e.context.parseReferenceDefault();e.context.setTabScrollValue(s,o),this.viewService.scrollTo(s,o),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),n&&this.clearCurrentTabOptimization(),this.rendererService.render(e),this.emitZoomChangedEvent(e)}showTabPerspective(t){const e=t;if(!e.isDocType)return;if(e.style.visibility="visible",this.layoutService.layout(e),this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:i,scrollTop:n}=e.context.parseReferenceDefault();e.context.setTabScrollValue(i,n),this.viewService.scrollTo(i,n),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),this.rendererService.render(e)}showTabThumbnail(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t.isDocType)return;if(t.style.visibility="visible",this.layoutService.layout(t),this.viewService.updateScrollerContentSize(t),this.rendererService.updateCanvasSize(),!t.total)return void this.rendererService.render(t);if(t.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:e,scrollTop:i}=t.context.getScrollValuesByCurrentChanged();t.context.setTabScrollValue(e,i)}const{scrollLeft:i,scrollTop:n}=t.context;this.viewService.scrollTo(i,n),this.visibilityService.handleVisibility(t),this.loadVisiblePages(t),e&&this.clearCurrentTabOptimization(),this.rendererService.render(t)}loadPageImage(t){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(t):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(t):null}loadVisiblePages(t){if(t.isDestroyed||null==t||!t.total)return;const e=[],i=[],n=t.getCurrentPage();let s=!1;t.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.uid===(null==n?void 0:n.uid)?s=!0:t.isVisible?i.push(t):t.isPreload&&e.push(t))}));const o=[];s&&o.push(n),o.push(...e.reverse(),...i.reverse()),o.forEach((e=>{!e.isPreload||e.isLoaded||e.isLoading||(e.isLoading=!0,this.loadPageImage(e.uid).then((i=>{e.isLoading=!1,i&&this.renderPage(t,e,i)})).catch((t=>{e.isLoading=!1})))}))}renderPage(t,e,i){if(!this.isDestroyed&&this.isVisible&&t.isActive&&t.pages.includes(e)&&!t.isDestroyed&&e.isPreload&&(e.isLoaded=!0,e.setImgDom(i),e.isVisible)){if(this.isDefaultViewer&&t.context.isSingleDisplay){const e=t.getCurrentPage();if(e&&!e.isLoaded)return}this.rendererService.render(t)}}emitPageChangedEvent(t){this.hooks.pageChanged.emit(pS.create(t.current,t.total))}emitPageChangedAfterRenderEvent(t){this.hooks.pageChangedAfterRender.emit(pS.create(t.current,t.total))}emitZoomChangedEvent(t){const{oldZoom:e,zoom:i}=t.context;this.hooks.zoomChanged.emit(JC.create(D_(e),D_(i)))}beforeLoadSource(t){this.isLoadSource=!0;const{tabService:e}=this,i=e.getDocTab(t);i&&i.updateOldInfo()}afterLoadSource(t){this.isLoadSource=!1;const{tabService:e}=this,i=e.getDocTab(t);i&&(this.emitPageChangedEvent(i),this.emitPageChangedAfterRenderEvent(i),i.updateOldInfo())}addPages(t,e,i,n){const{tabService:s}=this,o=s.getDocTab(t);o&&(o.appendPages(e,i,n),this.emitPageChangedEvent(o),o.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout((()=>{o.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(o)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null}),200)))}deletePages(t,e){const{tabService:i}=this,n=i.getDocTab(t);n&&(this.clearOptimization(e),n.deletePages(e),this.hooks.deletePages.emit(TS.create(e)),this.emitEventsForTab(n))}deleteAllPages(t){const{tabService:e}=this,i=e.getDocTab(t);if(!i)return;const n=i.pages.map((t=>t.uid));this.clearOptimization(n),i.deleteAllPages(),this.hooks.deletePages.emit(TS.create(n)),this.emitEventsForTab(i)}setCurrentPage(t,e){const{tabService:i}=this,n=i.getDocTab(t);n&&n.current!==e&&(n.gotoPage(e),this.emitEventsForTab(n))}selectPages(t,e){const{tabService:i}=this,n=i.getDocTab(t);if(!n)return;const s=n.getSelected(),o=n.getSelectedIndices();let r=!1;if(o.length!==e.length)r=!0;else for(let t=0;t<e.length;t++)if(o[t]!==e[t]){r=!0;break}if(!r)return;const a=n.indicesToUids(e);if(n.selectPages(a),n.isActive){this.showTab(n);const t=$C.create(o,[...e],[...s],a);this.hooks.selectedPageChanged.emit(t),this.viewer.emit("selectedPagesChanged",t)}}movePages(t,e,i){const n=this.tabService.getDocTab(t);n&&(n.movePages(e,i),this.emitEventsForTab(n,this.isDefaultViewer))}switchPage(t,e,i){const n=this.tabService.getDocTab(t);n&&(n.switchPage(e,i),this.emitEventsForTab(n,this.isDefaultViewer))}reorderPages(t,e){const i=this.tabService.getDocTab(t);i&&(i.reorderPages(e),this.emitEventsForTab(i,this.isDefaultViewer))}emitEventsForTab(t,e){t.isActive&&(this.emitPageChangedEvent(t),this.scrollByCurrentChanged=!0,this.showTab(t,e),this.emitPageChangedAfterRenderEvent(t))}updatePage(t,e,i){const n=this.tabService.getTab(t);if(n&&n.isActive){const t=n.getPageByUid(e);t.isLoaded=!1,t.isLoading=!1,this.clearOptimization([e]),this.showTab(n)}}renameDoc(t,e){const{tabService:i}=this,n=i.getTab(t);n&&(n.rename(e),this.hooks.tabChanged.emit())}filter(t,e,i){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const n=this.getActiveTab();n&&n.uid===t&&(e.forEach((t=>{const e=n.getPageByUid(t);e&&(e.isLoaded=!1)})),this.hooks.filterChanged.emit(wS.create(t,e,i)),this.loadVisiblePages(n),this.clearOptimization(e),this.rendererService.render(n))}activateTab(t){const e=this.tabService.getTab(t);return!!e&&(this.showTab(e),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach((t=>{const e=[];if(t.pages.forEach(((t,i)=>{t.isPreload&&e.push({from:!0,to:!1,pageUid:t.uid,index:i})})),e.length){const i=DS.create(t.uid,this.uid,this.viewerConfig.viewerMode,e);this.core.viewerService.onPagePreloadChanged.emit(i)}})),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose()}get isDefaultViewer(){return this.viewerConfig.viewerMode===$b.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===$b.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===$b.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===$b.CAPTURE}zoomTo(t,e,i){this.zoomService.zoomTo(t,e,i)}getPageRenderSize(t){const e=this.core.pageService.getPage(t);return this.isPerspectiveViewer?e.raw.getPageSize():e.mediaBox}emit(t,e){this.viewer.emit(t,e)}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const t=this.getActiveTab();if(t){const e=t.pages.map((t=>t.uid));this.clearOptimization(e)}}clearOptimization(t){const e=[],i=this.getActiveTab();i&&t.forEach((t=>{const n=i.getPageByUid(t);n&&(e.push(n.optimizationUid),n.clearOptimization())})),e.forEach((t=>{this.optimizationService.cancelOptimization(t)}))}}class wP extends Ju{constructor(t){super(),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"group",void 0),na(this,"postfix",void 0),na(this,"context",void 0),na(this,"emitter",void 0),na(this,"hooks",void 0),na(this,"core",void 0),na(this,"isDisposed",!1),this.emitter=new iu,t.core&&(this.core=t.core),this.uid=Qd(),this.groupUid=t.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new qb),this.context=new xP(this.core,this,t.viewerConfig),t.container&&!t.uiConfig&&this.context.viewService.bindContainer(t.container),this.listenGlobalEvents()}listenGlobalEvents(){const{documentService:t,viewerService:e}=this.core,{context:i}=this;this.core.onBeforeLoadSource.on((t=>{let{docUid:e}=t;i.beforeLoadSource(e)}),this),this.core.onAfterLoadSource.on((t=>{i.afterLoadSource(t.docUid)}),this),this.core.pageService.onUpdatePage.on((t=>{i.updatePage(t.docUid,t.pageUid,t.data),i.hooks.updatePage.emit(t)}),this),t.onAddPagesToDoc.on((t=>{const{group:e}=this;let{scrollToLatest:n}=e.config;Hd(n)&&({scrollToLatest:n}=i.viewerConfig),i.addPages(t.docUid,t.pageUids,n,t.index),i.hooks.addPagesToDoc.emit(t)}),this),t.onDeletePagesFromDoc.on((t=>{i.deletePages(t.docUid,t.pageUids)}),this),t.onDeleteAllPagesFromDoc.on((t=>{i.deleteAllPages(t.docUid)}),this),t.onMovePages.on((t=>{i.movePages(t.docUid,t.indices,t.insertBeforeIndex)}),this),t.onSwitchPage.on((t=>{i.switchPage(t.docUid,t.one,t.another)}),this),t.onReorderPages.on((t=>{i.reorderPages(t.docUid,t.indices)}),this),t.onBeforeDeleteDocs.on((t=>{i.closeTabs(t.docUids)}),this),t.onDocumentRenamed.on((t=>{i.renameDoc(t.docUid,t.newName)}),this),t.onDocumentDeleted.on((t=>{i.closeTabs([t.docUid])}),this),t.onOpenDocument.on((t=>{i.groupUid===t.groupUid&&i.openDocument(t.doc)}),this),t.onCloseDocument.on((t=>{i.groupUid===t.groupUid&&i.closeTabs([t.doc.uid])}),this),e.onGotoPage.on((t=>{i.groupUid===t.groupUid&&i.setCurrentPage(t.docUid,t.index)}),this),e.onSelectPages.on((t=>{i.groupUid===t.groupUid&&i.selectPages(t.docUid,t.indices)}),this),e.onResize.on((()=>{i.resize()}),this),e.onCurrentChangedByScroll.on((t=>{i.groupUid===t.groupUid&&i.uid!==t.viewerUid&&i.setCurrentPage(t.docUid,t.current)}),this),this.core.onFilterChanged.on((t=>{const e=i.getActiveTab();(null==e?void 0:e.uid)===t.docUid&&i.filter(t.docUid,t.pageUids,t.filterType)}),this),this.core.commandService.onOperationsChanged.on((t=>{const e=i.getActiveTab();e?e.uid===t.docUid&&i.hooks.operationsChanged.emit(t):this.hooks.operationsChanged.emit({docUid:t.docUid,undo:0,redo:0})}),this)}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose())}undo(){const t=this.context.getActiveTab();return!!t&&this.core.commandService.undo(t.uid)}redo(){const t=this.context.getActiveTab();return!!t&&this.core.commandService.redo(t.uid)}getOperationState(){const t=this.context.getActiveTab();return t?this.core.commandService.getOperationState(t.uid):{undo:0,redo:0}}saveOperations(){const t=this.context.getActiveTab();return!!t&&this.core.commandService.saveOperations(t.uid)}setRowAndColumn(t,e){return this.context.configService.updateConfig({rows:t,columns:e}),!0}getRowAndColumn(){const t=this.context.getActiveTab();if(t)return{rows:t.context.rows,columns:t.context.columns};const{viewerConfig:e}=this.context;return{rows:e.rows||1,columns:e.columns||1}}on(t,e){this.emitter.on(t,e)}emit(t,e){this.emitter.emit(t,e)}off(t,e){this.emitter.off(t,e)}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(t){this.context.configService.updateConfig(t)}bindContainer(t){return this.context.viewService.bindContainer(t)}unbindContainer(){this.context.viewService.unbindContainer()}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab()}hide(){this.updateViewerConfig({visibility:"hidden"})}render(){}resize(){this.context.resize()}indexToUid(t){const e=this.context.getActiveTab();return null==e?void 0:e.indexToUid(t)}uidToIndex(t){const e=this.context.getActiveTab();return e?e.uidToIndex(t):-1}getCurrentPageIndex(){const t=this.context.getActiveTab();return t?t.current:-1}getPageCounts(){const t=this.context.getActiveTab();return t?t.total:0}getCurrentPageUid(){var t;const e=this.context.getActiveTab();return null==e||null===(t=e.getCurrentPage())||void 0===t?void 0:t.uid}selectAllPages(){const t=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(t).keys()))}selectPagesByIndices(t){const e=this.context.getActiveTab();if(!e)return[];const i=e.indicesToUids(t);return this.core.viewerService.onSelectPages.emit(xS.create(e.uid,this.groupUid,this.uid,t)),[...i]}getSelectedPageIndices(){const t=this.context.getActiveTab();return t?t.getSelectedIndices():[]}gotoPage(t){const e=this.context.getActiveTab();return e?(t=Jd(t,0,e.total-1),e.current===t||this.core.viewerService.onGotoPage.emit(vS.create(e.uid,this.groupUid,this.uid,t)),t):-1}movePages(t,e){const i=this.context.getActiveTab();return!!i&&this.core.movePages(i.uid,t,e)}swapPages(t,e){const i=this.context.getActiveTab();return!!i&&this.core.swapPages(i.uid,t,e)}reorderPages(t){const e=this.context.getActiveTab();return!!e&&this.core.reorderPages(e.uid,t)}deletePages(t){const e=this.context.getActiveTab();if(!e)return!1;if(!t.every((t=>t>=0&&t<e.total)))return!1;const i=e.indicesToUids(t);return this.core.deletePages(e.uid,i)}deleteAllPages(){const t=this.context.getActiveTab();return!!t&&this.core.deleteAllPages(t.uid)}openDocument(t){this.core.openDocument(t.uid,this.uid)}closeDocument(t){if(!t){const e=this.context.getActiveTab();if(!e)return;t=e.uid}this.core.closeDocument(t,this.uid)}printDocument(){}activateTab(t){var e;return(null===(e=this.context)||void 0===e?void 0:e.activateTab(t))||!1}getActiveTab(){var t;return(null===(t=this.context)||void 0===t?void 0:t.getActiveTab())||null}getAllTabs(){var t;return(null===(t=this.context)||void 0===t?void 0:t.tabService.getAllTabs())||[]}getRealPageSize(t){const e=this.context.getActiveTab();if(!e)return{width:0,height:0};Hd(t)&&(t=e.current);const i=e.getPageByIndex(t);return{width:i.rWidth,height:i.rHeight}}getRealPtPageSize(t){const e=this.context.getActiveTab();if(!e)return{width:0,height:0};Hd(t)&&(t=e.current);const i=e.getPageByIndex(t);let n=$u(i.rWidth,Ep.displayResolution,72),s=$u(i.rHeight,Ep.displayResolution,72);const o=Math.round(n),r=Math.round(s);return Math.abs(n-o)<1e-6&&(n=o),Math.abs(s-r)<1e-6&&(s=r),{width:n,height:s}}getRealPixelSize(t){const e=this.context.getActiveTab();if(!e)return{width:0,height:0};Hd(t)&&(t=e.current);const i=e.getPageByIndex(t),n=this.core.pageService.getPage(i.uid),{rWidth:s,rHeight:o}=n.getEditResultForPerspective();return{width:$u(s,Ep.displayResolution,n.resource.resolutionX),height:$u(o,Ep.displayResolution,n.resource.resolutionY)}}zoomIn(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{maxZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let n=bP(i,"in");(null===n||n>e)&&(n=e),this.updateViewerConfig({zoom:n})}zoomOut(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{minZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let n=bP(i,"out");(null===n||n<e)&&(n=e),this.updateViewerConfig({zoom:n})}filter(t,e){const i=this.context.getActiveTab();if(!i)return!1;const n=i.indicesToUids(t);return this.core.filterPages(i.uid,n,e),!1}async perspectivePage(t,e){const i=this.context.getActiveTab();if(!i)return null;let n=i.currentUid;return Hd(e)||(n=i.indexToUid(e)),t=$u(t,this.context.core.pageService.getPage(n).resource.resolutionX,Ep.displayResolution),(await this.core.perspectivePage(i.uid,n,t)).data}perspectiveAllPage(){const t=this.context.getActiveTab();if(!t)return;const e=[],i=[],n=[];t.pages.forEach(((t,s)=>{t.isVisible?e.push(s):t.isPreload?i.push(s):n.push(s)}));const s=[...e,...i,...n],{displayResolution:o}=Ep;for(let e=0;e<s.length;e++){const i=this.indexToUid(s[e]),n=this.context.core.pageService.getPage(i);if(n.isFull){let{width:e,height:s}=n.raw.getImageDetail();const r=Math.abs((n.rotation%360+360)%360);if(90===r||270===r){const t=e;e=s,s=t}const a=[[0,0],[e,0],[e,s],[0,s]];this.context.core.perspectivePage(t.uid,i,$u(a,n.resolutionX,o),!0)}else if(n.activeQuad&&n.activeQuad!==n.quad){const{width:e,height:s}=n.raw.getPageSize(),o=HS(n.activeQuad.flat(),n.rotation,e,s),r=GS(o);this.context.core.perspectivePage(t.uid,i,r,!0)}}}getPerspectivePreviewImage(t,e,i,n){const s=this.context.getActiveTab();if(!s)return null;const o=s.getPageByIndex(t);if(!o)return null;const r=o.uid,{quadSelectionStyle:a}=this.getViewerConfig(),{borderColor:l}=Au(a.border),h=function(t){const e=t=>{const e=t.toString(16);return 1===e.length?`0${e}`:e};if(t.startsWith("rgb")){const i=t.match(/(\d+)/g);if(3===i.length){const t=parseInt(i[0],10),n=parseInt(i[1],10),s=parseInt(i[2],10);return`#${e(t)}${e(n)}${e(s)}`}}return!t.startsWith("#")||7!==t.length&&4!==t.length?"#FE8E14":t}(l);return this.context.core.getPerspectivePreviewData(r,{width:e||200,height:i||200},{strokeColor:h.substring(1),lineWidth:n})}}function bP(t,e){const i=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===e){for(let e=0;e<i.length;e++)if(i[e]>t)return i[e]}else for(let e=i.length-1;e>=0;e--)if(i[e]<t)return i[e];return null}class CP extends Ju{constructor(t){super(),na(this,"isDestroyed",!1),na(this,"viewers",new Map),na(this,"groups",new Map),na(this,"onGotoPage",void 0),na(this,"onSelectPages",void 0),na(this,"onCurrentChangedByScroll",void 0),na(this,"onResize",void 0),na(this,"onPagePreloadChanged",void 0),na(this,"onViewerCreated",void 0),na(this,"core",void 0),this.core=t,this.initEventEmitter()}initEventEmitter(){this.onGotoPage=tp(this),this.onSelectPages=tp(this),this.onCurrentChangedByScroll=tp(this),this.onResize=tp(this),this.onPagePreloadChanged=tp(this),this.onViewerCreated=tp(this)}reset(){for(const t of this.viewers.values())t.dispose();this.viewers.clear(),this.groups.clear()}destroy(){if(!this.isDestroyed){for(const t of this.viewers.values())t.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0}}createViewer(t,e){var i;const{groupUid:n}=e,s=this.groups.get(n)||new Gb(n);var o;Hd(null===(i=e.viewerConfig)||void 0===i?void 0:i.scrollToLatest)||s.isSetScrollToLatest||(s.updateConfig({scrollToLatest:null===(o=e.viewerConfig)||void 0===o?void 0:o.scrollToLatest}),s.isSetScrollToLatest=!0),e.groupConfig&&s.updateConfig(e.groupConfig);const r=new t(e);r.group=s,s.viewerUids.add(r.uid),this.groups.set(n,s),this.viewers.set(r.uid,r);const a=this.getViewersByGroupUid(n);if(a.length>0){r.context.syncViewer(a[0]);const t=a[0].getActiveTab();t&&this.core.commandService.emitOperationsChanged(t.uid)}return this.onViewerCreated.emit(kS.create(r)),r}removeViewer(t){let e;if(e=Zd(t)?this.getViewer(t):t,!e)return!1;const{uid:i,groupUid:n}=e,s=this.groups.get(n);return s&&(s.viewerUids.delete(i),s.viewerUids.size||this.groups.delete(n)),this.viewers.delete(e.uid),e.dispose(),!0}hasViewer(t){return this.viewers.has(t)}getViewer(t){return this.viewers.get(t)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(t){const e=this.viewers.get(t);return this.getViewersByGroupUid(e.groupUid)}getViewersByGroupUid(t){return this.groups.has(t)?this.groups.get(t).getViewerUids().map((t=>this.viewers.get(t))):[]}hasGroup(t){return this.groups.has(t)}}const SP={apply(t){t.viewerService=new CP(t)},install(t){t.setClass("Viewer",wP)}},_P=/^<\/([^>]*)>/,TP=/^<([^\s>]+)[^>]*>/,EP=/^<slot>.*<\/slot>/,PP=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function AP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:i,data:n,components:s,injection:o}=t,r=IP(i,n,s,o,e),a=r.length;return a&&(r[0].cpInstance=t,r[a-1].cpInstance=t),r}function IP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=t.trim();const r=[];function a(t){o=o.substring(t)}function l(t){let[s,o]=t;if(o){const t=function(t){const e={},i=Hu(t,PP);return i?(i.forEach((t=>{let[,i,n]=t;e[i]=n})),e):e}(s),a=e[":for"];a&&(delete e[":for"],t[":for"]=a);const l={type:"start",name:o,data:e,attrs:t};if(r.push(l),(i[o]||n.components&&n.components[o])&&(l.cpOption={Component:i[o]||n.components[o],injection:n}),"input"===o||/\/>/.test(s)){const t={type:"end",name:o,data:e,attrs:{}};r.push(t)}}}function h(t){let[,e]=t;if(e){const t={type:"end",name:e,attrs:{}};r.push(t)}}function c(t){if(t=t.trim()){const i={type:"text",name:t,attrs:{},data:e};r.push(i)}}for(;o;){const t=o.indexOf("<");let e;if(0===t){const t=o.match(_P);if(t){a(t[0].length),h(t);continue}const i=o.match(EP);if(i){a(i[0].length),r.push(...s);continue}const n=o.match(TP);if(n&&n[0]!==n.input){a(n[0].length),l(n);continue}e=o}else e=t>0?o.substring(0,t):o;e&&(a(e.length),c(e))}return r}function DP(t){const{cpInstance:e,children:i}=t;e&&!e.isInserted&&(e.isInserted=!0,e.hooks.inserted.emit()),i.forEach((t=>{DP(t)}))}function kP(t){const{cpInstance:e,children:i}=t;e&&e.hooks.destroyed.emit(t),i.forEach((t=>{kP(t)}))}function RP(t){if(t){const{el:e,children:i}=t;if(function(t){const{cpInstance:e}=t;e&&(e.dispose(),e.hooks.beforeDestroyed.emit(t))}(t),e){const i=e.parentElement;i&&i.removeChild(e),e.vNode=null,t.el=null}return kP(t),t.text=null,t.parent=null,i.length&&i.forEach((t=>{RP(t)})),!0}return!1}class MP{constructor(t){na(this,"el",void 0),na(this,"tagName",void 0),na(this,"sel",""),na(this,"data",void 0),na(this,"children",void 0),na(this,"text",void 0),na(this,"key",void 0),na(this,"cpInstance",void 0),na(this,"cpOptions",void 0),na(this,"parent",void 0),this.createVNode(t)}renderDom(){if(this.el)return this.el;let t;if("FRAGMENT"===this.tagName)t=document.createDocumentFragment();else if("TEXT"===this.tagName){const e=function(t){return 0===t.length?"":t.replace(function(){if(Su)return Su;let t="";return _u(Cu,(e=>{t+=`${e}|`})),t+="&#(\\d{1,5});",Su=new RegExp(t,"g"),Su}(),((t,e)=>bu[t]||String.fromCharCode(+e)))}(this.text);t=document.createTextNode(e)}else{t=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[e,i]of Object.entries(this.data))t.setAttribute(e,i)}return this.children.forEach((e=>{const i=e.renderDom();t.appendChild(i)})),t.vNode=this,this.el=t,function(t){const{cpInstance:e,el:i}=t;e&&(e.vNode=t,e.hooks.created.emit(i))}(this),t}patch(t){return function(t,e){const i=t.el,n=i.parentNode;null!==n&&(e.el=e.renderDom(),Eu(e.el,i,n),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;e<=i;)RP(t[e]),e+=1}([t]));let s=-1;const o=t.parent;return null==o||o.children.forEach(((e,i)=>{e===t&&(s=i)})),s>-1&&(o.children[s]=e,e.parent=o,t.el=null),e}(this,t)}destroy(){return RP(this)}createVNode(t){const{tagName:e,data:i={},children:n=[],el:s=null,key:o,text:r="",cpOptions:a,cpInstance:l}=t;let h=e;i.id&&(h+=`#${i.id}`),i.class&&(h+=`.${i.class}`),this.sel=h,this.data=i,this.tagName=e,this.children=n,this.el=s,this.key=o,this.text=r,this.cpInstance=l,this.cpOptions=a}}function LP(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],n=[];let s=[];return t.forEach((t=>{if("start"===t.type)i.push(t),n.push(s),s=[];else if("text"===t.type)s.push({type:"text",value:t.name,data:t.data});else if(t instanceof MP)s.push(t);else{let e=i.pop();for(;e.name!==t.name;)e=i.pop();if(e){const{name:t,cpInstance:i,attrs:o,cpOption:r,data:a}=e,l={type:"token",tagName:t,cpInstance:i,cpOption:r,attrs:o,data:a,children:s};s.forEach((t=>{t.parent=l})),s=n.pop(),s.push(l)}}})),e?s[0]:s}const OP=/'.+'|\\".+\\"|[\w$.]+/g,BP=/{{([^\s@}]+)}}/;function FP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ud(t)){const e=[];return t.forEach((t=>{e.push(...UP(FP(t)))})),e}if(t instanceof MP)return t;if("token"===t.type){var i;const{tagName:n,attrs:s,cpInstance:o,children:r,data:a,cpOption:l}=t;if(s[":for"])return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:i,data:n}=t,s=JSON.parse(JSON.stringify(i)),o={":for":i[":for"]};delete i[":for"],NP(o,{...n,...e});const r=[];return o[":for"].forEach((e=>{const i=FP(t,e);r.push(...UP(i))})),t.attrs=s,r}(t,e);const h={...a,...e},c={...s};let d;if(NP(s,h),Object.prototype.hasOwnProperty.call(s,"if")&&!s.if)d=null;else if(delete s.if,l)d=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:i,attrs:n,cpOption:s}=t,o=VP(i,e),{Component:r,injection:a}=s,l=LP(AP(new r({data:n,injection:a}),o));return l?UP(FP(l))[0]:null}(t,e);else{const{key:t}=s;void 0!==t&&delete s.key;const i=VP(r,e);d=new MP({tagName:n.toUpperCase(),data:s,cpInstance:o,key:t,children:i})}return t.attrs=c,null===(i=d)||void 0===i||i.children.forEach((t=>{t.parent=d})),d}return function(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:n}=t;const s=null===(e=t.parent)||void 0===e||null===(e=e.attrs)||void 0===e?void 0:e.html;return n=function(t,e){const i=Hu(t,BP);return i.length&&i.forEach((i=>{const n=i[1].split(".").reduce(((t,e)=>t[e]),e),s=i[0];t=t.replace(s,n)})),t}(n.trim(),{...t.data,...i}),s?FP(LP(IP(n),!1)):new MP({tagName:"TEXT",text:n})}(t,e)}function NP(t,e){for(const s of Object.keys(t)){const[,o,r]=s.match(/^(:|@)(.+)/)||[];if(!r)continue;let a=t[s];if(delete t[s],"for"===r){var i,n;let[s,o]=a.split(" in "),[r,l]=s.split(",");r=r.trim(),l=null===(i=l)||void 0===i?void 0:i.trim(),o=null===(n=o)||void 0===n?void 0:n.trim();const h=[],c=o.split(".").reduce(((t,e)=>t[e]),e);if(Ud(c))c.forEach(((t,e)=>{const i={};i[r]=t,l&&(i[l]=e),h.push(i)}));else if(Vd(c))for(const[t,e]of Object.entries(c)){const i={};i[r]=e,l&&(i[l]=t),h.push(i)}t[":for"]=h}else{const i="this"===a?e:a.split(".").reduce(((t,e)=>null==t?void 0:t[e]),e);if(void 0!==i)"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i;else{a=a.replace(OP,(t=>t.includes('"')||t.includes("'")||/^(true|false|\d+|undefined|null)$/.test(t)?t:t.split(".")));try{const i=WP(a,e);Vu(i)&&(t[r]=void 0),"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i}catch(e){t[r]=void 0}}"@"===o&&(t.events||(t.events={}),t.events[r]=t[r],delete t[`@${r}`])}}}function UP(t){return t?(Ud(t)||(t=[t]),t):[]}function VP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];return t.forEach((t=>{const n=FP(t,e)||[];i.push(...UP(n))})),i}function WP(t,e){let i=null;try{const n=t.split(",");for(let t=0;t<n.length;t++){const i=n[t],s=/(\w+)(\[(\d+)\])?/,o=i.match(s);if(!o){e=null;break}{const t=o[1],i=o[3];if(!Object.prototype.hasOwnProperty.call(e,t)){e=null;break}e=e[t],void 0!==i&&Array.isArray(e)&&(e=e[i])}}i=e}catch(t){i=null}return i}class HP extends Ju{constructor(t){let{data:e={},template:i="",components:n={},injection:s={}}=t;super(),na(this,"el",void 0),na(this,"vNode",null),na(this,"template",""),na(this,"data",{}),na(this,"injection",{}),na(this,"components",{}),na(this,"emitter",void 0),na(this,"uiEmitter",void 0),na(this,"isInserted",!1),na(this,"hooks",{created:su.create(),inserted:su.create(),updated:su.create(),beforeDestroyed:su.create(),destroyed:su.create()}),na(this,"selfEvents",[]),na(this,"globalEvents",[]),na(this,"nativeEvents",[]),this.template=i,this.emitter=iu.create(),this.setData(e),this.setComponents(n),this.setInjects(s),this.uiEmitter=this.injection.emitter,this.hooks.created.on((t=>{this.el=t})),this.hooks.destroyed.on((()=>{this.dispose()})),this.initEvents()}setInjects(t){Object.assign(this.injection,t)}initEvents(){var t=this;const e=(e,i)=>{this.on(e,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];Zd(i)?t.$emit(i,n):$d(i)&&i(...n)}))};for(const[t,n]of Object.entries((null===(i=this.data)||void 0===i?void 0:i.events)||{})){var i;e(t,n)}for(const[t,i]of Object.entries((null===(n=this.data)||void 0===n||null===(n=n.options)||void 0===n?void 0:n.events)||{})){var n;e(t,i)}}setData(t){Object.assign(this.data,t)}setComponents(t){Object.assign(this.components,t)}on(t,e){this.emitter.on(t,e),this.selfEvents.push([t,e])}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.emitter.emit(t,...i)}unbindSelfEvents(){this.selfEvents.forEach((t=>{let[e,i]=t;this.emitter.off(e,i)})),this.selfEvents=[]}$on(t,e){var i;this.uiEmitter&&(null===(i=this.uiEmitter)||void 0===i||i.on(t,e),this.globalEvents.push([t,e]))}$emit(t){for(var e,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];null===(e=this.uiEmitter)||void 0===e||e.emit(t,...n)}unbindGlobalEvents(){this.globalEvents.forEach((t=>{let[e,i]=t;this.uiEmitter.off(e,i)})),this.globalEvents=[]}nativeOn(t,e,i){if(Ud(t))t.forEach((t=>{this.nativeOn(t,e,i)}));else{const n=((t,e,i)=>t?(t.addEventListener(e,i,void 0),()=>{t.removeEventListener(e,i)}):null)(t,e,i);n&&this.nativeEvents.push(n)}}unbindNativeEvents(){this.nativeEvents.forEach((t=>{t()})),this.nativeEvents=[]}query(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelector(t)}queryAll(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelectorAll(t)}parseHTML(){return FP(LP(AP(this,[])))}reRenderVNode(){const t=function(t){return FP(LP(AP(t)))}(this);this.vNode.patch(t)}bindEventsEmitter(){var t=this;const{options:e}=this.data;if(null!=e&&e.events)for(const[i,n]of Object.entries(e.events))this.nativeOn(this.el,i,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];t.emit(i,...n)}))}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose()}}const jP=(t,e,i,n)=>{const{id:s,tooltip:o,dataId:r,style:a,className:l}=t||{},h=(t=>{let e="";if(t)for(const[i,n]of Object.entries(t))e+=`${Fd(i)}:${n};`;return e})(a);return(Hd(s)?"":` id="${s}"`)+` class="${e}${null!=i?i:""} ${l||""}"`+(Hd(n)?"":` :class="${n}"`)+(h?` style="${h}"`:"")+(Hd(o)?"":` title="${o}"`)+(Hd(r)?"":` data-id="${r}"`)};function zP(t){if(0===Object.keys(t).length||!t)return'<MainView :options="this"></MainView>';const e=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==t?void 0:t.type);return Zd(t.type)&&!e?`<${t.type} :options="this"></${t.type}>`:'<Root :options="this"></Root>'}function GP(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const e=Wd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=e&&e.children&&(e.children=e.children.map((t=>Zd(t)?{type:t}:Vd(t)?GP(t):t))),t.length&&(e.children||Ud(e.children)||(e.children=[]),e.children.push(...t)),e}class YP{constructor(t){na(this,"options",void 0),na(this,"postfix",void 0),na(this,"uiEvents",[]),na(this,"parsedUiConfig",void 0),na(this,"injection",void 0),na(this,"rootComponent",void 0),na(this,"emitter",null),na(this,"rootDom",null),na(this,"rootVNode",void 0),na(this,"container",void 0),na(this,"uiConfig",{}),na(this,"popupUiConfig",[]);const{container:e,injection:i,postfix:n,uiConfig:s,emitter:o,popupUiConfig:r}=t;this.options=t,this.injection=i,this.uiConfig=s,this.popupUiConfig=r,this.parsedUiConfig=GP(s,r),this.emitter=o||iu.create(),this.postfix=n||`-${Qd()}`,Zd(e)?this.container=document.getElementById(e):e instanceof HTMLElement&&(this.container=e),this.init()}static registerComponent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[e,i]of Object.entries(t))YP.isAlreadyRegistered(e)||(this.components[`DDV${e}`]=i,this.components[e]=i)}static isAlreadyRegistered(t){return!!this.components[t]}static getComponents(){return this.components}init(){const t=new HP({data:this.parsedUiConfig,template:zP(this.parsedUiConfig),components:YP.getComponents(),injection:{...this.injection,components:YP.getComponents(),postfix:this.postfix,emitter:this.emitter}}),e=t.parseHTML();if(!e)return;const i=e.renderDom();this.rootComponent=t,this.rootVNode=e,this.rootDom=i,this.container&&(this.container.appendChild(i),DP(this.rootVNode))}updateUiConfig(t){const e=GP(t,this.popupUiConfig),i=new HP({data:e,template:zP(this.parsedUiConfig),components:YP.getComponents(),injection:{...this.injection,components:YP.getComponents(),postfix:this.postfix,emitter:this.emitter}}).parseHTML(),n=this.rootVNode.patch(i);return this.rootDom=n.el,this.rootVNode=n,this.uiConfig=t,DP(this.rootVNode),!0}bindContainer(t){let e;if(eu(t)&&(e=t),Zd(t)){const i=document.getElementById(t);eu(i)&&(e=i)}return!!e&&(this.container=e,e.appendChild(this.rootDom),DP(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null}}queryByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelector(`[data-id=${t}]`)}queryAllByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelectorAll(`[data-id=${t}]`)}getElementsByType(t,e){var i;const n=[];return(null===(i=t.cpInstance)||void 0===i||null===(i=i.constructor)||void 0===i?void 0:i.cpName)===e&&t.el&&n.push(t.el),t.children.length>0&&t.children.forEach((t=>{n.push(...this.getElementsByType(t,e))})),n}on(t,e){const i=this.emitter.on(t,e);this.uiEvents.push(i)}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.emitter.emit(t,...i)}off(t,e){this.emitter.off(t,e)}offAllEvents(){this.uiEvents.forEach((t=>{let{name:e,fn:i,context:n,once:s}=t;this.emitter.off(e,i,n,s)}))}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},kP(this.rootVNode)}}na(YP,"components",{});class $P extends HP{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(t),na(this,"defaultClass","ddv-button"),this.initTemplate(e),this.bindBaseHooks()}bindBaseHooks(){this.hooks.inserted.on((t=>{this.bindEventsEmitter()}))}initTemplate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:e}=this.data,i=""===t?this.defaultClass:`${this.defaultClass} ${t}`,n=`<div ${jP(e,i)} >`+(Hd(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+"<slot></slot></div>";this.template=n}}class XP extends HP{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(t),na(this,"defaultClass","ddv-layout"),na(this,"enableScroll",!1),na(this,"showScrollArrow",!0),na(this,"scrollLeftOrTopBtn",void 0),na(this,"scrollRightOrBottomBtn",void 0);const{options:i}=this.data;this.enableScroll=(null==i?void 0:i.enableScroll)||!1,this.showScrollArrow=(null==i?void 0:i.showScrollArrow)||!0,this.initTemplate((null==i?void 0:i.flexDirection)||e),this.bindHooks()}bindHooks(){this.hooks.inserted.on((()=>{qP(this),this.bindCustomScroll()})),this.hooks.updated.on((()=>{qP(this)}))}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const t=new ResizeObserver((()=>{this.showScrollArrow&&this.updateCustomScrollButton()}));t.observe(this.el),this.hooks.destroyed.on((()=>{t.disconnect()}))}initCustomScrollButton(){const t=document.createElement("div"),e=document.createElement("div"),i=150;this.nativeOn(t,"click",(()=>{const{scrollLeft:e,scrollTop:n}=this.el;t.classList.contains("ddv-scroll-top")?this.el.scroll(0,n-i):this.el.scroll(e-i,0)})),this.nativeOn(e,"click",(()=>{const{scrollLeft:t,scrollTop:n}=this.el;e.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,n+i):this.el.scroll(t+i,0)})),this.nativeOn(this.el,"scroll",(t=>{this.showScrollArrow&&this.updateCustomScrollButton()})),this.el.appendChild(t),this.el.appendChild(e),this.scrollLeftOrTopBtn=t,this.scrollRightOrBottomBtn=e,this.updateCustomScrollButton()}updateCustomScrollButton(){const{vertical:t,horizontal:e}=ZP(this.el),{scrollLeft:i,scrollTop:n}=this.el,{scrollRightOrBottomBtn:s,scrollLeftOrTopBtn:o}=this;if(!o||!s)return;if(!t&&!e)return o.style.display="none",void(s.style.display="none");o.className="ddv-scroll-button "+(e?"ddv-scroll-left":"ddv-scroll-top"),s.className="ddv-scroll-button "+(e?"ddv-scroll-right":"ddv-scroll-bottom");const r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:i,horizontal:n}=ZP(t);if(!i&&!n)return[!1,!1];const{scrollLeft:s,scrollTop:o,scrollHeight:r,scrollWidth:a,clientWidth:l,clientHeight:h}=t;return n?[s<=e,s+l-e>=a]:[o<=e,o+h-e>=r]}(this.el,0);e?(o.style.left=`${i}px`,s.style.right=-i+"px"):(o.style.top=`${n}px`,s.style.bottom=-n+"px"),o.style.display=r[0]?"none":"",s.style.display=r[1]?"none":""}initTemplate(t){const{options:e}=this.data,i=(null==e?void 0:e.children)||[],n="row"===t?"":"-col";let s=`${this.defaultClass}${n}`;this.enableScroll&&(s+=" ddv-custom-scroll-hidden");let o=`<div ${jP(e,s)}>`;i&&i.length&&i.forEach(((t,e)=>{if(Vd(t)){const{type:i}=t;i.trim(),i.length>0&&(o+=`<${i} :options="options.children[${e}]"></${i}>`)}})),o+="</div>",this.template=o}}function qP(t){const{options:e}=t.data,i=t.el.children;((null==e?void 0:e.children)||[]).forEach(((e,n)=>{if(eu(e)){const s=e;0===n?(t.el.append(s),t.el.insertBefore(s,i[0])):((t,e)=>{const i=e.parentNode;i.lastChild===e?i.appendChild(t):Eu(t,e.nextSibling,i)})(s,i[n-1])}}))}function ZP(t){let e=t.scrollHeight>t.clientHeight,i=t.scrollWidth>t.clientWidth;return e&&i&&(t.scrollHeight-t.clientHeight>t.scrollWidth-t.clientWidth?i=!1:e=!1),{vertical:e,horizontal:i}}class JP extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks()}initTemplate(){const{options:t}=this.data,{children:e}=t,i="column"===t.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass;let n=`<div ${jP(t,i,"")} >`;e&&e.length&&e.forEach(((t,e)=>{if(Vd(t)){const{type:i}=t;i.trim(),i.length>0&&(n+=`<${i} :options="options.children[${e}]"></${i}>`)}})),n+="</div>",this.template=n}bindHooks(){this.hooks.inserted.on((()=>{qP(this)}))}}class KP extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on((()=>{this.updateClassName()})),this.hooks.updated.on((()=>{this.isInserted&&this.updateClassName()}))}updateClassName(){const t=this.el.parentNode,e=window.getComputedStyle(t),{flexDirection:i}=e;"column"===i&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"))}initTemplate(){const{options:t}=this.data,e=jP(t,this.defaultClass);this.template=`<div ${e}></div>`}}const QP={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"},tA=["Arial","Courier","Helvetica","Times New Roman"],eA=function(){let t=0,e=0;return function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&clearTimeout(t),s){const s=!t;t=setTimeout((()=>{e!==t&&(t=0,e=0,i())}),n),s&&(e=t,i())}else t=setTimeout((()=>{i(),t=0}),n)}}();function iA(t,e,i){const n=n=>{const s=(parseFloat(n.value)-e)/(i-e)*100;t.style.backgroundSize=`${s}% 100%`};n(t),t.oninput=e=>{n(t)},t.onchange=e=>{n(t)}}function nA(t,e){const{bottom:i,height:n}=t.parentNode.getBoundingClientRect(),{height:s}=t.getBoundingClientRect(),{bottom:o}=e.getBoundingClientRect();let r=n;return o-i<s&&(r=-s),r}function sA(t){t.$on("ui_hidePopup",(e=>{e!==t&&$d(null==t?void 0:t.togglePopup)&&(null==t||t.togglePopup(!1))}))}function oA(t){t.$on("ui_cropClick",(e=>{const{viewer:i}=t.injection,n=i.getPageCounts()||0;(e||n)&&aA(t.el,e)}))}function rA(t){t.$on("ui_toolModeRefactor",(()=>{const{viewer:e}=t.injection,i=e.getPageCounts()||0,{toolMode:n}=e.context.viewerConfig;i&&aA(t.el,"annotation"===n||"crop"===n)}))}function aA(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,n=i.contains("ddv-button-disabled");e?n||t.classList.add("ddv-button-disabled"):n&&!e&&t.classList.remove("ddv-button-disabled")}function lA(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!t)return;const{classList:n}=t;let s="ddv-button-activated";"deep"===i?s="ddv-button-activated-deep":"light"===i&&(s="ddv-button-activated-light");const o=n.contains(s);e?o||t.classList.add(s):t.classList.remove(s)}function hA(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:o,right:r,bottom:a}=function(t,e){const i=(e||t.parentElement).getBoundingClientRect(),n=t.getBoundingClientRect(),s=n.top-i.top,o=i.right-n.right;return{top:s,bottom:i.bottom-n.bottom,left:n.left-i.left,right:o}}(e,t),{x:l,y:h,width:c}=t.getBoundingClientRect(),{height:d,width:u}=i.getBoundingClientRect(),{x:p,y:g,width:f,height:m}=e.getBoundingClientRect(),v=mg(getComputedStyle(t).borderWidth);let y=Math.floor(p)-Math.floor(l)-v.value;y<5&&(y=0);const x=c-u,w=y-(Math.floor(u)-Math.floor(f))/2,b=w<5?"0px":`${w}px`;let C=Math.floor(g)-Math.floor(h)-v.value;i.style.left=s&&r>u/2&&o>u/2?b:c<u+5?"0px":r>u?`${y}px`:o>u?y-(Math.floor(u)-Math.floor(f))+"px":r>u/2&&o>u/2?b:x<5?"0px":`${x}px`,a>d?(n&&(C+=2),i.style.top=C+Math.floor(m)-1+"px"):(n&&(C-=4),i.style.top=C-Math.floor(d)+"px")}function cA(t,e,i){const n=fD.getTooltip(),s=fD.getDisplayTextConfig(),o=QP;null!=i&&i.id||!(t in o)||(i.id=o[t]+e.postfix),null!=i&&i.tooltip||!(t in n)||(i.tooltip=n[t]),null!=i&&i.displayText&&(i.label=null==i?void 0:i.displayText),null!=i&&i.label||!(t in s)||(i.label=s[t])}function dA(t){return(null==t?void 0:t.constructor.cpName)||""}function uA(t){const{value:e}=t,{fontSize:i,fontFamily:n,paddingLeft:s,paddingRight:o}=getComputedStyle(t),r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",r.style.visibility="hidden",r.style.fontSize=i,r.style.fontFamily=n||"Arial, Helvetica, sans-serif",document.body.appendChild(r),r.textContent=e;const a=r.clientWidth+parseInt(s,10)+parseInt(o,10);return r.remove(),a}function pA(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.uiState!==e&&t.el&&(aA(t.el,"disabled"===e),function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,n=i.contains("ddv-button-focused");e?n||t.classList.add("ddv-button-focused"):t.classList.remove("ddv-button-focused")}(t.el,"focused"===e),i&&lA(t.el,"focused"===e,n?"deep":"base"),t.uiState=e)}function gA(t,e){let i=document.getElementById(`ddvMask${t.postfix}`);(i||e)&&(!i||e?(i||(i=document.createElement("div"),i.id=`ddvMask${t.postfix}`,i.className="ddv-mask"),t.context.viewService.rootDom.appendChild(i)):i.remove())}class fA extends $P{constructor(t,e){super(t,e.class),na(this,"callback",void 0),na(this,"uiState","normal"),na(this,"isFocused",!1),na(this,"isMenuButton",!1),this.callback=e.callback,this.bindHooks(),this.isMenuButton=t.data.menu||!1,"false"!==t.data.default&&this.bindDefaultUi()}bindEvent(){this.nativeOn(this.el,"click",(()=>{this.callback()}))}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup")}))}setUiState(t){pA(this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton)}bindDefaultUi(){const{viewer:t}=this.injection,e=t=>{let e=this.isFocused?"focused":"normal";(Hd(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)||(e="disabled"),this.setUiState(e,!Xd())};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}bindHooks(){this.hooks.created.on((()=>{this.bindEvent(),this.bindHidePopup()})),this.hooks.updated.on((()=>{this.uiState="normal"}))}initTemplate(t){const e=this.data;e.options||(e.options={});const{options:i,id:n}=this.data;n&&(i.id=n),cA(dA(this),this.injection.viewer,i),"false"===e.default&&(i.label=void 0),super.initTemplate(t)}}class mA extends HP{constructor(t){super(t),na(this,"uiState","normal"),na(this,"defaultClass",void 0),na(this,"pullDownBox",void 0),na(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindBaseHooks()}bindBaseHooks(){this.hooks.inserted.on((t=>{this.bindEventsEmitter()}))}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{pullDownBox:t}=this;if(!t)return;const e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:hA(i,this.el,this.pullDownBox)}),this)}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",(()=>{this.togglePopup(),this.isFirstClick&&(hA(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1)}))}bindPopupSwitchEvent(){sA(this)}bindDefaultUi(){const t=t=>{const e=(Hd(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(e)};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.inserted.on(t),this.hooks.updated.on(t)}initPullDownBox(){this.hooks.created.on((()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents()})),this.hooks.updated.on((()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0}))}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1)}),this)}setUiState(t){pA(this,t)}togglePopup(t){const{pullDownBox:e}=this,{viewer:i}=this.injection;let n="none"===e.style.display;n=Hd(t)?!n:!t,n?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)),lA(this.el,!n),e.style.display=n?"none":""}}class vA extends mA{constructor(t){super(t),na(this,"lastSelectedIndex",0),na(this,"defaultClass","ddv-pdl"),na(this,"pullDownBoxClass","ddv-pull-down"),na(this,"children",[]),na(this,"hasCheckIcon",!1);const{defaultClassName:e,children:i,showCheckIcon:n}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=i,this.hasCheckIcon=n,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{const{id:n,label:s}=e;e.id=void 0,e.label=void 0,t+=`<${e.type} :options="options.children[${i}]" default="false"id="${n?n+this.injection.viewer.postfix:""}" ><span>${s}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${e.type}>`})),t}selectChildren(t){if(!this.hasCheckIcon)return;const{pullDownBox:e}=this;if(-1!==t&&!e.childNodes[t])return;if(-1!==this.lastSelectedIndex){const t=e.children[this.lastSelectedIndex],i=t.getElementsByTagName("i")[0];t.classList.remove("ddv-pull-down-selected"),i.style.visibility="hidden"}if(-1===t)return void(this.lastSelectedIndex=-1);const i=e.children[t],n=i.getElementsByTagName("i")[0];i.classList.add("ddv-pull-down-selected"),n.style.visibility="visible",this.lastSelectedIndex=t}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i,showDropDownArrow:n}=e;cA(dA(this),this.injection.viewer,e);const s=`<div ${jP(e,`ddv-button ${this.defaultClass}`)}>`+(Hd(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${jP(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div>`+`<i style="display: ${n?"":"none"}" class="ddv-down-arrow"></i></div>`;this.template=s}}class yA extends mA{constructor(t){super(t),na(this,"defaultClass","ddv-pdm"),na(this,"pullDownBoxClass","ddv-pull-down"),na(this,"children",[]);const{defaultClassName:e,children:i,enableScroll:n}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,n&&(this.pullDownBoxClass+=Xd()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=i,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{t+=`<${e.type} :options="options.children[${i}]" menu="true"></${e.type}>`})),t}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i,showDropDownArrow:n}=e;cA(dA(this),this.injection.viewer,e);const s=`<div ${jP(e,`ddv-button ${this.defaultClass}`)}>`+(Hd(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${jP(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div>`+`<i style="display: ${n?"":"none"}" class="ddv-down-arrow"></i></div>`;this.template=s}}class xA extends fA{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;Xd()&&this.el.classList.contains("ddv-button-focused")?t.updateViewerConfig({toolMode:"pan"}):(t.updateViewerConfig({toolMode:"annotation",annotationMode:e.annotationMode}),"stamp"===e.annotationMode&&t.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null,stampConfig:null}}}))}}),na(this,"annotationMode",void 0),this.annotationMode=e.annotationMode}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!ub.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig();t.getPageCounts()?"annotation"!==e?this.setUiState("normal"):i===this.annotationMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}class wA extends xA{constructor(t){super(t,{class:"ddv-ellipse",annotationMode:"ellipse"})}}na(wA,"cpName","EllipseAnnotation");class bA extends xA{constructor(t){super(t,{class:"ddv-annot-eraser",annotationMode:"erase"})}}na(bA,"cpName","EraseAnnotation");class CA extends xA{constructor(t){super(t,{class:"ddv-ink",annotationMode:"ink"})}}na(CA,"cpName","InkAnnotation");class SA extends xA{constructor(t){super(t,{class:"ddv-line",annotationMode:"line"})}}na(SA,"cpName","LineAnnotation");class _A extends xA{constructor(t){super(t,{class:"ddv-polygon",annotationMode:"polygon"})}}na(_A,"cpName","PolygonAnnotation");class TA extends xA{constructor(t){super(t,{class:"ddv-polyline",annotationMode:"polyline"})}}na(TA,"cpName","PolylineAnnotation");class EA extends xA{constructor(t){super(t,{class:"ddv-rect",annotationMode:"rectangle"})}}na(EA,"cpName","RectAnnotation");class PA extends xA{constructor(t){super(t,{class:"ddv-annot-select",annotationMode:"select"})}}na(PA,"cpName","SelectAnnotation");class AA extends xA{constructor(t){super(t,{class:"ddv-stamp-icon",annotationMode:"stamp"})}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!ub.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getPageCounts(),{defaultStyleConfig:s}=t.getAnnotationConfig(),{stamp:o}=s,r=null==o?void 0:o.imageData;n?"annotation"!==e||"stamp"!==i||r?this.setUiState("normal"):this.setUiState("focused"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na(AA,"cpName","StampIconAnnotation");class IA extends fA{constructor(t){super(t,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,Xd()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click())}}),na(this,"annotationImageLoader",void 0)}createAnnotationImageLoaderInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp",t.type="file",this.nativeOn(t,"change",(()=>{const{files:e}=t,i=new Blob([e[0]],{type:e[0].type});["image/png","image/jpeg","image/bmp"].includes(e[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:i}}}),t.value=null,t.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}))})),t}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet")}))}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createAnnotationImageLoaderInput();t.style.display="none",this.el.appendChild(t),this.annotationImageLoader=t,this.nativeOn(t,"click",(t=>{t.stopPropagation()}))}))}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!ub.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getPageCounts(),{defaultStyleConfig:s}=t.getAnnotationConfig(),{stamp:o}=s,r=null==o?void 0:o.imageData;n?"annotation"!==e?this.setUiState("normal"):"stamp"===i&&r?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na(IA,"cpName","StampImageAnnotation");class DA extends xA{constructor(t){super(t,{class:"ddv-text-box",annotationMode:"textBox"})}}na(DA,"cpName","TextBoxAnnotation");class kA extends xA{constructor(t){super(t,{class:"ddv-typewriter",annotationMode:"textTypewriter"})}}na(kA,"cpName","TextTypewriterAnnotation");class RA extends yA{constructor(t){const{AnnotationSet:e}=fD.getDisplayTextConfig(),i=t.data;i.options={children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:e,enableScroll:!0,showDropDownArrow:!0,...i.options},super(t),this.$on("ui_cropClick",(t=>{const{viewer:e}=this.injection,i=e.getPageCounts()||0;(t||i)&&ub.annotationLicenseModuleIsExist()&&aA(this.el,t)}))}bindDefaultUi(){ub.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on((t=>{const{toolMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getPageCounts();"annotation"===e&&i>0&&this.setUiState("focused")}))):this.hooks.inserted.on((t=>{this.setUiState("disabled")}))}togglePopup(t){if((!0!==t||""!==this.pullDownBox.style.display)&&(!1!==t||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(t),""===this.pullDownBox.style.display&&MA(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let t=0;for(let e=0;e<this.pullDownBox.children.length;e++){const i=this.pullDownBox.children[e];i.classList.contains("ddv-button-focused")&&(t=i.offsetLeft+i.clientWidth/2-this.pullDownBox.clientWidth/2)}this.pullDownBox.scroll(t,0)}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",(t=>{if(t===this||"viewer"===t||t===RA.cpName)return;const{toolMode:e}=this.injection.viewer.getViewerConfig();"annotation"!==e&&this.togglePopup(!1)}))}bindViewerHooks(){if(!ub.annotationLicenseModuleIsExist())return;const t=this.injection.viewer;t.hooks.resize.on((()=>{MA(this.pullDownBox).horizontal?this.pullDownBox.style.justifyContent="start":this.pullDownBox.style.justifyContent=""}),this),t.hooks.pageExistenceChanged.on((()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?(i="normal","annotation"===e&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),i="focused")):this.togglePopup(!1),this.setUiState(i)}),this),t.hooks.toolModeChanged.on((e=>{if("crop"===e.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const i="annotation"===e.newToolMode;t.getPageCounts()>0&&(this.setUiState(i?"focused":"normal"),lA(this.el,"none"!==this.pullDownBox.style.display),this.$emit("ui_annotationModeClick",i),this.$emit("ui_toolModeRefactor",i),i&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)))}),this)}setUiState(t){super.setUiState(t)}}function MA(t){return{vertical:t.scrollHeight>t.clientHeight,horizontal:t.scrollWidth>t.clientWidth}}na(RA,"cpName","AnnotationSet");class LA extends fA{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1!==e.length)return;const i=e[0].uid;switch(this.layerType){case"bringForward":t.bringForward(i);break;case"bringToFront":t.bringToFront(i);break;case"sendBackward":t.sendBackward(i);break;case"sendToBack":t.sendToBack(i)}}}),na(this,"layerType",void 0),this.layerType=e.layerType}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet")}))}bindDefaultUi(){const t=this.injection.viewer,e=ub.annotationLicenseModuleIsExist(),i=()=>{if(!e)return void this.setUiState("disabled");const{viewer:i}=this.injection,n=i.getSelectedAnnotations();t.getPageCounts()&&1===n.length?this.setUiState("normal"):this.setUiState("disabled")};t.hooks.annotationLayerStateChanged.on((i=>{let{state:n}=i;if(!e)return void this.setUiState("disabled");const s=t.getSelectedAnnotations();if(!s.length||s.length>1)return void this.setUiState("disabled");const o=t.getAnnotationObject(s[0].uid);if(o&&!o.context.isActive)return void this.setUiState("disabled");let r=!1;switch(this.layerType){case"bringForward":r=n.forward;break;case"bringToFront":r=n.front;break;case"sendBackward":r=n.backward;break;case"sendToBack":r=n.back}this.setUiState(r?"normal":"disabled")}),this),t.hooks.pageExistenceChanged.on(i,this),this.hooks.inserted.on(i),this.hooks.updated.on(i)}}class OA extends LA{constructor(t){super(t,{class:"ddv-bring-forward",layerType:"bringForward"})}}na(OA,"cpName","BringForward");class BA extends LA{constructor(t){super(t,{class:"ddv-bring-to-front",layerType:"bringToFront"})}}na(BA,"cpName","BringToFront");class FA extends LA{constructor(t){super(t,{class:"ddv-send-backward",layerType:"sendBackward"})}}na(FA,"cpName","SendBackward");class NA extends LA{constructor(t){super(t,{class:"ddv-send-to-back",layerType:"sendToBack"})}}na(NA,"cpName","SendToBack");class UA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-annotation-toolbar"),na(this,"lastSelected",void 0),na(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks()}bindHooks(){const t=t=>{this.el.style.display="none"};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){const{viewer:t}=this.injection,e=()=>{if(!this.lastSelected)return;const e=t.getActiveTab();if("single"===e.context.displayMode&&this.lastSelected.pageUid!==e.getCurrentPage().uid)return;const{show:i,x:n,y:s}=VA(t.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(i,n,s)};if(t.hooks.visibleChanged.on((()=>{this.togglePopup(!1)}),this),t.hooks.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.togglePopup(!1),this.lastSelected=null)}),this),t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const i=e.newAnnotationUids[0],n=t.getAnnotationObject(i);if(!n)return;const{show:s,x:o,y:r}=VA(t.context.viewService.mainContainer,n,this.el,this.toolbarOffset);this.lastSelected=n,this.togglePopup(s,o,r)}),this),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1)}),this),t.hooks.afterAnnotationEdit.on((e=>{if(e instanceof fv)return;const{show:i,x:n,y:s}=VA(t.context.viewService.mainContainer,e,this.el,this.toolbarOffset);this.lastSelected=e,this.togglePopup(i,n,s)}),this),t.hooks.pageChanged.on((()=>{const e=t.getActiveTab();if(!e||"single"!==e.context.displayMode)return;const i=t.getSelectedAnnotations();if(1!==i.length)return;const n=i[0].pageUid===e.getCurrentPage().uid;this.togglePopup(n)}),this),t.hooks.resize.on(e,this),t.hooks.scroll.on(e,this),t.hooks.fitModeChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),t.hooks.zoomChanged.on(e,this),t.hooks.annotationsUpdated.on(e,this),t.hooks.annotationTextContentUpdated.on(e,this),null!=t&&t.annotationViewerContext){const{annotationViewerContext:i}=t,{hooks:n}=i.annotationController;n.enableAnnotationTextEditMode.on(e,this),n.disableAnnotationTextEditMode.on(e,this)}}togglePopup(t,e,i){const{viewer:n}=this.injection;t?(n.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${e||0}px`,this.el.style.top=`${i||0}px`):this.el.style.display="none"}initTemplate(){const{options:t}=this.data;cA(dA(this),this.injection.viewer,t);let e=`<div ${jP(t,this.defaultClass,"")}>`;null!=t&&t.isPaletteEnabled&&(e+='<AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton>'),e+='<AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>',this.template=e}}function VA(t,e,i,n){const{width:s,height:o}=t.getBoundingClientRect(),r=e.context.getRealTimeBoundingBox(),a=getComputedStyle(i),l=mg(a.width).value,h=mg(a.height).value;if(r.right<0||r.left>s||r.top>o||r.bottom<0)return{show:!1,x:0,y:0};const c=r.left+r.width/2-l/2;let d=r.bottom+n;return d+h>o&&(d=r.top-h-n),d<0&&(d=0),{show:!0,x:c,y:d}}na(UA,"cpName","AnnotationToolBar");class WA extends fA{constructor(t){super(t,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible","AnnotationPalette")}}),oA(this)}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture()}))}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.focusTexture()}}}na(WA,"cpName","AnnotationPaletteButton");class HA extends fA{constructor(t){super(t,{class:"ddv-delete-annot",callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations(),i=[];e.forEach((t=>{i.push(t.uid)})),t.deleteAnnotations(i)}}),oA(this)}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet")}))}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{viewer:e}=this.injection,i=e.getSelectedAnnotations();t.getPageCounts()&&i.length?this.setUiState("normal"):this.setUiState("disabled")};t.hooks.selectedAnnotationsChanged.on(e,this),t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na(HA,"cpName","AnnotationDeleteButton");class jA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-color-panel"),na(this,"colorList",void 0),na(this,"enableChangeColor",void 0),na(this,"paletteType",void 0),na(this,"colorInput",void 0),na(this,"selectedColorButton",void 0),na(this,"lastUpdatedAnnotation",void 0),na(this,"lastInputColor",void 0),na(this,"lastTextContents",void 0),na(this,"lastPaletteType",void 0),na(this,"dblClickButtons",[]),this.colorList=t.data.colorList,this.enableChangeColor=t.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stamp"===t?"none":"",this.paletteType=t,this.showNoFill("fill"===t),this.updateButtonSelected()}))}bindHooks(){this.hooks.inserted.on((()=>{const t=document.createElement("input");t.type="color",this.colorInput=t,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents()}))}bindEvents(){const t=this.el.querySelector(".ddv-palette-color-grid");this.nativeOn(t,"click",(t=>{const e=t.target;if(!(e instanceof HTMLButtonElement))return;if(this.dblClickButtons.push(e),this.dblClickButtons.length>2&&this.dblClickButtons.shift(),e.classList.contains("ddv-color-selected"))return;const i=e.value,{viewer:n}=this.injection;if(""===i)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e;else{const t=n.getSelectedAnnotations();1===t.length&&this.updateColorByData(t[0],i),this.updateDefaultColor(i)}})),this.nativeOn(t,"dblclick",(t=>{if(!this.enableChangeColor)return;const e=t.target;if(!(e instanceof HTMLButtonElement))return;if(2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const i=e.value;"transparent"!==i&&""!==i&&(this.colorInput.value=i,Xd()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e)}))}bindColorInputEvents(){this.nativeOn(this.colorInput,"input",(t=>{eA((()=>{const{viewer:t}=this.injection,e=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor(),this.selectedColorButton.children[0].style.background=e,this.selectedColorButton.value=e,1===t.getSelectedAnnotations().length&&this.updateColorByShape(e),this.updateDefaultColor(e),this.selectedColor(e)}),60)})),this.nativeOn(this.colorInput,"change",(t=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null)}))}bindViewerHooks(){const t=this.injection.viewer;t.hooks.selectedAnnotationsChanged.on((()=>{this.updateButtonSelected()}),this),t.hooks.annotationsUpdated.on((()=>{this.updateButtonSelected()}),this),t.hooks.annotationModeChanged.on((()=>{this.updateButtonSelected()}),this),t.hooks.annotationDefaultStyleChanged.on((()=>{this.updateButtonSelected()}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{color:i}=e;"text"===this.paletteType?this.selectedColor(i):this.updateButtonSelected()}),this)}updateColorByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if("fill"===this.paletteType)i.style.background=t;else if("stroke"===this.paletteType)i.style.borderColor=t;else if("text"===this.paletteType&&i instanceof gv){if(i.hasSelectedChars){const e=qm(i,{color:t});i.style.textContents=e,i.textEditEventHandler.updateTextSelection()}else{if(i.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[e[0].type]:{textContent:{color:t}}}});{const e=Xm(i,{color:t});e.length&&(i.style.textContents=e)}}this.lastTextContents=i.style.textContents}this.lastUpdatedAnnotation=e[0],this.lastInputColor=t,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render()}updateColorByData(t,e,i){const{viewer:n}=this.injection,{uid:s}=t,o={},r=this.injection.viewer.getAnnotationObject(s),a=i||this.paletteType;if("text"===a&&r instanceof gv){if(r.hasSelectedChars){const t=qm(r,{color:e});o.textContents=t}else{if(r.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[t.type]:{textContent:{color:e}}}});{const t=Xm(r,{color:e});t.length&&(o.textContents=t)}}return this.lastTextContents&&(o.textContents=this.lastTextContents,this.lastTextContents=null),n.updateAnnotation(s,{style:o},["appearanceChanged"]),void(r.hasSelectedChars&&r.textEditEventHandler.updateTextSelection())}"fill"===a?o.background="transparent"===e?"":e:"stroke"===a&&(o.borderColor=e),n.updateAnnotation(s,{style:o},["appearanceChanged"])}updateDefaultColor(t,e){const{annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();let s=i;n.length&&n[0]&&(s=n[0].type);const o={};switch(e||this.paletteType){case"fill":o.background=t;break;case"stroke":o.borderColor=t;break;case"text":o.textContent={},o.textContent.color=t}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:o}})}selectedColor(t){const e=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let i=0;i<e.length;i++){const n=e[i];if(!n.value)continue;const s=Tg(n.value),o=Tg(t);s.formatted===o.formatted?n.classList.add("ddv-color-selected"):n.classList.contains("ddv-color-selected")&&n.classList.remove("ddv-color-selected")}}updateButtonSelected(){const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1===e.length){let n=null;if("fill"===this.paletteType)n=e[0].style.background||"transparent";else if("stroke"===this.paletteType)n=e[0].style.borderColor||"transparent";else if("text"===this.paletteType){const s=t.getAnnotationObject(e[0].uid);var i;s instanceof gv&&(n=(null===(i=e[0].style)||void 0===i||null===(i=i.textContents[0])||void 0===i?void 0:i.color)||"transparent"),s instanceof gv&&(s.isEditMode||!s.style.textContents.length)&&(n=s.freeTextContentStyle.color)}return void(n&&this.selectedColor(n))}const{toolMode:n,annotationMode:s}=t.getViewerConfig();if("annotation"===n&&"select"!==s&&"erase"!==s){const{defaultStyleConfig:e}=t.getAnnotationConfig(),{background:i,borderColor:n,textContent:l}=tv;let h=null;var o;if("fill"===this.paletteType)h=(null===(o=e[s])||void 0===o?void 0:o.background)||i||"transparent";else if("stroke"===this.paletteType){var r;h=(null===(r=e[s])||void 0===r?void 0:r.borderColor)||n}else if("text"===this.paletteType){var a;h=(null===(a=e[s])||void 0===a||null===(a=a.textContent)||void 0===a?void 0:a.color)||(null==l?void 0:l.color)||"transparent"}h&&this.selectedColor(h)}}getColorTemplate(){const t=document.createElement("div");let e="<div>",i=0;for(let n=0;n<this.colorList.length;n++){const s=this.colorList[n];if(t.style.background=s,""!==t.style.background){if(i>26)break;i+=1,e+=`<button value="${s}"><div style="background:${s}"></div></button>`,0!==i&&i%7==0&&(e+="</div><div>"),t.style.background=""}}const n=i>26?0:27-i;for(let t=0;t<n;t++)e+=0===t?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(i+t+1)%7==0&&(e+="</div><div>");return e+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',e+="</div>",t.remove(),e}showNoFill(t){this.el.querySelectorAll(".ddv-color-transparent").forEach((e=>{e.style.visibility=t?"":"hidden",e.style.pointerEvents=t?"":"none"}))}addColor(){const t=this.el.querySelector(".ddv-palette-color-grid"),e=t.querySelector(".ddv-add-color"),i=t.querySelector(".ddv-color-placeholder");e&&e.classList.remove("ddv-add-color"),i&&(i.classList.remove("ddv-color-placeholder"),i.classList.add("ddv-add-color"))}initTemplate(){const t=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=t}}const zA=Ep.displayResolution/Ep.dataResolution;class GA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-font-panel"),na(this,"fontFamilyEl",void 0),na(this,"fontSizeEl",void 0),na(this,"fontList",[...tA]),na(this,"inputIsBlur",!0),na(this,"currentFontSizeValue",void 0),na(this,"isArrowKeyPressed",!1),na(this,"maxFontSize",72),this.maxFontSize=t.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"fontFamily"!==t&&this.toggleSelect("fontFamily",!1),"fontSize"!==t&&this.toggleSelect("fontSize",!1)})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="text"===t?"":"none"})),this.$on("ui_addFont",(t=>{this.addFont(t)}))}updateTextStyle(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();if(1!==s.length||"textTypewriter"!==s[0].type&&"textBox"!==s[0].type)"annotation"!==i||"textBox"!==n&&"textTypewriter"!==n||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{textContent:t}}});else{const{uid:e,type:i}=s[0],n=this.injection.viewer.getAnnotationObject(e);if(n.isEditMode)n.hasSelectedChars&&(this.injection.viewer.updateAnnotation(e,{style:{textContents:qm(n,t)}},["appearanceChanged"]),n.textEditEventHandler.updateTextSelection());else{const i=Xm(n,t);i.length&&this.injection.viewer.updateAnnotation(e,{style:{textContents:i}},["appearanceChanged"])}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textContent:t}}})}e&&this.focusTexture()}bindHooks(){this.hooks.created.on((()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size")})),this.hooks.inserted.on((()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents()}))}bindToggleEvent(){const t=this.fontSizeEl.querySelector(".ddv-down-arrow");Qu(this.fontFamilyEl,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily")}),this),Qu(t,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize")}),this)}bindSelectEvent(){const t=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),e=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),i=this.fontSizeEl.getElementsByTagName("input")[0],n=this.fontFamilyEl.getElementsByTagName("span")[0];this.nativeOn(t,"click",(t=>{t.stopPropagation(),this.toggleSelect("fontFamily",!1);const e=t.target.value;e&&n.innerText!==e&&this.updateTextStyle({fontFamily:e})})),this.nativeOn(e,"click",(t=>{t.stopPropagation(),this.toggleSelect("fontSize",!1);const e=t.target.value,n=`${e}pt`===i.value;e&&!n&&this.updateTextStyle({fontSize:mg(e).value*zA})}))}bindFontSizeInputEvent(){const t=this.fontSizeEl.getElementsByTagName("input")[0];this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0)})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){let e=Math.round(mg(t.value).value);e>this.maxFontSize&&(e=this.maxFontSize,t.value=`${this.maxFontSize}`),e<1&&(e=1,t.value="1"),this.updateTextStyle({fontSize:e*zA},!1),this.isArrowKeyPressed=!1}})),this.nativeOn(t,"focus",(()=>{const e=t.value,i=mg(e).value;t.value=i,t.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=i,this.$emit("ui_shrinkSelectionBox")})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,"text"!==t.type&&(this.currentFontSizeValue=t.value,t.type="text",t.value+="pt",e.relatedTarget instanceof HTMLInputElement||this.focusTexture())}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);let i=Math.round(mg(t.value).value);i>this.maxFontSize&&(i=this.maxFontSize),i<1&&(i=1),this.updateTextStyle({fontSize:i*zA})};this.nativeOn(t,"change",e)}bindTextAlignEvents(){const t=this.el.querySelector(".ddv-align-left"),e=this.el.querySelector(".ddv-align-center"),i=this.el.querySelector(".ddv-align-right"),n=this.el.querySelector(".ddv-justify-center"),s=t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();if(1!==n.length||"textTypewriter"!==n[0].type&&"textBox"!==n[0].type)"annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textAlign:t}}});else{if(t===n[0].style.textAlign)return;this.injection.viewer.updateAnnotation(n[0].uid,{style:{textAlign:t}},["appearanceChanged"])}};this.nativeOn(t,"click",(()=>{s("left")})),this.nativeOn(e,"click",(()=>{s("center")})),this.nativeOn(i,"click",(()=>{s("right")})),this.nativeOn(n,"click",(()=>{s("justify")}))}bineFontStyleEvents(){const t=this.el.querySelector(".ddv-bold"),e=this.el.querySelector(".ddv-italic"),i=this.el.querySelector(".ddv-underline"),n=this.el.querySelector(".ddv-line-through");this.nativeOn(t,"click",(e=>{this.updateTextStyle({fontWeight:t.classList.contains("ddv-button-activated-light")?"normal":"bold"})})),this.nativeOn(e,"click",(t=>{this.updateTextStyle({fontStyle:e.classList.contains("ddv-button-activated-light")?"normal":"italic"})})),this.nativeOn(i,"click",(t=>{this.updateTextStyle({underline:!i.classList.contains("ddv-button-activated-light")})})),this.nativeOn(n,"click",(t=>{this.updateTextStyle({lineThrough:!n.classList.contains("ddv-button-activated-light")})}))}bindViewerHooks(){const{viewer:t}=this.injection;t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];if("textTypewriter"!==i.type&&"textBox"!==i.type)return;this.showTextAlignList("textBox"===i.type),this.selectTextAlign(i.style.textAlign||"left");const{defaultStyleConfig:n}=this.injection.viewer.getAnnotationConfig(),{textContent:s}=n[i.type],o=i.style.textContents.length?i.style.textContents[0]:s,{fontFamily:r,fontSize:a,fontWeight:l,fontStyle:h,underline:c,lineThrough:d}=o;this.selectFontStyle(r,Math.round(mg(a).value/zA),"bold"===l,"italic"===h,c,d)}),this),t.hooks.annotationDefaultStyleChanged.on((t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();let s,o,r=!1;if("annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||(r=!0,s=i),1===n.length){const t=this.injection.viewer.getAnnotationObject(n[0].uid);t instanceof gv&&(s=n[0].type,o=n[0].style.textAlign,t.isEditMode&&!t.hasSelectedChars?r=!0:t.isEditMode||t.style.textContents.length?(this.selectTextAlign(o),r=!1):r=!0)}if(!r)return;const{textAlign:a}=t[s],{fontFamily:l,fontSize:h,fontWeight:c,fontStyle:d,underline:u,lineThrough:p}=t[s].textContent||{},{textContent:g}=tv;this.selectTextAlign(o||a||tv.textAlign),this.selectFontStyle(l||g.fontFamily,Math.round(mg(h||g.fontSize).value/zA),"bold"===(c||g.fontWeight),"italic"===(d||g.fontStyle),u||g.underline,p||g.lineThrough)}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{fontFamily:i,fontSize:n,fontStyle:s,fontWeight:o,underline:r,lineThrough:a}=e;this.selectFontStyle(i,Math.round(mg(n).value/zA),"bold"===o,"italic"===s,r,a)}),this),t.hooks.annotationsUpdated.on((t=>{const{actions:e,uids:i}=t,n=this.injection.viewer.getSelectedAnnotations();if(e.includes("appearanceChanged")&&1===n.length&&i.includes(n[0].uid)&&("textTypewriter"===n[0].type||"textBox"===n[0].type)&&(this.selectTextAlign(n[0].style.textAlign||"left"),!this.injection.viewer.getAnnotationObject(n[0].uid).isEditMode&&n[0].style.textContents.length)){const{fontFamily:t,fontSize:e,fontWeight:i,fontStyle:s,underline:o,lineThrough:r}=n[0].style.textContents[0];this.selectFontStyle(t,Math.round(mg(e).value/zA),"bold"===i,"italic"===s,o,r)}}),this);const e=t=>{if(["textBox","textTypewriter"].includes(t)){this.showTextAlignList("textBox"===t);const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),{textContent:i,textAlign:n}=e[t],{fontFamily:s,fontSize:o,fontWeight:r,fontStyle:a,underline:l,lineThrough:h}=i;this.selectTextAlign(n),this.selectFontStyle(s,Math.round(mg(o).value/zA),"bold"===r,"italic"===a,l,h)}};t.hooks.annotationModeChanged.on((i=>{t.getSelectedAnnotations().length||e(i.newAnnotationMode)}),this),t.hooks.toolModeChanged.on((i=>{if("annotation"!==i.newToolMode)return;const{annotationMode:n}=t.getViewerConfig();e(n)}),this)}toggleSelect(t,e){const i="fontFamily"===t?"ddv-palette-font-family-select":"ddv-palette-font-size-select",n="fontFamily"===t?this.fontFamilyEl:this.fontSizeEl,s=n.querySelector(`.${i}`),o=n.querySelector(".ddv-down-arrow"),r="none"!==s.style.display,a=Hd(e)?!r:e,l=this.injection.viewer.context.viewService.mainContainer;r!==a&&(a?(s.style.display="block",s.style.top=`${nA(s,l)}px`,o.style.transform="rotate(180deg)","fontSize"===t&&this.scrollFontSizeSelect()):(s.style.display="none",o.style.transform=""))}getFontFamilySelectTemplate(){let t="";for(let e=0;e<tA.length;e++){const i=tA[e];t+=`<button style="font-family:${i}" value="${i}">${i}</button>`}return`<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${t}</div></div>`}getFontSizeTemplate(){let t="";for(let e=1;e<=12;e++)t+=`<button value="${e}">${e}pt</button>`;for(let e=14;e<=36;e+=2)t+=`<button value="${e}">${e}pt</button>`;for(let e=40;e<=72;e+=4)t+=`<button value="${e}">${e}pt</button>`;if(this.maxFontSize>72){let e=72;for(;e+8<this.maxFontSize;)e+=8,t+=`<button value="${e}">${e}pt</button>`;t+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`}return`<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${t}</div></div>`}selectTextAlign(t){const e=this.el.querySelector(".ddv-align-left"),i=this.el.querySelector(".ddv-align-center"),n=this.el.querySelector(".ddv-align-right"),s=this.el.querySelector(".ddv-justify-center");lA(e,"left"===t,"light"),lA(i,"center"===t,"light"),lA(n,"right"===t,"light"),lA(s,"justify"===t,"light")}selectFontStyle(t,e,i,n,s,o){const r=this.fontFamilyEl.getElementsByTagName("span")[0],a=this.fontSizeEl.getElementsByTagName("input")[0],l=this.el.querySelector(".ddv-bold"),h=this.el.querySelector(".ddv-italic"),c=this.el.querySelector(".ddv-underline"),d=this.el.querySelector(".ddv-line-through");r.innerText=t,this.isArrowKeyPressed||("number"===a.type&&(a.type="text"),this.currentFontSizeValue=e,a.value=`${e}pt`),lA(l,i,"light"),lA(h,n,"light"),lA(c,s,"light"),lA(d,o,"light")}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.focusTexture()}}addFont(t){if(this.fontList.includes(t))return;this.fontList.push(t);const e=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),i=document.createElement("button");i.style.fontFamily=t,i.value=t,i.innerText=t,e.appendChild(i)}showTextAlignList(t){const e=this.el.querySelector(".ddv-text-align-list");e&&(e.style.display=t?"":"none")}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const t=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:e}=this;let i=0;for(let n=0;n<t.children.length;n++){const s=t.children[n];if(!(e>=s.value))break;i=s.offsetTop}t.scrollTo(0,i)}initTemplate(){const t=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=t}}const YA=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],$A=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],XA={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},qA={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class ZA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-line-panel"),na(this,"commonClass","ddv-palette-line-panel-common"),na(this,"LineStyleClass","ddv-palette-border-style"),na(this,"lineStyleClassSmall","ddv-palette-border-style-small"),na(this,"startLineEndingClass","ddv-palette-line-start"),na(this,"endLineEndingClass","ddv-palette-line-end"),na(this,"selectionClass","ddv-palette-line-panel-selection"),na(this,"startLineEndingSelect",void 0),na(this,"borderStyleSelect",void 0),na(this,"endLineEndingSelect",void 0),na(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",(t=>{"lineEndingStart"!==t&&this.toggleSelect(0,!1),"borderStyle"!==t&&this.toggleSelect(1,!1),"lineEndingEnd"!==t&&this.toggleSelect(2,!1)})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none",this.isStrokePalette="stroke"===t;const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();("annotation"===e&&"ink"===i||1===n.length&&"ink"===n[0].type)&&(this.el.style.display="none")}))}bindHooks(){this.hooks.inserted.on((()=>{const t=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=t[0],this.borderStyleSelect=t[1],this.endLineEndingSelect=t[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent()}))}bindSelectEvent(){const t=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),e=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),i=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),n=(t,e)=>{const i=e.target,n="BUTTON"===i.tagName?i:i.parentNode;return Array.from(t.childNodes).indexOf(n)||0};this.nativeOn(t,"click",(e=>{const i=n(t,e),s=YA[i]||"None";this.updateLineEndingByData(!0,s),this.updateDefaultLineEnding(!0,s)})),this.nativeOn(e,"click",(t=>{const i=n(e,t),s=$A[i]||[0,0];this.updateLineDashByData(s),this.updateDefaultLineDash(s)})),this.nativeOn(i,"click",(t=>{const e=n(i,t),s=YA[e]||"None";this.updateLineEndingByData(!1,s),this.updateDefaultLineEnding(!1,s)}))}bindToggleEvent(){this.nativeOn(this.startLineEndingSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0)})),this.nativeOn(this.borderStyleSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1)})),this.nativeOn(this.endLineEndingSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2)}))}bindViewerHooks(){const t=this.injection.viewer,e=(t,e,i,n)=>{if(this.startLineEndingSelect.style.display=t?"":"none",this.endLineEndingSelect.style.display=t?"":"none",this.borderStyleSelect.classList.remove(t?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(t?this.lineStyleClassSmall:this.LineStyleClass),t){const[t,e]=i;this.updateLineEndingSelect(!0,XA[t]||"ddv-solid"),this.updateLineEndingSelect(!1,XA[e]||"ddv-solid")}this.el.style.display=n||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(e||[0,0])};t.hooks.selectedAnnotationsChanged.on((i=>{var n,s;if(1!==i.newAnnotationUids.length)return;const o=t.getSelectedAnnotations()[0];if(!o)return;const r="line"===o.type||"polyline"===o.type;e(r,null===(n=o.style)||void 0===n?void 0:n.lineDash,null===(s=o.style)||void 0===s?void 0:s.lineEnding,"ink"===o.type||"stamp"===o.type)}),this),t.hooks.annotationModeChanged.on((t=>{const i=t.newAnnotationMode,n="polyline"===i||"line"===i,s="ink"===i;if("select"!==i&&"erase"!==i&&"stamp"!==i){var o,r;const{defaultStyleConfig:t}=this.injection.viewer.getAnnotationConfig(),a=(null===(o=t[i])||void 0===o?void 0:o.lineEnding)||(null==tv?void 0:tv.lineEnding),l=(null===(r=t[i])||void 0===r?void 0:r.lineDash)||(null==tv?void 0:tv.lineDash);e(n,l,a,s)}}),this),t.hooks.annotationDefaultStyleChanged.on((i=>{var n;const{toolMode:s,annotationMode:o}=this.injection.viewer.getViewerConfig();if("annotation"!==s)return;if("select"===o||"erase"===o||"stamp"===o)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:r}=this.injection.viewer.getAnnotationConfig(),a="line"===o||"polyline"===o,l="ink"===o,h=(null===(n=r[o])||void 0===n?void 0:n.lineEnding)||tv.lineEnding,c=r[o].lineDash||tv.lineDash;e(a,c,h,l)}),this),t.hooks.annotationsUpdated.on((i=>{const{actions:n,uids:s}=i,o=t.getSelectedAnnotations();if(!n.includes("appearanceChanged")||1!==o.length||!s.includes(o[0].uid))return;if("ink"===o[0].type||"stamp"===o[0].type)return;const r="line"===o[0].type||"polyline"===o[0].type,a=o[0].style.lineEnding||["None","None"],l=o[0].style.lineDash||[0,0];e(r,l,a,!1)}),this)}toggleSelect(t,e){let i=this.borderStyleSelect;0===t?i=this.startLineEndingSelect:2===t&&(i=this.endLineEndingSelect);const n=i.querySelector(`.${this.selectionClass}`),s=i.querySelector(".ddv-down-arrow"),o="none"!==n.style.display,r=Hd(e)?!o:e,a=this.injection.viewer.context.viewService.mainContainer;o!==r&&(r?(n.style.display="block",n.style.top=`${nA(n,a)}px`,s.style.transform="rotate(180deg)"):(n.style.display="none",s.style.transform=""))}updateLineEndingSelect(t,e){(t?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${e}`}updateBorderStyleSelect(t){const e=this.borderStyleSelect,i=t.join("")||"0",n=e.querySelector("div");let s="ddv-solid";(function(t){if(0===t.length)return!0;if(1===t.length)return 0===t[0];t.length%2!=0&&(t=t.concat(t));for(let e=1;e<t.length;e+=2)if(0!==t[e])return!1;return!0})(t)||(s=qA[i]||"ddv-dashed-33"),n.className=`ddv-button ${s}`}updateLineDashByData(t){const e=this.injection.viewer.getSelectedAnnotations();1===e.length&&(e[0].style.lineDash||[0,0]).toString()!==t.toString()&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{lineDash:t}},["appearanceChanged"])}updateLineEndingByData(t,e){const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=i[0].style.lineEnding||["None","None"];t&&e===n[0]||!t&&e===n[1]||this.injection.viewer.updateAnnotation(i[0].uid,{style:{lineEnding:t?[e,n[1]]:[n[0],e]}},["appearanceChanged"])}updateDefaultLineEnding(t,e){var i;const{annotationMode:n}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:o}=this.injection.viewer.getAnnotationConfig();let r=(null===(i=o[n])||void 0===i?void 0:i.lineEnding)||tv.lineEnding,a=n;s.length&&s[0]&&(r=s[0].style.lineEnding,a=s[0].type);const l=[...r];t?l[0]=e:l[1]=e,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[a]:{lineEnding:l}}})}updateDefaultLineDash(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{lineDash:t}}})}getBaseLineDashTemplate(){const t=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let e="";for(let i=0;i<t.length;i++)e+=`<button><i class="ddv-button ${t[i]}"></i></button>`;return`<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${e}</div></div>`}getLineEndingTemplate(t){const e=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let i="";for(let t=0;t<e.length;t++)i+=`<button><i class="ddv-button ${e[t]}"></i></button>`;const n=t?this.startLineEndingClass:this.endLineEndingClass;return`<div class="${this.commonClass} ${n}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${i}</div></div>`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=e}}class JA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-opacity-panel"),na(this,"isPointerDown",!1),na(this,"lastPointerValue",void 0),na(this,"range",void 0),na(this,"input",void 0),na(this,"inputIsBlur",!0),na(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),iA(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()}))}bineInputEvent(){const{input:t}=this;this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0)})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=vg(t.value).value;e>100&&(t.value=100),e<0&&(t.value=0);let i=parseInt(t.value,10);qd(i)||(i=100,this.updateInput(100)),this.updateDefaultOpacity(i),this.updateOpacityByData(i),this.isArrowKeyPressed=!1}})),this.nativeOn(t,"focus",(e=>{const i=t.value,n=vg(i).value;t.value=n,t.type="number",this.inputIsBlur=!1})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="%")}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="%",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=vg(t.value).value;i>100&&(t.value=100),i<0&&(t.value=0);let n=parseInt(t.value,10);qd(n)||(n=100,this.updateInput(100)),this.updateDefaultOpacity(n),this.updateOpacityByData(n)};this.nativeOn(t,"change",e)}bindRangeEvent(){const{range:t}=this,e=()=>{const e=parseInt(t.value,10);this.updateOpacityByShape(e),this.input.value=`${e}%`;const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==n&&"erase"!==n&&this.updateInput(e)};this.nativeOn(t,"click",(()=>{const e=parseInt(t.value,10);this.injection.viewer.context.isFocusCanvas=!1,e!==this.lastPointerValue&&(this.updateOpacityByData(e),this.updateDefaultOpacity(e))})),this.nativeOn(t,"pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox");const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=this.injection.viewer.getAnnotationObject(i[0].uid);n instanceof gv&&n.isEditMode&&(n.textEditEventHandler.disableEditMode(),this.injection.viewer.render()),e()})),this.nativeOn(t,"pointermove",(()=>{this.isPointerDown&&e()})),this.nativeOn(t,"pointerup",(()=>{if(this.isPointerDown){const e=parseInt(t.value,10);this.lastPointerValue=e,this.updateOpacityByData(e),this.updateDefaultOpacity(e)}this.isPointerDown=!1})),this.nativeOn(t,"keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e()})),this.nativeOn(t,"keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=parseInt(t.value,10);this.updateOpacityByData(e),this.updateDefaultOpacity(e)}}))}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=qd(e[t].opacity)?e[t].opacity:tv.opacity;this.updateInput(Math.round(100*i))};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(Math.round(100*i.style.opacity))}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:n}=e,s=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===s.length&&n.includes(s[0].uid)&&this.updateInput(Math.round(100*s[0].style.opacity))}),this),t.hooks.annotationModeChanged.on((t=>{e()}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e()}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===n||"erase"===n)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:s}=this.injection.viewer.getAnnotationConfig(),o=qd(s[n].opacity)?s[n].opacity:tv.opacity;this.updateInput(100*o)}),this)}updateInput(t){let e=t;t>100&&(e=100),t<0&&(e=0),e=Math.round(e),this.range.value=`${e}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?e:`${e}%`}updateOpacityByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const n=100*i.style.opacity;(t=Math.round(t))!==n&&(i.style.opacity=t/100,this.injection.viewer.context.render())}updateOpacityByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=100*e[0].style.opacity;(t=Math.round(t))!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{opacity:t/100}},["appearanceChanged"])}updateDefaultOpacity(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),t=Math.round(t),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{opacity:t/100}}})}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.focusTexture()}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`;this.template=e}}const KA=[Jm.DRAFT,Jm.FINAL,Jm.VOID,Jm.REJECTED,Jm.ACCEPTED,Jm.APPROVED,Jm.NOT_APPROVED,Jm.COMPLETED,Jm.CONFIDENTIAL,Jm.INITIAL_HERE,Jm.SIGN_HERE,Jm.WITNESS];class QA extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-stamp-panel"),na(this,"select",void 0),na(this,"selectBox",void 0),na(this,"iconName",Jm.DRAFT),na(this,"enableCustomStamp",!1),na(this,"customStampSelect",void 0),na(this,"customStampSelectBox",void 0),na(this,"customStampList",[]),this.enableCustomStamp=t.data.enableCustomStamp,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"stampIcon"!==t&&this.toggleSelect(!1,!1),this.enableCustomStamp&&"customStamp"!==t&&this.toggleSelect(!0,!1)}))}bindHooks(){this.hooks.inserted.on((()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.enableCustomStamp&&(this.customStampSelect=this.el.querySelector(".ddv-palette-custom-stamp"),this.customStampSelectBox=this.el.querySelector(".ddv-palette-custom-stamp-select")),this.bindToggleEvent(),this.bindSelectEvent(),this.bindCreateCustomStampEvent()}))}bindToggleEvent(){this.nativeOn(this.select,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect(!1)})),this.enableCustomStamp&&this.nativeOn(this.customStampSelect,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","customStamp"),this.toggleSelect(!0)}))}bindSelectEvent(){this.nativeOn(this.selectBox,"click",(t=>{const e=t.target.value;this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:e,stampConfig:null}}})})),this.nativeOn(this.selectBox,"pointermove",(t=>{t.stopPropagation()}))}bindViewerHooks(){const t=this.injection.viewer,e=()=>{var e;const{toolMode:i,annotationMode:n}=t.getViewerConfig(),s=t.getAnnotationConfig();"annotation"!==i||"stamp"!==n||null!==(e=s.defaultStyleConfig)&&void 0!==e&&null!==(e=e.stamp)&&void 0!==e&&e.imageData?this.el.style.display="none":this.el.style.display=""};this.hooks.inserted.on((()=>{e();const{defaultStyleConfig:i}=t.getAnnotationConfig(),{stamp:n}=i,s=(null==n?void 0:n.stampIcon)||(null==tv?void 0:tv.stampIcon);this.updateStampSpan(s)})),t.hooks.annotationDefaultStyleChanged.on((t=>{e();const{stamp:i}=t,n=(null==i?void 0:i.stampIcon)||(null==tv?void 0:tv.stampIcon);(null==i?void 0:i.stampConfig)?this.updateStampSpan("SBCustom Stamp"):n!==this.iconName&&this.updateStampSpan(n)}),this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this)}toggleSelect(t,e){const i=t?this.customStampSelect:this.select,n=t?this.customStampSelectBox:this.selectBox,s=i.querySelector(".ddv-down-arrow"),o="none"!==n.style.display,r=Hd(e)?!o:e,a=this.injection.viewer.context.viewService.mainContainer;o!==r&&(r?(n.style.display="block",n.style.top=`${nA(n,a)}px`,s.style.transform="rotate(180deg)"):(n.style.display="none",s.style.transform=""))}updateStampSpan(t){this.el.getElementsByTagName("span")[1].innerText=t.slice(2),this.iconName=t}getStampIconSelectTemplate(){let t="";for(let e=0;e<KA.length;e++){const i=KA[e];t+=`<button value="${i}">${i.slice(2)}</button>`}return`<div class="ddv-palette-stamp-icon"><span>${Jm.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${t}</div></div>${this.getCustomStampTemplate()}`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=e}bindCreateCustomStampEvent(){if(!this.enableCustomStamp)return;const t=this.customStampSelectBox.querySelector(".ddv-palette-custom-stamp-button");this.nativeOn(t,"click",(()=>{gA(this.injection.viewer,!0),this.$emit("ui_changePalette_visible","AnnotationCustomStampPanel",!0)})),this.$on("ui_customStampCreated",(t=>{const{stampConfig:e,stampImage:i}=t,n=URL.createObjectURL(i),s={stampConfig:Wd(e),imgUrl:n};this.customStampList.push(s),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampConfig:s.stampConfig}}}),this.addCustomStamp(s)})),this.nativeOn(this.customStampSelectBox,"click",(t=>{const e=t.target;if(e instanceof HTMLImageElement){const t=Tu(e.parentElement),{stampConfig:i}=this.customStampList[t-1];this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampConfig:i}}})}if("i"===e.tagName.toLocaleLowerCase()){t.stopPropagation();const i=Tu(e.parentElement),{imgUrl:n}=this.customStampList[i-1];URL.revokeObjectURL(n),e.parentElement.remove(),this.customStampList.splice(i-1,1)}}))}getCustomStampTemplate(){return this.enableCustomStamp?'<div class="ddv-palette-custom-stamp"><span>Custom Stamp</span><i class="ddv-down-arrow"></i><div class="ddv-palette-custom-stamp-select" style="display: none;"><div><button class="ddv-palette-custom-stamp-button">Create New Stamp</button></div></div></div>':""}addCustomStamp(t){const e=document.createElement("div");e.className="ddv-palette-custom-stamp-item";const i=document.createElement("img");i.src=t.imgUrl,i.draggable=!1,e.appendChild(i);const n=document.createElement("i");n.className="ddv-button ddv-delete-annot",e.appendChild(n),this.customStampSelectBox.appendChild(e)}}const tI=Ep.displayResolution/Ep.dataResolution;class eI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-stroke-panel"),na(this,"isPointerDown",!1),na(this,"lastPointerValue",void 0),na(this,"range",void 0),na(this,"input",void 0),na(this,"inputIsBlur",!0),na(this,"isArrowKeyPressed",!1),na(this,"maxBorderWidth",20),this.maxBorderWidth=t.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none"}))}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),iA(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()}))}bineInputEvent(){const{input:t}=this;this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0)})),this.nativeOn(t,"keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=mg(t.value).value;e>this.maxBorderWidth&&(t.value=this.maxBorderWidth),e<0&&(t.value=0);let i=parseInt(t.value,10);qd(i)||(i=1,this.updateInput(1*tI)),this.updateDefaultBorderWidth(i),this.updateBorderWidthByData(i),this.isArrowKeyPressed=!1}})),this.nativeOn(t,"focus",(e=>{const i=t.value,n=parseFloat(i);t.value=n,t.type="number",this.inputIsBlur=!1})),this.nativeOn(t,"blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="pt")}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=mg(t.value).value;i>this.maxBorderWidth&&(t.value=this.maxBorderWidth),i<0&&(t.value=0);let n=parseInt(t.value,10);qd(n)||(n=1,this.updateInput(1*tI)),this.updateDefaultBorderWidth(n),this.updateBorderWidthByData(n)};this.nativeOn(t,"change",e)}bindRangeEvent(){const{range:t}=this,e=()=>{const e=mg(t.value).value;this.updateBorderWidthByShape(e),this.input.value=`${e}pt`;const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==n&&"erase"!==n&&this.updateInput(e*tI)};this.nativeOn(t,"click",(()=>{const e=mg(t.value).value;this.injection.viewer.context.isFocusCanvas=!1,e!==this.lastPointerValue&&(this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e))})),this.nativeOn(t,"pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox");const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const n=this.injection.viewer.getAnnotationObject(i[0].uid);n instanceof gv&&n.isEditMode&&(n.textEditEventHandler.disableEditMode(),this.injection.viewer.render()),e()})),this.nativeOn(t,"pointermove",(()=>{this.isPointerDown&&e()})),this.nativeOn(t,"pointerup",(()=>{if(this.isPointerDown){const e=mg(t.value).value;this.lastPointerValue=e,this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e)}this.isPointerDown=!1})),this.nativeOn(t,"keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e()})),this.nativeOn(t,"keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=mg(t.value).value;this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e)}}))}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=qd(e[t].borderWidth)?e[t].borderWidth:tv.borderWidth;this.updateInput(i)};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(mg(i.style.borderWidth).value,!0)}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:n}=e,s=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===s.length&&n.includes(s[0].uid)&&this.updateInput(mg(s[0].style.borderWidth).value)}),this),t.hooks.annotationModeChanged.on((t=>{e()}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e()}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:n}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===n||"erase"===n||"stamp"===n)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:s}=this.injection.viewer.getAnnotationConfig(),o=qd(s[n].borderWidth)?s[n].borderWidth:tv.borderWidth;this.updateInput(o)}),this)}updateInput(t,e){let i=t/tI;this.isPointerDown||e?i=Math.round(i):(i=i.toFixed(1),i.endsWith(".0")&&(i=parseInt(i,10))),this.range.value=i,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(i):`${i}pt`}updateBorderWidthByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const n=t*tI,{borderWidth:s}=i.style;s!==n&&(i.style.borderWidth=n,this.injection.viewer.context.render())}updateBorderWidthByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=t*tI,{borderWidth:n}=e[0].style;n!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{borderWidth:i}},["appearanceChanged"])}updateDefaultBorderWidth(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let n=e;i.length&&i[0]&&(n=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:{borderWidth:t*tI}}})}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.focusTexture()}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`;this.template=e}}class iI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-palette-box"),na(this,"header",void 0),na(this,"fillSpan",void 0),na(this,"textSpan",void 0),na(this,"strokeSpan",void 0),na(this,"thumbnail",void 0),YP.registerComponent({ColorPanel:jA,FontPanel:GA,LinePanel:ZA,StampPanel:QA,OpacityPanel:JA,StrokePanel:eI}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",((t,e)=>{t===iI.cpName&&this.togglePopup(e)})),this.injection.viewer.on("thumbnailBind",(t=>{if(this.thumbnail)return;const e=this.injection.viewer.context.core.getViewer(t);e&&(this.thumbnail=e,this.bindThumbnailHooks())}))}bindHooks(){const t=t=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const e=this.header.getElementsByTagName("span");this.textSpan=e[0],this.strokeSpan=e[1],this.fillSpan=e[2],this.bindEvents(),this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:i}=this.data.options;this.el.dataset.enableDrag=`${i}`,function(t){let e,i,n=!1;function s(s){if(!n)return;const o=s.clientX-e,r=s.clientY-i;t.style.left=`${t.offsetLeft+o}px`,t.style.top=`${t.offsetTop+r}px`,e=s.clientX,i=s.clientY}function o(){n=!1,document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",o)}t.addEventListener("pointerdown",(function(r){const a=r.target;a.classList.contains("ddv-button")||"false"===t.dataset.enableDrag||a instanceof HTMLInputElement||a instanceof HTMLButtonElement||(n=!0,e=r.clientX,i=r.clientY,document.addEventListener("pointermove",s),document.addEventListener("pointerup",o))}))}(this.el)};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindEvents(){this.nativeOn(this.el,"click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox",t)})),this.nativeOn(this.el,"pointerup",(t=>{t.target instanceof HTMLInputElement&&!(t.target instanceof HTMLInputElement&&"range"===t.target.type)||this.focusTexture()})),this.nativeOn(this.textSpan,"click",(()=>{this.setPaletteType("text")})),this.nativeOn(this.fillSpan,"click",(()=>{this.setPaletteType("fill")})),this.nativeOn(this.strokeSpan,"click",(()=>{this.setPaletteType("stroke")}))}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{toolMode:e,annotationMode:i}=t.getViewerConfig(),n=t.getSelectedAnnotations();return!t.getPageCounts()||"annotation"!==e&&!n.length||"annotation"===e&&("select"===i||"erase"===i)},i=t=>{"stamp"===t?this.setPaletteType("stamp"):"text"===t?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"))};this.hooks.inserted.on((()=>{e()&&this.togglePopup(!1)})),t.hooks.resize.on((()=>{if("none"===this.el.style.display)return;const{isOutOf:t}=nI(this.el,!1);if(t){var e;const t=this.el.getBoundingClientRect(),i=null===(e=this.el.parentElement)||void 0===e?void 0:e.getBoundingClientRect();this.el.style.right=i.width-t.width+"px"}}),this),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1)}),this),t.hooks.beforeAnnotationDraw.on((()=>{this.togglePopup(!1)}),this),t.hooks.pageChanged.on((e=>{e.total||this.togglePopup(!1);const i=t.getActiveTab();i&&"single"===i.context.displayMode&&1===t.getSelectedAnnotations().length&&this.togglePopup(!1)}),this),t.hooks.toolModeChanged.on((n=>{if(e())return void this.togglePopup(!1);const{annotationMode:s}=t.getViewerConfig();if("annotation"===n.newToolMode&&"select"!==s&&"erase"!==s&&!Xd()){const t=["textBox","textTypewriter"].includes(s);i("stamp"===s?"stamp":t?"text":"common"),this.togglePopup(!0)}}),this),t.hooks.selectedAnnotationsChanged.on((n=>{e()&&this.togglePopup(!1);const s=t.getSelectedAnnotations();if(1!==s.length)return;const o=s[0],r=["textBox","textTypewriter"].includes(o.type),a="stamp"===o.type?"stamp":r?"text":"common";i(a),("text"===a&&"textTypewriter"===o.type||"ink"===o.type)&&(this.header.style.display="none")}),this),t.hooks.annotationModeChanged.on((e=>{if(t.getSelectedAnnotations().length)return;const n=e.newAnnotationMode;if(["erase","select"].includes(n))return void this.togglePopup(!1);const s=["textBox","textTypewriter"].includes(n),o="stamp"===n?"stamp":s?"text":"common";i(o),("text"===o&&"textTypewriter"===n||"ink"===n)&&(this.header.style.display="none");const{toolMode:r}=this.injection.viewer.getViewerConfig(),a=this.injection.viewer.getPageCounts();if(Xd()&&"stamp"!==o)this.togglePopup(!1);else{const{options:t}=this.data;this.togglePopup(a>0&&"annotation"===r&&t.autoDisplay)}}),this)}bindThumbnailHooks(){this.thumbnail.hooks.visibleChanged.on((()=>{if("none"===this.el.style.display)return;const{isOutOf:t,outOfLeft:e,outOfRight:i}=nI(this.el,!1);if(t){var n;const t=this.el.getBoundingClientRect(),s=null===(n=this.el.parentElement)||void 0===n?void 0:n.getBoundingClientRect();e&&(this.el.style.left="0px"),i&&(this.el.style.left=s.width-t.width+"px")}}),this)}setPaletteType(t){const{header:e,textSpan:i,strokeSpan:n,fillSpan:s}=this;if(this.$emit("ui_changePalette_type",t),"stamp"===t)return void(e.style.display="none");const{backgroundColor:o}=getComputedStyle(this.el);e.style.display="";const r=(e,i,n)=>{e.style.background=t===i?n:"",e.style.borderBottom=t===i?"none":""};r(i,"text",o),r(n,"stroke",o),r(s,"fill",o)}togglePopup(t,e,i){const n="none"!==this.el.style.display,s=Hd(t)?!n:t;if(n===s)return;const{options:o}=this.data;s?(this.el.style.display="",null!=o&&o.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),Hd(e)||(this.el.style.right=`${e||0}px`),Hd(i)||(this.el.style.top=`${i||0}px`),this.injection.viewer.emit("annotationPaletteToggle",s),nI(this.el).isOutOf&&(this.el.style.left="",this.el.style.top="")}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof gv&&e.isEditMode&&e.focusTexture()}}initTemplate(){const{options:t}=this.data;cA(dA(this),this.injection.viewer,t),null!=t&&t.labels||(t.labels={}),t.labels={text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business",...t.labels},t.style={...t.style,display:"none"};const e=`<div ${jP(t,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${t.labels.text}</span><span>${t.labels.stroke}</span><span>${t.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel :enableCustomStamp="options.enableCustomStamp" label="${t.labels.standardBusiness}"></StampPanel><OpacityPanel label="${t.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${t.labels.stroke}"></StrokePanel><LinePanel label="${t.labels.style}"></LinePanel></div>`;this.template=e}}function nI(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;if("none"===t.style.display||!t.parentElement)return{isOutOf:!1};const n=t.getBoundingClientRect(),s=t.parentElement.getBoundingClientRect();if(!e){const t=n.left<s.left,e=n.left+n.width>s.right;return{isOutOf:t||e,outOfLeft:t,outOfRight:e}}const o=n.right-i<s.left,r=n.left+i>s.right,a=n.bottom-i<s.top,l=n.top+i>s.bottom;return{isOutOf:o||r||a||l,outOfLeft:o,outOfRight:r,outOfTop:a,outOfBottom:l}}na(iI,"cpName","AnnotationPalette");class sI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-custom-stamp-panel"),na(this,"stampBoard",void 0),na(this,"fontList",[...tA]),na(this,"colorType",void 0),this.stampBoard=new lE(260,100),this.bindHooks(),this.initTemplate(),this.$on("ui_addFont",(t=>{this.addFont(t)})),this.$on("ui_changePalette_visible",((t,e)=>{t===sI.cpName&&this.togglePopup(e)}))}getFontFamilySelectTemplate(){let t="";for(let e=0;e<tA.length;e++){const i=tA[e];t+=`<button style="font-family:${i}" value="${i}">${i}</button>`}return`<div class="ddv-stamp-font-family"><p>${this.stampBoard.signatureStyle.fontFamily}</p><i class="ddv-down-arrow"></i><div class="ddv-stamp-font-family-select" style="display: none;">${t}</div></div>`}bindHooks(){this.hooks.inserted.on((t=>{this.injection.viewer.context.viewService.rootDom.appendChild(this.el);const e=this.stampBoard.getCanvas();this.el.querySelector(`.${this.defaultClass}-canvas-container`).appendChild(e),this.bindEvents(),this.updateFontStyleButton(),this.selectColorType("background"),this.updateColorSelected()}))}bindEvents(){const t=this.el.querySelector(".ddv-bold"),e=this.el.querySelector(".ddv-italic"),i=this.el.querySelector(".ddv-underline"),n=this.el.querySelector(".ddv-line-through");this.nativeOn(t,"click",(()=>{const{fontWeight:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({fontWeight:"bold"===t?"normal":"bold"}),this.updateFontStyleButton()})),this.nativeOn(e,"click",(()=>{const{fontStyle:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({fontStyle:"italic"===t?"normal":"italic"}),this.updateFontStyleButton()})),this.nativeOn(i,"click",(()=>{const{underline:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({underline:!t}),this.updateFontStyleButton()})),this.nativeOn(n,"click",(()=>{const{strikeout:t}=this.stampBoard.signatureStyle;this.stampBoard.updateSignatureStyle({strikeout:!t}),this.updateFontStyleButton()}));const s=this.el.querySelectorAll(`.${this.defaultClass}-color-type span`),[o,r,a]=Array.from(s);this.nativeOn(o,"click",(()=>{this.selectColorType("background")})),this.nativeOn(r,"click",(()=>{this.selectColorType("border")})),this.nativeOn(a,"click",(()=>{this.selectColorType("text")}));const l=this.el.querySelector(`.${this.defaultClass}-color-container`);this.nativeOn(l,"click",(t=>{const e=t.target;if(!(e.dataset.color||e instanceof HTMLButtonElement))return;const i=(e instanceof HTMLButtonElement?e.parentNode:e).dataset.color;"background"===this.colorType?this.stampBoard.updateSignatureStyle({background:i}):"border"===this.colorType?this.stampBoard.updateSignatureStyle({borderColor:i}):this.stampBoard.updateSignatureStyle({color:i}),this.updateColorSelected()}));const h=this.el.querySelector(`.${this.defaultClass}-ok`);this.nativeOn(h,"click",(async t=>{const e=this.stampBoard.getStampConfig(),i=await this.stampBoard.getSignatureImage(),{options:n}=this.data,{autoDisplay:s}=n;this.$emit("ui_customStampCreated",{stampConfig:e,stampImage:i}),s&&this.togglePopup(!1)}));const c=this.el.querySelector(".ddv-button-close");this.nativeOn(c,"click",(t=>{this.togglePopup(!1)})),this.bindInputEvent(),this.bindToggleEvent(),this.bindSelectEvent()}bindInputEvent(){const t=this.el.querySelector(`.${this.defaultClass}-stamp-text input`);this.nativeOn(t,"input",(()=>{const e=t.value;this.stampBoard.updateSignatureStyle({stampText:e})}));const e=this.el.querySelectorAll(`.${this.defaultClass}-time-stamp input`),[i,n,s,o]=Array.from(e);this.nativeOn(i,"input",(()=>{const t=i.value;this.stampBoard.updateSignatureStyle({userName:t})})),this.nativeOn(n,"change",(()=>{this.stampBoard.updateSignatureStyle({hasUserName:n.checked})})),this.nativeOn(s,"change",(()=>{this.stampBoard.updateSignatureStyle({hasDate:s.checked})})),this.nativeOn(o,"change",(()=>{this.stampBoard.updateSignatureStyle({hasTime:o.checked})}))}bindSelectEvent(){const t=this.el.querySelector(".ddv-stamp-font-family"),e=t.querySelector(".ddv-stamp-font-family-select"),i=t.querySelector("p");this.nativeOn(e,"click",(t=>{t.stopPropagation(),this.toggleSelect(!1);const e=t.target.value;e&&(this.stampBoard.updateSignatureStyle({fontFamily:e}),i.innerText=e)}))}bindToggleEvent(){const t=this.el.querySelector(".ddv-stamp-font-family");this.nativeOn(t,"click",(t=>{t.stopPropagation(),this.toggleSelect()}))}toggleSelect(t){const e=this.el.querySelector(".ddv-stamp-font-family"),i=e.querySelector(".ddv-stamp-font-family-select"),n=e.querySelector(".ddv-down-arrow"),s="none"!==i.style.display,o=Hd(t)?!s:t,r=this.injection.viewer.context.viewService.rootDom;s!==o&&(o?(i.style.display="block",i.style.top=`${nA(i,r)}px`,n.style.transform="rotate(180deg)"):(i.style.display="none",n.style.transform=""))}addFont(t){const e=this.el.querySelector(".ddv-stamp-font-family");if(this.fontList.includes(t))return;this.fontList.push(t);const i=e.querySelector(".ddv-stamp-font-family-select"),n=document.createElement("button");n.style.fontFamily=t,n.value=t,n.innerText=t,i.appendChild(n)}updateFontStyleButton(){const{fontStyle:t,fontWeight:e,underline:i,strikeout:n}=this.stampBoard.signatureStyle,s=this.el.querySelector(".ddv-bold"),o=this.el.querySelector(".ddv-italic"),r=this.el.querySelector(".ddv-underline"),a=this.el.querySelector(".ddv-line-through");lA(s,"bold"===e,"light"),lA(o,"italic"===t,"light"),lA(r,i,"light"),lA(a,n,"light")}getColorSelector(t){const{options:e}=this.data,{colorList:i}=e,n=document.createElement("div");let s=`<div class="${t}">`,o=0,r=!1;for(let e=0;e<i.length;e++){const a=i[e];if(n.style.background=a,""!==n.style.background){if(o>20)break;o+=1,s+=`<div data-color="${a}"><button style="background:${a}"></button></div>`,0!==o&&o%10==0&&(r=!1,s+="</div>",e!==i.length-1&&(r=!0,s+=`<div class="${t}">`)),n.style.background=""}}return r&&(s+="</div>"),n.remove(),s}selectColorType(t){if(t===this.colorType)return;const e=this.el.querySelectorAll(`.${this.defaultClass}-color-type span`),[i,n,s]=Array.from(e);this.colorType=t,[{element:i,type:"background"},{element:n,type:"border"},{element:s,type:"text"}].forEach((e=>{let{element:i,type:n}=e;n===t?(i.style.color="#3183c8",i.style.borderBottom="2px solid #3183c8"):(i.style.color="",i.style.borderBottom="")})),this.updateColorSelected()}updateColorSelected(){const{colorType:t}=this,{background:e,borderColor:i,color:n}=this.stampBoard.signatureStyle,s="background"===t?e:"border"===t?i:n,o=this.el.querySelectorAll(".ddv-custom-stamp-panel-color-container div");Array.from(o).forEach((t=>{t.style.border=t.dataset.color===s?"1px solid #aaa":""}))}togglePopup(t){const e="none"!==this.el.style.display,i=Hd(t)?!e:t;e!==i&&(this.el.style.display=i?"":"none",i||gA(this.injection.viewer,!1))}initTemplate(){const{options:t}=this.data;cA(dA(this),this.injection.viewer,t),t.style={...t.style,display:"none"};const{hasUserName:e,hasDate:i,hasTime:n}=this.stampBoard.signatureStyle,s=`<div ${jP(t,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${(null==t?void 0:t.title)||"Create New Stamp"}</span><div class="ddv-button ddv-button-close"></div></div><div class="${this.defaultClass}-content"><div class="${this.defaultClass}-canvas-container"></div><div class="${this.defaultClass}-stamp-text"><span>${t.labels.stampText}</span><input type="text" value="${this.stampBoard.signatureStyle.stampText}"/></div><div class="${this.defaultClass}-font-style"><span>${t.labels.fontStyle}</span><div style="margin-top: 10px; display: flex; justify-content: space-between">${this.getFontFamilySelectTemplate()}<div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div></div><div class="${this.defaultClass}-time-stamp"><span>${t.labels.timeStampText}</span><div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;"><input type="text" value="${this.stampBoard.signatureStyle.userName}"/><label><input checked="${e?"checked":""}" type="checkbox"/>${t.labels.userName}</label><label><input checked="${i?"checked":""}" type="checkbox" />${t.labels.date}</label><label><input checked="${n?"checked":""}" type="checkbox" />${t.labels.time}</label></div></div><div class="${this.defaultClass}-color-picker"><div class="${this.defaultClass}-color-type"><span>${t.labels.backgroundColor}</span><span>${t.labels.borderColor}</span><span>${t.labels.textColor}</span></div><div class="${this.defaultClass}-color-container">${this.getColorSelector(`${this.defaultClass}-color-list`)}</div></div><div class="${this.defaultClass}-footer"><div class="${this.defaultClass}-ok">${t.labels.create}</div></div></div></div>`;this.template=s}}na(sI,"cpName","AnnotationCustomStampPanel");class oI extends fA{constructor(t){super(t,{class:"ddv-auto-capture",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoCapture:i}=t.getCameraConfig();e===$b.CAPTURE&&t.updateCameraConfig({enableAutoCapture:!i})}}),this.bindViewerHooks()}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?t.getCameraConfig().enableAutoCapture?this.setUiState("focused",!Xd()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoCaptureChanged.on((t=>{const e=t.enableAutoCapture?"focused":"normal";this.setUiState(e,!Xd())}),this),t.cameraPlayed.on((()=>{const{enableAutoCapture:t}=this.injection.viewer.getCameraConfig();this.setUiState(t?"focused":"normal",!Xd())}),this),t.cameraClosed.on((()=>{this.setUiState("disabled")}),this)}}na(oI,"cpName","AutoCapture");class rI extends fA{constructor(t){super(t,{class:"ddv-auto-detect",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoDetect:i}=t.getCameraConfig();e===$b.CAPTURE&&t.updateCameraConfig({enableAutoDetect:!i})}}),this.bindViewerHooks()}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()&&t.context.core.detectorService.enableDetect?t.getCameraConfig().enableAutoDetect?this.setUiState("focused",!Xd()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoDetectChanged.on((t=>{const e=t.enableAutoDetect?"focused":"normal";this.setUiState(e,!Xd())}),this),t.cameraPlayed.on((()=>{const{core:t}=this.injection.viewer.context;if(!t.detectorService.enableDetect)return;const{enableAutoDetect:e}=this.injection.viewer.getCameraConfig();this.setUiState(e?"focused":"normal",!Xd())}),this),t.cameraClosed.on((()=>{this.setUiState("disabled")}),this)}}na(rI,"cpName","AutoDetect");class aI extends fA{constructor(t){super(t,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const t=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),t.capture().finally((()=>{this.isCapturing=!1,this.setUiState("normal")}))}}),na(this,"isCapturing",!1),this.bindViewerHooks()}bindDefaultUi(){const t=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled")};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{this.setUiState("normal")}),this),t.cameraClosed.on((()=>{this.setUiState("disabled")}),this)}}na(aI,"cpName","Capture");class lI extends fA{constructor(t){super(t,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.turnOnTheTorch?t.turnOffTorch():t.turnOnTorch()}}),this.bindViewerHooks()}bindDefaultUi(){const t=()=>{const{viewer:t}=this.injection;t.isVideoPlaying()&&t.cameraContext.torchSupported?t.cameraContext.turnOnTheTorch?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on((t=>{switch(t.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!Xd());break;default:this.setUiState("disabled")}}),this)}}na(lI,"cpName","Flashlight");class hI extends fA{constructor(t){super(t,{class:"ddv-camera-convert",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.convertCamera()}}),this.bindViewerHooks()}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?this.setUiState(t.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled")};this.hooks.inserted.on(t),this.hooks.updated.on(t)}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{const t=this.injection.viewer.cameraContext.canFrontCamera;this.setUiState(t?"normal":"disabled")}),this),t.cameraClosed.on((()=>{this.setUiState("disabled")}),this)}}na(hI,"cpName","CameraConvert");const cI=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class dI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-resolution"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),na(this,"resolutionOptions",[]),na(this,"isFirstClick",!0),na(this,"fakeResolution",!1),na(this,"lastCheckIndex",0),na(this,"box",void 0),this.bindHooks(),this.initTemplate(),sA(this)}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),aA(this.el,!0)})),this.hooks.updated.on((()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||aA(this.el,!0)}))}bindEvents(){const t=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(hA(t,this.el,this.box),this.isFirstClick=!1)})),this.ulEvent(t)}ulEvent(t){t&&this.nativeOn(t,"click",(t=>{const e=this.injection.viewer,i=t.target,n=i.parentNode;if("LI"===i.tagName||"LI"===n.tagName){const t="LI"===i.tagName?i.value:n.value;if(t===this.lastCheckIndex)return;const{width:s,height:o}=this.resolutionOptions[t].value;this.fakeResolution=!0,e.setResolution(s,o).catch((t=>{vw.error(t)})),this.updateChecked(s,o)}this.togglePopup(!1)}))}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.cameraPlayed.on((t=>{if(aA(this.el,!1),this.fakeResolution)return;const{width:e,height:i}=t.resolution;this.updateChecked(e,i),this.fakeResolution=!1}),this),e.cameraClosed.on((()=>{aA(this.el,!0)}),this),e.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1)}),this)}updateChecked(t,e){const i=function(t,e){let i=-1;const n=e.width*e.height;for(let e=0;e<t.length;e++){const{value:s}=t[e],o=s.width*s.height;if(0===e&&n<=o)return 0;if(e===t.length&&n>=o)return t.length-1;n>o&&(i=e+1)}return i}(this.resolutionOptions,{width:t,height:e}),{box:n,checkedClassName:s}=this,o=n.getElementsByClassName(`${this.cssPrefix}checkbox`)[i],r=n.getElementsByClassName(s)[0];o!==r&&(this.lastCheckIndex=i,null==o||o.classList.add(s),null==r||r.classList.remove(s))}initTemplate(){const{options:t}=this.data,{popupBox:e}=t;cA(dA(this),this.injection.viewer,t);const i=`<div ${jP(t,`${this.defaultClass} ddv-button`)}>`+(Hd(null==t?void 0:t.label)?"":`<span>${t.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${jP(e,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=i}getOptionTemplate(){const{options:t}=this.data;let e=cI;if(Ud(null==t?void 0:t.valueList))e=t.valueList;else{const{CameraResolution_720P:t,CameraResolution_1080P:i,CameraResolution_1440P:n,CameraResolution_2160P:s}=fD.getDisplayTextConfig(),o=[t,i,n,s];e.forEach(((t,e)=>{o[e]&&(t.label=o[e])}))}let i="";return e.forEach(((t,e)=>{const{width:n,height:s}=t.value;qd(n)&&qd(s)&&(i+=[`<li value="${e}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==t?void 0:t.label)||""}</span>`,"</li>"].join(""))})),this.resolutionOptions=e,i}updateResolution(){const t=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t}togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let n="none"!==e.style.display;n=Hd(t)?!n:t,n?(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)):e.remove(),lA(this.el,n),e.style.display=n?"":"none"}}na(dI,"cpName","CameraResolution");class uI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-image-preview"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"uiState",void 0),na(this,"image",void 0),na(this,"counter",void 0),na(this,"imagePageUid",void 0),na(this,"hasTask",!1),na(this,"isUpdateTask",!1),na(this,"lastPageUid",void 0),na(this,"pageTaskUids",[]),na(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on((t=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter()})),this.hooks.inserted.on((t=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`)})),this.hooks.destroyed.on((()=>{var t;clearTimeout(this.currentTimer),null!=this&&this.image&&null!=this&&null!==(t=this.image)&&void 0!==t&&t.src&&URL.revokeObjectURL(this.image.src)}))}bindViewerHooks(){const t=this.injection.viewer,e=Xd()?10:4;t.hooks.updatePage.on((async i=>{if(i.pageUid!==this.lastPageUid)return;if(this.hasTask)return this.pageTaskUids.push(i.pageUid),void(this.isUpdateTask=!0);this.hasTask=!0;const n=t.getPageCounts(),s=await t.getPerspectivePreviewImage(n-1,400,400,e);s&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=tu(s.data).data),this.hasTask=!1,this.pageTaskUids.length>0&&this.createTask()}),this),t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.image.src="",this.setState("disabled"),this.imagePageUid=void 0,void(this.lastPageUid=void 0);if(null==this||!this.counter)return;this.counter.innerText=`${e.total}`;const i=t.getActiveTab();if(!i)return;const n=i.pages[e.total-1].uid;this.pageTaskUids.push(n),this.hasTask||n!==this.lastPageUid&&this.createTask()}),this)}async createTask(){this.hasTask||(this.hasTask=!0,await this.updateImage(),this.currentTimer=setTimeout((()=>{this.hasTask=!1,0!==this.pageTaskUids.length&&this.createTask()}),300))}async updateImage(){const t=this.injection.viewer;if(!t||!t.context)return;const e=t.getActiveTab(),i=Xd()?10:4;if(!e)return;const n=e.pages.length;if(!n)return;const s=this.pageTaskUids[this.pageTaskUids.length-1],o=e.pages[n-1].uid;if(this.pageTaskUids.length=0,this.lastPageUid=e.pages[n-1].uid,this.lastPageUid===s&&this.imagePageUid===s&&!this.isUpdateTask)return;let r;this.isUpdateTask&&(this.isUpdateTask=!1);try{r=await t.getPerspectivePreviewImage(n-1,400,400,i)}catch(t){}r&&!t.isDestroy&&t.getActiveTab()&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=tu(r.data).data,this.imagePageUid=o,this.setState(n>0?"normal":"disabled"))}setState(t){this.uiState!==t&&this.el&&("normal"===t?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=t)}initTemplate(){const{options:t}=this.data,{imageCounter:e}=t,i=this.injection.viewer.getPageCounts();cA(dA(this),this.injection.viewer,t);const n=`<div ${jP(t,this.defaultClass)}> <img src=""></img><div ${jP(e,this.cssPrefix,"counter")}>${i}</div></div>`;this.template=n}}na(uI,"cpName","ImagePreview");class pI extends fA{constructor(t){super(t,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click()}}),na(this,"fileLoader",void 0),this.$on("ui_cropClick",(t=>{const{viewer:e}=this.injection;0!==(e.getPageCounts()||0)&&this.setUiState(t?"disabled":"normal")}))}createFileInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",t.type="file",t.multiple=!0,this.nativeOn(t,"change",(()=>{const{files:e}=t,i=e.length,n=[];for(let t=0;t<i;t++){const i=new Blob([e[t]],{type:e[t].type});if("application/pdf"===e[t].type){const t=ub.annotationLicenseModuleIsExist();n.push({fileData:i,convertMode:qv.CM_AUTO,renderOptions:{renderAnnotations:t?Zv.LOAD_ANNOTATIONS:Zv.NO_ANNOTATIONS}})}else n.push({fileData:i})}this.injection.viewer.context.loadSource(n),t.value=null,t.files=null})),t}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createFileInput();t.style.display="none",this.el.appendChild(t),this.fileLoader=t,this.nativeOn(t,"click",(t=>{t.stopPropagation()}))}))}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on((t=>{null!=t&&t.pageCount||this.setUiState("normal")}),this)}}na(pI,"cpName","Load");class gI extends fA{constructor(t){super(t,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages()}}),rA(this)}}na(gI,"cpName","DeleteAll");class fI extends fA{constructor(t){super(t,{class:"ddv-delete-current",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.deletePages([e])}}),rA(this)}}function mI(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){const i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(i)}}function vI(t,e,i){if("download"in HTMLAnchorElement.prototype){const i=document.createElementNS("http://www.w3.org/1999/xhtml","a");e=e||t.name||"download",i.download=e,i.rel="noopener","string"==typeof t?(i.href=t,i.origin!==window.location.origin?function(t){const e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return e.status>=200&&e.status<=299}(i.href)?function(t,e){const i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=()=>{vI(i.response,e)},i.onerror=()=>{},i.send()}(t,e):(i.target="_blank",mI(i)):mI(i)):(i.href=URL.createObjectURL(t),setTimeout((()=>{URL.revokeObjectURL(i.href),i.href="",i.remove()}),3e3),setTimeout((()=>{mI(i)}),0))}}na(fI,"cpName","DeleteCurrent");class yI extends fA{constructor(t){super(t,{class:"ddv-button-download",callback:()=>{const t=this.injection.viewer,e=t.getActiveTab(),i=vw.buildInfo("save",{docUid:e.doc.uid,pageUids:e.doc.pages,current:0,total:e.doc.pages.length});vw.info(i),t.context.core.fileSaveService.saveToPdf(e.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:ub.annotationLicenseModuleIsExist()?"annotation":"none"},i).then((t=>{vI(t,`${e.docName}.pdf`)})).catch((t=>{vw.error(t)}))}}),oA(this)}}na(yI,"cpName","Download");class xI extends vA{constructor(t){const{Delete_DeleteCurrent:e,Delete_DeleteAll:i}=fD.getDisplayTextConfig(),{Delete_DeleteCurrent:n,Delete_DeleteAll:s}=QP;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"DeleteCurrent",label:e,id:n},{type:"DeleteAll",label:i,id:s}],defaultClassName:"ddv-delete-btn"},super(t),rA(this)}}na(xI,"cpName","Delete");class wI extends fA{constructor(t){super(t,{class:"ddv-print-page",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex(),i=t.getActiveTab(),{displayMode:n}=i.context;"single"===n?t.context.core.printPages(i.uid,[e]):t.context.core.printPages(i.uid)}}),oA(this)}}na(wI,"cpName","Print");class bI extends fA{constructor(t){super(t,{class:"ddv-crop-current",callback:()=>{this.cropEvent()}})}bindDefaultUi(){CI(this)}cropEvent(){const t=this.injection.viewer,e=t.getRectBox(),i=t.getCurrentPageIndex();e&&t.cropPages(e,[i])}}function CI(t){const e=t.injection.viewer,i=i=>{const n=Hd(null==i?void 0:i.pageCount)?e.getPageCounts():i.pageCount,s=e.getRectBox();n&&s?t.setUiState("normal"):t.setUiState("disabled")};t.hooks.inserted.on(i),t.hooks.updated.on(i),e.hooks.pageExistenceChanged.on(i,t),e.hooks.cropRectDrawn.on((e=>{t.setUiState("normal")}),t),e.hooks.cropRectDeleted.on((e=>{t.setUiState("disabled")}),t)}na(bI,"cpName","CropCurrent");class SI extends fA{constructor(t){super(t,{class:"ddv-crop-all",callback:()=>{this.cropEvent()}})}bindDefaultUi(){CI(this)}cropEvent(){const{viewer:t}=this.injection,e=t.getRectBox(),i=t.getCropIndices();e&&t.cropPages(e,i)}}na(SI,"cpName","CropAll");class _I extends fA{constructor(t){super(t,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent()}})}perspectiveEvent(){const{viewer:t}=this.injection;t.perspectiveAllPage()}}na(_I,"cpName","PerspectiveAll");class TI extends fA{constructor(t){super(t,{class:"ddv-full-quad",callback:()=>{this.toggleFull()}}),this.bindViewerHooks()}toggleFull(){const{viewer:t}=this.injection;t.toggleFullPerspective()}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.perspectiveQuadChanged.on((t=>{this.isFocused=t.isFull||!1,this.setUiState(t.isFull?"focused":"normal",!Xd())}),this)}}na(TI,"cpName","FullQuad");class EI extends fA{constructor(t){super(t,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo()}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(t)}))}bindDefaultUi(){PI("redo",this)}}function PI(t,e){const{viewer:i}=e.injection,n=()=>{const n=i.getOperationState(),s=("redo"===t?n.redo:n.undo)>0?"normal":"disabled";e.setUiState(s)};e.hooks.inserted.on(n),e.hooks.updated.on(n),i.hooks.operationsChanged.on((i=>{let n="disabled";n="redo"===t?i.redo>0?"normal":"disabled":i.undo>0?"normal":"disabled",e.setUiState(n)}),e)}na(EI,"cpName","Redo");class AI extends fA{constructor(t){super(t,{class:"ddv-restore-page",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.reset(e)}}),rA(this)}}na(AI,"cpName","Restore");class II extends fA{constructor(t){super(t,{class:"ddv-rotate-left",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(-90,[e])}}),rA(this)}}na(II,"cpName","RotateLeft");class DI extends fA{constructor(t){super(t,{class:"ddv-rotate-right",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(90,[e])}}),rA(this)}}na(DI,"cpName","RotateRight");class kI extends fA{constructor(t){super(t,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo()}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(t)}))}bindDefaultUi(){PI("undo",this)}}na(kI,"cpName","Undo");class RI extends mA{constructor(t){super(t),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks()}initHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((t=>{const e="crop"===t.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(e?"focused":"normal"),this.togglePopup(e),this.isFirstClick&&e&&this.el.click()),this.$emit("ui_cropClick",e),this.$emit("ui_toolModeRefactor")}),this),t.hooks.cropRectDrawn.on((()=>{aA(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1)}),this),t.hooks.pageChanged.on((()=>{aA(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount())}),this)}bindPullDownBoxEvents(){const{viewer:t}=this.injection,e=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),i=this.pullDownBox.getElementsByTagName("input")[1],n=this.pullDownBox.getElementsByTagName("input")[0],s=e.children[0],o=e.children[1],r=()=>{this.togglePopup(!1),t.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}})};this.nativeOn(o,"click",(()=>{const e=t.getRectBox(),i=t.getCropIndices();e&&(t.cropPages(e,i),r())})),this.nativeOn(s,"click",r),this.nativeOn(this.el,"click",(()=>{const e=t.rootDom,i=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];t.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor"),aA(i,!t.getRectBox()),this.isFirstClick&&(hA(e,this.el,this.pullDownBox),this.isFirstClick=!1)})),this.nativeOn(i,"change",(()=>{t.cropMode="all"})),this.nativeOn(n,"change",(()=>{t.cropMode="current"}))}bindPopupSwitchEvent(){}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?("crop"===e&&this.el.click(),i=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(i)};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}bindViewerHooks(){}initTemplate(){const{defaultClass:t}=this,{options:e}=this.data,{popupBox:i}=e,{postfix:n,cropMode:s}=this.injection.viewer,{Crop_CropCurrent:o,Crop_CropAll:r,Crop_CropApply:a,Crop_CropCancel:l}=fD.getDisplayTextConfig(),{Crop_CropCurrent:h,Crop_CropAll:c,Crop_CropApply:d,Crop_CropCancel:u}=QP,p="current"===s?'checked="checked"':"",g="all"===s?'checked="checked"':"";cA(dA(this),this.injection.viewer,e);const f=`<div ${jP(e,`ddv-button ${t}`)}>`+(Hd(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${jP(i,`${t}-box`)}><div>`+`<input ${p} type="radio" id="${h+n}" name="cropType" value="cropCurrent" />`+`<label for="${h+n}">${o}</label>`+`<input ${g} type="radio" id="${c+n}" name="cropType" value="cropAll" />`+`<label for="${c+n}">${r}</label></div>`+`<div class= "${t}-buttonGroup">`+`<div id="${u+n}"><span>${l}</span></div>`+`<div id="${d+n}"><span>${a}</span></div></div></div></div>`;this.template=f}}na(RI,"cpName","Crop");class MI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-filter-item"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on((t=>{this.bindEvents()})),this.hooks.inserted.on((()=>{this.bindFilterEvents()}))}bindEvents(){const{el:t}=this;this.nativeOn(t,"click",(()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:t}=this.data;this.$emit("ui_filterClick",t.type)}))}bindFilterEvents(){this.$on("ui_filterReset",(t=>{this.resetSelect(t.currentFilter);const{filterList:e}=t,{itemValue:i}=this.data,n=this.el.getElementsByTagName("img")[0];n.src&&URL.revokeObjectURL(n.src),e.forEach((t=>{if(t.type===i.type){let e="";t.imageData&&(e=tu(t.imageData).data),n.src=e}}))})),this.$on("ui_filterLoading",(t=>{const e=this.el.getElementsByTagName("img")[0],i=this.el.getElementsByTagName("div")[0];e.style.display=t?"none":"",i.style.display=t?"":"none",this.el.style.pointerEvents=t?"none":""})),this.injection.viewer.hooks.filterChanged.on((t=>{this.resetSelect(t.filterType)}),this)}resetSelect(t){const{itemValue:e}=this.data;t===e.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass)}initTemplate(){const{options:t,itemValue:e}=this.data,i=`<div ${jP(t,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${e.label}</span></div>`;this.template=i}}const LI=[{type:"none",label:"Original"}];class OI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-filter"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"isFirstClick",!0),na(this,"box",void 0),na(this,"applyAll",!1),na(this,"filterList",void 0),na(this,"filterUpdateStatus",!1),na(this,"enableFilter",!1),na(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),sA(this);const{filterService:e}=this.injection.viewer.context.core;e.enableFilter&&(this.enableFilter=!0,rA(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),YP.registerComponent({FilterItem:MI})}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.filterUpdateStatus=!0,this.bindNativeEvents()})),this.hooks.updated.on((()=>{this.uiState="normal"}))}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:hA(i,this.el,this.box)}),this)}bindViewerHooks(){const t=this.injection.viewer;t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.filterUpdateStatus=!0,void this.togglePopup(!1);const i=t.context.getActiveTab();if(!i||!this.box)return;const{currentUid:n,oldCurrentUid:s}=i;s!==n&&(this.filterUpdateStatus=!0,this.togglePopup(!1))}),this),t.hooks.updatePage.on((e=>{var i;const n=t.context.getActiveTab();n&&this.box&&(null===(i=n.getCurrentPage())||void 0===i?void 0:i.uid)===e.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1))}),this),t.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1)}),this)}bindNativeEvents(){const{el:t,box:e}=this,i=e.querySelector(`.${this.cssPrefix}list-header`),n=i.getElementsByTagName("span")[0],s=i.getElementsByTagName("div")[0];this.nativeOn(t,"click",(async t=>{this.togglePopup(),this.isFirstClick&&(hA(this.injection.viewer.rootDom,this.el,this.box),this.isFirstClick=!1)})),this.nativeOn(e,"click",(t=>{t.stopPropagation()})),this.nativeOn([n,s],"click",(()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:t}=this.injection,e=t.getPageCounts(),i=t.getCurrentPageUid(),n=t.context.core.pageService.getPage(i);t.filter(Array.from(Array(e).keys()),n.filter)}}))}bindFilterEvents(){this.$on("ui_filterClick",(t=>{const{viewer:e}=this.injection,i=e.getPageCounts();if(i<1)return;let n=Array.from(Array(i).keys());if(!this.applyAll){const i=e.getCurrentPageUid();if(e.context.core.pageService.getPage(i).filter===t)return;n=[e.getCurrentPageIndex()]}e.filter(n,t)}))}clickApplyToAll(t){const e=this.injection.viewer,i=QP.Filter_FilterAll+e.postfix,n=document.getElementById(i);if(Hd(t))return this.applyAll?n.classList.remove(`${this.cssPrefix}checked`):n.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);t?n.classList.add(`${this.cssPrefix}checked`):n.classList.remove(`${this.cssPrefix}checked`),this.applyAll=t}async updateFilterPreview(){const t=this.injection.viewer,e=t.getCurrentPageUid(),i=await t.context.core.imageDataService.getOriginal(e);if(!i)return;this.$emit("ui_filterLoading",!0);const n=[],s=t.context.core.pageService.getPage(e);let o;try{o=await t.context.core.processService.resize(i.data,3,i.width,i.height,200)}catch(t){}for(let e=0;e<this.filterList.length;e++){const s=this.filterList[e];if("none"===s.type)n.push({type:"none",imageData:i.data});else{let e;try{var r;o&&null!==(r=o)&&void 0!==r&&r.data&&(e=await t.context.core.filterService.applyFilter({data:o.data,type:cp.JPEG,width:o.width,height:o.height},s.type))}catch(t){e=null}n.push({type:s.type,imageData:e})}}this.$emit("ui_filterLoading",!1),this.$emit("ui_filterReset",{currentFilter:s.filter||"none",filterList:n}),this.filterUpdateStatus=!1}initTemplate(){var t;const e=this.data,{options:i}=e,{popupBox:n,filterHeader:s,filterContent:o,valueList:r}=i,{filterService:a}=this.injection.viewer.context.core,l=QP.Filter_FilterAll+this.injection.viewer.postfix;cA(dA(this),this.injection.viewer,i);const h=(null===(t=fD.getDisplayTextConfig())||void 0===t?void 0:t.Filter_FilterAll)||"Apply to All";e.valueList=r||LI,a.enableFilter&&(e.valueList=a.getSupportedFilters()),this.filterList=e.valueList;const c=`<div ${jP(i,`ddv-button ${this.defaultClass}`)}>`+(Hd(null==i?void 0:i.label)?"":`<span>${i.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${jP(n,this.cssPrefix,"list")}>`+`<div id="${l}"`+`${jP(s,this.cssPrefix,"list-header")}><div></div>`+`<span>${h}</span></div>`+`<div ${jP(o,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=c}async togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let n="none"===e.style.display;n=Hd(t)?!n:!t,n?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e),this.filterUpdateStatus&&this.updateFilterPreview()),lA(this.el,!n),e.style.display=n?"none":""}bindDefaultUi(){const t=this.injection.viewer,e=()=>{let e="normal";0!==t.getPageCounts()&&this.enableFilter||(e="disabled"),pA(this,e)};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na(OI,"cpName","Filter");class BI extends fA{constructor(t){super(t,{class:"ddv-button-blank",callback:()=>{}})}bindDefaultUi(){}}class FI extends fA{constructor(t){super(t,{class:"ddv-button-close",callback:()=>{}})}bindDefaultUi(){}}na(FI,"cpName","Close");class NI extends fA{constructor(t){super(t,{class:"ddv-button-back",callback:()=>{}})}bindDefaultUi(){}}na(NI,"cpName","Back");class UI extends fA{constructor(t){super(t,{class:"ddv-button-done",callback:()=>{}})}bindDefaultUi(){}}na(UI,"cpName","Done");const VI=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class WI extends vA{constructor(t){const{DisplayMode_ContinuousPage:e,DisplayMode_SinglePage:i}=fD.getDisplayTextConfig(),{DisplayMode_ContinuousPage:n,DisplayMode_SinglePage:s}=QP;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"ContinuousPage",label:e,id:n},{type:"SinglePage",label:i,id:s}],defaultClassName:"ddv-display-mode"},super(t),rA(this)}updateUiState(t){const{el:e}=this;VI.forEach(((i,n)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(n)):e.classList.remove(i.className)}))}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{displayMode:e}=t.getViewerConfig();this.updateUiState(e)};t.hooks.displayModeChanged.on((t=>{this.updateUiState(t.newDisplayMode)}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.displayMode)}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na(WI,"cpName","DisplayMode");class HI extends fA{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:e.displayMode})}}),na(this,"displayMode",void 0),this.displayMode=e.displayMode,rA(this)}bindDefaultUi(){const t=this.injection.viewer,e=e=>{var i;const n=t.getActiveTab(),s=(null==e?void 0:e.pageCount)||t.getPageCounts(),o=(null==n||null===(i=n.context)||void 0===i?void 0:i.displayMode)||t.getViewerConfig().displayMode;s?o===this.displayMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}class jI extends HI{constructor(t){super(t,{class:"ddv-continuous-mode",displayMode:"continuous"})}}na(jI,"cpName","ContinuousPage");class zI extends HI{constructor(t){super(t,{class:"ddv-multiple-mode",displayMode:"multiple"})}}na(zI,"cpName","MultiPage");class GI extends HI{constructor(t){super(t,{class:"ddv-single-mode",displayMode:"single"})}}na(GI,"cpName","SinglePage");const YI=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class $I extends vA{constructor(t){const{FitMode_FitWindow:e,FitMode_FitWidth:i,FitMode_FitHeight:n,FitMode_ActualSize:s}=fD.getDisplayTextConfig(),{FitMode_FitWindow:o,FitMode_FitWidth:r,FitMode_FitHeight:a,FitMode_ActualSize:l}=QP;t.data.options={showCheckIcon:!0,showDropDownArrow:!0,...t.data.options,children:[{type:"FitWindow",label:e,id:o},{type:"FitWidth",label:i,id:r},{type:"FitHeight",label:n,id:a},{type:"ActualSize",label:s,id:l}],defaultClassName:"ddv-fit-type"},super(t),rA(this)}updateUiState(t){const{el:e}=this;"none"!==t?YI.forEach(((i,n)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(n)):e.classList.remove(i.className)})):this.selectChildren(-1)}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{fitMode:e}=t.getViewerConfig();this.updateUiState(e)};t.hooks.fitModeChanged.on((t=>{this.updateUiState(t.newFitMode)}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.fitMode)}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}na($I,"cpName","FitMode");class XI extends fA{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;t.updateViewerConfig({fitMode:e.fitMode})}}),na(this,"fitMode",void 0),this.fitMode=e.fitMode,rA(this)}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getActiveTab();let{fitMode:n}=t.getViewerConfig();i&&(n=i.context.fitMode);const s=e>0&&n===this.fitMode;e>0?s?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),t.hooks.fitModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}}class qI extends XI{constructor(t){super(t,{class:"ddv-fit-height",fitMode:"height"})}}na(qI,"cpName","FitHeight");class ZI extends XI{constructor(t){super(t,{class:"ddv-fit-width",fitMode:"width"})}}na(ZI,"cpName","FitWidth");class JI extends XI{constructor(t){super(t,{class:"ddv-fit-window",fitMode:"window"})}}na(JI,"cpName","FitWindow");class KI extends XI{constructor(t){super(t,{class:"ddv-fit-actual",fitMode:"actualSize"})}}na(KI,"cpName","ActualSize");class QI extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks()}bindHooks(){const{inserted:t}=this.hooks;t.on((()=>{var t;null===(t=this.injection.viewer)||void 0===t||t.context.viewService.bindContainer(this.el)}))}initTemplate(){const{options:t}=this.data;t.id=t.id||`ddvMainView${this.injection.viewer.postfix}`;const e=`<div ${jP(t,this.defaultClass,"")} ><slot></slot></div>`;this.template=e}}na(QI,"cpName","MainView");class tD extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-pagination"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"uiState","normal"),na(this,"input",void 0),na(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi()}bindHooks(){this.hooks.created.on((t=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`)}))}bindEvents(){const t=this.injection.viewer,e=this.query(`.${this.cssPrefix}goto`);this.nativeOn(e,"input",(t=>{const i=uA(e),n=Math.min(i,this.totalSpan.clientWidth);e.style.width=`${n}px`})),this.nativeOn(e,"blur",(()=>{const i=t.getPageCounts(),n=t.getCurrentPageIndex();let s=parseInt(e.value,10);qd(s)?s<1?s=1:s>i&&(s=i):s=n+1,e.value=`${s}`,e.style.width=`${uA(e)}px`,t.gotoPage(s-1)})),this.nativeOn(e,"keydown",(t=>{t.stopPropagation(),"Enter"===t.key&&e.blur()}))}setState(t){this.uiState!==t&&this.el&&("normal"===t?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=t)}bindDefaultUi(){const t=this.injection.viewer,e=e=>{const i=Hd(null==e?void 0:e.total)?t.getPageCounts():null==e?void 0:e.total,n=Hd(null==e?void 0:e.current)?t.getCurrentPageIndex():null==e?void 0:e.current;this.setState(i>0?"normal":"disabled"),this.input.value=`${n+1}`,this.totalSpan.innerText=`${i}`,this.input.style.width=`${uA(this.input)}px`};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on((()=>{this.uiState="normal",e(null)}))}initTemplate(){const{options:t}=this.data,{gotoPage:e,total:i,separator:n}=t,{cssPrefix:s,injection:o,defaultClass:r}=this,{viewer:a}=o,l=a.getCurrentPageIndex()+1,h=a.getPageCounts(),c=`<div ${jP(t,r,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${jP(e,s,"goto")} value="${l}" type="number" ><div ${jP(n,s,"separator")}></div><span ${jP(i,s,"total")} >${h}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=c}}na(tD,"cpName","Pagination");class eD extends fA{constructor(t,e){super(t,{class:e.class,callback:e.callback}),na(this,"type",void 0),this.type=e.type}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getCurrentPageIndex();let n=!1;switch(this.type){case"previous":case"first":n=e>0&&0!==i;break;case"last":case"next":n=i<e-1}0===e&&(n=!1),this.setUiState(n?"normal":"disabled")};this.hooks.inserted.on(e),this.hooks.updated.on(e),t.hooks.pageChanged.on(e,this)}}class iD extends eD{constructor(t){super(t,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0)}})}}na(iD,"cpName","FirstPage");class nD extends eD{constructor(t){super(t,{class:"ddv-last-page",type:"last",callback:()=>{const t=this.injection.viewer,e=t.getPageCounts();t.gotoPage(e-1)}})}}na(nD,"cpName","LastPage");class sD extends eD{constructor(t){super(t,{class:"ddv-next-page",type:"next",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e+1)}})}}na(sD,"cpName","NextPage");class oD extends eD{constructor(t){super(t,{class:"ddv-prev-page",type:"previous",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e-1)}})}}na(oD,"cpName","PrevPage");class rD extends fA{constructor(t){super(t,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:t}=this;if(!t)return;const{visibility:e}=t.getViewerConfig();t.updateViewerConfig({visibility:"visible"===e?"hidden":"visible"})}}),na(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",(t=>{if(this.thumbnail)return;const e=this.injection.viewer.context.core.getViewer(t);e&&(this.thumbnail=e,this.bindThumbnailHooks(e));const{visibility:i}=e.getViewerConfig();this.setUiState("visible"===i?"focused":"normal",!Xd())})),this.injection.viewer.hooks.destroy.on((()=>{this.thumbnail=null}),this)}bindThumbnailHooks(t){t.hooks.visibleChanged.on((t=>{this.setUiState("visible"===t.newVisibility?"focused":"normal",!Xd())}),this)}bindDefaultUi(){const t=()=>{if(!this.thumbnail)return;const{visibility:t}=this.thumbnail.getViewerConfig();this.setUiState("visible"===t?"focused":"normal",!Xd())};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.updated.on(t)}}na(rD,"cpName","ThumbnailSwitch");class aD extends fA{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:e.toolMode,canvasStyle:{cursor:e.cursor}})}}),na(this,"toolMode",void 0),this.toolMode=e.toolMode,this.bindViewerHooks()}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();t.getPageCounts()>0?e===this.toolMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}bindViewerHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((e=>{const i=e.newToolMode===this.toolMode;t.getPageCounts()>0?i?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled")}),this)}}class lD extends aD{constructor(t){super(t,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"})}}na(lD,"cpName","Pan"),na(class extends aD{constructor(t){super(t,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"})}},"cpName","ZoomMode");class hD extends aD{constructor(t){super(t,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"})}}na(hD,"cpName","CropMode");class cD extends fA{constructor(t){super(t,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn()}}),this.bindViewerHooks(),rA(this)}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{maxZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio>=i?this.setUiState("disabled"):this.setUiState("normal")}),this)}}na(cD,"cpName","ZoomIn");class dD extends fA{constructor(t){super(t,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut()}}),this.bindViewerHooks(),rA(this)}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{minZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio<=i?this.setUiState("disabled"):this.setUiState("normal")}),this)}}na(dD,"cpName","ZoomOut");class uD extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-zoom-controller"),YP.registerComponent({ZoomIn:cD,ZoomOut:dD}),this.initTemplate()}initTemplate(){const{options:t}=this.data;cA(dA(this),this.injection.viewer,t);const e=`<div ${jP(t,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=e}}na(uD,"cpName","Zoom");const pD=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class gD extends HP{constructor(t){super(t),na(this,"defaultClass","ddv-zoom-percentage"),na(this,"cssPrefix",`${this.defaultClass}-`),na(this,"isFirstClick",!0),na(this,"box",void 0),na(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),rA(this),sA(this),this.hooks.destroyed.on((()=>{this.dispose()}))}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents()})),this.hooks.inserted.on((()=>{const t=this.injection.viewer,{zoom:e}=t.getViewerConfig();this.updateZoom(e),this.updateZoomOption()})),this.hooks.updated.on((()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0}))}bindDefaultUi(){const t=this.injection.viewer,e=()=>{pA(this,0===t.getPageCounts()?"disabled":"normal"),this.updateZoom(t.getViewerConfig().zoom)};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e)}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.zoomChanged.on((t=>{this.updateZoom(t.newZoomRatio)}),this),e.visibleChanged.on((e=>{if("hidden"===e.newVisibility)return void this.togglePopup(!1);const{zoom:i}=t.getViewerConfig();this.updateZoom(i)}),this)}bindEvents(){const{el:t,box:e}=this,i=t.querySelector(`.${this.cssPrefix}selector`),n=t.getElementsByTagName("input")[0],s=e.getElementsByTagName("ul")[0];this.nativeOn(i,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(hA(t,this.el,this.box,!0,!0),this.isFirstClick=!1)})),this.inputEvent(n),this.ulEvent(s)}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:hA(i,this.el,this.box,!0,!0)}),this)}inputEvent(t){const e=this.injection.viewer,{maxZoom:i,minZoom:n}=e.getViewerConfig();t.value=`${i}`;const s=uA(t);function o(){const s=t.value/100,o=Jd(s,n,i);e.updateViewerConfig({zoom:o})}this.nativeOn(t,"input",(()=>{this.adaptInputWidth(s)})),this.nativeOn(t,"blur",o),this.nativeOn(t,"keydown",(t=>{t.stopPropagation(),"Enter"===t.key&&o()}))}ulEvent(t){this.nativeOn(t,"click",(t=>{t.stopPropagation();const{viewer:e}=this.injection,{maxZoom:i,minZoom:n}=e.getViewerConfig(),s=t.target;if("LI"===s.tagName){const t=Jd(s.value,100*n,100*i);e.updateViewerConfig({zoom:t/100})}this.togglePopup(!1)}))}getZoomOptionTemplate(){var t;const e=(null===(t=this.data.options)||void 0===t?void 0:t.valueList)||null,i=this.injection.viewer,{maxZoom:n,minZoom:s}=i.getViewerConfig(),o=Ud(e)?e:pD,r=s<1e-4?.01:parseFloat((100*s).toFixed(2)),a=Math.floor(100*n);o.push(r,a);const l=Array.from(new Set(o)).sort(((t,e)=>t-e));let h="";return l.forEach((t=>{qd(t)&&t<=100*n&&t>=100*s&&(h+=`<li value="${t}">${t}%</li>`)})),h}updateZoomOption(){const t=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t}updateZoom(t){const e=this.el.getElementsByTagName("input")[0],i=100*t;if(Number.isInteger(i))e.value=`${i}`;else{let t=i;t=t>=1e3?+t.toFixed(0).toString():t>=100?+t.toFixed(1).toString():t>=10?+t.toFixed(2).toString():+t.toFixed(3).toString(),e.value=`${t}`}this.adaptInputWidth()}initTemplate(){const{options:t={}}=this.data,{input:e,selector:i,popupBox:n}=t,{cssPrefix:s}=this,{viewer:o}=this.injection;cA(dA(this),o,t);const r=`<div ${jP(t,this.defaultClass)}><div style="display: flex"><div ${jP(e,s,"input")}><input type="number"><span>%</span></div><div ${jP(i,s,"selector")}><i></i></div></div><div ${jP({id:`ddvZoomByPercentageSelectBox${o.postfix}`,...n},s,"selectbox")}><ul></ul></div></div>`;this.template=r}adaptInputWidth(t){const e=this.el.getElementsByTagName("input")[0];let i=uA(e);t&&i>t&&(i=t),e.style.width=`${i}px`}togglePopup(t){const{viewer:e}=this.injection,{box:i}=this;let n="none"!==i.style.display;n=Hd(t)?!n:t,n?(this.$emit("ui_hidePopup",this),e.rootDom.appendChild(i)):i.remove(),i.style.display=n?"":"none"}}na(gD,"cpName","ZoomByPercentage");class fD{static getTooltip(){return this.tooltip}static setTooltip(t){this.tooltip={...this.tooltip,...t}}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(t){this.displayTextConfig={...this.displayTextConfig,...t}}static registerAll(){YP.registerComponent({Capture:aI,Flashlight:lI,CameraConvert:hI,CameraResolution:dI,AutoDetect:rI,AutoCapture:oI,ImagePreview:uI,RotateLeft:II,RotateRight:DI,Delete:xI,DeleteAll:gI,DeleteCurrent:fI,Zoom:uD,ZoomIn:cD,ZoomOut:dD,ZoomByPercentage:gD,PerspectiveAll:_I,FullQuad:TI,Restore:AI,Undo:kI,Redo:EI,FitMode:$I,FitWidth:ZI,FitHeight:qI,FitWindow:JI,ActualSize:KI,DisplayMode:WI,SinglePage:GI,MultiPage:zI,ContinuousPage:jI,Pan:lD,Print:wI,Filter:OI,ThumbnailSwitch:rD,Back:NI,Done:UI,Pagination:tD,FirstPage:iD,LastPage:nD,NextPage:sD,PrevPage:oD,Root:JP,Layout:XP,Button:$P,MainView:QI,Load:pI,Download:yI,Close:FI,Blank:BI,SeparatorLine:KP,CropCurrent:bI,CropAll:SI,CropMode:hD,Crop:RI,AnnotationSet:RA,EllipseAnnotation:wA,EraseAnnotation:bA,InkAnnotation:CA,LineAnnotation:SA,PolygonAnnotation:_A,PolylineAnnotation:TA,RectAnnotation:EA,SelectAnnotation:PA,StampIconAnnotation:AA,StampImageAnnotation:IA,TextBoxAnnotation:DA,TextTypewriterAnnotation:kA,BasePullDownButton:mA,PullDownListButton:vA,PullDownMenuButton:yA,BringForward:OA,BringToFront:BA,SendBackward:FA,SendToBack:NA,AnnotationToolBar:UA,AnnotationDeleteButton:HA,AnnotationPaletteButton:WA,AnnotationPalette:iI,AnnotationCustomStampPanel:sI})}}na(fD,"tooltip",{}),na(fD,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const mD={install(t){const e=function(t){var e,i,n,s;return e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakSet,class extends t{constructor(t){super(t),va(this,s),na(this,"ui",void 0),na(this,"rootDom",void 0),ma(this,e,{writable:!0,value:!1}),ma(this,i,{writable:!0,value:0}),ma(this,n,{writable:!0,value:0}),fD.registerAll();const o=t.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==t?void 0:t.annotationToolBarConfig)||{},annotationPaletteConfig:(null==t?void 0:t.annotationPaletteConfig)||{},annotationCustomStampPanelConfig:(null==t?void 0:t.annotationCustomStampPanelConfig)||{}}):[];this.ui=new YP({container:t.container,emitter:this.emitter,postfix:this.uid,uiConfig:t.uiConfig,popupUiConfig:o,injection:{viewer:this}}),t.container&&(t.uiConfig?(this.bindContainer(t.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi()}listenNativeEventsForUi(){this.on("click",(()=>{this.emit("ui_hidePopup","viewer")}))}getPopupUiConfig(t){const e={enabled:!0,isPaletteEnabled:!0,...t.annotationToolBarConfig,type:"AnnotationToolBar"},i={enabled:!0,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0,autoDisplay:!0,enableCustomStamp:!1,...t.annotationPaletteConfig,type:"AnnotationPalette"},n={labels:{stampText:"Stamp Text",fontStyle:"Font Style",textColor:"TextColor",backgroundColor:"Background",borderColor:"BorderColor",timeStampText:"Timestamp Text",userName:"Username",date:"Date",time:"Time",create:"Create"},colorList:["#fdcccc","#f7fc7b","#c7d2e4","#d6e4cd","#910f05","#d5b142","#182564","#416a1c","#ffffff","#000000"],enabled:!1,autoDisplay:!0,...t.annotationCustomStampPanelConfig,type:"AnnotationCustomStampPanel"},s=[];return s.push(n),e.enabled&&s.push(e),i.enabled?s.push(i):e.isPaletteEnabled=!1,n.enabled&&s.push(n),s}addFontToUi(t){this.emit("ui_addFont",t)}toggleUiPopup(t,e){this.ui.emit("ui_changePalette_visible",t,e)}getUiConfig(){return Wd(this.ui.uiConfig)}updateUiConfig(t){const{resizeService:i}=this.context.core;i&&(i.unobserve(this.ui.rootDom),oa(this,e,!1));const n=this.ui.updateUiConfig(t);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,ga(this,s,o).call(this,this.ui.rootDom),n}getElementsByType(t){return Zd(t)?this.ui.getElementsByType(this.ui.rootVNode,t):""}bindContainer(t){let e=t;return Zd(t)&&(e=document.querySelector(`#${t}`)),e instanceof HTMLElement&&(ga(this,s,o).call(this,this.ui.rootDom),this.ui.bindContainer(e),this.context.viewService.container=e,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1)}dispose(){var t;super.dispose(),null===(t=this.ui)||void 0===t||t.dispose()}};function o(t){if(sa(this,e))return;const{resizeService:s}=this.context.core;s.observe(t),this.register(s.onResizeObserver.on((e=>{if(e.target===t){var s;let o=0,r=0;if((null===(s=e.borderBoxSize)||void 0===s?void 0:s.length)>0){const t=e.borderBoxSize[0];o=t.inlineSize,r=t.blockSize}else o=t.offsetWidth,r=t.offsetHeight;const a=YC.create(sa(this,i),sa(this,n),o,r);oa(this,i,o),oa(this,n,r),this.hooks.resize.emit(a),this.emit("resized",{oldWidth:a.oldWidth,oldHeight:a.oldHeight,newWidth:a.newWidth,newHeight:a.newHeight})}}))),this.hooks.destroy.on((()=>{s.unobserve(t)})),oa(this,e,!0)}}(t.getClass("Viewer"));t.setClass("Viewer",e)}};function vD(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function yD(t,e,i,n,s){if("function"==typeof e||!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError;const xD="undefined"==typeof self;let wD,bD,CD,SD,_D;function TD(t,e,i,n){if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function ED(t,e,i,n,s){if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s?s.value=i:e.set(t,i),i}"undefined"!=typeof navigator&&(wD=navigator,bD=wD.userAgent,CD=wD.platform,SD=wD.mediaDevices),function(){if(!xD){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:wD.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:CD,search:"Win"},Mac:{str:CD},Linux:{str:CD}};let i="unknownBrowser",n=0,s="unknownOS";for(let e in t){const s=t[e]||{};let o=s.str||bD,r=s.search||e,a=s.verStr||bD,l=s.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){n=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let n=i.str||bD,o=i.search||t;if(-1!=n.indexOf(o)){s=t;break}}"Linux"==s&&-1!=bD.indexOf("Windows NT")&&(s="HarmonyOS"),_D={browser:i,version:n,OS:s}}xD&&(_D={browser:"ssr",version:0,OS:"ssr"})}(),SD&&SD.getUserMedia,"Chrome"===_D.browser&&_D.version>66||"Safari"===_D.browser&&_D.version>13||"OPR"===_D.browser&&_D.version>43||"Edge"===_D.browser&&_D.version,"function"==typeof SuppressedError&&SuppressedError;class PD{static multiply(t,e){const i=[];for(let n=0;n<3;n++){const s=e.slice(3*n,3*n+3);for(let e=0;e<3;e++){const n=[t[e],t[e+3],t[e+6]].reduce(((t,e,i)=>t+e*s[i]),0);i.push(n)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(t,e,i){return PD.multiply(t,[1,0,0,0,1,0,e,i,1])}static rotate(t,e){var i=Math.cos(e),n=Math.sin(e);return PD.multiply(t,[i,-n,0,n,i,0,0,0,1])}static scale(t,e,i){return PD.multiply(t,[e,0,0,0,i,0,0,0,1])}}var AD,ID,DD,kD,RD,MD,LD,OD,BD,FD,ND,UD,VD,WD,HD,jD,zD,GD,YD,$D,XD,qD,ZD,JD,KD,QD,tk,ek,ik,nk,sk,ok,rk,ak,lk,hk,ck,dk,uk,pk,gk,fk,mk,vk,yk,xk,wk,bk,Ck,Sk,_k,Tk;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(AD||(AD={}));class Ek{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(ED(Ek,ID,!1,0,DD),!1):(ED(Ek,ID,!0,0,DD),!0)}get disposed(){return TD(this,BD,"f")}constructor(){kD.set(this,AD.RGBA),RD.set(this,null),MD.set(this,null),LD.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,OD.set(this,null),BD.set(this,!1)}drawImage(t,e,i,n,s,o){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!n)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==TD(Ek,ID,"f",DD)&&Ek.checkWebGLSupport(),(null==o?void 0:o.bUseWebGL)&&!TD(Ek,ID,"f",DD))throw new Error("Your browser or machine may not support WebGL.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let r;Ek._onLog&&(r=Date.now(),Ek._onLog("drawImage(), START: "+r));let a=0,l=0,h=i,c=n,d=0,u=0,p=i,g=n;s&&(s.sx&&(a=Math.round(s.sx)),s.sy&&(l=Math.round(s.sy)),s.sWidth&&(h=Math.round(s.sWidth)),s.sHeight&&(c=Math.round(s.sHeight)),s.dx&&(d=Math.round(s.dx)),s.dy&&(u=Math.round(s.dy)),s.dWidth&&(p=Math.round(s.dWidth)),s.dHeight&&(g=Math.round(s.dHeight)));let f,m=AD.RGBA;if((null==o?void 0:o.pixelFormat)&&(m=o.pixelFormat),(null==o?void 0:o.bufferContainer)&&(f=o.bufferContainer,f.length<4*p*g))throw new Error("Unexpected size of the 'bufferContainer'.");const v=t;if(!TD(Ek,ID,"f",DD)||!(this.useWebGLByDefault&&null==(null==o?void 0:o.bUseWebGL)||(null==o?void 0:o.bUseWebGL))){Ek._onLog&&Ek._onLog("drawImage() in context2d."),v.ctx2d||(v.ctx2d=v.getContext("2d",{willReadFrequently:!0}));const t=v.ctx2d;if(!t)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(v.width<d+p||v.height<u+g)&&(v.width=d+p,v.height=u+g),t.drawImage(e,a,l,h,c,d,u,p,g),Ek._onLog&&Ek._onLog("drawImage() in context2d end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:AD.RGBA,bUseWebGL:!1}}Ek._onLog&&Ek._onLog("drawImage() in WebGL.");try{(v.width<d+p||v.height<u+g)&&(v.width=d+p,v.height=u+g,v.ctxWebGL&&v.ctxWebGL.viewport(0,0,d+p,u+g));const t=v.ctxWebGL||v.getContext("webgl",{antialias:!1})||v.getContext("experimental-webgl",{antialias:!1});if(!t){Ek._onLog&&Ek._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const t=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw t.name="WebGLError",t}if(!v.ctxWebGL||m!==TD(this,kD,"f")){v.ctxWebGL=t;const e=t=>{const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW),{positions:e,texCoords:i}},i=t=>{const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},n=(t,e)=>{const i=t.createProgram();if(e.forEach((e=>t.attachShader(i,e))),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=new Error(`An error occured linking the program: ${t.getProgramInfoLog(i)}.`);throw e.name="WebGLError",e}return t.useProgram(i),i},s=(t,e,i)=>{const n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=new Error(`An error occured compiling the shader: ${t.getShaderInfoLog(n)}.`);throw e.name="WebGLError",e}return n},o="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(r=m.slice(0,3));const a=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,l=n(t,[s(t,t.VERTEX_SHADER,o),s(t,t.FRAGMENT_SHADER,a)]);ED(this,MD,{program:l,attribLocations:{vertexPosition:t.getAttribLocation(l,"a_position"),texPosition:t.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:t.getUniformLocation(l,"u_image"),uColorFactor:t.getUniformLocation(l,"uColorFactor"),uMatrix:t.getUniformLocation(l,"u_matrix"),uTextureMatrix:t.getUniformLocation(l,"u_textureMatrix")}}),ED(this,LD,e(t)),ED(this,RD,i(t)),ED(this,kD,m)}const s=(t,e,i)=>{t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0)},o=(t,e,i)=>{const n=t.RGBA,s=t.RGBA,o=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n,s,o,i)},y=(t,e,o,r)=>{t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),s(t,o.positions,e.attribLocations.vertexPosition),s(t,o.texCoords,e.attribLocations.texPosition),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.uniform1i(e.uniformLocations.uSampler,0),t.uniform1f(e.uniformLocations.uColorFactor,[AD.GREY,AD.GREY32].includes(m)?1:0);let f,v,y=PD.translate(PD.identity(),-1,-1);y=PD.scale(y,2,2),y=PD.scale(y,1/t.canvas.width,1/t.canvas.height),f=PD.translate(y,d,u),f=PD.scale(f,p,g),t.uniformMatrix3fv(e.uniformLocations.uMatrix,!1,f),v=PD.translate(PD.identity(),a/i,l/n),v=PD.scale(v,h/i,c/n),t.uniformMatrix3fv(e.uniformLocations.uTextureMatrix,!1,v),t.drawArrays(t.TRIANGLES,0,6)};o(t,TD(this,RD,"f"),e),y(t,TD(this,MD,"f"),TD(this,LD,"f"),TD(this,RD,"f"));const x=f||new Uint8Array(4*p*g);if(t.readPixels(d,u,p,g,t.RGBA,t.UNSIGNED_BYTE,x),255!==x[3]){Ek._onLog&&Ek._onLog("Incorrect WebGL drawing .");const t=new Error("WebGL error: incorrect drawing.");throw t.name="WebGLError",t}return Ek._onLog&&Ek._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:m===AD.GREY?AD.GREY32:m,bUseWebGL:!0}}catch(r){if(this.forceLoseContext(),null==(null==o?void 0:o.bUseWebGL))return Ek._onLog&&Ek._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,e,i,n,s,Object.assign({},o,{bUseWebGL:!1}));throw r.name="WebGLError",r}}readCvsData(t,e,i){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let n,s=0,o=0,r=t.canvas.width,a=t.canvas.height;if(e&&(e.x&&(s=e.x),e.y&&(o=e.y),e.width&&(r=e.width),e.height&&(a=e.height)),(null==i?void 0:i.length)<4*r*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const e=t;i?(e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,4*r*a)):(n=new Uint8Array(4*r*a),e.readPixels(s,o,r,a,e.RGBA,e.UNSIGNED_BYTE,n))}else if(t instanceof CanvasRenderingContext2D){let e;e=t.getImageData(s,o,r,a),n=new Uint8Array(e.data.buffer),null==i||i.set(n)}return n}transformPixelFormat(t,e,i,n){let s,o;if(Ek._onLog&&(s=Date.now(),Ek._onLog("transformPixelFormat(), START: "+s)),e===i)return Ek._onLog&&Ek._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),n?new Uint8Array(t):t;const r=[AD.RGBA,AD.RBGA,AD.GRBA,AD.GBRA,AD.BRGA,AD.BGRA];if(r.includes(e))if(i===AD.GREY){o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e/4]=i}}else if(i===AD.GREY32){o=n?new Uint8Array(t):t;for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e]=i,o[e+1]=i,o[e+2]=i}}else{if(!r.includes(i))throw new Error("Unable to transform.");if(n){o=new Uint8Array(t);const n=e.indexOf("r"),s=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4)o[e+a]=t[e+n],o[e+l]=t[e+s],o[e+h]=t[e+r]}else{o=t;const n=e.indexOf("r"),s=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4){let i=[t[e],t[e+1],t[e+2]];o[e+a]=i[n],o[e+l]=i[s],o[e+h]=i[r]}}}else if(e===AD.GREY){if(i!==AD.GREY32)throw new Error("Unable to transform.");o=new Uint8Array(4*t.length);for(let e=0;e<t.length;e++)o[4*e]=t[e],o[4*e+1]=t[e],o[4*e+2]=t[e],o[4*e+3]=255}else{if(e!==AD.GREY32)throw new Error("Unable to transform.");if(i!==AD.GREY)throw new Error("Unable to transform.");o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4)o[e/4]=t[e]}return Ek._onLog&&Ek._onLog("transformPixelFormat() end. Costs: "+(Date.now()-s)),o}getImageData(t,e,i,n,s){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!e||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==TD(Ek,ID,"f",DD)&&Ek.checkWebGLSupport(),(null==s?void 0:s.bUseWebGL)&&!TD(Ek,ID,"f",DD))throw new Error("Your browser or machine may not support WebGL.");if(n.sx>e||n.sy>i||n.sx+n.sWidth>e||n.sy+n.sHeight>i)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let o;Ek._onLog&&(o=Date.now(),Ek._onLog("getImageData(), START: "+o));const r=Math.round(n.sx),a=Math.round(n.sy),l=Math.round(n.sWidth),h=Math.round(n.sHeight),c=Math.round(n.dWidth),d=Math.round(n.dHeight);let u=AD.RGBA;(null==s?void 0:s.pixelFormat)&&(u=s.pixelFormat);let p,g,f,m=null;if((null==s?void 0:s.bufferContainer)&&(m=s.bufferContainer),TD(Ek,ID,"f",DD)&&(this.useWebGLByDefault&&null==(null==s?void 0:s.bUseWebGL)||(null==s?void 0:s.bUseWebGL))){Ek._onLog&&Ek._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),p=this._reusedWebGLCvs;try{if(m)if(u===AD.GREY){if(f=new Uint8Array(4*c*d),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u),m){if(m.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(f)}}else g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:m}),f=new Uint8Array(m.buffer,0,4*c*d),f=this.transformPixelFormat(f,g.pixelFormat,u);else u===AD.GREY?((!TD(this,OD,"f")||TD(this,OD,"f").length<4*c*d)&&ED(this,OD,new Uint8Array(4*c*d)),f=new Uint8Array(TD(this,OD,"f").buffer,0,4*c*d)):f=new Uint8Array(4*c*d),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u)}catch(n){if("WebGLError"===n.name&&(this.forceLoseContext(),null==(null==s?void 0:s.bUseWebGL)))return Ek._onLog&&Ek._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},Object.assign({},s,{bUseWebGL:!1}));throw n}}else if(Ek._onLog&&Ek._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),p=this._reusedCvs,g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:AD.RGBA,bUseWebGL:!1}),f=this.readCvsData(g.context,{width:c,height:d},null),f=this.transformPixelFormat(f,g.pixelFormat,u),m){if(m.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(f)}return Ek._onLog&&Ek._onLog("getImageData() end. Costs: "+(Date.now()-o)),{data:f,pixelFormat:u,width:c,height:d,bUseWebGL:g.bUseWebGL}}convertDataToCvs(t,e,i,n){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof e||e<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const s=document.createElement("canvas");let o;if(s.width=e,s.height=i,n===AD.GREY){o=new Uint8ClampedArray(4*e*i);for(let e=0;e<o.length;e+=4)o[e]=t[e/4],o[e+1]=t[e/4],o[e+2]=t[e/4],o[e+3]=255}else o=new Uint8ClampedArray(t.buffer);const r=new ImageData(o,e,i);return s.getContext("2d").putImageData(r,0,0),s}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),ED(this,RD,null),ED(this,MD,null),ED(this,LD,null),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),ED(this,BD,!0)}}ID=Ek,kD=new WeakMap,RD=new WeakMap,MD=new WeakMap,LD=new WeakMap,OD=new WeakMap,BD=new WeakMap,DD={value:void 0};class Pk{constructor(){FD.set(this,new Map),ND.set(this,!1)}get disposed(){return vD(this,ND,"f")}on(t,e){t=t.toLowerCase();const i=vD(this,FD,"f").get(t);if(i){if(i.includes(e))return;i.push(e)}else vD(this,FD,"f").set(t,[e])}off(t,e){t=t.toLowerCase();const i=vD(this,FD,"f").get(t);if(!i)return;const n=i.indexOf(e);-1!==n&&i.splice(n,1)}offAll(t){t=t.toLowerCase();const e=vD(this,FD,"f").get(t);e&&(e.length=0)}fire(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};e||(e=[]),t=t.toLowerCase();const n=vD(this,FD,"f").get(t);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let s of n){if(!s)continue;let o=[];if(i.copy)for(let i of e){try{i=JSON.parse(JSON.stringify(i))}catch(t){}o.push(i)}else o=e;let r=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(s)&&s.apply(i.target,o)}),0);else try{r=s.apply(i.target,o)}catch(t){}if(!0===r)break}}}dispose(){yD(this,ND,!0)}}FD=new WeakMap,ND=new WeakMap;const Ak=(t,e,i,n)=>{if(!i)return t;let s=e+Math.round((t-e)/i)*i;return n&&(s=Math.min(s,n)),s};class Ik{static get version(){return"2.0.12"}static isStorageAvailable(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}static findBestRearCameraInIOS(t,e){if(!t||!t.length)return null;let i=!1;if((null==e?void 0:e.getMainCamera)&&(i=!0),i){const e=[" ","","","",""," "," "," ","   "," "," "," "," ","zadn fotoapart","zadn kamera","tylny aparat","takakamera","stranja kamera","rckkamera","kamera p baksidan","kamera belakang","kamera bak","hts kamera","fotocamera (posteriore)","cmera traseira","cmara traseira","cmara trasera","cmera posterior","camra arrire","camer spate","camera mt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=t.find((t=>e.includes(t.label.toLowerCase())));return null==i?void 0:i.deviceId}{const e=["","","","","","","","","","","","","zadn","zadn","tylny","trasera","traseira","taka","stranja","spate","sau","rck","posteriore","posterior","hts","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"],i=["","","","","","","","","","","","","","l","trjobiektywowy","trostruka","trojn","trojit","trippelt","trippel","tripl","triple","tripla","tiga","kolmois","ba camera"],n=[" ","","","",""," "," "," ","  "," "," "," "," ","ift geni","laajakulmainen kaksois","kp rng mt sau","ketts, szles ltszg","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka iroka","duln irokohl","dulna irokouhl","dupla grande-angular","dubl","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],s=t.filter((t=>{const i=t.label.toLowerCase();return e.some((t=>i.includes(t)))}));if(!s.length)return null;const o=s.find((t=>{const e=t.label.toLowerCase();return i.some((t=>e.includes(t)))}));if(o)return o.deviceId;const r=s.find((t=>{const e=t.label.toLowerCase();return n.some((t=>e.includes(t)))}));return r?r.deviceId:s[0].deviceId}}static findBestRearCamera(t,e){if(!t||!t.length)return null;if(["iPhone","iPad","Mac"].includes(_D.OS))return Ik.findBestRearCameraInIOS(t,{getMainCamera:null==e?void 0:e.getMainCameraInIOS});const i=["","","","","","","","","","","","","","","","","","zadn","zadn","tylny","trs","trasera","traseira","taka","stranja","spate","sau","rck","rear","posteriore","posterior","hts","darrere","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"];for(let e of t){const t=e.label.toLowerCase();if(t&&i.some((e=>t.includes(e)))&&/\b0(\b)?/.test(t))return e.deviceId}return["Android","HarmonyOS"].includes(_D.OS)?t[t.length-1].deviceId:null}static findBestCamera(t,e,i){return t&&t.length?"environment"===e?this.findBestRearCamera(t,i):"user"===e?null:e?void 0:null:null}static async playVideo(t,e,i){if(!t)throw new Error("Invalid 'videoEl'.");if(!e)throw new Error("Invalid 'source'.");return new Promise((async(n,s)=>{let o;const r=()=>{t.removeEventListener("loadstart",c),t.removeEventListener("abort",d),t.removeEventListener("play",u),t.removeEventListener("error",p),t.removeEventListener("loadedmetadata",m)};let a=!1;const l=()=>{a=!0,o&&clearTimeout(o),r(),n(t)},h=t=>{o&&clearTimeout(o),r(),s(t)},c=()=>{t.addEventListener("abort",d,{once:!0})},d=()=>{const t=new Error("Video playing was interrupted.");t.name="AbortError",h(t)},u=()=>{l()},p=()=>{h(new Error(`Video error ${t.error.code}: ${t.error.message}.`))};let g;const f=new Promise((t=>{g=t})),m=()=>{g()};if(t.addEventListener("loadstart",c,{once:!0}),t.addEventListener("play",u,{once:!0}),t.addEventListener("error",p,{once:!0}),t.addEventListener("loadedmetadata",m,{once:!0}),"string"==typeof e||e instanceof String?t.src=e:t.srcObject=e,t.autoplay&&await new Promise((t=>{setTimeout(t,1e3)})),!a){i&&(o=setTimeout((()=>{r(),s(new Error("Failed to play video. Timeout."))}),i));try{t.src&&await t.load(),await t.play(),l()}catch(t){}if(!a){await f;try{await t.play(),l()}catch(t){h(t)}}}}))}static async testCameraAccess(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let n;try{n=t?await navigator.mediaDevices.getUserMedia(t):await navigator.mediaDevices.getUserMedia({video:!0})}catch(t){return{ok:!1,errorName:t.name,errorMessage:t.message}}finally{null==n||n.getTracks().forEach((t=>{t.stop()}))}return{ok:!0}}get state(){if(!vD(this,KD,"f"))return"closed";if("pending"===vD(this,KD,"f"))return"opening";if("fulfilled"===vD(this,KD,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(t){t&&Ik.isStorageAvailable("localStorage")?yD(this,XD,!0):yD(this,XD,!1)}get ifSaveLastUsedCamera(){return vD(this,XD,"f")}get isVideoPlaying(){return!(!vD(this,WD,"f")||vD(this,WD,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(t){var e,i,n;if(!(t instanceof HTMLElement)&&null!=t)throw new TypeError("Invalid 'element'.");null===(e=vD(this,sk,"f"))||void 0===e||e.removeEventListener("click",vD(this,nk,"f")),null===(i=vD(this,sk,"f"))||void 0===i||i.removeEventListener("touchend",vD(this,nk,"f")),null===(n=vD(this,sk,"f"))||void 0===n||n.removeEventListener("touchmove",vD(this,ik,"f")),yD(this,sk,t),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(_D.OS)?(t.addEventListener("touchend",vD(this,nk,"f")),t.addEventListener("touchmove",vD(this,ik,"f"))):t.addEventListener("click",vD(this,nk,"f")))}get tapFocusEventBoundEl(){return vD(this,sk,"f")}get disposed(){return vD(this,pk,"f")}constructor(t){var e,i;VD.add(this),WD.set(this,null),HD.set(this,void 0),jD.set(this,(()=>{"opened"===this.state&&vD(this,lk,"f").fire("resumed",null,{target:this,async:!1})})),zD.set(this,(()=>{vD(this,lk,"f").fire("paused",null,{target:this,async:!1})})),GD.set(this,void 0),YD.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],$D.set(this,void 0),XD.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,qD.set(this,void 0),ZD.set(this,!0),JD.set(this,void 0),KD.set(this,void 0),QD.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},tk.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(t,e)=>{let i,n;const s=window.getComputedStyle(vD(this,WD,"f")).objectFit,o=this.getResolution(),r=vD(this,WD,"f").getBoundingClientRect(),a=r.left,l=r.top,{width:h,height:c}=vD(this,WD,"f").getBoundingClientRect();if(h<=0||c<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const d=h/c,u=o.width/o.height;let p=1;if("contain"===s)u>d?(p=h/o.width,i=(t-a)/p,n=(e-l-(c-h/u)/2)/p):(p=c/o.height,n=(e-l)/p,i=(t-a-(h-c*u)/2)/p);else{if("cover"!==s)throw new Error("Unsupported object-fit.");u>d?(p=c/o.height,n=(e-l)/p,i=(t-a+(c*u-h)/2)/p):(p=h/o.width,i=(t-a)/p,n=(e-l+(h/u-c)/2)/p)}return{x:i,y:n}},ek.set(this,!1),ik.set(this,(()=>{yD(this,ek,!0)})),nk.set(this,(async t=>{var e;if(vD(this,ek,"f"))return void yD(this,ek,!1);if(!vD(this,tk,"f"))return;if(!this.isVideoPlaying)return;if(!vD(this,HD,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(e=this.getCameraCapabilities())||void 0===e?void 0:e.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,n;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),t instanceof MouseEvent)i=t.clientX,n=t.clientY;else{if(!(t instanceof TouchEvent))throw new Error("Unknown event type.");if(!t.changedTouches.length)return;i=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY}const s=this.getResolution(),o=2*Math.round(Math.min(s.width,s.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let r;try{r=this.calculateCoordInVideo(i,n)}catch(t){}if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return;const a={x:r.x+"px",y:r.y+"px"},l=o+"px",h=l;let c;Ik._onLog&&(c=Date.now());try{await vD(this,VD,"m",Sk).call(this,a,l,h,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(t){if(Ik._onLog)throw Ik._onLog(t),t}Ik._onLog&&Ik._onLog(`Tap focus costs: ${Date.now()-c} ms`),this._focusParameters.taskBackToContinous=setTimeout((()=>{var t;Ik._onLog&&Ik._onLog("Back to continuous focus."),null===(t=vD(this,HD,"f"))||void 0===t||t.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}))}),this._focusParameters.focusBackToContinousTime),vD(this,lk,"f").fire("tapfocus",null,{target:this,async:!1})})),sk.set(this,null),ok.set(this,1),rk.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!vD(this,WD,"f"))return;const t=vD(this,ok,"f");if(t<1)throw new RangeError("Invalid scale value.");if(1===t)vD(this,WD,"f").style.transform="";else{const e=window.getComputedStyle(vD(this,WD,"f")).objectFit,i=vD(this,WD,"f").videoWidth,n=vD(this,WD,"f").videoHeight,{width:s,height:o}=vD(this,WD,"f").getBoundingClientRect();if(s<=0||o<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const r=s/o,a=i/n;let l=1;"contain"===e?l=r<a?s/(i/t):o/(n/t):"cover"===e&&(l=a>r?o/(i/t):s/(n/t));const h=l*(1-1/t)*(i/2-vD(this,rk,"f").x),c=l*(1-1/t)*(n/2-vD(this,rk,"f").y);vD(this,WD,"f").style.transform=`translate(${h}px, ${c}px) scale(${t})`}},ak.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const t=document.createElement("canvas");let e;if(t.width=this.width,t.height=this.height,this.pixelFormat===AD.GREY){e=new Uint8ClampedArray(this.width*this.height*4);for(let t=0;t<e.length;t+=4)e[t]=this.data[t/4],e[t+1]=this.data[t/4],e[t+2]=this.data[t/4],e[t+3]=255}else e=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(e,this.width,this.height);return t.getContext("2d").putImageData(i,0,0),t})),lk.set(this,void 0),hk.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],ck.set(this,new Map),dk.set(this,!1),uk.set(this,(async()=>{var t,e;if("visible"===document.visibilityState){if(Ik._onLog&&Ik._onLog("document visible. video paused: "+(null===(t=vD(this,WD,"f"))||void 0===t?void 0:t.paused)),"opening"==this.state||"opened"==this.state){let e=!1;if(!this.isVideoPlaying){Ik._onLog&&Ik._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),e=!0}catch(t){Ik._onLog&&Ik._onLog("document visible. 1st resume video failed, try open instead.")}e||await vD(this,VD,"m",yk).call(this)}if(await new Promise((t=>setTimeout(t,300))),!this.isVideoPlaying){Ik._onLog&&Ik._onLog("document visible. 1st open failed. 2rd resume start."),e=!1;try{await this.resume(),e=!0}catch(t){Ik._onLog&&Ik._onLog("document visible. 2rd resume video failed, try open instead.")}e||await vD(this,VD,"m",yk).call(this)}}}else"hidden"===document.visibilityState&&(Ik._onLog&&Ik._onLog("document hidden. video paused: "+(null===(e=vD(this,WD,"f"))||void 0===e?void 0:e.paused)),"opening"==this.state||"opened"==this.state&&this.isVideoPlaying&&this.pause())})),pk.set(this,!1),(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{Ik.onWarning&&Ik.onWarning("The browser is too old or the page is loaded from an insecure origin.")}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),t instanceof HTMLVideoElement&&this.setVideoEl(t),yD(this,lk,new Pk),this.imageDataGetter=new Ek,document.addEventListener("visibilitychange",vD(this,uk,"f"))}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",vD(this,jD,"f")),t.addEventListener("pause",vD(this,zD,"f")),yD(this,WD,t)}getVideoEl(){return vD(this,WD,"f")}releaseVideoEl(){var t,e;null===(t=vD(this,WD,"f"))||void 0===t||t.removeEventListener("play",vD(this,jD,"f")),null===(e=vD(this,WD,"f"))||void 0===e||e.removeEventListener("pause",vD(this,zD,"f")),yD(this,WD,null)}isVideoLoaded(){return!!vD(this,WD,"f")&&4==vD(this,WD,"f").readyState}async open(){if(vD(this,JD,"f")&&!vD(this,ZD,"f")){if("pending"===vD(this,KD,"f"))return vD(this,JD,"f");if("fulfilled"===vD(this,KD,"f"))return}vD(this,lk,"f").fire("before:open",null,{target:this}),await vD(this,VD,"m",yk).call(this),vD(this,lk,"f").fire("played",null,{target:this,async:!1}),vD(this,lk,"f").fire("opened",null,{target:this,async:!1})}async close(){if("closed"===this.state)return;vD(this,lk,"f").fire("before:close",null,{target:this});const t=vD(this,JD,"f");if(vD(this,VD,"m",wk).call(this),t&&"pending"===vD(this,KD,"f")){try{await t}catch(t){}if(!1===vD(this,ZD,"f")){const t=new Error("'close()' was interrupted.");throw t.name="AbortError",t}}yD(this,JD,null),yD(this,KD,null),vD(this,lk,"f").fire("closed",null,{target:this,async:!1})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");vD(this,WD,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await vD(this,WD,"f").play()}async setCamera(t){if("string"!=typeof t)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof vD(this,GD,"f").video&&(vD(this,GD,"f").video={}),delete vD(this,GD,"f").video.facingMode,vD(this,GD,"f").video.deviceId={exact:t},!("closed"===this.state||this.videoSrc||"opening"===this.state&&vD(this,ZD,"f"))){vD(this,lk,"f").fire("before:camera:change",[],{target:this,async:!1}),await vD(this,VD,"m",xk).call(this);try{this.resetSoftwareScale()}catch(t){}return vD(this,YD,"f")}}async switchToFrontCamera(t){if("object"!=typeof vD(this,GD,"f").video&&(vD(this,GD,"f").video={}),(null==t?void 0:t.resolution)&&(vD(this,GD,"f").video.width={ideal:t.resolution.width},vD(this,GD,"f").video.height={ideal:t.resolution.height}),delete vD(this,GD,"f").video.deviceId,vD(this,GD,"f").video.facingMode={exact:"user"},yD(this,$D,null),!("closed"===this.state||this.videoSrc||"opening"===this.state&&vD(this,ZD,"f"))){vD(this,lk,"f").fire("before:camera:change",[],{target:this,async:!1}),vD(this,VD,"m",xk).call(this);try{this.resetSoftwareScale()}catch(t){}return vD(this,YD,"f")}}getCamera(){var t;if(vD(this,YD,"f"))return vD(this,YD,"f");{let e=(null===(t=vD(this,GD,"f").video)||void 0===t?void 0:t.deviceId)||"";if(e){e=e.exact||e.ideal||e;for(let t of this._arrCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;if(t){let t=await navigator.mediaDevices.getUserMedia({video:!0});n=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind)),t.getTracks().forEach((t=>{t.stop()}))}else n=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));const s=[],o=[];if(this._arrCameras)for(let t of this._arrCameras)t._checked&&o.push(t);for(let t=0;t<n.length;t++){let e,i=n[t];for(let t of o)if(i.deviceId==t.deviceId){e=t;break}e||(e={deviceId:i.deviceId,label:i.label?i.label:"camera "+t,_checked:!1}),e.deviceId&&s.push(e)}return this._arrCameras=s,Ik._onLog&&Ik._onLog(JSON.stringify(this._arrCameras)),s}async getCameras(){var t,e;if(!(null===(e=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===e?void 0:e.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(t,e,i){if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof vD(this,GD,"f").video&&(vD(this,GD,"f").video={}),i?(vD(this,GD,"f").video.width={exact:t},vD(this,GD,"f").video.height={exact:e}):(vD(this,GD,"f").video.width={ideal:t},vD(this,GD,"f").video.height={ideal:e}),"closed"===this.state||this.videoSrc||"opening"===this.state&&vD(this,ZD,"f"))return null;vD(this,lk,"f").fire("before:resolution:change",[],{target:this,async:!1}),await vD(this,VD,"m",xk).call(this);try{this.resetSoftwareScale()}catch(t){}const n=this.getResolution();return{width:n.width,height:n.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&vD(this,WD,"f"))return{width:vD(this,WD,"f").videoWidth,height:vD(this,WD,"f").videoHeight};if(vD(this,HD,"f")){const t=vD(this,HD,"f").getSettings();return{width:t.width,height:t.height}}if(this.isVideoLoaded())return{width:vD(this,WD,"f").videoWidth,height:vD(this,WD,"f").videoHeight};{const t={width:0,height:0};let e=vD(this,GD,"f").video.width||0,i=vD(this,GD,"f").video.height||0;return e&&(t.width=e.exact||e.ideal||e),i&&(t.height=i.exact||i.ideal||i),t}}async getResolutions(t){var e,i,n,s,o,r,a,l,h,c,d;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let u="";const p=(t,e)=>{const i=vD(this,ck,"f").get(t);if(!i||!i.length)return!1;for(let t of i)if(t.width===e.width&&t.height===e.height)return!0;return!1};if(this._mediaStream){u=null===(d=vD(this,YD,"f"))||void 0===d?void 0:d.deviceId;let e=vD(this,ck,"f").get(u);if(e&&!t)return JSON.parse(JSON.stringify(e));e=[],vD(this,ck,"f").set(u,e),yD(this,QD,!0);try{for(let t of this.detectedResolutions){await vD(this,HD,"f").applyConstraints({width:{ideal:t.width},height:{ideal:t.height}}),vD(this,VD,"m",fk).call(this);const i=vD(this,HD,"f").getSettings(),n={width:i.width,height:i.height};p(u,n)||e.push({width:n.width,height:n.height})}}catch(t){throw vD(this,VD,"m",wk).call(this),yD(this,QD,!1),t}try{await vD(this,VD,"m",yk).call(this)}catch(t){if("AbortError"===t.name)return e;throw t}finally{yD(this,QD,!1)}return e}{const e=async(t,e,i)=>{const n={video:{deviceId:{exact:t},width:{ideal:e},height:{ideal:i}}};let s=null;try{s=await navigator.mediaDevices.getUserMedia(n)}catch(t){return null}if(!s)return null;const o=s.getVideoTracks();let r=null;try{const t=o[0].getSettings();r={width:t.width,height:t.height}}catch(t){const e=document.createElement("video");e.srcObject=s,r={width:e.videoWidth,height:e.videoHeight},e.srcObject=null}return o.forEach((t=>{t.stop()})),r};let i=(null===(o=null===(s=null===(n=vD(this,GD,"f"))||void 0===n?void 0:n.video)||void 0===s?void 0:s.deviceId)||void 0===o?void 0:o.exact)||(null===(l=null===(a=null===(r=vD(this,GD,"f"))||void 0===r?void 0:r.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(c=null===(h=vD(this,GD,"f"))||void 0===h?void 0:h.video)||void 0===c?void 0:c.deviceId);if(!i)return[];let d=vD(this,ck,"f").get(i);if(d&&!t)return JSON.parse(JSON.stringify(d));d=[],vD(this,ck,"f").set(i,d);for(let t of this.detectedResolutions){const n=await e(i,t.width,t.height);n&&!p(i,n)&&d.push({width:n.width,height:n.height})}return d}}async setMediaStreamConstraints(t,e){if(!(t=>{return null!==t&&"[object Object]"===(e=t,Object.prototype.toString.call(e));var e})(t))throw new TypeError("Invalid 'mediaStreamConstraints'.");yD(this,GD,JSON.parse(JSON.stringify(t))),yD(this,$D,null),e&&vD(this,VD,"m",xk).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(vD(this,GD,"f")))}resetMediaStreamConstraints(){yD(this,GD,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null)}getCameraCapabilities(){if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return vD(this,HD,"f").getCapabilities?vD(this,HD,"f").getCapabilities():{}}getCameraSettings(){if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return vD(this,HD,"f").getSettings()}async turnOnTorch(){if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await vD(this,HD,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await vD(this,HD,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=Ak(t,n.min,n.step,n.max)),await vD(this,HD,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=Ak(t,n.min,n.step,n.max)),await vD(this,HD,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!n)throw Error("Not supported.");e&&(t<n.min?t=n.min:t>n.max&&(t=n.max));const s=this.getResolution();return await vD(this,HD,"f").applyConstraints({width:{ideal:Math.max(s.width,s.height)},frameRate:t}),t}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(t,e){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),n=null==i?void 0:i.focusMode,s=null==i?void 0:i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof t.mode)throw TypeError("Invalid 'mode'.");const o=t.mode.toLowerCase();if(!n.includes(o))throw Error("Unsupported focus mode.");if("manual"===o){if(!s)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let i=t.distance;e&&(i<s.min?i=s.min:i>s.max&&(i=s.max),i=Ak(i,s.min,s.step,s.max)),this._focusParameters.focusArea=null,await vD(this,HD,"f").applyConstraints({advanced:[{focusMode:o,focusDistance:i}]})}else{if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const e=t.area.centerPoint;let i=t.area.width,n=t.area.height;if(!i||!n){const t=this.getResolution();i||(i=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:e.x,y:e.y},width:i,height:n},await vD(this,VD,"m",Sk).call(this,e,i,n)}}}else this._focusParameters.focusArea=null,await vD(this,HD,"f").applyConstraints({advanced:[{focusMode:o}]})}getFocus(){const t=this.getCameraSettings(),e=t.focusMode;return e?"manual"===e?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:e}:null}async enableTapToFocus(){yD(this,tk,!0)}disableTapToFocus(){yD(this,tk,!1)}isTapToFocusEnabled(){return vD(this,tk,"f")}async setZoom(t){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if("number"!=typeof t.factor)throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");t.centerPoint?vD(this,VD,"m",_k).call(this,t.centerPoint):this.resetScaleCenter();try{if(vD(this,VD,"m",Tk).call(this,vD(this,rk,"f"))){const e=await this.setHardwareScale(t.factor,!0);let i=this.getHardwareScale();1==i&&1!=e&&(i=e),t.factor>i?this.setSoftwareScale(t.factor/i):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(t.factor)}catch(e){const i=e.message||e;if("Not supported."!==i&&"Camera is not open."!==i)throw e;this.setSoftwareScale(t.factor)}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale()}catch(t){if("Camera is not open."!==(t.message||t))throw t}return{factor:t*vD(this,ok,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!vD(this,HD,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!n)throw Error("Not supported.");return e&&(t<n.min?t=n.min:t>n.max&&(t=n.max),t=Ak(t,n.min,n.step,n.max)),await vD(this,HD,"f").applyConstraints({advanced:[{zoom:t}]}),t}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,e){if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");e&&vD(this,VD,"m",_k).call(this,e),yD(this,ok,t),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return vD(this,ok,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();yD(this,rk,{x:t.width/2,y:t.height/2})}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(t){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(vD(this,QD,"f"))return null;const e=Date.now();Ik._onLog&&Ik._onLog("getFrameData() START: "+e);const i=vD(this,WD,"f").videoWidth,n=vD(this,WD,"f").videoHeight;let s={sx:0,sy:0,sWidth:i,sHeight:n,dWidth:i,dHeight:n};(null==t?void 0:t.position)&&(s=JSON.parse(JSON.stringify(t.position)));let o=AD.RGBA;(null==t?void 0:t.pixelFormat)&&(o=t.pixelFormat);let r=vD(this,ok,"f");(null==t?void 0:t.scale)&&(r=t.scale);let a=vD(this,rk,"f");if(null==t?void 0:t.scaleCenter){if("string"!=typeof t.scaleCenter.x||"string"!=typeof t.scaleCenter.y)throw new Error("Invalid scale center.");let e=0,s=0;if(t.scaleCenter.x.endsWith("px"))e=parseFloat(t.scaleCenter.x);else{if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");e=parseFloat(t.scaleCenter.x)/100*i}if(t.scaleCenter.y.endsWith("px"))s=parseFloat(t.scaleCenter.y);else{if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");s=parseFloat(t.scaleCenter.y)/100*n}if(isNaN(e)||isNaN(s))throw new Error("Invalid scale center.");a.x=Math.round(e),a.y=Math.round(s)}let l=null;if((null==t?void 0:t.bufferContainer)&&(l=t.bufferContainer),0==i||0==n)return null;1!==r&&(s.sWidth=Math.round(s.sWidth/r),s.sHeight=Math.round(s.sHeight/r),s.sx=Math.round((1-1/r)*a.x+s.sx/r),s.sy=Math.round((1-1/r)*a.y+s.sy/r));const h=this.imageDataGetter.getImageData(vD(this,WD,"f"),i,n,s,{pixelFormat:o,bufferContainer:l});if(!h)return null;const c=Date.now();return Ik._onLog&&Ik._onLog("getFrameData() END: "+c),{data:h.data,width:h.width,height:h.height,pixelFormat:h.pixelFormat,timeSpent:c-e,timeStamp:c,toCanvas:vD(this,ak,"f")}}on(t,e){if(!vD(this,hk,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);vD(this,lk,"f").on(t,e)}off(t,e){vD(this,lk,"f").off(t,e)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),vD(this,lk,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",vD(this,uk,"f")),yD(this,pk,!0)}}function Dk(t,e){qd(e)&&(t.config.maxFrameNumber=e)}function kk(t,e){qd(e)&&(t.config.autoCaptureDelay=e)}function Rk(t,e){if(!Yd(e))return;const{context:i}=t.viewer;i.core.detectorService.enableDetect&&(t.config.enableAutoDetect=e,t.isVideoPlaying&&(t.viewer.hooks.autoDetectChanged.emit(cS.create(e)),e?t.loop.startLoop():t.config.enableAutoCapture?t.loop.cancelAnimation():t.loop.closeLoop()))}function Mk(t,e){Yd(e)&&(t.config.enableAutoCapture=e,t.isVideoPlaying&&(t.viewer.hooks.autoCaptureChanged.emit(hS.create(e)),e?t.loop.startLoop():t.config.enableAutoDetect||t.loop.closeLoop()))}function Lk(t,e){qd(e)&&(t.config.acceptedPolygonConfidence=e)}function Ok(t,e){return!!t.videoEl&&(t.config.fullscreen=e,t.videoEl.style.objectFit=e?"cover":"contain",t.loop.updateVideoLayout(),!0)}WD=new WeakMap,HD=new WeakMap,jD=new WeakMap,zD=new WeakMap,GD=new WeakMap,YD=new WeakMap,$D=new WeakMap,XD=new WeakMap,qD=new WeakMap,ZD=new WeakMap,JD=new WeakMap,KD=new WeakMap,QD=new WeakMap,tk=new WeakMap,ek=new WeakMap,ik=new WeakMap,nk=new WeakMap,sk=new WeakMap,ok=new WeakMap,rk=new WeakMap,ak=new WeakMap,lk=new WeakMap,hk=new WeakMap,ck=new WeakMap,dk=new WeakMap,uk=new WeakMap,pk=new WeakMap,VD=new WeakSet,gk=async function(){const t=this.getMediaStreamConstraints();if("boolean"==typeof t.video&&(t.video={}),t.video.deviceId);else if(vD(this,$D,"f"))delete t.video.facingMode,t.video.deviceId={exact:vD(this,$D,"f")};else if(this.ifSaveLastUsedCamera&&Ik.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&i&&(t.video.width=e,t.video.height=i)}else if(this.ifSkipCameraInspection);else{const e=async t=>{let e=null;return"environment"===t&&["Android","HarmonyOS","iPhone","iPad"].includes(_D.OS)?(await this._getCameras(!1),vD(this,VD,"m",fk).call(this),e=Ik.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):t||["Android","HarmonyOS","iPhone","iPad"].includes(_D.OS)||(await this._getCameras(!1),vD(this,VD,"m",fk).call(this),e=Ik.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),e};let i=t.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const n=await e(i);n&&(delete t.video.facingMode,t.video.deviceId={exact:n})}return t},fk=function(){if(vD(this,ZD,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},mk=async function(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;try{Ik._onLog&&Ik._onLog("======try getUserMedia========");let e=[0,500,1e3,2e3],i=null;const s=async t=>{for(let s of e){s&&(await new Promise((t=>setTimeout(t,s))),vD(this,VD,"m",fk).call(this));try{Ik._onLog&&Ik._onLog("ask "+JSON.stringify(t)),n=await navigator.mediaDevices.getUserMedia(t),vD(this,VD,"m",fk).call(this);break}catch(t){if("NotFoundError"===t.name||"NotAllowedError"===t.name||"AbortError"===t.name||"OverconstrainedError"===t.name)throw t;i=t,Ik._onLog&&Ik._onLog(t.message||t)}}};if(await s(t),n||"object"!=typeof t.video||(t.video.deviceId&&(delete t.video.deviceId,await s(t)),!n&&t.video.facingMode&&(delete t.video.facingMode,await s(t)),n||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,await s(t))),!n)throw i;return n}catch(t){throw null==n||n.getTracks().forEach((t=>{t.stop()})),"NotFoundError"===t.name&&(DOMException?t=new DOMException("No camera available, please use a device with an accessible camera.",t.name):(t=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),t}},vk=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((t=>{t.stop()})),this._mediaStream=null),yD(this,HD,null)},yk=async function(){yD(this,ZD,!1);const t=yD(this,qD,Symbol());if(vD(this,JD,"f")&&"pending"===vD(this,KD,"f")){try{await vD(this,JD,"f")}catch(t){}vD(this,VD,"m",fk).call(this)}if(t!==vD(this,qD,"f"))return;const e=yD(this,JD,(async()=>{yD(this,KD,"pending");try{if(this.videoSrc){if(!vD(this,WD,"f"))throw new Error("'videoEl' should be set.");await Ik.playVideo(vD(this,WD,"f"),this.videoSrc,this.cameraOpenTimeout),vD(this,VD,"m",fk).call(this)}else{let t=await vD(this,VD,"m",gk).call(this);vD(this,VD,"m",vk).call(this);let e=await vD(this,VD,"m",mk).call(this,t);await this._getCameras(!1),vD(this,VD,"m",fk).call(this);const i=()=>{const t=e.getVideoTracks();let i,n;if(t.length&&(i=t[0]),i){const t=i.getSettings();if(t)for(let e of this._arrCameras)if(t.deviceId===e.deviceId){e._checked=!0,e.label=i.label,n=e;break}}return n},n=vD(this,GD,"f");if("object"==typeof n.video){let s=n.video.facingMode;if(s instanceof Array&&s.length&&(s=s[0]),"object"==typeof s&&(s=s.exact||s.ideal),!(vD(this,$D,"f")||this.ifSaveLastUsedCamera&&Ik.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||n.video.deviceId)){const n=i(),o=Ik.findBestCamera(this._arrCameras,s,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});o&&o!=(null==n?void 0:n.deviceId)&&(e.getTracks().forEach((t=>{t.stop()})),t.video.deviceId={exact:o},e=await vD(this,VD,"m",mk).call(this,t),vD(this,VD,"m",fk).call(this))}}const s=i();(null==s?void 0:s.deviceId)&&(yD(this,$D,s&&s.deviceId),this.ifSaveLastUsedCamera&&Ik.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",vD(this,$D,"f")),"object"==typeof t.video&&t.video.width&&t.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(t.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(t.video.height))))),vD(this,WD,"f")&&(await Ik.playVideo(vD(this,WD,"f"),e,this.cameraOpenTimeout),vD(this,VD,"m",fk).call(this)),this._mediaStream=e;const o=e.getVideoTracks();(null==o?void 0:o.length)&&yD(this,HD,o[0]),yD(this,YD,s)}}catch(t){throw vD(this,VD,"m",wk).call(this),yD(this,KD,null),t}yD(this,KD,"fulfilled")})());return e},xk=async function(){var t;if("closed"===this.state||this.videoSrc)return;const e=null===(t=vD(this,YD,"f"))||void 0===t?void 0:t.deviceId,i=this.getResolution();await vD(this,VD,"m",yk).call(this);const n=this.getResolution();e&&e!==vD(this,YD,"f").deviceId&&vD(this,lk,"f").fire("camera:changed",[vD(this,YD,"f").deviceId,e],{target:this,async:!1}),i.width==n.width&&i.height==n.height||vD(this,lk,"f").fire("resolution:changed",[{width:n.width,height:n.height},{width:i.width,height:i.height}],{target:this,async:!1}),vD(this,lk,"f").fire("played",null,{target:this,async:!1})},wk=function(){vD(this,VD,"m",vk).call(this),yD(this,YD,null),vD(this,WD,"f")&&(vD(this,WD,"f").srcObject=null,this.videoSrc&&(vD(this,WD,"f").pause(),vD(this,WD,"f").currentTime=0)),yD(this,ZD,!0);try{this.resetSoftwareScale()}catch(t){}},bk=async function t(e,i){const n=t=>{if(!vD(this,HD,"f")||!this.isVideoPlaying||t.focusTaskId!=this._focusParameters.curFocusTaskId){vD(this,HD,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const e=new Error(`Focus task ${t.focusTaskId} canceled.`);throw e.name="DeprecatedTaskError",e}1===this._focusParameters.isDoingFocus&&Date.now()-t.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let s;i=Ak(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await vD(this,HD,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),s=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((t=>{setTimeout(t,s)})),n(e);let o=e.focusL-e.focusW/2,r=e.focusT-e.focusH/2,a=e.focusW,l=e.focusH;const h=this.getResolution();if(o>=h.width||r>=h.height)throw new Error("Invalid area.");o+a>h.width&&(a=h.width-o),r+l>h.height&&(l=h.height-r),o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l);const c=4*h.width*h.height*this._focusParameters.defaultTempBufferContainerLenRatio,d=4*a*l;let u=this._focusParameters.tempBufferContainer;if(u){const t=u.length;c>t&&c>=d?u=new Uint8Array(c):d>t&&d>=c&&(u=new Uint8Array(d))}else u=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(c,d));if(!this.imageDataGetter.getImageData(vD(this,WD,"f"),h.width,h.height,{sx:o,sy:r,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:AD.RGBA,bufferContainer:u}))return vD(this,VD,"m",t).call(this,e,i);const p=u;let g=0;for(let t=0,e=d-8;t<e;++t){let e=p[t]-p[t+8];++t;let i=p[t]-p[t+8];++t;let n=p[t]-p[t+8];++t,g+=e*e+i*i+n*n}return-g},Ck=async function t(e,i,n,s,o,r,a){let l;if(i=Ak(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=Ak(s,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r?r=Ak(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(r=Ak(Math.sqrt((i||this._focusParameters.fds.step)*(s||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await vD(this,VD,"m",bk).call(this,e,r)),a<=n&&a<=o?l=3:n<o&&n<a?l=1:o<n&&o<a&&(l=2),(s-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await vD(this,HD,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await vD(this,HD,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:s}]})),!0;if(1===l)return await vD(this,VD,"m",t).call(this,e,i,n,r,a);if(2===l)return await vD(this,VD,"m",t).call(this,e,r,a,s,o);if(3!==l)return n=await vD(this,VD,"m",bk).call(this,e,i),o=await vD(this,VD,"m",bk).call(this,e,s),await vD(this,VD,"m",t).call(this,e,i,n,s,o);let h=Ak(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),c=Ak(Math.sqrt((s||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/h)<=Math.abs(1/this._focusParameters.oldDistance-1/c)){let l=await vD(this,VD,"m",bk).call(this,e,h);if(l<a)return await vD(this,VD,"m",t).call(this,e,i,n,r,a,h,l);if(l==a)return await vD(this,VD,"m",t).call(this,e,h,l,r,a);let d=await vD(this,VD,"m",bk).call(this,e,c);if(l>a&&a<d)return await vD(this,VD,"m",t).call(this,e,h,l,c,d,r,a);if(a==d)return await vD(this,VD,"m",t).call(this,e,r,a,c,d);if(a>d)return await vD(this,VD,"m",t).call(this,e,r,a,s,o,c,d)}else{let l=await vD(this,VD,"m",bk).call(this,e,c);if(a>l)return await vD(this,VD,"m",t).call(this,e,r,a,s,o,c,l);if(a==l)return await vD(this,VD,"m",t).call(this,e,r,a,c,l);let d=await vD(this,VD,"m",bk).call(this,e,h);if(d>a&&a<l)return await vD(this,VD,"m",t).call(this,e,h,d,c,l,r,a);if(d==a)return await vD(this,VD,"m",t).call(this,e,h,d,r,a);if(d<a)return await vD(this,VD,"m",t).call(this,e,i,n,r,a,h,d)}return!1},Sk=async function(t,e,i,n,s){var o;if(1==this._focusParameters.isDoingFocus)return!1;if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'centerPoint'.");if(!e||"string"!=typeof e)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const r=this.getResolution();let a=0,l=0;if(t.x.endsWith("px"))a=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(t.x)/100*r.width}if(t.y.endsWith("px"))l=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(t.y)/100*r.height}if(isNaN(a)||isNaN(l)||a<0||a>r.width||l<0||l>r.height)throw new Error("Invalid 'centerPoint'.");let h=0;if(e.endsWith("px"))h=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");h=parseFloat(e)/100*r.width}if(isNaN(h)||h<0)throw new Error("Invalid 'width'.");let c=0;if(i.endsWith("px"))c=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid 'height'.");c=parseFloat(i)/100*r.height}if(isNaN(c)||c<0)throw new Error("Invalid 'height'.");if(1!==vD(this,ok,"f")){const t=vD(this,ok,"f"),e=vD(this,rk,"f");h/=t,c/=t,a=(1-1/t)*e.x+a/t,l=(1-1/t)*e.y+l/t}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(o=this.getCameraCapabilities())||void 0===o?void 0:o.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const d={focusL:a,focusT:l,focusW:h,focusH:c,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},u=async(t,e,i)=>{try{(null==e||e<this._focusParameters.fds.min)&&(e=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=Ak(Math.sqrt(i*(e||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=Ak(Math.sqrt((e||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=Ak(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=await vD(this,VD,"m",bk).call(this,t,o),a=await vD(this,VD,"m",bk).call(this,t,s),l=await vD(this,VD,"m",bk).call(this,t,n);if(a>l&&l<r){const e=await vD(this,VD,"m",Ck).call(this,t,s,a,o,r,n,l);return this._focusParameters.isDoingFocus=0,e}if(a<l&&a<r){let i=await vD(this,VD,"m",bk).call(this,t,e);const o=await vD(this,VD,"m",Ck).call(this,t,e,i,n,l,s,a);return this._focusParameters.isDoingFocus=0,o}if(l>r&&a>r){let e=await vD(this,VD,"m",bk).call(this,t,i);const s=await vD(this,VD,"m",Ck).call(this,t,n,l,i,e,o,r);return this._focusParameters.isDoingFocus=0,s}if(a==l&&l<r){const e=await vD(this,VD,"m",Ck).call(this,t,s,a,n,l);return this._focusParameters.isDoingFocus=0,e}if(l==r&&a>l){const e=await vD(this,VD,"m",Ck).call(this,t,n,l,o,r);return this._focusParameters.isDoingFocus=0,e}return u(t,e,i)}catch(t){if("DeprecatedTaskError"!==t.name)throw t}};return u(d,n,s)},_k=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'center'.");const e=this.getResolution();let i=0,n=0;if(t.x.endsWith("px"))i=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))n=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.y)/100*e.height}if(isNaN(i)||isNaN(n))throw new Error("Invalid scale center.");yD(this,rk,{x:i,y:n})},Tk=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},Ik.browserInfo=_D,Ik.onWarning=null===(UD=null===window||void 0===window?void 0:window.console)||void 0===UD?void 0:UD.warn;class Bk{constructor(t){na(this,"isLooping",!1),na(this,"lastDetectTime",(new Date).getTime()),na(this,"loopTimer",void 0),na(this,"autoCaptureStartTime",0),na(this,"lastRenderedQuad",void 0),na(this,"animation",void 0),na(this,"cameraContext",void 0),na(this,"videoLayout",void 0),this.cameraContext=t}getLoopState(){const{enableAutoCapture:t,enableAutoDetect:e}=this.cameraContext.config;return t||e}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime()}loopTimeout(){if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const t=this.getDetectRemainTime();this.loopTimer=setTimeout((async()=>{if(!this.getLoopState()||this.isLooping)return;this.isLooping=!0;const t=await this.loopTaskDetail();this.isLooping=!1,t&&this.getLoopState()&&setTimeout((()=>{this.getLoopState()&&this.loopTimeout()}),10)}),t)}async loopTaskDetail(){if(!(this.cameraContext&&this.cameraContext.isVideoPlaying&&this.cameraContext.videoEl&&this.cameraContext.canvasEl))return!1;if(!this.getLoopState())return!1;const{viewer:t}=this.cameraContext;if(this.lastDetectTime=(new Date).getTime(),!t.context.viewService.isBindContainer)return!0;if("hidden"===t.getViewerConfig().visibility)return!1;const{config:e}=this.cameraContext,{enableDetect:i}=t.context.core.detectorService,n=this.cameraContext.getFrameData();if(!n)return!1;const s={type:1,data:n.data.buffer,height:n.height,width:n.width};let o={success:!1};var r;i&&(o=await this.getDetectResult(s),0===n.data.length&&(n.data=new Uint8Array(s.data)),e.enableAutoDetect&&this.cameraContext.isVideoPlaying&&o.success&&null!==(r=o)&&void 0!==r&&r.location?(this.lastRenderedQuad?this.createDetectAnimation(this.lastRenderedQuad,o.location):this.drawQuadrilateral(o.location),this.lastRenderedQuad=o.location):(this.clearCanvas(),this.lastRenderedQuad=null));let a=!1;var l;if(e.enableAutoCapture?((null===(l=o)||void 0===l?void 0:l.status)===Ox.AUTO_CAPTURE&&(a=!0),i||(this.autoCaptureStartTime<=0?this.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-this.autoCaptureStartTime>e.autoCaptureDelay&&(this.autoCaptureStartTime=0,a=!0))):this.autoCaptureStartTime=0,a){var h,c,d;if(null===(h=this.cameraContext.viewer)||void 0===h||!h.context)return!1;const t=await this.cameraContext.viewer.context.core.processService.resize(n.data.buffer,1,n.width,n.height,-1);if(this.cameraContext.isCapturedPages=!0,null===(c=this.cameraContext.viewer)||void 0===c||!c.context)return!1;await this.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(d=o)||void 0===d?void 0:d.location}],fileData:t.data}),this.startCaptureAnimation(),await Fk(),this.closeCaptureAnimation()}return!0}getDetectRemainTime(){const t=(new Date).getTime(),{maxFrameNumber:e}=this.cameraContext.config,i=t-this.lastDetectTime;return Math.max(0,1e3/e-i)}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()))}closeLoop(){if(!this.loopTimer)return;const{context:t}=this.cameraContext.viewer,{detectorService:e}=t.core;e.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation)}updateVideoLayout(){const{videoEl:t,config:e}=this.cameraContext,{fullscreen:i}=e,{videoWidth:n,videoHeight:s}=t,{width:o,height:r}=t.getBoundingClientRect(),a={zoom:1,left:0,top:0};if(i){const t=Math.max(o/n,r/s);a.zoom=t}else{const t=Math.min(o/n,r/s),e=(o-n*t)/2,i=(r-s*t)/2;a.zoom=t,a.left=e,a.top=i}this.videoLayout=a}async getDetectResult(t){const{cameraContext:e}=this,{context:i}=e.viewer,{detectorService:n}=i.core;if(!n.enableDetect)return Promise.resolve({success:!1});let s=t;if(!t){const t=e.getFrameData();s={type:1,data:t.data.buffer,height:t.height,width:t.width}}const{acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a}=e.config,l={acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a};return await n.detect(s,l)||Promise.resolve({success:!1})}drawQuadrilateral(t){if(!this.loopTimer)return;const{canvasEl:e,viewer:i}=this.cameraContext;if(!e)return;const{zoom:n,left:s,top:o}=this.videoLayout,r=e.getContext("2d");r.save(),r.clearRect(0,0,e.width,e.height),r.translate(s,o),r.scale(n,n),r.beginPath(),r.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)r.lineTo(t[e][0],t[e][1]);r.closePath();const{quadSelectionStyle:a}=i.getViewerConfig(),{border:l,background:h}=a,{borderWidth:c,borderColor:d,borderStyle:u}=Au(l);let p=mg(c).value/n;0===p&&(p=1);const g="solid"===u?[0,0]:[5*p,2*p];r.strokeStyle=d,r.fillStyle=h,r.lineCap="round",r.lineWidth=p,r.setLineDash(g),r.fill(),r.stroke(),r.restore()}clearCanvas(){const{canvasEl:t}=this.cameraContext;t&&t.getContext("2d").clearRect(0,0,t.width,t.height)}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation)}createDetectAnimation(t,e){let i=0;const n=()=>{this.clearCanvas();const s=t.map(((t,n)=>{const s=e[n];return[t[0]+(s[0]-t[0])*i,t[1]+(s[1]-t[1])*i]}));this.drawQuadrilateral(s),i<1&&(i+=.2,this.animation=requestAnimationFrame(n))};n()}startCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden")}closeCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="")}}function Fk(){return new Promise((t=>{setTimeout((()=>{t("")}),50)}))}const Nk={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},Uk={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class Vk{constructor(t){var e;if(na(this,"camera",void 0),na(this,"configHandler",{}),na(this,"isHttps",!0),na(this,"lastDeviceId",void 0),na(this,"userDeviceId",void 0),na(this,"isFirstPlayed",!0),na(this,"isTurningTorch",!1),na(this,"initializing",!1),na(this,"cameraContainer",void 0),na(this,"viewer",void 0),na(this,"loop",void 0),na(this,"videoEl",void 0),na(this,"canvasEl",void 0),na(this,"config",Wd(Uk)),na(this,"bUser",!1),na(this,"canFrontCamera",!1),na(this,"isCapturedPages",!1),na(this,"lastEnvironmentCameraId",void 0),na(this,"cameraList",[]),na(this,"turnOnTheTorch",!1),na(this,"torchSupported",!1),this.viewer=t,this.camera=new Ik,this.loop=new Bk(this),this.initConfigHandler(),null!==(e=navigator)&&void 0!==e&&null!==(e=e.mediaDevices)&&void 0!==e&&e.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const t=this.getCameras().then((t=>{this.cameraList=t})),e=this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(yS.create(t))})).catch((t=>{}));Promise.all([t,e]).finally((()=>{this.initializing=!1}))}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents()}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks()}handleViewerModeChanged(){const{defaultDom:t,mainAndThbContainer:e}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const e=P_(Nk,this.viewer.postfix);this.cameraContainer=e,Object.assign(e.style,this.viewer.context.viewerConfig.canvasStyle),t.appendChild(e);const i=e.getElementsByTagName("video")[0],n=e.getElementsByTagName("canvas")[0];i.setAttribute("playsinline","true"),i.setAttribute("muted","true"),i.setAttribute("disablePictureInPicture","true"),i.setAttribute("autoplay","autoplay"),i.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),i.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(i),this.bindCameraCanvas(n),this.updateCameraConfig(Uk)}I_(this.cameraContainer,"flex"),A_(e)}else A_(this.cameraContainer),I_(e,"flex")}initConfigHandler(){const t={maxFrameNumber:Dk,enableAutoCapture:Mk,enableAutoDetect:Rk,acceptedPolygonConfidence:Lk,fullscreen:Ok,autoCaptureDelay:kk};this.configHandler=t}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on((()=>{this.isCaptureViewer&&this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(yS.create(t))})),this.handleViewerModeChanged()})),this.viewer.hooks.visibleChanged.on((t=>{this.loop.closeLoop(),"visible"===t.newVisibility&&this.loop.startLoop()}))}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on((t=>{if(!this.isCapturedPages)return;const e=kC.create(t.pageUids[0]);this.viewer.emit("captured",e),this.isCapturedPages=!1}),this.viewer)}bindCameraEvents(){const{camera:t}=this;t.on("paused",(()=>{this.loop.closeLoop()})),t.on("resumed",(()=>{this.loop.closeLoop(),this.loop.startLoop()})),t.on("before:open",(()=>{this.videoEl&&(this.videoEl.style.opacity="0")})),t.on("before:resolution:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop()})),t.on("before:camera:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId})),t.on("camera:changed",(()=>{const t=DC.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",t)})),t.on("played",(()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:t}=this.config,e=this.camera.getResolution();let i="unsupported";try{const t=this.camera.getCameraCapabilities();i=null!=t&&t.torch?"supported":"unsupported"}catch(t){}this.torchSupported="supported"===i,this.emitTorchChanged(i),"supported"===i&&t&&this.turnOnTorch().catch((()=>{this.config.enableTorch=!0})),this.viewer.hooks.cameraPlayed.emit(uS.create(e)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop()})),t.on("closed",(()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"))}))}emitTorchChanged(t){this.viewer.hooks.torchChanged.emit(dS.create(t))}getVPointerEvent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0,s=0,o=0,r=0;if(e){const{left:t,top:i}=e.getBoundingClientRect();o=t,r=i}return t instanceof PointerEvent||t instanceof MouseEvent?(n=t.offsetX,s=t.offsetY):i?(n=t.changedTouches[0].clientX-o,s=t.changedTouches[0].clientY-r):(n=t.touches[0].clientX-o,s=t.touches[0].clientY-r),ZC.create(-1,"",-1,-1,Math.floor(n),Math.floor(s),t)}triggerPlayed(t){const e=zC.create(this.camera.getCamera().deviceId,t);this.viewer.emit("played",e)}bindNativeEvents(){const t=this.canvasEl;if(!t)return;const e=t=>{const e=this.getVPointerEvent(t);this.viewer.emit("click",e)},i=t=>{this.viewer.emit("dblclick",this.getVPointerEvent(t))},n=t=>{t.preventDefault();const e=this.getVPointerEvent(t);this.viewer.emit("rightclick",e)},s=()=>{setTimeout((()=>{this.resize()}),500)},o=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop())};t.addEventListener("click",e),t.addEventListener("dblclick",i),t.addEventListener("contextmenu",n),document.addEventListener("visibilitychange",o),window.addEventListener("orientationchange",s),this.viewer.hooks.destroy.on((()=>{t.removeEventListener("click",e),t.removeEventListener("dblclick",i),t.removeEventListener("contextmenu",n),document.removeEventListener("visibilitychange",o),window.removeEventListener("orientationchange",s)}))}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===$b.CAPTURE}get isVideoPlaying(){return!!this.camera&&this.camera.isVideoPlaying}async getFrontCamera(){if(!this.isHttps)return vw.reject(vw.CAMERA_NEED_HTTPS);const t=await Ik.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(t.ok)}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const t=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then((()=>(this.bUser=!0,this.lastEnvironmentCameraId=t,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve())))}return this.setCamera(this.lastEnvironmentCameraId).then((()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve())))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:t,height:e}=this.videoEl.getBoundingClientRect(),i=this.videoEl.videoWidth,n=this.videoEl.videoHeight,s=Math.max(t/i,e/n),o=t/(i*s),r=e/(n*s),a=Math.floor((1-o)/2*i),l=Math.floor((1-r)/2*n),h=Math.floor(i*o),c=Math.floor(n*r);return this.camera.getFrameData({position:{sx:a,sy:l,sWidth:h,sHeight:c,dWidth:h,dHeight:c}})}updateCameraConfig(t){for(const[e,i]of Object.entries(t)){const t=this.configHandler[e];t&&!Hd(i)&&t(this,i)}}bindCameraVideo(t){t instanceof HTMLVideoElement&&(this.camera.setVideoEl(t),this.videoEl=t)}bindCameraCanvas(t){t instanceof HTMLCanvasElement&&(this.canvasEl=t)}async capture(){this.loop.startCaptureAnimation(),await Fk(),this.loop.closeCaptureAnimation(),vw.verbose(`[${Date.now()}][cv] start capture`);const t=this.getFrameData();if(vw.verbose(`[${Date.now()}][cv] get frame done`),!t)return null;const e={type:1,data:t.data.buffer,width:t.width,height:t.height},i=await this.loop.getDetectResult(e);vw.verbose(`[${Date.now()}][cv] get detect result done`),0===t.data.length&&(t.data=new Uint8Array(e.data));const n=await this.viewer.context.core.processService.resize(t.data.buffer,1,t.width,t.height,-1);return vw.verbose(`[${Date.now()}][cv] create image done`),this.isCapturedPages=!0,await this.viewer.context.loadSource({fileData:n.data,extraPageData:[{index:0,perspectiveQuad:i.success?i.location:void 0}]}),vw.verbose(`[${Date.now()}][cv] capture done`),n.data}async play(t){if(!this.isHttps)return Promise.reject(vw.CAMERA_NEED_HTTPS);if(!t&&this.isVideoPlaying)return Promise.resolve();const{fill:e,resolution:i}=t||{},n=this.camera.getResolution();if(Yd(e)&&this.updateCameraConfig({fullscreen:e}),this.isVideoPlaying&&Wk(i)&&i[0]===n.width&&i[1]===n.height)return Promise.resolve();let s=[n.width,n.height];if(Wk(i)){if(this.isVideoPlaying)return this.camera.setResolution(i[0],i[1]).then((t=>(this.resize(),this.triggerPlayed(i),Promise.resolve()))).catch();this.camera.setResolution(i[0],i[1]),s=i}return!this.isFirstPlayed||this.isVideoPlaying||i||"opening"===this.camera.state||(this.camera.setResolution(1280,720),s=[1280,720]),this.initializing&&await new Promise((t=>{const e=setInterval((()=>{this.initializing||(clearInterval(e),t(""))}),100)})),this.isFirstPlayed&&(this.isFirstPlayed=!1),this.camera.open().then((async()=>(this.resize(),this.triggerPlayed(s),Promise.resolve()))).catch((t=>{let e=vw.CAMERA_OCCUPIED;return"Permission denied"===t.message&&(e=vw.CAMERA_DENIED),8===t.code&&(e=vw.CAMERA_NO_CAMERA),Promise.reject(e)}))}stop(){var t;this.loop.closeLoop(),this.viewer.emit("stopped",XC.create(this.getCamera().deviceId)),null===(t=this.camera)||void 0===t||t.close()}async setCamera(t){let e="";Vd(t)?e=t.deviceId||"":Zd(t)&&(e=t);let i=!1;for(let t=0;t<this.cameraList.length;t++)this.cameraList[t].deviceId===e&&(i=!0);if(!i)return Promise.reject(vw.CAMERA_NOT_EXIST);await this.camera.setCamera(e).catch((t=>{let e=vw.CAMERA_OCCUPIED;"Permission denied"===t.message&&(e=vw.CAMERA_DENIED),8===t.code&&(e=vw.CAMERA_NO_CAMERA),Promise.reject(e)}));const n=this.camera.getResolution(),s={deviceId:e,width:n.width,height:n.height};return this.isVideoPlaying&&this.triggerPlayed([n.width,n.height]),Promise.resolve(s)}getCamera(){const t=this.camera.getCamera();return{deviceId:t.deviceId,label:t.label}}async getCameras(){const t=(await this.camera.getAllCameras()).map((t=>({deviceId:t.deviceId,label:t.label})));return Promise.resolve(t)}async setResolution(t,e){const i=this.camera.getCamera();if(!i||""===i.deviceId)return Promise.reject(vw.CAMERA_NOT_EXIST);let n;if(qd(t))n=t;else if(Ud(t)){const[i,s]=t;n=i,e=s}let s=this.camera.getResolution();return qd(n)&&qd(e)&&(this.loop.closeLoop(),s=await this.camera.setResolution(n,e).catch((t=>{}))),this.camera&&this.isVideoPlaying&&this.triggerPlayed([s.width,s.height]),Promise.resolve({deviceId:i.deviceId,...s})}getResolution(){const t=this.camera.getCamera();if(!t||""===t.deviceId)return[0,0];const e=this.camera.getResolution();return[e.width,e.height]}async getResolutions(){const t=(await this.camera.getResolutions()).map((t=>[t.width,t.height]));return Promise.resolve(t)}turnOnTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then((()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve()))).catch((t=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),vw.reject(vw.CAMERA_NOT_SUPPORT_TORCH))))):Promise.reject(vw.CAMERA_NO_VIDEO)}turnOffTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.camera.turnOffTorch().then((()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve()))).catch((t=>vw.reject(vw.CAMERA_NOT_SUPPORT_TORCH))):Promise.reject(vw.CAMERA_NO_VIDEO)}resize(){const{canvasEl:t}=this,{width:e,height:i}=t.getBoundingClientRect();t.width=Math.floor(e),t.height=Math.floor(i),this.loop.updateVideoLayout()}dispose(){var t,e;this.stop(),null===(t=this.loop)||void 0===t||t.closeLoop(),null===(e=this.camera)||void 0===e||e.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null}}function Wk(t){return!!(Ud(t)&&qd(t[0])&&qd(t[1]))}const Hk={install(t){const e=t.getClass("Viewer"),i=(n=e,class extends n{constructor(t){if(super(t),na(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===$b.CAPTURE){this.cameraContext=new Vk(this);const e=Uk;Vd(t.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach((i=>{i in t.viewerConfig&&(e[i]=t.viewerConfig[i])})),this.cameraContext.config={...e,defaultCameraConfig:Uk},this.on("resized",(()=>{this.cameraContext.resize()}))}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return Wd(this.cameraContext.config)}updateCameraConfig(t){Vd(t)&&this.cameraContext.updateCameraConfig(t)}capture(){return this.cameraContext.capture()}play(t){return this.cameraContext.play(t)}stop(){this.isVideoPlaying()?this.cameraContext.stop():vw.warning(vw.CAMERA_NO_VIDEO)}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(t){return this.cameraContext.setCamera(t)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(t,e){return this.cameraContext.setResolution(t,e)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var t;this.cameraContext&&(null===(t=this.cameraContext)||void 0===t||t.dispose()),this.cameraContext=null,super.dispose()}});var n;t.setClass("Viewer",i)}};class jk{constructor(t){na(this,"uid",void 0),na(this,"areaUid",void 0),na(this,"isRect",!0),na(this,"vertexes",[]),na(this,"midpoints",[]),na(this,"points",[]),na(this,"keepAspectRatio",!1),na(this,"isConvex",!0),na(this,"renderer",void 0),na(this,"area",void 0),na(this,"slopeRatio",[]),na(this,"selectedPart",-1),na(this,"startX",null),na(this,"startY",null),na(this,"lastX",null),na(this,"lastY",null),na(this,"lastAspectRatio",1),na(this,"b1",void 0),na(this,"b2",void 0),na(this,"k1",void 0),na(this,"k2",void 0),this.uid=Qd(),Object.assign(this,t),this.initBox(t.vertexes)}initBox(t){this.vertexes=t,this.midpoints=zk(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=mu(this.vertexes)}getRect(){if(!this.isRect)return null;const{minX:t,maxX:e,minY:i,maxY:n}=this.getBounds();return{left:t,top:i,width:e-t||1,height:n-i||1}}getQuad(){if(this.isRect)return null;const{points:t}=this,e=[];for(let i=0;i<4;i++)e.push([t[2*i],t[2*i+1]]);return e}getActivePartNum(t,e,i){const n=this.getSelectedCtrlPointNum(t,e,i);return n>-1?n:this.isPointOnBox(t,e)?8:-1}getSelectedCtrlPointNum(t,e,i){const{points:n}=this,{width:s,height:o,zoom:r}=this.area,{ctrlWidth:a,ctrlHeight:l,ctrlRadiusMultipleMobile:h}=this.renderer.config.boxStyle;let c=l/2/r,d=a/2/r;i&&(d*=h,c*=h);const u=Jd(d,0,3*d),p=Jd(c,0,3*c);for(let i=0;i<8;i++){const r=n[2*i],a=n[2*i+1];if(t<=r+u&&t>=r-u&&e<=a+p&&e>=a-p&&t>=0-u&&t<=s+u&&e>=0-p&&e<=o+p&&(i<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return i}return-1}checkOrientation(t){if(t<0||t>7)return null;const{minX:e,maxX:i,minY:n,maxY:s}=this.getBounds(),{points:o}=this,r=o[2*t],a=o[2*t+1];let l="",h="";return r===i?l="e":r===e&&(l="w"),a===s?h="s":a===n&&(h="n"),t<4?h+l:h||l}onStartHandler(t,e,i,n){var s;if(null!==(s=i)&&void 0!==s||(i=this.getActivePartNum(t,e,n)),!(i<0)&&(this.startX=t,this.startY=e,this.lastX=t,this.lastY=e,this.selectedPart=i,!this.isRect&&i>3&&i<8)){const{points:t,slopeRatio:e}=this,n=i-4;this.k1=e[(n+1)%4],this.b1=t[(2*n+3)%8]-this.k1*t[(2*n+2)%8],this.k2=e[(n+3)%4],this.b2=t[(2*n+1)%8]-this.k2*t[(2*n+0)%8]}}onMoveHandler(t,e,i){const{selectedPart:n}=this;if(n<0)return;const s=t-this.lastX,o=e-this.lastY;if(0===s&&0===o)return;const{points:r}=this;let a=r.slice();var l;n<8?(null!==(l=i)&&void 0!==l||(i=n),this.isRect?a=this.moveRectPoint(a,i,t,e):(a=this.moveQuadPoint(a,i,t,e),this.slopeRatio=mu(r).slice(0,4),this.isConvex=vu(a))):8===n&&(a=this.moveBox(a,s,o));const h=zk(a);this.points=a.slice(0,8).concat(h),this.midpoints=h,this.lastX=t,this.lastY=e}onEndHandler(){const{startX:t,startY:e,vertexes:i,midpoints:n,lastX:s,lastY:o,selectedPart:r}=this;if(r<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let a=this.points.slice();const l=vu(a);(t===s&&e===o||!l)&&(a=i.slice().concat(n)),this.isConvex=!0,this.vertexes=a.slice(0,8),this.midpoints=zk(a),this.points=a.slice(0,8).concat(this.midpoints),this.slopeRatio=mu(a).slice(0,4)}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return{minX:Math.min(t[0],t[2],t[4],t[6]),maxX:Math.max(t[0],t[2],t[4],t[6]),minY:Math.min(t[1],t[3],t[5],t[7]),maxY:Math.max(t[1],t[3],t[5],t[7])}}moveRectPoint(t,e,i,n){let s=0,o=0;const{enableEditCropBoxMidpoints:r,enableEditCropBoxVertices:a}=this.renderer.config;if(this.keepAspectRatio){const{minX:l,maxX:h,minY:c,maxY:d}=this.getBounds(),u=this.checkOrientation(e);let p=(h-l)/(d-c);0===p||p===1/0||p===-1/0||Number.isNaN(p)?p=this.lastAspectRatio:this.lastAspectRatio=p,s=0,o=0;let g="w",f=!1;if(e<4){if(a){if(f=!0,s=i-t[2*e],o=n-t[2*e+1],0===s||0===o)return t;g="w"}}else{const a=e-4;if(r){f=!0;const r={e:[(a+1)%4,"w"],s:[a,"h"],w:[a,"w"],n:[(a+1)%4,"h"]};if(["e","s","w","n"].includes(u)&&([e,g]=r[u]),s=i-t[2*a],o=n-t[2*a+1],0===s||0===o)return t}}if(f){const i=["ne","sw","n","w"];"h"===g?(s=o*p,i.includes(u)&&(s=-s)):(o=s/p,i.includes(u)&&(o=-o));const n=t[2*e]+s,r=t[2*e+1]+o,{width:a,height:l}=this.area;n<0?(s=0-t[2*e],o=0):n>a?(s=a-t[2*e],o=0):r<0?(o=0-t[2*e+1],s=0):r>l&&(o=l-t[2*e+1],s=0),t[2*e]+=s,t[2*e+1]+=o;const h=(e+1)%4,c=(e+3)%4;e%2?(t[2*h]+=s,t[2*c+1]+=o):(t[2*h+1]+=o,t[2*c]+=s)}}else if(e<4){if(a){if(s=i-t[2*e],o=n-t[2*e+1],0===s&&0===o)return t;t[2*e]=i,t[2*e+1]=n;const r=(e+1)%4,a=(e+3)%4;e%2?(t[2*r]=i,t[2*a+1]=n):(t[2*r+1]=n,t[2*a]=i)}}else{const s=e-4;if(r){const e=this.slopeRatio[s%4];0===e?(t[(2*s+3)%8]=n,t[(2*s+1)%8]=n):e!==1/0&&e!==-1/0||(t[(2*s+2)%8]=i,t[(2*s+0)%8]=i)}}return t}moveQuadPoint(t,e,i,n){const s=t.slice();if(e<4){const s=i-t[2*e],o=n-t[2*e+1];if(0===s&&0===o)return t;t[2*e]=i,t[2*e+1]=n}else{const o=e-4,r=this.slopeRatio[o%4],a=n-r*i,l=-a/r,h=a,c=t[(2*o+9)%8]-r*t[(2*o+8)%8],d=-c/r,{k1:u,b1:p,k2:g,b2:f}=this;0===r?(t[(2*o+3)%8]=n,u!==1/0&&u!==-1/0&&(t[(2*o+2)%8]=(n-p)/u),t[(2*o+1)%8]=n,g!==1/0&&g!==-1/0&&(t[(2*o+0)%8]=(n-f)/g)):r===1/0||r===-1/0?(t[(2*o+2)%8]=i,t[(2*o+3)%8]=u*i+p,t[(2*o+0)%8]=i,t[(2*o+1)%8]=g*i+f):(0===u?t[(2*o+2)%8]+=l-d:u===1/0||u===-1/0?t[(2*o+3)%8]+=h-c:(t[(2*o+2)%8]=(p-a)/(r-u),t[(2*o+3)%8]=(r*p-u*a)/(r-u)),0===g?t[(2*o+0)%8]+=l-d:g===1/0||g===-1/0?t[(2*o+1)%8]+=h-c:(t[(2*o+0)%8]=(f-a)/(r-g),t[(2*o+1)%8]=(r*f-g*a)/(r-g)));for(let e=0;e<4;e++){const i=t[2*e],n=t[2*e+1];if(i<0||i>this.area.width||n<0||n>this.area.height)return s}}return t}moveBox(t,e,i){const{minX:n,maxX:s,minY:o,maxY:r}=this.getBounds(t);e=Jd(e,-n,this.area.width-s),i=Jd(i,-o,this.area.height-r);for(let n=0;n<4;n++)t[2*n]+=e,t[2*n+1]+=i;return t}isPointOnBox(t,e){if(this.isRect){const{minX:i,maxX:n,minY:s,maxY:o}=this.getBounds();return t>=i&&t<=n&&e>=s&&e<=o}const i=[...this.vertexes],n=[...this.midpoints],s=[];for(let t=0;t<4;t++)s.push([i[2*t],i[2*t+1]]),s.push([n[2*t],n[2*t+1]]);return function(t,e){let i,n,s,o,r=0;const a=e.length;for([s]=e,i=1;i<=a;i++)o=e[i%a],t[0]>Math.min(s[0],o[0])&&t[0]<=Math.max(s[0],o[0])&&t[1]<=Math.max(s[1],o[1])&&s[0]!==o[0]&&(n=(t[0]-s[0])*(o[1]-s[1])/(o[0]-s[0])+s[1],(s[1]===o[1]||t[1]<=n)&&(r+=1)),s=o;return r%2!=0}([t,e],s)}}function zk(t){const e=t.slice(0,8).concat(t[0],t[1]),i=[];for(let t=0;t<4;t++){const n=(e[2*t]+e[2*(t+1)])/2,s=(e[2*t+1]+e[2*(t+1)+1])/2;i.push(n,s)}return i}class Gk{constructor(t,e,i){na(this,"areaUid",void 0),na(this,"left",void 0),na(this,"top",void 0),na(this,"width",void 0),na(this,"height",void 0),na(this,"boxes",void 0),na(this,"isVisible",!0),na(this,"zoom",1),na(this,"oldRect",void 0),na(this,"oldQuad",void 0),na(this,"isModified",!1),na(this,"isDrawNewBox",!1),na(this,"activeBoxUid",void 0),na(this,"activePartNum",-1),na(this,"startX",void 0),na(this,"startY",void 0),na(this,"isMouseDown",!1),na(this,"isDrawing",!1),na(this,"renderer",void 0),this.renderer=t,this.areaUid=e,this.boxes=[],this.updateAreaRect(i)}hasActiveBox(){return!!this.activeBoxUid}getFullVertexes(){return[0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(t){return t.left>=0&&t.left<=this.width&&t.left+t.width<=this.width&&t.top>=0&&t.top<=this.height&&t.top+t.height<=this.height}isContainBox(t){const e=t.getRect();return this.isContainRect(e)}isFullBox(t){const{vertexes:e}=t;return 0===e[0]&&0===e[1]&&e[2].toFixed(2)===this.width.toFixed(2)&&0===e[3]&&e[4].toFixed(2)===this.width.toFixed(2)&&e[5].toFixed(2)===this.height.toFixed(2)&&0===e[6]&&e[7].toFixed(2)===this.height.toFixed(2)}addRectBox(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t=this.handleBoundary(t),this.addBox(t,!0,e)}updateRectBox(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.getRect(),s=t.getQuad();if(e=this.handleBoundary(e),t.initBox(e),i){const e={box:t};t.isRect?(e.oldRect=n,e.newRect=t.getRect()):(e.oldQuad=s,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e)}}handleBoundary(t){t=[...t];for(let e=0;e<4;e++){const i=[t[2*e],t[2*e+1]];i[0]=Jd(i[0],0,this.width),i[1]=Jd(i[1],0,this.height),[t[2*e],t[2*e+1]]=i}return t}addQuadBox(t){return this.addBox(t,!1)}addBox(t){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=new jk({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...t],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(i),e&&this.renderer.hooks.boxCreated.emit(i),i}getBoxRects(){return this.boxes.map(((t,e)=>({index:e,...t.getRect()})))}getBoxByUid(t){return this.boxes.find((e=>e.uid===t))}deleteBoxByUid(t){const e=this.boxes.findIndex((e=>e.uid===t));e>-1&&this.boxes.splice(e,1)}clearBoxes(){this.boxes.length=0}updateAreaRect(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height}setKeepAspectRatio(t){this.isDrawing||this.boxes.forEach((e=>{e.keepAspectRatio=t}))}isTouchedPoint(t,e,i){return t=Jd(t,0,this.width),e=Jd(e,0,this.height),this.boxes.some((n=>{const s=n.getActivePartNum(t,e,i);return s>-1&&s<8}))}isTouchedBox(t,e,i){return t=Jd(t,0,this.width),e=Jd(e,0,this.height),this.boxes.some((n=>n.getActivePartNum(t,e,i)>-1))}onStartHandler(t,e,i){this.isMouseDown=!0,t=Jd(t,0,this.width),e=Jd(e,0,this.height),this.startX=t,this.startY=e;const n=this.boxes.find((n=>{const s=n.getActivePartNum(t,e,i);return s>-1&&(this.activePartNum=s),s>-1}));n&&(this.oldRect=n.getRect(),this.oldQuad=n.getQuad(),this.activeBoxUid=n.uid,n.keepAspectRatio=this.renderer.config.keepAspectRatio,n.onStartHandler(t,e,void 0,i))}onMoveHandler(t,e,i,n){if(!this.isMouseDown)return;let s;if(t=Jd(t,0,this.width),e=Jd(e,0,this.height),this.activeBoxUid){if(s=this.getBoxByUid(this.activeBoxUid),!s)return;const{keepAspectRatioWithShift:n,keepAspectRatio:o,enableMoveQuad:r}=this.renderer.config;if(s.isRect)s.keepAspectRatio=!(!i||!n)||o;else if(!r&&8===this.activePartNum)return;return s.onMoveHandler(t,e),void(this.isModified=!0)}const{enableCreateBoxByPointer:o,enableMultiple:r}=this.renderer.config;if((r||!this.boxes.length)&&o){const{startX:i,startY:o}=this;let r=e-o;const a=t-i;let l=-1;const h=2/this.zoom;if(a<-h&&r<-h?l=0:a>h&&r<-h?l=1:a>h&&r>h?l=2:a<-h&&r>h&&(l=3),l>-1){const{aspectRatio:h}=this.renderer.config;h>0&&(r=a/h,l%2&&(r=-a/h));const c=[],d=l%2?[i,o,i,o+r,t,o+r,t,o]:[t,o+r,i,o+r,i,o,t,o];for(let t=0;t<4;t++)c.push(d[2*(l+t)%8]),c.push(d[(2*(l+t)+1)%8]);s=this.addRectBox(c,!1),this.isDrawNewBox=!0,s.keepAspectRatio=h>0,this.isDrawing=!0,this.activeBoxUid=s.uid,s.onStartHandler(this.startX,this.startY,l,n),s.onMoveHandler(t,e,l)}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const t=this.getBoxByUid(this.activeBoxUid);if(t){if(t.keepAspectRatio=this.renderer.config.keepAspectRatio,t.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(t);else if(this.isModified){const e={box:t};t.isRect?(e.oldRect=this.oldRect,e.newRect=t.getRect()):(e.oldQuad=this.oldQuad,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e)}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1}}isPointHover(t){let[e,i]=t;return e>=0&&e<=this.width&&i>=0&&i<=this.height}getCursorInfo(t,e,i){for(let n=this.boxes.length-1;n>=0;n--){const s=this.boxes[n],o=s.getActivePartNum(t,e,i);if(o>-1){let t="move";return o<8&&(t=s.checkOrientation(o)),{part:o,position:t,isRect:s.isRect}}}return null}}const Yk={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class $k{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};na(this,"areas",void 0),na(this,"scrollTop",0),na(this,"scrollLeft",0),na(this,"zoom",1),na(this,"config",void 0),na(this,"canvasDom",void 0),na(this,"isMousedown",!1),na(this,"isEditing",!1),na(this,"editingCursor","crosshair"),na(this,"hoveredArea",void 0),na(this,"hooks",{boxCreated:ou(),boxModified:ou(),boxDeleted:ou()}),this.areas=new Map,this.zoom=1,this.config=Wd(Yk),ju(t,this.config),this.setCanvasDom(t.canvas)}setCanvasDom(t){t&&(this.canvasDom=t)}updateConfig(t){ju(t,this.config)}addArea(t,e){if(this.areas.has(t)){const i=this.areas.get(t);return i.updateAreaRect(e),i}const i=new Gk(this,t,e);return this.areas.set(t,i),i}deleteArea(t){this.areas.has(t)&&(this.areas.get(t).boxes.forEach((t=>{this.hooks.boxDeleted.emit(t)})),this.areas.delete(t))}clearArea(){this.areas.forEach((t=>{t.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t)}))})),this.areas.clear()}clearAreaBoxes(t){if(this.areas.has(t)){const e=this.areas.get(t);e.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t)})),e.clearBoxes()}}addRectBox(t,e){return this.areas.get(e).addRectBox(t)}addQuadBox(t,e){return this.areas.get(e).addQuadBox(t)}updateOptions(t){Object.assign(this,t),qd(t.zoom)&&this.areas.forEach((e=>{e.zoom=t.zoom}))}getAreaByUid(t){return this.areas.get(t)}deleteAreaByUid(t){this.areas.delete(t)}getHoveredArea(t){const e=this.nativeToCanvas(t);for(const t of this.areas.values()){const i=this.canvasToArea(e,t);if(t.isPointHover(i)&&t.isVisible)return t}return null}getHoveredAreaForCursor(t){const e=Iu(t),i=this.nativeToCanvas(t);for(const t of this.areas.values()){const n=this.canvasToArea(i,t),[s,o]=n,r=t.isVisible&&t.boxes.find((t=>t.getActivePartNum(s,o,e)>-1));if(t.isPointHover(n)||r)return t}return null}isControlPointTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return!1;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Iu(t);return e.isTouchedPoint(n,s,o)}isBoxTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return!1;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Iu(t);return e.isTouchedBox(n,s,o)}onStartHandler(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return;this.hoveredArea=e,this.isMousedown=!0;const i=this.nativeToCanvas(t),[n,s]=this.canvasToArea(i,e),o=Iu(t);e.onStartHandler(n,s,o)}onMoveHandler(t){if(!this.canvasDom)return;const{defaultCursor:e}=this.config,i=this.getHoveredArea(t);if(i){if(!i.isVisible)return}else this.canvasDom.style.cursor=e;const n=Iu(t),s=this.nativeToCanvas(t);if(this.isMousedown){const[e,i]=this.canvasToArea(s,this.hoveredArea);this.hoveredArea.onMoveHandler(e,i,Ru(t),n)}if(this.config.enableCursor&&i){const t="crosshair",o="move",{canvasDom:r}=this;if(this.hasBox()){const[a,l]=this.canvasToArea(s,i),h=i.getCursorInfo(a,l,n);let c;if(null===h)c=this.config.enableMultiple?t:e;else if(h.isRect){const e=h.position===o;this.isMousedown?this.isEditing||(this.editingCursor=e?o:t,this.isEditing=!0):c=e?o:`${h.position}-resize`}else h.part>-1&&h.part<8?this.isMousedown?this.isEditing||(this.editingCursor=t,this.isEditing=!0):c=t:c=e;this.isEditing&&(c=this.editingCursor),r.style.cursor=c}else r.style.cursor!==t&&(r.style.cursor=t)}}hasBox(){for(const t of this.areas.values())if(t.isVisible&&t.boxes.length)return!0;return!1}onEndHandler(t){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null)}render(){if(!this.canvasDom||!this.areas.size)return;const t=this.canvasDom.getContext("2d");t.setTransform(1,0,0,1,0,0),this.areas.forEach((e=>{e.isVisible&&e.boxes.length&&this.renderArea(t,e)}))}renderArea(t,e){const{borderStyle:i,borderColor:n,borderWidth:s,ctrlBorderColor:o,ctrlBackground:r,ctrlBorderWidth:a,ctrlBorderStyle:l,background:h,maskColor:c,invalidBorderColor:d,invalidCtrlBorderColor:u,ctrlBorderRadius:p,ctrlWidth:g,ctrlHeight:f}=this.config.boxStyle,m=devicePixelRatio,v=g*m,y=f*m,x=Math.min(p*m,v/2,y/2),w=[i[0]*m,i[1]*m],b=s*m,C=a*m,S=[l[0]*m,l[1]*m];t.save(),t.beginPath(),t.rect(e.left*m,e.top*m,e.width*e.zoom*m,e.height*e.zoom*m),t.closePath(),t.clip(),this.config.enableMask&&c&&(t.save(),t.beginPath(),t.rect(e.left*m,e.top*m,e.width*e.zoom*m,e.height*e.zoom*m),e.boxes.forEach((i=>{let n=this.areaPointsToCanvas(i.points.slice(0,8),e),s=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==m&&(n=n.map((t=>t*m)),s=s.map((t=>t*m))),t.moveTo(n[0],n[1]);for(let e=1;e<4;e++)t.lineTo(n[2*e],n[2*e+1])})),t.closePath(),t.clip("evenodd"),t.fillStyle=c,t.fill(),t.restore()),e.boxes.forEach((i=>{let s=this.areaPointsToCanvas(i.points.slice(0,8),e),a=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==m&&(s=s.map((t=>t*m)),a=a.map((t=>t*m))),t.save(),t.setLineDash(w),t.strokeStyle=i.isConvex?n:d,t.fillStyle=""===h?"transparent":h,t.lineWidth=b,t.beginPath(),t.moveTo(s[0],s[1]);for(let e=1;e<4;e++)t.lineTo(s[2*e],s[2*e+1]);t.closePath(),t.fill(),t.stroke(),t.setLineDash(S),t.strokeStyle=i.isConvex?o:u,t.fillStyle=""===r?"transparent":r,t.lineWidth=C,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(t,s,v,y,x,this.config.enableHideEditingCropBoxVertex?i.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(t,a,v,y,x,this.config.enableHideEditingCropBoxMidpoint?i.selectedPart-4:-1),t.restore()})),t.restore()}drawCtrlPoints(t,e,i,n,s,o){const r=i/2,a=n/2;for(let l=0;l<4;l++){if(l===o)continue;t.beginPath();const h=e[2*l],c=e[2*l+1];if(0===s)t.rect(h-r,c-a,i,n);else{const{PI:e}=Math;t.arc(h-r+s,c-a+s,s,e,3*e/2),t.arc(h+r-s,c-a+s,s,3*e/2,2*e),t.arc(h+r-s,c+a-s,s,0,e/2),t.arc(h-r+s,c+a-s,s,e/2,e)}t.closePath(),t.fill(),t.stroke()}}areaPointsToCanvas(t,e){const i=[];for(let n=0;n<4;n++){const[s,o]=this.areaToCanvas([t[2*n],t[2*n+1]],e);i.push(s,o)}return i}canvasToArea(t,e){let[i,n]=t;const{scrollLeft:s,scrollTop:o,zoom:r}=this;return i=(i-e.left+s)/r,n=(n-e.top+o)/r,[i,n]}areaToCanvas(t,e){let[i,n]=t;const{scrollLeft:s,scrollTop:o,zoom:r}=this;return i=i*r+e.left-s,n=n*r+e.top-o,[i,n]}nativeToCanvas(t){const e=function(t){return["touchstart","touchend","touchmove"].includes(t.type)}(t)?t.targetTouches[0]:t,i=this.canvasDom.getBoundingClientRect(),{scrollX:n,scrollY:s}=window;return[e.pageX-n-i.left,e.pageY-s-i.top]}}class Xk{constructor(t){na(this,"canvas",void 0),na(this,"style",{type:"rect",size:100,borderColor:"#323232",borderWidth:3,magnification:3,crosshairWidth:1,crosshairColor:"#323232"}),Object.assign(this.style,t||{}),this.canvas=document.createElement("canvas")}render(t){const{type:e,size:i,borderColor:n,borderWidth:s,magnification:o,crosshairColor:r,crosshairWidth:a}=this.style,l=i/2*devicePixelRatio,h=i*devicePixelRatio,c=2*Math.PI,d=t.canvas.getContext("2d");d.save(),d.setTransform(1,0,0,1,0,0),t.targetX*devicePixelRatio<h&&t.targetY*devicePixelRatio<h?d.translate(t.canvas.width-l,l):d.translate(l,l),d.beginPath(),"circle"===e?d.arc(0,0,l,0,c):d.rect(-l,-l,h,h),d.clip(),d.scale(o,o),d.clearRect(-l,-l,2*l,2*l);const u=d.getImageData(t.targetX*devicePixelRatio-l,t.targetY*devicePixelRatio-l,h,h);this.canvas.width=h,this.canvas.height=h,this.canvas.getContext("2d").putImageData(u,0,0),d.drawImage(this.canvas,-l,-l,h,h),d.closePath(),d.strokeStyle=n,d.lineWidth=s,d.stroke(),d.beginPath();const p=.5*l/o;d.moveTo(0,-p),d.lineTo(0,p),d.moveTo(-p,0),d.lineTo(p,0),d.closePath(),d.strokeStyle=r,d.lineWidth=a/o,d.stroke(),d.restore()}}class qk{constructor(t,e){na(this,"context",void 0),na(this,"core",void 0),na(this,"boxRenderer",void 0),na(this,"viewer",void 0),na(this,"isMousedown",!1),na(this,"magnifier",void 0),na(this,"canvas",void 0),na(this,"isRenderMagnifier",!1),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e,this.magnifier=new Xk(this.context.viewerConfig.croppingMagnifierStyle),this.canvas=this.context.rendererService.getCanvasDom()}isEditCropBox(t){const e=this.boxRenderer.getHoveredArea(t);return!(!e||!e.isVisible||e.boxes.length&&!this.boxRenderer.isBoxTouched(t))}mousedown(t){const{context:e}=this,i=this.context.getActiveTab();if(null==i||!i.total)return;if("crop"!==this.context.viewerConfig.toolMode)return;const[n]=this.context.toCanvas(t),{page:s}=this.context.getPointerOverPageInfo(n.pageX,n.pageY).pageInfo;if(i&&s&&s.uid!==i.currentUid){const t=i.getPageIndex(s);i.gotoPage(t),this.context.emitPageChangedEvent(i),this.context.core.viewerService.onCurrentChangedByScroll.emit(bS.create(i.uid,e.groupUid,e.uid,t)),this.context.emitPageChangedAfterRenderEvent(i)}this.isMousedown=!0,this.boxRenderer.onStartHandler(t);const o=!this.boxRenderer.hasBox()||this.boxRenderer.isControlPointTouched(t);this.isRenderMagnifier=o,o&&e.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)&&this.magnifier.render({target:this.canvas,targetX:n.pageX,targetY:n.pageY,canvas:this.canvas,canvasX:n.pageX,canvasY:n.pageY})}mousemove(t){const e=this.context.getActiveTab();if(null!=e&&e.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&t instanceof TouchEvent&&t.cancelable&&t.preventDefault(),this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render(),this.isRenderMagnifier&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType))){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY})}}mouseup(t){this.isMousedown&&(this.boxRenderer.onEndHandler(t),this.isRenderMagnifier=!1,this.isMousedown=!1,this.context.render())}afterPerspective(t){let{pageUid:e,docUid:i,width:n,height:s}=t;const{context:o}=this,r=o.tabService.getTab(i);if(!r)return;const a=r.getPageByUid(e);if(a&&(a.rWidth=n,a.rHeight=s,o.clearOptimization([a.uid])),r.isActive){if("crop"===o.viewerConfig.toolMode){this.boxRenderer.areas.forEach((t=>{t.clearBoxes()}));const t=this.boxRenderer.getAreaByUid(e),i=r.getPageByUid(e).getRect();null==t||t.updateAreaRect(i)}a&&(a.isLoaded=!1),o.scrollByCurrentChanged=!0;let t=!0;this.context.isDefaultViewer?"none"===r.context.fitMode&&(t=!1):this.context.isThumbnailViewer&&(t=!1),this.context.showTab(r,t)}}afterRotatePages(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=this.context.getActiveTab();null!=i&&i.total&&i.uid===t.docUid&&(this.boxRenderer.areas.forEach((t=>{t.clearBoxes()})),t.pageUids.forEach((t=>{const e=this.boxRenderer.getAreaByUid(t),n=i.getPageByUid(t).getRect();null==e||e.updateAreaRect(n)})),this.context.render())}afterRender(t){const{context:e}=this;"crop"===e.viewerConfig.toolMode&&(t.pages.forEach((e=>{const i=this.boxRenderer.getAreaByUid(e.uid);if(i){if(e.isVisible){const t=e.getRect();i.updateAreaRect(t)}"current"===this.viewer.cropMode?i.isVisible=e.uid===t.currentUid:i.isVisible=e.isVisible}})),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.boxRenderer.render())}toolModeChanged(t){if("crop"!==t.oldToolMode&&"crop"===t.newToolMode){const t=this.context.getActiveTab();if(!t)return;t.pages.forEach((e=>{const i=e.getRect(),n=this.boxRenderer.addArea(e.uid,i);"current"===this.viewer.cropMode?n.isVisible=e.uid===t.currentUid:n.isVisible=e.isVisible})),this.boxRenderer.updateOptions({zoom:t.context.zoom})}else"crop"!==t.newToolMode&&"crop"===t.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render())}pageChanged(t){if("crop"===this.context.viewerConfig.toolMode)return this.context.getActiveTab()?0===t.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(t){t.pageUids.forEach((t=>{this.boxRenderer.deleteArea(t)}))}updatePage(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=e.getActiveTab();if(i&&i.uid===t.docUid)if("current"===this.viewer.cropMode&&t.pageUid===i.currentUid)this.resetPageCropArea();else if("all"===this.viewer.cropMode){const n=this.boxRenderer.getAreaByUid(t.pageUid),s=i.getPageByUid(t.pageUid).getRect();n.updateAreaRect(s),this.boxRenderer.areas.forEach((t=>{t.clearBoxes()})),e.render()}}addPages(t){const e=this.context.getActiveTab();null!=e&&e.total&&e.uid===t.docUid&&(t.pageUids.forEach((t=>{const i=e.getPageByUid(t),n=i.getRect();this.boxRenderer.addArea(i.uid,n),this.boxRenderer.updateOptions({zoom:e.context.zoom})})),this.boxRenderer.areas.forEach((t=>{t.clearBoxes()})))}resetPageCropArea(){const t=this.context.getActiveTab();this.clearRedundantBoxes();const e=t.getCurrentPage(),i=e.getRect();this.boxRenderer.addArea(e.uid,i),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.context.render()}clearRedundantBoxes(){const t=this.context.getActiveTab();t&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach((e=>{e.areaUid!==t.currentUid&&this.boxRenderer.clearAreaBoxes(e.areaUid)}))}}class Zk{constructor(t,e){na(this,"context",void 0),na(this,"core",void 0),na(this,"boxRenderer",void 0),na(this,"viewer",void 0),na(this,"isMousedown",!1),na(this,"canSlide",!1),na(this,"isStart",!1),na(this,"startX",void 0),na(this,"isSliding",void 0),na(this,"slideDistance",void 0),na(this,"slideDirection",void 0),na(this,"slideRAF",void 0),na(this,"tabX",void 0),na(this,"tabY",void 0),na(this,"magnifier",void 0),na(this,"canvas",void 0),na(this,"isRenderMagnifier",!1),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e,this.magnifier=new Xk(this.context.viewerConfig.croppingMagnifierStyle),this.canvas=this.context.rendererService.getCanvasDom()}mousedown(t){const e=this.context.getActiveTab();if(null!=e&&e.total)if(this.isMousedown=!0,!this.boxRenderer.isControlPointTouched(t)&&this.context.viewerConfig.enableSlide)this.canSlide=!0,this.slideStart(t);else{this.boxRenderer.onStartHandler(t);const e=this.boxRenderer.isControlPointTouched(t);if(this.isRenderMagnifier=e,e&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY})}}}mousemove(t){const e=this.context.getActiveTab();if(null!=e&&e.total)if(Iu(t)&&t.cancelable&&t.preventDefault(),this.canSlide)this.slideMove(t);else if(this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render(),this.isRenderMagnifier&&this.context.viewerConfig.enableMagnifier&&["touch","pointer"].includes(t.pointerType)){const[e]=this.context.toCanvas(t);this.magnifier.render({target:this.canvas,targetX:e.pageX,targetY:e.pageY,canvas:this.canvas,canvasX:e.pageX,canvasY:e.pageY})}}mouseup(t){this.isMousedown&&(this.canSlide?this.slideEnd(t):this.boxRenderer.onEndHandler(t),this.isRenderMagnifier=!1,this.canSlide=!1,this.isMousedown=!1,this.context.render())}reRender(){const{context:t}=this,e=t.getActiveTab();null!=e&&e.total&&"visible"===t.viewerConfig.visibility&&(this.updatePageQuad(e),t.render())}updatePage(t){const{context:e}=this,i=e.getActiveTab();null!=i&&i.total&&"visible"===e.viewerConfig.visibility&&i.currentUid===t.pageUid&&(this.updatePageQuad(i),e.render())}afterRender(t){if(null==t||!t.total)return;const{boxRenderer:e}=this;t.pages.forEach((t=>{const i=e.getAreaByUid(t.uid);if(i&&t.isVisible){const e=t.getRect();i.updateAreaRect(e)}})),e.updateOptions({zoom:t.context.zoom}),e.render()}pageChanged(t){if(-1===t.current&&0===t.total)return void this.boxRenderer.clearArea();const e=this.context.getActiveTab();e&&this.updatePageQuad(e)}updatePageQuad(t){const{context:e}=this,i=t.getCurrentPage();if(!i)return!1;let n=null;const s=this.boxRenderer.getAreaByUid(i.uid);s&&s.boxes[0]&&(n=s.boxes[0].getQuad());const o=e.core.pageService.getPage(t.currentUid);this.boxRenderer.clearArea();const r=i.getRect(),a=this.boxRenderer.addArea(i.uid,r);this.boxRenderer.updateOptions({zoom:t.context.zoom});const l=o.getQuadVertices(),h=a.addQuadBox(l);let c=h.getQuad();e.hooks.perspectiveQuadChanged.emit(_S.create(h.getQuad(),o.isFull)),n&&(n=o.quadToPixelPPI(n)),c&&(c=o.quadToPixelPPI(c)),JS(n),JS(c);let d=!1;return n&&c&&(d=Xu(n,c)),d||e.viewer.emit("quadModified",GC.create(n,c)),h}afterRotatePages(t){const e=this.context.getActiveTab();null!=e&&e.total&&t.pageUids.includes(e.currentUid)&&(this.updatePageQuad(e),this.context.render())}afterPerspective(t){let{pageUid:e,docUid:i}=t;const{context:n}=this,s=this.context.getActiveTab();if(null==s||!s.total)return;if(s.uid!==i||s.currentUid!==e)return;const o=s.getCurrentPage();o&&(o.isLoaded=!1),this.updatePageQuad(s),n.scrollByCurrentChanged=!0,n.showTab(s,!0)}slideStart(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:n}=this.context.viewService.getMaxScrollValue();if(i||n)return;const s=this.context.toCanvas(t);if(s.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=s[0].pageX,this.isStart=!0}slideMove(t){if(!this.isStart)return;const{context:e}=this,{viewerConfig:i}=e,n=e.getActiveTab(),s=e.toCanvas(t)[0].pageX-this.startX;if(s>0?this.slideDirection="right":s<0&&(this.slideDirection="left"),this.slideDistance=Math.min(n.context.viewportWidth,Math.abs(s)),this.isSliding)"right"===this.slideDirection?n.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&n.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===n.context.displayMode&&"crop"===i.toolMode&&i.enableSlide){const{scrollLeft:t,scrollTop:n}=this.context.viewService.getMaxScrollValue();Math.abs(s)>i.startSlideThresholdForPerspective&&!t&&!n&&(this.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}))}}slideEnd(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),{displayMode:n}=i.context;"slide"===n&&this.slide(i),this.isStart=!1}slide(t){let e,i=0,n=0,s=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThresholdForPerspective)?(n=t.context.viewportWidth,e=n-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(s=-this.slideDistance,i=-e/6):(n=0,e=this.slideDistance,o=!0,s=-this.slideDistance,i=e/6):0!==t.current?(s=this.slideDistance,i=e/6):(n=0,e=this.slideDistance,o=!0,s=this.slideDistance,i=-e/6)):(o=!0,n=0,e=this.slideDistance,"left"===this.slideDirection?(s=-this.slideDistance,i=e/6):(s=this.slideDistance,i=-e/6));const l=()=>{s+=i;const e=s>=0;if(Math.abs(s)>=n&&(s=n,e||(s*=-1)),t.setPosition({x:s+this.tabX,y:this.tabY,z:0}),Math.abs(s)===n)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render()};this.slideRAF=requestAnimationFrame(l)}}class Jk{constructor(t){na(this,"service",void 0),this.service=t}startHandler(t){this.service.mousedown(t)}moveHandler(t){this.service.mousemove(t)}endHandler(t){this.service.mouseup(t)}isEditCropBox(t){return this.service.isEditCropBox(t)}}class Kk{constructor(t){na(this,"service",void 0),this.service=t}startHandler(t){this.service.mousedown(t)}moveHandler(t){this.service.mousemove(t)}endHandler(t){this.service.mouseup(t)}}function Qk(t,e){return{left:qu(t.left,e),top:qu(t.top,e),width:qu(t.width,e),height:qu(t.height,e)}}const tR={install(t){const e=t.getClass("Viewer"),i=(n=e,class extends n{constructor(t){super(t),na(this,"boxRenderer",void 0),na(this,"iCropMode","current"),na(this,"cropRectService",void 0),na(this,"perspectiveQuadService",void 0);const{isDefaultViewer:e,isPerspectiveViewer:i}=this.context;(e||i)&&this.initBoxRenderer(),this.cropRectService=new qk(this,this.boxRenderer),this.perspectiveQuadService=new Zk(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new Jk(this.cropRectService),this.context.perspectiveQuadEditService=new Kk(this.perspectiveQuadService)}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:t},enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:n,enableHideEditingCropBoxVertex:s}=this.context.viewerConfig;this.boxRenderer=new $k({defaultCursor:t,enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:n,enableHideEditingCropBoxVertex:s}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on((()=>{this.updateQuadStyle()}),this),this.context.hooks.canvasCursorStyleChanged.on((()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor})}),this),this.hooks.resize.on((()=>{this.context.render()}));const{hooks:o}=this.boxRenderer;o.boxCreated.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&(this.context.isDefaultViewer&&t.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach((e=>{e.boxes.length?e.boxes.forEach((i=>{e.isContainBox(t)?e.updateRectBox(i,[...t.vertexes]):e.clearBoxes()})):e.isContainBox(t)&&e.addRectBox([...t.vertexes],!1)})),t.isRect)){let e=t.getRect();e=$u(e,Ep.displayResolution,72),e=Qk(e,2);const i=MC.create(e);this.hooks.cropRectDrawn.emit(i),this.emit("cropRectDrawn",i)}})),o.boxDeleted.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&t.isRect){let e=t.getRect();e=$u(e,Ep.displayResolution,72),e=Qk(e,2);const i=RC.create(e);this.hooks.cropRectDeleted.emit(i),this.emit("cropRectDeleted",i)}})),o.boxModified.on((t=>{const e=this.context.getActiveTab();if(null==e||!e.total)return;const{box:i}=t;if(this.context.isDefaultViewer&&i.isRect){let{oldRect:e,newRect:n}=t,s=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach((t=>{t.boxes.length?t.boxes.forEach((e=>{t.isContainBox(i)?(s+=1,t.updateRectBox(e,[...i.vertexes])):t.clearBoxes()})):t.isContainBox(i)&&t.addRectBox([...i.vertexes])})),e&&(e=$u(e,Ep.displayResolution,72),e=Qk(e,2)),n&&(n=$u(n,Ep.displayResolution,72),n=Qk(n,2)),!e||!n||e.left!==n.left||e.top!==n.top||e.width!==n.width||e.height!==n.height){s=Math.max(1,s);for(let t=0;t<s;t++){const t=LC.create(e,n);this.emit("cropRectModified",t)}}}if(this.context.isPerspectiveViewer&&!i.isRect){const e=this.context.core.pageService.getPage(i.area.areaUid),n=this.boxRenderer.getAreaByUid(i.area.areaUid);if(!n)return;const s=n.isFullBox(i);e.isFull=s,e.setActiveQuad(i.getQuad());let{oldQuad:o,newQuad:r}=t;o&&(o=e.quadToPixelPPI(o)),r&&(r=e.quadToPixelPPI(r)),JS(o),JS(r),this.hooks.perspectiveQuadChanged.emit(_S.create(r,e.isFull));let a=!1;o&&r&&(a=Xu(r,o)),a||this.emit("quadModified",GC.create(o,r))}}))}updateQuadStyle(){const t=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:t})}get cropMode(){return this.iCropMode}set cropMode(t){if(this.iCropMode===t)return;const e=this.iCropMode;this.iCropMode=t;const i=this.context.getActiveTab();if(null!=i&&i.total){if("current"===e&&"all"===t){const t=this.boxRenderer.getAreaByUid(i.currentUid).boxes[0];t&&this.boxRenderer.areas.forEach((e=>{e.isContainBox(t)?e.boxes.length?e.updateRectBox(e.boxes[0],[...t.vertexes]):e.addRectBox([...t.vertexes]):e.clearBoxes()}))}this.cropRectService.clearRedundantBoxes(),this.context.render()}}toggleFullPerspective(){const{context:t}=this;if(!t.isPerspectiveViewer)return;const e=t.getActiveTab();null!=e&&e.total&&t.core.pageService.getPage(e.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(e),t.render())}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on((t=>{this.cropRectService.afterRotatePages(t)}),this),this.context.core.onAfterPerspective.on((t=>{this.cropRectService.afterPerspective(t)}),this))}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on((t=>{this.perspectiveQuadService.afterRotatePages(t)}),this),this.context.core.onAfterPerspective.on((t=>{this.perspectiveQuadService.afterPerspective(t)}),this))}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:t}=this;this.hooks.resize.on((()=>{t.reRender()})),this.hooks.visibleChanged.on((()=>{t.reRender()})),this.hooks.updatePage.on((e=>{t.updatePage(e)})),this.hooks.afterRender.on((e=>{t.afterRender(e)})),this.hooks.pageChanged.on((e=>{t.pageChanged(e)}))}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:t}=this;this.hooks.updatePage.on((e=>{t.updatePage(e)})),this.hooks.addPagesToDoc.on((e=>{t.addPages(e)})),this.hooks.afterRender.on((e=>{t.afterRender(e)})),this.hooks.toolModeChanged.on((e=>{t.toolModeChanged(e)})),this.hooks.pageChanged.on((e=>{t.pageChanged(e)})),this.hooks.deletePages.on((e=>{t.deletePages(e)})),this.hooks.beforeCropPages.on((()=>{this.clearRectBox()}))}setRectBox(t,e){const i=this.context.getActiveTab();return!(!i||!i.total||(Hd(e)&&(e=[i.current]),i.indicesToUids(e).forEach((e=>{let i=t;i=$u(t,Ep.dataResolution,Ep.displayResolution);const n=(t=>{const{left:e,top:i,width:n,height:s}=t;return[e,i,e+n,i,e+n,i+s,e,i+s]})(i),s=this.boxRenderer.areas.get(e);s.boxes.length?s.updateRectBox(s.boxes[0],n,!0):s.addRectBox(n)})),this.context.render(),0))}getRectBox(){const t=this.context.getActiveTab();if(t&&t.total){let e=null;if(t.pages.find((t=>{const i=this.boxRenderer.getAreaByUid(t.uid);return!(null==i||!i.boxes.length||(e=i,0))})),e){const t=e.boxes[0];if(null!=t&&t.isRect){let e=t.getRect();return e=$u(e,Ep.displayResolution,Ep.dataResolution),e=Qk(e,2),e.width=e.width||1,e.height=e.height||1,e}}}return null}getRenderedRectBoxCount(){const t=this.context.getActiveTab();let e=0;return t&&t.total&&this.boxRenderer.areas.forEach((t=>{e+=t.boxes.length})),e}getCropIndices(){const t=this.context.getActiveTab();let e=[];if(t&&t.total)if("all"===this.iCropMode){const i=[];this.boxRenderer.areas.forEach((t=>{t.boxes.length&&i.push(t.areaUid)})),e=t.uidsToIndices(i)}else e=[t.current];return e}clearRectBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes()})),!0}setQuadBox(t){const e=this.context.getActiveTab();if(!e||!e.total)return!1;const i=this.context.core.pageService.getPage(e.currentUid);let n=t;n=t.map((t=>$u(t,i.resource.resolutionX,Ep.displayResolution)));const s=this.boxRenderer.getAreaByUid(e.currentUid),{width:o,height:r}=s,a=YS(n,o,r);return i.isFull=a,i.setActiveQuad(n),this.perspectiveQuadService.updatePageQuad(e),this.hooks.perspectiveQuadChanged.emit(_S.create(n,i.isFull)),this.context.render(),!0}getQuadBox(){const t=this.context.getActiveTab();if(t&&t.total){const e=this.boxRenderer.getAreaByUid(t.currentUid).boxes[0];if(!e.isRect){let i=e.getQuad();const n=this.context.core.pageService.getPage(t.currentUid);return i=i.map((t=>$u(t,Ep.displayResolution,n.resource.resolutionX))),JS(i),i}}return null}resetQuadBox(t){const e=this.context.getActiveTab();if(null==e||!e.total)return!1;let i=[];return i=Hd(t)?[e.currentUid]:e.indicesToUids(t),i.forEach((t=>{const i=this.context.core.pageService.getPage(t),{quad:n}=i;n?(i.isFull&&(i.isFull=!1),i.setActiveQuad(n),this.perspectiveQuadService.updatePageQuad(e)):i.isFull||(i.isFull=!0,this.perspectiveQuadService.updatePageQuad(e)),i.uid===e.currentUid&&this.hooks.perspectiveQuadChanged.emit(_S.create(n,i.isFull))})),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes()})),!0}isConvexQuad(t){return vu(t.flat())}});var n;t.setClass("Viewer",i)}};class eR extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1)}})),this.isValid=e.length>0}),this)}execute(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).addAction(e)}));const i=CS.create(e.docUid,e.angle,e.pageUids);return t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid)}));const i=CS.create(e.docUid,e.angle,e.pageUids);t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i)}}class iR extends k_{constructor(t,e){super(),na(this,"action",void 0),na(this,"core",void 0),this.action=t,this.core=e,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1)}})),this.isValid=e.length>0}),this)}execute(){const{core:t,action:e}=this;e.pageUids.forEach((e=>{t.pageService.getPage(e).addAction(this.action)}));const i=SS.create(e.docUid,e.rect,e.pageUids);return t.editService.onCropPages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid)}));const i=SS.create(e.docUid,e.rect,e.pageUids);t.editService.onCropPages.emit(i)}}class nR extends Ju{constructor(t){super(),na(this,"core",void 0),na(this,"onRotatePages",void 0),na(this,"onAfterRotatePages",void 0),na(this,"onCropPages",void 0),na(this,"onAfterCropPages",void 0),this.core=t,this.initEventEmitter()}initEventEmitter(){this.onRotatePages=tp(this),this.onAfterRotatePages=tp(this),this.onCropPages=tp(this),this.onAfterCropPages=tp(this)}rotatePages(t,e,i,n){const s={actionUid:Qd(),type:"rotate",docUid:t,pageUids:[...e],angle:i,rotationType:n},{core:o}=this,r=new eR(s,o);return o.commandService.execute(r,t),!0}cropPages(t,e,i){const n={actionUid:Qd(),type:"crop",docUid:t,pageUids:[...e],rect:{...i}},{core:s}=this,o=new iR(n,s);return s.commandService.execute(o,t),!0}}const sR={apply(t){t.editService=new nR(t)},install(t){const e=t.getClass("Viewer"),i=(n=e,class extends n{constructor(t){super(t),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit()}listenGlobalEventsForEdit(){const{context:t}=this,e=e=>{let{docUid:i,pageUids:n}=e;const s=t.tabService.getTab(i);if(null!=s&&s.isActive){t.scrollByCurrentChanged=!0,t.clearOptimization(n);let e=!0;t.isDefaultViewer?"none"===s.context.fitMode&&(e=!1):t.isThumbnailViewer&&(e=!1),t.showTab(s,e)}};t.core.editService.onRotatePages.on(e,this),t.core.editService.onCropPages.on(e,this)}listenViewerEventsForEdit(){this.hooks.beforeLayout.on((t=>{const{core:{pageService:e},isDefaultViewer:i,isThumbnailViewer:n,isPerspectiveViewer:s}=this.context;(i||n||s)&&t.pages.forEach((t=>{let s=null;const o=e.getPage(t.uid);s=i||n?o.getEditResult():o.getEditResultForPerspective(),s&&(t.rWidth=s.rWidth,t.rHeight=s.rHeight,t.cropLeft=s.cropLeft,t.cropTop=s.cropTop,t.cropWidth=s.cropWidth,t.cropHeight=s.cropHeight,t.rotation=s.rotation,t.mediaBoxRect=s.mediaBox,t.cropBoxRect=s.cropBox)}))}))}rotatePages(t,e){var i;if(t%360==0)return!0;const n=this.context.getActiveTab();if(!n)return!1;null!==(i=e)&&void 0!==i||(e=[n.current]);const s=n.indicesToUids(e);return this.context.core.editService.rotatePages(n.uid,s,t,"contain")}cropPages(t,e){var i;const n=this.context.getActiveTab();if(!n)return!1;null!==(i=e)&&void 0!==i||(e=[n.current]);const s=n.indicesToUids(e);return t=$u(t,Ep.dataResolution,Ep.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(n.uid,s,t)}});var n;t.setClass("Viewer",i)}};class oR{async perspective(t,e,i,n){var s;const o=new yp,r=await o.initImage({source:t.data,isRGBA:t.type===cp.RGBA,width:t.width,height:t.height,isBGRA:t.type===cp.BGRA});r.srcBuffer&&(t.data=r.srcBuffer),null!=i&&i.angle&&await o.rotate({angle:i.angle}),await o.perspective(e);const a=await o.getImage({jpegQuality:null==n?void 0:n.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===cp.RGBA,bitDepth:null==n?void 0:n.bitDepth,xDpi:null==n?void 0:n.xdpi,yDpi:null==n?void 0:n.ydpi,returnBlob:!1,returnType:_p[null!==(s=null==n?void 0:n.outputType)&&void 0!==s?s:t.type]});await o.freeReservedData();const l={data:new Blob([a.imageData],{type:a.blobType}),width:a.imageWidth,height:a.imageHeight,resolutionX:a.imageXResolution,resolutionY:a.imageYResolution};return o.terminate(),l}}var rR=new WeakMap,aR=new WeakMap,lR=new WeakSet,hR=new WeakSet,cR=new WeakSet;function dR(t,e,i,n){return(new oR).perspective(t,e,i,n)}function uR(t){return sa(this,rR).push(t),sa(this,aR)||(oa(this,aR,!0),ga(this,cR,pR).call(this)),t.promise}async function pR(){do{if(sa(this,rR).isEmpty())break;const t=sa(this,rR).pop();try{let e;"perspective"===(null==t?void 0:t.api)&&(e=await ga(this,lR,dR).apply(this,t.params)),null==t||t.resolve(e)}catch(e){t.retry<1?(t.retry+=1,sa(this,rR).push(t)):null==t||t.reject(e)}}while(!sa(this,rR).isEmpty());oa(this,aR,!1)}E_.registerPlugin(SP),E_.registerPlugin(Hk),E_.registerPlugin(tR),E_.registerPlugin(sR),E_.registerPlugin(cE),E_.registerPlugin(mD);const gR=new E_(new class{constructor(){this.registerParser("image/jpeg",yy),this.registerParser("image/bmp",yy),this.registerParser("image/png",yy),this.registerParser("image/tiff",xy),this.registerParser("image/jp2",yy),this.registerParser("application/pdf",ux),this.registerParser("image/rgba",gx),this.registerParser("application/ddv-blank-image",Lx)}dispose(){this.reset()}reset(){mx.getAllParsers().forEach((t=>t.destroy())),mx.clear(),xx.clear()}freeParserByFileUid(t){Cx.execute(t)}registerParser(t,e){Ex.execute({mime:t,parser:e})}unregisterParser(t){Px.execute(t)}registerCustomParser(t,e){Ax.execute({mime:t,parser:e})}unregisterCustomParser(t){Ix.execute(t)}getDefaultParserOptions(t){return Dx.execute(t)}setDefaultParserOptions(t,e){return kx.execute({mime:t,options:e})}getCustomParserClasses(t){return Rx.execute(t)}async parse(t,e,i,n,s){return _x.execute({fileData:t,mime:e,fileUid:i,indices:n,parseOptions:s})}async parseAnnotation(t,e,i,n,s,o){return Tx.execute({fileData:t,mime:e,fileUid:i,indices:s,parseOptions:o,parsedPages:n})}async getPage(t,e,i,n){return Sx.execute({fileData:t,mime:e,fileUid:i,fileIndex:n})}cancelGetPage(t,e){bx.execute({fileUid:t,fileIndex:e})}async getParseInfo(t,e,i,n){return Mx.execute({fileData:t,mime:e,fileUid:i,options:n})}},new class{constructor(){this.registerSaver("application/pdf",jp),this.registerSaver("image/png",zp),this.registerSaver("image/jpeg",zp),this.registerSaver("image/tiff",Gp)}registerSaver(t,e){kp.execute({mime:t,saverConstructor:e})}unregisterSaver(t){Rp.execute(t)}getSaver(t){return Dp.execute(t)}},new class{constructor(){va(this,cR),va(this,hR),va(this,lR),ma(this,rR,{writable:!0,value:new Sp}),ma(this,aR,{writable:!0,value:!1})}dispose(){throw new Error("Method not implemented.")}perspective(t,e,i,n){return this.createTask("perspective",[t,e,i,n])}createTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);return i.promise=new Promise(((t,e)=>{i.resolve=t,i.reject=e})),ga(this,hR,uR).call(this,i)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);sa(this,rR).remove(i)}},new class{constructor(){va(this,aw),va(this,rw),va(this,ow),na(this,"filter",void 0),ma(this,nw,{writable:!0,value:new Sp}),ma(this,sw,{writable:!0,value:!1})}get enableFilter(){return!!this.filter}async applyFilter(t,e,i,n){return this.createTask("filter",[t,e,i,n])}cancelFilter(t,e){}setImageFilter(t){t?this.filter=t:this.filter&&(this.filter.destroy(),this.filter=null)}getDefaultFilterType(){var t;return(null===(t=this.filter)||void 0===t?void 0:t.defaultFilterType)||Bx.NONE}getSupportedFilters(){var t;return(null===(t=this.filter)||void 0===t?void 0:t.querySupported())||[]}createTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);return i.promise=new Promise(((t,e)=>{i.resolve=t,i.reject=e})),ga(this,rw,hw).call(this,i)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);sa(this,nw).remove(i)}},new class{constructor(){na(this,"detector",void 0)}get enableDetect(){return this.detector&&this.detector instanceof $x}detect(t,e){var i;return null===(i=this.detector)||void 0===i?void 0:i.detect(t,e)}setDetector(t){t?this.detector=t:this.detector&&(this.detector.destroy(),this.detector=null)}resetDetector(){this.detector&&this.detector.reset()}reset(){var t;null===(t=this.detector)||void 0===t||t.destroy(),this.detector=null}});function fR(t,e,i,n){return!!Hd(t)&&xw.output(e,i,n,void 0,vw.PARAM_MISS,!0)}function mR(t,e,i,n){return!!Vd(t)||xw.output(e,i,n,void 0,vw.PARAM_INVALID)}class vR{static getTooltip(){return fD.getTooltip()}static setTooltip(t){const e="Elements.setTooltip",i="tooltip";return!(fR(t,1,e,i)||!mR(t,1,e,i)||(fD.setTooltip(t),0))}static getDisplayTextConfig(){return fD.getDisplayTextConfig()}static setDisplayTextConfig(t){const e="Elements.displayTextConfig",i="displayTextConfig";return!(fR(t,1,e,i)||!mR(t,1,e,i)||(fD.setDisplayTextConfig(t),0))}static get Layout(){return"Layout"}static get Button(){return"Button"}static get Capture(){return"Capture"}static get Flashlight(){return"Flashlight"}static get CameraConvert(){return"CameraConvert"}static get CameraResolution(){return"CameraResolution"}static get AutoDetect(){return"AutoDetect"}static get AutoCapture(){return"AutoCapture"}static get ImagePreview(){return"ImagePreview"}static get Rotate(){return"Rotate"}static get RotateLeft(){return"RotateLeft"}static get RotateRight(){return"RotateRight"}static get Delete(){return"Delete"}static get DeleteCurrent(){return"DeleteCurrent"}static get DeleteAll(){return"DeleteAll"}static get Zoom(){return"Zoom"}static get ZoomIn(){return"ZoomIn"}static get ZoomOut(){return"ZoomOut"}static get ZoomByPercentage(){return"ZoomByPercentage"}static get Crop(){return"Crop"}static get CropCurrent(){return"CropCurrent"}static get CropAll(){return"CropAll"}static get FullQuad(){return"FullQuad"}static get PerspectiveAll(){return"PerspectiveAll"}static get Undo(){return"Undo"}static get Redo(){return"Redo"}static get Pan(){return"Pan"}static get CropMode(){return"CropMode"}static get Load(){return"Load"}static get Download(){return"Download"}static get Print(){return"Print"}static get Filter(){return"Filter"}static get Restore(){return"Restore"}static get ThumbnailSwitch(){return"ThumbnailSwitch"}static get Pagination(){return"Pagination"}static get FitMode(){return"FitMode"}static get FitWindow(){return"FitWindow"}static get FitHeight(){return"FitHeight"}static get FitWidth(){return"FitWidth"}static get ActualSize(){return"ActualSize"}static get DisplayMode(){return"DisplayMode"}static get SinglePage(){return"SinglePage"}static get ContinuousPage(){return"ContinuousPage"}static get MainView(){return"MainView"}static get SeparatorLine(){return"SeparatorLine"}static get Done(){return"Done"}static get Back(){return"Back"}static get Blank(){return"Blank"}static get Close(){return"Close"}static get AnnotationSet(){return"AnnotationSet"}static get EllipseAnnotation(){return"EllipseAnnotation"}static get EraseAnnotation(){return"EraseAnnotation"}static get InkAnnotation(){return"InkAnnotation"}static get LineAnnotation(){return"LineAnnotation"}static get PolygonAnnotation(){return"PolygonAnnotation"}static get PolylineAnnotation(){return"PolylineAnnotation"}static get RectAnnotation(){return"RectAnnotation"}static get SelectAnnotation(){return"SelectAnnotation"}static get StampIconAnnotation(){return"StampIconAnnotation"}static get StampImageAnnotation(){return"StampImageAnnotation"}static get TextBoxAnnotation(){return"TextBoxAnnotation"}static get TextTypewriterAnnotation(){return"TextTypewriterAnnotation"}static get BringForward(){return"BringForward"}static get BringToFront(){return"BringToFront"}static get SendBackward(){return"SendBackward"}static get SendToBack(){return"SendToBack"}}const yR={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},vR.Flashlight]},vR.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[vR.AutoDetect,vR.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},vR.ImagePreview,vR.CameraConvert]}]},xR={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[vR.Blank,vR.Pagination,vR.Download]},vR.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[vR.DisplayMode,vR.RotateLeft,vR.Crop,vR.Filter,vR.Undo,vR.Delete,vR.Load]}]},wR={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[vR.Blank,vR.Pagination,vR.PerspectiveAll]},vR.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[vR.FullQuad,vR.RotateLeft,vR.RotateRight,vR.DeleteCurrent,vR.DeleteAll]}]},bR={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:vR.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},vR.AutoDetect,{type:vR.Capture,className:"ddv-capture-viewer-capture-desktop"},vR.AutoCapture]},vR.MainView,{type:vR.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},CR={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[vR.FullQuad,vR.RotateLeft,vR.RotateRight,vR.DeleteCurrent,vR.DeleteAll,{type:vR.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:vR.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},vR.MainView]},SR={type:vR.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:vR.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:vR.Layout,children:[vR.ThumbnailSwitch,vR.Zoom,vR.FitMode,vR.DisplayMode,vR.RotateLeft,vR.RotateRight,vR.Crop,vR.Filter,vR.Undo,vR.Redo,vR.DeleteCurrent,vR.DeleteAll,vR.Pan]},{type:vR.Layout,children:[{type:vR.Pagination,className:"ddv-edit-viewer-pagination-desktop"},vR.Load,vR.Download,vR.Print]}]},vR.MainView]},_R={type:vR.Layout,children:[vR.MainView]},TR=Wd(xR);TR.children[0].children=[vR.Blank,vR.Blank,vR.Pagination,vR.AnnotationSet,vR.Download];const ER=Wd(SR);var PR,AR;ER.children[0].children[0].enableScroll=!0,ER.children[0].children[0].children.push(vR.SeparatorLine,vR.AnnotationSet),function(t){t.REJECTED="rejected",t.ACCEPTED="accepted",t.INITIAL_HERE="initialHere",t.SIGN_HERE="signHere",t.WITNESS="witness",t.APPROVED="approved",t.NOT_APPROVED="notApproved",t.DRAFT="draft",t.FINAL="final",t.COMPLETED="completed",t.CONFIDENTIAL="confidential",t.VOID="void"}(PR||(PR={})),function(t){t.NONE="none",t.OPEN="open",t.OPEN_REVERSE="openReverse",t.CLOSED="closed",t.CLOSED_REVERSE="closedReverse",t.BUTT="butt",t.SLASH="slash",t.SQUARE="square",t.DIAMOND="diamond",t.CIRCLE="circle"}(AR||(AR={}));const IR={background:"#e2e1de"},DR={border:"1px solid #707070",background:"#fff"},kR={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},RR={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},MR={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},LR={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};Xd()&&(RR.borderWidth=3,MR.fontSize=72);const OR={...RR,lineEnding:{start:AR.NONE,end:AR.NONE}},BR={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:{...RR},ellipse:{...RR},polygon:{...RR},polyline:{...OR},line:{...OR},ink:{opacity:1,borderWidth:Xd()?3:1,borderColor:"rgb(0,0,0)"},textBox:{...RR,textAlign:"left",textContent:{...MR}},textTypewriter:{opacity:1,textContent:{...MR}},stamp:{opacity:1,stamp:PR.DRAFT}}},FR={canvasStyle:{...IR},quadSelectionStyle:{...kR},enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function NR(t,e){return!!t.getActiveTab()||xw.output(e,void 0,void 0,void 0,vw.DOC_NOT_OPEN)}function UR(t,e,i,n){return!i.getActiveTab().doc.pages.length&&xw.output(n,t,e,void 0,vw.DOC_NO_IMAGE,!0)}function VR(t,e,i,n){return!!function(t){return!(!qd(t)||qd(t)&&!Number.isInteger(t))}(t)||xw.output(n,e,i,void 0,vw.PARAM_INVALID)}function WR(t,e,i,n,s){const o=oO.isUiConfigValid(t,n);if(o.length>0)return xw.output(s,i,n,o);const r=$L(t,e);return!r||xw.output(s,e.charAt(0).toUpperCase()+e.slice(1),r,void 0,vw.ELEMENT_UNSUPPORTED)}function HR(t,e,i,n,s,o){return(t<e||t>i)&&xw.output(n,s,o,void 0,vw.PARAM_OUT_OF_RANGE,!0)}function jR(t,e,i,n){return!!t.includes(e)||xw.output(i,n,void 0,void 0,vw.PAGE_NOT_EXIST)}function zR(t,e,i,n){return!!$d(t)||xw.output(n,e,i,void 0,vw.PARAM_INVALID)}function GR(t,e,i,n,s){const o=xw.formatError(xw.isStringAndNotEmpty(t,s));return!o||xw.output(e,i,n,void 0,o)}function YR(t,e,i,n,s,o,r){const a=oO.isNumberArrayValid(t,s,o,r);return!a.length||xw.output(e,i,n,a,vw.PARAM_INVALID)}class $R{getIsBoundContainer(t){return t.context.viewService.isBindContainer}bindContainer(t,e,i){fR(e,0,i,"container");const n=oO.isContainerParamValid(e);n&&xw.error(i,"container",void 0,n),t.bindContainer(e)}unbindContainer(t){t.unbindContainer()}getIsVisible(t){return"visible"===t.getViewerConfig().visibility}show(t){t.show()}hide(t){t.hide()}getCurrentDocument(t){var e;const i=null===(e=t.getActiveTab())||void 0===e?void 0:e.uid;return i?xO.getDocument(i):null}openDocument(t,e,i){const n="docUid or doc";fR(t,0,i,n),function(t){return!!Zd(t)&&0!==t.trim().length}(t)||Vd(t)||xw.error(i,n,void 0,vw.PARAM_INVALID);const s=Vd(t)?t.uid:t;!function(t,e,i,n,s){t.getDocument(e)||xw.output(0,n,s,void 0,vw.DOC_NOT_EXIST)}(gR.documentService,s,0,i,n),gR.getViewer(e)||xw.error(i,"viewerUid",void 0,vw.PARAM_INVALID),gR.openDocument(s,e)}closeDocument(t,e){return!!NR(t,1)&&(t.closeDocument(),!0)}getStyle(t,e,i,n,s){const o="styleName";if(fR(i,1,s,o)||!GR(i,1,s,o))return null;if(!n.includes(i))return xw.warning(s,o,void 0,vw.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===i)return t.getAnnotationConfig().controlsStyle;const r=t.getViewerConfig();if(i in r){const t=function(t,e){const i=["border","background"],n=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],s={pageStyle:i,selectedPageStyle:i,hoveredPageStyle:i,canvasStyle:[...i,"cursor"],checkboxStyle:[...n,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...n,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(t in s){const i=s[t];return Object.fromEntries(Object.entries(e).filter((t=>{let[e,n]=t;return i.includes(e)})))}return Wd(e)}(i,r[i]);return"capture"===e&&"quadSelectionStyle"===i?{border:t.border,background:t.background}:t}return null}updateStyle(t,e,i,n,s){return!(fR(e,1,s,"styleName")||fR(i,1,s,"style")||!GR(e,1,s,"styleName")||!mR(i,1,s,"style")||!function(t,e,i,n,s){if(!GR(t,1,n,s))return!1;if(!i.includes(t))return xw.output(1,n,s,void 0,vw.PARAM_NOT_SUPPORT);const o=QL(t,e);return!o.length||xw.output(1,n,"style",o)}(e,i,n,s,"styleName")||("annotationSelectionStyle"===e?(t.updateAnnotationConfig({controlsStyle:i}),0):(t.updateViewerConfig({[e]:i}),0)))}getUiConfig(t){return t.getUiConfig()}updateUiConfig(t,e,i,n){const s="uiConfig";return!(fR(e,1,n,s)||!WR(e,i,n,s,1))&&t.updateUiConfig(e)}indexToUid(t,e,i){const n="index";return fR(e,1,i,n)||!VR(e,i,n,1)||!NR(t,1)||UR(void 0,void 0,t,1)||HR(e,0,t.getPageCounts()-1,1,i,n)?"":t.indexToUid(e)}uidToIndex(t,e,i){return fR(e,1,i,"uid")||!GR(e,1,i,"uid",!1)||!NR(t,1)||UR(void 0,void 0,t,1)?-1:jR(this.getCurrentDocument(t).pages,e,1,i)?t.uidToIndex(e):-1}getCurrentPageUid(t){return NR(t,1)?UR(void 0,void 0,t,1)?"":t.getCurrentPageUid():""}getCurrentPageIndex(t){return NR(t,1)?UR(void 0,void 0,t,1)?-1:t.getCurrentPageIndex():-1}getPageCount(t){return NR(t,1)?t.getPageCounts():-1}gotoPage(t,e,i){const n="index";return fR(e,1,i,n)||!VR(e,i,n,1)||!NR(t,1)||UR(void 0,void 0,t,1)||HR(e,0,t.getPageCounts()-1,1,i,n)?-1:t.gotoPage(e)}rotate(t,e,i,n){return!(fR(e,1,n,"angle")||!VR(e,n,"angle",1)||!function(t,e){return t%90==0||xw.output(1,e,"angle",void 0,vw.PARAM_NOT_SUPPORT)}(e,n)||!NR(t,1)||UR(void 0,void 0,t,1))&&(!(!Hd(i)&&!YR(i,1,n,"indices",0,this.getPageCount(t)-1))&&t.rotatePages(e,i))}saveOperation(t){return!!NR(t,1)&&t.saveOperations()}on(t,e,i,n){!fR(i,1,e,"eventName")&&!fR(n,1,e,"listener")&&GR(i,1,e,"eventName",!1)&&zR(n,e,"listener",1)&&t.on(i,n)}off(t,e,i,n){!fR(i,1,e,"eventName")&&GR(i,1,e,"eventName",!1)&&(Hd(n)||zR(n,e,"listener",1))&&t.off(i,n)}destroy(t){t&&t.dispose()}}function XR(t,e,i,n){return!!Yd(t)||xw.output(n,e,i,void 0,vw.PARAM_INVALID)}function qR(t,e,i,n,s,o){const r=xw.formatError(xw.isNumberAndIsInRange(t,s,o));return!r||xw.output(e,i,n,void 0,r)}function ZR(t,e,i,n,s){if(!Vd(t))return xw.output(i,n,s,void 0,vw.PARAM_INVALID);const o=[],r=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(t).forEach((i=>{const n=t[i];if("container"===i)o.push(...oO.isContainerKeyValid(n,s));else if("uiConfig"===i){const t=oO.isUiConfigValid(n,"option.uiConfig");if(t.length>0)o.push(...t);else{const t=$L(n,e);if(t){const i=vw.buildError(vw.ELEMENT_UNSUPPORTED,e.charAt(0).toUpperCase()+e.slice(1),t);o.push(`option.uiConfig: ${i.message}`)}}}else"viewerConfig"!==i&&"thumbnailConfig"!==i||Object.keys(n).forEach((t=>{const e=n[t];if(r.includes(t)){const n=QL(t,e);o.push(...n.map((t=>`${i}.${t}`)))}}))})),!(o.length>0)||xw.output(i,n,s,o)}const JR=["canvasStyle","quadSelectionStyle"],KR="CaptureViewer";var QR=new WeakMap,tM=new WeakMap,eM=new WeakSet;class iM{constructor(t){var e;va(this,eM),ma(this,QR,{writable:!0,value:void 0}),ma(this,tM,{writable:!0,value:new $R}),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"postfix",void 0);const i=`new ${KR}`;ub.makeSureCoreLicenseExist(),ub.makeSureCameraLicenseExist(),Hd(t)||ZR(t,"captureViewer",0,i,"option");const n=ju((null==t?void 0:t.viewerConfig)||{},Wd({...FR,viewerMode:$b.CAPTURE})),s=Xd()?yR:bR;oa(this,QR,gR.createViewer({uiConfig:Wd(s),...t,viewerConfig:n})),null!=t&&null!==(e=t.viewerConfig)&&void 0!==e&&e.enableAutoDetect&&!sa(this,QR).context.core.detectorService.enableDetect&&vw.warning(vw.DOC_DETECT_MISS),this.uid=sa(this,QR).uid,this.groupUid=sa(this,QR).groupUid,this.postfix=sa(this,QR).postfix,ga(this,eM,nM).call(this)}get isVisible(){return sa(this,tM).getIsVisible(sa(this,QR))}get isBoundContainer(){return sa(this,tM).getIsBoundContainer(sa(this,QR))}get currentDocument(){return sa(this,tM).getCurrentDocument(sa(this,QR))}get acceptedPolygonConfidence(){return sa(this,QR).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(t){const e="acceptedPolygonConfidence";qR(t,1,`${KR}.${e}`,e,0,100)&&sa(this,QR).updateCameraConfig({acceptedPolygonConfidence:t})}get maxFrameNumber(){return sa(this,QR).getCameraConfig().maxFrameNumber}set maxFrameNumber(t){const e="maxFrameNumber";qR(t,1,`${KR}.${e}`,e,1e-6,60)&&sa(this,QR).updateCameraConfig({maxFrameNumber:t})}get enableAutoDetect(){return sa(this,QR).getCameraConfig().enableAutoDetect}set enableAutoDetect(t){const e="enableAutoDetect",i=`${KR}.${e}`;XR(t,i,e,1)&&(t&&!sa(this,QR).context.core.detectorService.enableDetect&&xw.warning(i,void 0,void 0,vw.DOC_DETECT_MISS),sa(this,QR).updateCameraConfig({enableAutoDetect:t}))}get enableAutoCapture(){return sa(this,QR).getCameraConfig().enableAutoCapture}set enableAutoCapture(t){const e="enableAutoCapture";XR(t,`${KR}.${e}`,e,1)&&sa(this,QR).updateCameraConfig({enableAutoCapture:t})}bindContainer(t){sa(this,tM).bindContainer(sa(this,QR),t,`${KR}.bindContainer`)}unbindContainer(){sa(this,tM).unbindContainer(sa(this,QR))}show(){sa(this,tM).show(sa(this,QR))}hide(){sa(this,tM).hide(sa(this,QR))}getUiConfig(){return sa(this,tM).getUiConfig(sa(this,QR))}updateUiConfig(t){return sa(this,tM).updateUiConfig(sa(this,QR),t,"captureViewer",`${KR}.updateUiConfig`)}openDocument(t){sa(this,tM).openDocument(t,this.uid,`${KR}.openDocument`)}closeDocument(){return sa(this,tM).closeDocument(sa(this,QR),`${KR}.closeDocument`)}getStyle(t){return sa(this,tM).getStyle(sa(this,QR),"capture",t,JR,`${KR}.getStyle`)}updateStyle(t,e){return sa(this,tM).updateStyle(sa(this,QR),t,e,JR,`${KR}.updateStyle`)}capture(){return sa(this,QR).isVideoPlaying()?sa(this,QR).context.viewService.isBindContainer?sa(this,QR).capture():vw.reject(vw.CONTAINER_NO_BOUND):vw.reject(vw.CAMERA_NO_VIDEO)}play(t){const e=`${KR}.play`;if(!Hd(t)){const i=function(t,e,i,n){const s=oO.isVideoConfig(t,n);return!s.length||xw.output(2,i,n,s)}(t,0,e,"config");if(!0!==i)return i}return sa(this,QR).play(t).catch((t=>vw.reject(t,e)))}stop(){sa(this,QR).stop()}getCurrentCamera(){return sa(this,QR).getCurrentCamera()}getAllCameras(){return sa(this,QR).getAllCameras()}selectCamera(t){const e=`${KR}.selectCamera`,i="cameraObjectOrDeviceID",n=fR(t,2,e,i);if(n)return n;if(Zd(t)){const n=GR(t,2,e,i,!1);if(!0!==n)return n}else{const n=function(t,e,i,n){const s=oO.isVideoDeviceInfo(t,n);return!s.length||xw.output(2,i,n,s)}(t,0,e,i);if(!0!==n)return n}return sa(this,QR).selectCamera(t).catch((t=>vw.reject(t,e,i)))}getCurrentResolution(){return sa(this,QR).getCurrentResolution()}turnOnTorch(){return sa(this,QR).turnOnTorch().catch((t=>vw.reject(t)))}turnOffTorch(){return sa(this,QR).turnOffTorch().catch((t=>vw.reject(t)))}on(t,e){sa(this,tM).on(sa(this,QR),`${KR}.on`,t,e)}off(t,e){sa(this,tM).off(sa(this,QR),`${KR}.off`,t,e)}destroy(){sa(this,tM).destroy(sa(this,QR))}}function nM(){sa(this,QR).hooks.destroy.on((()=>{oa(this,QR,null),Object.setPrototypeOf(this,null)}))}const sM={canvasStyle:{...IR},currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},oM={...sM,visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}},rM={canvasStyle:{...IR},pageStyle:{...DR},quadSelectionStyle:{...kR},currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1,enableMagnifier:!0},aM=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var lM=new WeakSet;class hM{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";va(this,lM),na(this,"v",void 0),na(this,"vCommon",new $R),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"postfix",void 0),na(this,"errorPrefix",void 0),this.errorPrefix=e;const i=`new ${this.errorPrefix}`;ub.makeSureCoreLicenseExist(),Hd(t)||ZR(t,"browseViewer",0,i,"option");const n=sO(null==t?void 0:t.keyboardInteractionConfig),s=ju((null==t?void 0:t.viewerConfig)||{},Wd({...sM,viewerMode:$b.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0}));this.v=gR.createViewer({uiConfig:Wd(_R),...t,viewerConfig:{...s,...n}}),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,ga(this,lM,cM).call(this)}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(t){const e="multiselectMode";XR(t,`${this.errorPrefix}.${e}`,e,1)&&this.v.updateViewerConfig({multiselectMode:t})}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v)}hide(){this.vCommon.hide(this.v)}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(t){return this.vCommon.updateUiConfig(this.v,t,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(t){return this.vCommon.getStyle(this.v,"browse",t,aM,`${this.errorPrefix}.getStyle`)}updateStyle(t,e){const i=`${this.errorPrefix}.updateStyle`;return this.vCommon.updateStyle(this.v,t,e,aM,i)}getSelectedPageIndices(){return NR(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){if(!NR(this.v,1))return[];if(0===this.v.getPageCounts()){const t=`${this.errorPrefix}.selectAllPages`;return xw.output(1,t,void 0,void 0,vw.DOC_NO_IMAGE),[]}return this.v.selectAllPages()}selectPages(t){const e=`${this.errorPrefix}.selectPages`,i="indices";return fR(t,1,e,i)||!NR(this.v,1)?[]:YR(t,1,e,i,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(t):[]}setRowAndColumn(t,e){const i=`${this.errorPrefix}.setRowAndColumn`,n="row",s="column",{maxColumns:o,maxRows:r}=this.v.getViewerConfig();return!(fR(t,1,i,n)||fR(e,1,i,s)||!VR(t,i,n,1)||!VR(e,i,s,1)||HR(t,1,r,1,i,n)||HR(e,1,o,1,i,s))&&this.v.setRowAndColumn(t,e)}on(t,e){this.vCommon.on(this.v,`${this.errorPrefix}.on`,t,e)}off(t,e){this.vCommon.off(this.v,`${this.errorPrefix}.off`,t,e)}}function cM(){this.v.hooks.destroy.on((()=>{this.v=null,Object.setPrototypeOf(this,null)}))}function dM(t,e,i,n,s){const o=oO.isAnnotationOptionsValid(t,n,s);return!o.length||xw.output(e,i,n,o)}const uM={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var pM=new WeakMap;class gM{constructor(t){na(this,"uid",null),na(this,"creationDate",""),na(this,"modificationDate",""),ma(this,pM,{writable:!0,value:void 0}),oa(this,pM,t),this.uid=Qd(),this.creationDate=BS(),this.modificationDate=this.creationDate}get type(){return null}get pageUid(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return!!t&&t.flattened}set flattened(t){const e="Annotation.flattened";fR(t,1,e,"options")||XR(t,e,"options",1)&&gR.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?gR.annotationService.flattenAnnotations([this.uid]):gR.annotationService.unFlattenAnnotation(this.uid))}getOptions(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=vM(e,this.type);oa(this,pM,{...i}),this.modificationDate=e.comment.modificationDate}return wM(this.type,sa(this,pM))}updateOptions(t){const e="Annotation.updateOptions";if(fR(t,1,e,"options"))return!1;if(!mR(t,1,e,"options"))return!1;if(!dM(t,1,e,"options",this.type))return!1;const i=this.getOptions(),n=fM(this.type,t,i);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&n.has("rotated")&&n.delete("rotated"),!n.size)return!0;this.getOptions(),ju(t,sa(this,pM));const s=mM({...sa(this,pM)},this.type);return gR.annotationService.updateAnnotations([{annotationUid:this.uid,options:s}],void 0,[...n]),!0}}function fM(t,e,i){const n="moved",s="resized",o="startPoint",r="endPoint",a=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),l=Wd(e);l.flags={...i.flags,...(null==l?void 0:l.flags)||{}},["line","polyline"].includes(t)&&e.lineEnding&&(l.lineEnding={...i.lineEnding,...(null==l?void 0:l.lineEnding)||{}});const h=new Set,c=Object.keys(l);return c.forEach((e=>{if(!KL(i[e],l[e]))if("points"!==e||"ink"!==t&&"polygon"!==t&&"polyline"!==t)if(e!==o&&e!==r||"line"!==t)for(const[t,i]of a)t.includes(e)&&!h.has(i)&&h.add(i);else c.includes(o)&&c.includes(r)&&iO([i[o],i[r]],[l[o],l[r]])?h.add(n):h.add(s);else iO(i[e],l[e])?h.add(n):h.add(s)})),h}function mM(t,e){const i=Wd(t),n={style:i,flags:[],transform:{angle:0}},{lineEnding:s,points:o,textContents:r,stamp:a,borderWidth:l,x:h,y:c,width:d,height:u,startPoint:p,endPoint:g,lineDash:f}=i||{},m=Ep.dataResolution,v=Ep.displayResolution;if(o&&("ink"===e?n.style.segments=_M(o,m,v):n.style.points=SM(o,m,v)),s&&(n.style.lineEnding=yM(s,"date")),a&&(n.style.imageData=null,a instanceof Blob||Zd(a)&&WL(a)?n.style.imageData=a:Zd(a)?n.style.iconName=xM(a,"date"):nO(a)&&(n.style.stampConfig=a)),Hd(l)||(n.style.borderWidth=$u(l,m,v)),Hd(h)||(n.style.x=$u(h,m,v)),Hd(c)||(n.style.y=$u(c,m,v)),Hd(d)||(n.style.width=$u(d,m,v)),Hd(u)||(n.style.height=$u(u,m,v)),Hd(f)||(n.style.lineDash=$u(f,m,v)),Hd(p)||(n.style.startPoint=$u(p,m,v)),Hd(g)||(n.style.endPoint=$u(g,m,v)),r){const t=[];r.forEach((e=>{null!=e&&e.fontSize&&(e.fontSize=$u(e.fontSize,m,v)),Zd(e.fontFamily)&&""===(null==e?void 0:e.fontFamily.trim())&&(e.fontFamily="Helvetica"),t.push({...LR,...e})})),n.style.textContents=t}return qd(t.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(e)&&(n.transform.angle=t.rotation),t.flags&&(t.flags.print&&n.flags.push("print"),t.flags.noView&&n.flags.push("noView"),t.flags.readOnly&&n.flags.push("readOnly"),t.flags.noResize&&n.flags.push("noResize"),t.flags.noRotate&&n.flags.push("noRotate"),t.flags.noMove&&n.flags.push("noMove")),n}function vM(t,e){var i,n,s,o,r,a,l,h,c,d;const{lineEnding:u,iconName:p,imageData:g,segments:f,textContents:m,borderWidth:v,x:y,y:x,width:w,height:b,startPoint:C,endPoint:S,lineDash:_,points:T,stampConfig:E}=(null==t?void 0:t.style)||{},P=Ep.displayResolution,A=Ep.dataResolution;if(T&&(t.style.points=SM(T,P,A)),f&&"ink"===e&&(t.style.points=_M(f,P,A),delete t.style.segments),u&&(t.style.lineEnding=yM(u,"user")),(g||p||E)&&(t.style.stamp=g||xM(p,"user")||Wd(E),delete t.style.iconName,delete t.style.imageData,delete t.style.stampConfig),Hd(v)||(t.style.borderWidth=$u(v,P,A)),Hd(y)||(t.style.x=$u(y,P,A)),Hd(x)||(t.style.y=$u(x,P,A)),Hd(w)||(t.style.width=$u(w,P,A)),Hd(b)||(t.style.height=$u(b,P,A)),Hd(C)||(t.style.startPoint=$u(C,P,A)),Hd(S)||(t.style.endPoint=$u(S,P,A)),Hd(_)||(t.style.lineDash=$u(_,P,A)),m){const e=[];m.forEach((t=>{null!=t&&t.fontSize&&(t.fontSize=$u(t.fontSize,P,A)),Zd(t.fontFamily)&&""===(null==t?void 0:t.fontFamily.trim())&&(t.fontFamily="Helvetica"),e.push({...LR,...t})})),t.style.textContents=e}return null===(i=t.style)||void 0===i||delete i.lineJoin,null===(n=t.style)||void 0===n||delete n.lineCap,null===(s=t.style)||void 0===s||delete s.miterLimit,{...t.style,rotation:(null===(o=t.transform)||void 0===o?void 0:o.angle)||0,flags:{print:!(null===(r=t.flags)||void 0===r||!r.includes("print")),noView:!(null===(a=t.flags)||void 0===a||!a.includes("noView")),readOnly:!(null===(l=t.flags)||void 0===l||!l.includes("readOnly")),noResize:!(null===(h=t.flags)||void 0===h||!h.includes("noResize")),noRotate:!(null===(c=t.flags)||void 0===c||!c.includes("noRotate")),noMove:!(null===(d=t.flags)||void 0===d||!d.includes("noMove"))}}}function yM(t,e){const i={None:AR.NONE,OpenArrow:AR.OPEN,ROpenArrow:AR.OPEN_REVERSE,ClosedArrow:AR.CLOSED,RClosedArrow:AR.CLOSED_REVERSE,Butt:AR.BUTT,Slash:AR.SLASH,Square:AR.SQUARE,Diamond:AR.DIAMOND,Circle:AR.CIRCLE};if("user"===e){const[e,n]=t;return{start:i[e],end:i[n]}}return[JL(i,t.start)[0]||"None",JL(i,t.end)[0]||"None"]}function xM(t,e){const i={[PR.REJECTED]:Jm.REJECTED,[PR.ACCEPTED]:Jm.ACCEPTED,[PR.INITIAL_HERE]:Jm.INITIAL_HERE,[PR.SIGN_HERE]:Jm.SIGN_HERE,[PR.WITNESS]:Jm.WITNESS,[PR.APPROVED]:Jm.APPROVED,[PR.NOT_APPROVED]:Jm.NOT_APPROVED,[PR.DRAFT]:Jm.DRAFT,[PR.FINAL]:Jm.FINAL,[PR.COMPLETED]:Jm.COMPLETED,[PR.CONFIDENTIAL]:Jm.CONFIDENTIAL,[PR.VOID]:Jm.VOID};return"user"===e?JL(i,t)[0]||t:i[t]||Jm.DRAFT}function wM(t,e){const i=["opacity","flags"],n=["x","y","width","height"],s=["borderColor","borderWidth","lineDash"],o=[...i,...s,...n,"background","rotation"],r=["points","background",...s,...i],a={rectangle:o,ellipse:o,polygon:r,polyline:["lineEnding",...r],stamp:["stamp",...n,...i,"rotation"],ink:["points","borderWidth","borderColor","rotation",...i],line:["startPoint","endPoint","lineEnding","background",...s,...i],textBox:["textContents","textAlign","background","rotation",...i,...s,...n],textTypewriter:["x","y","textContents",...i]}[t];if(!a)return e;const l={};for(const i in e)if(a.includes(i)){let n=e[i];"points"!==i||"ink"!==t&&"polygon"!==t&&"polyline"!==t?"startPoint"!==i&&"endPoint"!==i||"line"!==t?"borderColor"===i||"background"===i?l[i]=CM(n,2):"opacity"===i?(n>1&&(n=1),n<0&&(n=0),l[i]=bM(n,2)):"textContents"===i?l[i]=n.map((t=>(void 0!==t.color&&(t.color=CM(t.color,2)),void 0!==t.fontSize&&(t.fontSize=bM(t.fontSize,2)),t))):"lineDash"===i?l[i]=n.map((t=>bM(t,2))):qd(e[i])?l[i]=bM(n,2):l[i]=n:l[i]={x:bM(n.x,2),y:bM(n.y,2)}:Ud(n[0])?l[i]=n.map((t=>t.map((t=>({x:bM(t.x,2),y:bM(t.y,2)}))))):l[i]=n.map((t=>({x:bM(t.x,2),y:bM(t.y,2)})))}return l}function bM(t,e){return Number.parseFloat(t.toFixed(e))}function CM(t,e){if(t&&t.startsWith("rgb")){const i=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/,n=t.match(i);if(n){const t=parseInt(n[1],10),i=parseInt(n[2],10),s=parseInt(n[3],10);let o=void 0!==n[4]?parseFloat(n[4]):void 0;if(void 0!==o){o<0&&(o=0),o>1&&(o=1);const n=function(t,e){const i=t.toString();return/^\d+\.\d{3,}$/.test(i)?parseFloat(t.toFixed(e)):t}(o,e);return`rgba(${t},${i},${s},${n})`}return`rgb(${t},${i},${s})`}}return t}function SM(t,e,i){return t.map((t=>({x:$u(t.x,e,i),y:$u(t.y,e,i)})))}function _M(t,e,i){return t.map((t=>t.map((t=>({x:$u(t.x,e,i),y:$u(t.y,e,i)})))))}const TM={...uM,x:10,y:10,width:100,height:100};class EM extends gM{constructor(t){super(t=ju(t||{},Wd(TM)))}get type(){return"rectangle"}}const PM={...uM,x:10,y:10,width:100,height:80};class AM extends gM{constructor(t){super(t=ju(t||{},Wd(PM)))}get type(){return"ellipse"}}const IM={...uM,points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]};class DM extends gM{constructor(t){super(t=ju(t||{},Wd(IM)))}get type(){return"ink"}}const kM={...uM,startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:AR.NONE,end:AR.NONE}};class RM extends gM{constructor(t){super(t=ju(t||{},Wd(kM)))}get type(){return"line"}}const MM={...uM,points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]};class LM extends gM{constructor(t){super(t=ju(t||{},Wd(MM)))}get type(){return"polygon"}}const OM={...uM,points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:AR.NONE,end:AR.NONE}};class BM extends gM{constructor(t){super(t=ju(t||{},Wd(OM)))}get type(){return"polyline"}}async function FM(t,e,i,n,s){const o=[`${s}.${n} is invalid`];let r=!1;if(Gd(t)){const e=await Yu(t);["image/bmp","image/jpeg","image/png"].includes(e)||(r=!0)}else r=!0;return!r||xw.output(e,i,s,o)}const NM={x:10,y:10,stamp:PR.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},UM={[PR.REJECTED]:[23.58,23.54],[PR.ACCEPTED]:[28.39,24.6],[PR.INITIAL_HERE]:[126.26,33.78],[PR.SIGN_HERE]:[126.26,33.78],[PR.WITNESS]:[126.26,33.78],[PR.APPROVED]:[211.33,59.33],[PR.NOT_APPROVED]:[284.83,59.33],[PR.DRAFT]:[144.19,59.66],[PR.FINAL]:[123.73,59.66],[PR.COMPLETED]:[227.83,59.33],[PR.CONFIDENTIAL]:[272.83,59.33],[PR.VOID]:[114.71,59.66]};var VM=new WeakMap;class WM{constructor(t){na(this,"uid",null),na(this,"creationDate",""),na(this,"modificationDate",""),ma(this,VM,{writable:!0,value:void 0}),t=ju(t||{},Wd(NM)),!Zd(t.stamp)||!UM[t.stamp]||qd(t.width)&&qd(t.height)||(t.width=t.width||UM[t.stamp][0],t.height=t.height||UM[t.stamp][1]),oa(this,VM,t),this.uid=Qd(),this.creationDate=BS(),this.modificationDate=this.creationDate}get type(){return"stamp"}get pageUid(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return!!t&&t.flattened}set flattened(t){const e="Annotation.flattened";fR(t,1,e,"options")||XR(t,e,"options",1)&&gR.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?gR.annotationService.flattenAnnotations([this.uid]):gR.annotationService.unFlattenAnnotation(this.uid))}getOptions(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=vM(e,this.type);oa(this,VM,{...i}),this.modificationDate=e.comment.modificationDate}return wM(this.type,sa(this,VM))}async updateOptions(t){const e="Annotation.updateOptions";if(fR(t,0,e,"options"))return;if(!mR(t,0,e,"options"))return;if(!dM(t,0,e,"options",this.type))return;if(Gd(t.stamp)&&!await FM(t.stamp,0,e,"stamp","options"))return;const i=this.getOptions(),n=fM(this.type,t,i);if(!n.size)return;this.getOptions(),ju(t,sa(this,VM));let s=sa(this,VM);null!=t&&t.stamp||(s={...sa(this,VM),stamp:null});const o=mM(s,this.type);gR.annotationService.updateAnnotations([{annotationUid:this.uid,options:o}],void 0,[...n])}}const HM={...uM,x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]};class jM extends gM{constructor(t){super(t=ju(t||{},Wd(HM)))}get type(){return"textBox"}}const zM={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class GM extends gM{constructor(t){super(t=ju(t||{},Wd(zM)))}get type(){return"textTypewriter"}}function YM(t,e,i,n,s,o){const r=xw.formatError({isValid:Ud(t)});if(r)return xw.output(e,i,n,void 0,r);const a=[];return t.forEach(((t,e)=>{const i=xw.formatDetails(yw("Array",s,`[${e}]`,!0),xw.isStringAndNotEmpty(t,o));a.push(...i)})),!a.length||xw.output(e,i,n,a)}function $M(t,e,i,n,s){const o=[];return e.forEach(((e,i)=>{t.has(e)||o.push(`annotationUids[${i}]: The specified annotation(s) do not exist.`)})),!o.length||xw.output(i,n,s,o,vw.ANNOTATION_NOT_EXIST)}function XM(t,e,i,n,s){return!!t.has(e)||xw.output(i,n,s,void 0,vw.ANNOTATION_NOT_EXIST)}class qM{constructor(){na(this,"uid",null),na(this,"creationDate",""),na(this,"modificationDate",""),this.uid=Qd(),this.creationDate=BS(),this.modificationDate=BS()}get type(){return"unknown"}get pageUid(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get flattened(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return!!t&&t.flattened}set flattened(t){const e="Annotation.flattened";fR(t,1,e,"options")||XR(t,e,"options",1)&&gR.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?gR.annotationService.flattenAnnotations([this.uid]):gR.annotationService.unFlattenAnnotation(this.uid))}}var ZM=new WeakMap;class JM{constructor(t){ma(this,ZM,{writable:!0,value:void 0}),na(this,"uid",null),na(this,"creationDate",""),na(this,"modificationDate",""),this.uid=Qd(),this.creationDate=BS(),this.modificationDate=BS(),oa(this,ZM,t)}get type(){return"incomplete"}get pageUid(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get raw(){return sa(this,ZM)}get flattened(){const t=gR.annotationService.annotationApp.getAnnotationByUid(this.uid);return!!t&&t.flattened}set flattened(t){const e="Annotation.flattened";fR(t,1,e,"options")||XR(t,e,"options",1)&&gR.annotationService.annotationApp.getAnnotationByUid(this.uid).flattened!==t&&(t?gR.annotationService.flattenAnnotations([this.uid]):gR.annotationService.unFlattenAnnotation(this.uid))}}const KM=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],QM="AnnotationManager",tL=new Map;var eL=new WeakMap,iL=new WeakMap,nL=new WeakMap,sL=new WeakSet,oL=new WeakSet;function rL(t,e){switch(t){case"rectangle":return new EM(e);case"ellipse":return new AM(e);case"polygon":return new LM(e);case"polyline":return new BM(e);case"line":return new RM(e);case"stamp":return new WM(e);case"ink":return new DM(e);case"textBox":return new jM(e);case"textTypewriter":return new GM(e);case"unknown":return new qM;case"highlight":case"underline":case"strikeout":case"incomplete":return new JM((null==e?void 0:e.annotationRaw)||{});default:return null}}function aL(t,e){sa(this,nL).emit(t,e)}const lL=new class{constructor(){va(this,oL),va(this,sL),ma(this,eL,{writable:!0,value:void 0}),ma(this,iL,{writable:!0,value:void 0}),ma(this,nL,{writable:!0,value:void 0}),oa(this,eL,gR),oa(this,iL,tL),oa(this,nL,new iu);const t=sa(this,eL).annotationService.annotationApp.hooks;t.annotationCreated.on((t=>{const e=t.annotations.reduce(((t,e)=>{if(!sa(this,iL).has(e.uid)){const t=e.getConfig(),i=vM(t),n=ga(this,sL,rL).call(this,t.type,i);n&&(n.uid=t.uid,n.creationDate=t.comment.creationDate,n.modificationDate=t.comment.modificationDate,sa(this,iL).set(t.uid,n))}return t.push(e.uid),t}),[]);ga(this,oL,aL).call(this,"annotationsAdded",{annotationUids:e})})),t.annotationDeleted.on((t=>{t.annotations.forEach((t=>{sa(this,iL).has(t.uid)&&(this.getAnnotationsByUids([t.uid])[0].modificationDate="",sa(this,iL).delete(t.uid))}));const e=t.annotations.map((t=>t.uid));t.emitEvent&&ga(this,oL,aL).call(this,"annotationsDeleted",{annotationUids:e})})),t.annotationUpdated.on((t=>{const e={modifiedAnnotations:t.updateDetails.map((t=>{const e=this.getAnnotationsByUids([t.annotationUid])[0],i=e.type,n=gR.annotationService.annotationApp.getAnnotationByUid(e.uid);return e.modificationDate=n.comment.modificationDate,{uid:t.annotationUid,oldOptions:wM(i,vM(Wd(t.from),i)),newOptions:wM(i,vM(Wd(t.to),i))}})),actions:[...t.updateActions]};e.actions.includes("flattenedChanged")||ga(this,oL,aL).call(this,"annotationsModified",e)}));const e=(t,e)=>{sa(this,eL).annotationService.enableEmitLayerChanged&&ga(this,oL,aL).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...t.from],newAnnotationUidList:[...t.to]})};t.bringFroward.on((t=>{e(t)})),t.bringToFront.on((t=>{e(t)})),t.sendBackward.on((t=>{e(t)})),t.sendToBack.on((t=>{e(t)}))}createAnnotation(t,e,i){const n="AnnotationManager.createAnnotation",s="pageUid",o="type",r="annotationOptions";let a=null;try{ub.makeSureCoreLicenseExist(),ub.makeSureAnnotationLicenseExist(),fR(t,0,n,s),fR(e,0,n,o),GR(t,0,n,s,!1),function(t,e,i,n){Zd(t)?["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(t)||xw.output(0,i,n,void 0,vw.PARAM_NOT_SUPPORT):xw.output(0,i,n,void 0,vw.PARAM_INVALID)}(e,0,n,o),a=sa(this,eL).pageService.getPage(t),a||xw.error(n,s,void 0,vw.PAGE_NOT_EXIST),Hd(i)||(mR(i,0,n,r),dM(i,0,n,r,e))}catch(t){if("stamp"===e)return Promise.reject(t);throw t}const l=Wd(i||{}),h=()=>{var i,n,s;const o=ga(this,sL,rL).call(this,e,l);sa(this,iL).set(o.uid,o);const r=sa(this,eL).pageService.getPage(t).doc.uid,h=mM(o.getOptions(),e);if("textTypewriter"===e){const t=a.mediaBox.width,e=a.mediaBox.width-h.style.x;h.style.width=e<0?t:e}const c={uid:o.uid,docUid:r,pageUid:t,type:e,style:h.style,transform:h.transform,flags:h.flags,comment:{annotationUid:o.uid,author:(null===(i=h.comment)||void 0===i?void 0:i.author)||"",subject:(null===(n=h.comment)||void 0===n?void 0:n.subject)||"",contents:(null===(s=h.comment)||void 0===s?void 0:s.contents)||"",creationDate:o.creationDate,modificationDate:o.creationDate,markedStates:[],reviewStates:[],replies:[]}};return sa(this,eL).annotationService.createAnnotation(r,c),o};if("stamp"===e&&Gd(null==l?void 0:l.stamp)){const t=l;return new Promise((async(e,i)=>{try{await FM(t.stamp,0,n,"stamp",r)}catch(t){return void i(t)}if(!qd(t.width)||!qd(t.height)){const e=new xp,n=await e.readImageInfo({fileSource:t.stamp}).catch((t=>{i(t)}));let s=n.imageWidth,o=n.imageHeight;if(s>400||o>400){const t=Math.max(s/400,o/400);s/=t,o/=t}t.width=s,t.height=o}e(h())}))}return h()}deleteAnnotations(t){const e=`${QM}.deleteAnnotations`,i="annotationUids";return!(fR(t,1,e,i)||!YM(t,1,e,i,void 0,!1)||!$M(sa(this,iL),t,1,e,i)||(sa(this,eL).annotationService.deleteAnnotations(t),0))}getAnnotationsByUids(t){const e=`${QM}.getAnnotationsByUids`,i="annotationUids";return!fR(t,1,e,i)&&YM(t,1,e,i,void 0,!1)&&$M(sa(this,iL),t,1,e,i)?t.map((t=>sa(this,iL).get(t))):[]}getAnnotationsByPage(t){const e=`${QM}.getAnnotationsByPage`,i="pageUid";if(fR(t,1,e,i)||!GR(t,1,e,i,!1))return[];if(!sa(this,eL).pageService.getPage(t))return xw.warning(e,i,void 0,vw.PAGE_NOT_EXIST),[];const n=sa(this,eL).annotationService.getAnnotationUidsByLayer(t),s=[];return n.forEach((t=>{const e=sa(this,iL).get(t);e&&s.push(e)})),s}getAnnotationsByDoc(t){const e=`${QM}.getAnnotationsByDoc`,i="docUid";if(fR(t,1,e,i)||!GR(t,1,e,i,!1))return[];const n=sa(this,eL).documentService.getDocument(t);return n?n.pages.reduce(((t,e)=>(sa(this,eL).annotationService.getAnnotationUidsByLayer(e).forEach((e=>{const i=sa(this,iL).get(e);i&&t.push(i)})),t)),[]):(xw.warning(e,i,void 0,vw.DOC_NOT_EXIST),[])}bringAnnotationForward(t){const e=`${QM}.bringAnnotationForward`,i="annotationUid";return!(fR(t,1,e,i)||!GR(t,1,e,i,!1)||!XM(sa(this,iL),t,1,e,i))&&(!!this.getAnnotationsByUids([t])[0].flattened||sa(this,eL).annotationService.bringForward(t))}sendAnnotationBackward(t){const e=`${QM}.sendAnnotationBackward`,i="annotationUid";return!(fR(t,1,e,i)||!GR(t,1,e,i,!1)||!XM(sa(this,iL),t,1,e,i))&&(!!this.getAnnotationsByUids([t])[0].flattened||sa(this,eL).annotationService.sendBackward(t))}bringAnnotationToFront(t){const e=`${QM}.bringAnnotationToFront`,i="annotationUid";return!(fR(t,1,e,i)||!GR(t,1,e,i,!1)||!XM(sa(this,iL),t,1,e,i))&&(!!this.getAnnotationsByUids([t])[0].flattened||sa(this,eL).annotationService.bringToFront(t))}sendAnnotationToBack(t){const e=`${QM}.sendAnnotationToBack`,i="annotationUid";return!(fR(t,1,e,i)||!GR(t,1,e,i,!1)||!XM(sa(this,iL),t,1,e,i))&&(!!this.getAnnotationsByUids([t])[0].flattened||sa(this,eL).annotationService.sendToBack(t))}on(t,e){const i="AnnotationManager.on",n="eventName",s="listener";!fR(t,1,i,n)&&!fR(e,1,i,s)&&GR(t,1,i,n,!1)&&zR(e,i,s,1)&&(KM.includes(t)?sa(this,nL).on(t,e):vw.warning(vw.PARAM_NOT_SUPPORT,i,n))}off(t,e){const i="AnnotationManager.off",n="eventName";!fR(t,1,i,n)&&GR(t,1,i,n,!1)&&(Hd(e)||zR(e,i,"listener",1))&&(KM.includes(t)?sa(this,nL).off(t,e):vw.warning(vw.PARAM_NOT_SUPPORT,i,n))}};function hL(t,e,i,n,s,o){const r=[];let a=!1;if(s)s.forEach(((t,e)=>{const{width:s,height:o}=i.getRealPtPageSize(t);ZL(n,s,o)||r.push(`indices[${t}]: ${vw.RECT_EXCEED_PAGE_BOUND.message}`)})),r.length>0&&(a=!0);else{const{width:t,height:e}=i.getRealPtPageSize();ZL(n,t,e)||(a=!0)}return!!a&&xw.output(o,t,e,r.length?r:void 0,vw.RECT_EXCEED_PAGE_BOUND,!0)}function cL(t,e,i,n){const s=oO.isRectValid(t);return!!s.length&&xw.output(n,e,i,s,void 0,!0)}const dL=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],uL="EditViewer";var pL=new WeakMap,gL=new WeakMap,fL=new WeakMap,mL=new WeakSet,vL=new WeakSet,yL=new WeakSet;class xL{constructor(t){var e,i;va(this,yL),va(this,vL),va(this,mL),ma(this,pL,{writable:!0,value:void 0}),ma(this,gL,{writable:!0,value:!0}),ma(this,fL,{writable:!0,value:new $R}),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"postfix",void 0),na(this,"thumbnail",void 0),ub.makeSureCoreLicenseExist(),Hd(t)||ZR(t,"editViewer",0,"new EditViewer","option");const n=sO(null==t?void 0:t.keyboardInteractionConfig),s=ju((null==t?void 0:t.viewerConfig)||{},Wd({...rM,viewerMode:$b.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0}));if(s.minZoom>s.maxZoom){vw.warning(vw.MIN_ZOOM_INVALID);const t=s.maxZoom;s.maxZoom=s.minZoom,s.minZoom=t}const{maxZoom:o,minZoom:r}=s;s.maxZoom=o>64||o<.01?64:o,s.minZoom=r>64||r<.01?.01:r,Xd()&&(BR.toolbarConfig.style={scale:"0.9"}),oa(this,pL,gR.createViewer({uiConfig:Wd(Xd()?xR:SR),...t,viewerConfig:{...s,...n},annotationToolBarConfig:{...null==BR?void 0:BR.toolbarConfig,...null==t||null===(e=t.annotationConfig)||void 0===e?void 0:e.toolbarConfig},annotationPaletteConfig:{...BR.paletteConfig,...null==t||null===(i=t.annotationConfig)||void 0===i?void 0:i.paletteConfig}})),this.uid=sa(this,pL).uid,this.groupUid=sa(this,pL).groupUid,this.postfix=sa(this,pL).postfix;const a=ju(Wd(null==t?void 0:t.annotationConfig)||{},Wd(BR));sa(this,pL).updateAnnotationConfig(XL(a)),YL(sa(this,pL).getUiConfig()).includes(vR.Filter)&&!sa(this,pL).context.core.filterService.enableFilter&&vw.warning(vw.IMG_FILTER_MISS),t&&!1===t.createThumbnail||ga(this,vL,bL).call(this,null==t?void 0:t.thumbnailConfig,n),t&&!Hd(null==t?void 0:t.adaptiveIconSize)&&oa(this,gL,t.adaptiveIconSize),sa(this,pL).rootDom&&(sa(this,pL).rootDom.style.fontSize="20px",VL(this,sa(this,pL).rootDom,sa(this,gL))),AO.forEach((t=>{sa(this,pL).addFontToUi(t)})),ga(this,yL,CL).call(this),ga(this,mL,wL).call(this)}get isVisible(){return sa(this,fL).getIsVisible(sa(this,pL))}get isBoundContainer(){return sa(this,fL).getIsBoundContainer(sa(this,pL))}get currentDocument(){return sa(this,fL).getCurrentDocument(sa(this,pL))}get zoom(){return parseFloat(sa(this,pL).getViewerConfig().zoom.toFixed(4))}set zoom(t){const{maxZoom:e,minZoom:i}=sa(this,pL).getViewerConfig();(function(t,e,i,n,s,o){const r=xw.formatError(xw.isNumberAndIsInRange(t));return r?xw.output(1,i,n,void 0,r):(t<s&&xw.output(1,i,n,void 0,vw.ZOOM_TOO_SMALL),t>o&&xw.output(1,i,n,void 0,vw.ZOOM_TOO_LARGE),!0)})(t,0,`${uL}.zoom`,"zoom",i,e)&&sa(this,pL).updateViewerConfig({zoom:t})}get zoomOrigin(){return sa(this,pL).getViewerConfig().zoomOrigin}set zoomOrigin(t){(function(t,e){const i=oO.isZoomOriginValid(t);return!i.length||xw.output(1,e,"zoomOrigin",i)})(t,`${uL}.zoomOrigin`)&&sa(this,pL).updateViewerConfig({zoomOrigin:{x:t.x,y:t.y}})}get displayMode(){const{displayMode:t}=sa(this,pL).getViewerConfig(),e=sa(this,pL).getActiveTab();return e?e.context.displayMode:t}set displayMode(t){const e="displayMode",i=`${uL}.${e}`;GR(t,1,i,e)&&(["single","continuous"].includes(t)?sa(this,pL).updateViewerConfig({displayMode:t}):vw.warning(vw.PARAM_NOT_SUPPORT,i,e))}get toolMode(){const{toolMode:t}=sa(this,pL).getViewerConfig();return t}set toolMode(t){const e="toolMode",i=`${uL}.${e}`;GR(t,1,i,e)&&function(t,e,i,n){return!!["crop","pan","annotation"].includes(t)||xw.output(1,i,n,void 0,vw.PARAM_NOT_SUPPORT)}(t,0,i,e)&&sa(this,pL).updateViewerConfig({toolMode:t})}get annotationMode(){const{annotationMode:t}=sa(this,pL).getViewerConfig();return t}set annotationMode(t){const e="annotationMode",i=`${uL}.${e}`;GR(t,1,i,e)&&function(t,e,i,n){return!!["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(t)||xw.output(1,i,n,void 0,vw.PARAM_NOT_SUPPORT)}(t,0,i,e)&&sa(this,pL).updateViewerConfig({annotationMode:t})}get fitMode(){const{fitMode:t}=sa(this,pL).getViewerConfig(),e=sa(this,pL).getActiveTab();return e?e.context.fitMode:t}set fitMode(t){const e=`${uL}.fitMode`,i="fitMode";GR(t,1,e,i)&&function(t,e,i,n){return!!["width","height","window","actualSize"].includes(t)||xw.output(1,i,n,void 0,vw.PARAM_NOT_SUPPORT)}(t,0,e,i)&&sa(this,pL).updateViewerConfig({fitMode:t})}bindContainer(t){sa(this,fL).bindContainer(sa(this,pL),t,`${uL}.bindContainer`)}unbindContainer(){sa(this,fL).unbindContainer(sa(this,pL))}show(){sa(this,fL).show(sa(this,pL)),VL(this,sa(this,pL).rootDom,sa(this,gL))}hide(){sa(this,fL).hide(sa(this,pL))}getUiConfig(){return sa(this,fL).getUiConfig(sa(this,pL))}updateUiConfig(t){return sa(this,pL).selectAnnotations([]),!!sa(this,fL).updateUiConfig(sa(this,pL),t,"editViewer",`${uL}.updateUiConfig`)&&(sa(this,pL).emit("thumbnailBind",this.thumbnail.uid),VL(this,sa(this,pL).rootDom,sa(this,gL)),!0)}openDocument(t){sa(this,fL).openDocument(t,this.uid,`${uL}.openDocument`)}closeDocument(){return sa(this,fL).closeDocument(sa(this,pL),`${uL}.closeDocument`)}getStyle(t){return sa(this,fL).getStyle(sa(this,pL),"edit",t,dL,`${uL}.getStyle`)}updateStyle(t,e){const i=`${uL}.updateStyle`;return sa(this,fL).updateStyle(sa(this,pL),t,e,dL,i)}setParallelScrollCount(t){const e=`${uL}.setParallelScrollCount`,i="count",{maxColumns:n,maxRows:s}=sa(this,pL).getViewerConfig();return!(fR(t,1,e,i)||!VR(t,e,i,1)||HR(t,1,s,1,e,i)||HR(t,1,n,1,e,i))&&("continuous"!==this.displayMode?(vw.warning(vw.ROW_COLUMN_CAN_NOT_CHANGE,e),!1):sa(this,pL).setRowAndColumn(t,t))}setCropRect(t){const e=`${uL}.setCropRect`,i="rect";return!(fR(t,1,e,i)||cL(t,e,i,1)||!NR(sa(this,pL),1)||UR(void 0,void 0,sa(this,pL),1)||hL(e,i,sa(this,pL),t,void 0,1))&&("crop"!==this.toolMode?(vw.warning(vw.TOOL_MODE_NOT_AVAILABLE,e),!1):sa(this,pL).setRectBox(t))}getCropRect(){return NR(sa(this,pL),1)?sa(this,pL).getRectBox():null}crop(t,e){const i=`${uL}.crop`,n=sa(this,pL).getPageCounts(),s="rect";if(fR(t,1,i,s)||cL(t,i,s,1)||!NR(sa(this,pL),1)||UR(void 0,void 0,sa(this,pL),1))return!1;if(e&&!YR(e,1,i,"indices",0,n-1))return!1;if(hL(i,s,sa(this,pL),t,e,1))return!1;const o=sa(this,pL).getCurrentPageIndex();return sa(this,pL).cropPages(t,e||[o])}rotate(t,e){const i=`${uL}.rotate`;return sa(this,fL).rotate(sa(this,pL),t,e,i)}undo(){if(!NR(sa(this,pL),1))return!1;const t=sa(this,pL).undo();return t||vw.warning(vw.UNDO_NOOP),t}redo(){if(!NR(sa(this,pL),1))return!1;const t=sa(this,pL).redo();return t||vw.warning(vw.REDO_NOOP),t}saveOperations(){return sa(this,fL).saveOperation(sa(this,pL))}indexToUid(t){const e=`${uL}.indexToUid`;return sa(this,fL).indexToUid(sa(this,pL),t,e)}uidToIndex(t){const e=`${uL}.uidToIndex`;return sa(this,fL).uidToIndex(sa(this,pL),t,e)}getCurrentPageUid(){return sa(this,fL).getCurrentPageUid(sa(this,pL))}getCurrentPageIndex(){return sa(this,fL).getCurrentPageIndex(sa(this,pL))}getPageCount(){return sa(this,fL).getPageCount(sa(this,pL))}goToPage(t){const e=`${uL}.goToPage`;return sa(this,fL).gotoPage(sa(this,pL),t,e)}selectAnnotations(t){const e=`${uL}.selectAnnotations`,i="annotationUids";if(!NR(sa(this,pL),1)||UR(void 0,void 0,sa(this,pL),1)||fR(t,1,e,i)||!YM(t,1,e,i,void 0,!1))return!1;if("crop"===this.toolMode)return vw.warning(vw.TOOL_MODE_NOT_AVAILABLE,e),!1;t=[...new Set(t)];const n=[],s=[],o=[],r=[],a=this.getCurrentPageUid(),l=t.reduce(((t,e,l)=>{const h=gR.annotationService.getAnnotationByUid(e);return h?h.pageUid!==a?n.push(`${i}[${l}]: The specified annotation is not on the current page.`):"incomplete"===h.type||"unknown"===h.type?s.push(`${i}[${l}]: ${vw.UNSELECTED_UNKNOWN.message}`):h.flags.includes("readOnly")||h.flags.includes("noView")?o.push(`${i}[${l}]: ${vw.UNSELECTED_READONLY.message}`):h.flattened?r.push(`${i}[${l}]: ${vw.UNSELECTED_FLATTENED.message}`):t.push(e):n.push(`${i}[${l}]: The specified annotation does not exist.`),t}),[]),h=[{result:n,exceptionType:vw.ANNOTATION_SELECT},{result:s,exceptionType:vw.UNSELECTED_UNKNOWN},{result:o,exceptionType:vw.UNSELECTED_READONLY},{result:r,exceptionType:vw.UNSELECTED_FLATTENED}];for(const{result:t,exceptionType:n}of h)if(t.length){const s=n;return s.details=t,vw.warning(s,e,i),!1}const c=sa(this,pL).getSelectedAnnotations().map((t=>t.uid));return c.length===l.length&&function(t,e){if(t.length!==e.length)return!1;const i=t.slice().sort(),n=e.slice().sort();for(let t=0;t<i.length;t++)if(i[t]!==n[t])return!1;return!0}(c,l)||sa(this,pL).selectAnnotations(l),!0}getSelectedAnnotations(){return!NR(sa(this,pL),1)||UR(void 0,void 0,sa(this,pL),1)?[]:sa(this,pL).getSelectedAnnotations().length?lL.getAnnotationsByUids(sa(this,pL).getSelectedAnnotations().map((t=>t.uid))):[]}on(t,e){sa(this,fL).on(sa(this,pL),`${uL}.on`,t,e)}off(t,e){sa(this,fL).off(sa(this,pL),`${uL}.off`,t,e)}destroy(){sa(this,fL).destroy(sa(this,pL))}setAnnotationDrawingStyle(t){var e,i;const n=`${uL}.setAnnotationDrawingStyle`,s="config";if(fR(t,1,n,s)||!mR(t,1,n,s))return!1;const o=oO.isAnnotationDrawingStyleValid(t,s);if(o.length){const t=vw.PARAM_INVALID;return t.details=o,vw.warning(t,n,s),!1}(null==t||null===(e=t.textBox)||void 0===e||null===(e=e.textContent)||void 0===e?void 0:e.fontSize)<=0&&(t.textBox.textContent.fontSize=1),(null==t||null===(i=t.textTypewriter)||void 0===i||null===(i=i.textContent)||void 0===i?void 0:i.fontSize)<=0&&(t.textTypewriter.textContent.fontSize=1);const r=sa(this,pL).getAnnotationConfig().defaultStyleConfig;if(null!=t&&t.line){const e=yM(r.line.lineEnding,"user");t.line.lineEnding={...e,...t.line.lineEnding}}if(null!=t&&t.polyline){const e=yM(r.polyline.lineEnding,"user");t.polyline.lineEnding={...e,...t.polyline.lineEnding}}const a=XL({defaultStyleConfig:t});return sa(this,pL).updateAnnotationConfig(a),!0}}function wL(){sa(this,pL).hooks.destroy.on((()=>{var t;null===(t=this.thumbnail)||void 0===t||t.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,oa(this,pL,null),Object.setPrototypeOf(this,null)}))}function bL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t||{},n=Wd(oM);Xd()&&(n.size="100%",n.rows=3,n.columns=2,n.canvasStyle.background="#4B4B4B",n.pageNumberStyle.color="white",n.enableOptimizePage=!0),ju(i,n);const{mainAndThbContainer:s,mainContainer:o,thumbnailContainer:r}=sa(this,pL).context.viewService,{size:a,position:l,visibility:h}=n,c=Wd(_R);let d="row",u=a,p="100%",g="left"===l?"-1":"1";"top"!==l&&"bottom"!==l||(d="column",u="100%",p=a,g="top"===l?"-1":"1");const f=`ddv-edit-viewer-thumb-${l}`;c.className=f,Object.assign(r.style,{width:u,height:p,order:g,display:"visible"===h?"block":"none"}),s.style.flexDirection=d,s.insertBefore(r,o),sa(this,pL).context.resize(),sa(this,pL).context.viewerConfig.hasThb=!0;const m=new hM({container:r,viewerConfig:{...n,...e},groupUid:this.groupUid,uiConfig:c},`${uL}.thumbnail`);this.thumbnail=m,sa(this,pL).emit("thumbnailBind",m.uid),m.on("click",(()=>{sa(this,pL).emit("ui_hidePopup",null)}))}function CL(){this.on("resized",(t=>{t.newWidth<1200&&t.newWidth>800&&VL(this,sa(this,pL).rootDom,sa(this,gL))}))}const SL={canvasStyle:{...IR},pageStyle:{...DR},quadSelectionStyle:{...kR},enableSlide:!0,enableMagnifier:!0};function _L(t,e,i,n){const s=oO.isQuadValid(t);return s.length?xw.output(e,i,n,s):!!vu(t.flat())||xw.output(e,i,n,void 0,vw.PARAM_INVALID)}function TL(t,e,i,n){return!!function(t,e,i){for(let n=0;n<t.length;n++)if(t[n][0]>e||t[n][1]>i)return!0;return!1}(t,i,n)&&(xw.output(e,void 0,void 0,void 0,vw.QUAD_EXCEED_PAGE_BOUND),!0)}const EL=["canvasStyle","pageStyle","quadSelectionStyle"],PL="PerspectiveViewer";var AL=new WeakMap,IL=new WeakMap,DL=new WeakSet;class kL{constructor(t){va(this,DL),ma(this,AL,{writable:!0,value:void 0}),ma(this,IL,{writable:!0,value:new $R}),na(this,"uid",void 0),na(this,"groupUid",void 0),na(this,"postfix",void 0),ub.makeSureCoreLicenseExist(),Hd(t)||ZR(t,"perspectiveViewer",0,`new ${PL}`,"option");const e=ju((null==t?void 0:t.viewerConfig)||{},Wd({...SL,viewerMode:$b.PERSPECTIVE,toolMode:"crop"})),i=Xd()?wR:CR;oa(this,AL,gR.createViewer({uiConfig:Wd(i),...t,viewerConfig:e})),this.uid=sa(this,AL).uid,this.groupUid=sa(this,AL).groupUid,this.postfix=sa(this,AL).postfix,ga(this,DL,RL).call(this)}get isVisible(){return sa(this,IL).getIsVisible(sa(this,AL))}get isBoundContainer(){return sa(this,IL).getIsBoundContainer(sa(this,AL))}get currentDocument(){return sa(this,IL).getCurrentDocument(sa(this,AL))}bindContainer(t){sa(this,IL).bindContainer(sa(this,AL),t,`${PL}.bindContainer`)}unbindContainer(){sa(this,IL).unbindContainer(sa(this,AL))}show(){sa(this,IL).show(sa(this,AL))}hide(){sa(this,IL).hide(sa(this,AL))}getUiConfig(){return sa(this,IL).getUiConfig(sa(this,AL))}updateUiConfig(t){return sa(this,IL).updateUiConfig(sa(this,AL),t,"perspectiveViewer",`${PL}.updateUiConfig`)}openDocument(t){sa(this,IL).openDocument(t,this.uid,`${PL}.openDocument`)}closeDocument(){return sa(this,IL).closeDocument(sa(this,AL),`${PL}.closeDocument`)}getStyle(t){return sa(this,IL).getStyle(sa(this,AL),"perspective",t,EL,`${PL}.getStyle`)}updateStyle(t,e){const i=`${PL}.updateStyle`;return sa(this,IL).updateStyle(sa(this,AL),t,e,EL,i)}setQuadSelection(t){const e=`${PL}.setQuadSelection`,i="quad";if(fR(t,1,e,i)||!_L(t,1,e,i)||!NR(sa(this,AL),1)||UR(e,void 0,sa(this,AL),1))return!1;const{width:n,height:s}=sa(this,AL).getRealPixelSize();return!TL(t,1,n,s)&&sa(this,AL).setQuadBox(t)}getQuadSelection(){const t=`${PL}.getQuadSelection`;return!NR(sa(this,AL),1)||UR(t,void 0,sa(this,AL),1)?null:sa(this,AL).getQuadBox()}resetQuadSelection(t){const e=`${PL}.resetQuadSelection`;return!(!NR(sa(this,AL),1)||UR(e,void 0,sa(this,AL),1))&&(!(!Hd(t)&&!YR(t,1,e,"indices",0,sa(this,AL).getPageCounts()-1))&&sa(this,AL).resetQuadBox(t))}applyPerspective(t){const e=`${PL}.applyPerspective`,i="quad";fR(t,0,e,i),_L(t,0,e,i),NR(sa(this,AL),0),UR(e,void 0,sa(this,AL),0);const{width:n,height:s}=sa(this,AL).getRealPixelSize();return TL(t,0,n,s),sa(this,AL).perspectivePage(t)}rotate(t,e){const i=`${PL}.rotate`;return sa(this,IL).rotate(sa(this,AL),t,e,i)}saveOperations(){return sa(this,IL).saveOperation(sa(this,AL))}goToPage(t){const e=`${PL}.goToPage`;return sa(this,IL).gotoPage(sa(this,AL),t,e)}indexToUid(t){const e=`${PL}.indexToUid`;return sa(this,IL).indexToUid(sa(this,AL),t,e)}uidToIndex(t){const e=`${PL}.uidToIndex`;return sa(this,IL).uidToIndex(sa(this,AL),t,e)}getCurrentPageUid(){return sa(this,IL).getCurrentPageUid(sa(this,AL))}getCurrentPageIndex(){return sa(this,IL).getCurrentPageIndex(sa(this,AL))}getPageCount(){return sa(this,IL).getPageCount(sa(this,AL))}on(t,e){sa(this,IL).on(sa(this,AL),`${PL}.on`,t,e)}off(t,e){sa(this,IL).off(sa(this,AL),`${PL}.off`,t,e)}destroy(){sa(this,IL).destroy(sa(this,AL))}}function RL(){sa(this,AL).hooks.destroy.on((()=>{oa(this,AL,null),Object.setPrototypeOf(this,null)}))}class ML extends hM{constructor(t){super(t,"BrowseViewer")}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(t){this.vCommon.bindContainer(this.v,t,`${this.errorPrefix}.bindContainer`)}unbindContainer(){this.vCommon.unbindContainer(this.v)}openDocument(t){this.vCommon.openDocument(t,this.uid,`${this.errorPrefix}.openDocument`)}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(t,e){const i=`${this.errorPrefix}.rotate`;return this.vCommon.rotate(this.v,t,e,i)}indexToUid(t){const e=`${this.errorPrefix}.indexToUid`;return this.vCommon.indexToUid(this.v,t,e)}uidToIndex(t){const e=`${this.errorPrefix}.uidToIndex`;return this.vCommon.uidToIndex(this.v,t,e)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(t){const e=`${this.errorPrefix}.goToPage`;return this.vCommon.gotoPage(this.v,t,e)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v)}}var LL=new WeakMap,OL=new WeakMap,BL=new WeakMap,FL=new WeakSet;class NL{constructor(t){va(this,FL),ma(this,LL,{writable:!0,value:void 0}),ma(this,OL,{writable:!0,value:void 0}),ma(this,BL,{writable:!0,value:!1}),na(this,"uid",void 0),na(this,"isDestroyed",!1),na(this,"postfix",void 0),this.uid=Qd(),this.postfix=`-${this.uid}`,oa(this,OL,new iu),Hd(t)||ZR(t,"customViewer",0,"new CustomViewer","option");let e=null==t?void 0:t.uiConfig;(!e||Vd(e)&&0===Object.keys(e).length)&&(e={type:"Layout"}),ga(this,FL,UL).call(this),oa(this,LL,new YP({container:null==t?void 0:t.container,emitter:sa(this,OL),postfix:this.uid,uiConfig:e,injection:{viewer:{postfix:this.postfix}}})),null!=t&&t.container&&e&&sa(this,LL).bindContainer(t.container)}get isBoundContainer(){return sa(this,BL)}get isVisible(){return"none"!==sa(this,LL).rootDom.style.display}bindContainer(t){const e="CustomViewer.bindContainer";fR(t,0,e,"container");const i=oO.isContainerParamValid(t);i&&xw.error(e,"container",void 0,i),sa(this,LL).bindContainer(t)&&oa(this,BL,!0)}unbindContainer(){sa(this,LL).unbindContainer(),oa(this,BL,!1)}hide(){sa(this,LL).rootDom.style.display="none"}show(){sa(this,LL).rootDom.style.display="flex"}getUiConfig(){return sa(this,LL).uiConfig}updateUiConfig(t){const e="CustomViewer.updateUiConfig",i="uiConfig";return!(fR(t,1,e,i)||!WR(t,"customViewer",e,i,1))&&sa(this,LL).updateUiConfig(t)}on(t,e){const i="CustomViewer.on";!fR(t,1,i,"eventName")&&!fR(e,1,i,"listener")&&GR(t,1,i,"eventName",!1)&&zR(e,i,"listener",1)&&sa(this,OL).on(t,e)}off(t,e){const i="CustomViewer.off";!fR(t,1,i,"eventName")&&GR(t,1,i,"eventName",!1)&&(Hd(e)||zR(e,i,"listener",1))&&sa(this,OL).off(t,e)}destroy(){this.isDestroyed||(sa(this,LL).dispose(),sa(this,OL).destroy(),oa(this,LL,null),oa(this,OL,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null)}}function UL(){YP.registerComponent({Root:JP,Layout:XP,Button:$P,Blank:BI,SeparatorLine:KP,Close:FI,Done:UI,Back:NI})}function VL(t,e,i){if(!i||Xd()||!t.isVisible)return;const n=e,s=n.clientWidth;if(t instanceof xL){let t=20;s<1280&&(t=Math.max(13.5,s/1280*20)),n.style.fontSize=`${t}px`}}function WL(t){if(t instanceof Blob)return!0;if(Zd(t)){const e=t=>{try{return new URL(t),!0}catch(t){return!1}};return!(!(t=>/^data:image\/([a-zA-Z]*);base64,/.test(t))(t)&&!e(t))}return!1}function HL(t){return!![PR.REJECTED,PR.ACCEPTED,PR.INITIAL_HERE,PR.SIGN_HERE,PR.WITNESS,PR.APPROVED,PR.NOT_APPROVED,PR.DRAFT,PR.FINAL,PR.COMPLETED,PR.CONFIDENTIAL,PR.VOID].includes(t)}function jL(t){return!!HL(t)||!!Gd(t)||!!nO(t)}function zL(t){return!!Vd(t)&&!(null!=t&&t.content&&!Zd(t.content)||null!=t&&t.color&&!Zd(t.color)||null!=t&&t.fontFamily&&!Zd(t.fontFamily)||null!=t&&t.fontSize&&!qd(t.fontSize)||null!=t&&t.lineThrough&&!Yd(t.lineThrough)||null!=t&&t.underline&&!Yd(t.underline)||null!=t&&t.fontWeight&&!["normal","bold"].includes(t.fontWeight)||null!=t&&t.fontStyle&&!["normal","italic"].includes(t.fontStyle))}function GL(t,e){const i=["Load","Download","Print"],n=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],s=[...n,"MainView"],o=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],r=[...s,...o,...i,"PerspectiveAll","FullQuad"],a=[...s,...o,...i],l=[...s,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],h=[...s,...o,...i,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let c;switch(e){case"captureViewer":c=l;break;case"editViewer":c=h;break;case"perspectiveViewer":c=r;break;case"customViewer":c=n;break;case"browseViewer":c=a}const d=[];return null!=t&&t.type&&!c.includes(null==t?void 0:t.type)&&d.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Zd(t)&&!c.includes(t)&&d.push(t),Vd(t)&&d.push(...GL(t,e))})),d}function YL(t){const e=[];return null!=t&&t.type&&e.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Zd(t)&&e.push(t),Vd(t)&&e.push(...YL(t))})),[...new Set(e)]}function $L(t,e){const i=GL(t,e);if(i.length>0){let t="";return i.forEach(((e,n)=>{n===i.length-1?t+=`${e}`:t+=`${e} `})),t}return!1}function XL(t){const{defaultStyleConfig:e}=t;return Object.keys(e).forEach((t=>{const i=e[t];"object"==typeof i&&null!==i&&((t=>{if("lineEnding"in t&&"object"==typeof t.lineEnding&&null!==t.lineEnding){const e=yM(t.lineEnding,"date");delete t.lineEnding,t.lineEnding=e}})(i),(t=>{"borderWidth"in t&&(t.borderWidth=$u(qd(null==t?void 0:t.borderWidth)?t.borderWidth:1,Ep.dataResolution,Ep.displayResolution))})(i),(t=>{if("textContent"in t)if(Vd(t.textContent)){var e,i,n,s,o,r,a;qd(null==t||null===(e=t.textContent)||void 0===e?void 0:e.fontSize)&&(t.textContent.fontSize=$u(null==t||null===(a=t.textContent)||void 0===a?void 0:a.fontSize,Ep.dataResolution,Ep.displayResolution)),null!=t&&null!==(i=t.textContent)&&void 0!==i&&i.fontStyle&&!["normal","italic"].includes(null==t||null===(n=t.textContent)||void 0===n?void 0:n.fontStyle)&&(t.textContent.fontStyle="normal"),null!=t&&null!==(s=t.textContent)&&void 0!==s&&s.fontWeight&&!["normal","bold"].includes(null==t||null===(o=t.textContent)||void 0===o?void 0:o.fontWeight)&&(t.textContent.fontWeight="normal"),""===(null==t||null===(r=t.textContent)||void 0===r?void 0:r.fontFamily)&&(t.textContent.fontFamily="Helvetica")}else t.textContent={}})(i),(t=>{"lineDash"in t&&t.lineDash.length&&(t.lineDash=$u(t.lineDash,Ep.dataResolution,Ep.displayResolution))})(i),(t=>{"textAlign"in t&&!["left","right","center","justify"].includes(null==t?void 0:t.textAlign)&&(t.textAlign="left")})(i),(t=>{"opacity"in t&&(!qd(null==t?void 0:t.opacity)||(null==t?void 0:t.opacity)<0||(null==t?void 0:t.opacity)>1)&&(t.opacity=1)})(i),"stamp"===t&&(t=>{t.stamp instanceof Blob&&(t.imageData=t.stamp),Zd(t.stamp)&&(WL(t.stamp)?t.imageData=t.stamp:t.stampIcon=HL(t.stamp)?xM(t.stamp,"date"):xM(PR.DRAFT,"date")),nO(t.stamp)&&(t.stampConfig=t.stamp),delete t.stamp})(i))})),{...t,controlsStyle:t.annotationSelectionStyle}}function qL(t){if(""===t)return!0;const e=document.createElement("div");e.style.border=t;const i=t=>""===t||"initial"===t,{borderWidth:n,borderColor:s,borderStyle:o}=e.style;return!(i(n)||i(s)||i(o))}function ZL(t,e,i){const{left:n,top:s,width:o,height:r}=t;return!(n>e||n+o>e||s>i||s+r>i)}function JL(t,e){return Object.keys(t).filter((i=>t[i]===e))}function KL(t,e){if(t===e)return!0;if(Vd(t)&&Vd(e)&&Object.keys(t).length===Object.keys(e).length)for(const i in t){if(!Object.prototype.hasOwnProperty.call(e,i))return!1;if(!KL(t[i],e[i]))return!1}else{if(!Ud(t)||!Ud(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!KL(t[i],e[i]))return!1}return!0}function QL(t,e){let i;switch(t){case"canvasStyle":i=function(t,e){const i=[];return i.push(...eO(t,{border:(null==e?void 0:e.border)||"",background:(null==e?void 0:e.background)||""})),Hd(null==e?void 0:e.cursor)||Zd(e.cursor)||i.push(`${t}.cursor is invalid`),i}(t,e);break;case"pageNumberStyle":i=function(t,e){const i=[],n=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zd(e[s])||i.push(`${t}.${s} is invalid.`)),"border"===s&&Zd(e[s])&&!qL(e[s])&&i.push(`${t}.border is invalid.`),("onPage"===s&&!Yd(e[s])||"opacity"===s&&!qd(e[s])||"visibility"===s&&-1===["visible","hidden"].indexOf(e[s]))&&i.push(`${t}.${s} is invalid.`)})),i}(t,e);break;case"checkBoxStyle":i=function(t,e){const i=[],n=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zd(e[s])||i.push(`${t}.${s} is invalid.`)),"border"===s&&Zd(e[s])&&!qL(e[s])&&i.push(`${t}.border is invalid.`),("opacity"===s&&!qd(e[s])||"visibility"===s&&-1===["visible","hidden"].indexOf(e[s]))&&i.push(`${t}.${s} is invalid.`)})),i}(t,e);break;case"quadSelectionStyle":i=function(t,e){const i=[],n=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zd(e[s])||i.push(`${t}.${s} is invalid`)),"border"!==s&&"ctrlBorder"!==s||!Zd(e[s])||qL(e[s])||i.push(`${t}.${s} is invalid`)})),i}(t,e);break;case"annotationSelectionStyle":i=function(t,e){const i=[],n=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(e).forEach((s=>{-1!==n.indexOf(s)&&(Zd(e[s])||i.push(`${t}.${s} is invalid.`)),"border"!==s&&"ctrlBorder"!==s||!Zd(e[s])||qL(e[s])||i.push(`${t}.${s} is invalid.`)})),i}(t,e);break;default:i=eO(t,e)}return i}function tO(t){return!!qd(t)&&t>=0}function eO(t,e){const i=[];return Object.keys(e).forEach((n=>{-1!==["background","border"].indexOf(n)&&(Zd(e[n])||i.push(`${t}.${n} is invalid.`),"border"===n&&e[n]&&Zd(e[n])&&!qL(e[n])&&i.push(`${t}.border is invalid.`))})),i}function iO(t,e){const i=t.flat(2),n=e.flat(2);if(i.length!==n.length)return!1;const s=n[0].x-i[0].x,o=n[1].y-i[1].y;for(let t=1;t<i.length;t++){if(n[t].x-i[t].x!==s)return!1;if(n[t].y-i[t].y!==o)return!1}return!0}function nO(t){return Array.isArray(t)&&t.every((t=>"object"==typeof t&&null!==t))}function sO(t){const e={};return!1===(null==t?void 0:t.enableZoom)&&(e.enableZoomInWithKeyboard=!1,e.enableZoomOutWithKeyboard=!1),!1===(null==t?void 0:t.enableUndoRedo)&&(e.enableUndoWithKeyboard=!1,e.enableRedoWithKeyboard=!1),!1===(null==t?void 0:t.enableAnnotationClipboard)&&(e.enableCopyCutPasteWithKeyboard=!1),!1===(null==t?void 0:t.enableMoveAnnotation)&&(e.enableMoveAnnotationWithKeyboard=!1),!1===(null==t?void 0:t.enableDeleteAnnotation)&&(e.enableDeleteWithKeyboard=!1),!1===(null==t?void 0:t.enablePageNavigation)&&(e.enableSelectPageWithKeyboard=!1),!1===(null==t?void 0:t.enableMultiplePagesSelection)&&(e.enableSelectWithShift=!1,e.enableSelectWithCtrl=!1),!1===(null==t?void 0:t.enableMultipleAnnotationsSelection)&&(e.enableMultipleSelectAnnotationWithKeyboard=!1),e}class oO{static isLicenseValid(t){if(Zd(t)){const e=t.trim();return 0===e.length||e.startsWith("DLS")||(e.startsWith("f")||e.startsWith("t"))&&e.length>50}return!1}static isQuadValid(t,e){const i=[],n=yw("Quad",e);if(Hd(t))return i.push(`${n} is missing.`),i;const s=xw.isArrayAndMeetMinLength(t,4),o=xw.formatDetails(n,s);return o.length?(i.push(...o),i):(t.forEach(((t,n)=>{const s=yw("Quad",e,`[${n}]`,!0),o=xw.isArrayAndMeetMinLength(t,2),r=xw.formatDetails(yw("Array",s),o);r.length?i.push(...r):t.forEach(((t,e)=>{const n=xw.isNumberAndIsInRange(t),o=xw.formatDetails(yw("Array",s,`[${e}]`,!0),n);o.length&&i.push(...o)}))})),i)}static isRectValid(t,e){const i=[],n=yw("Rect",e);if(Hd(t))return i.push(`${n} is missing.`),i;const s=xw.formatDetails(n,Vd(t));return s.length?(i.push(...s),i):(["left","top","width","height"].forEach((n=>{const s=xw.formatDetails(yw("Rect",e,n),xw.isNumberAndIsInRange(t[n]));s.length&&i.push(...s)})),i)}static isSourceValid(t,e,i){const n=[],s="Source",o=xw.formatDetails(yw(s,e),Vd(t));if(o.length)return n.push(...o),n;const r=xw.formatDetails(yw(s,e,"fileData"),Gd(t.fileData));if(r.length)return n.push(...r),n;if(!Hd(t.extraPageData)){const o=xw.formatDetails(yw(s,e,"extraPageData"),xw.isArrayAndMeetMinLength(t.extraPageData));if(o.length)return n.push(...o),n;t.extraPageData.forEach(((t,o)=>{const r=this.isExtraPageDataValid(t,yw(s,e,`extraPageData[${o}]`,!0),i);r.length&&n.push(...r)}))}return n}static isExtraPageDataValid(t,e,i){const n=[],s="ExtraPageData",o=xw.formatDetails(yw(s,e),Vd(t));if(o.length)return n.push(...o),n;const r=xw.formatDetails(yw(s,e,"index"),xw.isNumberAndIsInRange(t.index));if(n.push(...r),!Hd(t.rotation)){const i=this.isRotationValid(t.rotation,yw(s,e));n.push(...i)}if(!Hd(t.filter)){const o=this.isFilterTypeValid(t.filter,i,yw(s,e));n.push(...o)}return Hd(t.perspectiveQuad)||n.push(...this.isQuadValid(t.perspectiveQuad,yw(s,e,"perspectiveQuad"))),n}static isSourcesValid(t,e,i){const n=[],s="Source[]",o=xw.formatDetails(yw(s,e),xw.isArrayAndMeetMinLength(t));return o.length?(n.push(...o),n):(t.forEach(((t,o)=>{n.push(...this.isSourceValid(t,yw(s,e,`[${o}]`,!0),i))})),n)}static isLoadSourceOptionsValid(t,e){const i=[],n="LoadSourceOptions",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.insertBeforeIndex)){const s=xw.formatDetails(yw(n,e,"insertBeforeIndex"),xw.isNumberAndIsInRange(t.insertBeforeIndex));i.push(...s)}if(!Hd(t.exception)){const s=xw.formatDetails(yw(n,e,"exception"),xw.isStringAndNotEmpty(t.exception,!1));i.push(...s)}return i}static isHandlerTypeValid(t){return{isValid:Zd(t)&&["documentBoundariesDetect","imageFilter"].includes(t)}}static isContainerKeyValid(t,e){const i="container";let n;if(eu(t)&&(n=t),Zd(t)){const e=document.getElementById(t);eu(e)&&(n=e)}const s=[];return n||s.push(`${yw(i,e,i)}: ${vw.CONTAINER_NOT_EXIST.message}`),s}static isContainerParamValid(t){return Zd(t)||eu(t)?this.isContainerKeyValid(t).length>0?vw.CONTAINER_NOT_EXIST:null:vw.PARAM_INVALID}static isUiConfigValid(t,e){const i="UiConfig",n=[],s=xw.formatDetails(yw(i,e),Vd(t));if(s.length)return n.push(...s),n;const o=xw.formatDetails(yw(i,e,"type"),xw.isStringAndNotEmpty(t.type,!1));if(n.push(...o),["id","name","flexDirection","tooltip","className","label"].forEach((s=>{if(!Hd(t[s])){const o=xw.formatDetails(yw(i,e,s),xw.isStringAndNotEmpty(t[s]));n.push(...o)}})),["style","events"].forEach((s=>{if(!Hd(t[s])){const o=xw.formatDetails(yw(i,e,s),Vd(t[s]));n.push(...o)}})),!Hd(t.children)){const s=xw.formatDetails(yw(i,e,"children"),xw.isArrayAndMeetMinLength(t.children));if(s.length)return n.push(...s),n;t.children.forEach(((t,s)=>{if(Zd(t)||Vd(t)||n.push(`${i}.children[${s}] is invalid.`),Vd(t)){const o=this.isUiConfigValid(t,yw(i,e,`children[${s}]`));n.push(...o)}}))}return n}static isDocOptionsValid(t,e){const i=[],n=e||"CreateDocumentOptions",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.name)){const s=xw.formatDetails(yw(n,e,"name"),xw.isStringAndNotEmpty(t.name,!1));i.push(...s)}if(!Hd(t.author)){const s=xw.formatDetails(yw(n,e,"author"),xw.isStringAndNotEmpty(t.author,!1));i.push(...s)}if(!Hd(t.creationDate)){const s=xw.formatDetails(yw(n,e,"creationDate"),xw.isPdfDate(t.creationDate));i.push(...s)}if(!Hd(t.deleteOriginal)){const s=xw.formatDetails(yw(n,e,"deleteOriginal"),Yd(t.deleteOriginal));i.push(...s)}return i}static isTransferOptionsValid(t,e,i,n){const s=[],o="TransferOptions",r=xw.formatDetails(yw(o,n),Vd(t));if(r.length)return s.push(...r),s;if(!Hd(t.sourceIndices)){const r=this.isNumberArrayValid(t.sourceIndices,e,i,yw(o,n,"sourceIndices"));s.push(...r)}if(!Hd(t.insertBeforeIndex)){const e=xw.formatDetails(yw(o,n,"insertBeforeIndex"),xw.isNumberAndIsInRange(t.insertBeforeIndex,0));s.push(...e)}return s}static isNumberArrayValid(t,e,i,n){return this.isTypeArrayValid("number",t,e,i,n)}static isStringArrayValid(t,e){return this.isTypeArrayValid("string",t,void 0,void 0,e)}static isBlobArrayValid(t,e){return this.isTypeArrayValid("blob",t,void 0,void 0,e)}static isTypeArrayValid(t,e,i,n,s){const o=[],r=xw.formatDetails(yw("Array",s),xw.isArrayAndMeetMinLength(e));return r.length?(o.push(...r),o):(e.forEach(((e,r)=>{let a=null;"blob"===t?a=Gd(e):"number"===t?a=xw.isNumberAndIsInRange(e,i,n):"string"===t&&(a=xw.isStringAndNotEmpty(e));const l=xw.formatDetails(yw("Array",s,`[${r}]`,!0),a);o.push(...l)})),o)}static isUpdatePageOptionsValid(t,e,i){const n=[],s="UpdatePageOptions",o=xw.formatDetails(yw(s,i),Vd(t));if(o.length)return n.push(...o),n;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach((e=>{const o=t[e];if(!Hd(o)){const t=xw.formatDetails(yw(s,i,e),xw.isNumberAndIsInRange(o,0));n.push(...t)}})),!Hd(t.rotation)){const e=this.isRotationValid(t.rotation,yw(s,i));n.push(...e)}if(!Hd(t.filter)){const o=this.isFilterTypeValid(t.filter,e,yw(s,i));n.push(...o)}return n}static isRotationValid(t,e){const i=[],n=yw("",e,"rotation"),s=xw.formatDetails(n,xw.isNumberAndIsInRange(t));return s.length?(i.push(...s),i):(i.length||t%90==0||i.push(`'${n}' is not supported.`),i)}static isFilterTypeValid(t,e,i){const n=[],s=yw("",i,"filter"),o=xw.formatDetails(s,xw.isStringAndNotEmpty(t,!1));return o.length?(n.push(...o),n):(!n.length&&"none"!==t&&Ud(e)&&e.length>0&&!e.includes(t)&&n.push(`'${s}' is not supported.`),n)}static isSaveJpegSettingsValid(t,e){const i=[],n="SaveJpegSettings",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.quality)){const s=xw.formatDetails(yw(n,e,"quality"),xw.isNumberAndIsInRange(t.quality,0,100));i.push(...s)}if(!Hd(t.saveAnnotation)){const s=xw.formatDetails(yw(n,e,"saveAnnotation"),Yd(t.saveAnnotation));i.push(...s)}return i}static isSavePngSettingsValid(t,e){const i=[],n="SavePngSettings",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.saveAnnotation)){const s=xw.formatDetails(yw(n,e,"saveAnnotation"),Yd(t.saveAnnotation));i.push(...s)}return i}static isSavePdfSettingsValid(t,e){const i=[],n="SavePdfSettings",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(["author","creator","keyWords","producer","subject","title"].forEach((s=>{const o=t[s];if(!Hd(o)){const t=xw.formatDetails(yw(n,e,s),xw.isStringAndNotEmpty(o,!1));i.push(...t)}})),!Hd(t.compression)){const s=xw.formatDetails(yw(n,e,"compression"),Np.has(t.compression));i.push(...s)}if(!Hd(t.creationDate)){const s=xw.formatDetails(yw(n,e,"creationDate"),xw.isPdfDate(t.creationDate));i.push(...s)}if(!Hd(t.modifiedDate)){const s=xw.formatDetails(yw(n,e,"modifiedDate"),xw.isPdfDate(t.modifiedDate));i.push(...s)}if(!Hd(t.pageType)){const s=xw.formatDetails(yw(n,e,"pageType"),Fp.has(t.pageType));i.push(...s)}if(!Hd(t.version)){const s=xw.formatDetails(yw(n,e,"version"),this.isPdfVersionValid(t.version));i.push(...s)}if(!Hd(t.mimeType)){const s=xw.formatDetails(yw(n,e,"mimeType"),xw.isStringAndNotEmpty(t.mimeType));i.push(...s)}if(!Hd(t.quality)){const s=xw.formatDetails(yw(n,e,"quality"),xw.isNumberAndIsInRange(t.quality,0,100));i.push(...s)}if(!Hd(t.password)){const s=xw.formatDetails(yw(n,e,"password"),xw.isStringAndNotEmpty(t.password));i.push(...s),!s.length&&t.password.length>32&&i.push("The specified password exceeds 32 characters.")}if(!Hd(t.saveAnnotation)){const s=xw.formatDetails(yw(n,e,"saveAnnotation"),["none","image","annotation","flatten"].includes(t.saveAnnotation));i.push(...s)}if(!Hd(t.imageScaleFactor)){const s=xw.formatDetails(yw(n,e,"imageScaleFactor"),xw.isNumberAndIsInRange(t.imageScaleFactor,Number.MIN_VALUE,1));i.push(...s)}return i}static isPdfVersionValid(t){return!!Zd(t)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(t.trim())}static isSaveTiffSettingsValid(t,e){const i=[],n="SaveTiffSettings",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.compression)){const s=xw.formatDetails(yw(n,e,"compression"),Up.has(t.compression));i.push(...s)}if(!Hd(t.customTag)){const s=xw.formatDetails(yw(n,e,"customTag"),xw.isArrayAndMeetMinLength(t.customTag));i.push(...s),s.length||t.customTag.forEach(((t,s)=>{const o=this.isTiffCustomTagValid(t,yw(n,e,`customTag[${s}]`));i.push(...o)}))}if(!Hd(t.quality)){const s=xw.formatDetails(yw(n,e,"quality"),xw.isNumberAndIsInRange(t.quality,0,100));i.push(...s)}return i}static isTiffCustomTagValid(t,e){const i=[],n="CustomTag",s=xw.formatDetails(yw(n,e),Vd(t));if(s.length)return i.push(...s),i;if(!Hd(t.content)){const s=xw.formatDetails(yw(n,e,"content"),xw.isStringAndNotEmpty(t.content,!1));i.push(...s)}if(!Hd(t.contentIsBase64)){const s=xw.formatDetails(yw(n,e,"contentIsBase64"),Yd(t.contentIsBase64));i.push(...s)}if(!Hd(t.id)){const s=xw.formatDetails(yw(n,e,"id"),xw.isNumberAndIsInRange(t.id));i.push(...s)}return i}static isVideoDeviceInfo(t,e){const i=[],n=xw.formatDetails(e,Vd(t));i.push(...n);const s=xw.formatDetails(yw(e,void 0,"deviceId"),xw.isStringAndNotEmpty(t.deviceId,!1));i.push(...s);const o=xw.formatDetails(yw(e,void 0,"label"),xw.isStringAndNotEmpty(t.label,!1));return i.push(...o),i}static isVideoConfig(t,e){const i=[],n=xw.formatDetails(e,Vd(t));if(n.length)return i.push(...n),i;if(!Hd(t.fill)){const n=xw.formatDetails(yw(e,void 0,"fill"),Yd(t.fill));i.push(...n)}if(!Hd(t.resolution)){const n=oO.isNumberArrayValid(t.resolution,0,void 0,yw(e,void 0,"resolution"));i.push(...n)}return i}static isZoomOriginValid(t){const e=[],i=xw.formatDetails("zoomOrigin",Vd(t));return i.length?(e.push(...i),e):(["x","y"].forEach((i=>{const n=t[i];Hd(n)?e.push(`ZoomOrigin.${i} is missing.`):["start","center","end"].includes(n)||e.push(`ZoomOrigin.${i} is valid.`)})),e)}static isAnnotationOptionsValid(t,e,i){const n=[],s=["x","y","rotation"],o=["width","height","borderWidth","opacity","miterLimit","fontSize"],r=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],a=["points"],l=["textContents"],h=["startPoint","endPoint"],c=["flags"],d=["stamp"],u=["lineDash"];if("textTypewriter"===i){const{textContents:i}=t;if(i&&(!Ud(i)||!i.length||i.find((t=>!Vd(t)))||i.every((t=>""===t.content||void 0===t.content||null===t.content))))return n.push(`${e}.textContents is invalid`),n}const p=t=>!!Vd(t)&&!!qd(null==t?void 0:t.x)&&!!qd(null==t?void 0:t.y),g=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Ud(t))return!1;if(e&&t.length<2)return!1;for(let e=0;e<t.length;e++)if(!p(t[e]))return!1;return!0};return Object.keys(t).forEach((f=>{const m=t[f];let v=!0;(s.includes(f)&&!qd(m)||o.includes(f)&&!tO(m)||r.includes(f)&&!Zd(m)||l.includes(f)&&!(t=>{if(!Ud(t))return!1;for(let e=0;e<t.length;e++){const i=t[e];if(!Vd(i))return!1;if(!zL(i))return!1}return!0})(m)||h.includes(f)&&!p(m)||c.includes(f)&&!Vd(m)||d.includes(f)&&!jL(m)||u.includes(f)&&!(t=>{if(!Ud(t))return!1;for(let e=0;e<t.length;e++)if(!tO(t[e]))return!1;return!0})(m))&&(v=!1),a.includes(f)&&("ink"===i?(t=>{if(!Ud(t))return!1;if(!t.length)return!1;for(let e=0;e<t.length;e++)if(!g(t[e],!1))return!1;return!0})(t[f])||(v=!1):g(t[f])||(v=!1)),v||n.push(`${e}.${f} is invalid`)})),n}static isAnnotationDrawingStyleValid(t,e){const i=["opacity","borderWidth"],n=["borderColor","background","textAlign"],s=["lineEnding","textContent"],o=[];return Object.keys(t).forEach((r=>{if(["rectangle","ellipse","polygon","polyline","line","ink","textBox","textTypewriter","stamp"].includes(r)){const a=t[r];Object.keys(a).forEach((t=>{const l=a[t];let h=!0;(i.includes(t)&&!qd(l)||n.includes(t)&&!Zd(l)||s.includes(t)&&!Vd(l))&&(h=!1),"stamp"!==t||jL(l)||(h=!1),"textContent"===t&&h&&(null!=l&&l.content&&!Zd(l.content)||null!=l&&l.color&&!Zd(l.color)||null!=l&&l.fontFamily&&!Zd(l.fontFamily)||null!=l&&l.fontSize&&!qd(l.fontSize)||null!=l&&l.lineThrough&&!Yd(l.lineThrough)||null!=l&&l.underline&&!Yd(l.underline)||null!=l&&l.fontWeight&&!["normal","bold"].includes(l.fontWeight)||null!=l&&l.fontStyle&&!["normal","italic"].includes(l.fontStyle))&&(h=!1),h||o.push(`${e}[${r}].${t} is invalid`)}))}})),o}}var rO=new WeakMap,aO=new WeakMap,lO=new WeakMap;class hO{constructor(t,e){ma(this,lO,{get:cO,set:void 0}),ma(this,rO,{writable:!0,value:void 0}),ma(this,aO,{writable:!0,value:void 0}),oa(this,rO,t),oa(this,aO,e)}get name(){return sa(this,aO).name}get uid(){return sa(this,aO).uid}get pages(){return sa(this,aO).pages.slice()}get creationDate(){return sa(this,aO).creationDate}get author(){return sa(this,aO).author}async loadSource(t,e){const i="IDocument.loadSource",n="sources";ub.makeSureLoadLicenseExist(),fR(t,0,i,n),function(t,e,i,n,s){let o=[];if(Ud(t)){for(let i=0;i<t.length;i++)if(!Gd(t[i]))if(Vd(t[i])){const n=oO.isSourceValid(t[i],yw("Source",void 0,`[${i}]`,!0),e);n.length&&o.push(...n)}else{const t=xw.formatDetails(yw("Source",s,`[${i}]`,!0),!1);o.push(...t)}}else Gd(t)||(o=oO.isSourceValid(t,void 0,e));!o.length||xw.output(0,n,s,o)}(t,sa(this,rO).filterService.getSupportedFilters().map((t=>t.type)),0,i,n),Vd(e)?function(t,e,i){const n=oO.isLoadSourceOptionsValid(t,void 0);!n.length||xw.output(0,i,"loadSourceOptions",n)}(e,0,i):Hd(e)||qR(e,0,i,"index",0),Ud(t)||(t=[t]),t=t.map((t=>Gd(t)?{fileData:t}:t));const s=vw.buildInfo("loadSource",{docUid:this.uid,current:0,total:t.length});return vw.info(s),sa(this,rO).loadSource(t,this.uid,e,s).catch((t=>(s.status="Failed",vw.info(s),vw.reject(t,i))))}async getPageData(t){const e="IDocument.getPageData",i="pageUid";fR(t,0,e,i),GR(t,0,e,i,!1),this.pages.includes(t)||xw.error(e,i,void 0,vw.PAGE_NOT_EXIST);const n=await sa(this,rO).getPageData(t);if(n.raw){const t={data:n.raw.data,width:n.raw.width,height:n.raw.height};n.raw=t}if(n.display){const t={data:n.display.data,width:n.display.width,height:n.display.height};n.display=t}if(n.thumbnail){const t={data:n.thumbnail.data,width:n.thumbnail.width,height:n.thumbnail.height};n.thumbnail=t}n.rotation&&(n.rotation%=360);const{displayResolution:s,dataResolution:o}=Ep;return n.mediaBox=dO($u(n.mediaBox,s,o),2),n.cropBox=dO($u(n.cropBox,s,o),2),n}async updatePage(t,e,i){const n="IDocument.updatePage",s="pageUid",o="data";return fR(t,0,n,s),fR(e,0,n,o),GR(t,0,n,s,!1),jR(this.pages,t,0,n),function(t,e,i,n){Gd(t)||xw.output(0,i,n,void 0,vw.PARAM_INVALID)}(e,0,n,o),Hd(i)||function(t,e,i,n){const s=oO.isUpdatePageOptionsValid(t,e,"updatePageOptions");!s.length||xw.output(0,n,"options",s)}(i,sa(this,rO).filterService.getSupportedFilters().map((t=>t.type)),0,n),sa(this,rO).updatePage(t,e,i)}deletePages(t){const e="IDocument.deletePages",i="indices";if(fR(t,1,e,i)||!YR(t,1,e,i,0,sa(this,lO)-1))return!1;const n=t.map((t=>sa(this,aO).pages[t]));return sa(this,rO).deletePages(this.uid,n)}deleteAllPages(){return sa(this,aO).pages.slice(),sa(this,rO).deleteAllPages(this.uid)}movePages(t,e){const i="IDocument.movePages",n="indices";fR(t,0,i,n),YR(t,0,i,n,0,sa(this,lO)-1),Hd(e)||qR(e,0,i,"insertBeforeIndex",0),e=e>sa(this,lO)-1?void 0:e,sa(this,rO).movePages(this.uid,t,e)}switchPage(t,e){const i="IDocument.switchPage",n="oneIndex",s="anotherIndex";fR(t,0,i,n),fR(e,0,i,s),qR(t,0,i,n,0,sa(this,lO)-1),qR(e,0,i,s,0,sa(this,lO)-1),sa(this,rO).documentService.swapPages(this.uid,t,e)}rename(t){const e="IDocument.rename",i="name";return!fR(t,1,e,i)&&!!GR(t,1,e,i)&&sa(this,rO).documentService.renameDocument(this.uid,t)}setPageCustomData(t,e){const i="IDocument.setPageCustomData",n="pageUid";return fR(t,0,i,n),fR(e,0,i,"data"),GR(t,0,i,n,!1),jR(this.pages,t,0,i),sa(this,rO).setCustomData(t,e)}getPageCustomData(t){const e="IDocument.getPageCustomData",i="pageUid";return fR(t,0,e,i),GR(t,0,e,i,!1),jR(this.pages,t,0,e),sa(this,rO).getCustomData(t)}async saveToJpeg(t,e){const i="IDocument.saveToJpeg",n="index";fR(t,0,i,n),qR(t,0,i,n,0,sa(this,lO)-1),Hd(e)||function(t,e,i){const n=oO.isSaveJpegSettingsValid(t);!n.length||xw.output(0,i,"saveJpegSettings",n)}(e,0,i);const s=this.pages[t],o=vw.buildInfo("save",{docUid:this.uid,pageUids:[s],current:0,total:1});return vw.info(o),sa(this,rO).fileSaveService.saveToJpeg(s,e,o).catch((t=>{o.status="Failed",vw.info(o),vw.reject(t,i)}))}saveToPng(t,e){const i="IDocument.saveToPng",n="index";fR(t,0,i,n),qR(t,0,i,n,0,sa(this,lO)-1),Hd(e)||function(t,e,i){const n=oO.isSavePngSettingsValid(t);n.length&&xw.output(0,i,"savePngSettings",n)}(e,0,i);const s=this.pages[t],o=vw.buildInfo("save",{docUid:this.uid,pageUids:[s],current:0,total:1});return vw.info(o),sa(this,rO).fileSaveService.saveToPng(s,e,o).catch((t=>(o.status="Failed",vw.info(o),vw.reject(t,i))))}saveToPdf(t,e){const i="IDocument.saveToPdf";0===this.pages.length&&vw.throw(vw.DOC_NO_IMAGE),Ud(t)?YR(t,0,i,"indices",0,sa(this,lO)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),Hd(e)||function(t,e,i){const n=oO.isSavePdfSettingsValid(t);!n.length||xw.output(0,i,"savePdfSettings",n)}(e,0,i);const n=[];t.forEach((t=>{n.push(this.pages[t])}));try{!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||ub.makeSureAnnotationLicenseExist()}catch(t){return Promise.reject(t)}const s=vw.buildInfo("save",{docUid:this.uid,pageUids:n,current:0,total:n.length});return vw.info(s),sa(this,rO).fileSaveService.saveToPdf(n,e,s).catch((t=>(s.status="Failed",vw.info(s),vw.reject(t,i))))}saveToTiff(t,e){const i="IDocument.saveToTiff";0===this.pages.length&&vw.throw(vw.DOC_NO_IMAGE),Ud(t)?YR(t,0,i,"indices",0,sa(this,lO)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),Hd(e)||function(t,e,i){const n=oO.isSaveTiffSettingsValid(t);!n.length||xw.output(0,i,"saveTiffSettings",n)}(e,0,i);const n=[];t.forEach((t=>{n.push(this.pages[t])}));const s=vw.buildInfo("save",{docUid:this.uid,pageUids:n,current:0,total:n.length});return vw.info(s),sa(this,rO).fileSaveService.saveToTiff(n,e,s).catch((t=>(s.status="Failed",vw.info(s),vw.reject(t,i))))}print(t,e){const i="IDocument.print";let n,s=e;var o;Ud(t)?(YR(t,0,i,"indices",0,sa(this,lO)-1),n=t):s=t,Hd(s)||Hd(null===(o=s)||void 0===o?void 0:o.printAnnotation)||Yd(s.printAnnotation)||xw.error(i,"setting.printAnnotation",void 0,vw.PARAM_INVALID),0===this.pages.length&&vw.throw(vw.DOC_NO_IMAGE),sa(this,rO).printPages(this.uid,n,s)}insertBlankPage(t,e,i){const n="IDocument.insertBlankPage",s="pageWidth",o="pageHeight";return ub.makeSureLoadLicenseExist(),fR(t,0,n,s),fR(e,0,n,o),qR(t,0,n,s,.72,7200),qR(e,0,n,o,.72,7200),Hd(i)||qR(i,0,n,"insertBeforeIndex",0),sa(this,rO).insertBlankPage(this.uid,Math.floor($u(t,Ep.dataResolution,72))||1,Math.floor($u(e,Ep.dataResolution,72))||1,72,72,i)}}function cO(){return sa(this,aO).pages.length}function dO(t,e){let i=!0;const n=qu(t.left,e),s=qu(t.top,e),o=qu(t.width,e),r=qu(t.height,e),a=1e-7;return(Math.abs(n-t.left)>a||Math.abs(s-t.top)>a||Math.abs(o-t.width)>a||Math.abs(r-t.height)>a)&&(i=!1),i?{left:n,top:s,width:o,height:r}:t}function uO(t,e,i,n,s){if(!Hd(t)){const o="transferOptions",r=oO.isTransferOptionsValid(t,e,i,o);if(r.length)return xw.output(n,s,o,r)}return!0}function pO(t,e,i,n){if(!Hd(t)){const s=oO.isDocOptionsValid(t);if(s.length)return xw.output(e,i,n,s)}return!0}function gO(t,e,i,n,s){const o=e.reduce(((e,i,n)=>(t.has(i)||e.push(`${s}[${n}]:The specified document(s) do not exist.`),e)),[]);return!o.length||xw.output(i,n,s,o,vw.DOC_NOT_EXIST,!0)}const fO=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var mO=new WeakMap,vO=new WeakMap,yO=new WeakMap;const xO=new class extends Ju{constructor(){super(),ma(this,mO,{writable:!0,value:void 0}),ma(this,vO,{writable:!0,value:void 0}),ma(this,yO,{writable:!0,value:void 0}),oa(this,yO,new iu),oa(this,mO,gR),oa(this,vO,new Map),gR.onUnload.on((()=>{sa(this,vO).clear(),sa(this,yO).removeAllEventListeners()}),this);const{documentService:t}=gR;t.onDocumentCreated.on((t=>{const e=sa(this,mO).getDocument(t.docUid),i=new hO(sa(this,mO),e);sa(this,vO).set(i.uid,i),sa(this,yO).emit("documentCreated",t)}),this),t.onDocumentDeleted.on((t=>{sa(this,vO).has(t.docUid)&&sa(this,vO).delete(t.docUid),sa(this,yO).emit("documentDeleted",t)}),this),t.onPagesAddedOut.on((t=>{t.indices.length&&t.pageUids.length&&sa(this,yO).emit("pagesAdded",t)}),this),t.onDeletePagesFromDoc.on((t=>{sa(this,yO).emit("pagesDeleted",t)}),this),t.onDeleteAllPagesFromDoc.on((t=>{sa(this,yO).emit("pagesDeleted",t)}),this)}createDocument(t){pO(t,0,"DocumentManager.createDocument","createDocumentOptions");const e=sa(this,mO).createDocument(t);return sa(this,vO).get(e.uid)}getDocument(t){const e="DocumentManager.getDocument",i="docUid";if(fR(t,1,e,i)||!GR(t,1,e,i))return null;return sa(this,vO).get(t)||(xw.warning(e,i,void 0,vw.DOC_NOT_EXIST),null)}getAllDocuments(){return Array.from(sa(this,vO).values())}deleteDocuments(t){const e="DocumentManager.deleteDocuments",i="docUids";return!(fR(t,1,e,i)||!YM(t,1,e,i,void 0,!1)||!gO(sa(this,vO),t,1,e,i))&&sa(this,mO).deleteDocuments([...new Set(t)])}deleteAllDocuments(){const t=sa(this,mO).documentService.getAllDocuments();return sa(this,mO).deleteDocuments(t.map((t=>t.uid)))}copyPagesToDocument(t,e,i){const n="DocumentManager.copyPagesToDocument",s="sourceDocUid",o="targetDocUid";fR(t,0,n,s),fR(e,0,n,o),GR(t,0,n,s),GR(e,0,n,o);const r=sa(this,vO).get(t),a=sa(this,vO).get(e);return r&&a||vw.throw(vw.DOC_NOT_EXIST,n),uO(i,0,r.pages.length-1,0,n),sa(this,mO).transferDocument(t,e,{...i,copy:!0})}movePagesToDocument(t,e,i){const n="DocumentManager.movePagesToDocument",s="sourceDocUid",o="targetDocUid";fR(t,0,n,s),fR(e,0,n,o),GR(t,0,n,s),GR(e,0,n,o);const r=sa(this,vO).get(t),a=sa(this,vO).get(e);return r&&a||vw.throw(vw.DOC_NOT_EXIST,n),uO(i,0,r.pages.length-1,0,n),sa(this,mO).transferDocument(t,e,i)}mergeDocuments(t,e){const i="DocumentManager.mergeDocuments",n="docUids";fR(t,0,i,n),YM(t,0,i,n,void 0,!1),function(t){return new Set(t).size!==t.length}(t)&&xw.error(void 0,void 0,void 0,vw.DOC_UID_DUPLICATE),gO(sa(this,vO),t,0,i,n),pO(e,0,i,"mergeDocumentOptions");const s=sa(this,mO).mergeDocuments(t,e);return sa(this,vO).get(s.uid)}on(t,e){const i="DocumentManager.on";!fR(t,1,i,"eventName")&&!fR(e,1,i,"listener")&&GR(t,1,i,"eventName",!1)&&zR(e,i,"listener",1)&&(fO.includes(t)?sa(this,yO).on(t,e):vw.warning(vw.PARAM_NOT_SUPPORT,i,"eventName"))}off(t,e){const i="DocumentManager.off";!fR(t,1,i,"eventName")&&GR(t,1,i,"eventName",!1)&&(Hd(e)||zR(e,i,"listener",1))&&(fO.includes(t)?sa(this,yO).off(t,e):vw.warning(vw.PARAM_NOT_SUPPORT,i,"eventName"))}},wO=document.currentScript;let bO="";function CO(){let t,e;var i;if(""===bO&&(yt&&yt.engineResourcePaths?(t=yt.engineResourcePaths.ddv,e=yt.engineResourcePaths.rootDirectory):null!==(i=window)&&void 0!==i&&null!==(i=i.Dynamsoft)&&void 0!==i&&null!==(i=i.Core)&&void 0!==i&&null!==(i=i.CoreModule)&&void 0!==i&&null!==(i=i.engineResourcePaths)&&void 0!==i&&i.ddv&&(t=window.Dynamsoft.Core.CoreModule.engineResourcePaths.ddv,window.Dynamsoft.Core.CoreModule.engineResourcePaths.rootDirectory&&(e=window.Dynamsoft.Core.CoreModule.engineResourcePaths.rootDirectory)),t))if(Zd(t)&&(bO=t),Zd(bO)){if(bO.startsWith("https://")||bO.startsWith("http://"));else if(bO.startsWith("@engineRootDirectory/")){let t=e;e&&Zd(e)&&e.length>0?"/"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)):t="",bO=bO.replace("@engineRootDirectory",t)}else if("@engineRootDirectory"===bO&&(bO=""),e&&Zd(e)&&e.length>0){let t="";"/"==e.charAt(e.length-1)||(t="/"),bO=[e,t,bO].join("")}}else bO="";return bO}var SO=new WeakMap,_O=new WeakMap,TO=new WeakMap;const EO=new class{constructor(){ma(this,SO,{writable:!0,value:""}),ma(this,_O,{writable:!0,value:""}),ma(this,TO,{writable:!0,value:""})}get versionInfo(){return{viewer:wb,engine:np.version}}set engineResourcePath(t){Zd(t)?oa(this,TO,t):vw.throw(vw.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath")}get engineResourcePath(){const t=CO();return""!==t?(oa(this,TO,t),t):(""===sa(this,TO)&&oa(this,TO,`${(()=>{if(!ud&&wO){let{src:t}=wO;const e=t.indexOf("?");if(-1!==e)t=t.substring(0,e);else{const e=t.indexOf("#");-1!==e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})()}engine`),sa(this,TO))}set license(t){!function(t){const e=xw.formatError({isValid:oO.isLicenseValid(t)});!e||xw.output(0,"Core.license","license",void 0,e)}(t),oa(this,_O,t)}get license(){return sa(this,_O)}set deviceFriendlyName(t){Zd(t)?oa(this,SO,t):vw.throw(vw.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName")}get deviceFriendlyName(){return sa(this,SO)}loadWasm(){return async function(t){let e=t.trim();e.endsWith("/")||(e=`${e}/`);const i=vw.buildInfo("loadWasm",{});if(vw.info(i),np.resourceDir=e,!await np.isResourceDirValid())return i.status="Failed",vw.info(i),vw.reject(vw.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");await np.preloadModule("core");const n=np.preloadModule("proc"),s=np.preloadModule("pdf");await Promise.all([n,s]),i.status="Completed",vw.info(i)}(this.engineResourcePath)}init(){return async function(t){const e=vw.buildInfo("init",{});vw.info(e);let i=t.engineResourcePath.trim();if(i.endsWith("/")||(i=`${i}/`),np.resourceDir=i,ub.init(),!await np.isResourceDirValid())return ub.reset(),e.status="Failed",vw.info(e),vw.reject(vw.RESOURCE_NOT_FOUND,"DDV.Core.init");await np.preloadModule("core");let n=function(){var t;let e=null;var i;if(gt&&gt.license)e=null===(i=gt.license.LicenseManager)||void 0===i?void 0:i.license;else if(null!==(t=window)&&void 0!==t&&null!==(t=t.Dynamsoft)&&void 0!==t&&null!==(t=t.Core)&&void 0!==t&&null!==(t=t.mapPackageRegister)&&void 0!==t&&t.license){var n;e=null===(n=window.Dynamsoft.Core.mapPackageRegister.license.LicenseManager)||void 0===n?void 0:n.license}return null!==e?""===e?"":(Zd(e)&&(e=e.trim()),e):null}();null!==n&&""!==n||(n=t.license.trim());let s,o,r=n.startsWith("DLS")||0===n.length,a=!1,l=!1;if(r)try{var h;let e;if(null!=gt&&gt.license?e=await gt.license.getAR():null!==(h=window)&&void 0!==h&&null!==(h=h.Dynamsoft)&&void 0!==h&&null!==(h=h.Core)&&void 0!==h&&null!==(h=h.mapPackageRegister)&&void 0!==h&&h.license&&(e=await window.Dynamsoft.Core.mapPackageRegister.license.getAR()),e)s=e.ar,o=e.u,a=e.pt,e.pk?(s=e.pk,r=!1):l=!0,Hd(s)&&e.ae&&vw.throw(xb(e.ae));else{const e=await async function(t,e,i){const n=new Fb(t);return await n.init(e,i,void 0),{authResult:n.getAuthResult(),clientUUID:n.getClientUUID(),bPublicTrial:n.isPublicTrial()}}(n,i,t.deviceFriendlyName||"");s=e.authResult,o=e.clientUUID,a=e.bPublicTrial}}catch(t){throw ub.setLicenseErr(t),e.status="Failed",vw.info(e),t}else s=n,o="";const c={licenseInfo:null};try{const t=await np.getLicenseInfo(s,r,o);c.licenseInfo=t,ub.setLicenseInfo(t),!l&&a&&t.trial&&t.msg&&Tw({_bNeverShowDialog:!1,engineResourcePath:i,_onLog:console.log},"warn",t.msg)}catch(t){throw t&&t.code<=-8e4&&ub.setLicenseErr(t),e.status="Failed",vw.info(e),t}return r&&(c.deviceUuid=o),e.status="Completed",vw.info(e),c}({license:sa(this,_O),engineResourcePath:this.engineResourcePath,deviceFriendlyName:sa(this,SO)})}};var PO;!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert"}(PO||(PO={}));const AO=[],IO={documentManager:xO,Core:EO,Elements:vR,DocumentDetect:$x,ImageFilter:class{constructor(){va(this,gw),va(this,pw)}get defaultFilterType(){return Bx.NONE}async applyFilter(t,e,i,n){const s=new yp,o=ga(this,pw,fw).call(this,e,i),r=ga(this,gw,mw).call(this,{outputType:t.type,...n||{}});let a;try{const i=await s.initImage({source:t.data,isRGBA:t.type===cp.RGBA,width:t.width,height:t.height,isBGRA:t.type===cp.BGRA});let n;i.srcBuffer&&(t.data=i.srcBuffer),e===Bx.NONE?(n=await s.getImage({jpegQuality:r.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===cp.RGBA,bitDepth:r.bitDepth,xDpi:r.xdpi,yDpi:r.ydpi,returnBlob:!1,returnType:_p[r.outputType]}),s.freeReservedData()):n=await s.filter(dw.get(e),o,r),a=new Blob([n.imageData],{type:n.blobType})}finally{s.terminate()}return a}querySupported(){return[{type:Bx.NONE,label:"Original"},{type:Bx.BLACK_AND_WHITE,label:"B&W"},{type:Bx.GRAY,label:"Grayscale"},{type:Bx.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:ML,CaptureViewer:iM,CustomViewer:NL,EditViewer:xL,PerspectiveViewer:kL,get lastError(){return vw.getLastError()},clearLastError(){vw.lastError=void 0},Experiments:{get(t,e){switch(t){case"WasmEnv":return np;case"ImageProcess":return new Cw;case"FileParser.Options":return gR.getFileParserDefaultOptions(e);case"InnerViewer":return gR.getViewer(e);case"PageSourceInfo":return gR.getPageSourceInfo(e);case"AnnotationInkSignatureBoard":return ZT;case"AnnotationCustomStampBoard":return lE;default:return}},set(t,e){switch(t){case"FileParser.Options":return gR.setFileParserDefaultOptions(e.type,e.options);case"ClearExternalHandler":return gR.clearExternalHandler(e.type);default:return}}},async addFonts(t){const e="DDV.addFonts",i=fR(t,2,e,"fonts");if(i)return i;const n=function(t,e,i,n){const s=xw.formatError({isValid:Ud(t)});if(s)return xw.output(2,i,n,void 0,s);const o=[];return t.forEach(((t,e)=>{const i=xw.formatDetails(yw("Array","font",`[${e}]`,!0),Gd(t));o.push(...i)})),!!o.length&&xw.output(2,i,n,o)}(t,0,e,"fonts");if(n)return n;try{for(let e=0;e<t.length;e++){const i=t[e],n=new Cp,s=await n.getFontInfo(i).catch((t=>{throw n.terminate(),t}));n.terminate();for(let t=0;t<s.fontInfo.length;t++){const e=s.fontInfo[t];AO.includes(e.family)||new FontFace(e.family,s.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then((t=>{document.fonts.add(t),AO.push(e.family),gR.getViewers().forEach((t=>{t.addFontToUi(e.family),t.context.render()}))}));const i=`${e.family}${e.isBold?"Blob":""}${e.isItalic?"Italic":""}`;bp.addPdfFont(i,s.srcBuffer)}}}catch(t){return vw.reject(vw.PARAM_INVALID,e,"fonts")}return Promise.resolve()},getDefaultUiConfig(t,e){const i="DDV.getDefaultUiConfig",n="viewerType";if(fR(t,1,n,i)||!GR(t,1,i,n)||!function(t,e,i){return!!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(t)||xw.output(1,e,i,void 0,vw.PARAM_NOT_SUPPORT)}(t,i,n))return null;let s=null;return Xd()?(s={editViewer:xR,perspectiveViewer:wR,captureViewer:yR,browseViewer:_R}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(s=TR)):(s={editViewer:SR,perspectiveViewer:CR,captureViewer:bR,browseViewer:_R}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(s=ER)),Wd(s)},setProcessingHandler(t,e){const i="DDV.setProcessingHandler",n="type",s="handler";switch(fR(t,0,i,n),fR(e,0,i,s),function(t,e,i,n){const s=xw.formatError(oO.isHandlerTypeValid(t));s&&xw.output(0,i,n,void 0,s)}(t,0,i,n),t){case"documentBoundariesDetect":("function"!=typeof(o=e).detect||"function"!=typeof o.destroy)&&xw.error(i,s);break;case"imageFilter":(function(t){return"function"==typeof t.querySupported&&"defaultFilterType"in t&&"function"==typeof t.applyFilter&&"function"==typeof t.destroy})(e)||xw.error(i,s)}var o;try{switch(t){case"documentBoundariesDetect":gR.setDetectHandler(t,e);break;case"imageFilter":gR.setImageFilterHandler(e)}}catch(t){vw.throw(t,i)}},setFileParser(t,e){gR.setFileParser(t,e)},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=CO(),this.Core.license="",gR.unload(),gR.onUnload.emit(),tL.clear(),this.off("error"),this.off("warning"),this.off("verbose"),this.off("info")},on(t,e){const i="DDV.on";if(fR(t,1,i,"eventName")||fR(e,1,i,"listener")||!GR(t,1,i,"eventName",!1)||!zR(e,i,"listener",1))return;const n={error:"error",warning:"warning",verbose:"verbose",info:"info"}[t];n?vw.on(n,e):vw.throw(vw.PARAM_NOT_SUPPORT,i,"eventName")},off(t,e){const i="DDV.off";if(fR(t,1,i,"eventName")||!GR(t,1,i,"eventName",!1))return;if(!Hd(e)&&!zR(e,i,"listener",1))return;const n={error:"error",warning:"warning",verbose:"verbose",info:"info"}[t];n?vw.off(n,e):vw.throw(vw.PARAM_NOT_SUPPORT,i,"eventName")},EnumImageDataType:cp,EnumConvertMode:qv,EnumDocumentDetectionStatus:Ox,EnumImageFilterType:PO,EnumPDFCompressionType:Lp,EnumPDFPageType:Op,EnumTIFFCompressionType:Mp,EnumStampIcon:PR,EnumLineEnding:AR,EnumAnnotationRenderMode:Zv,annotationManager:lL};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=IO;const DO={cameraCapture:'\n  <svg id="camera-capture" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="24" viewBox="0 0 28 24">\n    <defs>\n      <clipPath id="cameraCaptureclip-path">\n        <rect id="Rectangle_2738" data-name="Rectangle 2738" width="28" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_529" data-name="Group 529" clip-path="url(#cameraCaptureclip-path)">\n      <path id="Path_1455" data-name="Path 1455" d="M24.37,4.174H21.287a1.672,1.672,0,0,1-1.224-.635L18.387,1.066A2.726,2.726,0,0,0,16.356,0H11.615A2.725,2.725,0,0,0,9.6,1.09L7.5,4.174l-3.927,0A3.978,3.978,0,0,0,0,8.206V20.348A3.645,3.645,0,0,0,3.63,24H24.37A3.645,3.645,0,0,0,28,20.348V8.212a3.99,3.99,0,0,0-3.63-4.038m2.593,16.174a2.6,2.6,0,0,1-2.593,2.609H3.63a2.6,2.6,0,0,1-2.592-2.609V8.2A2.935,2.935,0,0,1,3.63,5.218H7.778a.521.521,0,0,0,.429-.228L10.436,1.7a1.663,1.663,0,0,1,1.208-.657h4.683a1.665,1.665,0,0,1,1.221.635l1.676,2.474a2.735,2.735,0,0,0,2.033,1.066l3.06,0a2.946,2.946,0,0,1,2.646,2.991Z" fill="#fff"/>\n      <path id="Path_1456" data-name="Path 1456" d="M14,8.348a5.739,5.739,0,1,0,5.7,5.739A5.729,5.729,0,0,0,14,8.348m0,10.435a4.7,4.7,0,1,1,4.667-4.7A4.687,4.687,0,0,1,14,18.783" fill="#fff"/>\n    </g>\n  </svg>\n  ',galleryImport:'\n  <svg id="gallery-import" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n    <defs>\n      <clipPath id="galleryImportclip-path">\n        <rect id="Rectangle_2739" data-name="Rectangle 2739" width="24" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_531" data-name="Group 531" clip-path="url(#galleryImportclip-path)">\n      <path id="Path_1457" data-name="Path 1457" d="M19.7,18.1V1.6A1.6,1.6,0,0,0,18.1,0H1.6A1.6,1.6,0,0,0,0,1.6V18.1a1.6,1.6,0,0,0,1.6,1.6H18.1a1.6,1.6,0,0,0,1.6-1.6M1.6,1H18.1a.6.6,0,0,1,.6.6V15.4H16.236L13.472,8.489c-.258-.659-.695-.74-.872-.745a1.019,1.019,0,0,0-.911.7L9.722,12.768l-1.5-1.8A1.236,1.236,0,0,0,7.1,10.427a1.211,1.211,0,0,0-1,.659L3.516,15.4H1V1.6A.6.6,0,0,1,1.6,1M15.159,15.4H4.682l2.3-3.842a.236.236,0,0,1,.194-.134.273.273,0,0,1,.241.142L9.464,14.02a.5.5,0,0,0,.839-.113L12.57,8.924ZM1,18.1V16.4H18.7v1.7a.6.6,0,0,1-.6.6H1.6a.6.6,0,0,1-.6-.6" fill="#fff"/>\n      <path id="Path_1458" data-name="Path 1458" d="M22.55,6.571l-1.1-.1a.5.5,0,0,0-.091,1l1.1.1a.6.6,0,0,1,.541.65l-1.3,14.24a.6.6,0,0,1-.653.54L5.714,21.6a.5.5,0,0,0-.09,1l15.332,1.4A1.414,1.414,0,0,0,21.1,24a1.606,1.606,0,0,0,1.593-1.45l1.3-14.243A1.606,1.606,0,0,0,22.55,6.571" fill="#fff"/>\n      <path id="Path_1459" data-name="Path 1459" d="M5.449,7.6A2.15,2.15,0,1,0,3.3,5.45,2.152,2.152,0,0,0,5.449,7.6m0-3.3A1.15,1.15,0,1,1,4.3,5.45,1.151,1.151,0,0,1,5.449,4.3" fill="#fff"/>\n    </g>\n  </svg>\n  ',fileOperations:'\n  <svg id="file-operations" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n    <defs>\n      <clipPath id="fileOpclip-path">\n        <rect id="Rectangle_2763" data-name="Rectangle 2763" width="24" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_558" data-name="Group 558" clip-path="url(#fileOpclip-path)">\n      <path id="Path_1490" data-name="Path 1490" d="M13.5,19H9.949A3.494,3.494,0,0,0,6.5,16H1v-.5a.5.5,0,0,0-1,0v8a.5.5,0,0,0,1,0V23H16.5a.5.5,0,0,0,.5-.5A3.5,3.5,0,0,0,13.5,19M1,22V17H6.5a2.5,2.5,0,0,1,2.449,2H5.5a.5.5,0,0,0,0,1h8a2.5,2.5,0,0,1,2.45,2Z" fill="#fff"/>\n      <path id="Path_1491" data-name="Path 1491" d="M23.56,3.854,20.146.44A1.492,1.492,0,0,0,19.085,0H8.5A1.5,1.5,0,0,0,7,1.5v12a.5.5,0,0,0,1,0V1.5A.5.5,0,0,1,8.5,1H19.085a.5.5,0,0,1,.354.147l3.414,3.414A.5.5,0,0,1,23,4.915V19.5a.5.5,0,0,1-.5.5H19a.5.5,0,1,0,0,1h3.5A1.5,1.5,0,0,0,24,19.5V4.915a1.491,1.491,0,0,0-.439-1.061" fill="#fff"/>\n    </g>\n  </svg>  \n  ',copyTo:'\n  <svg id="copy-to" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="24" viewBox="0 0 20 24">\n    <defs>\n      <clipPath id="copyToclip-path">\n        <rect id="Rectangle_2765" data-name="Rectangle 2765" width="20" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_562" data-name="Group 562" clip-path="url(#copyToclip-path)">\n      <path id="Path_1504" data-name="Path 1504" d="M19.561,3.854,16.146.439A1.49,1.49,0,0,0,15.086,0H4.5A1.5,1.5,0,0,0,3,1.5V3H1.5A1.5,1.5,0,0,0,0,4.5v18A1.5,1.5,0,0,0,1.5,24h14A1.5,1.5,0,0,0,17,22.5V21h1.5A1.5,1.5,0,0,0,20,19.5V4.914a1.49,1.49,0,0,0-.439-1.06M16,22.5a.5.5,0,0,1-.5.5H1.5a.5.5,0,0,1-.5-.5V4.5A.5.5,0,0,1,1.5,4H3V19.5A1.5,1.5,0,0,0,4.5,21H16Zm3-3a.5.5,0,0,1-.5.5H4.5a.5.5,0,0,1-.5-.5V1.5A.5.5,0,0,1,4.5,1H15.086a.5.5,0,0,1,.353.146l3.415,3.415A.5.5,0,0,1,19,4.914Z" fill="#fff"/>\n      <path id="Path_1505" data-name="Path 1505" d="M14.842,10.141l0-.007L12.6,7.885a.5.5,0,0,0-.719.695l.012.012,1.4,1.4h-4.8a.5.5,0,0,0,0,1h4.793l-1.4,1.4a.5.5,0,1,0,.707.707l2.249-2.25a.5.5,0,0,0,.109-.545.53.53,0,0,0-.109-.163" fill="#fff"/>\n    </g>\n  </svg>\n  ',moveTo:'\n  <svg id="move-to" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n    <defs>\n      <clipPath id="moveToclip-path">\n        <rect id="Rectangle_2764" data-name="Rectangle 2764" width="24" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_560" data-name="Group 560" clip-path="url(#moveToclip-path)">\n      <path id="Path_1492" data-name="Path 1492" d="M13.71,12.528l-1.147,1.146a.5.5,0,0,0,.708.708l2-2a.5.5,0,0,0,0-.708l-2-2a.5.5,0,0,0-.708.708l1.147,1.146H5.917c-.552,0-1.1,1,0,1Z" fill="#fff"/>\n      <path id="Path_1493" data-name="Path 1493" d="M.5,13.241a.5.5,0,0,0-.5.5v1.87a1.6,1.6,0,0,0,.01.17A.474.474,0,0,0,.5,16.2a.375.375,0,0,0,.067,0A.522.522,0,0,0,1,15.611v-1.87a.5.5,0,0,0-.5-.5" fill="#fff"/>\n      <path id="Path_1494" data-name="Path 1494" d="M.5,9.282a.5.5,0,0,0-.5.5v1.979a.5.5,0,0,0,1,0V9.782a.5.5,0,0,0-.5-.5" fill="#fff"/>\n      <path id="Path_1495" data-name="Path 1495" d="M12.385,3.258a.4.4,0,0,1,.115.277v.958a.5.5,0,0,0,1,0V3.535a1.389,1.389,0,0,0-.407-.983l-.229-.229a.5.5,0,0,0-.707.707Z" fill="#fff"/>\n      <path id="Path_1496" data-name="Path 1496" d="M9.415,1h.549a.4.4,0,0,1,.276.113l.517.517a.5.5,0,0,0,.719-.695L11.464.923,10.946.405A1.386,1.386,0,0,0,9.964,0H9.415a.5.5,0,0,0,0,1" fill="#fff"/>\n      <path id="Path_1497" data-name="Path 1497" d="M.5,5.323a.5.5,0,0,0-.5.5V7.8a.5.5,0,0,0,1,0V5.823a.5.5,0,0,0-.5-.5" fill="#fff"/>\n      <path id="Path_1498" data-name="Path 1498" d="M8.021,16H6.042a.5.5,0,0,0,0,1H8.021a.5.5,0,0,0,0-1" fill="#fff"/>\n      <path id="Path_1499" data-name="Path 1499" d="M7.436,1a.5.5,0,0,0,0-1H5.457a.5.5,0,0,0,0,1Z" fill="#fff"/>\n      <path id="Path_1500" data-name="Path 1500" d="M.5,1.364a.5.5,0,0,0-.5.5V3.843a.5.5,0,0,0,1,0V1.864a.5.5,0,0,0-.5-.5" fill="#fff"/>\n      <path id="Path_1501" data-name="Path 1501" d="M4.062,16H2.082a.5.5,0,0,0,0,1h1.98a.5.5,0,0,0,0-1" fill="#fff"/>\n      <path id="Path_1502" data-name="Path 1502" d="M3.977.5a.5.5,0,0,0-.5-.5H1.5a.5.5,0,0,0,0,1H3.477a.5.5,0,0,0,.5-.5" fill="#fff"/>\n      <path id="Path_1503" data-name="Path 1503" d="M23.594,9.552,21.447,7.405A1.385,1.385,0,0,0,20.465,7H13.5V6.5a.5.5,0,0,0-1,0v1A.5.5,0,0,0,13,8h7.465a.4.4,0,0,1,.276.113l2.145,2.145a.4.4,0,0,1,.114.276V22.611a.39.39,0,0,1-.389.389H11.889a.39.39,0,0,1-.389-.389V16.5A.5.5,0,0,0,11,16H10a.5.5,0,0,0,0,1h.5v5.611A1.39,1.39,0,0,0,11.889,24H22.611A1.39,1.39,0,0,0,24,22.611V10.534a1.381,1.381,0,0,0-.406-.982" fill="#fff"/>\n    </g>\n  </svg>\n  ',selectAll:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="1"> <path d="M9 11l3 3l8 -8"></path> <path d="M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9"></path> </svg> \n  ',downloadPDF:'\n <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m3.64,22.95H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.44c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.59-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.95c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM19.41,4.99h-3.35c-.27,0-.49-.21-.49-.48V1.28c1.86.52,3.31,1.92,3.85,3.71Z" />\n    <path class="cls-1"\n      d="m8.82,14.97h-2.07c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52s.54-.23.54-.52v-3.47h1.53c1.44,0,2.61-1.13,2.61-2.52s-1.17-2.52-2.61-2.52Zm0,3.99h-1.53v-2.95h1.53c.84,0,1.53.66,1.53,1.47s-.69,1.47-1.53,1.47Z" />\n    <path class="cls-1"\n      d="m23.46,15h-2.69c-1.19,0-2.15.9-2.15,2.01v6.47c0,.29.24.52.54.52s.54-.23.54-.52v-3.31h2.05c.3,0,.54-.23.54-.52s-.24-.52-.54-.52h-2.05v-2.11c0-.53.48-.97,1.07-.97h2.69c.3,0,.54-.23.54-.52s-.24-.52-.54-.52Z" />\n    <path class="cls-1"\n      d="m12.95,14.97c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52,2.58,0,4.68-2.02,4.68-4.51s-2.1-4.51-4.68-4.51Zm.54,7.94v-6.86c1.73.25,3.06,1.69,3.06,3.43s-1.33,3.18-3.06,3.43Z" />\n    <path class="cls-1"\n      d="m7.86,10.46c.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78s-.6-.21-.84,0l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12Z" />\n  </g>\n</svg>\n  ',downloadPNG:'\n    <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 24 24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path class="cls-1"\n      d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n  </g>\n</svg>\n  ',delete:'\n  <svg id="delete" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n    <defs>\n      <clipPath id="deleteclip-path">\n        <rect id="Rectangle_2735" data-name="Rectangle 2735" width="24" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_523" data-name="Group 523" clip-path="url(#deleteclip-path)">\n      <path id="Path_1447" data-name="Path 1447" d="M23.5,4H17V1.5A1.5,1.5,0,0,0,15.5,0h-7A1.5,1.5,0,0,0,7,1.5V4H.5a.5.5,0,0,0,0,1H2.55L4.314,21.761A2.494,2.494,0,0,0,6.8,24H17.2a2.494,2.494,0,0,0,2.485-2.239L21.45,5H23.5a.5.5,0,0,0,0-1M8,1.5A.5.5,0,0,1,8.5,1h7a.5.5,0,0,1,.5.5V4H8ZM18.691,21.657A1.5,1.5,0,0,1,17.2,23H6.8a1.5,1.5,0,0,1-1.492-1.343L3.555,5h16.89Z" fill="#fff"/>\n      <path id="Path_1448" data-name="Path 1448" d="M12,8.5a.5.5,0,0,0-.5.5V19.5a.5.5,0,0,0,1,0V9a.5.5,0,0,0-.5-.5" fill="#fff"/>\n      <path id="Path_1449" data-name="Path 1449" d="M16,8.976l-.5,10.5a.5.5,0,0,0,.476.523H16a.5.5,0,0,0,.5-.476l.5-10.5a.5.5,0,1,0-1-.048" fill="#fff"/>\n      <path id="Path_1450" data-name="Path 1450" d="M7.476,8.5A.5.5,0,0,0,7,9.024l.5,10.5A.5.5,0,0,0,8,20h.025a.5.5,0,0,0,.475-.523L8,8.977A.5.5,0,0,0,7.476,8.5" fill="#fff"/>\n    </g>\n  </svg>\n  ',back:'\n  <svg id="back" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n    <defs>\n      <clipPath id="backclip-path">\n        <rect id="Rectangle_2781" data-name="Rectangle 2781" width="24" height="24" fill="#fff"/>\n      </clipPath>\n    </defs>\n    <g id="Group_597" data-name="Group 597" clip-path="url(#backclip-path)">\n      <path id="Path_1555" data-name="Path 1555" d="M0,12A12,12,0,1,0,12,0,12.013,12.013,0,0,0,0,12m1,0A11,11,0,1,1,12,23,11.013,11.013,0,0,1,1,12" fill="#fff"/>\n      <path id="Path_1556" data-name="Path 1556" d="M4.138,12a.17.17,0,0,1,.005-.024.512.512,0,0,1,.033-.168.532.532,0,0,1,.113-.17l4.219-4.29a.5.5,0,0,1,.714,0,.51.51,0,0,1,0,.719L5.855,11.491h13.5a.509.509,0,0,1,0,1.018H5.853l3.373,3.428a.512.512,0,0,1,0,.72.5.5,0,0,1-.714,0L4.284,12.359a.438.438,0,0,1-.056-.086.5.5,0,0,1-.051-.078A.521.521,0,0,1,4.138,12h0" fill="#fff"/>\n    </g>\n  </svg>\n  ',emptyLibrary:'\n  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="291.648" height="257.641" viewBox="0 0 291.648 257.641">\n    <defs>\n      <clipPath id="emptyLibraryclip-path">\n        <rect id="Rectangle_2706" data-name="Rectangle 2706" width="291.648" height="257.641" transform="translate(12.66)" fill="none"/>\n      </clipPath>\n    </defs>\n    <g id="image-empty" transform="translate(-12.66)">\n      <g id="Group_471" data-name="Group 471" clip-path="url(#emptyLibraryclip-path)">\n        <path id="Path_1418" data-name="Path 1418" d="M160.751,255.727c-66.485,0-118.227-5.845-142.606-73.507-24.415-67.766,19.034-164.7,91.047-166.173,48.757-1,31.942,48.623,74.131,72.638,32.339,18.408,117.378-36.39,113.723,42.777-3.321,71.951-64.267,124.265-136.3,124.265" transform="translate(1.351 1.915)" fill="#f8f8f8"/>\n        <path id="Path_1419" data-name="Path 1419" d="M18.1,93.9a9.048,9.048,0,1,1-9.048-9.048A9.048,9.048,0,0,1,18.1,93.9" transform="translate(12.66 5.997)" fill="#e0e0e0"/>\n        <path id="Path_1420" data-name="Path 1420" d="M230.481,202.978a9.048,9.048,0,1,1-9.048-9.048,9.048,9.048,0,0,1,9.048,9.048" transform="translate(25.364 23.16)" fill="#e0e0e0"/>\n        <path id="Path_1421" data-name="Path 1421" d="M34.644,204.233a5.928,5.928,0,1,1-5.928-5.928,5.928,5.928,0,0,1,5.928,5.928" transform="translate(2.721 23.683)" fill="#e0e0e0"/>\n        <path id="Path_1422" data-name="Path 1422" d="M190.8,199.7c0,1.208-25.187,7.8-54.651,7.8S84.1,200.906,84.1,199.7s22.064-4.679,51.527-4.679S190.8,198.493,190.8,199.7" transform="translate(10.044 23.29)" fill="#e0e0e0"/>\n        <path id="Path_1423" data-name="Path 1423" d="M278.22,131.008a13.14,13.14,0,1,1-13.141-13.14A13.142,13.142,0,0,1,278.22,131.008Z" transform="translate(23.088 14.076)" fill="none" stroke="#e0e0e0" stroke-miterlimit="10" stroke-width="2"/>\n        <path id="Path_1424" data-name="Path 1424" d="M137.744,113.388V195.23L58.638,161.4V84.531s79.6,29.354,79.106,28.857" transform="translate(7.003 10.095)" fill="#fff4eb"/>\n        <path id="Path_1425" data-name="Path 1425" d="M137.744,113.388V195.23L58.638,161.4V84.531S138.241,113.885,137.744,113.388Z" transform="translate(7.003 10.095)" fill="none" stroke="#f4cba2" stroke-miterlimit="10" stroke-width="1"/>\n        <path id="Path_1426" data-name="Path 1426" d="M129.224,113.388V195.23L208.331,161.4V84.531s-79.6,29.354-79.106,28.857" transform="translate(15.432 10.095)" fill="#fff4eb"/>\n        <path id="Path_1427" data-name="Path 1427" d="M129.224,113.388V195.23L208.331,161.4V84.531S128.727,113.885,129.224,113.388Z" transform="translate(15.432 10.095)" fill="none" stroke="#f4cba2" stroke-miterlimit="10" stroke-width="1"/>\n        <path id="Path_1428" data-name="Path 1428" d="M136.187,63.156,58.139,86.447,137.649,116.3l79.6-29.7Z" transform="translate(6.943 7.542)" fill="#f2c097"/>\n        <path id="Path_1429" data-name="Path 1429" d="M40.67,110.107l19.994-25.58L139.1,112.942l-22.392,26.6Z" transform="translate(4.857 10.095)" fill="#f9dec2"/>\n        <path id="Path_1430" data-name="Path 1430" d="M60.952,85.263l77.3,28-21.618,25.681L41.672,109.928Zm-.382-1.329L39.861,110.427l77.116,29.851,23.165-27.519Z" transform="translate(4.76 10.024)" fill="#f4cba2"/>\n        <path id="Path_1431" data-name="Path 1431" d="M129.194,113.529l23.321,27.861,75.561-30.038-19.4-26.836Z" transform="translate(15.429 10.093)" fill="#f9dec2"/>\n        <path id="Path_1432" data-name="Path 1432" d="M129.194,113.529l23.321,27.861,75.561-30.038-19.4-26.836Z" transform="translate(15.429 10.093)" fill="none" stroke="#f4cba2" stroke-miterlimit="10" stroke-width="1"/>\n        <line id="Line_79" data-name="Line 79" x1="29.852" y1="30.847" transform="translate(46.611 39.852)" fill="none" stroke="#e5e5e5" stroke-miterlimit="10" stroke-width="3"/>\n        <line id="Line_80" data-name="Line 80" x1="13.433" y1="29.852" transform="translate(95.866 25.921)" fill="none" stroke="#e5e5e5" stroke-miterlimit="10" stroke-width="3"/>\n        <line id="Line_81" data-name="Line 81" y1="49.255" x2="1.492" transform="translate(141.638 0.05)" fill="none" stroke="#e5e5e5" stroke-miterlimit="10" stroke-width="3"/>\n        <line id="Line_82" data-name="Line 82" y1="30.847" x2="13.433" transform="translate(172.982 25.424)" fill="none" stroke="#e5e5e5" stroke-miterlimit="10" stroke-width="3"/>\n        <line id="Line_83" data-name="Line 83" y1="30.847" x2="32.339" transform="translate(205.818 39.354)" fill="none" stroke="#e5e5e5" stroke-miterlimit="10" stroke-width="3"/>\n      </g>\n    </g>\n  </svg>\n    ',newDoc:'\n    <svg id="add-new-doc" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n      <defs>\n        <clipPath id="newDocclip-path">\n          <rect id="Rectangle_2737" data-name="Rectangle 2737" width="24" height="24" fill="#fff"/>\n        </clipPath>\n      </defs>\n      <g id="Group_527" data-name="Group 527" clip-path="url(#newDocclip-path)">\n        <path id="Path_1453" data-name="Path 1453" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,22.957A10.957,10.957,0,1,1,22.957,12,10.97,10.97,0,0,1,12,22.957" fill="#fff"/>\n        <path id="Path_1454" data-name="Path 1454" d="M17.739,11.478H12.522V6.261a.522.522,0,0,0-1.044,0v5.217H6.261a.522.522,0,1,0,0,1.043h5.217v5.218a.522.522,0,0,0,1.044,0V12.521h5.217a.522.522,0,1,0,0-1.043" fill="#fff"/>\n      </g>\n    </svg>\n    ',uploadedFiles:'\n    <svg id="uploaded-files" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n      <defs>\n        <clipPath id="uploadedFilesclip-path">\n          <rect id="Rectangle_2740" data-name="Rectangle 2740" width="24" height="24" fill="#fff"/>\n        </clipPath>\n      </defs>\n      <g id="Group_533" data-name="Group 533" clip-path="url(#uploadedFilesclip-path)">\n        <path id="Path_1460" data-name="Path 1460" d="M10,12c-5.3,0-9-1.845-9-3.5V6.482C2.6,7.984,5.986,9,10,9s7.4-1.016,9-2.518V9a.5.5,0,0,0,1,0V4.5C20,1.977,15.611,0,10,0S0,1.977,0,4.5v13c0,2.365,3.777,4.248,8.98,4.478H9a.5.5,0,0,0,.022-1C4.068,20.762,1,19,1,17.5V15.014c1.376,1.287,4.072,2.209,7.468,2.434H8.5a.5.5,0,0,0,.033-1C4.31,16.17,1,14.655,1,13V10.482C2.6,11.984,5.986,13,10,13a.5.5,0,0,0,0-1M10,1c5.305,0,9,1.845,9,3.5S15.307,8,10,8,1,6.155,1,4.5,4.7,1,10,1" fill="#fff"/>\n        <path id="Path_1461" data-name="Path 1461" d="M17.5,11A6.5,6.5,0,1,0,24,17.5,6.508,6.508,0,0,0,17.5,11m0,12A5.5,5.5,0,1,1,23,17.5,5.507,5.507,0,0,1,17.5,23" fill="#fff"/>\n        <path id="Path_1462" data-name="Path 1462" d="M19.5,17H18V14.5a.5.5,0,0,0-1,0v3a.5.5,0,0,0,.5.5h2a.5.5,0,0,0,0-1" fill="#fff"/>\n      </g>\n    </svg>  \n    ',print:'\n    <svg id="print" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n      <defs>\n        <clipPath id="printclip-path">\n          <rect id="Rectangle_2742" data-name="Rectangle 2742" width="24" height="24" fill="#fff"/>\n        </clipPath>\n      </defs>\n      <g id="Group_537" data-name="Group 537" clip-path="url(#printclip-path)">\n        <path id="Path_1465" data-name="Path 1465" d="M16.5,19h-9a.5.5,0,0,0,0,1h9a.5.5,0,0,0,0-1" fill="#fff"/>\n        <path id="Path_1466" data-name="Path 1466" d="M16.5,16h-9a.5.5,0,0,0,0,1h9a.5.5,0,0,0,0-1" fill="#fff"/>\n        <path id="Path_1467" data-name="Path 1467" d="M21.5,6H2.5A2.512,2.512,0,0,0,0,8.5v6A2.511,2.511,0,0,0,2.5,17H5v5.5A1.5,1.5,0,0,0,6.5,24h11A1.5,1.5,0,0,0,19,22.5V17h2.5A2.51,2.51,0,0,0,24,14.5v-6A2.511,2.511,0,0,0,21.5,6M18,22.5a.5.5,0,0,1-.5.5H6.5a.5.5,0,0,1-.5-.5V14H18Zm5-8A1.509,1.509,0,0,1,21.5,16H19V13.5a.5.5,0,0,0-.5-.5H5.5a.5.5,0,0,0-.5.5V16H2.5A1.509,1.509,0,0,1,1,14.5v-6A1.509,1.509,0,0,1,2.5,7h19A1.509,1.509,0,0,1,23,8.5Z" fill="#fff"/>\n        <path id="Path_1468" data-name="Path 1468" d="M5.5,5A.5.5,0,0,0,6,4.5V1h8V4.5a.5.5,0,0,0,.5.5h4a.5.5,0,0,0,.5-.5V3.913a1.49,1.49,0,0,0-.439-1.059L16.147.44A1.488,1.488,0,0,0,15.086,0H5.5A.5.5,0,0,0,5,.5v4a.5.5,0,0,0,.5.5m9.94-3.854,2.414,2.415A.5.5,0,0,1,18,3.913V4H15V1h.086a.508.508,0,0,1,.354.146" fill="#fff"/>\n        <path id="Path_1469" data-name="Path 1469" d="M3.5,8A1.5,1.5,0,1,0,5,9.5,1.5,1.5,0,0,0,3.5,8m0,2A.5.5,0,1,1,4,9.5a.5.5,0,0,1-.5.5" fill="#fff"/>\n      </g>\n    </svg>\n    ',uploadPDF:'\n     <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" >\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1 "\n      d="m3.64,22.95H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.44c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.59-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.95c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM19.41,4.99h-3.35c-.27,0-.49-.21-.49-.48V1.28c1.86.52,3.31,1.92,3.85,3.71Z" />\n    <path class="cls-1 "\n      d="m8.82,14.97h-2.07c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52s.54-.23.54-.52v-3.47h1.53c1.44,0,2.61-1.13,2.61-2.52s-1.17-2.52-2.61-2.52Zm0,3.99h-1.53v-2.95h1.53c.84,0,1.53.66,1.53,1.47s-.69,1.47-1.53,1.47Z" />\n    <path class="cls-1 "\n      d="m23.46,15h-2.69c-1.19,0-2.15.9-2.15,2.01v6.47c0,.29.24.52.54.52s.54-.23.54-.52v-3.31h2.05c.3,0,.54-.23.54-.52s-.24-.52-.54-.52h-2.05v-2.11c0-.53.48-.97,1.07-.97h2.69c.3,0,.54-.23.54-.52s-.24-.52-.54-.52Z" />\n    <path class="cls-1 "\n      d="m12.95,14.97c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52,2.58,0,4.68-2.02,4.68-4.51s-2.1-4.51-4.68-4.51Zm.54,7.94v-6.86c1.73.25,3.06,1.69,3.06,3.43s-1.33,3.18-3.06,3.43Z" />\n    <path class="cls-1" transform="scale(1, -1) translate(0, -14)"\n      d="m7.86,10.46c.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78s-.6-.21-.84,0l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12Z" />\n  </g>\n</svg>\n    ',uploadPNG:'\n<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" >\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path class="cls-1" transform="scale(1, -1) translate(0, -14)"\n      d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n  </g>\n</svg>\n    ',sharePDF:'\n <svg id="sharePdf" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" >\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="sharePdf">\n    <path class="cls-1"\n      d="m3.64,22.95H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.44c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.59-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.95c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM19.41,4.99h-3.35c-.27,0-.49-.21-.49-.48V1.28c1.86.52,3.31,1.92,3.85,3.71Z" />\n    <path class="cls-1"\n      d="m8.82,14.97h-2.07c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52s.54-.23.54-.52v-3.47h1.53c1.44,0,2.61-1.13,2.61-2.52s-1.17-2.52-2.61-2.52Zm0,3.99h-1.53v-2.95h1.53c.84,0,1.53.66,1.53,1.47s-.69,1.47-1.53,1.47Z" />\n    <path class="cls-1"\n      d="m23.46,15h-2.69c-1.19,0-2.15.9-2.15,2.01v6.47c0,.29.24.52.54.52s.54-.23.54-.52v-3.31h2.05c.3,0,.54-.23.54-.52s-.24-.52-.54-.52h-2.05v-2.11c0-.53.48-.97,1.07-.97h2.69c.3,0,.54-.23.54-.52s-.24-.52-.54-.52Z" />\n    <path class="cls-1"\n      d="m12.95,14.97c-.3,0-.54.23-.54.52v7.98c0,.29.24.52.54.52,2.58,0,4.68-2.02,4.68-4.51s-2.1-4.51-4.68-4.51Zm.54,7.94v-6.86c1.73.25,3.06,1.69,3.06,3.43s-1.33,3.18-3.06,3.43Z" />\n    <path transform="scale(0.4, -0.4) translate(8, -30)" stroke="#fff" fill="#fff" stroke-width="1px" d="M19.489,15.009h0c-.008,0-.014,0-.022,0a4.465,4.465,0,0,0-3.749,2.052l-7-3.5a4.482,4.482,0,0,0,0-3.1l7-3.5a4.466,4.466,0,0,0,3.771,2.053l.018,0A4.516,4.516,0,1,0,15.282,6.06L8.257,9.574a4.49,4.49,0,1,0-4.793,6.814,4.548,4.548,0,0,0,1.043.122,4.468,4.468,0,0,0,3.755-2.056l7.018,3.511a4.485,4.485,0,1,0,4.209-2.956M17.13,1.914a3.508,3.508,0,1,1,2.366,6.1h-.01l-.011,0a3.476,3.476,0,0,1-3.112-1.932l0-.006a3.525,3.525,0,0,1,.769-4.162M3.693,15.415a3.5,3.5,0,1,1,3.931-4.967v0a3.47,3.47,0,0,1,0,3.119l0,0a3.479,3.479,0,0,1-3.931,1.842m17.636,7.066a3.5,3.5,0,0,1-4.971-4.53l0,0a3.477,3.477,0,0,1,3.126-1.936l.011,0a3.5,3.5,0,0,1,1.831,6.472" />\n  </g>\n</svg>\n  ',sharePNG:'\n<svg id="sharePng" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" >\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="sharePng">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path transform="scale(0.4, -0.4) translate(8, -30)" stroke="#fff" fill="#fff" stroke-width="1px" d="M19.489,15.009h0c-.008,0-.014,0-.022,0a4.465,4.465,0,0,0-3.749,2.052l-7-3.5a4.482,4.482,0,0,0,0-3.1l7-3.5a4.466,4.466,0,0,0,3.771,2.053l.018,0A4.516,4.516,0,1,0,15.282,6.06L8.257,9.574a4.49,4.49,0,1,0-4.793,6.814,4.548,4.548,0,0,0,1.043.122,4.468,4.468,0,0,0,3.755-2.056l7.018,3.511a4.485,4.485,0,1,0,4.209-2.956M17.13,1.914a3.508,3.508,0,1,1,2.366,6.1h-.01l-.011,0a3.476,3.476,0,0,1-3.112-1.932l0-.006a3.525,3.525,0,0,1,.769-4.162M3.693,15.415a3.5,3.5,0,1,1,3.931-4.967v0a3.47,3.47,0,0,1,0,3.119l0,0a3.479,3.479,0,0,1-3.931,1.842m17.636,7.066a3.5,3.5,0,0,1-4.971-4.53l0,0a3.477,3.477,0,0,1,3.126-1.936l.011,0a3.5,3.5,0,0,1,1.831,6.472" />\n  </g>\n</svg>\n  ',done:'<svg id="done" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="done-path">\n      <rect id="Rectangle_2775" data-name="Rectangle 2775" width="24" height="24" fill="#fe8e14"/>\n    </clipPath>\n  </defs>\n  <g id="Group_584" data-name="Group 584" clip-path="url(#doneclip-path)">\n    <path id="Path_1526" data-name="Path 1526" d="M17.6,6.7l-6.691,9.081L6.313,12.11a.5.5,0,0,0-.625.781l5,4a.508.508,0,0,0,.378.1.493.493,0,0,0,.337-.2l7-9.5A.5.5,0,1,0,17.6,6.7" fill="#fe8e14"/>\n    <path id="Path_1527" data-name="Path 1527" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="#fe8e14"/>\n  </g>\n</svg>\n',captureAnother:'\n<svg id="capture-another" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n  <defs>\n    <clipPath id="captureAnotherclip-path">\n      <rect id="Rectangle_2777" data-name="Rectangle 2777" width="28.761" height="23" fill="#fff"/>\n    </clipPath>\n  </defs>\n  <g id="Group_589" data-name="Group 589" clip-path="url(#captureAnotherclip-path)">\n    <path id="Path_1544" data-name="Path 1544" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n    <path id="Path_1545" data-name="Path 1545" d="M14.38,6.194a6.5,6.5,0,1,0,6.5,6.5,6.508,6.508,0,0,0-6.5-6.5m0,12a5.5,5.5,0,1,1,5.5-5.5,5.507,5.507,0,0,1-5.5,5.5" fill="#fff"/>\n    <path id="Path_1546" data-name="Path 1546" d="M17.381,12.194h-2.5v-2.5a.5.5,0,0,0-1,0v2.5h-2.5a.5.5,0,0,0,0,1h2.5v2.5a.5.5,0,1,0,1,0v-2.5h2.5a.5.5,0,0,0,0-1" fill="#fff"/>\n  </g>\n</svg>\n',edit:'\n<svg id="edit" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24.002" height="24" viewBox="0 0 24.002 24">\n  <defs>\n    <clipPath id="editclip-path">\n      <rect id="Rectangle_2778" data-name="Rectangle 2778" width="24.002" height="24" fill="none" stroke="currentColor" stroke-width="1"/>\n    </clipPath>\n  </defs>\n  <g id="Group_591" data-name="Group 591" clip-path="url(#editclip-path)">\n    <path id="Path_1547" data-name="Path 1547" d="M21.5,13.5v9a1,1,0,0,1-1,1H1.5a1,1,0,0,1-1-1V3.5a1,1,0,0,1,1-1h11" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/>\n    <path id="Path_1548" data-name="Path 1548" d="M9.824,17.007l-3.99,1.049L7,14.177,20.674.5,23.5,3.328Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"/>\n  </g>\n</svg>\n',crop:'\n<svg id="crop" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cropclip-path">\n      <rect id="Rectangle_2787" data-name="Rectangle 2787" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_609" data-name="Group 609" clip-path="url(#cropclip-path)">\n    <path id="Path_1569" data-name="Path 1569" d="M18.95,5.05a.745.745,0,0,1,.243.536V18.2h.974V5.586a1.681,1.681,0,0,0-.521-1.232,1.681,1.681,0,0,0-1.232-.521H5.8v.974h12.61a.745.745,0,0,1,.536.243" fill="currentColor"/>\n    <path id="Path_1570" data-name="Path 1570" d="M5.609,19.17a.789.789,0,0,1-.779-.779V0H3.856V3.833H0v.974H3.856V18.391a1.748,1.748,0,0,0,1.753,1.753H19.193V24h.974V20.144H24V19.17Z" fill="currentColor"/>\n  </g>\n</svg>\n',rotate:'\n<svg id="rotate" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="rotateclip-path">\n      <rect id="Rectangle_2786" data-name="Rectangle 2786" width="24" height="24" fill="#fff"/>\n    </clipPath>\n  </defs>\n  <g id="Group_607" data-name="Group 607" clip-path="url(#rotateclip-path)">\n    <path id="Path_1567" data-name="Path 1567" d="M15.557,11H1.5A1.5,1.5,0,0,0,0,12.5v10A1.5,1.5,0,0,0,1.5,24H15.557a1.5,1.5,0,0,0,1.5-1.5v-10a1.5,1.5,0,0,0-1.5-1.5m.5,11.5a.5.5,0,0,1-.5.5H1.5a.5.5,0,0,1-.5-.5v-10a.5.5,0,0,1,.5-.5H15.557a.5.5,0,0,1,.5.5Z" fill="#fff"/>\n    <path id="Path_1568" data-name="Path 1568" d="M21.022,6.667A9.785,9.785,0,0,0,13.845,3.69h-2.2l2.9-2.876L13.83,0,9.624,4.181,13.83,8.387l.717-.814-2.9-2.9h2.2a8.825,8.825,0,0,1,6.5,2.69,8.859,8.859,0,0,1,2.677,6.483l.982,0a9.777,9.777,0,0,0-2.978-7.175" fill="#fff"/>\n  </g>\n</svg>\n',annotate:'\n<svg id="annotate" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="annotateclip-path">\n      <rect id="Rectangle_2785" data-name="Rectangle 2785" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_605" data-name="Group 605" clip-path="url(#annotateclip-path)">\n    <path id="Path_1561" data-name="Path 1561" d="M9.575,21H4.934A2.5,2.5,0,0,0,2.99,19.051V4.949A2.5,2.5,0,0,0,4.934,3H18.993a2.5,2.5,0,0,0,1.943,1.949V11.11a.5.5,0,1,0,1,0V4.949A2.5,2.5,0,1,0,18.993,2H4.934A2.493,2.493,0,1,0,2,4.949v14.1A2.5,2.5,0,1,0,4.934,22H9.575a.5.5,0,0,0,0-1M21.435,1a1.5,1.5,0,1,1-1.5,1.5,1.5,1.5,0,0,1,1.5-1.5M1,2.5A1.495,1.495,0,1,1,2.493,4,1.5,1.5,0,0,1,1,2.5M2.493,23a1.5,1.5,0,1,1,1.494-1.5A1.5,1.5,0,0,1,2.493,23" fill="currentColor"/>\n    <path id="Path_1562" data-name="Path 1562" d="M23.561,14.718l-.908-.912a1.483,1.483,0,0,0-1.944-.149l-4.539,3.35-2.563,2.571a.5.5,0,0,0,0,.707l.277.278-1.791,1.711A1,1,0,0,0,12.779,24h2.883a.5.5,0,0,0,.333-.128l.626-.563.509.511a.5.5,0,0,0,.7,0l2.613-2.627,3.264-4.534a1.5,1.5,0,0,0-.151-1.941M15.471,23H12.779l1.81-1.73L15.915,22.6Zm7.434-6.928-3.214,4.475-2.208,2.212-2.82-2.829,2.155-2.167,4.482-3.3a.5.5,0,0,1,.647.05h0l.907.912a.5.5,0,0,1,.05.647" fill="currentColor"/>\n    <path id="Path_1563" data-name="Path 1563" d="M5.082,10.014a4.479,4.479,0,0,0,.738,2.46c.007.012.007.025.015.036l.009.009a4.5,4.5,0,1,0-.762-2.505M9.07,6.565V9.746L6.428,11.512A3.464,3.464,0,0,1,9.07,6.565m3.988,3.449a3.474,3.474,0,0,1-6.075,2.329L9.845,10.43a.5.5,0,0,0,.222-.416V6.565a3.491,3.491,0,0,1,2.991,3.449" fill="currentColor"/>\n    <path id="Path_1564" data-name="Path 1564" d="M18.542,6.534H16.049a.5.5,0,0,0,0,1h2.493a.5.5,0,0,0,0-1" fill="currentColor"/>\n    <path id="Path_1565" data-name="Path 1565" d="M18.542,9.534H16.049a.5.5,0,0,0,0,1h2.493a.5.5,0,0,0,0-1" fill="currentColor"/>\n    <path id="Path_1566" data-name="Path 1566" d="M18.542,12.534H16.049a.5.5,0,0,0,0,1h2.493a.5.5,0,0,0,0-1" fill="currentColor"/>\n  </g>\n</svg>\n',defaultDocument:'\n<svg id="document" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="24" viewBox="0 0 20 24">\n  <defs>\n    <clipPath id="documentclip-path">\n      <rect id="Rectangle_2779" data-name="Rectangle 2779" width="20" height="24" fill="#9AA0A6"/>\n    </clipPath>\n  </defs>\n  <g id="Group_593" data-name="Group 593" clip-path="url(#documentclip-path)">\n    <path id="Path_1549" data-name="Path 1549" d="M19.56,3.85,16.15.44A1.52,1.52,0,0,0,15.09,0H4.5A1.5,1.5,0,0,0,3,1.5V3H1.5A1.5,1.5,0,0,0,0,4.5v18A1.5,1.5,0,0,0,1.5,24h14A1.5,1.5,0,0,0,17,22.5V21h1.5A1.5,1.5,0,0,0,20,19.5V4.91a1.52,1.52,0,0,0-.44-1.06M16,22.5a.5.5,0,0,1-.5.5H1.5a.5.5,0,0,1-.5-.5V4.5A.5.5,0,0,1,1.5,4H3V19.5A1.5,1.5,0,0,0,4.5,21H16Zm3-3a.5.5,0,0,1-.5.5H4.5a.5.5,0,0,1-.5-.5V1.5A.5.5,0,0,1,4.5,1H15.09a.492.492,0,0,1,.35.15l3.41,3.41a.468.468,0,0,1,.15.35Z" fill="#9AA0A6"/>\n    <path id="Path_1550" data-name="Path 1550" d="M7.66,6.4h5.18a.5.5,0,0,0,0-1H7.66a.5.5,0,0,0,0,1" fill="#9AA0A6"/>\n    <path id="Path_1551" data-name="Path 1551" d="M15.5,9.08h-8a.5.5,0,1,0,0,1h8a.5.5,0,1,0,0-1" fill="#9AA0A6"/>\n    <path id="Path_1552" data-name="Path 1552" d="M15.5,13.08h-8a.5.5,0,1,0,0,1h8a.5.5,0,0,0,0-1" fill="#9AA0A6"/>\n  </g>\n</svg>\n',selectedCircle:'\n<svg id="selected-circle" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="selected-circleclip-path">\n      <rect id="Rectangle_2751" data-name="Rectangle 2751" width="24" height="24" fill="none"/>\n    </clipPath>\n  </defs>\n  <g id="Group_547" data-name="Group 547" clip-path="url(#selected-circleclip-path)">\n    <path id="Path_1478" data-name="Path 1478" d="M24,12A12,12,0,1,1,12,0,12,12,0,0,1,24,12" fill="#fe8e14"/>\n    <path id="Path_1479" data-name="Path 1479" d="M10.52,17.174a2.517,2.517,0,0,1-1.757-.725L5.757,13.442a1,1,0,0,1,1.414-1.414l3,3a.49.49,0,0,0,.387.144.511.511,0,0,0,.373-.2l5.8-7.742a1,1,0,0,1,1.6,1.2l-5.81,7.748a2.514,2.514,0,0,1-1.83.994c-.059,0-.117.006-.176.006" fill="#fff"/>\n  </g>\n</svg>\n',filter:'\n<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 24" width="25" height="24" >\n  <defs>\n    <style>\n      .cls-1 {\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m20.27,8.85c.04-.31.06-.62.06-.95,0-4.36-3.51-7.9-7.83-7.9s-7.83,3.54-7.83,7.9c0,.32.02.63.06.94C1.95,10.06,0,12.85,0,16.1c0,4.36,3.51,7.9,7.83,7.9,1.75,0,3.37-.59,4.67-1.58,1.31.99,2.92,1.58,4.67,1.58,4.32,0,7.83-3.54,7.83-7.9,0-3.25-1.95-6.04-4.73-7.25Zm-3.09,14.1c-1.43,0-2.76-.45-3.86-1.22-.29-.2-.56-.43-.81-.67-1.3-1.25-2.11-3-2.11-4.95,0-.2.01-.4.03-.59.03-.36.09-.7.17-1.04-.34-.1-.66-.23-.98-.38-.09.35-.16.7-.21,1.07-.04.31-.06.62-.06.95,0,2.2.9,4.19,2.34,5.62-1.1.77-2.43,1.22-3.86,1.22-3.74,0-6.78-3.07-6.78-6.85,0-2.73,1.6-5.09,3.9-6.19.31-.15.64-.28.98-.38.61-.18,1.24-.28,1.91-.28,1.43,0,2.76.45,3.86,1.22.29.2.56.43.81.67.25-.24.53-.47.81-.67-.25-.25-.53-.48-.81-.7-1.31-.99-2.92-1.58-4.67-1.58-.72,0-1.42.11-2.08.29-.02-.2-.03-.39-.03-.59,0-3.78,3.04-6.85,6.78-6.85s6.78,3.07,6.78,6.85c0,.2-.01.4-.03.59-.03.36-.09.7-.17,1.04-.49,2.02-1.87,3.68-3.69,4.55-.31.15-.64.28-.98.38.08.34.14.69.17,1.04.35-.1.69-.21,1.01-.35,2.19-.95,3.85-2.88,4.47-5.24,2.3,1.1,3.9,3.45,3.9,6.19,0,3.78-3.04,6.85-6.78,6.85Z" />\n  </g>\n</svg>\n  ',close:'\n            <svg\n            xmlns="http://www.w3.org/2000/svg"\n            viewBox="0 0 24 24"\n            fill="none"\n            stroke="currentColor"\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            width="24"\n            height="24"\n            stroke-width="2"\n          >\n            <path d="M18 6l-12 12"></path>\n            <path d="M6 6l12 12"></path>\n          </svg>\n'};function kO(){return"ontouchstart"in document.documentElement}function RO(t){return"string"==typeof t?document.querySelector(t):t instanceof HTMLElement?t:null}function MO(t){if(!t)return`Doc-${Date.now()}`;const e=t.lastIndexOf(".");return-1!==e?t.substring(0,e):t}function LO(t,e){if(!document.getElementById(t)){const i=document.createElement("style");i.id=t,i.textContent=e,document.head.appendChild(i)}}class OO{constructor(t){this.config=t,this.checked=!1,this.isSelectMode=!1,this.createUI(),this.bindEvents()}createUI(){LO("mwc-document-item-style",BO);const t=IO.documentManager.getDocument(this.config.docId),e=t.pages.length;this.dom=document.createElement("div"),this.dom.className="mwc-document-item",this.dom.innerHTML=`\n      <div class="mwc-document-info-container">\n        <div class="mwc-document-thumbnail">\n          ${DO.defaultDocument}\n        </div>\n        <div class="mwc-document-info">\n          <div class="mwc-document-name-container">\n            <div class="mwc-document-name">${t.name}</div>\n            <button type="button" class="mwc-document-rename-btn">\n              ${DO.edit}\n            </button>\n          </div>\n          <div class="mwc-document-pages">${e} pages</div>\n        </div>\n      </div>\n      <input type="checkbox" class="mwc-document-checkbox">\n    `,this.checkbox=this.dom.querySelector(".mwc-document-checkbox"),this.renameBtn=this.dom.querySelector(".mwc-document-rename-btn"),this.updateThumbnail(t)}async updateThumbnail(t){const e=this.dom.querySelector(".mwc-document-thumbnail");if(e.textContent="",t.pages[0]){const i=await t.getPageData(t.pages[0]),n=URL.createObjectURL(i.display.data),s=document.createElement("img");s.className="mwc-image-thumbnail",s.alt="mwc-image-thumbnail",s.src=n,e.append(s)}else e.innerHTML=DO.defaultDocument}bindEvents(){this.dom.addEventListener("click",(t=>{var e,i;t.target!==this.checkbox&&(this.isSelectMode?this.toggleCheck():null===(i=(e=this.config).onDocumentClick)||void 0===i||i.call(e,this.config.docId))})),this.checkbox.addEventListener("click",(t=>{t.stopPropagation(),this.toggleCheck()})),this.renameBtn.addEventListener("click",(t=>{var e,i;t.stopPropagation(),null===(i=(e=this.config).onRename)||void 0===i||i.call(e,this.config.docId)}))}setSelectMode(t){this.isSelectMode=t,t||this.toggleCheck(!1)}toggleCheck(t){var e,i;this.checked=null!=t?t:!this.checked,this.checkbox.checked=this.checked,this.dom.classList.toggle("selected",this.checked),null===(i=(e=this.config).onCheckedChange)||void 0===i||i.call(e,this.config.docId,this.checked)}getDom(){return this.dom}getUid(){return this.config.docId}update(){const t=IO.documentManager.getDocument(this.config.docId);if(!t)return;const e=this.dom.querySelector(".mwc-document-name"),i=this.dom.querySelector(".mwc-document-pages");e.textContent=t.name,i.textContent=`${t.pages.length} pages`,this.updateThumbnail(t)}dispose(){this.dom.remove()}}const BO="\n.mwc-document-item {\n  display: grid;\n  grid-template-columns: 90% 10%;\n  background-color: #EFEFEF;\n  cursor: pointer;\n  font-family: Verdana;\n  padding: 15px;\n  align-items: center;\n  border: 2px solid transparent;\n}\n\n.mwc-document-item.selected {\n  border: 2px solid #FE8E14;\n}\n\n.mwc-document-info-container {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.mwc-document-info {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding-right: 1rem;\n}\n\n.mwc-document-item .mwc-document-name-container {\n  display: grid;\n  grid-template-columns: 90% 10%;\n}\n\n.mwc-document-item .mwc-document-name-container .mwc-document-name {\n  font-size: 16px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.mwc-document-item .mwc-document-name-container .mwc-document-rename-btn{\n  background: none;\n  border: none;\n  cursor: pointer;\n}\n\n.mwc-document-item .mwc-document-name-container .mwc-document-rename-btn svg {\n  width: 16px;\n  height: 16px;\n  stroke: black;\n}\n\n.mwc-document-item .mwc-document-pages {\n  color: #888888;\n}\n\n.mwc-document-thumbnail {\n  width: 70px;\n  height: 70px;\n  background-color: #DADCE0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-shrink: 0;\n}\n\n.mwc-document-thumbnail svg {\n  width: 48px;\n  height: 48px;\n  padding: 1rem;\n}\n\n.mwc-image-thumbnail {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n\n.mwc-document-checkbox {\n  cursor: pointer;\n  accent-color: #FE8E14;\n  width: 24px;\n  height: 24px;\n  justify-self: end;\n}\n";var FO,NO,UO,VO;!function(t){t.Library="library",t.Page="page",t.Document="document",t.Transfer="transfer",t.History="history"}(FO||(FO={})),function(t){t.Library="library",t.Page="page",t.Document="document",t.Transfer="transfer",t.History="history",t.Scanner="scanner",t.Correction="correction",t.ScanResult="scan-result"}(NO||(NO={})),function(t){t.CONFIRM="confirm",t.INPUT="input",t.TOAST="toast"}(UO||(UO={})),function(t){t.WARNING="warning",t.ERROR="error",t.SUCCESS="success"}(VO||(VO={}));const WO={[VO.WARNING]:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24" fill="currentColor" class="modal-icon warning">\n  <path width="24" height="24" fill="currentColor"\n    d="M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48zm0 319.91a20 20 0 1120-20 20 20 0 01-20 20zm21.72-201.15l-5.74 122a16 16 0 01-32 0l-5.74-121.94v-.05a21.74 21.74 0 1143.44 0z" />\n</svg>\n  ',[VO.ERROR]:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="modal-icon error">\n      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />\n    </svg>\n  ',[VO.SUCCESS]:'\n  <svg id="selected-circle" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="modal-icon " width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="selected-circleclip-path">\n      <rect id="Rectangle_2751" data-name="Rectangle 2751" width="24" height="24" fill="none"/>\n    </clipPath>\n  </defs>\n  <g id="Group_547" data-name="Group 547" clip-path="url(#selected-circleclip-path)">\n    <path id="Path_1478" data-name="Path 1478" d="M24,12A12,12,0,1,1,12,0,12,12,0,0,1,24,12" fill="#fe8e14"/>\n    <path id="Path_1479" data-name="Path 1479" d="M10.52,17.174a2.517,2.517,0,0,1-1.757-.725L5.757,13.442a1,1,0,0,1,1.414-1.414l3,3a.49.49,0,0,0,.387.144.511.511,0,0,0,.373-.2l5.8-7.742a1,1,0,0,1,1.6,1.2l-5.81,7.748a2.514,2.514,0,0,1-1.83.994c-.059,0-.117.006-.176.006" fill="#fff"/>\n  </g>\n</svg>'};async function HO(t,e,i=VO.SUCCESS,n=1500){return await jO({container:t,type:UO.TOAST,title:e,variant:i,duration:n})}function jO({container:t,type:e=UO.CONFIRM,variant:i=VO.SUCCESS,title:n,message:s,placeholder:o,initialValue:r="",confirmText:a="OK",cancelText:l="CANCEL",validation:h,duration:c,showCloseBtn:d}){if(!document.getElementById("modal-styles")){const t=document.createElement("style");t.id="modal-styles",t.textContent=zO,document.head.appendChild(t)}const u=t.style.position;t.style.position||(t.style.position="relative");const p=document.createElement("div");p.className="modal-overlay";const g=e===UO.INPUT?`\n        <div class="modal-input-container">\n          <input \n            type="text" \n            class="modal-input" \n            placeholder="${o||""}"\n            value="${r}"\n            maxlength="100"\n          >\n          <div class="modal-error"></div>\n        </div>\n        `:"",f=s?`\n      <div class="modal-message">\n        ${s}\n      </div>\n      `:"";if(e===UO.TOAST)return p.classList.add("toast"),p.innerHTML=`\n        <div class="modal-toast">\n          ${WO[i]||""}\n          <div class="modal-title">${n}</div>\n        </div>\n      `,t.appendChild(p),new Promise((t=>{const e=p.querySelector(".modal-toast");setTimeout((()=>{e.classList.add("fade-out"),p.remove(),t(null)}),c)}));p.innerHTML=`\n  <div class="modal">\n    ${e===UO.CONFIRM?d?`<button type="button" class="close-btn">${DO.close}</button>`:WO[i]||"":""}\n    <div class="modal-title">${n}</div>\n    ${f}\n    ${g}\n    <div class="modal-actions">\n      <button class="modal-btn cancel">${l}</button>\n      <button class="modal-btn confirm ${i}">${a}</button>\n    </div>\n  </div>\n`,t.appendChild(p);const m=p.querySelector(".modal-input"),v=p.querySelector(".modal-error"),y=p.querySelector(".confirm"),x=p.querySelector(".cancel"),w=p.querySelector(".close-btn");return m&&(m.selectionStart=m.value.length,m.focus()),new Promise((i=>{const n=()=>{if(e===UO.INPUT){const t=m.value.trim();if(h){const e=h(t);if(e)return void o(e)}i(t)}else i(!0);s()},s=()=>{p.classList.add("fade-out"),setTimeout((()=>{p.remove(),t.style.position=u}),200)},o=t=>{v.textContent=t,v.style.opacity="1",v.style.height="auto",m.classList.add("error"),m.classList.add("shake"),setTimeout((()=>m.classList.remove("shake")),500)};null==y||y.addEventListener("click",n),null==x||x.addEventListener("click",(()=>{i(!1),s()})),null==w||w.addEventListener("click",(()=>{i(null),s()})),m&&(m.addEventListener("input",(t=>{let e=t.target.value;e=e.replace(/[\x00-\x1F\x7F]/g,""),e.startsWith(" ")&&(e=e.trimStart()),t.target.value=e,v&&(v.style.opacity="0",v.style.height="0px",null==m||m.classList.remove("error")),y.classList.toggle("disabled",!e.trim())})),m.addEventListener("keyup",(t=>{"Enter"===t.key?n():"Escape"===t.key&&(i(!1),s())})),y.classList.toggle("disabled",!m.value.trim())),p.addEventListener("click",(t=>{t.target===p&&(i(null),s())})),document.addEventListener("keyup",(function t(e){"Escape"===e.key&&(document.removeEventListener("keyup",t),i(!1),s())}))}))}const zO="\n.modal-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  animation: fadeIn 0.2s ease-out;\n}\n\n.modal-overlay.toast {\n  background-color: transparent;\n  pointer-events: none;\n}\n\n.modal-toast {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: 1rem;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  gap: 0.5rem;\n  width: 80px;\n  height: 80px;\n  z-index: 1001;\n  opacity: 1;\n  animation: toastIn 0.2s ease-out;\n}\n\n.modal-toast.fade-out {\n  animation: toastOut 0.2s ease-out forwards;\n}\n\n\n.modal-toast .modal-icon {\n  width: 24px;\n  height: 24px;\n}\n\n.modal-overlay:not(.toast) {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  animation: fadeIn 0.2s ease-out;\n}\n\n.modal-overlay.fade-out {\n  animation: fadeOut 0.2s ease-out;\n}\n\n.modal {\n  background-color: white;\n  padding: 1rem;\n  border-radius: 8px;\n  width: 90%;\n  max-width: 320px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.5rem;\n  position: relative;\n}\n\n.modal-icon {\n  width: 48px;\n  height: 48px;\n  margin: 0 auto;\n}\n\n.modal-icon.warning {\n  color: #f59e0b;\n}\n\n.modal-icon.error {\n  stroke: #ef4444;\n}\n\n.modal-title {\n  font-size: 16px;\n  font-family: Verdana;\n  text-align: center;\n  padding-bottom: 1rem;\n}\n\n.modal-toast .modal-title {\n  color: white;\n  padding-bottom: 0;\n  text-align: center;\n}\n\n.modal .close-btn {\n  position: absolute;\n  right: 1rem;\n  top: 1rem;\n  border: none;\n  padding: 0;\n  margin: 0;\n  background-color: transparent;\n  cursor: pointer;\n}\n\n.modal .close-btn svg {\n  color: #858585;\n}\n\n.modal-message {\n  font-size: 14px;\n  font-family: Verdana;\n  color: #666;\n  text-align: center;\n}\n\n.modal-input-container {\n  display: flex;\n  flex-direction: column;\n}\n\n.modal-input {\n  padding: 8px 12px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  font-size: 16px;\n  font-family: Verdana;\n  transition: border-color 0.2s;\n}\n\n.modal-input.error {\n  border-color: #ef4444;\n}\n\n.modal-input.shake {\n  animation: shake 0.5s;\n}\n\n.modal-error {\n  color: #ef4444;\n  font-size: 12px;\n  min-height: 0;\n  opacity: 0;\n  transition: opacity 0.2s, height 0.2s;\n}\n\n.modal-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-top: 8px;\n}\n\n.modal-btn {\n  padding: 8px 16px;\n  border: none;\n  border-radius: 4px;\n  font-family: Verdana;\n  font-size: 14px;\n  cursor: pointer;\n  transition: opacity 0.2s;\n}\n\n.modal-btn:hover {\n  opacity: 0.9;\n}\n\n.modal-btn.cancel {\n  background-color: #f5f5f5;\n  color: #333;\n}\n\n.modal-btn.confirm {\n background-color: #fe8e14;\n  color: white;\n}\n\n.modal-btn.confirm.warning {\n  background-color: #FE8E14;\n}\n\n.modal-btn.confirm.error {\n  background-color: #ef4444;\n}\n\n.modal-btn.confirm.info {\n  background-color: #FE8E14;\n}\n\n.modal-btn.confirm.disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes fadeOut {\n  from { opacity: 1; }\n  to { opacity: 0; }\n}\n\n@keyframes toastIn {\n  0% { \n    opacity: 0;\n    transform: translate(-50%, calc(-50% + 20px));\n  }\n  100% { \n    opacity: 1;\n    transform: translate(-50%, -50%);\n  }\n}\n\n@keyframes toastOut {\n  0% { \n    opacity: 1;\n    transform: translate(-50%, -50%);\n  }\n  100% { \n    opacity: 0;\n    transform: translate(-50%, calc(-50% - 20px));\n  }\n}\n\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }\n  20%, 40%, 60%, 80% { transform: translateX(2px); }\n}\n";class GO{constructor(t){this.config=t,this.MWCViewElements={headerContainer:null,contentContainer:null,emptyContentContainer:null,toolbarContainer:null,selectedToolbarContainer:null},this.isSelectionMode=!1}initialize(){if(!this.config.container)throw new Error("Create a container element");this.createMWCView()}createMWCView(){this.config.container.textContent="",LO("mwc-views-style",YO),this.createHeader(),this.createContent(),this.createEmptyContent(),this.createToolbars()}createHeader(t=!0){t&&(this.MWCViewElements.headerContainer=document.createElement("div"),this.MWCViewElements.headerContainer.className="mwc-view-header",this.config.container.appendChild(this.MWCViewElements.headerContainer))}createContent(){this.MWCViewElements.contentContainer=document.createElement("div"),this.MWCViewElements.contentContainer.className="mwc-view-content",this.config.container.appendChild(this.MWCViewElements.contentContainer)}createEmptyContent(){this.MWCViewElements.emptyContentContainer=document.createElement("div"),this.MWCViewElements.emptyContentContainer.className="mwc-view-content-empty",this.config.container.appendChild(this.MWCViewElements.emptyContentContainer)}async setEmptyContent(t){const e=this.MWCViewElements.emptyContentContainer;e.textContent="";try{if("object"==typeof t&&"templatePath"in t){const i=await fetch(t.templatePath);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const n=await i.text();e.innerHTML=n;const s=e.querySelector("template");s&&(e.innerHTML=s.innerHTML),e.style.display="flex",e.style.height="100%",e.style.alignItems="center",e.style.justifyContent="center"}else if(t instanceof HTMLTemplateElement){const i=document.importNode(t.content,!0);e.appendChild(i)}else if(t instanceof HTMLElement)e.appendChild(t);else if("string"==typeof t)if(t.trim().startsWith("<template")){const i=document.createElement("template");i.innerHTML=t;const n=document.importNode(i.content,!0);e.appendChild(n)}else e.innerHTML=t}catch(t){console.error("Error setting empty content:",t),e.innerHTML="<div>No content available</div>"}}createToolbars(){this.MWCViewElements.toolbarContainer=document.createElement("div"),this.MWCViewElements.toolbarContainer.className="mwc-view-controls-container",this.config.container.appendChild(this.MWCViewElements.toolbarContainer),this.MWCViewElements.selectedToolbarContainer=document.createElement("div"),this.MWCViewElements.selectedToolbarContainer.className="mwc-view-controls-container",this.MWCViewElements.selectedToolbarContainer.style.display="none",this.config.container.appendChild(this.MWCViewElements.selectedToolbarContainer)}createToolbarButton(t){const e=document.createElement("div");if(e.className=`mwc-view-controls-btn ${(null==t?void 0:t.className)||""}`,!t)return e.classList.add("disabled"),e.innerHTML="<div></div>",e;const i=document.createElement("div");if(i.className="icon",(n=t.icon).trim().startsWith("<svg")&&n.trim().endsWith("</svg>"))i.innerHTML=t.icon;else{const e=document.createElement("img");e.src=t.icon,e.alt=t.label,e.width=24,e.height=24,i.appendChild(e)}var n;const s=document.createElement("div");return s.className="label",s.textContent=t.label,!0===t.isDisabled&&e.classList.add("disabled"),!0===t.isHidden&&e.classList.add("hide"),e.appendChild(i),e.appendChild(s),t.onClick&&e.addEventListener("click",t.onClick),e}setVisible(t,e){this.config.container.style.display=t?"flex":"none"}showContent(t){this.MWCViewElements.contentContainer.style.display=t?"flex":"none",this.MWCViewElements.emptyContentContainer.style.display=t?"none":"flex"}toggleSelectionMode(t){this.isSelectionMode=t,this.updateToolbarState()}updateToolbarState(){this.MWCViewElements.toolbarContainer.style.display=this.isSelectionMode?"none":"flex",this.MWCViewElements.selectedToolbarContainer.style.display=this.isSelectionMode?"flex":"none"}}const YO="\n  .mwc-view-container {\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: white;\n    font-family: Verdana;\n    color: black;\n  }\n\n  .mwc-view-container .mwc-view-header {\n    display: flex;\n    font-family: Verdana;\n    height: 3rem;\n    font-size: 24px;\n    align-items: center;\n    justify-content: center;\n    background-color: #F5F5F5;\n    flex: 0 1 3rem;\n    padding: 0.5rem;\n    user-select: none;\n        color: black;\n  }\n\n  .mwc-view-container .mwc-view-header .mwc-view-header-title {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 100%;\n        color: black;\n  }\n\n  .mwc-library-header-btn:hover {\n    text-decoration: underline;\n  }\n\n  .mwc-view-container .mwc-view-content {\n    flex: 1 1 auto;\n    overflow-y: auto;\n    display: none;\n    flex-direction: column;\n    justify-content: start;\n    padding: 1rem;\n    gap: 1rem;\n    padding-bottom: 2rem;\n  }\n\n  .mwc-view-container .mwc-view-content-empty {\n    flex: 1 1 auto;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 1rem;\n    user-select: none;\n    font-family: Verdana;\n  }\n\n  .mwc-view-container .mwc-view-content-empty {\n    flex: 1 1 auto;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 1rem;\n    user-select: none;\n    font-family: Verdana;\n  }\n\n  .mwc-view-container .mwc-view-controls-container {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n    flex: 0 1 65px;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn {\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn >div:first-child {\n    padding-top: 1rem;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn >div:last-child {\n    padding-bottom: 1rem;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn.selected{\n    background-color: #E36605;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn.disabled {\n    pointer-events: none;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn.disabled >div {\n    opacity: 0.4;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn.hide {\n    display: none;\n  }\n\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn .icon img,\n  .mwc-view-container .mwc-view-controls-container .mwc-view-controls-btn .icon svg {\n    width: 24px;\n    height: 24px;\n  }\n";class $O{constructor(t){this.config=t,this.checked=!1,this.createUI(),this.bindEvents(),this.toggleCheck(!1)}createUI(){this.createStylesheet();const t=IO.documentManager.getDocument(this.config.docId),e=t.pages.length;this.dom=document.createElement("div"),this.dom.className="mwc-document-item",this.dom.innerHTML=`\n      <div class="mwc-transfer-info-container">\n        <div class="mwc-transfer-thumbnail">\n          ${DO.defaultDocument}\n        </div>\n        <div class="mwc-transfer-info">\n          <div class="mwc-transfer-name-container">\n            ${t.name}           \n          </div>\n          <div class="mwc-transfer-pages">${e} pages</div>\n        </div>\n      </div>\n      <div class="mwc-transfer-check-icon">\n        ${DO.selectedCircle}\n      </div>\n    `,this.selectedIcon=this.dom.querySelector(".mwc-transfer-check-icon"),this.updateThumbnail(t)}createStylesheet(){const t=document.createElement("style");t.textContent=XO,document.head.appendChild(t)}async updateThumbnail(t){const e=this.dom.querySelector(".mwc-transfer-thumbnail");if(e.textContent="",t.pages[0]){const i=await t.getPageData(t.pages[0]),n=URL.createObjectURL(i.display.data),s=document.createElement("img");s.className="mwc-image-thumbnail",s.alt="mwc-image-thumbnail",s.src=n,e.append(s)}else e.innerHTML=DO.defaultDocument}bindEvents(){this.dom.addEventListener("click",(t=>{this.toggleCheck()}))}toggleCheck(t){var e,i;this.checked=null!=t?t:!this.checked,this.selectedIcon.style.display=this.checked?"flex":"none",this.dom.style.border=this.checked?"2px solid #FE8E14":"2px solid transparent",null===(i=(e=this.config).onCheckedChange)||void 0===i||i.call(e,this.config.docId,this.checked)}getDom(){return this.dom}dispose(){this.dom.remove()}}const XO="\n.mwc-transfer-item {\n  display: grid;\n  grid-template-columns: 90% 10%;\n  background-color: #EFEFEF;\n  cursor: pointer;\n  font-family: Verdana;\n  padding: 15px;\n  align-items: center\n}\n\n.mwc-transfer-info-container {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.mwc-transfer-info {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding-right: 1rem;\n  overflow: hidden;\n}\n\n.mwc-transfer-info .mwc-transfer-name-container  {\n  font-size: 16px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n\n.mwc-transfer-info .mwc-transfer-pages {\n  color: #888888;\n}\n\n.mwc-transfer-thumbnail {\n  width: 70px;\n  height: 70px;\n  background-color: #DADCE0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.mwc-transfer-thumbnail svg {\n  width: 48px;\n  height: 48px;\n  padding: 1rem;\n}\n\n.mwc-image-thumbnail {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n";var qO;!function(t){t.Copy="copy",t.Move="move"}(qO||(qO={}));class ZO extends GO{constructor(t){super(t),this.config=t,this.transferMode=qO.Copy,this.checkedDocUids=[],this.docItems=[],this.toolbarBtn={action:null,cancel:null},this.headerTitle=null}initialize(){super.initialize(),LO("mwc-transfer-view-style",JO),this.updateEmptyContentHTML(),this.setVisible(!1)}createHeader(){super.createHeader(),this.MWCViewElements.headerContainer.innerHTML='\n      <div class="mwc-transfer-view-header-title">Transfer Page</div>\n    ',this.headerTitle=this.MWCViewElements.headerContainer.querySelector(".mwc-transfer-view-header-title")}createContent(){this.MWCViewElements.contentContainer=document.createElement("div"),this.MWCViewElements.contentContainer.className="mwc-view-content",this.config.container.appendChild(this.MWCViewElements.contentContainer)}updateEmptyContentHTML(){this.MWCViewElements.emptyContentContainer.innerHTML='\n      <div class="title">\n        No other documents to move the pages!\n      </div>\n      <div class="desc">\n        Please create another document!\n      </div>\n    '}createToolbars(){super.createToolbars();[{id:"mwc-transfer-cancel",icon:DO.back,label:"Cancel",onClick:()=>this.handleCancelButton()},{id:"mwc-transfer-action",icon:DO.done,label:"Action",className:"action-btn",onClick:()=>{}}].forEach((t=>{const e=this.createToolbarButton(t);"mwc-transfer-cancel"===t.id?this.toolbarBtn.cancel=e:"mwc-transfer-action"===t.id&&(this.toolbarBtn.action=e),this.MWCViewElements.toolbarContainer.appendChild(e)}))}updateHeaderAndAction(){switch(this.transferMode){case qO.Copy:this.headerTitle.textContent="Copy Selected Pages to",this.toolbarBtn.action.children[1].textContent="Paste";break;case qO.Move:this.headerTitle.textContent="Move Selected Pages to",this.toolbarBtn.action.children[1].textContent="Confirm"}}setVisible(t,e){if(super.setVisible(t),t&&e){this.MWCViewElements.contentContainer.textContent="",this.transferMode=e.mode,this.updateHeaderAndAction(),this.updateToolbarStyle(),this.toolbarBtn.action.onclick=()=>this.handleActionClick(e.docId,e.selectedIdx);const t=IO.documentManager.getAllDocuments().filter((t=>this.transferMode!==qO.Move||t.uid!==e.docId)),i=t.length>0;this.showContent(i),i&&this.loadDocuments(t)}}loadDocuments(t){t.forEach((t=>{const e=new $O({docId:t.uid,onCheckedChange:(t,e)=>this.handleDocumentChecked(t,e)});this.docItems.unshift(e),this.MWCViewElements.contentContainer.firstChild?this.MWCViewElements.contentContainer.insertBefore(e.getDom(),this.MWCViewElements.contentContainer.firstChild):this.MWCViewElements.contentContainer.appendChild(e.getDom())}))}handleDocumentChecked(t,e){var i;e?this.checkedDocUids.push(t):this.checkedDocUids=null===(i=this.checkedDocUids)||void 0===i?void 0:i.filter((e=>e!==t)),this.updateToolbarStyle()}updateToolbarStyle(){const t=this.transferMode===qO.Move?1!==this.checkedDocUids.length:this.checkedDocUids.length<1;this.toolbarBtn.action.classList.toggle("disabled",t)}handleCancelButton(){var t,e;this.checkedDocUids=[],this.docItems.forEach((t=>{t.toggleCheck(!1),t.dispose()})),this.docItems=[],null===(e=(t=this.config).onCancelTransfer)||void 0===e||e.call(t)}handleActionClick(t,e){var i,n;this.toolbarBtn.action.classList.contains("disabled")||(this.transferMode===qO.Copy?this.checkedDocUids.forEach((i=>{IO.documentManager.copyPagesToDocument(t,i,{sourceIndices:[...e]})})):this.transferMode===qO.Move&&IO.documentManager.movePagesToDocument(t,this.checkedDocUids[0],{sourceIndices:[...e]}),null===(n=(i=this.config).onConfirmTransfer)||void 0===n||n.call(i,this.transferMode),this.handleCancelButton())}dispose(){this.docItems.forEach((t=>t.dispose())),this.docItems=[],this.checkedDocUids=[],this.config.container&&(this.config.container.style.display="none")}}const JO="\n  .mwc-view-controls-btn.action-btn .label {\n    color: #fe8e14;\n  }\n";class KO extends GO{constructor(t){super(t),this.config=t,this.documentTitle=null,this.headerRenameTitleBtn=null,this.toolbarBtn={backToLibrary:null,capture:null,import:null,shareDocument:null,uploadDocument:null,manage:null,copyTo:null,moveTo:null,selectAll:null,deleteImage:null,shareImage:null,uploadImage:null,back:null},this.headerActionBtn={close:null},this.browseViewer=null,this.isDragged=!1}bindBrowseViewerEvents(){this.browseViewer.on("selectedPagesChanged",(t=>{var e;if(!this.isSelectionMode)return;(null===(e=this.browseViewer)||void 0===e?void 0:e.currentDocument)&&this.handlePageChecked()})),this.browseViewer.on("click",(t=>{if(!this.isSelectionMode){if(!kO()&&this.isDragged)return void(this.isDragged=!1);if(t.index>-1){const e=this.browseViewer.currentDocument;this.config.onPageClick&&this.config.onPageClick(e.uid,t.index)}}})),this.browseViewer.on("pagesDragged",(()=>{this.isDragged=!0}))}initialize(){LO("mwc-document-view-style",QO),super.initialize(),this.createBrowseViewer(),this.bindBrowseViewerEvents(),this.updateEmptyContentHTML(),this.setVisible(!1)}setVisible(t){super.setVisible(t);const e=this.browseViewer.currentDocument;if(t){const t=e&&e.pages.length>0;this.updateHeaderTitle(),this.showContent(t),this.updateToolbarBtnStates()}}createBrowseViewer(){var t;this.browseViewer=new IO.BrowseViewer({container:this.MWCViewElements.contentContainer,uiConfig:{type:IO.Elements.Layout,style:{border:"none"},children:[IO.Elements.MainView]},groupUid:null===(t=this.config)||void 0===t?void 0:t.groupUid,viewerConfig:{canvasStyle:{background:"white"},checkboxStyle:{borderRadius:"1px",left:"6px",top:"6px",width:"24px",height:"24px",visibility:"hidden"},currentPageStyle:{border:"2px solid #FE8E14"},pageStyle:{background:"#F5F5F5"}}}),this.browseViewer.setRowAndColumn(2,2)}createHeader(){var t;super.createHeader(),this.MWCViewElements.headerContainer.innerHTML=`\n    <div class="mwc-document-view-header">\n      <div class="mwc-document-view-header-container">\n        <div class="mwc-document-view-header-doc-name">Document Name</div>\n        <button type="button" class="mwc-document-view-header-btn rename">\n          ${DO.edit}\n        </button>\n      </div>\n      <button type="button" class="mwc-document-view-header-btn close">\n        ${DO.close}\n      </button>\n    </div>\n    `,this.documentTitle=this.MWCViewElements.headerContainer.querySelector(".mwc-document-view-header-doc-name"),this.headerRenameTitleBtn=this.MWCViewElements.headerContainer.querySelector(".mwc-document-view-header-btn.rename"),null===(t=this.headerRenameTitleBtn)||void 0===t||t.addEventListener("click",(()=>this.handleRename())),this.headerActionBtn.close=this.MWCViewElements.headerContainer.querySelector(".close"),this.headerActionBtn.close.addEventListener("click",(()=>this.handleClose()))}updateHeaderTitle(){var t;const e=null===(t=this.browseViewer)||void 0===t?void 0:t.currentDocument;this.documentTitle.textContent=(null==e?void 0:e.name)||"Document Name"}async handleRename(){const t=this.browseViewer.currentDocument;if(!t)return;const e=await jO({container:this.config.container,type:UO.INPUT,title:"Rename Document",placeholder:"Enter document name",initialValue:t.name,confirmText:"Rename",validation:t=>t.length<1?"Name can't be empty":null});e&&(t.rename(e),this.updateHeaderTitle(),await HO(this.config.container,"Renamed"))}dispose(){var t;null===(t=this.browseViewer)||void 0===t||t.destroy(),this.browseViewer=null,IO.documentManager.deleteAllDocuments(),this.config.container&&(this.config.container.style.display="none")}handleClose(){var t;try{null===(t=this.config)||void 0===t||t.onClose()}catch(t){console.error("Failed to close library view:",t)}}updateEmptyContentHTML(){const t=`\n    <div class="mwc-default-empty-document">\n      ${DO.emptyLibrary}\n      <div class="title">Add your first page!</div>\n      <div class="desc">\n        <div>Option 1: Click "<b>Capture</b>" for live images</div>\n        <div>Option 2: Click "<b>Import</b>" for existing images</div>\n      </div>\n    </div>`;super.setEmptyContent(this.config.emptyContentConfig||t)}createToolbars(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w,b,C,S,_,T,E,P,A,I,D,k,R,M,L,O,B,F,N,U,V,W,H,j,z,G,Y,$,X,q,Z,J,K;super.createToolbars();const{toolbarButtonsConfig:Q,exportConfig:tt,showLibraryView:et}=this.config,it=!!(null==tt?void 0:tt.uploadToServer),nt=new File([""],"test.pdf",{type:"application/pdf"}),st="share"in navigator&&navigator.canShare({files:[nt]}),ot=()=>{st?this.handleShareDoc():KO.handleDownloadDoc(this.browseViewer.currentDocument,this.config.container)},rt=()=>{st?this.handleShareImage():this.handleDownloadImage()};[{id:"mwc-document-backToLibrary",icon:null!==(e=null===(t=null==Q?void 0:Q.backToLibrary)||void 0===t?void 0:t.icon)&&void 0!==e?e:DO.back,label:(null===(i=null==Q?void 0:Q.backToLibrary)||void 0===i?void 0:i.label)||"Back",isHidden:(null===(n=null==Q?void 0:Q.backToLibrary)||void 0===n?void 0:n.isHidden)||!this.config.showLibraryView||!1,className:`${(null===(s=null==Q?void 0:Q.backToLibrary)||void 0===s?void 0:s.className)||""}`,onClick:()=>{var t,e;return null===(e=(t=this.config).onBackToLibrary)||void 0===e?void 0:e.call(t)}},{id:"mwc-document-capture",icon:(null===(o=null==Q?void 0:Q.capture)||void 0===o?void 0:o.icon)||DO.cameraCapture,label:(null===(r=null==Q?void 0:Q.capture)||void 0===r?void 0:r.label)||"Capture",isHidden:(null===(a=null==Q?void 0:Q.capture)||void 0===a?void 0:a.isHidden)||!1,className:`${(null===(l=null==Q?void 0:Q.capture)||void 0===l?void 0:l.className)||""}`,onClick:()=>{var t,e;return null===(e=(t=this.config).onCameraCapture)||void 0===e?void 0:e.call(t)}},{id:"mwc-document-import",icon:(null===(h=null==Q?void 0:Q.import)||void 0===h?void 0:h.icon)||DO.galleryImport,label:(null===(c=null==Q?void 0:Q.import)||void 0===c?void 0:c.label)||"Import",isHidden:(null===(d=null==Q?void 0:Q.import)||void 0===d?void 0:d.isHidden)||!1,className:`${(null===(u=null==Q?void 0:Q.import)||void 0===u?void 0:u.className)||""}`,onClick:()=>{var t,e;return null===(e=(t=this.config).onGalleryImport)||void 0===e?void 0:e.call(t)}},{id:"mwc-document-shareDocument",icon:(null===(p=null==Q?void 0:Q.shareDocument)||void 0===p?void 0:p.icon)||(st?DO.sharePDF:DO.downloadPDF),label:(null===(g=null==Q?void 0:Q.shareDocument)||void 0===g?void 0:g.label)||(st?"Share":"Download"),className:`${(null===(f=null==Q?void 0:Q.shareDocument)||void 0===f?void 0:f.className)||""}`,isHidden:(null===(m=null==Q?void 0:Q.shareDocument)||void 0===m?void 0:m.isHidden)||!1,onClick:()=>ot()},{id:"mwc-document-uploadDocument",icon:(null===(v=null==Q?void 0:Q.uploadDocument)||void 0===v?void 0:v.icon)||DO.uploadPDF,label:(null===(y=null==Q?void 0:Q.uploadDocument)||void 0===y?void 0:y.label)||"Upload",className:`${(null===(x=null==Q?void 0:Q.uploadDocument)||void 0===x?void 0:x.className)||""}`,isHidden:(null===(w=null==Q?void 0:Q.uploadDocument)||void 0===w?void 0:w.isHidden)||!it,onClick:()=>this.handleUploadDocument()},{id:"mwc-document-manage",icon:(null===(b=null==Q?void 0:Q.manage)||void 0===b?void 0:b.icon)||DO.fileOperations,label:(null===(C=null==Q?void 0:Q.manage)||void 0===C?void 0:C.label)||"Manage",isHidden:(null===(S=null==Q?void 0:Q.manage)||void 0===S?void 0:S.isHidden)||!1,className:`${(null===(_=null==Q?void 0:Q.manage)||void 0===_?void 0:_.className)||""}`,onClick:()=>this.handleManagePages()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[`${t.id.split("-").pop()}`]=e,this.MWCViewElements.toolbarContainer.appendChild(e)}));[{id:"mwc-document-select-copyTo",icon:(null===(T=null==Q?void 0:Q.copyTo)||void 0===T?void 0:T.icon)||DO.copyTo,label:(null===(E=null==Q?void 0:Q.copyTo)||void 0===E?void 0:E.label)||"Copy To",className:`selected ${(null===(P=null==Q?void 0:Q.copyTo)||void 0===P?void 0:P.className)||""}`,isHidden:(null===(A=null==Q?void 0:Q.copyTo)||void 0===A?void 0:A.isHidden)||!et,onClick:()=>this.handleTransferPage(qO.Copy)},{id:"mwc-document-select-moveTo",icon:(null===(I=null==Q?void 0:Q.moveTo)||void 0===I?void 0:I.icon)||DO.moveTo,label:(null===(D=null==Q?void 0:Q.moveTo)||void 0===D?void 0:D.label)||"Move To",className:`selected ${(null===(k=null==Q?void 0:Q.moveTo)||void 0===k?void 0:k.className)||""}`,isHidden:(null===(R=null==Q?void 0:Q.moveTo)||void 0===R?void 0:R.isHidden)||!et,onClick:()=>this.handleTransferPage(qO.Move)},{id:"mwc-document-select-selectAll",icon:(null===(M=null==Q?void 0:Q.selectAll)||void 0===M?void 0:M.icon)||DO.selectAll,label:(null===(L=null==Q?void 0:Q.selectAll)||void 0===L?void 0:L.label)||"Select All",isHidden:null===(O=null==Q?void 0:Q.selectAll)||void 0===O?void 0:O.isHidden,className:`selected ${(null===(B=null==Q?void 0:Q.selectAll)||void 0===B?void 0:B.className)||""}`,onClick:()=>this.handleSelectAll()},{id:"mwc-library-select-deleteImage",icon:(null===(F=null==Q?void 0:Q.deleteImage)||void 0===F?void 0:F.icon)||DO.delete,label:(null===(N=null==Q?void 0:Q.deleteImage)||void 0===N?void 0:N.label)||"Delete",className:`selected ${(null===(U=null==Q?void 0:Q.deleteImage)||void 0===U?void 0:U.className)||""}`,isHidden:null===(V=null==Q?void 0:Q.deleteImage)||void 0===V?void 0:V.isHidden,onClick:()=>this.handleDeleteImage()},{id:"mwc-document-select-shareImage",icon:(null===(W=null==Q?void 0:Q.shareImage)||void 0===W?void 0:W.icon)||(st?DO.sharePNG:DO.downloadPNG),label:(null===(H=null==Q?void 0:Q.shareImage)||void 0===H?void 0:H.label)||(st?"Share":"Download"),isHidden:null===(j=null==Q?void 0:Q.shareImage)||void 0===j?void 0:j.isHidden,className:`selected ${(null===(z=null==Q?void 0:Q.shareImage)||void 0===z?void 0:z.className)||""}`,onClick:()=>rt()},{id:"mwc-document-uploadImage",icon:(null===(G=null==Q?void 0:Q.uploadImage)||void 0===G?void 0:G.icon)||DO.uploadPNG,label:(null===(Y=null==Q?void 0:Q.uploadImage)||void 0===Y?void 0:Y.label)||"Upload",className:`selected ${(null===($=null==Q?void 0:Q.uploadImage)||void 0===$?void 0:$.className)||""}`,isHidden:(null===(X=null==Q?void 0:Q.uploadImage)||void 0===X?void 0:X.isHidden)||!it,onClick:()=>this.handleUploadImage()},{id:"mwc-library-select-back",icon:(null===(q=null==Q?void 0:Q.back)||void 0===q?void 0:q.icon)||DO.back,label:(null===(Z=null==Q?void 0:Q.back)||void 0===Z?void 0:Z.label)||"Back",className:`selected ${(null===(J=null==Q?void 0:Q.back)||void 0===J?void 0:J.className)||""}`,isHidden:null===(K=null==Q?void 0:Q.back)||void 0===K?void 0:K.isHidden,onClick:()=>this.handleSelectedBack()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[`${t.id.split("-").pop()}`]=e,this.MWCViewElements.selectedToolbarContainer.appendChild(e)}))}async handleShareDoc(){const t=[],e=this.browseViewer.currentDocument;if(e.pages.length){const i=await e.saveToPdf({mimeType:"application/octet-stream",saveAnnotation:"annotation"});t.push(new File([i],`${e.name}.pdf`,{type:"application/pdf"}))}if(navigator.canShare&&navigator.canShare({files:t}))try{await navigator.share({files:t,title:"PDF Files"})}catch(t){"AbortError"!==t.name&&await HO(this.config.container,"Failed to share files",VO.ERROR)}else await HO(this.config.container,"Your system doesn't support sharing PDF files",VO.WARNING)}static async handleDownloadDoc(t,e){var i;(null===(i=null==t?void 0:t.pages)||void 0===i?void 0:i.length)?t.saveToPdf({mimeType:"application/octet-stream",saveAnnotation:"annotation"}).then((e=>{const i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=`${t.name}.pdf`,n.click(),n.remove()})):(console.warn("Failed to download. Document contains no pages"),await HO(e,"Document contains no pages!",VO.WARNING))}async handleUploadDocument(){var t,e,i,n,s,o,r,a,l,h;if(null===(e=null===(t=this.config)||void 0===t?void 0:t.exportConfig)||void 0===e?void 0:e.uploadToServer)try{const t=this.browseViewer.currentDocument;if(null===(i=null==t?void 0:t.pages)||void 0===i?void 0:i.length){const e=await t.saveToPdf({mimeType:"application/pdf",saveAnnotation:"annotation"}),i=`${t.name}.pdf`,c=await(null===(s=null===(n=this.config)||void 0===n?void 0:n.exportConfig)||void 0===s?void 0:s.uploadToServer(i,e));if("success"===(null==c?void 0:c.status)){const t=this.config.getUploadedDocuments();t.push(c),this.config.updateUploadedDocuments(t);if(await(null===(r=null===(o=this.config.exportConfig)||void 0===o?void 0:o.onUploadSuccess)||void 0===r?void 0:r.call(o,i,"pdf",FO.Page,e)))return void(null===(a=this.config)||void 0===a||a.onClose());await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.SUCCESS,title:"Upload Successful",confirmText:"View in Uploads",cancelText:"Continue"})&&(null===(h=(l=this.config).onViewUploadsHistory)||void 0===h||h.call(l))}}else console.warn(`Upload failed: ${t.name} contains no pages`),await HO(this.config.container,"Document contains no pages!",VO.WARNING)}catch(t){let e=(null==t?void 0:t.message)||t;console.error("Upload failed:",e),await HO(this.config.container,"Upload Failed!",VO.ERROR)}else console.warn("No upload function configured")}handleManagePages(){this.toggleSelectionMode(!0)}handleSelectAll(){this.browseViewer.getSelectedPageIndices().length===this.browseViewer.currentDocument.pages.length?this.browseViewer.selectPages([]):this.browseViewer.selectAllPages(),this.updateToolbarBtnStates()}toggleSelectionMode(t){if(this.isSelectionMode!==t){if(super.toggleSelectionMode(t),this.browseViewer.multiselectMode=t,t){const t=this.browseViewer.getCurrentPageIndex();t>=0&&this.browseViewer.selectPages([t])}else this.browseViewer.selectPages([]);this.browseViewer.updateStyle("checkboxStyle",{visibility:t?"visible":"hidden",border:"1px solid #707070"})}}handlePageChecked(){this.updateToolbarBtnStates()}updateToolbarBtnStates(){var t;const e=this.browseViewer.currentDocument,i=!(null===(t=null==e?void 0:e.pages)||void 0===t?void 0:t.length),n=this.browseViewer.getSelectedPageIndices().length>0,s=this.browseViewer.getSelectedPageIndices().length===this.browseViewer.currentDocument.pages.length;this.toolbarBtn.selectAll.querySelector(".label").textContent=s?"Cancel":"Select All",this.toolbarBtn.manage.classList.toggle("disabled",i),this.toolbarBtn.shareDocument.classList.toggle("disabled",i),this.toolbarBtn.uploadDocument.classList.toggle("disabled",i),this.toolbarBtn.copyTo.classList.toggle("disabled",!n),this.toolbarBtn.moveTo.classList.toggle("disabled",!n),this.toolbarBtn.shareImage.classList.toggle("disabled",!n),this.toolbarBtn.deleteImage.classList.toggle("disabled",!n),this.toolbarBtn.uploadImage.classList.toggle("disabled",!n)}handleTransferPage(t){if(t===qO.Copy&&this.toolbarBtn.copyTo.classList.contains("disabled"))return;if(t===qO.Move&&this.toolbarBtn.moveTo.classList.contains("disabled"))return;const e=this.browseViewer.currentDocument,i=this.browseViewer.getSelectedPageIndices();this.config.onTransferPages(t,e.uid,i)}async handleDeleteImage(){if(this.toolbarBtn.deleteImage.classList.contains("disabled"))return;const t=this.browseViewer.getSelectedPageIndices();if(t.length>0){await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.WARNING,title:"Delete Pages",message:`Are you sure you want to delete ${t.length} ${t.length<=1?"page":"pages"}?`,confirmText:"Delete",cancelText:"Cancel",showCloseBtn:!0})&&(this.browseViewer.currentDocument.deletePages(t),this.showContent(0!==this.browseViewer.currentDocument.pages.length),this.updateToolbarBtnStates(),await HO(this.config.container,"Deleted",VO.SUCCESS))}}async handleShareImage(){try{const t=this.browseViewer.currentDocument,e=this.browseViewer.getSelectedPageIndices(),i=(await Promise.all(e.map((e=>t.saveToPng(e,{saveAnnotation:!0}))))).map(((i,n)=>new File([i],`${t.name}-${e[n]}-${Date.now()}.png`,{type:i.type})));if(navigator.canShare&&navigator.canShare({files:i}))try{await navigator.share({files:i,title:"Image Files"})}catch(t){"AbortError"!==t.name&&await HO(this.config.container,"Failed to share files",VO.ERROR)}else await HO(this.config.container,"Failed to share",VO.WARNING)}catch(t){await HO(this.config.container,"Error processing files",VO.ERROR)}}async handleDownloadImage(){const t=this.browseViewer.currentDocument,e=this.browseViewer.getSelectedPageIndices();try{e.forEach((async(i,n)=>{const s=await t.saveToPng(i,{saveAnnotation:!0}),o=URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`${t.name}-${e[n]}-${Date.now()}.png`,r.click(),r.remove(),URL.revokeObjectURL(o)})),await HO(this.config.container,"Downloaded",VO.SUCCESS)}catch(t){const e=(null==t?void 0:t.message)||t;console.warn("Download failed:",e),await HO(this.config.container,"Failed to download page",VO.ERROR)}}async handleUploadImage(){var t,e,i,n;if(null===(e=null===(t=this.config)||void 0===t?void 0:t.exportConfig)||void 0===e?void 0:e.uploadToServer)try{const t=this.browseViewer.currentDocument,e=this.browseViewer.getSelectedPageIndices(),s=e.map((async(i,n)=>{var s,o,r,a,l;const h=await t.saveToPng(i,{saveAnnotation:!0}),c=`${t.name}-${e[n]}-${Date.now()}.png`,d=new Blob([h],{type:"image/png"}),u=await(null===(o=null===(s=this.config)||void 0===s?void 0:s.exportConfig)||void 0===o?void 0:o.uploadToServer(c,d));if("success"===(null==u?void 0:u.status)){const t=this.config.getUploadedDocuments();t.push(u),this.config.updateUploadedDocuments(t);if(await(null===(a=null===(r=this.config.exportConfig)||void 0===r?void 0:r.onUploadSuccess)||void 0===a?void 0:a.call(r,c,"png",FO.Document,d)))return void(null===(l=this.config)||void 0===l||l.onClose())}return u})),o=await Promise.all(s),r=null==o?void 0:o.filter((t=>"success"===(null==t?void 0:t.status)));if(r.length){await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.SUCCESS,title:"Upload Successful",confirmText:"View in Uploads",cancelText:"Continue"})&&(null===(n=(i=this.config).onViewUploadsHistory)||void 0===n||n.call(i))}}catch(t){let e=(null==t?void 0:t.message)||t;console.error("Upload failed:",e),await HO(this.config.container,"Upload Failed!",VO.ERROR)}else console.warn("No upload function configured")}handleSelectedBack(){this.toggleSelectionMode(!1)}}const QO="\n  .mwc-document-view-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 1rem;\n    width: 100%;\n        color: black;\n  }\n\n  .mwc-document-view-header-btn {\n    border: none;\n    background: transparent;\n    display: flex;\n    align-content: center;\n    cursor: pointer;\n  }\n\n  .mwc-document-view-header-btn.rename{\n    width: 30px;\n    height: 30px;\n  }\n\n  .mwc-document-view-header-container {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex: 1;\n    max-width: calc(100% - 4rem);\n  }\n\n  .mwc-document-view-header-container .mwc-document-view-header-doc-name {\n    font-family: Verdana;\n    font-size: 18px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    user-select: none;\n  }\n\n  .mwc-default-empty-document {\n    display: flex;\n    flex-direction: column;\n    justify-content:center;\n    align-items: center;\n    gap: 1rem;\n  }\n\n  .mwc-default-empty-document svg {\n    width: 200px;\n    height: auto;\n  }\n\n  .mwc-default-empty-document .title {\n    margin-top: 2rem;\n    font-size: 24px;\n        color: black;\n  }\n\n  .mwc-default-empty-document .desc {\n    font-size: 16px;\n    color: black;\n  }\n";class tB extends GO{constructor(t){super(t),this.config=t,this.headerTitle=null,this.headerActionBtn={close:null,cancel:null,selectAll:null},this.toolbarBtn={newDoc:null,capture:null,import:null,uploads:null,delete:null,print:null,share:null,upload:null,back:null},this.checkedDocUids=[],this.docItems=[]}bindDocumentManagerEvents(){IO.documentManager.on("documentCreated",(t=>{const e=new OO({docId:t.docUid,onCheckedChange:()=>this.handleDocumentChecked(),onDocumentClick:t=>{this.isSelectionMode||this.handleDocumentClick(t)},onRename:t=>this.handleRename(t)});this.docItems.unshift(e),this.MWCViewElements.contentContainer.firstChild?this.MWCViewElements.contentContainer.insertBefore(e.getDom(),this.MWCViewElements.contentContainer.firstChild):this.MWCViewElements.contentContainer.appendChild(e.getDom())})),IO.documentManager.on("documentDeleted",(t=>{this.docItems.forEach(((e,i)=>{e.getUid()===t.docUid&&(e.dispose(),this.docItems.splice(i,1))}))}))}initialize(){LO("mwc-library-view-style",eB),super.initialize(),this.bindDocumentManagerEvents(),this.updateEmptyContentHTML(),this.setVisible(!1)}setVisible(t){if(super.setVisible(t),this.updateToolbarState(),t&&t){const t=IO.documentManager.getAllDocuments().length;this.showContent(!!t),t&&this.docItems.forEach((t=>{t.update()}))}}createHeader(){super.createHeader(),this.MWCViewElements.headerContainer.innerHTML=`\n      <div class="mwc-view-header-title">Library</div>\n      <div class="mwc-view-header-actions">\n        <button type="button" class="mwc-library-header-btn selectAll">Select All</button>\n        <button type="button" class="mwc-library-header-btn cancel">Cancel</button>\n        <button type="button" class="mwc-library-header-btn close">\n          ${DO.close}\n        </button>\n      </div>\n    `,this.headerTitle=this.MWCViewElements.headerContainer.querySelector(".mwc-view-header-title"),this.headerActionBtn.close=this.MWCViewElements.headerContainer.querySelector(".close"),this.headerActionBtn.close.addEventListener("click",(()=>this.handleClose())),this.headerActionBtn.cancel=this.MWCViewElements.headerContainer.querySelector(".cancel"),this.headerActionBtn.cancel.addEventListener("click",(()=>this.handleSelectAllOrCancel(!0))),this.headerActionBtn.selectAll=this.MWCViewElements.headerContainer.querySelector(".selectAll"),this.headerActionBtn.selectAll.addEventListener("click",(()=>this.handleSelectAllOrCancel(!1))),this.updateHeaderActionBtnStyle()}updateHeaderActionBtnStyle(){if(this.isSelectionMode){this.headerTitle.textContent="Select Items",this.headerActionBtn.close.style.display="none";const t=this.docItems.every((t=>t.checked));this.headerActionBtn.selectAll.style.display=t?"none":"flex",this.headerActionBtn.cancel.style.display=t?"flex":"none"}else this.headerTitle.textContent="Library",this.headerActionBtn.close.style.display="block",this.headerActionBtn.selectAll.style.display="none",this.headerActionBtn.cancel.style.display="none"}updateEmptyContentHTML(){const t=`\n    <div class="mwc-default-empty-library">\n      ${DO.emptyLibrary}\n      <div class="title">\n        Create your first document!\n      </div>\n      <div class="desc">\n        <div>\n          Option 1: Click "<b>New</b>" to create a blank document\n        </div>\n        <div>\n          Option 2: Click "<b>Capture</b>" or "<b>Import</b>" to use images\n        </div>\n      </div>\n    </div>\n    `;super.setEmptyContent(this.config.emptyContentConfig||t)}handleClose(){try{this.config.onClose()}catch(t){console.error("Failed to close library view:",t)}}dispose(){this.docItems.forEach((t=>t.dispose())),this.docItems=[],IO.documentManager.deleteAllDocuments()}toggleSelectionMode(t){this.isSelectionMode!==t&&(super.toggleSelectionMode(t),this.updateHeaderActionBtnStyle(),this.docItems.forEach((t=>t.setSelectMode(this.isSelectionMode))))}handleSelectAllOrCancel(t){if(t)return this.docItems.forEach((t=>t.toggleCheck(!1))),this.checkedDocUids=[],void this.toggleSelectionMode(!1);this.docItems.forEach((t=>{t.toggleCheck(!0)})),this.updateHeaderActionBtnStyle()}handleDocumentChecked(){var t,e,i;this.checkedDocUids=this.docItems.filter((t=>t.checked)).map((t=>t.getUid()));const n=this.checkedDocUids.length>0;this.toggleSelectionMode(n),this.updateHeaderActionBtnStyle();const s=this.checkedDocUids.some((t=>{var e;const i=IO.documentManager.getDocument(t);return!(null===(e=null==i?void 0:i.pages)||void 0===e?void 0:e.length)})),o=1===this.checkedDocUids.length;null===(t=this.toolbarBtn.print)||void 0===t||t.classList.toggle("disabled",!o||s),null===(e=this.toolbarBtn.upload)||void 0===e||e.classList.toggle("disabled",s),null===(i=this.toolbarBtn.share)||void 0===i||i.classList.toggle("disabled",s)}handleDocumentClick(t){var e,i;null===(i=(e=this.config).onDocumentClick)||void 0===i||i.call(e,t)}handleRename(t){const e=IO.documentManager.getDocument(t);e&&jO({container:this.config.container,type:UO.INPUT,title:"Rename Document",placeholder:"Enter document name",initialValue:e.name,confirmText:"Rename",validation:t=>t.length<1?"Name can't be empty":null}).then((async i=>{if(i){e.rename(i);const n=this.docItems.find((e=>e.getUid()===t));null==n||n.update(),await HO(this.config.container,"Renamed",VO.SUCCESS)}}))}createToolbars(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w,b,C,S,_,T,E,P,A,I,D,k,R,M,L,O;super.createToolbars();const{toolbarButtonsConfig:B,exportConfig:F}=this.config,N=new File([""],"test.pdf",{type:"application/pdf"}),U="share"in navigator&&navigator.canShare({files:[N]}),V=()=>{U?this.handleShare():this.handleDownload()},W=!!(null==F?void 0:F.uploadToServer);[{id:"mwc-lbrary-newDoc",icon:(null===(t=null==B?void 0:B.newDoc)||void 0===t?void 0:t.icon)||DO.newDoc,label:(null===(e=null==B?void 0:B.newDoc)||void 0===e?void 0:e.label)||"New",className:(null===(i=null==B?void 0:B.newDoc)||void 0===i?void 0:i.className)||"",isHidden:null===(n=null==B?void 0:B.newDoc)||void 0===n?void 0:n.isHidden,onClick:()=>this.handleNewDocument()},{id:"mwc-lbrary-capture",icon:(null===(s=null==B?void 0:B.capture)||void 0===s?void 0:s.icon)||DO.cameraCapture,label:(null===(o=null==B?void 0:B.capture)||void 0===o?void 0:o.label)||"Capture",className:(null===(r=null==B?void 0:B.capture)||void 0===r?void 0:r.className)||"",isHidden:null===(a=null==B?void 0:B.capture)||void 0===a?void 0:a.isHidden,onClick:()=>this.handleCameraCapture()},{id:"mwc-lbrary-import",icon:(null===(l=null==B?void 0:B.import)||void 0===l?void 0:l.icon)||DO.galleryImport,label:(null===(h=null==B?void 0:B.import)||void 0===h?void 0:h.label)||"Import",className:(null===(c=null==B?void 0:B.import)||void 0===c?void 0:c.className)||"",isHidden:null===(d=null==B?void 0:B.import)||void 0===d?void 0:d.isHidden,onClick:()=>this.handleGalleryImport()},{id:"mwc-lbrary-uploads",icon:(null===(u=null==B?void 0:B.uploads)||void 0===u?void 0:u.icon)||DO.uploadedFiles,label:(null===(p=null==B?void 0:B.uploads)||void 0===p?void 0:p.label)||"Uploads",className:(null===(g=null==B?void 0:B.uploads)||void 0===g?void 0:g.className)||"",isHidden:(null===(f=null==B?void 0:B.uploads)||void 0===f?void 0:f.isHidden)||!W,onClick:()=>this.handleViewUploadsHistory()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[`${t.id.split("-").pop()}`]=e,this.MWCViewElements.toolbarContainer.appendChild(e)}));[{id:"mwc-library-select-delete",icon:(null===(m=null==B?void 0:B.delete)||void 0===m?void 0:m.icon)||DO.delete,label:(null===(v=null==B?void 0:B.delete)||void 0===v?void 0:v.label)||"Delete",className:`selected ${(null===(y=null==B?void 0:B.delete)||void 0===y?void 0:y.className)||""}`,isHidden:null===(x=null==B?void 0:B.delete)||void 0===x?void 0:x.isHidden,onClick:()=>this.handleDelete()},{id:"mwc-library-select-print",icon:(null===(w=null==B?void 0:B.print)||void 0===w?void 0:w.icon)||DO.print,label:(null===(b=null==B?void 0:B.print)||void 0===b?void 0:b.label)||"Print",className:`selected ${(null===(C=null==B?void 0:B.print)||void 0===C?void 0:C.className)||""}`,isHidden:null===(S=null==B?void 0:B.print)||void 0===S?void 0:S.isHidden,onClick:()=>this.handlePrint()},{id:"mwc-library-select-share",icon:(null===(_=null==B?void 0:B.share)||void 0===_?void 0:_.icon)||(U?DO.sharePDF:DO.downloadPDF),label:(null===(T=null==B?void 0:B.share)||void 0===T?void 0:T.label)||(U?"Share":"Download"),className:`selected ${(null===(E=null==B?void 0:B.share)||void 0===E?void 0:E.className)||""}`,isHidden:null===(P=null==B?void 0:B.share)||void 0===P?void 0:P.isHidden,onClick:()=>V()},{id:"mwc-library-select-upload",icon:(null===(A=null==B?void 0:B.upload)||void 0===A?void 0:A.icon)||DO.uploadPDF,label:(null===(I=null==B?void 0:B.upload)||void 0===I?void 0:I.label)||"Upload",className:`selected ${(null===(D=null==B?void 0:B.upload)||void 0===D?void 0:D.className)||""}`,isHidden:(null===(k=null==B?void 0:B.upload)||void 0===k?void 0:k.isHidden)||!W,onClick:()=>this.handleUploadDocuments()},{id:"mwc-library-select-back",icon:(null===(R=null==B?void 0:B.back)||void 0===R?void 0:R.icon)||DO.back,label:(null===(M=null==B?void 0:B.back)||void 0===M?void 0:M.label)||"Back",className:`selected ${(null===(L=null==B?void 0:B.back)||void 0===L?void 0:L.className)||""}`,isHidden:null===(O=null==B?void 0:B.back)||void 0===O?void 0:O.isHidden,onClick:()=>this.handleSelectedBack()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[`${t.id.split("-").pop()}`]=e,this.MWCViewElements.selectedToolbarContainer.appendChild(e)}))}async handleNewDocument(){const t=await jO({container:this.config.container,type:UO.INPUT,title:"New Document",placeholder:"Enter document name",confirmText:"Create"});if(t){await this.createAndLoadDocument(t||`Doc-${Date.now()}`)&&(this.setVisible(!0),await HO(this.config.container,"Created",VO.SUCCESS))}}async createAndLoadDocument(t,e){try{const i=IO.documentManager.createDocument({name:t||`Doc-${Date.now()}`});return e&&await i.loadSource(e),i}catch(t){let e=t.message||t;alert(`Failed to create and load document: ${e}`),console.error("Failed to create and load document: ",e)}}async handleCameraCapture(){await this.config.onCameraCapture()}async handleGalleryImport(){await this.config.onGalleryImport()}async handleViewUploadsHistory(){var t;null===(t=this.config)||void 0===t||t.onViewUploadsHistory()}async handleDelete(){await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.WARNING,title:"Delete Documents",message:`Are you sure you want to delete ${this.checkedDocUids.length} document(s)?`,confirmText:"Delete",cancelText:"Cancel",showCloseBtn:!0})&&(IO.documentManager.deleteDocuments([...this.checkedDocUids]),this.setVisible(!0),this.toggleSelectionMode(!1),await HO(this.config.container,"Deleted",VO.SUCCESS))}async handlePrint(){var t,e;if(this.checkedDocUids.length>1||(null===(t=this.toolbarBtn.print)||void 0===t?void 0:t.classList.contains("disabled")))return void console.warn("Please select 1 document to print");const i=this.checkedDocUids[0],n=IO.documentManager.getDocument(i);(null===(e=null==n?void 0:n.pages)||void 0===e?void 0:e.length)&&n.print()}async handleShare(){const t=[];for(let e=0;e<this.checkedDocUids.length;e++){const i=IO.documentManager.getDocument(this.checkedDocUids[e]);if(i.pages.length){const e=await i.saveToPdf({mimeType:"application/octet-stream",saveAnnotation:"annotation"});t.push(new File([e],`${i.name}.pdf`,{type:"application/pdf"}))}}if(navigator.canShare&&navigator.canShare({files:t}))try{await navigator.share({files:t,title:"PDF Files"})}catch(t){"AbortError"!==t.name&&await HO(this.config.container,"Failed to share files",VO.ERROR)}else await HO(this.config.container,"Your system doesn't support sharing PDF files",VO.WARNING)}async handleDownload(){this.checkedDocUids.forEach((async t=>{var e;const i=IO.documentManager.getDocument(t);(null===(e=null==i?void 0:i.pages)||void 0===e?void 0:e.length)&&await KO.handleDownloadDoc(i,this.config.container)}))}async handleUploadDocuments(){var t,e;if(null===(e=null===(t=this.config)||void 0===t?void 0:t.exportConfig)||void 0===e?void 0:e.uploadToServer)try{const t=this.checkedDocUids.map((async t=>{var e,i,n,s,o,r;const a=IO.documentManager.getDocument(t);if(null===(e=null==a?void 0:a.pages)||void 0===e?void 0:e.length){const t=await a.saveToPdf({mimeType:"application/pdf",saveAnnotation:"annotation"}),e=`${a.name}.pdf`,l=await(null===(n=null===(i=this.config)||void 0===i?void 0:i.exportConfig)||void 0===n?void 0:n.uploadToServer(e,t));if("success"===(null==l?void 0:l.status)){const i=this.config.getUploadedDocuments();i.push(l),this.config.updateUploadedDocuments(i);if(await(null===(o=null===(s=this.config.exportConfig)||void 0===s?void 0:s.onUploadSuccess)||void 0===o?void 0:o.call(s,e,"pdf",FO.Library,t)))return void(null===(r=this.config)||void 0===r||r.onClose())}return l}await HO(this.config.container,"Document contains no pages!",VO.WARNING)})),e=await Promise.all(t),i=null==e?void 0:e.filter((t=>"success"===(null==t?void 0:t.status)));if(i.length){this.handleSelectAllOrCancel(!0);await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.SUCCESS,title:"Upload Successful",confirmText:"View in Uploads",cancelText:"Continue"})&&this.handleViewUploadsHistory()}}catch(t){let e=(null==t?void 0:t.message)||t;console.error("Uploads failed:",e);await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.ERROR,title:"Uploads Failed",confirmText:"View Uploaded Files",cancelText:"Continue"})&&this.handleViewUploadsHistory()}else await HO(this.config.container,"No upload function configured",VO.WARNING)}async handleSelectedBack(){this.handleSelectAllOrCancel(!0)}}const eB="\n  .mwc-view-header-actions {\n    position: absolute;\n    right: 1rem;\n    font-family: Verdana;\n    color: black;\n  }\n\n  .mwc-view-header-actions .mwc-library-header-btn {\n    border: none;\n    background: transparent;\n    display: flex;\n    align-content: center;\n    cursor: pointer;\n  }\n\n  .mwc-view-header-actions .mwc-library-header-btn.selectAll,\n  .mwc-view-header-actions .mwc-library-header-btn.cancel{\n    background: none;\n    border: none;\n    color: #FE8E14;\n    font-size: 14px;\n    cursor: pointer;\n    padding: 4px 8px;\n    align-content: end;\n  }\n\n  .mwc-default-empty-library {\n    display: flex;\n    flex-direction: column;\n    justify-content:center;\n    align-items: center;\n    gap: 1rem;\n  }\n\n  .mwc-default-empty-library svg {\n    width: 200px;\n    height: auto;\n  }\n\n  .mwc-default-empty-library .title {\n    margin-top: 2rem;\n    font-size: 24px;\n    color: black;\n  }\n\n  .mwc-default-empty-library .desc {\n    font-size: 16px;\n    color: black;\n  }\n",iB={base:{type:IO.Elements.Layout,className:"ddv-edit-viewer-header-mobile",children:[IO.Elements.Pagination]},edit:{type:IO.Elements.Layout,className:"ddv-edit-viewer-header-mobile",children:[IO.Elements.Undo,IO.Elements.Redo]}},nB={type:IO.Elements.Layout,flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[iB.base,IO.Elements.MainView,{type:IO.Elements.Layout,className:"ddv-edit-viewer-footer-mobile",children:[{type:IO.Elements.DeleteCurrent,events:{click:"showDocumentPageByDelete"}},IO.Elements.Crop,IO.Elements.Filter,{type:IO.Elements.AnnotationSet,className:"mwc-annotation-set",pullDownBox:{className:"mwc-annotation-mode-bar"}}]}]};class sB extends GO{constructor(t){super(t),this.config=t,this.editViewer=null,this.toolbarBtn={back:null,delete:null,addPage:null,upload:null,share:null,edit:null,crop:null,rotate:null,filter:null,annotate:null,done:null},this.editToolbarContainer={},this.ddvAnnotationsToolbarLabel={Undo:"Undo",Redo:"Redo",SelectAnnotation:"Select",EraseAnnotation:"Eraser",RectAnnotation:"Rect",EllipseAnnotation:"Ellipse",PolygonAnnotation:"Polygon",PolylineAnnotation:"Polyline",LineAnnotation:"Line",InkAnnotation:"Ink",TextBoxAnnotation:"Textbox",TextTypewriterAnnotation:"Text",StampIconAnnotation:"Stamp",StampImageAnnotation:"Image",BringForward:"Up",BringToFront:"Top",SendBackward:"Down",SendToBack:"Bottom"},this.isCroppingMode=!1,this.isAnnotatingMode=!1,this.isFilterMode=!1}initialize(){LO("mwc-page-view-style",oB),super.initialize(),IO.Elements.setDisplayTextConfig({...this.ddvAnnotationsToolbarLabel,...this.config.annotationToolbarLabelConfig}),this.editViewer=new IO.EditViewer({container:this.MWCViewElements.contentContainer,uiConfig:nB,viewerConfig:{scrollToLatest:!0}}),this.editViewer.displayMode="single",this.MWCViewElements.contentContainer.style.padding="0px",this.bindPageViewEvents(),this.setVisible(!1)}bindPageViewEvents(){this.editViewer.on("showDocumentPageByDelete",(async()=>{this.editViewer.currentDocument.pages.length||this.handleBack(),await HO(this.config.container,"Deleted",VO.SUCCESS)})),this.bindAnnotationEvents(),this.bindToolModeEvents()}bindAnnotationEvents(){let t=!1;const e=document.querySelector(".mwc-annotation-set");!kO()&&e&&e.addEventListener("click",(()=>{const e=document.querySelector(".ddv-annotation-mode-box");if(!t){t=!0;let i=!1;e.addEventListener("mousedown",(t=>{let e=t.target;t.target instanceof HTMLSpanElement&&(e=t.target.parentElement),e.classList.contains("ddv-button-focused")&&(i=!0)})),e.addEventListener("click",(()=>{i&&(this.editViewer.toolMode="pan",i=!1)}))}}))}bindToolModeEvents(){this.editViewer.on("toolModeChanged",(t=>{"crop"===t.oldToolMode&&(this.toolbarBtn.crop.classList.remove("selected"),this.enableAllEditButtons(),this.toggleDDVHeaderButtons(!0),this.isCroppingMode=!1)}))}createHeader(){super.createHeader(!1)}updateEmptyContentHTML(){const t=`\n      <div class="mwc-default-empty-page">\n        ${DO.emptyLibrary}\n        <div class="title">No page to display!</div>\n      </div>\n    `;this.MWCViewElements.emptyContentContainer.innerHTML=t}createToolbars(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w,b,C,S,_,T,E,P,A,I,D,k,R,M,L,O,B,F,N,U,V,W,H,j;super.createToolbars();const{toolbarButtonsConfig:z,exportConfig:G}=this.config,Y=new File([""],"test.pdf",{type:"application/pdf"}),$="share"in navigator&&navigator.canShare({files:[Y]}),X=()=>{$?this.handleShare():this.handleDownload()},q=!!(null==G?void 0:G.uploadToServer);[{id:"mwc-page-back",icon:(null===(t=null==z?void 0:z.back)||void 0===t?void 0:t.icon)||DO.back,label:(null===(e=null==z?void 0:z.back)||void 0===e?void 0:e.label)||"Back",isHidden:null===(i=null==z?void 0:z.back)||void 0===i?void 0:i.isHidden,className:`${(null===(n=null==z?void 0:z.back)||void 0===n?void 0:n.className)||""}`,onClick:()=>this.handleBack()},{id:"mwc-page-delete",icon:(null===(s=null==z?void 0:z.delete)||void 0===s?void 0:s.icon)||DO.delete,label:(null===(o=null==z?void 0:z.delete)||void 0===o?void 0:o.label)||"Delete",isHidden:null===(r=null==z?void 0:z.delete)||void 0===r?void 0:r.isHidden,className:`${(null===(a=null==z?void 0:z.delete)||void 0===a?void 0:a.className)||""}`,onClick:()=>this.handleDeletePage()},{id:"mwc-page-addPage",icon:(null===(l=null==z?void 0:z.addPage)||void 0===l?void 0:l.icon)||DO.captureAnother,label:(null===(h=null==z?void 0:z.addPage)||void 0===h?void 0:h.label)||"Add Page",isHidden:null===(c=null==z?void 0:z.addPage)||void 0===c?void 0:c.isHidden,className:`${(null===(d=null==z?void 0:z.addPage)||void 0===d?void 0:d.className)||""}`,onClick:()=>this.handleAddPage()},{id:"mwc-page-share",icon:(null===(u=null==z?void 0:z.share)||void 0===u?void 0:u.icon)||($?DO.sharePNG:DO.downloadPNG),label:(null===(p=null==z?void 0:z.share)||void 0===p?void 0:p.label)||($?"Share":"Download"),isHidden:null===(g=null==z?void 0:z.share)||void 0===g?void 0:g.isHidden,className:`${(null===(f=null==z?void 0:z.share)||void 0===f?void 0:f.className)||""}`,onClick:()=>X()},{id:"mwc-page-upload",icon:(null===(m=null==z?void 0:z.upload)||void 0===m?void 0:m.icon)||DO.uploadPNG,label:(null===(v=null==z?void 0:z.upload)||void 0===v?void 0:v.label)||"Upload",isHidden:(null===(y=null==z?void 0:z.upload)||void 0===y?void 0:y.isHidden)||!q,className:`${(null===(x=null==z?void 0:z.upload)||void 0===x?void 0:x.className)||""}`,onClick:()=>this.handleUpload()},{id:"mwc-page-edit",icon:(null===(w=null==z?void 0:z.edit)||void 0===w?void 0:w.icon)||DO.edit,label:(null===(b=null==z?void 0:z.edit)||void 0===b?void 0:b.label)||"Edit",isHidden:null===(C=null==z?void 0:z.edit)||void 0===C?void 0:C.isHidden,className:`${(null===(S=null==z?void 0:z.edit)||void 0===S?void 0:S.className)||""}`,onClick:()=>this.handleEditMode()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[t.id.split("-").pop()]=e,this.MWCViewElements.toolbarContainer.appendChild(e)}));[{id:"mwc-page-crop",icon:(null===(_=null==z?void 0:z.crop)||void 0===_?void 0:_.icon)||DO.crop,label:(null===(T=null==z?void 0:z.crop)||void 0===T?void 0:T.label)||"Crop",isHidden:null===(E=null==z?void 0:z.crop)||void 0===E?void 0:E.isHidden,className:`${(null===(P=null==z?void 0:z.crop)||void 0===P?void 0:P.className)||""}`,onClick:()=>this.handleCrop()},{id:"mwc-page-rotate",icon:(null===(A=null==z?void 0:z.rotate)||void 0===A?void 0:A.icon)||DO.rotate,label:(null===(I=null==z?void 0:z.rotate)||void 0===I?void 0:I.label)||"Rotate",isHidden:null===(D=null==z?void 0:z.rotate)||void 0===D?void 0:D.isHidden,className:`${(null===(k=null==z?void 0:z.rotate)||void 0===k?void 0:k.className)||""}`,onClick:()=>this.handleRotate()},{id:"mwc-page-filter",icon:(null===(R=null==z?void 0:z.filter)||void 0===R?void 0:R.icon)||DO.filter,label:(null===(M=null==z?void 0:z.filter)||void 0===M?void 0:M.label)||"Filter",isHidden:null===(L=null==z?void 0:z.filter)||void 0===L?void 0:L.isHidden,className:`${(null===(O=null==z?void 0:z.filter)||void 0===O?void 0:O.className)||""}`,onClick:()=>this.handleFilter()},{id:"mwc-page-annotate",icon:(null===(B=null==z?void 0:z.annotate)||void 0===B?void 0:B.icon)||DO.annotate,label:(null===(F=null==z?void 0:z.annotate)||void 0===F?void 0:F.label)||"Annotate",isHidden:null===(N=null==z?void 0:z.annotate)||void 0===N?void 0:N.isHidden,className:`${(null===(U=null==z?void 0:z.annotate)||void 0===U?void 0:U.className)||""}`,onClick:()=>this.handleAnnotate()},{id:"mwc-page-done",icon:(null===(V=null==z?void 0:z.done)||void 0===V?void 0:V.icon)||DO.done,label:(null===(W=null==z?void 0:z.done)||void 0===W?void 0:W.label)||"Done",isHidden:null===(H=null==z?void 0:z.done)||void 0===H?void 0:H.isHidden,className:`done ${(null===(j=null==z?void 0:z.done)||void 0===j?void 0:j.className)||""}`,onClick:()=>this.handleDoneBtn()}].forEach((t=>{const e=this.createToolbarButton(t);this.toolbarBtn[t.id.split("-").pop()]=e,this.MWCViewElements.selectedToolbarContainer.appendChild(e)}))}setVisible(t){var e,i;super.setVisible(t),t?(this.showContent(!0),null===(e=this.editViewer)||void 0===e||e.show()):null===(i=this.editViewer)||void 0===i||i.hide()}openPage(t,e){this.editViewer.openDocument(t),this.editViewer.goToPage(e),this.editViewer.show()}handleBack(){var t,e;null===(e=(t=this.config).onDocumentClick)||void 0===e||e.call(t)}async handleDeletePage(){await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.WARNING,title:"Delete Page",message:"Are you sure you want to delete this page?",confirmText:"Delete",cancelText:"Cancel",showCloseBtn:!0})&&this.config.container.querySelector(".ddv-delete-current").click()}handleAddPage(){const t=this.toolbarBtn.addPage;let e=t.querySelector(".mwc-add-page-menu");if(e)e.classList.toggle("show");else{LO("mwc-add-page-dropdown-style",rB),e=document.createElement("div"),e.className="mwc-add-page-menu",e.innerHTML=`\n        <button class="mwc-add-page-option capture">\n          ${DO.cameraCapture}\n          <span>Capture</span>\n        </button>\n        <button class="mwc-add-page-option import">\n          ${DO.galleryImport}\n          <span>Import</span>\n        </button>\n      `;e.querySelector(".capture").addEventListener("click",(async t=>{var i,n;e.classList.contains("show")&&e.classList.remove("show"),await(null===(n=(i=this.config).onCameraCapture)||void 0===n?void 0:n.call(i)),t.stopPropagation()}));e.querySelector(".import").addEventListener("click",(async t=>{var i,n;e.classList.contains("show")&&e.classList.remove("show"),await(null===(n=(i=this.config).onGalleryImport)||void 0===n?void 0:n.call(i)),t.stopPropagation()})),document.addEventListener("click",(i=>{!t.contains(i.target)&&e.classList.contains("show")&&e.classList.remove("show")})),t.querySelector(".icon").prepend(e),e.classList.toggle("show")}}async handleShare(){try{const t=this.editViewer.currentDocument,e=this.editViewer.getCurrentPageIndex(),i=await t.saveToPng(e,{saveAnnotation:!0}),n=[new File([i],`${t.name}-${Date.now()}.png`,{type:i.type})];if(navigator.canShare&&navigator.canShare({files:n}))try{await navigator.share({files:n,title:"Image Files"})}catch(t){"AbortError"!==t.name&&await HO(this.config.container,"Failed to share files",VO.ERROR)}else await HO(this.config.container,"Failed to share",VO.WARNING)}catch(t){await HO(this.config.container,"Error processing files",VO.ERROR)}}async handleDownload(){try{const t=this.editViewer.currentDocument,e=this.editViewer.getCurrentPageIndex(),i=await t.saveToPng(e,{saveAnnotation:!0}),n=URL.createObjectURL(i),s=document.createElement("a");s.href=n,s.download=`${t.name}.png`,s.click(),s.remove(),URL.revokeObjectURL(n),await HO(this.config.container,"Downloaded",VO.SUCCESS)}catch(t){const e=(null==t?void 0:t.message)||t;console.warn("Download failed:",e),await HO(this.config.container,"Failed to download page",VO.ERROR)}}async handleUpload(){var t,e,i,n,s,o,r,a,l;if(null===(e=null===(t=this.config)||void 0===t?void 0:t.exportConfig)||void 0===e?void 0:e.uploadToServer)try{const t=this.editViewer.currentDocument,e=this.editViewer.getCurrentPageIndex(),h=await t.saveToPng(e,{saveAnnotation:!0}),c=`${t.name}-${e}.png`,d=await(null===(n=null===(i=this.config)||void 0===i?void 0:i.exportConfig)||void 0===n?void 0:n.uploadToServer(c,h));if("success"===(null==d?void 0:d.status)){if(await(null===(o=null===(s=this.config.exportConfig)||void 0===s?void 0:s.onUploadSuccess)||void 0===o?void 0:o.call(s,c,"png",FO.Page,h)))return void(null===(r=this.config)||void 0===r||r.onClose());const t=this.config.getUploadedDocuments();t.push(d),this.config.updateUploadedDocuments(t);await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.SUCCESS,title:"Upload Successful",confirmText:"View in Uploads",cancelText:"Continue"})&&(null===(l=(a=this.config).onViewUploadsHistory)||void 0===l||l.call(a))}}catch(t){const e=(null==t?void 0:t.message)||t;console.error("Upload failed:",e),await HO(this.config.container,"Failed to upload page",VO.ERROR)}else await HO(this.config.container,"No upload function configured",VO.WARNING)}async handleEditMode(){try{if(!this.updateEditViewTopbar("edit"))throw new Error("Failed to update edit viewer");this.toggleSelectionMode(!0)}catch(t){await HO(this.config.container,"Failed to enter edit mode",VO.ERROR),console.error(t)}}updateEditViewTopbar(t){const e=this.editViewer.getUiConfig();return e.children[0]=iB[t],this.editViewer.updateUiConfig(e)}toggleDDVHeaderButtons(t){const e=this.config.container.querySelector(".ddv-edit-viewer-header-mobile"),i=t?"remove":"add";e.childNodes.forEach((t=>t.classList[i]("ddv-disable-button")))}disableOtherEditButtons(t){this.config.container.querySelectorAll(".mwc-view-controls-container")[1].childNodes.forEach((e=>{e!==t&&e!==this.toolbarBtn.done&&e.classList.add("ddv-disable-button")}))}enableAllEditButtons(){this.config.container.querySelectorAll(".mwc-view-controls-container")[1].childNodes.forEach((t=>{t.classList.remove("ddv-disable-button")}))}handleCrop(){this.config.container.querySelector(".ddv-button.ddv-crop").click(),this.disableOtherEditButtons(this.toolbarBtn.crop),this.toolbarBtn.crop.classList.add("selected"),this.toggleDDVHeaderButtons(!1)}handleRotate(){this.editViewer.rotate(-90)}handleFilter(){this.config.container.querySelector(".ddv-button.ddv-filter").click(),this.isFilterMode?(this.isFilterMode=!1,this.toolbarBtn.filter.classList.remove("selected"),this.enableAllEditButtons()):(this.isFilterMode=!0,this.isAnnotatingMode=!1,this.disableOtherEditButtons(this.toolbarBtn.filter),this.toolbarBtn.filter.classList.add("selected"),this.toolbarBtn.annotate.classList.remove("selected"))}handleAnnotate(){this.config.container.querySelector(".mwc-annotation-set").click(),this.isAnnotatingMode?(this.isAnnotatingMode=!1,this.toolbarBtn.annotate.classList.remove("selected"),this.enableAllEditButtons(),this.editViewer.toolMode="pan"):(this.isAnnotatingMode=!0,this.isFilterMode=!1,this.disableOtherEditButtons(this.toolbarBtn.annotate),this.toolbarBtn.annotate.classList.add("selected"),this.toolbarBtn.filter.classList.remove("selected"))}async handleDoneBtn(){try{const t=await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.WARNING,title:"Exit Edit Mode",message:"You might have unsaved changes. Do you want to save before exiting?",confirmText:"Save & Exit",cancelText:"Discard",showCloseBtn:!0});if(null===t)return;if(t)this.editViewer.saveOperations();else{for(;this.editViewer.undo(););this.editViewer.saveOperations()}this.isAnnotatingMode=!1,this.isFilterMode=!1,this.toolbarBtn.annotate.classList.remove("selected"),this.toolbarBtn.filter.classList.remove("selected"),"pan"!==this.editViewer.toolMode&&(this.editViewer.toolMode="pan");if(!this.updateEditViewTopbar("base"))throw new Error("Failed to update edit viewer");this.toggleSelectionMode(!1),this.enableAllEditButtons()}catch(t){await HO(this.config.container,"Failed to exit edit mode",VO.ERROR),console.error(t)}}dispose(){var t;null===(t=this.editViewer)||void 0===t||t.destroy(),this.editViewer=null,this.config.container&&(this.config.container.style.display="none")}}const oB="\n.done .label {\n  color: #fe8e14\n}\n\n.ddv-edit-viewer-footer-mobile{\n  height: 0;\n}\n\n.ddv-annotation-mode-box,\n.ddv-crop-box,\n.ddv-filter-list {\n  top: unset !important;\n  bottom: 0;\n}\n\n.ddv-disable-button {\n  opacity: 0.3;\n  pointer-events: none;\n}\n\n.mwc-annotation-mode-bar {\n  overflow-y: hidden;\n  height: 70px;\n\n  scrollbar-width: thin;\n  scrollbar-color: rgb(193,193,193) rgb(241,241,241); \n}\n.mwc-annotation-mode-bar > .ddv-button {\n  height: 50px;\n  width: 50px;\n}\n\n.mwc-annotation-mode-bar::-webkit-scrollbar {\n  width: 5px;\n  height: 5px;\n  border-radius: 0px;\n}\n\n.mwc-annotation-mode-bar::-webkit-scrollbar-thumb { \n  border-radius: 0px;\n  background-color: rgb(193,193,193);\n}  \n\n.mwc-annotation-mode-bar::-webkit-scrollbar-track {\n  border-radius: 0px;\n  background-color: rgb(241,241,241);\n}\n\n.ddv-undo-page, .ddv-redo-page {\n  flex-direction: column;\n}\n",rB="\n  .mwc-view-controls-btn {\n    position: relative; /* Add this to make the absolute positioning work relative to button */\n  }\n\n  .mwc-add-page-menu {\n    position: absolute;\n    bottom: 6rem;\n    transform: translate(-50%);\n    left: 50%;\n    right: 50%;\n    width: max-content;\n    background-color: #323234;\n    border-radius: 0.5rem;\n    overflow: visible;\n    display: none;\n    margin-bottom: 0.5px; /* Add some spacing between menu and button */\n    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); /* Add shadow for better visibility */\n  }\n\n  .mwc-add-page-menu::after {\n    content: '';\n    position: absolute;\n    bottom: -8px; /* Triangle */\n    left: 50%;\n    right: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 8px solid transparent;\n    border-right: 8px solid transparent;\n    border-top: 8px solid #323234; /* Same color as menu background */\n  }\n\n  \n  .mwc-add-page-menu.show {\n    display: block;\n  }\n  \n  .mwc-add-page-option {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem;\n    color: white;\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-family: Verdana;\n    font-size: 14px;\n    width: 100%;\n    box-sizing: border-box;\n  }\n\n  .mwc-add-page-option svg {\n    width: 24px;\n    height: 24px;\n  }\n\n  .mwc-add-page-option span {\n    cursor: pointer;\n  }\n  \n  .mwc-add-page-option:hover {\n    background-color: rgba(255, 255, 255, 0.1);\n  }\n\n  .mwc-add-page-option:not(:last-child) {\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  }\n";class aB{constructor(t){this.config=t,this.createUI(),this.bindEvents()}createUI(){LO("mwc-history-item-style",lB),this.dom=document.createElement("div"),this.dom.className="mwc-library-view-history-item",this.dom.innerHTML=`\n      <div class="mwc-library-view-history-name">${this.config.doc.fileName}</div>\n      <div class="mwc-library-view-history-time">${function(t){if(!t)return"";const e=(Number(t)-621355968e9)/1e4,i=6e4*new Date(e).getTimezoneOffset();return new Date(e+i).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}(this.config.doc.uploadTime)||""}</div>\n      <div class="mwc-library-view-history-actions">\n        <button class="mwc-library-view-history-action-btn delete">Delete</button>\n        <span class="mwc-library-view-history-separator">|</span>\n        <button class="mwc-library-view-history-action-btn download">Download</button>\n      </div>\n    `}bindEvents(){const t=this.dom.querySelector(".delete"),e=this.dom.querySelector(".download");null==t||t.addEventListener("click",(()=>this.handleDelete())),null==e||e.addEventListener("click",(()=>this.handleDownload()))}async handleDelete(){var t,e;await jO({container:this.config.container,type:UO.CONFIRM,variant:VO.WARNING,title:"Delete Document",message:"Are you sure you want to delete this document from the server?",confirmText:"Delete",cancelText:"Cancel",showCloseBtn:!0})&&(await(null===(e=null===(t=this.config)||void 0===t?void 0:t.onDeleteDocument)||void 0===e?void 0:e.call(t,this.config.doc)),this.dispose(),await HO(this.config.container,"Deleted",VO.SUCCESS))}async handleDownload(){var t,e;await(null===(e=null===(t=this.config)||void 0===t?void 0:t.onDownloadDocument)||void 0===e?void 0:e.call(t,this.config.doc))}getDom(){return this.dom}dispose(){this.dom.remove()}}const lB="\n.mwc-library-view-history-item {\n  display: flex;\n  flex-direction: column;\n  font-family: Verdana;\n  padding: 16px;\n  border-bottom: 1px solid #F5F5F5;\n}\n\n.mwc-library-view-history-item:last-child {\n  border-bottom: none;\n}\n\n.mwc-library-view-history-name {\n  font-size: 16px;\n}\n\n.mwc-library-view-history-time {\n  color: #888888;\n  font-size: 16px;\n}\n\n.mwc-library-view-history-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.mwc-library-view-history-action-btn {\n  color: #FE8E14;\n  cursor: pointer;\n  background: none;\n  border: none;\n  font-family: Verdana;\n  padding: 0;\n  font-size: 16px;\n}\n\n.mwc-library-view-history-action-btn:hover {\n  text-decoration: underline;\n}\n\n.mwc-library-view-history-separator {\n  color: #E0E0E0;\n}\n";class hB extends GO{constructor(t){super(t),this.config=t,this.currentCaller=FO.Library,this.toolbarBtn={back:null}}initialize(){LO("mwc-history-view-style",cB),super.initialize(),this.updateEmptyContentHTML(),this.setVisible(!1)}setVisible(t,e){var i;super.setVisible(t),t&&(this.currentCaller=e.caller,this.showContent(!!(null===(i=this.config.getUploadedDocuments())||void 0===i?void 0:i.length)),this.loadUploadedFiles())}createHeader(){super.createHeader(),this.MWCViewElements.headerContainer.innerHTML='\n      <div class="mwc-view-header-title">Upload History</div>\n    '}updateEmptyContentHTML(){const t=`\n    <div class="mwc-default-empty-history">\n      ${DO.emptyLibrary}\n      <div class="title">\n        No uploaded files found!\n      </div>\n    </div>\n    `;super.setEmptyContent(this.config.emptyContentConfig||t)}createToolbars(){var t,e,i,n;super.createToolbars();const{toolbarButtonsConfig:s}=this.config;[null,null,null,{id:"mwc-history-back",icon:(null===(t=null==s?void 0:s.back)||void 0===t?void 0:t.icon)||DO.back,label:(null===(e=null==s?void 0:s.back)||void 0===e?void 0:e.label)||"Back",className:(null===(i=null==s?void 0:s.back)||void 0===i?void 0:i.className)||"",isHidden:null===(n=null==s?void 0:s.back)||void 0===n?void 0:n.isHidden,onClick:()=>{var t,e;return null===(e=(t=this.config).onBack)||void 0===e?void 0:e.call(t,this.currentCaller)}}].forEach((t=>{const e=this.createToolbarButton(t);t&&(this.toolbarBtn[t.id.split("-").pop()]=e),this.MWCViewElements.toolbarContainer.appendChild(e)}))}loadUploadedFiles(){var t;this.MWCViewElements.contentContainer.textContent="",null===(t=this.config.getUploadedDocuments())||void 0===t||t.forEach((t=>{const e=new aB({container:this.config.container,doc:t,onDeleteDocument:()=>this.handleHistoryDelete(t),onDownloadDocument:()=>this.handleHistoryDownload(t)});this.MWCViewElements.contentContainer.append(e.getDom())}))}handleHistoryDelete(t){var e,i;t&&(null===(i=null===(e=this.config)||void 0===e?void 0:e.exportConfig)||void 0===i||i.deleteFromServer(t).then((async()=>{var e,i;const n=null===(e=this.config.getUploadedDocuments())||void 0===e?void 0:e.filter((e=>e.uploadTime!==t.uploadTime));this.config.updateUploadedDocuments(n),this.showContent(!!(null===(i=this.config.getUploadedDocuments())||void 0===i?void 0:i.length)),await HO(this.config.container,"Deleted",VO.SUCCESS)})).catch((async()=>{await HO(this.config.container,"Failed",VO.ERROR)})))}handleHistoryDownload(t){var e,i;null===(i=null===(e=this.config)||void 0===e?void 0:e.exportConfig)||void 0===i||i.downloadFromServer(t).then((async()=>{await HO(this.config.container,"Downloaded",VO.SUCCESS)})).catch((async()=>{await HO(this.config.container,"Failed",VO.ERROR)}))}dispose(){this.config.container&&(this.config.container.style.display="none",this.MWCViewElements.contentContainer.textContent="")}}const cB="\n  .mwc-default-empty-history {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    gap: 1rem;\n  }\n\n  .mwc-default-empty-history svg {\n    width: 200px;\n    height: auto;\n  }\n\n  .mwc-default-empty-history .title {\n    margin-top: 2rem;\n    font-size: 24px;\n        color: black;\n  }\n\n  .mwc-default-empty-history .desc {\n    font-size: 16px;\n        color: black;\n  }\n",dB="mwc-ddv-css",uB="https://cdn.jsdelivr.net/npm/dynamsoft-document-viewer@2.1.0/dist";class pB{showMWCLoadingOverlay(t){const e=RO(this.config.container);this.loadingScreen=function(t,e={}){const{message:i,spinnerSize:n=32}=e,s=document.createElement("div");s.className="mwc-loading-screen";const o=document.createElement("div");o.className="mwc-loading";const r=document.createElement("div");r.className="mwc-loading-content";const a=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(r.innerHTML=a,i){const t=document.createElement("div");t.className="mwc-loading-message",t.textContent=i,r.appendChild(t)}return o.appendChild(r),s.appendChild(o),t.appendChild(s),{element:s,updateMessage:t=>{let e=o.querySelector(".dds-loading-message");null!==t?e?e.textContent=t:(e=document.createElement("div"),e.className="mwc-loading-message",e.textContent=t,r.appendChild(e)):null==e||e.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout((()=>{var t;null===(t=s.parentNode)||void 0===t||t.removeChild(s)}),200))}}}(e,{message:t})}hideMWCLoadingOverlay(){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null)}constructor(t){this.config=t,this.currentView=null,this.uploadedFiles=[],this.isInitialized=!1,this.isUsingDefaultContainer=!1,this.hasLaunched=!1,this.loadingScreen=null,this.updateUploadedDocuments=t=>{this.uploadedFiles=t}}async initialize(){var t;if(!this.isInitialized)try{this.setupMWCViews(),LO("mwc-loading-screen-style",'\n  .mwc-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .mwc-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .mwc-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .mwc-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .mwc-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .mwc-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n'),this.showMWCLoadingOverlay("Initializing"),await this.documentScanner.initialize(),await this.loadDDVcss(),IO.Core.license=this.config.license,IO.Core.engineResourcePath=`${(null===(t=this.config)||void 0===t?void 0:t.ddvResourcePath)||uB}/engine`,await this.initializeDDV(),this.initializeMWCViews(),this.isInitialized=!0}catch(t){throw this.isInitialized=!1,console.error("Initialization Failed:",t),new Error(`Initialization Failed: ${t.message}`)}finally{this.hideMWCLoadingOverlay()}}async launch(t,e){try{if(this.hasLaunched)throw new Error("Failed to launch this MobileWebCapture instance as it is already running");if(this.hasLaunched=!0,this.isInitialized||await this.initialize(),t)return void(t instanceof File?e===FO.Library&&this.config.showLibraryView?await this.createDocumentFromFile(t,FO.Library):await this.createDocumentFromFile(t,FO.Document):"string"==typeof t&&(e===FO.Library&&this.config.showLibraryView?await this.createDocumentFromName(t,FO.Library):await this.createDocumentFromName(t,FO.Document)));t||(e===FO.Library?await this.handleDefaultLaunch(FO.Library):e===FO.Document?await this.createDocumentFromName(`Doc-${Date.now()}`,FO.Document):this.config.showLibraryView?await this.handleDefaultLaunch(FO.Library):await this.createDocumentFromName(`Doc-${Date.now()}`,FO.Document))}catch(t){const e=(null==t?void 0:t.message)||t;throw new Error(`Launch MWC Failed: ${e}`)}}async createDocumentFromFile(t,e){const i=MO(null==t?void 0:t.name),n=[{convertMode:"cm/auto",fileData:new Blob([t],{type:t.type}),renderOptions:{renderAnnotations:"loadAnnotations"}}];if(this.config.showLibraryView){const t=await this.mwcViews.library.instance.createAndLoadDocument(i,n);e===FO.Document?this.handleDocumentClick(t.uid):this.switchView(e||FO.Library)}else{const t=IO.documentManager.createDocument({name:i});await t.loadSource(n),this.handleDocumentClick(t.uid)}}async createDocumentFromName(t,e){const i=MO(t);if(this.config.showLibraryView){const t=await this.mwcViews.library.instance.createAndLoadDocument(i);e===FO.Document?this.handleDocumentClick(t.uid):this.switchView(e||FO.Library)}else{const t=IO.documentManager.createDocument({name:i});this.handleDocumentClick(t.uid)}}async handleDefaultLaunch(t){if(this.config.showLibraryView)this.switchView(t||FO.Library);else try{const t=IO.documentManager.createDocument({name:`Doc-${Date.now()}`});this.mwcViews[FO.Document].instance.browseViewer.openDocument(t.uid),this.switchView(FO.Document),await HO(this.mwcViews[FO.Document].config.container,"Document Created",VO.SUCCESS)}catch(t){throw new Error(`Failed to create empty document: ${t.message}`)}}setupMWCViews(){var t,e,i,n,s,o,r,a,l,h,c,d,u,p,g,f,m,v,y,x,w;const{license:b,exportConfig:C,showLibraryView:S}=this.config;this.config.license=this.checkForTemporaryLicense(b),this.config.container?(this.config.container=RO(this.config.container),this.config.container.style.position="absolute"!==(null===(e=null===(t=this.config.container)||void 0===t?void 0:t.style)||void 0===e?void 0:e.position)&&"fixed"!==(null===(n=null===(i=this.config.container)||void 0===i?void 0:i.style)||void 0===n?void 0:n.position)?"relative":null===(o=null===(s=this.config.container)||void 0===s?void 0:s.style)||void 0===o?void 0:o.position):this.config.container=this.createDefaultMWCContainer();const _=this.createMWCViewContainers(this.config.container);this.config.libraryViewConfig={...this.config.libraryViewConfig,container:_[NO.Library]},this.config.documentViewConfig={...this.config.documentViewConfig,container:_[NO.Document]},this.config.pageViewConfig={...this.config.pageViewConfig,container:_[NO.Page]},this.config.transferViewConfig={...this.config.transferViewConfig,container:_[NO.Transfer]},this.config.historyViewConfig={...this.config.historyViewConfig,container:_[NO.History]},this.config.documentScannerConfig={...this.config.documentScannerConfig,scannerViewConfig:{...null===(r=this.config.documentScannerConfig)||void 0===r?void 0:r.scannerViewConfig,container:_[NO.Scanner]},...!1!==(null===(a=this.config.documentScannerConfig)||void 0===a?void 0:a.showResultView)&&{resultViewConfig:{...null===(l=this.config.documentScannerConfig)||void 0===l?void 0:l.resultViewConfig,container:_[NO.ScanResult]}},...!1!==(null===(h=this.config.documentScannerConfig)||void 0===h?void 0:h.showCorrectionView)&&{correctionViewConfig:{...null===(c=this.config.documentScannerConfig)||void 0===c?void 0:c.correctionViewConfig,container:_[NO.Correction]}},correctionViewConfig:{...null===(d=this.config.documentScannerConfig)||void 0===d?void 0:d.scannerViewConfig,container:_[NO.Correction]}},this.documentScanner=new ea({license:this.config.license,...this.config.documentScannerConfig,scannerViewConfig:null===(u=this.config.documentScannerConfig)||void 0===u?void 0:u.scannerViewConfig,resultViewConfig:!1===(null===(p=this.config.documentScannerConfig)||void 0===p?void 0:p.showResultView)||null===(g=this.config.documentScannerConfig)||void 0===g?void 0:g.resultViewConfig,correctionViewConfig:!1===(null===(f=this.config.documentScannerConfig)||void 0===f?void 0:f.showCorrectionView)||null===(m=this.config.documentScannerConfig)||void 0===m?void 0:m.correctionViewConfig,showResultView:null===(y=null===(v=this.config.documentScannerConfig)||void 0===v?void 0:v.showResultView)||void 0===y||y,showCorrectionView:null===(w=null===(x=this.config.documentScannerConfig)||void 0===x?void 0:x.showCorrectionView)||void 0===w||w}),this.mwcViews={[FO.Library]:{config:{...this.config.libraryViewConfig,container:this.config.libraryViewConfig.container,onCameraCapture:()=>this.handleCameraCapture(FO.Library),onGalleryImport:()=>this.handleGalleryImport(FO.Library),onDocumentClick:t=>this.handleDocumentClick(t),onViewUploadsHistory:()=>this.switchView(FO.History,{caller:FO.Library}),onClose:()=>this.dispose(),exportConfig:C,getUploadedDocuments:()=>this.getUploadedDocuments(),updateUploadedDocuments:t=>this.updateUploadedDocuments(t)}},[FO.Document]:{config:{...this.config.documentViewConfig,container:this.config.documentViewConfig.container,onBackToLibrary:()=>this.switchView(FO.Library),onCameraCapture:()=>this.handleCameraCapture(FO.Document),onGalleryImport:()=>this.handleGalleryImport(FO.Document),onPageClick:(t,e)=>this.handlePageClick(t,e),onViewUploadsHistory:()=>this.switchView(FO.History,{caller:FO.Document}),onClose:()=>this.dispose(),exportConfig:C,getUploadedDocuments:()=>this.getUploadedDocuments(),updateUploadedDocuments:t=>this.updateUploadedDocuments(t),onTransferPages:(t,e,i)=>this.handleTransferPage(t,e,i),showLibraryView:S}},[FO.Page]:{config:{...this.config.pageViewConfig,container:this.config.pageViewConfig.container,onDocumentClick:()=>this.switchView(FO.Document),onCameraCapture:()=>this.handleCameraCapture(FO.Page),onGalleryImport:()=>this.handleGalleryImport(FO.Page),onViewUploadsHistory:()=>this.switchView(FO.History,{caller:FO.Page}),onClose:()=>this.dispose(),exportConfig:C,getUploadedDocuments:()=>this.getUploadedDocuments(),updateUploadedDocuments:t=>this.updateUploadedDocuments(t),showLibraryView:S}},[FO.Transfer]:{config:{...this.config.transferViewConfig,container:this.config.transferViewConfig.container,onConfirmTransfer:t=>this.handleTransferPageConfirm(t),onCancelTransfer:()=>this.handleTransferPageCancel()}},[FO.History]:{config:{...this.config.historyViewConfig,container:this.config.historyViewConfig.container,exportConfig:C,getUploadedDocuments:()=>this.getUploadedDocuments(),updateUploadedDocuments:t=>this.updateUploadedDocuments(t),onBack:t=>this.handleHistoryBack(t)}}}}getDDSViewsToCreate(){var t,e,i,n;const s=null===(e=null===(t=this.config.documentScannerConfig)||void 0===t?void 0:t.showResultView)||void 0===e||e,o=null===(n=null===(i=this.config.documentScannerConfig)||void 0===i?void 0:i.showCorrectionView)||void 0===n||n,r=[NO.Scanner];return s&&r.push(NO.ScanResult),o&&r.push(NO.Correction),r}createMWCViewContainers(t){const e=this.getDDSViewsToCreate(),i=Object.values(FO),n=(t,e)=>{const i=document.createElement("div");return i.className=`mwc-view-container mwc-${t}-view-container`,Object.assign(i.style,e),i};return{...e.reduce(((e,i)=>{const s=n(i,{position:"absolute",height:"100%",width:"100%",top:"0",left:"0",zIndex:"1000",display:"none"});return t.append(s),e[i]=s,e}),{}),...i.reduce(((e,i)=>{const s=n(i,{position:"relative",height:"100%",width:"100%",display:"none"});return t.append(s),e[i]=s,e}),{})}}createDefaultMWCContainer(){const t=document.createElement("div");return t.className="mwc-main-container",Object.assign(t.style,{height:"100dvh",width:"100%",position:"absolute",left:0,top:0,display:"none"}),document.body.append(t),this.isUsingDefaultContainer=!0,t}checkForTemporaryLicense(t){return!(null==t?void 0:t.length)||(null==t?void 0:t.startsWith("A"))||(null==t?void 0:t.startsWith("L"))||(null==t?void 0:t.startsWith("P"))||(null==t?void 0:t.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":t}loadDDVcss(){var t;if(document.getElementById(dB))return;const e=(null===(t=this.config)||void 0===t?void 0:t.ddvResourcePath)||uB;return new Promise(((t,i)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=`${e}/ddv.css`,n.id=dB,n.onload=()=>t(),n.onerror=()=>i(new Error(`Failed to load CSS from ${e}`)),document.head.appendChild(n)}))}removeDDVcss(){const t=document.getElementById(dB);t&&t.remove()}async initializeDDV(){await IO.Core.loadWasm(),await IO.Core.init(),IO.setProcessingHandler("imageFilter",new IO.ImageFilter)}initializeMWCViews(){const{Library:t,Document:e,Page:i,Transfer:n,History:s}=FO;this.mwcViews[t].instance=new tB(this.mwcViews[t].config),this.mwcViews[e].instance=new KO(this.mwcViews[e].config),this.mwcViews[i].instance=new sB(this.mwcViews[i].config),this.mwcViews[n].instance=new ZO(this.mwcViews[n].config),this.mwcViews[s].instance=new hB(this.mwcViews[s].config),this.mwcViews[t].instance.initialize(),this.mwcViews[e].instance.initialize(),this.mwcViews[i].instance.initialize(),this.mwcViews[n].instance.initialize(),this.mwcViews[s].instance.initialize()}switchView(t,e){var i,n,s,o,r,a,l;if("none"===(null===(i=this.config.container)||void 0===i?void 0:i.style.display)&&(this.config.container.style.display="block"),t===this.currentView)return void(null===(s=null===(n=this.mwcViews[t].instance)||void 0===n?void 0:n.setVisible)||void 0===s||s.call(n,!0,e));if(this.currentView){null===(r=null===(o=this.mwcViews[this.currentView].instance)||void 0===o?void 0:o.setVisible)||void 0===r||r.call(o,!1,e)}null===(l=null===(a=this.mwcViews[t].instance)||void 0===a?void 0:a.setVisible)||void 0===l||l.call(a,!0,e),this.currentView=t}async handleCameraCapture(t){var e,i,n,s;null===(i=null===(e=this.mwcViews[this.currentView].instance)||void 0===e?void 0:e.setVisible)||void 0===i||i.call(e,!1);try{const e=await this.documentScanner.launch();if((null==e?void 0:e.status.code)===Br.RS_SUCCESS){const i=await e.correctedImageResult.toBlob("image/png");if(t===FO.Library){const t=[{convertMode:"cm/auto",fileData:i}],e=await this.mwcViews.library.instance.createAndLoadDocument(`Doc-${Date.now()}`,t);this.handleDocumentClick(e.uid)}else if(t===FO.Document||t===FO.Page){const t=this.mwcViews[FO.Document].instance.browseViewer.currentDocument;t&&await t.loadSource([{convertMode:"cm/auto",fileData:i}])}}}catch(t){console.error("Camera capture failed:",t)}finally{null===(s=null===(n=this.mwcViews[this.currentView].instance)||void 0===n?void 0:n.setVisible)||void 0===s||s.call(n,!0)}}async handleGalleryImport(t){const e=document.createElement("input");e.type="file",e.accept="image/*,application/pdf",e.multiple=!0,e.onchange=async()=>{var i;const n=Array.from(e.files||[]),s=n.length,o=[];for(let t=0;t<s;t++)o.push({convertMode:"cm/auto",fileData:new Blob([n[t]],{type:n[t].type}),renderOptions:{renderAnnotations:"loadAnnotations"}});if(o.length>0)if(t===FO.Library){const t=MO(null===(i=n[0])||void 0===i?void 0:i.name),e=await this.mwcViews.library.instance.createAndLoadDocument(t,o);this.handleDocumentClick(e.uid)}else if(t===FO.Document||t===FO.Page){const e=this.mwcViews[FO.Document].instance.browseViewer.currentDocument;e&&(await e.loadSource(o),this.switchView(t))}},e.click()}handleDocumentClick(t){this.mwcViews[FO.Document].instance.browseViewer.openDocument(t),this.switchView(FO.Document)}handlePageClick(t,e){this.mwcViews[FO.Page].instance.openPage(t,e),this.switchView(FO.Page)}handleTransferPage(t,e,i){this.switchView(FO.Transfer,{mode:t,docId:e,selectedIdx:i})}async handleTransferPageConfirm(t){this.mwcViews.document.instance.handleSelectedBack(),await HO(this.mwcViews.document.config.container,"copy"===t?"Pasted":"move"===t?"Moved":"")}handleTransferPageCancel(){this.switchView(FO.Document)}handleHistoryBack(t){this.switchView(t)}getUploadedDocuments(){return this.uploadedFiles}dispose(){var t,e;return Object.values(this.mwcViews).forEach((t=>{var e;(null===(e=t.instance)||void 0===e?void 0:e.dispose)&&t.instance.dispose()})),this.documentScanner.dispose(),IO.documentManager.deleteAllDocuments(),this.config.container instanceof HTMLElement&&(this.config.container.textContent=""),this.isUsingDefaultContainer&&RO(this.config.container).remove(),this.removeDDVcss(),this.currentView=null,this.uploadedFiles=[],this.mwcViews=null,this.documentScanner=null,this.isInitialized=!1,(null===(t=this.config)||void 0===t?void 0:t.onClose)&&(null===(e=this.config)||void 0===e||e.onClose()),this.hasLaunched=!1,Promise.resolve()}}const gB={MobileWebCapture:pB,LibraryView:tB,DocumentView:KO,PageView:sB,TransferView:ZO};export{ML as BrowseViewer,Oo as CameraEnhancer,qe as CameraEnhancerModule,Fn as CameraView,iM as CaptureViewer,Le as CaptureVisionRouter,me as CaptureVisionRouterModule,Ne as CapturedResultReceiver,yt as CoreModule,NL as CustomViewer,ia as DDS,IO as DDV,Ko as DocumentNormalizerModule,Jr as DocumentNormalizerView,Qr as DocumentResultView,ea as DocumentScanner,Kr as DocumentScannerView,KO as DocumentView,_i as DrawingItem,kn as DrawingStyleManager,xL as EditViewer,Zv as EnumAnnotationRenderMode,o as EnumBufferOverflowProtectionMode,xt as EnumCapturedResultItemType,r as EnumColourChannelUsageType,qv as EnumConvertMode,wt as EnumCornerType,Pt as EnumCrossVerificationStatus,Ox as EnumDocumentDetectionStatus,ri as EnumDrawingItemMediaType,ai as EnumDrawingItemState,li as EnumEnhancedFeatures,bt as EnumErrorCode,Ct as EnumGrayscaleEnhancementMode,St as EnumGrayscaleTransformationMode,Qo as EnumImageColourMode,cp as EnumImageDataType,PO as EnumImageFilterType,a as EnumImagePixelFormat,ye as EnumImageSourceState,_t as EnumImageTagType,At as EnumIntermediateResultUnitType,Lp as EnumPDFCompressionType,Op as EnumPDFPageType,Tt as EnumPDFReadingMode,Ve as EnumPresetTemplate,Et as EnumRasterDataSource,It as EnumRegionObjectElementType,Br as EnumResultStatus,Dt as EnumSectionType,Mp as EnumTIFFCompressionType,Ro as Feedback,Ni as GroupDrawingItem,ki as ImageDrawingItem,Go as ImageEditorView,er as ImageManager,J as ImageSourceAdapter,Ue as IntermediateResultReceiver,tB as LibraryView,Jt as LicenseManager,Qt as LicenseModule,Bi as LineDrawingItem,gB as MWC,pB as MobileWebCapture,Rr as MultiFrameResultCrossFilter,sB as PageView,kL as PerspectiveViewer,Fi as QuadDrawingItem,Ti as RectDrawingItem,Mi as TextDrawingItem,ZO as TransferView,lr as UtilityModule,F as _getNorImageData,M as _saveToFile,B as _toBlob,L as _toCanvas,O as _toImage,dt as bDebug,D as checkIsLink,k as compareVersion,st as doOrWaitAsyncDependency,at as getNextTaskID,R as handleEngineResourcePaths,pt as innerVersions,v as isArc,y as isContour,b as isDSImageData,C as isDSRect,S as isImageTag,_ as isLineSegment,m as isObject,w as isOriginalDsImageData,T as isPoint,E as isPolygon,P as isQuad,A as isRect,vt as loadWasm,it as mapAsyncDependency,gt as mapPackageRegister,lt as mapTaskCallBack,ht as onLog,I as requestResource,ut as setBDebug,ct as setOnLog,nt as waitAsyncDependency,ot as worker,ft as workerAutoResources};
